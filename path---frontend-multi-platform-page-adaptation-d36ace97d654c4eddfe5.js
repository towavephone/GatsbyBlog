webpackJsonp([66631502929495],{1270:function(n,s){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlElEQVRIx12We2xT5xXAbcI2Vmn7o1I1uhVYRxL8tuPn9bXv0+/4/YgdOyYkkATCCEEYsqVNC2wCIYQWShmUBFh4hMAWECot0BUtlI4yAS1oKqJQXimsDBgTU8codnLO7r0uUPpJn87Rp+/8vvOdc75zr8xmZmTieI1NykU5yxOfxDncz3NUjAlyDXMjXGMhys+cG+FzGQ8VU4t7XuV8z8m+GUkrJclSqVReYJ0ZWQ8Tl2AdTPhnq9ns2QKd+crDZiHha8NsYCE21HZiXphpb3sxxTf99Tdsw51ldHqFaLOXXyzvYqOyZ0YPk5soylfouuUbvHOxh56JbiqJfi4/FnE1lxKetrGUZ954nbcdU/752ORpxWVsc6mZjPxctFtApeVtra1lmIPwTxClgeCqvGTsX/WWOEbtyTGWSoGbToOPzUHQ1QghVxOEhRniZ5U8XB4TzvTdgj1ZJdq2OOrkGhVRBnrYFum6TiK0l2fr0emMlVxcBhlnEniqDjlBuqg0CnD0MPWiDrwzhR4u+5B3x3WiLUNHJjxzZYvR8ZKTCP+Xo1JoM/nBYvSB1egHuyUIrCOBPj4LtD0KlD2K4h7SGip62aygxzaK9rHA3Aqt2vw0MRYjnyJtYaQdsXG9hgWFwgmVlXZUKUjUqmm0CgfwhA80Kgr1Wg40Sue4SuFEnZq+YjMbJ0kh0zmfemjQ0j2EJYh2a23RVOODIBvHmCsBUaoWLDoWKIsP50bTApxC5QwH1Ghp0Gk4MBk8aDLQEslooCc88VClsK+zGANI2mqLer0XFuea8PSuN+DM7o3QWyhAR7IBfj+vDbyOICS9aSjkZo8nvSlUKuxXLDUOKdN6LSl/AlRUE+vNAnD50l8XeTIEPiYEzXYG5mlNeGz7BvjPpY/g5snDcHxwE+zs7oCh1zvHCrNm48u/ML8j2muVQblBZ3t6ZY2KXKtQcDiwdk1xx9rV0BlqghEuD4fNUTy1Zwhw7Cbioxu461fdsOgFDa5pbh3zu6NifE9f+XCPlGHS5nuaFI3K8brJ4EUHES4WFiyEP2/dCPc2vYH/3NIHePcywP1LWLp3Ec4tWQa3FvbAu7294yqVA801rju5utYfiQyKDD4DnC8GWEhMafJPtBALxuHjo3+C8bufIn59DfHBFcDiDcQvzyF+/iEsbWuDadNMaDW5H7nY6Iyyh165zfLNtdUqIqLTsEJSQqBVUTD1JQPqdRT8sf9NuH7kMHy0fRg+O3EUzp96H/Zs2SBklxFKxwFmowtdTCIoPQx7oKLzl32PPTRPVSudDwQgCrUGL0+twdzsDjjSdwD2J1fh/q7N0N+1EtykB178qVY4lAahRktWkw95JrG4DAxPvHU3Wwb+rlcsHfK0WNxCoMdUCgdUaxnMBPKw7dVe2LyhDw4MboORA4NQOd2CaiUFaqWjZJGAyQGRUeubP8FqElqZspquEBeUM2zrnEQUa3R8USVcp2qGDZV6ErqXL4PfrlwFhSU9cPL4MejfshOsZq90sCg5KvHZ5MnPfa+cmFrxukRFuRZNcYqIoNngHheeFmiF11ClIDBdPwfqG9qhc1E3rF25GnrX90M204JqBfWItPrP8lTqa7vFpSw3GJ9cZjI4pW5TXaWezpKxh4Q5gEY9LwApVOtZMApxVWhd2DKvC7K5FjTUsFCj45Ah4yXaHuz1MBlgyHCb1HXISIXMTcekOJqN1h/72Mx92h5DwuwHjeChWseBQsNgJJ6H944eB5oNgaLajnaL/07E24wuKr7Cz+XuuenUsMioCxYmyHhnSPLQTYVVYVfjI46Mo80WBLMgLY4E1FhCOENBAsfHQG/0juuNPqGguU8ywXas5XNbg6783wJ8w781GtUPJc+irkap/Ufdje0JXytStnDJbA2D1Z4EKxEHsyUMRmsIdcZaNFpCYBYqwWQLPhD3Btn6t2Pe5uF0cD7Sdr/xmSab8racFaDooOvuk0wDEs40EFQGbVQGbEKXJoTPgZ3JoJGIgULvR6M1jE67rzvpae5ojC7GEJ9rfgILc7lC3NV0T6flTtjoPLK+VuD8rcD65gDtaQInPxOtzoxQRrXgD8/BdW/+YezYByfxvfdHvnxl+ZLKCDfzUMIze60Ey+brJukrqcjA1u3tBw8dfZiZuRQFaNFory/WEPUlE5kFK5WDQKRtbFPfUOnChUvFL27cwKuj/8CBHXv2iQw/k/KGuNwyCYiIkhw+sO/569eu7b1+ffR/H5z4BAcG38X1m/biyjX9ODR8GC9dHsXLV0fx5KlzePDIyFd7ht9ZJZhJrcvLhV/wMuUPljQWtC6Z+FjfuWPHlPMXLq64Onpz3d8/Pf9WX//OW2vWbITBof3n3tqya9fbh/7SvW1gZ9Xj/V1dr8kf614qIZONjBwrezi8Ty54K5d9ZzTmF+xe1LnioaD+4Nvrn4/ermif3yHp8UCDLMCky7Z+n192+/YdST9z5mPZ7t1D8ouXv6gQ4S9WTplks7mut8xZijxbKz2vvi2D39/cPyB/HC5xOm2czPvd35F8rkGCS0+I4WXV1QbJaMq06XqbNXCQJIILpH8hOic3GghZMpl62qG/Nf4PRzaQ862MzO4AAAAASUVORK5CYII=",aspectRatio:.6666666666666666,src:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png",srcSet:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-8a97b.png 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-0fdf3.png 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png 600w",srcWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp",srcSetWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-5d70e.webp 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-d1677.webp 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<h1 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h1>\n<p>网页在不同平台上展示的布局不一致，需要改成类似等比缩放的效果以便在各平台显示</p>\n<h1 id="选型"><a href="#%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型</h1>\n<ol>\n<li><a href="/mobile-page-adaptation/">主流方案</a></li>\n<li><a href="/international-official-website-technical-difficulties/#%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%80%82%E9%85%8D">官网方案</a></li>\n</ol>\n<h1 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h1>\n<h2 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h2>\n<ol>\n<li>\n<p>使用 postcss-px-to-viewport 插件，将 src 以及三方库(node_modules)下的所有样式文件 <code class="language-text">(*.css|*.module.css|*.less|*.module.less)</code> 里面的 px 单位转换到 rem 单位</p>\n</li>\n<li>\n<p>在公共样式下根据媒体查询（屏幕宽度 or 屏幕 dpi）设置每种字体的大小</p>\n</li>\n<li>\n<p>由于目前插件不能转换非样式文件里面的 px 单位，所以需要写两种公共样式，这里会通过 url 来决定哪种生效</p>\n<ol>\n<li>需要等比缩放的，根据屏幕宽度改变字体大小（新页面，即此次重构页面）</li>\n<li>需要固定大小的，固定设置为 1920 下的字体大小（老页面）</li>\n</ol>\n</li>\n</ol>\n<p>重构目标：重构页面采用等比缩放，老页面维持固定大小，注意上线之后所有非样式代码即 js 文件里面禁止使用 px 单位，需要手动转换为 rem 单位，转换公式为 px 大小 / 10</p>\n<p>最终目标：所有页面统一采用等比缩放 （即将 js 代码里面的 px 单位全部改为 rem 单位，三方库里面的 js 代码暂不考虑，之后才能全部采用此方案）</p>\n<h2 id="postcssconfigjs（插件转换-px-为-rem）"><a href="#postcssconfigjs%EF%BC%88%E6%8F%92%E4%BB%B6%E8%BD%AC%E6%8D%A2-px-%E4%B8%BA-rem%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>postcss.config.js（插件转换 px 为 rem）</h2>\n<h3 id="配置分离"><a href="#%E9%85%8D%E7%BD%AE%E5%88%86%E7%A6%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置分离</h3>\n<p>由于想让 cra 使用 postcss.config.js 的配置（cra 默认不使用），在 cra 5 版本和 customize-cra 情况下，addPostcssPlugins <a href="https://github.com/arackaf/customize-cra/issues/327#issuecomment-1210459104" target="_blank" rel="nofollow noreferrer noopener">不起作用</a>，有 2 种方式可以解决</p>\n<ol>\n<li>\n<p>重写 addPostcssPlugins</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93072216571164330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const addPostcssPlugins = (plugins) => (config) => {\n  const rules = config.module.rules.find((rule) => Array.isArray(rule.oneOf)).oneOf;\n  rules.forEach(\n     (r) =>\n        r.use &&\n        r.use.forEach((u) => {\n           if (u.options && u.options.ident === \'postcss\') {\n              const postcssOptions = {\n                 ident: \'postcss\',\n                 config: false\n              };\n              if (!u.options.plugins) {\n                 // u.options.plugins = () => [...plugins]\n                 postcssOptions.plugins = plugins;\n              } else {\n                 // const originalPlugins = u.options.plugins\n                 // u.options.plugins = () => [...originalPlugins(), ...plugins]\n                 postcssOptions.plugins = plugins;\n              }\n\n              delete u.options.plugins;\n              delete u.options.ident;\n\n              u.options.postcssOptions = postcssOptions;\n           } else if (u.options && u.options.postcssOptions && u.options.postcssOptions.ident === \'postcss\') {\n              if (!u.options.postcssOptions.plugins) {\n                 u.options.postcssOptions.plugins = plugins;\n              } else {\n                 const originalPlugins = u.options.postcssOptions.plugins;\n                 u.options.postcssOptions.plugins = [...originalPlugins, ...plugins];\n              }\n           }\n        })\n  );\n  return config;\n};`, `93072216571164330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">addPostcssPlugins</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plugins</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> rules <span class="token operator">=</span> config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=></span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>oneOf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>oneOf<span class="token punctuation">;</span>\n  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>\n     <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n        r<span class="token punctuation">.</span>use <span class="token operator">&amp;&amp;</span>\n        r<span class="token punctuation">.</span>use<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">u</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n           <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">const</span> postcssOptions <span class="token operator">=</span> <span class="token punctuation">{</span>\n                 ident<span class="token punctuation">:</span> <span class="token string">\'postcss\'</span><span class="token punctuation">,</span>\n                 config<span class="token punctuation">:</span> <span class="token boolean">false</span>\n              <span class="token punctuation">}</span><span class="token punctuation">;</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                 <span class="token comment">// u.options.plugins = () => [...plugins]</span>\n                 postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins<span class="token punctuation">;</span>\n              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n                 <span class="token comment">// const originalPlugins = u.options.plugins</span>\n                 <span class="token comment">// u.options.plugins = () => [...originalPlugins(), ...plugins]</span>\n                 postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins<span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">;</span>\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>\n\n              u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions <span class="token operator">=</span> postcssOptions<span class="token punctuation">;</span>\n           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                 u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins<span class="token punctuation">;</span>\n              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n                 <span class="token keyword">const</span> originalPlugins <span class="token operator">=</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins<span class="token punctuation">;</span>\n                 u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>originalPlugins<span class="token punctuation">,</span> <span class="token operator">...</span>plugins<span class="token punctuation">]</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n           <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> config<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>去掉相关配置，<a href="https://github.com/arackaf/customize-cra/issues/327#issuecomment-1371815281" target="_blank" rel="nofollow noreferrer noopener">依赖 postcss.config.js</a></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77299418943656330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const enablePostcssRc = () => (config) => {\n  const rules = config.module.rules.find((rule) => Array.isArray(rule.oneOf)).oneOf;\n  rules.forEach(\n     (r) =>\n        r.use &&\n        r.use.forEach((u) => {\n           if (u.options && u.options.ident === \'postcss\') {\n              delete u.options.ident;\n              if (u.options.plugins) {\n                 delete u.options.plugins; // 删除 plugins 属性，使用 postcss.config.js 中的配置\n              }\n           }\n\n           if (u.options && u.options.postcssOptions && u.options.postcssOptions.ident === \'postcss\') {\n              delete u.options.postcssOptions;\n           }\n        })\n  );\n  return config;\n};`, `77299418943656330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">enablePostcssRc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> rules <span class="token operator">=</span> config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=></span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>oneOf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>oneOf<span class="token punctuation">;</span>\n  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>\n     <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n        r<span class="token punctuation">.</span>use <span class="token operator">&amp;&amp;</span>\n        r<span class="token punctuation">.</span>use<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">u</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n           <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                 <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">;</span> <span class="token comment">// 删除 plugins 属性，使用 postcss.config.js 中的配置</span>\n              <span class="token punctuation">}</span>\n           <span class="token punctuation">}</span>\n\n           <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">;</span>\n           <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> config<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>采用方案二</p>\n<h3 id="rspack-适配"><a href="#rspack-%E9%80%82%E9%85%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rspack 适配</h3>\n<p>rule 需要添加以下规则来兼容业务代码/三方库的样式文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72893507550230160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   module: {\n      rules: [\n         {\n            test: /\\.css\\$/,\n            exclude: /\\.module\\.css\\$/,\n            use: [\'postcss-loader\'],\n            type: \'css\'\n         },\n         {\n            test: /\\.module\\.css\\$/,\n            use: [\'postcss-loader\'],\n            type: \'css/module\'\n         },\n         {\n            test: /\\.less\\$/,\n            exclude: /\\.module\\.less\\$/,\n            use: [\n               \'postcss-loader\',\n               {\n                  loader: \'less-loader\',\n                  options: {\n                     lessOptions: { javascriptEnabled: true }\n                  }\n               }\n            ],\n            type: \'css\'\n         },\n         {\n            test: /\\.module\\.less\\$/,\n            use: [\n               \'postcss-loader\',\n               {\n                  loader: \'less-loader\',\n                  options: {\n                     lessOptions: { javascriptEnabled: true }\n                  }\n               }\n            ],\n            type: \'css/module\'\n         }\n      ];\n   }\n}`, `72893507550230160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>\n   module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.css$/</span><span class="token punctuation">,</span>\n            exclude<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.css$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'postcss-loader\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.css$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'postcss-loader\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css/module\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.less$/</span><span class="token punctuation">,</span>\n            exclude<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.less$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n               <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n               <span class="token punctuation">{</span>\n                  loader<span class="token punctuation">:</span> <span class="token string">\'less-loader\'</span><span class="token punctuation">,</span>\n                  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.less$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n               <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n               <span class="token punctuation">{</span>\n                  loader<span class="token punctuation">:</span> <span class="token string">\'less-loader\'</span><span class="token punctuation">,</span>\n                  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css/module\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="配置代码"><a href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置代码</h3>\n<p>postcss.config.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38255398585799790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n   plugins: [\n      \'postcss-flexbugs-fixes\',\n      [\n         \'postcss-preset-env\',\n         {\n            autoprefixer: {\n               flexbox: \'no-2009\'\n            },\n            stage: 3\n         }\n      ],\n      \'postcss-normalize\',\n      [\n         \'postcss-px-to-viewport\',\n         {\n            // https://github.com/evrone/postcss-px-to-viewport/blob/master/README_CN.md\n            unitToConvert: \'px\', // 需要转换的单位，默认为&quot;px&quot;\n            viewportWidth: 1000, // 视窗的宽度，对应设计稿的宽度\n            unitPrecision: 8, // 指定 px 转换为视窗单位值的小数后 x 位数，转换精度尽可能的大，防止出现图片比例问题\n            viewportUnit: \'rem\', // 希望使用的视口单位\n            fontViewportUnit: \'rem\', // 字体使用的视口单位\n            minPixelValue: 1, // 最小的转换数值\n            mediaQuery: true, // 媒体查询里的单位是否需要转换单位\n            selectorBlackList: [/^html\\$/, \'hack\'] // 需要忽略的 CSS 选择器，不会转为视口单位，使用原有的 px 等单位\n            // include: /\\/src\\//\n            // exclude: /node_modules/,\n         }\n      ]\n   ]\n};`, `38255398585799790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token string">\'postcss-flexbugs-fixes\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span>\n         <span class="token string">\'postcss-preset-env\'</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            autoprefixer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n               flexbox<span class="token punctuation">:</span> <span class="token string">\'no-2009\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            stage<span class="token punctuation">:</span> <span class="token number">3</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token string">\'postcss-normalize\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span>\n         <span class="token string">\'postcss-px-to-viewport\'</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            <span class="token comment">// https://github.com/evrone/postcss-px-to-viewport/blob/master/README_CN.md</span>\n            unitToConvert<span class="token punctuation">:</span> <span class="token string">\'px\'</span><span class="token punctuation">,</span> <span class="token comment">// 需要转换的单位，默认为"px"</span>\n            viewportWidth<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 视窗的宽度，对应设计稿的宽度</span>\n            unitPrecision<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// 指定 px 转换为视窗单位值的小数后 x 位数，转换精度尽可能的大，防止出现图片比例问题</span>\n            viewportUnit<span class="token punctuation">:</span> <span class="token string">\'rem\'</span><span class="token punctuation">,</span> <span class="token comment">// 希望使用的视口单位</span>\n            fontViewportUnit<span class="token punctuation">:</span> <span class="token string">\'rem\'</span><span class="token punctuation">,</span> <span class="token comment">// 字体使用的视口单位</span>\n            minPixelValue<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 最小的转换数值</span>\n            mediaQuery<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 媒体查询里的单位是否需要转换单位</span>\n            selectorBlackList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/^html$/</span><span class="token punctuation">,</span> <span class="token string">\'hack\'</span><span class="token punctuation">]</span> <span class="token comment">// 需要忽略的 CSS 选择器，不会转为视口单位，使用原有的 px 等单位</span>\n            <span class="token comment">// include: /\\/src\\//</span>\n            <span class="token comment">// exclude: /node_modules/,</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span>\n   <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="commonless（缩放规则）"><a href="#commonless%EF%BC%88%E7%BC%A9%E6%94%BE%E8%A7%84%E5%88%99%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>common.less（缩放规则）</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90010753161197600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 固定大小的页面\n.hackFixedPage {\n   font-size: 10px;\n}\n\n// 等比缩放的页面\n.hackResponsivePage {\n   // 大于 1500px (10px)\n   @media screen and (min-width: 1501px) {\n      font-size: 10px;\n   }\n\n   // 1300px～1500px 的宽度区间的根字号大小是某个范围（8px～10px）\n   @media screen and (min-width: 1300px) and (max-width: 1500px) {\n      font-size: calc(8px + 2 * (100vw - 1300px) / 200);\n   }\n\n   // 小于 1300px 的屏幕宽度，固定根字号大小（8px）\n   @media screen and (max-width: 1299px) {\n      font-size: 8px;\n   }\n}`, `90010753161197600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="less"\n              >\n                <span class="gatsby-code-button-language">less</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="less"><pre style="counter-reset: linenumber NaN" class="language-less line-numbers"><code class="language-less"><span class="token comment">// 固定大小的页面</span>\n<span class="token selector">.hackFixedPage</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 等比缩放的页面</span>\n<span class="token selector">.hackResponsivePage</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 大于 1500px (10px)</span>\n   <span class="token atrule">@media screen and <span class="token punctuation">(</span>min-width<span class="token punctuation">:</span> 1501px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token comment">// 1300px～1500px 的宽度区间的根字号大小是某个范围（8px～10px）</span>\n   <span class="token atrule">@media screen and <span class="token punctuation">(</span>min-width<span class="token punctuation">:</span> 1300px<span class="token punctuation">)</span> and <span class="token punctuation">(</span>max-width<span class="token punctuation">:</span> 1500px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>8px <span class="token operator">+</span> 2 <span class="token operator">*</span> <span class="token punctuation">(</span>100vw <span class="token operator">-</span> 1300px<span class="token punctuation">)</span> <span class="token operator">/</span> 200<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token comment">// 小于 1300px 的屏幕宽度，固定根字号大小（8px）</span>\n   <span class="token atrule">@media screen and <span class="token punctuation">(</span>max-width<span class="token punctuation">:</span> 1299px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实际使用"><a href="#%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实际使用</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52406740093730095000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.hintIcon {\n   font-size: 14px; // 实际转换为 14 / 10 = 1.4rem\n   margin-left: 8px; // 实际转换为 8 / 10 = 0.8rem\n   vertical-align: 1px; // 不做转换\n}`, `52406740093730095000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="less"\n              >\n                <span class="gatsby-code-button-language">less</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="less"><pre style="counter-reset: linenumber NaN" class="language-less line-numbers"><code class="language-less"><span class="token selector">.hintIcon</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span> <span class="token comment">// 实际转换为 14 / 10 = 1.4rem</span>\n   <span class="token property">margin-left</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token comment">// 实际转换为 8 / 10 = 0.8rem</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span> <span class="token comment">// 不做转换</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="三方库非样式文件单位转换"><a href="#%E4%B8%89%E6%96%B9%E5%BA%93%E9%9D%9E%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>三方库非样式文件单位转换</h1>\n<p>在上面适配规则上线之后，发现有的三方库不能正确的缩放，导致页面看起来不协调，以下是各个三方库的修复</p>\n<h2 id="pro-components"><a href="#pro-components" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pro components</h2>\n<p>参考<a href="https://github.com/ant-design/cssinjs?tab=readme-ov-file" target="_blank" rel="nofollow noreferrer noopener">文档</a>，对应<a href="https://github.com/ant-design/cssinjs/blob/master/src/transformers/px2rem.ts" target="_blank" rel="nofollow noreferrer noopener">源码</a>，可以看出是运行时的单位转换</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36238297750511084000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { px2remTransformer, StyleProvider } from \'@ant-design/cssinjs\';\n\nconst StyleHoc = ({ children }) => {\n   // 和上面的 postcss-px-to-viewport 的适配策略保持一致\n   // 以 10 为根字体大小进行转换，保留 8 位小数，媒体查询下也进行转换\n   return (\n      <StyleProvider transformers={[px2remTransformer({ rootValue: 10, precision: 8, mediaQuery: true })]}>\n         {children}\n      </StyleProvider>\n   );\n};`, `36238297750511084000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> px2remTransformer<span class="token punctuation">,</span> StyleProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ant-design/cssinjs\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">StyleHoc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token comment">// 和上面的 postcss-px-to-viewport 的适配策略保持一致</span>\n   <span class="token comment">// 以 10 为根字体大小进行转换，保留 8 位小数，媒体查询下也进行转换</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>StyleProvider transformers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token function">px2remTransformer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rootValue<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> mediaQuery<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">></span>\n         <span class="token punctuation">{</span>children<span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>StyleProvider<span class="token operator">></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="mui"><a href="#mui" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>mui</h2>\n<p>参考<a href="https://v5.mui.com/material-ui/customization/theming/" target="_blank" rel="nofollow noreferrer noopener">文档</a></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22708623197848277000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { createTheme, ThemeProvider } from \'@mui/material/styles\';\n\nconst theme = createTheme({\n   // 和上面的 postcss-px-to-viewport 的适配策略保持一致\n   // 以 10 为根字体大小进行转换\n   typography: {\n      pxToRem: (size) => \\`\\${size / 10}rem\\`\n   }\n});\n\nconst ThemeHoc = ({ children }) => {\n   return <ThemeProvider theme={theme}>{children}</ThemeProvider>;\n};`, `22708623197848277000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createTheme<span class="token punctuation">,</span> ThemeProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@mui/material/styles\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">createTheme</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token comment">// 和上面的 postcss-px-to-viewport 的适配策略保持一致</span>\n   <span class="token comment">// 以 10 为根字体大小进行转换</span>\n   typography<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function-variable function">pxToRem</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size <span class="token operator">/</span> <span class="token number">10</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rem</span><span class="token template-punctuation string">`</span></span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">ThemeHoc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeProvider theme<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ThemeProvider<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
excerpt:"背景 网页在不同平台上展示的布局不一致，需要改成类似等比缩放的效果以便在各平台显示 选型 主流方案 官网方案 实现 核心逻辑 使用 postcss-px-to-viewport 插件，将 src 以及三方库(node_modules)下的所有样式文件   里面的 px…",timeToRead:5,tableOfContents:'<ul>\n<li><a href="/frontend-multi-platform-page-adaptation/#%E8%83%8C%E6%99%AF">背景</a></li>\n<li><a href="/frontend-multi-platform-page-adaptation/#%E9%80%89%E5%9E%8B">选型</a></li>\n<li>\n<p><a href="/frontend-multi-platform-page-adaptation/#%E5%AE%9E%E7%8E%B0">实现</a></p>\n<ul>\n<li><a href="/frontend-multi-platform-page-adaptation/#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91">核心逻辑</a></li>\n<li>\n<p><a href="/frontend-multi-platform-page-adaptation/#postcssconfigjs%EF%BC%88%E6%8F%92%E4%BB%B6%E8%BD%AC%E6%8D%A2-px-%E4%B8%BA-rem%EF%BC%89">postcss.config.js（插件转换 px 为 rem）</a></p>\n<ul>\n<li><a href="/frontend-multi-platform-page-adaptation/#%E9%85%8D%E7%BD%AE%E5%88%86%E7%A6%BB">配置分离</a></li>\n<li><a href="/frontend-multi-platform-page-adaptation/#rspack-%E9%80%82%E9%85%8D">rspack 适配</a></li>\n<li><a href="/frontend-multi-platform-page-adaptation/#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81">配置代码</a></li>\n</ul>\n</li>\n<li><a href="/frontend-multi-platform-page-adaptation/#commonless%EF%BC%88%E7%BC%A9%E6%94%BE%E8%A7%84%E5%88%99%EF%BC%89">common.less（缩放规则）</a></li>\n<li><a href="/frontend-multi-platform-page-adaptation/#%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8">实际使用</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/frontend-multi-platform-page-adaptation/#%E4%B8%89%E6%96%B9%E5%BA%93%E9%9D%9E%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2">三方库非样式文件单位转换</a></p>\n<ul>\n<li><a href="/frontend-multi-platform-page-adaptation/#pro-components">pro components</a></li>\n<li><a href="/frontend-multi-platform-page-adaptation/#mui">mui</a></li>\n</ul>\n</li>\n</ul>',wordCount:{words:136},frontmatter:{date:"2025-10-27 11:43:35",path:"/frontend-multi-platform-page-adaptation/",tags:"前端, 页面适配, 预研",title:"前端多平台页面适配",draft:null,catalog_number:null}},nextPost:{html:'<h1 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h1>\n<p>统计线上用户各个功能的使用情况，以便后续针对性的优化</p>\n<h1 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h1>\n<h2 id="前端"><a href="#%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端</h2>\n<ol>\n<li>使用 <a href="https://github.com/nytimes/react-tracking" target="_blank" rel="nofollow noreferrer noopener">https://github.com/nytimes/react-tracking</a> 三方库埋点</li>\n<li>使用 sendBeacon 异步发送埋点信息</li>\n<li>埋点信息默认发送 location，type（默认为 enter，即进入页面类型），create_by（埋点触发人）</li>\n</ol>\n<p>utils/sendReport.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66335878561634850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function sendBeacon(url, data) {\n   if (!navigator.sendBeacon) {\n      return false;\n   }\n\n   return navigator.sendBeacon(url, data);\n}\n\nexport default function sendReport(data) {\n   const newData = new FormData();\n   newData.append(\'data\', JSON.stringify(data));\n   return sendBeacon(\'/web_track/send/\', newData);\n}`, `66335878561634850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>sendBeacon<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">return</span> navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">sendReport</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> newData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   newData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">\'/web_track/send/\'</span><span class="token punctuation">,</span> newData<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77971317906188700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { pick } from \'lodash\'\n\nimport sendReport from \'./utils/sendReport\';\n\nconst isProd = process.env.NODE_ENV === \'production\';\n\nconst TrackHoc = ({ children }) => {\n   const { Track } = useTracking(\n      () => ({\n         location: pick(window.location, [\'origin\', \'hash\', \'href\']),\n         type: \'enter\', // 默认值\n         create_by: \'当前登录用户或者不传根据 cookie 来判断用户\'\n      }),\n      {\n         dispatch: (data) => {\n            console.log(\'tracking\', data);\n            // 不是正式环境不上传埋点数据\n            if (!isProd) {\n               return;\n            }\n            sendReport(data);\n         }\n      }\n   );\n\n   return <Track>{children}</Track>\n};`, `77971317906188700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> pick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'lodash\'</span>\n\n<span class="token keyword">import</span> sendReport <span class="token keyword">from</span> <span class="token string">\'./utils/sendReport\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">TrackHoc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> Track <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTracking</span><span class="token punctuation">(</span>\n      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n         location<span class="token punctuation">:</span> <span class="token function">pick</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'origin\'</span><span class="token punctuation">,</span> <span class="token string">\'hash\'</span><span class="token punctuation">,</span> <span class="token string">\'href\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'enter\'</span><span class="token punctuation">,</span> <span class="token comment">// 默认值</span>\n         create_by<span class="token punctuation">:</span> <span class="token string">\'当前登录用户或者不传根据 cookie 来判断用户\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         <span class="token function-variable function">dispatch</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'tracking\'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token comment">// 不是正式环境不上传埋点数据</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token function">sendReport</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token operator">&lt;</span>Track<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Track<span class="token operator">></span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="后端"><a href="#%E5%90%8E%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后端</h2>\n<p>数据库表 web_track 记录了以下字段</p>\n<ol>\n<li>用户(create_by)</li>\n<li>访问信息(location)</li>\n<li>对应页面(page)</li>\n<li>对应功能(function)</li>\n<li>埋点类型(type，目前有 enter/click 两类，对应进入页面/事件点击)</li>\n</ol>\n<h1 id="使用方式"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方式</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88998040554921900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { useTracking } from \'react-tracking\';\n\n// 在函数组件使用，进入页面触发专用\nuseTracking({ page: \'human_driver_compare\' }, { dispatchOnMount: true });\n\n// 在函数组件使用，事件触发专用\nconst { trackEvent, Track } = useTracking({ page: \'job_detail\' });\n// 这里使用 Track 高阶组件包裹之后，孙子组件调用 trackEvent 时候就会合并父级 data（当然这里的 trackEvent 触发也会合并），即孙子组件不需要在重复 page: \'job_detail\'，默认 type 为 enter\nreturn <Track>{children}</Track>;\n\n// 在类组件中使用，装饰器装饰之后 props 就带有 tracking 属性\n@track()\nexport default class Statistic extends React.Component {\n   handleShowSummaryClick = (e) => {\n      const { checked } = e.target;\n      this.setState({ show_summary: checked });\n      if (checked) {\n         // 事件触发\n         this.props.tracking.trackEvent({ function: \'show_summary\', type: \'click\' });\n      }\n   };\n\n   // 点击事件触发，即调用这个函数就触发，注意和上面的触发逻辑不同\n   @track({ function: \'show_summary\', type: \'click\' })\n   handleShowSummaryClick = (e) => {\n      const { checked } = e.target;\n      this.setState({ show_summary: checked });\n   };\n}`, `88998040554921900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> useTracking <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-tracking\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在函数组件使用，进入页面触发专用</span>\n<span class="token function">useTracking</span><span class="token punctuation">(</span><span class="token punctuation">{</span> page<span class="token punctuation">:</span> <span class="token string">\'human_driver_compare\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> dispatchOnMount<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在函数组件使用，事件触发专用</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> trackEvent<span class="token punctuation">,</span> Track <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTracking</span><span class="token punctuation">(</span><span class="token punctuation">{</span> page<span class="token punctuation">:</span> <span class="token string">\'job_detail\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 这里使用 Track 高阶组件包裹之后，孙子组件调用 trackEvent 时候就会合并父级 data（当然这里的 trackEvent 触发也会合并），即孙子组件不需要在重复 page: \'job_detail\'，默认 type 为 enter</span>\n<span class="token keyword">return</span> <span class="token operator">&lt;</span>Track<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Track<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在类组件中使用，装饰器装饰之后 props 就带有 tracking 属性</span>\n@<span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Statistic</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n   <span class="token function-variable function">handleShowSummaryClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> checked <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> show_summary<span class="token punctuation">:</span> checked <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// 事件触发</span>\n         <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>tracking<span class="token punctuation">.</span><span class="token function">trackEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">function</span><span class="token punctuation">:</span> <span class="token string">\'show_summary\'</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">\'click\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 点击事件触发，即调用这个函数就触发，注意和上面的触发逻辑不同</span>\n   @<span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">function</span><span class="token punctuation">:</span> <span class="token string">\'show_summary\'</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">\'click\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n   <span class="token function-variable function">handleShowSummaryClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> checked <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> show_summary<span class="token punctuation">:</span> checked <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>之后使用 redash 读取 mongo 数据库进行统计</p>',excerpt:"背景 统计线上用户各个功能的使用情况，以便后续针对性的优化 实现 前端 使用  https://github.com/nytimes/react-tracking  三方库埋点 使用 sendBeacon 异步发送埋点信息 埋点信息默认发送 location，type…",frontmatter:{date:"2025-10-27 11:17:30",path:"/react-frontend-tracking-selection/",tags:"前端, 埋点, 预研",title:"React 前端埋点选型",draft:null}},prePost:null},pathContext:{mainPostPath:"/frontend-multi-platform-page-adaptation/",nextPostPath:"/react-frontend-tracking-selection/",prePostPath:"none"}}}});