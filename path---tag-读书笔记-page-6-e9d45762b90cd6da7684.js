webpackJsonp([29302078007607],{1620:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"概述 CSS3 出现的历史和背景 CSS2.1 中的 CSS 属性的设计初衷是展示图文。因为在 CSS2.1 时代，互联网刚刚兴起，计算机硬件、网络带宽等基础设施都比较薄弱。例如： 屏幕像素低，所以丰富的色彩和细腻的图形细节无法呈现； 硬件性能差，所以动画和滤镜渲染效果不佳； 网络速度慢，所以高清大图和视频加载不出来。 迫于当时的环境，Web 页面只能显示图文内容，而图文内容的显示并不需要特别复杂的布局。所以，严格来说，CSS2.1 并没有专门的与布局相关的 CSS 属性 而 js…",html:'<h1 id="概述"><a href="#%E6%A6%82%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>概述</h1>\n<h2 id="css3-出现的历史和背景"><a href="#css3-%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%86%E5%8F%B2%E5%92%8C%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS3 出现的历史和背景</h2>\n<p>CSS2.1 中的 CSS 属性的设计初衷是展示图文。因为在 CSS2.1 时代，互联网刚刚兴起，计算机硬件、网络带宽等基础设施都比较薄弱。例如：</p>\n<ul>\n<li>屏幕像素低，所以丰富的色彩和细腻的图形细节无法呈现；</li>\n<li>硬件性能差，所以动画和滤镜渲染效果不佳；</li>\n<li>网络速度慢，所以高清大图和视频加载不出来。</li>\n</ul>\n<p>迫于当时的环境，Web 页面只能显示图文内容，而图文内容的显示并不需要特别复杂的布局。所以，严格来说，CSS2.1 并没有专门的与布局相关的 CSS 属性</p>\n<p>而 js 方面由于 Ajax 技术的兴起导致交互、布局越来越复杂，但 css 没有跟着进步，只能尽可能的挖掘 css 的潜力。于是会有很多当初看起来很奇怪的用法，如 float 属性，明明设计这个 CSS 属性的初衷是实现简单的文字环绕效果，结果最后这个 CSS 属性居然成了实现网站布局的中流砥柱。</p>\n<p>因此扩展 CSS2.1 的功能势在必行，于是有了后来的 CSS3。很具有代表性的例子就是环境变量函数 env()。这个函数的出现是因为 iPhone X 等设备顶部的“刘海儿”和底部的触摸横条会和页面内容冲突，所以需要 env() 函数给网页设置安全距离。</p>\n<p>又比如说 CSS 布局，Multi-column 多栏布局的第一版规范居然是在 1999 年 6 月制定的，比弹性布局早了整整 10 年。我们仅从规范制定的时间就可以推断 Multi-column 多栏布局和 CSS 中的 float 属性一样，它们都是为图文排版布局服务的，因为 1999 年的时候复杂布局还不是强需求，图文内容展示才是主要的用户需求。</p>\n<p>根据应用场景的类型将 CSS 新特性划分为下面 4 个方向</p>\n<ul>\n<li>更复杂、更具弹性的布局的支持，如弹性布局、网格布局等；</li>\n<li>更丰富的视觉表现的支持，如圆角、盒阴影、动画和渐变等；</li>\n<li>更多样的浏览设备的支持，如 CSS Media Queries 媒体查询等；</li>\n<li>开发者 CSS 自定义能力的支持，如 CSS Houdini 等。</li>\n</ul>\n<p>下面再说一说 CSS 新特性的另外一个特点，那就是语法更加复杂，但是理解更加简单。在 CSS2.1 的世界中，很多 CSS 属性虽然语法很简单，但是要理解渲染出来的样式表现，可是要花费大功夫的。除盒模型、块级格式化上下文、包含块等 CSS 特有的概念增加了学习成本之外，更重要的是下面两个原因。</p>\n<ol>\n<li>CSS2.1 中 CSS 属性主要为图文排版服务，而图文排版是有一定难度的，更不用说是在英语框架体系下的排版设计了。这就导致中文开发者无法轻松理解一些样式表现，例如图文元素默认的基线对齐，这个“基线”就是英语中特有的概念。</li>\n<li>CSS 属性用在了远离设计本意的场景中。例如之前提到的 Float 布局，很多人都不明白为什么容器元素的高度会塌陷，这是因为 CSS 的 float 属性的设计初衷本来就不包括将该属性用在模块布局上。</li>\n</ol>\n<p>CSS 新特性则不一样，其语法设计非常明确，布局相关的 CSS 特性就用来布局，视觉表现相关的 CSS 特性就用来实现视觉效果，背后没有其他看不见的 CSS 特性互相干涉。只要记住了语法，就不会出现意料之外的渲染场景。</p>\n<p>但是，这并不表示学习 CSS 新特性就很容易，因为简洁明了的语法是牺牲 CSS 属性的数量换来的，也就是理解成本降低了，但是记忆的成本提高了。例如，网格布局中共有 27 个完全不同的 CSS 属性，其中还有网格布局专用的 CSS 函数和单位，想要学透网格布局是要下苦功的。</p>\n<p>最后，总结一下，CSS 新特性是跟随时代发展而产生的，旨在构建更加丰富的 Web 应用程序。CSS 新特性分工很细，这带来的好处是让语法理解起来更简单，但是这些 CSS 特性属性种类更复杂，我们需要记住很多 CSS 特性，本书会详细介绍的 CSS 特性就不止 100 个。</p>\n<h2 id="模块化的-css-新世界"><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84-css-%E6%96%B0%E4%B8%96%E7%95%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块化的 CSS 新世界</h2>\n<p>CSS 世界已经有了 CSS2 和 CSS3，那会有 CSS4 吗？</p>\n<p>答案是：不会有 CSS4！实际上，现在连 CSS3 这个词都已经名存实亡了，因为 CSS3 已经解体了。</p>\n<p>为什么说 CSS3 解体了呢？</p>\n<p>因为 CSS 按照大版本的方式进行迭代实在是太低效了。低效的原因其实很好理解，如果 CSS 这门语言必须按照大版本迭代发布的话，只要其中一个版本有一个 CSS 特性存在极大的争议，那这个版本的 CSS 的发布时间就会延后。例如，CSS2.1 的规范在 2002 年开始制定，而一直到 2011 年才成为推荐规范，整个过程足足花费了 10 年的时间，就是因为一些次要的 CSS 特性拖了后腿。</p>\n<p>在 Web 前端领域，新技术的发展十分迅速，而 CSS 的规范又是基于当前环境制定的。如果 CSS 的规范从开始制定到最终浏览器完全支持需要横跨很多年，保不准这个 CSS 新特性很快就过时了，或者开发者都约定俗成使用其他方案替代实现了，那之前辛苦做的工作就白费了。CSS 这门语言的竞争力和潜力也会因此下降，因为不能快速响应时代变化的语言不是一门好语言。</p>\n<p>为了加速没有争议的 CSS 特性的标准化，W3C 的 CSS 工作组做出了一项被称为“Beijing doctrine”的决定，该决定将 CSS 划分为更小的组件，并把这些组件称为模块。这些模块互相独立，各自按照自己的速度走向标准化。例如，CSS 选择器模块已经到了 Level 4 了，弹性布局模块还是 Level 1。</p>\n<p>将 CSS 划分为独立的模块是一个非常明智的决定，浏览器厂商可以根据对自己需求的判断决定究竟对哪些模块进行支持，哪怕这个模块还处于草案状态。例如 CSS 的 env() 函数的规范还是草案状态，但是 Chrome 和 Safari 浏览器的厂商却快速响应，对其进行了支持。对开发者而言，如此迅速地支持新特性犹如一场及时雨。</p>\n<p>近几年，浏览器陆续支持一个又一个新的 CSS 特性，这已经成为一种常态。得益于 CSS 这种模块化的划分，以及浏览器厂商的积极支持，我们可以非常及时地使用这些 CSS 新特性来让我们的 Web 应用程序变得更丰富多彩，毕竟有很多内部的项目是不需要考虑兼容性问题的。</p>\n<p>当然，这种模块化的设计也不是没有弊端，最大的问题就是设计冗余。例如，弹性布局和网格布局中的对齐属性其实可以统一，但它们却是分离的，这就会徒增学习成本；分栏布局、弹性布局和网格布局中的间隙其实可以统一，但它们也都是分离的，各有各的间隙属性。好在纠正及时，现在这三大布局全部开始改用 gap 属性表示间隙，减少了因为模块化带来的设计冗余。</p>\n<p>模块化策略带来的好处远远大于弊端，正所谓瑕不掩瑜，与带来的好处相比，模块化设计的弊端几乎可以忽略不计。从这个角度看，CSS2.1 之后的 CSS 世界就是模块化的新世界，所以我称之为 CSS 新世界。这个 CSS 新世界带来了新的 CSS 属性，并让很多 CSS2 中模糊的概念有了明确的定义，如尺寸体系、逻辑属性、CSS 值类型划分等。CSS 新世界中各模块虽然发展独立，但是相互间还是有很多共性和联系的。因此，CSS 新世界不仅是一个模块化的世界，还是一个缤纷多彩，同时又自成一体的严谨的世界。</p>\n<p>最后，本书和《CSS 世界》相互补充，《CSS 世界》中讲解的都是 CSS2.1 的知识，本书讲解的都是 CSS2.1 之后的知识，再加上《CSS 选择器世界》，这 3 本书中的内容一起构成 CSS 这门语言的完整面貌。</p>\n<h1 id="需要提前了解的知识"><a href="#%E9%9C%80%E8%A6%81%E6%8F%90%E5%89%8D%E4%BA%86%E8%A7%A3%E7%9A%84%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需要提前了解的知识</h1>\n<p>本章主要介绍 CSS 数据类型、CSS 属性值定义语法和 CSS 全局关键字属性值。这些知识适用于任何 CSS 属性</p>\n<h2 id="互通互联的-css-数据类型"><a href="#%E4%BA%92%E9%80%9A%E4%BA%92%E8%81%94%E7%9A%84-css-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>互通互联的 CSS 数据类型</h2>\n<p>CSS 数据类型定义的是 CSS 属性中具有代表性的值，在规范的语法格式中，使用关键字外加一对尖括号（“&#x3C;”和“>”）表示，例如数值类型是 <code class="language-text">&lt;number&gt;</code>、色值类型是 <code class="language-text">&lt;color&gt;</code> 等。</p>\n<p>掌握 CSS 数据类型对了解 CSS 新世界的体系和快速学习 CSS 新特性非常有帮助。</p>\n<h3 id="为什么要关注-css-数据类型"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%85%B3%E6%B3%A8-css-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么要关注 CSS 数据类型</h3>\n<p>任何 CSS 属性值一定包含一个或多个数据类型。</p>\n<p>在 CSS2 时代，CSS 数据类型的概念并不怎么重要，因为常用的 CSS 属性翻来覆去就那几个，这些 CSS 属性支持的属性值我们反复使用就记住了。但是在 CSS 新世界中，由于各个 CSS 模块独立发展，没有统一的大版本进行约束，因此 CSS 的发展和变化非常快，这导致短时间内大量的 CSS 新属性如雨后春笋般涌现。</p>\n<p>如果此时还和过去一样，只是凭借经验去学习 CSS 新特性，那么学习起来肯定是十分困难的，因为效率比较低下。此时 CSS 数据类型的价值就体现出来了，当 CSS 新属性出现的时候，我们无须记忆数量众多的属性值名称，只需要记住支持的数据类型即可，这样学习成本就大大降低了。</p>\n<p>举一个例子，background-image 是使用频率非常高的一个 CSS 属性，这个 CSS 属性的语法结构是下面这样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53099195989743755000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`background-image: none | <image>;`, `53099195989743755000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">background-image</span><span class="token punctuation">:</span> none | &lt;image><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这个语法中出现的 <code class="language-text">&lt;image&gt;</code> 就是一种数据类型，它包括下面这些类型和函数：</p>\n<ul>\n<li><code class="language-text">&lt;url&gt;</code>；</li>\n<li><code class="language-text">&lt;gradient&gt;</code>；</li>\n<li>element()；</li>\n<li>image()；</li>\n<li>image-set()；</li>\n<li>cross-fade()。</li>\n</ul>\n<p>也就是说，CSS 的 background-image 属性不仅支持 url() 函数和渐变图像，还支持 element()、image()、image-set() 和 cross-fade() 等函数。</p>\n<p>通过上面这段描述大家已经知道了 background-image 属性原来支持这么多种类型的属性值，那么请问，CSS 的 mask-image 属性支持的属性值都有哪些呢？</p>\n<p>这么突然一问，想必大家一时也想不出准确的答案，毕竟见得少、用得少，这么细节的知识哪能知道呢？没关系，我们看一看 mask-image 属性的语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34967049375798686000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mask-image: none | <image> | <mask-source>;`, `34967049375798686000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">mask-image</span><span class="token punctuation">:</span> none | &lt;image> | &lt;mask-source><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这个语法中出现了 <code class="language-text">&lt;image&gt;</code> 数据类型！这下就豁然开朗了，这个 <code class="language-text">&lt;image&gt;</code> 不就是 background-image 语法中的 <code class="language-text">&lt;image&gt;</code> 吗？没错，两者是一样的。也就是说，mask-image 属性不仅支持 url() 函数和渐变图像，还支持 element()、image()、image-set() 和 cross-fade() 等函数。这样 CSS 的 mask-image 属性的语法就学会了一半，真是高效！</p>\n<p>由于 CSS 属性值包含的 CSS 数据类型都是互通互联的，因此，CSS 数据类型只要学习一次，就可以广泛运用，这样要比根据经验记忆几个片面的 CSS 属性值实用多了。</p>\n<p>CSS 数据类型除了可以帮助我们快速掌握 CSS 的语法，还能快速更新整个 CSS 世界的知识库。例如上面介绍的 <code class="language-text">&lt;image&gt;</code> 数据类型中，我还故意漏了一个新成员，那就是 paint() 函数，它是 CSS Paint API 带来的新成员，相关规范在 2016 年才开始制定。</p>\n<p>如果你是通过记住具体的 CSS 属性值来学习 CSS，那么你应该会知道 background-image 属性支持 paint() 函数，因为几乎所有 CSS Paint API 案例都是用 background-image 属性来举例的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53971549749383250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   background-image: paint(some-ident);\n}`, `53971549749383250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">paint</span><span class="token punctuation">(</span>some-ident<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>不过要是此时问你 mask-image 属性是否支持 paint() 函数，由于你大脑中的记忆库里没有相关信息的储备，因此你会疑惑，会不确定，会想要重新去翻阅资料学习，甚至还会做个演示案例确认一下。</p>\n<p>如果你记忆的是 <code class="language-text">&lt;image&gt;</code> 数据类型，再问你 mask-image 属性是否支持 paint() 函数，你肯定会毫不犹豫地回复支持，因为 mask-image 属性值支持 <code class="language-text">&lt;image&gt;</code> 数据类型，而 paint() 函数就属于 <code class="language-text">&lt;image&gt;</code> 数据类型。</p>\n<p>不仅是 mask-image 属性，CSS 新世界中还有很多支持 <code class="language-text">&lt;image&gt;</code> 数据类型的 CSS 属性，以及以后会支持 <code class="language-text">&lt;image&gt;</code> 数据类型的 CSS 属性都会同步更新 paint() 函数这个新特性。因此，大家一定要关注 CSS 数据类型，这可以让我们学习 CSS 新特性更迅速，理解 CSS 新特性更轻松。</p>\n<h3 id="几个常见数据类型的简单介绍"><a href="#%E5%87%A0%E4%B8%AA%E5%B8%B8%E8%A7%81%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>几个常见数据类型的简单介绍</h3>\n<p>CSS 数据类型非常多，保守估计，至少有 50 个，这里介绍几个常见且值得一提的数据类型。</p>\n<p>CSS Shapes 布局中有一个名为 shape-outside 的属性，我们不用关心这个 CSS 属性的含义，只看这个 CSS 属性的语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16037510817397215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`shape-outside: none | <shape-box> || <basic-shape> | <image>;`, `16037510817397215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">shape-outside</span><span class="token punctuation">:</span> none | &lt;shape-box> || &lt;basic-shape> | &lt;image><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这里出现了 3 种不同的数据类型，下面分别介绍一下。</p>\n<ol>\n<li>\n<p><code class="language-text">&lt;shape-box&gt;</code> 支持的属性值如下：</p>\n<ul>\n<li><code class="language-text">&lt;box&gt;</code>；</li>\n<li>margin-box。</li>\n</ul>\n<p>在 CSS 世界中，需要用到 margin-box 的属性并不多，shape-outside 属性就是一个特例。虽然 <code class="language-text">&lt;shape-box&gt;</code> 数据类型并不常用，但是 <code class="language-text">&lt;box&gt;</code> 数据类型却很常见，<code class="language-text">&lt;box&gt;</code> 数据类型包括下面这些属性值：</p>\n<ul>\n<li>content-box；</li>\n<li>padding-box；</li>\n<li>border-box。</li>\n</ul>\n<p>background-origin 和 background-clip 等 CSS 属性的属性值就是 <code class="language-text">&lt;box&gt;</code> 数据类型。</p>\n</li>\n<li>\n<p><code class="language-text">&lt;basic-shape&gt;</code> 支持的属性值如下：</p>\n<ul>\n<li>inset()；</li>\n<li>circle()；</li>\n<li>ellipse()；</li>\n<li>polygon()；</li>\n<li>path()。</li>\n</ul>\n<p>clip-path 和 offset-path 等 CSS 属性的属性值属于 <code class="language-text">&lt;basic-shape&gt;</code>数据类型。</p>\n</li>\n<li>\n<p><code class="language-text">&lt;image&gt;</code> 支持的属性值如下：</p>\n<ul>\n<li><code class="language-text">&lt;url&gt;</code>；</li>\n<li><code class="language-text">&lt;gradient&gt;</code>；</li>\n<li>element()；</li>\n<li>image()；</li>\n<li>image-set()；</li>\n<li>cross-fade()；</li>\n<li>paint()。</li>\n</ul>\n<p>上述属性值中 <code class="language-text">&lt;url&gt;</code> 也是一种数据类型，用于表示使用 url() 函数调用的图像资源；<code class="language-text">&lt;gradient&gt;</code> 也是一种数据类型，用于表示渐变图像。</p>\n<p>background-image 和 mask-image 等 CSS 属性的属性值属于 <code class="language-text">&lt;image&gt;</code> 数据类型。</p>\n</li>\n</ol>\n<p>从上面的介绍可以看出，CSS 的 shape-outside 支持的属性值非常庞杂，不过只要牢记这 3 个数据类型，就可以轻松记住很多属性值，至于其中的每一个属性值究竟有什么含义，在这里不展开讲解，之后会有详细的阐述。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="279201567701647940"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`color: <color>;`, `279201567701647940`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">color</span><span class="token punctuation">:</span> &lt;color><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这里的 <code class="language-text">&lt;color&gt;</code> 数据类型支持的属性值如下：</p>\n<ul>\n<li><code class="language-text">&lt;rgb()&gt;</code>；</li>\n<li><code class="language-text">&lt;rgba()&gt;</code>；</li>\n<li><code class="language-text">&lt;hsl()&gt;</code>；</li>\n<li><code class="language-text">&lt;hsla()&gt;</code>；</li>\n<li><code class="language-text">&lt;hex-color&gt;</code>；</li>\n<li><code class="language-text">&lt;named-color&gt;</code>；</li>\n<li>currentColor；</li>\n<li><code class="language-text">&lt;deprecated-system-color&gt;</code>。</li>\n</ul>\n<p>最后一个属性值 <code class="language-text">&lt;deprecated-system-color&gt;</code> 指废弃的系统颜色，这在《CSS 世界》有专门的介绍，本书不再赘述，其他属性值在对应章节都会有详细的讲解。</p>\n<p>以上就是我要简单介绍的几个常见且值得一提的数据类型。至于其他数据类型，要么比较简单，例如 <code class="language-text">&lt;number&gt;</code>、<code class="language-text">&lt;percent&gt;</code> 等数据类型，指数值和百分比值；要么比较生僻且唯一，例如 <code class="language-text">&lt;quote&gt;</code> 数据类型，指 content 属性中表示各类引号的关键字值，如 open-quote 和 close-quote 等。</p>\n<p>本书不会逐个展开介绍 CSS 数据类型，想要了解更完整的 CSS 数据类型，可以参考的一篇文章 <a href="https://www.zhangxinxu.com/wordpress/2019/11/css-value-type/" target="_blank" rel="nofollow noreferrer noopener">CSS 值类型文档大全</a>。</p>\n<h2 id="学会看懂-css-属性值定义语法"><a href="#%E5%AD%A6%E4%BC%9A%E7%9C%8B%E6%87%82-css-%E5%B1%9E%E6%80%A7%E5%80%BC%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>学会看懂 CSS 属性值定义语法</h2>\n<p>CSS 属性值有专门的定义语法，用来表示 CSS 属性值的合法组成。例如，线性渐变的语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39263229526707000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradinent([<angle> | to <side-or-corner>,]?<color-stop-list>)`, `39263229526707000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradinent</span><span class="token punctuation">(</span>[&lt;angle> | to &lt;side-or-corner><span class="token punctuation">,</span>]?&lt;color-stop-list><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="学习-css-属性值定义语法的好处"><a href="#%E5%AD%A6%E4%B9%A0-css-%E5%B1%9E%E6%80%A7%E5%80%BC%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95%E7%9A%84%E5%A5%BD%E5%A4%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>学习 CSS 属性值定义语法的好处</h3>\n<p>在开始介绍具体的语法规则之前，我想先说说我们为什么要学会看懂 CSS 属性值定义语法（CSS value definition syntax）。就拿线性渐变的语法举例，根据我的观察，几乎无一例外，CSS 开发者会写出类似下面这样的 CSS 线性渐变代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55206588376196320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`background: linear-gradient(to bottom, deepskyblue, deeppink);`, `55206588376196320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to bottom<span class="token punctuation">,</span> deepskyblue<span class="token punctuation">,</span> deeppink<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>上面这句 CSS 声明有问题吗？从语法和功能上讲是没有任何问题的，线性渐变可以正常渲染，但是在写法上却有瑕疵，<code class="language-text">to bottom,</code> 这几个字符是多余的。我们直接使用下面这样的书写方式就可以了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4763416953175081000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`background: linear-gradient(deepskyblue, deeppink);`, `4763416953175081000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>deepskyblue<span class="token punctuation">,</span> deeppink<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果你看得懂 CSS 的语法，那么在学习 CSS 的时候，只要稍微看一看线性渐变的语法，就能很轻松地知道 <code class="language-text">线性渐变的方向设置是可以省略的</code> 这样一个细节知识，也就能写出更简洁的 CSS 代码。</p>\n<p>这就是看懂 CSS 属性值定义语法的好处：不仅有助于快速了解 CSS 新属性，还有助于发现别人注意不到的细节知识，而这些细节知识就是你的竞争力所在，也是从众多 CSS 开发者中脱颖而出的重要因素之一。</p>\n<h3 id="css-属性值定义语法详解"><a href="#css-%E5%B1%9E%E6%80%A7%E5%80%BC%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 属性值定义语法详解</h3>\n<p>CSS 属性值定义语法是专门用来限定 CSS 属性合法取值的语法，这种语法包含以下 3 种基本组成元素：</p>\n<ul>\n<li>关键字；</li>\n<li>数据类型；</li>\n<li>符号。</li>\n</ul>\n<p>线性渐变的语法就包含上面这 3 种基本组成元素：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87391422828425250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradinent([<angle> | to <side-or-corner>,]?<color-stop-list>)`, `87391422828425250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradinent</span><span class="token punctuation">(</span>[&lt;angle> | to &lt;side-or-corner><span class="token punctuation">,</span>]?&lt;color-stop-list><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点：</p>\n<ul>\n<li>to 是关键字；</li>\n<li><code class="language-text">&lt;angle&gt;</code>、<code class="language-text">&lt;side-or-corner&gt;</code> 和 <code class="language-text">&lt;color-stop-list&gt;</code> 是数据类型，如果对这几个数据类型不了解，可以参考文章 <a href="https://www.zhangxinxu.com/wordpress/2019/11/css-value-type/" target="_blank" rel="nofollow noreferrer noopener">CSS 值类型文档大全</a>；</li>\n<li><code class="language-text">[]</code> <code class="language-text">?</code> <code class="language-text">,</code> 是符号。</li>\n</ul>\n<p>下面稍微展开介绍一下这 3 种基本组成元素。</p>\n<h4 id="关键字"><a href="#%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关键字</h4>\n<p>关键字分为通用关键字和全局关键字：</p>\n<ul>\n<li>auto、none、ease 等关键字是通用关键字，或者可以称为普通关键字，这些关键字均只被部分 CSS 属性支持；</li>\n<li>inherit、initial、unset 和 revert 是全局关键字，属于被所有 CSS 属性支持的特殊关键字，全局关键字在 2.3 节会介绍，这里不展开。</li>\n</ul>\n<h4 id="数据类型"><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据类型</h4>\n<p>数据类型外面有一对尖括号（“&#x3C;”和“>”）。有些数据类型是 CSS 规范中专门定义的，它们被称为基本类型，其他数据类型就被称为其他类型。</p>\n<h4 id="符号"><a href="#%E7%AC%A6%E5%8F%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>符号</h4>\n<p>符号是 CSS 语法中的重点和难点。</p>\n<p>CSS 语法中的符号分为字面符号、组合符号和数量符号这 3 类，下面就介绍一下它们对应的含义。</p>\n<ol>\n<li>字面符号指的是 CSS 属性值中原本就支持的合法符号，这些符号在 CSS 语法中会按照其原本的字面意义呈现。目前字面符号就两个，一个是逗号（,），另一个是斜杠（/）。具体描述如表 2-1 所示。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th align="left">符号</th>\n<th align="left">名称</th>\n<th align="left">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">,</td>\n<td align="left">并列分隔符</td>\n<td align="left">用来分隔多个并列值，或者分隔函数的参数值</td>\n</tr>\n<tr>\n<td align="left">/</td>\n<td align="left">缩写分隔符</td>\n<td align="left">用来分隔一个值的多个部分，在 CSS 缩写中用于分离类型相同但属于不同 CSS 属性的值，以及用在部分 CSS 函数中</td>\n</tr>\n</tbody>\n</table>\n<ol start="2">\n<li>组合符号用来表示数个基本元素之间的组合关系。目前共有 5 个组合符号，其中大多数组合符号的含义一目了然，除了“|”这个组合符号。因为“|”表示互斥，这在编程语言中比较少见，大家可以特别关注一下。具体描述如表 2-2 所示（表中从上往下组合符号的优先级越来越高）。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th align="left">符号</th>\n<th align="left">名称</th>\n<th align="left">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"></td>\n<td align="left">并列</td>\n<td align="left">符号为普通空格字符，表示各部分必须出现，同时需要按顺序出现</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">&amp;&amp;</code></td>\n<td align="left">“与”组合符</td>\n<td align="left">各部分必须出现，且可以不按顺序出现</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">||</code></td>\n<td align="left">“或”组合符</td>\n<td align="left">各部分至少出现一个，可以不按顺序出现</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">|</code></td>\n<td align="left">“互斥”组合符</td>\n<td align="left">各部分恰好出现其中一个</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">[]</code></td>\n<td align="left">方括号</td>\n<td align="left">将各部分进行分组以绕过上面几个符号的优先规则，因此方括号的优先级最高</td>\n</tr>\n</tbody>\n</table>\n<ol start="3">\n<li>数量符号用来描述一个元素可以出现多少次，数量符号不能叠加出现，并且优先级高于组合符号。目前共有 6 个数量符号，大多数的数量符号的含义和在正则表达式中的含义是一样的，具体描述如表 2-3 所示。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th align="left">符号</th>\n<th align="left">名称</th>\n<th align="left">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"></td>\n<td align="left">无数量符号</td>\n<td align="left">恰好出现一次</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">*</code></td>\n<td align="left">星号</td>\n<td align="left">可以出现任意次数</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">+</code></td>\n<td align="left">加号</td>\n<td align="left">可以出现一次或多次</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">?</code></td>\n<td align="left">问号</td>\n<td align="left">可以出现零次或一次，即为可选</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">{A,B}</code></td>\n<td align="left">花括号</td>\n<td align="left">出现最少 A 次，最多 B 次</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">#</code></td>\n<td align="left">井号</td>\n<td align="left">可以出现一次或多次，但多次出现时必须以逗号分隔</td>\n</tr>\n<tr>\n<td align="left"><code class="language-text">!</code></td>\n<td align="left">叹号</td>\n<td align="left">表示当前分组必须产生一个值，该符号多出现在组合符号方括号的后面</td>\n</tr>\n</tbody>\n</table>\n<p>有了表 2-1 ～ 表 2-3，理解 CSS 属性值定义语法就变得很容易了。例如，线性渐变的语法解析如图 2-1 的标注说明所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-20-11-41-27-dd83164e308efdd6b3a9ae0db1a86a01-889e2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.71376370280146%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA/UlEQVQY011Qi06DMBTl/7/MMRA3o0tMliwkOsbKo9y2t719WRCM8+Q07X333CzGsDEGo/04hmly7c0DxBlrKHpvLxc6Hv2tWdw+nSz+BZkoRZDgr19B6yVpqRTgm2tqGn+cGzIy2iRqRFTWWnJOE9EwOEtk0ovmGzX1A9X1YlsyJjH5Mz70fOz7ru1YK4WASQyMo1SIcuICuFAS+aTkyLFlvP5MCQAKBCrUj99eRcaHRZAJfHTn8yzE2dA0gd1jx0LfZUnVL7bKf918kNLfWbR2tqTyaQWQKNbJ616k3OUlon4/fTzlxS4v9mVVPB+K6lC9vu3LFwCxJK8zvgHNEZP2YA/V3gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 20 11 41 27" title="" data-src="/static/2021-12-20-11-41-27-dd83164e308efdd6b3a9ae0db1a86a01-fee1c.png" data-srcset="/static/2021-12-20-11-41-27-dd83164e308efdd6b3a9ae0db1a86a01-a67b7.png 200w,\n/static/2021-12-20-11-41-27-dd83164e308efdd6b3a9ae0db1a86a01-0b187.png 400w,\n/static/2021-12-20-11-41-27-dd83164e308efdd6b3a9ae0db1a86a01-fee1c.png 800w,\n/static/2021-12-20-11-41-27-dd83164e308efdd6b3a9ae0db1a86a01-889e2.png 821w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>下面先讲一下语法中的元素。</p>\n<ul>\n<li>\n<p>逗号 <code class="language-text">,</code> 是字面符号，没有什么特殊的含义，只表示这里需要有一个逗号字符。要注意下面这种写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75628150187771670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 缺少逗号 */\nbackground: linear-gradient(0deg blue, pink);`, `75628150187771670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 缺少逗号 */</span>\n<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>0deg blue<span class="token punctuation">,</span> pink<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>空格是组合符号，表示并列，同时保证各部分按顺序出现。因此如果把 <code class="language-text">&lt;color-stop-list&gt;</code> 数据放前面，就不合法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94711362475353470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 顺序不对 */\nbackground: linear-gradient(blue, pink, 0deg);`, `94711362475353470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 顺序不对 */</span>\n<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>blue<span class="token punctuation">,</span> pink<span class="token punctuation">,</span> 0deg<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>“互斥”组合符 <code class="language-text">|</code> 表示角度和方位只能出现一个，两者不能同时存在</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21827841738655150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 角度与方位不能同时出现 */\nbackground: linear-gradient(0deg to top, blue, pink);`, `21827841738655150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 角度与方位不能同时出现 */</span>\n<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>0deg to top<span class="token punctuation">,</span> blue<span class="token punctuation">,</span> pink<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>方括号 <code class="language-text">[]</code> 用来分组，方便指定数量</p>\n</li>\n<li>\n<p>问号 <code class="language-text">?</code> 是数量符号，表示方括号框起来的元素可以出现零次或者一次，零次的意思就是这个元素可以不出现。因此，下面的写法是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59959181217855310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 角度或者方位最多出现一次 */\nbackground: linear-gradient(0deg, 0deg, blue, pink);`, `59959181217855310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 角度或者方位最多出现一次 */</span>\n<span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>0deg<span class="token punctuation">,</span> 0deg<span class="token punctuation">,</span> blue<span class="token punctuation">,</span> pink<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<p>综上分析，下面这些线性渐变语法都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60394170517553270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`linear-gradient(<color-stop-list>);\nlinear-gradient(<angle>, <color-stop-list>);\nlinear-gradient(to <side-or-corner>, <color-stop-list>);`, `60394170517553270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token function">linear-gradient</span><span class="token punctuation">(</span>&lt;color-stop-list><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>&lt;angle><span class="token punctuation">,</span> &lt;color-stop-list><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">linear-gradient</span><span class="token punctuation">(</span>to &lt;side-or-corner><span class="token punctuation">,</span> &lt;color-stop-list><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>接下来只要弄清楚 <code class="language-text">&lt;angle&gt;</code>、<code class="language-text">&lt;side-or-corner&gt;</code> 和 <code class="language-text">&lt;color-stop-list&gt;</code> 这几个数据类型的含义和语法，我们就可以理解线性渐变的语法了。相关内容在后面对应的章节会有非常详细且深入的介绍，这里不做展开。</p>\n<p>最后再通过一些案例介绍一下线性渐变语法之外的符号。</p>\n<h4 id="字面符号斜杠（）的详细介绍"><a href="#%E5%AD%97%E9%9D%A2%E7%AC%A6%E5%8F%B7%E6%96%9C%E6%9D%A0%EF%BC%88%EF%BC%89%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字面符号斜杠（/）的详细介绍</h4>\n<p>在 CSS 这门语言中，凡是出现斜杠（/）的地方，斜杠前后的数据类型一定是相同或者部分相同的，否则整个语句就是非法的。很多开发者总是记不住包含斜杠的 CSS 缩写语法，那么只要记住这个规则就可以了。</p>\n<p>例如，background 属性值中需要使用斜杠分隔的两个属性一定是 background-position 和 background-size，因为只有这两个属性的值的类型相似，且都可以使用百分比值表示。这样就会出现很有趣的现象，像下面这样的 CSS 语句是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30403044130817315000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nbackground: 0 / 0;`, `30403044130817315000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token property">background</span><span class="token punctuation">:</span> 0 / 0<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是下面这个看上去合法的缩写却是非法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2226097322572795400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\nbackground: #eee url(https://demo.png) no-repeat / contain;`, `2226097322572795400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">background</span><span class="token punctuation">:</span> #eee <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://demo.png<span class="token punctuation">)</span></span> no-repeat / contain<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>因为斜杠前面的值 no-repeat 属于 background-repeat 属性，斜杠后面的值 contain 属于 background-size 属性，而 background-repeat 的属性值的类型绝不可能和 background-size 的属性值的类型一致，这不符合斜杠前后数据类型至少部分相同的要求，所以这条语句是非法的。</p>\n<p>记住，background 缩写语法中斜杠前面只能是 background-position 的属性值，上面的 CSS 语句要想合法，可以把 background-position 属性的初始值 0 0 写上：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43015589975804500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nbackground: #eee url(https://demo.png) no-repeat 0 0 / contain;`, `43015589975804500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token property">background</span><span class="token punctuation">:</span> #eee <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>https://demo.png<span class="token punctuation">)</span></span> no-repeat 0 0 / contain<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>又如，font 属性的斜杠前后一定是 font-size 的属性值和 line-height 的属性值，因为两者都可以使用 px 长度单位值。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45724011036325800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n   font: 16px / 1.5 sans-serif;\n}`, `45724011036325800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> 16px / 1.5 sans-serif<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>斜杠这个符号除了出现在部分 CSS 的缩写语法中，还会出现在一些 CSS 函数中用来表示分隔，例如 rgba() 函数的语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78994086447524150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<rgba()> = rgba(<percentage>{3} [/<alpha-value>]?) | rgba(<number>{3} [/<alpha-value>]?) | rgba(<percentage>#{3}, <alpha-value>?) | rgba(<number>#{3}, <alpha-value>?)`, `78994086447524150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">&lt;rgba()> = rgba(&lt;percentage></span><span class="token punctuation">{</span>3<span class="token punctuation">}</span> <span class="token selector">[/&lt;alpha-value>]?) | rgba(&lt;number></span><span class="token punctuation">{</span>3<span class="token punctuation">}</span> <span class="token selector">[/&lt;alpha-value>]?) | rgba(&lt;percentage>#</span><span class="token punctuation">{</span>3<span class="token punctuation">}</span><span class="token selector">, &lt;alpha-value>?) | rgba(&lt;number>#</span><span class="token punctuation">{</span>3<span class="token punctuation">}</span><span class="token punctuation">,</span> &lt;alpha-value>?<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>从上面的语法我们可以看出 rgba() 函数也是支持斜杠的，因此，下面的属性值都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7259449360524250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\nrgba(100% 0% 0% / .5);\nrgba(255 0 0 / .5);`, `7259449360524250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token function">rgba</span><span class="token punctuation">(</span>100% 0% 0% / .5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">rgba</span><span class="token punctuation">(</span>255 0 0 / .5<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>类似 <code class="language-text">rgba() 函数支持斜杠语法</code> 这样的细节知识，如果不看语法是绝对不知道的。还是那句话，要想 CSS 学得好，CSS 属性值定义语法必须要学好，其重要性不亚于 JavaScript 中的正则表达式。</p>\n<h4 id="其他符号介绍"><a href="#%E5%85%B6%E4%BB%96%E7%AC%A6%E5%8F%B7%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他符号介绍</h4>\n<p>下面介绍其他符号。</p>\n<ol>\n<li>\n<p>“或”组合符（||）。“或”组合符（||）在 CSS 语法中很常见，例如 border 属性的语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99983671704164940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`border: <line-width> || <line-style> || <color>;`, `99983671704164940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">border</span><span class="token punctuation">:</span> &lt;line-width> || &lt;line-style> || &lt;color><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这一语法表示 border 属性的 3 个值的顺序是随机的，组合也是随机的。</p>\n</li>\n<li>\n<p>叹号（!）。叹号（!）在 image()函数中出现过：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58765201215233655000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<image()> = image(<image-tags>? [<image-src>?, <color>?]!)`, `58765201215233655000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css">&lt;<span class="token function">image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>> = <span class="token function">image</span><span class="token punctuation">(</span>&lt;image-tags>? [&lt;image-src>?<span class="token punctuation">,</span> &lt;color>?]!<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这一语法表示 <code class="language-text">&lt;image-src&gt;</code> 数据类型和 <code class="language-text">&lt;color&gt;</code> 数据类型至少出现一个，当然，两者也可以同时出现。</p>\n</li>\n<li>\n<p>其他数量符号和“与”组合符（&#x26;&#x26;）。到目前为止，还有井号（#）、星号（*）、花括号（{A,B}）等数量符号和“与”组合符（&#x26;&#x26;）没有介绍，这里用 box-shadow 属性的语法加以说明，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73741336533935090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`box-shadow: none | <shadow>#;`, `73741336533935090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">box-shadow</span><span class="token punctuation">:</span> none | &lt;shadow>#<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>等同于</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85990497569587630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`box-shadow: none | [<shadow>, ] *;`, `85990497569587630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">box-shadow</span><span class="token punctuation">:</span> none | [&lt;shadow><span class="token punctuation">,</span> ] *<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或可写成</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76390964772216880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`box-shadow: none | [inset? && <length>{2, 4} && <color>?]#;`, `76390964772216880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">box-shadow: none | [inset? &amp;&amp; &lt;length></span><span class="token punctuation">{</span>2<span class="token punctuation">,</span> 4<span class="token punctuation">}</span> &amp;&amp; &lt;color>?]#<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中出现的“与”组合符（&#x26;&#x26;），表明 inset 关键字、<code class="language-text">&lt;length&gt;</code> 数据类型和 <code class="language-text">&lt;color&gt;</code> 数据类型的顺序是可以随意排列的，所以下面这几种写法都是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61666401756101920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`box-shadow: 2px 2px inset #000;\nbox-shadow: inset #000 2px 2px;\nbox-shadow: #000 2px 2px inset;`, `61666401756101920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">box-shadow</span><span class="token punctuation">:</span> 2px 2px inset #000<span class="token punctuation">;</span>\n<span class="token property">box-shadow</span><span class="token punctuation">:</span> inset #000 2px 2px<span class="token punctuation">;</span>\n<span class="token property">box-shadow</span><span class="token punctuation">:</span> #000 2px 2px inset<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>其中 <code class="language-text">&lt;length&gt;{2,4}</code> 表示可以使用 2 ～ 4 个 <code class="language-text">&lt;length&gt;</code>数据类型，很好理解。</p>\n</li>\n</ol>\n<p>下面要抛出一个很有意思的问题了：既然 <code class="language-text">[&lt;shadow&gt;,]*</code> 等同于 <code class="language-text">&lt;shadow&gt;#</code>，那这个 # 符号是不是一个多余的设计呢？</p>\n<p>这不是多余的设计，虽然多了一个 # 符号就多了一点学习成本，但是语法更简洁了，更重要的是 # 符号有一个和其他数量符号不一样的特性，那就是 # 符号可以在后面指定数量范围。例如 rgba() 函数的语法中有下面这一段内容：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77666363845211210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`rgba(<number>#{3}, <alpha-value>?)`, `77666363845211210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">rgba(&lt;number>#</span><span class="token punctuation">{</span>3<span class="token punctuation">}</span><span class="token punctuation">,</span> &lt;alpha-value>?<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="了解-css-全局关键字属性值"><a href="#%E4%BA%86%E8%A7%A3-css-%E5%85%A8%E5%B1%80%E5%85%B3%E9%94%AE%E5%AD%97%E5%B1%9E%E6%80%A7%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 CSS 全局关键字属性值</h2>\n<p>inherit、initial、unset 和 revert 都是 CSS 全局关键字属性值，也就是说所有 CSS 属性都可以使用这几个关键字作为属性值。</p>\n<p>我根据实用性和兼容性整理了一个全局关键字属性值评价表，如表 2-4 所示。</p>\n<table>\n<thead>\n<tr>\n<th align="left">关键字属性值</th>\n<th align="left">使用性</th>\n<th align="left">兼容性</th>\n<th align="left">整体评价</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">inherit</td>\n<td align="left">A</td>\n<td align="left">A+</td>\n<td align="left">A+</td>\n</tr>\n<tr>\n<td align="left">initial</td>\n<td align="left">B</td>\n<td align="left">B+</td>\n<td align="left">B</td>\n</tr>\n<tr>\n<td align="left">unset</td>\n<td align="left">B-</td>\n<td align="left">B-</td>\n<td align="left">B-</td>\n</tr>\n<tr>\n<td align="left">revert</td>\n<td align="left">B</td>\n<td align="left">C</td>\n<td align="left">B-</td>\n</tr>\n</tbody>\n</table>\n<h3 id="用过都说好的继承关键字-inherit"><a href="#%E7%94%A8%E8%BF%87%E9%83%BD%E8%AF%B4%E5%A5%BD%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E9%94%AE%E5%AD%97-inherit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用过都说好的继承关键字 inherit</h3>\n<p>inherit 这个关键字是继承的意思。IE 浏览器从 IE8（标准版）开始就已经支持该关键字了，而不是从 IE9 浏览器开始支持的。请记住，不是从 IE9 开始支持的，网络上的某些在线文档是错误的。</p>\n<p>是一个实用性和兼容性俱佳的 CSS 属性值，例如我比较喜欢使用 inherit 关键字重置输入框的内置字体：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47894718665993130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`input,\ntextarea {\n   font-family: inherit;\n}`, `47894718665993130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">input,\ntextarea</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>又如，子元素设置 height: inherit 实现高度继承，或者子元素设置 background-image: inherit 实现背景图像继承等，这些都是非常实用的场景。</p>\n<p>大家一定要养成使用 inherit 关键字的好习惯，这可以有效地降低开发和维护成本，谁用谁说好。</p>\n<h3 id="可以一用的初始值关键字-initial"><a href="#%E5%8F%AF%E4%BB%A5%E4%B8%80%E7%94%A8%E7%9A%84%E5%88%9D%E5%A7%8B%E5%80%BC%E5%85%B3%E9%94%AE%E5%AD%97-initial" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可以一用的初始值关键字 initial</h3>\n<p>initial 是初始值关键字，可以把当前的 CSS 属性的计算值还原成 CSS 语法中规定的初始值。</p>\n<p>下面我们就通过一个简单的案例快速了解一下这个 CSS 关键字。</p>\n<p>例如，下面这段 HTML 表示的是一个热门话题列表：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15412062159028507000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<ul class=&quot;initial-ul&quot;>\n   <li>#追梦人# <small>1亿</small></li>\n   <li>#票房# <small>3亿</small></li>\n   <li>#醉拳舞# <small>1亿</small></li>\n   <li>#余年MV# <small>2亿</small></li>\n   <li>#CSS新世界# <small>666</small></li>\n</ul>`, `15412062159028507000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>initial-ul<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>#追梦人# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">></span></span>1亿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>#票房# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">></span></span>3亿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>#醉拳舞# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">></span></span>1亿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>#余年MV# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">></span></span>2亿<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>#CSS新世界# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>small</span><span class="token punctuation">></span></span>666<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>small</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后，我们给最后一行列表设置 font-size: initial，CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87917567607169470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.initial-ul {\n   font-size: 13px;\n}\n\n.initial-ul li:last-child {\n   font-size: initial;\n}`, `87917567607169470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.initial-ul</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.initial-ul li:last-child</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果如图 2-2 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-21-10-58-13-edf6c4d1389f5961af67ec8e5301f3ca-09bf7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 452px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.12389380530973%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABtUlEQVQoz51Ri27aMBT1/3/MpKkbKh0dFGk0JJDwKqGQhxMSmwDBcZLmQZxkLmxakRCVdmRZV+fec+6RDd444lASxG77yTSgu3bSNKvrOiS+hzdVfQuAa4OD3+08dVotZajkecFZx167LuZFVd2SgyRJQ0oUWX7+1e/8bIuCyBne4I7+fl9/tjmhxO8LwkAaCL3nsTIhfsAbMQ2wixgrz/uvRgBpmvq7rfqiGrqxVFVnjebzBWPvo1tvs98dboQHMUcU2pbtIWyZpqq+OtA2NG02VV3HLauyZCUNaBRFV8S73Y4SslqubNOaTSZDUR71lcFQ7rZ7EK75RJ5l0DCRi+pThn83F19YndjK35cIfRy6glMLVB9RlpxjYfgmSUeEWBzzOtP03LJzaCXyKFUX2VJL52rheUeEwXVfxgqECtctuT6g74fSwtseMeamvGAkYISAyyzVRf76E4D6P/D32cB5m4vQl6/fFq8r3TDz/DiezkRpOJBH9w+PjWbr4bHduP9x12j2+tLd9ybGm3PMP2JCAmU8jaI4SRLOUBqSIDiQYLnSNN3QTagbEEIbY88w4fnP+dhvsmIYREfVfgsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 21 10 58 13" title="" data-src="/static/2021-12-21-10-58-13-edf6c4d1389f5961af67ec8e5301f3ca-09bf7.png" data-srcset="/static/2021-12-21-10-58-13-edf6c4d1389f5961af67ec8e5301f3ca-eb2f6.png 200w,\n/static/2021-12-21-10-58-13-edf6c4d1389f5961af67ec8e5301f3ca-ffac0.png 400w,\n/static/2021-12-21-10-58-13-edf6c4d1389f5961af67ec8e5301f3ca-09bf7.png 452w" data-sizes="(max-width: 452px) 100vw, 452px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>从图 2-2 中可以看到最后一行 <code class="language-text">#CSS 新世界#</code> 这几个文字的字号明显比上面几行文字的字号大了一些。这是因为最后一个 <code class="language-text">&lt;li&gt;</code> 列表项设置了 <code class="language-text">font-size: initial</code>，这就意味着最后一个 <code class="language-text">&lt;li&gt;</code> 列表项的字号大小使用的是 CSS 规范中定义的初始值，这个初始值就是 medium 关键字。如果用户没有修改过浏览器中的默认字号设置，则 medium 关键字的计算值是 16px。</p>\n<p>因此在本案例中，前几行的字号大小是 13px，最后一项的字号大小是 16px。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/kmw97g?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>initial 关键字适合用在需要重置某些 CSS 样式，但又不记得初始值的场景。initial 关键字还可以帮助我们了解 CSS 属性的初始值。例如，display 属性的初始值是什么 MDN 文档就没有明说，那我们就可以设置 display: initial 看一下效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49848345272025040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p {\n   display: initial;\n}`, `49848345272025040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">{</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>结果 <code class="language-text">&lt;p&gt;</code> 元素垂直方向的 margin 和 text-indent 属性都失效了，这些失效现象是典型的内联元素特性，因此，display 属性的初始值是 inline。</p>\n<h4 id="可能的误区"><a href="#%E5%8F%AF%E8%83%BD%E7%9A%84%E8%AF%AF%E5%8C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可能的误区</h4>\n<p>很多人有这样一个误区：把 initial 关键字理解为浏览器设置的元素的初始值。实际上两者是不一样的。</p>\n<p>举个例子，实际开发的时候，<code class="language-text">&lt;ul&gt;</code> 元素或 <code class="language-text">&lt;ol&gt;</code> 元素默认的 list-style-type 样式会被 CSS 重置。但是可能会遇到这样的场景，即某些区域需要增加一些描述信息，因此需要重新使用 list-style-type 样式（小圆点或者数字），此时有些开发者就会使用 initial 关键字对该样式进行还原：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89286467245111310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ol {\n   padding: initial;\n   list-style-type: initial;\n}`, `89286467245111310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">ol</span> <span class="token punctuation">{</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>\n   <span class="token property">list-style-type</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是没有用！因为上面的 CSS 设置等同于下面的设置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36286887805660250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ol {\n   padding: 0;\n   list-style-type: disc;\n}`, `36286887805660250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">ol</span> <span class="token punctuation">{</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">list-style-type</span><span class="token punctuation">:</span> disc<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而不是预想的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="884166669950881000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ol {\n   padding: 0 0 0 40px;\n   list-style-type: decimal;\n}`, `884166669950881000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">ol</span> <span class="token punctuation">{</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> 0 0 0 40px<span class="token punctuation">;</span>\n   <span class="token property">list-style-type</span><span class="token punctuation">:</span> decimal<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时需要的全局关键字属性值其实是 revert，而不是 initial。</p>\n<h4 id="兼容性"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h4>\n<p>initial 关键字属性值的兼容性如表 2-5 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-21-11-08-59-b904ecc22879f2c812b4c1c6f8796924-42e87.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 30.359212050984937%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRUlEQVQY0w2LTU+DMABA+fcejRcvM94WT8aDMXrQGCfRxGUfsI2xD1Y+S1s+tkEpbYFVbi8v72lKKdcPESbncwG8YGXZhrE0F6vp1JgZi7+JAVEym5vjqbndHyKIHOCZS6soaT9qkleqqQSnXctaWclGNJdOcqZUJ6RoJe26itdUXapW0JqVUvBL0/Y951SDaTB0CcnD99nmx3Yqb36yXnHmzJ8fmPv7BchwHMoyuBujmRuKEh0L245eapafck/bEHi9JZThx5E5sr1y8u0PblHpD97uaqR/7JIbPVAcXn36+tZXIsPZ5Em/hzFkFGopcaoM5CnwDgsMQYx2YbhLMYhCC2OQxfYRrQlyiG+QaJ0mwANrd78MfCtLgJYQ0LWnLHGLU8gZxvFe8gQjp64Io6gHUae95HUqeRZHW87IpT12zbHv/wGCJkEyX0v6zgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 21 11 08 59" title="" data-src="/static/2021-12-21-11-08-59-b904ecc22879f2c812b4c1c6f8796924-fee1c.png" data-srcset="/static/2021-12-21-11-08-59-b904ecc22879f2c812b4c1c6f8796924-a67b7.png 200w,\n/static/2021-12-21-11-08-59-b904ecc22879f2c812b4c1c6f8796924-0b187.png 400w,\n/static/2021-12-21-11-08-59-b904ecc22879f2c812b4c1c6f8796924-fee1c.png 800w,\n/static/2021-12-21-11-08-59-b904ecc22879f2c812b4c1c6f8796924-42e87.png 863w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>除 IE 浏览器之外，其他浏览器都很早就支持了 initial，因此，至少在移动端项目（包括微信小程序）中大家可以百分之百放心使用这个关键字属性值。</p>\n<h3 id="了解一下不固定值关键字-unset"><a href="#%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E4%B8%8D%E5%9B%BA%E5%AE%9A%E5%80%BC%E5%85%B3%E9%94%AE%E5%AD%97-unset" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解一下不固定值关键字 unset</h3>\n<p>unset 是不固定值关键字，其特性如下：如果当前使用的 CSS 属性是具有继承特性的，如 color 属性，则等同于使用 inherit 关键字；如果当前使用的 CSS 属性是没有继承特性的，如 background-color，则等同于使用 initial 关键字。</p>\n<p>unset 这个关键字只有配合 all 属性使用才有意义，因为对于某个具体的 CSS 属性，想要继承某个属性，那就使用 inherit 关键字；想要使用初始值，那就使用 initial 关键字，没有任何理由使用 unset 关键字。</p>\n<p>举个例子，Chrome 浏览器支持 HTML 5.1 规范中的 <code class="language-text">&lt;dialog&gt;</code> 元素，我们自然会想到借助这个 <code class="language-text">&lt;dialog&gt;</code> 元素实现语义更好的弹框组件。然而有一个小问题，这个 <code class="language-text">&lt;dialog&gt;</code> 元素内置了很多我们不需要的样式，内容如下（来自 Chrome 79）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72832655212780930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dialog {\n   display: block;\n   position: absolute;\n   left: 0px;\n   right: 0px;\n   width: -webkit-fit-content;\n   height: -webkit-fit-content;\n   color: black;\n   margin: auto;\n   border-width: initial;\n   border-style: solid;\n   border-color: initial;\n   border-image: initial;\n   padding: 1em;\n   background: white;\n}`, `72832655212780930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">dialog</span> <span class="token punctuation">{</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n   <span class="token property">left</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>\n   <span class="token property">right</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> -webkit-fit-content<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> -webkit-fit-content<span class="token punctuation">;</span>\n   <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>\n   <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n   <span class="token property">border-width</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>\n   <span class="token property">border-style</span><span class="token punctuation">:</span> solid<span class="token punctuation">;</span>\n   <span class="token property">border-color</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>\n   <span class="token property">border-image</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> 1em<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到 <code class="language-text">&lt;dialog&gt;</code> 元素默认有黑色边框和 padding 内间距，还有纯白色的背景颜色和纯黑色的文字颜色，因此下面这段 HTML 就会有图 2-3 所示的效果：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94814304769371540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<dialog open>CSS新世界</dialog>`, `94814304769371540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span> <span class="token attr-name">open</span><span class="token punctuation">></span></span>CSS新世界<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-21-11-17-36-74fb7035133269f7e6d097ec15435ad8-8d56d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 465px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.09677419354838%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABUUlEQVQoz6WRzW+CQBDF+f+vciMcjcTE1mjAE03aaKFNURAoaEwxhVJaYlJDxA/w44UtKlbbQ38Jm50Z3s7bWWqes16vt3+x2WzmR1D44jherVaiKFar1Xq9fp1xlUP2WGu1Gs/zURQtFouDmMCyrOu6HxlBEHzmIAzDEJnJZFIul8fjcZqm6HcQz2YztEWWeMO6XC5hJ0kSYhUbJAVBcBznVIyA4zhcG817GQibzSZOlCSJYRjDMCBG5ry4UqmgFUwOBgPTNGVZVhRFVdXRaKRpGg6FuNFonLeNVsT2pTnvbcPgQUymTdM0RtpqtfAHf8Q+RKlUKvm+j/sXxBiP53m6rpuXQRVtT9+Z6H/xvAeGC+KEkH6TFPmZOS5R239AdXtdRe3778HXdApXeBjLti17+Op63puv9Q3x5rYjyfbw5dm07tqdtvSo9/X7hyfMfwfqn8Dv+pyMqgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 21 11 17 36" title="" data-src="/static/2021-12-21-11-17-36-74fb7035133269f7e6d097ec15435ad8-8d56d.png" data-srcset="/static/2021-12-21-11-17-36-74fb7035133269f7e6d097ec15435ad8-afa68.png 200w,\n/static/2021-12-21-11-17-36-74fb7035133269f7e6d097ec15435ad8-5df89.png 400w,\n/static/2021-12-21-11-17-36-74fb7035133269f7e6d097ec15435ad8-8d56d.png 465w" data-sizes="(max-width: 465px) 100vw, 465px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这个粗糙的效果显然不是我们想要的，但是我们又不想一个属性接一个属性地进行重置，怎么办呢？此时就可以先使用 all: unset 进行批量重置，再设置我们需要的 CSS 属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75169463130517110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dialog {\n   all: unset;\n   /* ... */\n}`, `75169463130517110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">dialog</span> <span class="token punctuation">{</span>\n   <span class="token property">all</span><span class="token punctuation">:</span> unset<span class="token punctuation">;</span>\n   <span class="token comment">/* ... */</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样，无论当前浏览器是否支持 <code class="language-text">&lt;dialog&gt;</code> 元素，最终渲染出来的样式效果都是一致的。因为不支持 <code class="language-text">&lt;dialog&gt;</code> 元素的浏览器会把 <code class="language-text">&lt;dialog&gt;</code> 元素按照 <code class="language-text">&lt;span&gt;</code> 这个内联元素渲染，这就和设置了 all:unset 的效果一模一样。</p>\n<h4 id="兼容性-1"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h4>\n<p>unset 关键字属性值的兼容性要比 initial 差一些，主要是因为被浏览器支持的时间晚了一点，具体如表 2-6 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-21-11-23-03-acae237c570eab56b33d82d79022895f-31a59.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 30.267753201396975%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABPklEQVQY0w3OyU7CQAAA0P6/Fw8m6okYEs8uiUcVRGNwLYUOUqDTdTZKp7O2Sqkk7wOes9/vYZxSWggh4iQH84U39f35YuLOJh749nzCCm8G3r+85QoiTKI4nfqgEqrrOqepdWu4VtVvLa2ulFVm96eV+GusVKoxvN1JIXjb8MZWQpRKysZYo0VtjUO3WT/aoDJ7cIMhCG3sCveK8XB8e1nD52FU9MaotdnZmH2sk64uuPanyU1juRK5AzfoeI4rQ+9ep49gLb238PyUibh3f6HxaLCkJy9pZ/KjQfL0A7sdx8Xn9ahPKKoNcQoGbQnLIkKpz3CAySrH6w2FKAWEQJaDigCClyx2aQYYXSdwnh0kgG9Th1FoDd3QcFtEhwnJAyMRxauKp5KnBK+0wgQtOc+kyHEeaIUaS2tDqzL7B48AQOf9NQwQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 21 11 23 03" title="" data-src="/static/2021-12-21-11-23-03-acae237c570eab56b33d82d79022895f-fee1c.png" data-srcset="/static/2021-12-21-11-23-03-acae237c570eab56b33d82d79022895f-a67b7.png 200w,\n/static/2021-12-21-11-23-03-acae237c570eab56b33d82d79022895f-0b187.png 400w,\n/static/2021-12-21-11-23-03-acae237c570eab56b33d82d79022895f-fee1c.png 800w,\n/static/2021-12-21-11-23-03-acae237c570eab56b33d82d79022895f-31a59.png 859w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>虽然兼容性逊色了一点，但并不影响 unset 的使用，主要有以下两方面的原因。</p>\n<ol>\n<li>需要使用 unset 的场景非常有限，既然使用的机会很少，那么兼容性问题就不是问题。</li>\n<li><code class="language-text">&lt;dialog&gt;</code> 元素的样式重置是很难得的 unset 使用场景，由于支持 <code class="language-text">&lt;dialog&gt;</code> 元素的浏览器一定支持 unset，因此也不用担心兼容性的问题。</li>\n</ol>\n<h3 id="我个人很喜欢的恢复关键字-revert"><a href="#%E6%88%91%E4%B8%AA%E4%BA%BA%E5%BE%88%E5%96%9C%E6%AC%A2%E7%9A%84%E6%81%A2%E5%A4%8D%E5%85%B3%E9%94%AE%E5%AD%97-revert" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我个人很喜欢的恢复关键字 revert</h3>\n<p>revert 关键字可以让当前元素的样式还原成浏览器内置的样式。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84670447929001050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ol {\n   padding: revert;\n   list-style-type: revert;\n}`, `84670447929001050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">ol</span> <span class="token punctuation">{</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> revert<span class="token punctuation">;</span>\n   <span class="token property">list-style-type</span><span class="token punctuation">:</span> revert<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么 <code class="language-text">&lt;ol&gt;</code> 中的每一个 <code class="language-text">&lt;li&gt;</code> 项都会有数字效果呈现，当然，前提是你没有对子元素 <code class="language-text">&lt;li&gt;</code> 的 list-style-type 属性做过样式重置。</p>\n<p>这里有必要插一句，请记住：没有任何理由对 <code class="language-text">&lt;li&gt;</code> 元素进行任何样式重置。因为所有浏览器的 <code class="language-text">&lt;li&gt;</code> 元素默认都没有 margin 外间距，也没有 padding 内间距，list-style-type 也是继承 <code class="language-text">&lt;ul&gt;</code> 或 <code class="language-text">&lt;ol&gt;</code> 元素，所以对 <code class="language-text">&lt;li&gt;</code> 元素进行任何样式重置，既浪费 CSS 代码，也不利于列表序号的样式设置。此刻，你就可以看看手中的项目中的代码有没有对 <code class="language-text">&lt;li&gt;</code> 元素做过样式重置，如果有，赶快删掉：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8028852944439846000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 删除以下代码 */\nli {\n   padding: 0;\n   margin: 0;\n   list-style-type: none;\n}`, `8028852944439846000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 删除以下代码 */</span>\n<span class="token selector">li</span> <span class="token punctuation">{</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n   <span class="token property">list-style-type</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们来看一下实际效果，如图 2-4 所示（截自 Firefox 浏览器）。</p>\n<p>完整的测试代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83095176222876300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<ol class=&quot;revert-ol&quot;>\n   <li>inherit关键字实用</li>\n   <li>initial关键字可用</li>\n   <li>unset关键字配合all使用</li>\n   <li>revert关键字有用</li>\n</ol>\n\n<style>\n   .revert-ol {\n      list-style: none;\n   }\n\n   @supports (padding: revert) {\n      .revert-ol {\n         padding: revert;\n         list-style-type: revert;\n      }\n   }\n</style>`, `83095176222876300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>revert-ol<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>inherit关键字实用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>initial关键字可用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>unset关键字配合all使用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>revert关键字有用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.revert-ol</span> <span class="token punctuation">{</span>\n      <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">padding</span><span class="token punctuation">:</span> revert<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token selector">.revert-ol</span> <span class="token punctuation">{</span>\n         <span class="token property">padding</span><span class="token punctuation">:</span> revert<span class="token punctuation">;</span>\n         <span class="token property">list-style-type</span><span class="token punctuation">:</span> revert<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于不支持 revert 关键字的浏览器，如 Chrome 79，则看不到前面的数字序号，如图 2-5 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-21-11-31-14-68d81e62f38a5839c1249a5850e332b7-d6910.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 568px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 120.59859154929578%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsSAAALEgHS3X78AAAD+klEQVQ4y61VWXPaSBjk/7/uVt6SrX1xdmMnla14XeslNmDuS4BBXLLEYSOExH2aQ+rtGcMWxH6MqgbNjIZP/X3dX8u3eV6h27UwnYygqmWolQqeOh05r1YryOfzCAUDCIfDyGYVlEoqymUV19fX6A9GEJfneThcvu3mGZ2nDmy7B7WoMmAVRVVlsBqqFRX3hQL+vvyG4N0d96pIpVIolctIxBNwnP7rgGLR7/exXMwxmU5hWRZmsyn6joNWs4VWq4kyX2IYBtrtNveaKBXv0bUHMoDrujLg4U6Ea2jaAx5bBsKhCILhKCKxCEKBICKRKD6ff8T7335HNBqTKcdjcQT8V8irdbx1+dzdDpPJBK54C+ebzRa73RaLxQKr1VI+c2yHqGcSdadjYrFcynPz+QKj0RDj8QSPRL9cPYuUd6hrGiyzhVg4gkQmg2iMKCNh+P1+XJx/wi+/vsPtzQ3Ozs7w19ev8H+/wd1dCN9vQszgD/x5/gVfPp2jbVoMyNzn8znW6zXruMCWKJdEsGBNp0TV61lUQVfOB6y1mIshaj1fLIluhMFwSJVMZAzJciabYToWa5QlixlklRzS6RSlEsIVGX7/4QOu//UjcHsr798uL3F59c/bNRQIh6zDZDwkmh4eKSHTNCUC27ZJVgtKLsd1TyJ5bLeoU1OiPLC743D3w4effPnSmTTFXEefbxcIKhRvuVKDphtMO0ty4ogn06jWNZKnw2g0kGRZovEk8oWiLE+C5/L5ezZEBT4BfTAcUSLPWG82lMEIQ8pAvMDq2WizBBZlI0Qv9ickxxkMYbJde/0BuiyNmNs80+f67ZSPWunk2m5Ea4BCfVkf7iek8M8ng4dcRYGbTMKNxeCSeffiAi716UYicNl6Lln2ePeoU49Zeft+lq0n0ewReWTVI5tgunh6ehlknBYD0gwM2L+rFZgfwBKIoD9m5dt3uHwLHQAexTkQJsE2c1jbDgMZtLNyrQ6DZtFsP0LjubVI/QeneQm4Ryi3aVueY6PHYAZZbpHRBodaLFLwaWhkWqUfagwuusKT2vP+D+y9CsgUPSIS6HQGNHQNlXIVadYzl8uj2WygdE+R0ztPOTzyw0P+h03xO2bnCNcW/qfrOoPlqM8aKjRcjUZimi+9/MC5rjfeQHjEkljbbEFhrm3WyzB09nhGuniB6IokSHvQUatVodAftQfjNOCxZA4PrG6HHcGUG03U+ccQ7T/BtMsMlkikUKvrr1L29um9GVAYqzDU2Wwurc3pO/IzISxqzCHs7dj2j8fPN4ctlR4I3eGBxRX9apNh8VHSaAS60USj2aYJFBAIx+ibOaQyWfhvg0ikslAUsVa4ryCZVuRn5D+N7v4X9QxfvgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 21 11 31 14" title="" data-src="/static/2021-12-21-11-31-14-68d81e62f38a5839c1249a5850e332b7-d6910.png" data-srcset="/static/2021-12-21-11-31-14-68d81e62f38a5839c1249a5850e332b7-487ad.png 200w,\n/static/2021-12-21-11-31-14-68d81e62f38a5839c1249a5850e332b7-1cefb.png 400w,\n/static/2021-12-21-11-31-14-68d81e62f38a5839c1249a5850e332b7-d6910.png 568w" data-sizes="(max-width: 568px) 100vw, 568px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/pp7vd3?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="兼容性-2"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h4>\n<p>revert 关键字属性值的兼容性具体信息如表 2-7 所示，可以看到 Chrome84 版本已经支持 revert 关键字属性值。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-21-11-32-29-1c4f820a5c049c66813741efe59af570-40f0e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 30.08225616921269%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABQUlEQVQY0w3MTU+DMACAYf6/J49m0cx4NUt2MnqZWcw+jLpNx4TBBv2A0ZZCuwLtYA65vHlOr9XUjefvK2PSLEcYu66/Xm/sjfNjO4tVRzdOmG07n4uVtwsJoRAi+9cV8ti2rVVrddFCV+pklC5FYSp9rqtS/elCFUVj5KVRhRJtI42WSuVloWqtq1IaU1oBRb0g5QIPZ87Ug3o7Ecsh5f7rY/8czZ62/P49qsv4ekK+AtyaVBSbbzDQZa5Laq0O+MYjpiKD8WKJUPY22vfviAK9l9uGzZ9dejeHTRVfjYKpB9o6j9nHcPyAEGhOmcXJ7iRRzgFLvDwNE7pPM5ySgCU+Y5AnruI7RnY8WmfE74CAEwGHHrziSKwYu+p46Cpz3C1gaB8F7prSkNMQI0eKCIJNyoDIIAzXEXYY2SsZyTz6B0dOP7S1qmmTAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 21 11 32 29" title="" data-src="/static/2021-12-21-11-32-29-1c4f820a5c049c66813741efe59af570-fee1c.png" data-srcset="/static/2021-12-21-11-32-29-1c4f820a5c049c66813741efe59af570-a67b7.png 200w,\n/static/2021-12-21-11-32-29-1c4f820a5c049c66813741efe59af570-0b187.png 400w,\n/static/2021-12-21-11-32-29-1c4f820a5c049c66813741efe59af570-fee1c.png 800w,\n/static/2021-12-21-11-32-29-1c4f820a5c049c66813741efe59af570-40f0e.png 851w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>移动端的支持稍微滞后了一点，不过 revert 在实际项目中应用的时机估计也快到了。</p>\n<h2 id="指代所有-css-属性的-all-属性"><a href="#%E6%8C%87%E4%BB%A3%E6%89%80%E6%9C%89-css-%E5%B1%9E%E6%80%A7%E7%9A%84-all-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>指代所有 CSS 属性的 all 属性</h2>\n<p>all 属性可以重置除 unicode-bidi、direction 以及 CSS 自定义属性以外的所有 CSS 属性。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93737066649501120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`input {\n   all: inherit;\n}`, `93737066649501120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">input</span> <span class="token punctuation">{</span>\n   <span class="token property">all</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>该段代码表示 <code class="language-text">&lt;input&gt;</code> 元素中所有 CSS 属性都使用 inherit 关键字作为属性值。all 属性的语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74380060580897900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`all: initial | inherit | unset | revert;`, `74380060580897900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">all</span><span class="token punctuation">:</span> initial | inherit | unset | revert<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>从 all 的语法中可看出，只能使用 inherit、initial、unset 和 revert 中的一个值作为属性值。</p>\n<p>all: inherit 没有任何实用价值，all: initial 也没有任何实用价值。有实用价值的是 all: unset 和 all: revert。all: unset 可以让任意一个元素样式表现和 <code class="language-text">&lt;span&gt;</code> 元素一样。all: revert 可以让元素恢复成浏览器默认的样式，也是很有用的。例如 <code class="language-text">&lt;progress&gt;</code> 进度条效果在 iOS 端很好看，很有质感，那么无须对其自定义样式，我们就可以使用 all: revert 将进度条一键还原成系统默认的样式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4676368874085002000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 仅 iOS Safari 有效 */\n@supports (-webkit-overflow-scrolling: touch) {\n   progress {\n      all: revert;\n   }\n}`, `4676368874085002000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">/* 仅 iOS Safari 有效 */</span>\n@<span class="token function">supports</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">-</span>webkit<span class="token operator">-</span>overflow<span class="token operator">-</span>scrolling<span class="token punctuation">:</span> touch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   progress <span class="token punctuation">{</span>\n      all<span class="token punctuation">:</span> revert<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后讲讲为什么 unicode-bidi 和 direction 这两个 CSS 属性不受 all 属性影响。</p>\n<p>我们不妨反问一下，如果 unicode-bidi 和 direction 这两个 CSS 属性会受到 all 属性影响，那会出现什么问题呢？阿拉伯文的呈现形式是从右往左的，但是 direction 属性的初始值却是 ltr，即从左往右。如果 all 属性可以影响 direction 属性，那么执行 all: initial 的时候，这些阿拉伯文的网页文字全部都会变成从左往右呈现。大家可以想象一下我们的中文网页上的中文内容全部从右往左显示是什么样的，我敢保证，使用阿拉伯文的前端开发者绝对不会使用这个 all 属性的，all 属性在阿拉伯文中从此名存实亡。</p>\n<p>于是答案就出来了，之所以 direction 属性不受 all 影响，是因为当年 direction 属性设计失误，将其初始值设为了 ltr，而不是 auto。现在为了照顾从右往左阅读的场景，direction 属性就被设计成不受 all 属性影响。</p>\n<p>unicode-bidi 属性是 direction 属性的“跟屁虫”，而且它的功能还挺强大的，可以精确控制每一个文字的呈现方向，只是离开了 direction 属性就没用。既然这两个 CSS 属性形影不离，那就把 unicode-bidi 属性加入不会受 all 属性影响的属性队列吧。</p>\n<h2 id="css-新特性的渐进增强处理技巧"><a href="#css-%E6%96%B0%E7%89%B9%E6%80%A7%E7%9A%84%E6%B8%90%E8%BF%9B%E5%A2%9E%E5%BC%BA%E5%A4%84%E7%90%86%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSS 新特性的渐进增强处理技巧</h2>\n<p>在 CSS2 时代，浏览器层出不穷的奇怪 bug 让 CSS Hack 技巧一度盛行，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37082401491939090"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* IE8+ */\ndisplay: table-cell;\n/* IE7 */\n*display: inline-block;\n/* IE6 */\n_display: inline;`, `37082401491939090`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* IE8+ */</span>\n<span class="token property">display</span><span class="token punctuation">:</span> table-cell<span class="token punctuation">;</span>\n<span class="token comment">/* IE7 */</span>\n*<span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n<span class="token comment">/* IE6 */</span>\n<span class="token property">_display</span><span class="token punctuation">:</span> inline<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种利用语法错误实现浏览器判别的做法可以说是 CSS 历史上的一道奇观了，直到现在，还有很多开发者在区分更高版本的 IE 浏览器的时候，使用在 CSS 属性值后面加 \\0 或者加 \\9 的方法。现在的 CSS 世界已不同于过去，CSS 特性的问题已经不在于渲染 bug，更多的是浏览器支持与不支持的问题，所以上面这些做法已经过时，且没有意义，请不要再使用了。</p>\n<p>如果你想渐进增强使用某些 CSS 新特性，可以看看本节介绍的几个技巧，它们足以应付各种各样的场景。在开始之前，为了让我的表述更简洁，有一些名词所表示的含义需要提前和大家说明。</p>\n<ul>\n<li>IE 浏览器：一直到 IE11 版本的所有 IE 浏览器。</li>\n<li>Edge 浏览器：专指 Edge12 ～ Edge18 版本的浏览器。</li>\n<li>Chromium Edge 浏览器：使用 Chromium 作为核心的 Edge 浏览器，并且是 Edge18 之后的版本，版本号从 76 开始。</li>\n<li>现代浏览器：使用 Web 标准渲染网站，不需要使用 CSS Hack，拥有高性能，同时和 CSS 新特性与时俱进的浏览器。在本书中专指 Chrome 浏览器、Safari 浏览器、Firefox 浏览器、Opera 浏览器和 ChromiumEdge 浏览器</li>\n<li>IE9+ 浏览器：特指 IE9 及其以上版本的 IE 浏览器，以及所有 Edge 版本浏览器和所有现代浏览器。以此类推，IE10+ 浏览器、IE11+ 浏览器、Edge12+ 浏览器这些名词的含义也是类似的。</li>\n<li>webkit 浏览器：特指以 webkit 为渲染引擎，或者前身是 webkit 渲染引擎的浏览器。特指 Chrome 浏览器、Safari 浏览器、Opera 浏览器和 Chromium Edge 浏览器。</li>\n</ul>\n<h3 id="直接使用-css-新特性"><a href="#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8-css-%E6%96%B0%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直接使用 CSS 新特性</h3>\n<p>有很多 CSS 新特性是对现有 Web 特性的体验升级，我们直接使用这些 CSS 新特性就好了，不要担心兼容性问题。因为在支持的浏览器中体验更好，在不支持的浏览器中也就是保持原来的样子而已。例如很常见的 border-radius、box-shadow、text-shadow、filter 等与视觉表现相关的 CSS 属性，或者 scroll-behavior、overscroll-behavior 等交互体验增强的 CSS 属性，还有 will-change 等性能增强的 CSS 属性，都是可以直接使用的。</p>\n<p>用常见的 border-radius 属性举例。我们经常会把用户头像设置成圆的，代码很简单：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21649965126618653000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img {\n   border-radius: 50%;\n}`, `21649965126618653000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img</span> <span class="token punctuation">{</span>\n   <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>对于不支持的浏览器怎么办呢？不需要做什么，放着就好了，矩形也挺好看的。</p>\n<p>记住，做 Web 开发是没有必要让所有浏览器都显示得一模一样的，好的浏览器有更好的显示，糟糕的浏览器就只有普通的显示，这才是对用户更负责任的做法。</p>\n<h3 id="利用属性值的语法差异实现兼容"><a href="#%E5%88%A9%E7%94%A8%E5%B1%9E%E6%80%A7%E5%80%BC%E7%9A%84%E8%AF%AD%E6%B3%95%E5%B7%AE%E5%BC%82%E5%AE%9E%E7%8E%B0%E5%85%BC%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>利用属性值的语法差异实现兼容</h3>\n<p>有时候我们想要渐进增强使用某些新特性，则可以在属性值语法上做文章，借助全新的属性值语法有效区分新旧浏览器。</p>\n<p>举个例子，IE10+ 浏览器支持 CSS 动画属性 animation，我们要实现加载效果就可以使用一个很小的 PNG 图片，再借助旋转动画。这个方法的优点是资源占用少，动画效果细腻。于是，我们的需求来了，IE9 及其以下版本浏览器还是使用传统的 GIF 动图作为背景，IE10+浏览器则使用 PNG 背景图外加 animation 属性实现加载效果。这个需求的难点在于我们该如何区分 IE9 和 IE10 浏览器。大家千万不要再去找什么 CSS Hack 了，我们可以利用属性值的语法差异实现渐进增强效果。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48595288482875440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.icon-loading {\n   display: inline-block;\n   width: 30px;\n   height: 30px;\n   /* 所有浏览器识别 */\n   background: url(./loading.gif)\n   /* IE10+ 浏览器识别，覆盖上一行的 background 声明 */\n   background: url(./loading.png), linear-gradient(transparent, transparent);\n   animation: spin 1s linear infinite;\n}\n\n@keyframe spin {\n   from {\n      transform: rotate(360deg);\n   }\n\n   to {\n      transform: rotate(0deg);\n   }\n}`, `48595288482875440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css{8}"\n              >\n                <span class="gatsby-code-button-language">css{8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.icon-loading</span> <span class="token punctuation">{</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n   <span class="token comment">/* 所有浏览器识别 */</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./loading.gif<span class="token punctuation">)</span></span>\n   <span class="token comment">/* IE10+ 浏览器识别，覆盖上一行的 background 声明 */</span>\n<span class="gatsby-highlight-code-line">   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./loading.png<span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>transparent<span class="token punctuation">,</span> transparent<span class="token punctuation">)</span><span class="token punctuation">;</span></span>   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s linear infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframe</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>关键的 CSS 代码就是上面高亮的部分。由于线性渐变函数 linear-gradient() 需要 IE10+ 浏览器支持，因此，高亮的这行 CSS 声明在 IE9 浏览器中是无法识别的，IE9 浏览器下的 GIF 背景图不会被 PNG 背景图覆盖。图 2-6 所示就是 IE9 模式下 CSS 样式的应用细节，可以看到 background 属性值和 animation 属性下方都有红色波浪线，这是无法识别的意思。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-23-13-55-17-be823230116b2bf6388d56d42edefb87-28460.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.49215922798552%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABOklEQVQoz5VRaVPCMBDt//9djsIglwK2tKSHtaQmvWgbhBzrhmNw/CK+yexskn1vL6fIaRMnDdmUGetatf8CYwzcB6coC+F58P6RpJBTYMxIeSGjiNU5axUFZBmkKRACTXP+RnIpgkBn1CfQ9fqX9o2820EcQRRau7uS67raBwGQUKa0qzrGgOYQxTZNHGNB5nAAZeB4kMd3KhUcAaQGdKQEx3aIUS5WnrCkjV2xfhHetPfnfbgSGRF52OfRPvXa7breEkE3HU/6LenppncUKjBuJmNJP3kBTSlZrkquOJNaKTAatDIanZOPL/p2HIV3RNdB28I/4ViDybFF1zW+b5YrI9VpTBf8RUbg9Dm3I60quH/P15VYAi+ryWJV1U0YxePJ7OFxsFi+rf3gaTh6Hs8Gw9F0/qp/SH8DsuA+ldGcwuYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 23 13 55 17" title="" data-src="/static/2021-12-23-13-55-17-be823230116b2bf6388d56d42edefb87-fee1c.png" data-srcset="/static/2021-12-23-13-55-17-be823230116b2bf6388d56d42edefb87-a67b7.png 200w,\n/static/2021-12-23-13-55-17-be823230116b2bf6388d56d42edefb87-0b187.png 400w,\n/static/2021-12-23-13-55-17-be823230116b2bf6388d56d42edefb87-fee1c.png 800w,\n/static/2021-12-23-13-55-17-be823230116b2bf6388d56d42edefb87-28460.png 829w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 2-7 所示则是 IE9 浏览器中的实时加载效果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-23-13-55-55-405a527518036b9407ca81ac032eef9d-2c55a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 587px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.4855195911414%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAAAr0lEQVQoz6WPywrCMBBF8/9f4N5fEC19P0xpra0LxUXRCioIPkAUI5RMxlQpdhO1eFaTublzZwgqKDmebshKBKH6gkQlFEc8s2oEh/Zmv6hiJdDKLJ575gfsptiJcHd5N39Nlsib99cPutos8DsE/4AAgKhp1jJbPjmH17V1E0UD0teMxXLF2H292cZJGtBINx3bC6az+SjJegPdtD0axqbjSUnTLdenhuWOs8kwjB5arwoyvO6ciQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 23 13 55 55" title="" data-src="/static/2021-12-23-13-55-55-405a527518036b9407ca81ac032eef9d-2c55a.png" data-srcset="/static/2021-12-23-13-55-55-405a527518036b9407ca81ac032eef9d-44ad4.png 200w,\n/static/2021-12-23-13-55-55-405a527518036b9407ca81ac032eef9d-d4623.png 400w,\n/static/2021-12-23-13-55-55-405a527518036b9407ca81ac032eef9d-2c55a.png 587w" data-sizes="(max-width: 587px) 100vw, 587px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/2i6t7m?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>类似的例子还有很多，例如，下拉浮层效果通过在 IE9+ 浏览器中使用 box-shadow 盒阴影、在 IE8 等浏览器中使用 border 边框来实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43336365784992160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.panel-x {\n   /* 所有浏览器识别 */\n   border: 1px solid #ddd;\n   /* rgba() IE9+ 识别，覆盖上一行 border 声明 */\n   border: 1px solid rgba(0, 0, 0, 0);\n   box-shadow: 2px 2px;\n}`, `43336365784992160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.panel-x</span> <span class="token punctuation">{</span>\n   <span class="token comment">/* 所有浏览器识别 */</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ddd<span class="token punctuation">;</span>\n   <span class="token comment">/* rgba() IE9+ 识别，覆盖上一行 border 声明 */</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> 1px solid <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token property">box-shadow</span><span class="token punctuation">:</span> 2px 2px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>又如，下面这段代码既可以去除 inline-block 元素间的空白间隙，又能保持空格特性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15951803907720020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.space-size-zero {\n   font-size: 0.1px;\n   font-size: -webkit-calc(1px - 1px);\n}`, `15951803907720020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.space-size-zero</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 0.1px<span class="token punctuation">;</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token function">-webkit-calc</span><span class="token punctuation">(</span>1px - 1px<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>理论上讲，直接使用 font-size: 0 就可以实现想要的效果，但是在 IE 浏览器中直接设置 font-size: 0 会失去空格特性，如无法实现两端对齐效果等，因此只能设置成 font-size: 0.1px，此时字号大小按照 0px 渲染，空格特性也保留了。但是，这种做法又带来另外一个问题，由于 Chrome 浏览器有一个 12px 的最小字号限制规则，因此 font-size: .1px 会按照 font-size: 12px 渲染，怎么办呢？我们使用一个 IE 浏览器无法识别的语法就可以了，这里就使用了 -webkit-calc(1px - 1px)。</p>\n<p>又如，我们可以使用 background-blend-mode 属性让背景纹理更好看，但是 IE/Edge 浏览器均不支持这个 CSS 属性，那就退而求其次，使用资源开销较大的背景图片代替。技术方案有了，那如何区分 IE/Edge 浏览器呢？可以试试使用 #RRGGBBAA 色值（下面 CSS 代码中高亮的部分）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12830769104565754000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.background-pattern {\n   background: url(./pattern.png);\n   background: repeating-linear-gradient(...), repeating-linear-gradient(...), #00000000;\n   background-blend-mode: multiply;\n}`, `12830769104565754000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css{3}"\n              >\n                <span class="gatsby-code-button-language">css{3}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.background-pattern</span> <span class="token punctuation">{</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pattern.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>...<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">repeating-linear-gradient</span><span class="token punctuation">(</span>...<span class="token punctuation">)</span><span class="token punctuation">,</span> #00000000<span class="token punctuation">;</span></span>   <span class="token property">background-blend-mode</span><span class="token punctuation">:</span> multiply<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">#00000000</code> 指透明度为 0 的黑色，也就是纯透明颜色。其不影响视觉表现，作用是让 IE/Edge 浏览器无法识别这行 CSS 声明，因为 IE/Edge 浏览器并不支持 #RRGGBBAA 色值语法。于是，IE/Edge 浏览器会加载并渲染 pattern.png，而其余浏览器则使用纯 CSS 绘制的带有混合模式效果的很美的纹理背景。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/5ep1mx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>大家在实际开发的时候，要是遇到类似的场景，可以想一想是不是可以借助属性值语法巧妙地解决浏览器的兼容性问题。</p>\n<h3 id="借助伪类或伪元素区分浏览器的技巧"><a href="#%E5%80%9F%E5%8A%A9%E4%BC%AA%E7%B1%BB%E6%88%96%E4%BC%AA%E5%85%83%E7%B4%A0%E5%8C%BA%E5%88%86%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助伪类或伪元素区分浏览器的技巧</h3>\n<p>利用属性值的语法差异渐进增强使用 CSS 新特性固然精妙，但并不是所有 CSS 属性都可以这样使用。我们可以试试借助伪类或伪元素区分浏览器，其优点是可以一次性区分多个 CSS 属性，同时不会影响选择器的优先级。</p>\n<h4 id="ie-浏览器、edge-浏览器和其他浏览器的区分"><a href="#ie-%E6%B5%8F%E8%A7%88%E5%99%A8%E3%80%81edge-%E6%B5%8F%E8%A7%88%E5%99%A8%E5%92%8C%E5%85%B6%E4%BB%96%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%8C%BA%E5%88%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE 浏览器、Edge 浏览器和其他浏览器的区分</h4>\n<p>想要区分 IE9+ 浏览器，可以使用 IE9 浏览器才开始支持的伪类或伪元素。例如，使用下面几个伪元素：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67512610903326030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* IE9+ 浏览器识别 */\n_::before,\n.some-class {\n}\n/* 或者 */\n_::after,\n.some-class {\n}\n/* 或者 */\n_::selection,\n.some-class {\n}`, `67512610903326030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* IE9+ 浏览器识别 */</span>\n<span class="token selector">_::before,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n<span class="token comment">/* 或者 */</span>\n<span class="token selector">_::after,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n<span class="token comment">/* 或者 */</span>\n<span class="token selector">_::selection,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或者下面几个伪类：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48612495446541090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`_:checked,\n.some-class {\n}\n/* 或者 */\n_:disabled,\n.some-class {\n}`, `48612495446541090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">_:checked,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n<span class="token comment">/* 或者 */</span>\n<span class="token selector">_:disabled,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>之所以上面的写法可以有效地区分不同版本的浏览器，是因为 <code class="language-text">CSS 选择器语句中如果存在浏览器无法识别的伪类或伪元素，整个 CSS 规则集都会被忽略</code>。</p>\n<p>可能有开发者会对 <code class="language-text">_::before</code> 或者 <code class="language-text">_::selection</code> 前面的下划线的作用感到好奇。这个下划线是作为一个标签选择器用来占位的，本身不会产生任何匹配，因为我们的页面中没有标签名为下划线的元素。这里换成 some-tag-hahaha::before 或者 some-tag-hahaha::selection，效果也是一样的，之所以使用下划线是因为可以节省字符数量，下划线只需要占用一个字符。</p>\n<p>要想区分 IE10+ 浏览器，可以使用从 IE10 才开始支持的与表单验证相关的伪类，比如 :required、:optional、:valid 和 :invalid。由于 animation 属性也是从 IE10 浏览器才开始支持的，因此前面出现的加载的例子的 CSS 代码也可以这么写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69512905448354775000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.icon-loading {\n   display: inline-block;\n   width: 30px;\n   height: 30px;\n   background: url(./loading.gif);\n}\n\n/* IE10+ 浏览器识别 */\n_:valid,\n.icon-loading {\n   background: url(./loading.png);\n   animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n   from {\n      transform: rotate(360deg);\n   }\n\n   to {\n      transform: rotate(0deg);\n   }\n}`, `69512905448354775000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.icon-loading</span> <span class="token punctuation">{</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./loading.gif<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* IE10+ 浏览器识别 */</span>\n<span class="token selector">_:valid,\n.icon-loading</span> <span class="token punctuation">{</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./loading.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n   <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s linear infinite<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>区分 IE11+ 浏览器可以使用 ::-ms-backdrop 伪元素。::backdrop 是一个从 IE11 开始支持的伪元素，可以控制全屏元素或者元素全屏时候的背景层的样式。在 IE11 浏览器中使用该元素时需要加 -ms- 私有前缀，在 Edge 等其他的浏览器中使用则不需要加私有前缀，加了反而无法识别。</p>\n<p>因此，最终的 CSS 代码会有冗余，.some-class 下的 CSS 样式需要写两遍：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69534486820478116000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* IE11+ 浏览器识别 */\n_::-ms-backdrop,\n.some-class {\n   @supports (display: none) {\n      .some-class {\n      }\n   }\n}`, `69534486820478116000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* IE11+ 浏览器识别 */</span>\n<span class="token selector">_::-ms-backdrop,\n.some-class</span> <span class="token punctuation">{</span>\n   <span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token selector">.some-class</span> <span class="token punctuation">{</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>区分 Edge12+浏览器可以使用 @supports 规则，区分 Edge13+ 浏览器可以使用 :in-range 或者 :out-of-range 伪类，示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47660277798636840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* Edge13+ 浏览器识别 */\n_:in-range,\n.some-class {\n}\n\n_:out-of-range,\n.some-class {\n}`, `47660277798636840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* Edge13+ 浏览器识别 */</span>\n<span class="token selector">_:in-range,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">_:out-of-range,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>再往后的 Edge 版本区分就没什么意义了，也不会有这样的需求场景，我们无须关心。</p>\n<h4 id="浏览器类型的区分"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浏览器类型的区分</h4>\n<p>若只想让 Firefox 浏览器识别，可以使用一个带有 -moz- 私有前缀的伪类或伪元素，示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8213223865807385000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* Firefox only */\n_::moz-progress-bar,\n.some-class {\n}`, `8213223865807385000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* Firefox only */</span>\n<span class="token selector">_::moz-progress-bar,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>若只想让现代浏览器识别，可用以下语句</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77027988825394320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 现代浏览器 */\n_:default,\n.some-class {\n}`, `77027988825394320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 现代浏览器 */</span>\n<span class="token selector">_:default,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>若只想让 webkit 浏览器识别，则只能使用带有 -webkit- 前缀的伪类，而不能使用带有 -webkit- 前缀的伪元素，因为 Firefox 浏览器会认为带有 -webkit- 前缀的伪元素语法是合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54378069938258846000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* webkit 浏览器 */\n:webkit-any(_),\n.some-class {\n}`, `54378069938258846000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* webkit 浏览器 */</span>\n<span class="token selector">:webkit-any(_),\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>若只想让 Chromium Edge 浏览器识别，可以用如下语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23684364934414550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* Chromium Edge only */\n_::ms-any,\n.some-class {\n}`, `23684364934414550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* Chromium Edge only */</span>\n<span class="token selector">_::ms-any,\n.some-class</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Chromium Edge 浏览器会把任意带有 -ms- 前缀的伪元素都认为是合法的，这应该是借鉴了 Firefox、Chrome、Safari 等浏览器认为带有-webkit-前缀的伪元素是合法的这一做法。</p>\n<p>当然，使用伪类或伪元素处理浏览器的兼容性也是有风险的，说不定哪一天浏览器就改变规则了。例如，浏览器突然不支持某个伪类了，-webkit-any() 伪类就有不被浏览器支持的风险；或者哪天 Firefox 浏览器也支持使用带有 -moz- 和 -webkit- 前缀的伪类了，就像 Chromium Edge 浏览器一样。</p>\n<p>因此，本节所提供的技巧，尤其是浏览器类型的区分，只能用在一些特殊场合，解决特殊问题，切不可当作金科玉律或者炫技的资本。</p>\n<h3 id="supports-规则下的渐进增强处理"><a href="#supports-%E8%A7%84%E5%88%99%E4%B8%8B%E7%9A%84%E6%B8%90%E8%BF%9B%E5%A2%9E%E5%BC%BA%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>@supports 规则下的渐进增强处理</h3>\n<p>@supports 是 CSS 中的常见的 @ 规则，可以用来检测当前浏览器是否支持某个 CSS 新特性，这是最规范、最正统的 CSS 渐进增强处理方法，尤其适合多个 CSS 属性需要同时处理的场景。</p>\n<p>@supports 规则的设计初衷非常好，理论上应该很常用才对，毕竟 IE 浏览器的兼容性问题非常严重。但是在实际开发的时候，@supports 规则并没有在 IE 浏览器的兼容性问题上做出什么大的贡献。原因很简单，@supports 规则的支持是从 Edge12 浏览器开始的，根本就没有 IE 浏览器什么事情。</p>\n<p>如果非要强制使用 @supports 规则，则要牺牲 IE 浏览器的部分体验。用上面加载效果实现来举例，如果我们用 @supports 规则书写代码则是下面这样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47227868376599690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.icon-loading {\n   display: inline-block;\n   width: 30px;\n   height: 30px;\n   background: url(./loading.gif);\n}\n\n/* Edge12+ 浏览器识别 */\n@supports (animation: none) {\n   .icon-loading {\n      background: url(./loading.png);\n      animation: spin 1s linear infinite;\n   }\n}\n\n@keyframes spin {\n   from {\n      transform: rotate(360deg);\n   }\n\n   to {\n      transform: rotate(0deg);\n   }\n}`, `47227868376599690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.icon-loading</span> <span class="token punctuation">{</span>\n   <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./loading.gif<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* Edge12+ 浏览器识别 */</span>\n<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">animation</span><span class="token punctuation">:</span> none<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n   <span class="token selector">.icon-loading</span> <span class="token punctuation">{</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./loading.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> spin 1s linear infinite<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@keyframes</span> spin</span> <span class="token punctuation">{</span>\n   <span class="token selector">from</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>360deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">to</span> <span class="token punctuation">{</span>\n      <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，明明 IE10 和 IE11 浏览器都支持 animation 属性，却使用了 GIF 动图作为背景，这是因为 IE10 和 IE11 浏览器不支持 @supports 规则。</p>\n<p>对追求极致用户体验的开发者而言，这种做法显然是无法容忍的，于是他们就会放弃使用 @supports 规则，转而使用其他的技巧。不过，随着浏览器的不断发展，IE10 和 IE11 浏览器用户的占比一定会越来越小，我相信这个比例很快就会小于 1%。这个时候，牺牲小部分 IE10 和 IE11 浏览器用户的体验，换来代码层面的稳健，权衡来看，也是可以接受的。</p>\n<p>因此，在我看来，@supports 规则的应用前景一定会越来越好，对于这个 CSS 规则，我是极力推荐大家学习的。当你在实际项目中使用 @supports 规则应用了一个很帅气的 CSS 新特性的时候，那种愉悦的感觉会让你终生难忘。</p>\n<h4 id="从-supports-规则常用的语法说起"><a href="#%E4%BB%8E-supports-%E8%A7%84%E5%88%99%E5%B8%B8%E7%94%A8%E7%9A%84%E8%AF%AD%E6%B3%95%E8%AF%B4%E8%B5%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从 @supports 规则常用的语法说起</h4>\n<p>所有开发者都能轻易掌握@supports 规则最基本的用法，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19001866798432700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@supports (display: flex) {\n   .item {\n      flex: 1;\n   }\n}`, `19001866798432700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n   <span class="token selector">.item</span> <span class="token punctuation">{</span>\n      <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段代码的意思很明了，如果浏览器支持 display:flex，则匹配.item 类名的元素就设置 flex: 1。</p>\n<p>@supports 规则还支持使用操作符进行判断，这些操作符是 not、and 和 or，分别表示“否定”“并且”“或者”。利用这些操作符实现简单的逻辑判断也没什么问题，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71565151238944380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@supports (display: flex) {\n}\n\n@supports not (display: flex) {\n}\n\n@supports (display: flex) and (display: grid) {\n}\n\n@supports (display: flex) or (display: grid) {\n}`, `71565151238944380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@supports</span> not <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> and <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> or <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>甚至连续判断 3 个以上的 CSS 声明也没问题：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56918764372463280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 合法 */\n@supports (display: flex) and (display: grid) and (gap: 0) {\n}\n\n@supports (display: flex) or (display: grid) or (gap: 0) {\n}`, `56918764372463280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 合法 */</span>\n<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> and <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span> and <span class="token punctuation">(</span><span class="token property">gap</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> or <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span> or <span class="token punctuation">(</span><span class="token property">gap</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，一旦遇到复杂逻辑判断，运行会出现问题，语法怎么写都写不对。</p>\n<p>例如，写一个判断当前浏览器支持弹性布局，但不支持网格布局的@support 语句，很多人按照自己的想法就会写成下面这样，结果语法错误，最后只能找别人已经写好的复杂语法例子去套用，这哪是学习呢？这是应付工作！实际上，稍微多花一点点功夫，就能完全学会 @supports 的条件判断语法，级联、嵌套，都完全不在话下。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19304344538528030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\n@supports (display: flex) and not (display: grid) {\n}\n\n@supports not (display: grid) and (display: flex) {\n}`, `19304344538528030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> and not <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@supports</span> not <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span> and <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来的内容会用到 CSS 属性值定义语法，我现在就认定你已经掌握了这方面的知识。</p>\n<p>我们先随便定义一个数据类型，将其命名为 <code class="language-text">&lt;var&gt;</code>，用于表示括号里面的东西，然后我们依葫芦画瓢：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34288599190532977000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(display: flex)\nnot (display: flex)\n(display: flex) and (display: grid) and (gap: 0)\n(display: flex) or (display: grid) or (gap: 0)`, `34288599190532977000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span>\nnot <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> and <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span> and <span class="token punctuation">(</span><span class="token property">gap</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span>\n<span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> or <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span> or <span class="token punctuation">(</span><span class="token property">gap</span><span class="token punctuation">:</span> 0<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面这些条件判断语句可以抽象成下面这样的正式语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6789441935359486000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<supports-condition> = (<var>) | not (<var>) | (<var>)[ and (<var>)]+ | (<var>)[or (<var>)]+`, `6789441935359486000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css">&lt;supports-condition> = <span class="token punctuation">(</span>&lt;var><span class="token punctuation">)</span> | not <span class="token punctuation">(</span>&lt;var><span class="token punctuation">)</span> | <span class="token punctuation">(</span>&lt;var><span class="token punctuation">)</span>[ and <span class="token punctuation">(</span>&lt;var><span class="token punctuation">)</span>]+ | <span class="token punctuation">(</span>&lt;var><span class="token punctuation">)</span>[or <span class="token punctuation">(</span>&lt;var><span class="token punctuation">)</span>]+</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最重点的部分来了！这个自定义的 <code class="language-text">&lt;var&gt;</code> 的语法很神奇、很有趣：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13412923714262682000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<var> = <declaration> | <supports-condition>`, `13412923714262682000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css">&lt;var> = &lt;declaration> | &lt;supports-condition></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>居然在 CSS 语法中看到了递归——<code class="language-text">&lt;supports-condition&gt;</code>嵌套<code class="language-text">&lt;supports-condition&gt;</code>数据类型。原来 @supports 规则的复杂条件判断就是把合法的逻辑语句放在括号里不断嵌套！</p>\n<p>此刻才发现，“判断当前浏览器支持弹性布局，但不支持网格布局”这样的问题实在是太简单了，先把基础语法写好：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78948462376482670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@supports (display: flex) and (不支持网格布局) {\n}`, `78948462376482670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> and <span class="token punctuation">(</span>不支持网格布局<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后“不支持网格布局”的基础语法是 not (display: grid)，将语法嵌套一下，就可以得到正确的写法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18983023303313273000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@supoorts (display: flex) and (not (display: grid)) {\n}`, `18983023303313273000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@supoorts</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> and <span class="token punctuation">(</span>not <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>Edge12 ～ Edge15 浏览器正好是符合上面的条件判断的，我们不妨验证一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14815816154224870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<span class=&quot;supports-match&quot;>如果有背景色，则是匹配</span>\n<style>\n   .supports-match {\n      padding: 5px;\n      border: 1px solid;\n   }\n\n   @supports (display: flex) and (not (display: grid)) {\n      .supports-match {\n         background-color: #333;\n         color: #fff;\n      }\n   }\n</style>`, `14815816154224870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>supports-match<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>如果有背景色，则是匹配<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.supports-match</span> <span class="token punctuation">{</span>\n      <span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> and <span class="token punctuation">(</span>not <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token selector">.supports-match</span> <span class="token punctuation">{</span>\n         <span class="token property">background-color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>\n         <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 Edge14 浏览器中的效果有背景色，但是在 Chrome 浏览器中则只有边框。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/5ce06l?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="supports-规则完整语法和细节"><a href="#supports-%E8%A7%84%E5%88%99%E5%AE%8C%E6%95%B4%E8%AF%AD%E6%B3%95%E5%92%8C%E7%BB%86%E8%8A%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>@supports 规则完整语法和细节</h4>\n<p>至此，是时候看一下 @supports 规则的正式语法了，如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37676243677642530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@supports <supports-condition> {\n   /* CSS 规则集 */\n}`, `37676243677642530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@supports</span> &lt;supports-condition></span> <span class="token punctuation">{</span>\n   <span class="token comment">/* CSS 规则集 */</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>其中，<code class="language-text">&lt;supports-condition&gt;</code> 就是前面不断出现的 <code class="language-text">&lt;supports-condition&gt;</code>，之前对它的常规用法已经讲得很详细了，这里再说说它的其他用法，也就是 @supports 规则支持 CSS 自定义属性的检测和 CSS 选择器语法的检测。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13887904065158519000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 这里不能使用 css 语法高亮，否则会格式化到 :default */\n@supports (--var: blue) {\n}\n\n@supports selector(:default) {\n}`, `13887904065158519000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">/* 这里不能使用 css 语法高亮，否则会格式化到 :default */\n@supports (--var: blue) {\n}\n\n@supports selector(:default) {\n}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，CSS 自定义属性的检测没有任何实用价值，本书不展开讲解；而 CSS 选择器语法的检测属于 CSS Conditional Rules Module Level 4 规范中的内容，目前浏览器尚未大规模支持，暂时没有实用价值，因此本书暂不讲解。</p>\n<p>我们现在先把条件判断的语法放一边，来看几个你可能不知道但很有用的关于 @supports 规则的细节知识。</p>\n<ol>\n<li>\n<p>在现代浏览器中，每一个逻辑判断的语法的合法性是独立的。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65376697048323230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@supports (display: flex) or (anything;) {\n}`, `65376697048323230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span> or <span class="token punctuation">(</span>anything<span class="token punctuation">;</span></span><span class="token selector">)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但 Edge 浏览器会认为上面的语句是不合法的，会忽略整行语句，我认为这是 Edge 浏览器的 bug。因此 Edge12 ～ Edge14 浏览器虽然不支持 CSS 自定义属性，但无法使用 @supports 规则检测出来：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38426612437000610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* Edge12 ~ Edge14 忽略以下语句 */\n@supports not (--var: blue) {\n}`, `38426612437000610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* Edge12 ~ Edge14 忽略以下语句 */</span>\n<span class="token atrule"><span class="token rule">@supports</span> not <span class="token punctuation">(</span><span class="token property">--var</span><span class="token punctuation">:</span> blue<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>浏览器还提供了 CSS.supports() 接口，让我们可以在 JavaScript 代码中检测当前浏览器是否支持某个 CSS 特性，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75286400663146050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`CSS.supports(propertyName, value);\nCSS.supports(supportCondition);`, `75286400663146050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>propertyName<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>supportCondition<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>@supports 规则的花括号可以包含其他任意 @ 规则，甚至是包含 @supports 规则自身。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61115601673513200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@supports (display: flex) {\n  /* 支持内嵌媒体查询语法 */\n  @media screen and (max-width: 9999px) {\n     .supports-match {\n        color: #fff;\n     }\n  }\n  \n  /* 支持内嵌 @supports 语法 */\n  @supports (animation: none) {\n     .supports-match {\n        animation: colorful 1s linear alternate infinite;\n     }\n  }\n\n  /* 支持内嵌 @keyframes 语法 */\n  @keyframe colorful {\n     from {\n        background-color: deepskyblue;\n     }\n     to {\n        background-color: deeppink;\n     }\n  }\n}`, `61115601673513200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token comment">/* 支持内嵌媒体查询语法 */</span>\n  <span class="token atrule"><span class="token rule">@media</span> screen and <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 9999px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n     <span class="token selector">.supports-match</span> <span class="token punctuation">{</span>\n        <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  \n  <span class="token comment">/* 支持内嵌 @supports 语法 */</span>\n  <span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">animation</span><span class="token punctuation">:</span> none<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n     <span class="token selector">.supports-match</span> <span class="token punctuation">{</span>\n        <span class="token property">animation</span><span class="token punctuation">:</span> colorful 1s linear alternate infinite<span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">/* 支持内嵌 @keyframes 语法 */</span>\n  <span class="token atrule"><span class="token rule">@keyframe</span> colorful</span> <span class="token punctuation">{</span>\n     <span class="token selector">from</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n     <span class="token selector">to</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> deeppink<span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，在现代浏览器中可以看到文字背景色不停变化的动画效果。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/6573gr?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n</li>\n</ol>\n<h4 id="supports-规则与渐进增强案例"><a href="#supports-%E8%A7%84%E5%88%99%E4%B8%8E%E6%B8%90%E8%BF%9B%E5%A2%9E%E5%BC%BA%E6%A1%88%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>@supports 规则与渐进增强案例</h4>\n<p>@supports 规则使用案例在后续章节会多次出现，到时候大家可以仔细研究，这里就先不展示了。</p>\n<h3 id="对-css-新特性渐进增强处理的总结"><a href="#%E5%AF%B9-css-%E6%96%B0%E7%89%B9%E6%80%A7%E6%B8%90%E8%BF%9B%E5%A2%9E%E5%BC%BA%E5%A4%84%E7%90%86%E7%9A%84%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对 CSS 新特性渐进增强处理的总结</h3>\n<p>接下来将陆续介绍上百个 CSS 新特性，其中很多新特性都存在兼容性的问题，主要是 IE 浏览器不支持。现在移动端用户的浏览器都是现代浏览器，80%～ 90% 桌面端用户的浏览器也都是现代浏览器，如果我们因为占比很少的低版本浏览器用户，而放弃使用这些让用户体验更好的 CSS 新特性，那将是一件非常遗憾的事情。身为前端开发者，如果没能在用户体验上创造更大的价值，总是使用传统的技术做一些重复性的工作，那么我们的工作激情很快就会被消磨掉，我们的竞争优势也会在日复一日的重复劳动中逐渐丧失。</p>\n<p>因此，我觉得大家在日常工作中，应该大胆使用 CSS 新特性，同时再多花一点额外的时间对这些新特性做一些兼容性方面的工作。这绝对是一件非常划算的事情，无论是对用户还是对自身的成长都非常有帮助。</p>\n<p>当然，虽然本节介绍了多个 CSS 新特性兼容处理的技巧，但是在实际开发的时候还是会遇到很多单纯使用 CSS 无法搞定的情况，此时就需要借助 JavaScript 代码和 DOM API 来实现兼容，即如果出现 CSS 无法做到兼容，或者低版本浏览器希望有近似的交互体验效果的情况，就需要 JavaScript 代码的处理。例如使用 position: sticky 实现滚动粘滞效果，传统方法都是使用 JavaScript 脚本来实现的，但现在大部分浏览器已经支持这个特性，我们可以让传统浏览器继续使用传统的 JavaScript 方法，现代浏览器则单纯使用 CSS 方法以得到更好的交互体验。</p>\n<p>千万不要觉得麻烦，说什么“所有浏览器都直接使用 JavaScript 实现就好啦”。所谓技术成就人生，如果完成需求的心态都是为了应付工作，哪里来的足以成就人生的技术呢？要知道，你所获得的报酬是跟你创造的价值成正比的，如果你想获得超出常人的报酬，那你就需要比那些普通开发者创造的价值更高，而这些价值的差异往往就源自对这些技术细节的处理，日积月累之后就会有明显的差异。</p>\n<p>这额外的一点兼容性处理工作其实也花不了你什么时间，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86699581016437160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.adsense {\n   position: relative;\n   position: sticky;\n}`, `86699581016437160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.adsense</span> <span class="token punctuation">{</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> sticky<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>JavaScript 代码中就多一行判断代码而已：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10361908362949235000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (!window.CSS || !CSS.supports || !CSS.supports(\'position\', \'sticky\')) {\n   // 传统的 js 调用\n}`, `10361908362949235000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span><span class="token constant">CSS</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token constant">CSS</span><span class="token punctuation">.</span>supports <span class="token operator">||</span> <span class="token operator">!</span><span class="token constant">CSS</span><span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span><span class="token string">\'position\'</span><span class="token punctuation">,</span> <span class="token string">\'sticky\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 传统的 js 调用</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS新世界概述及准备/index.md absPath of file >>> MarkdownRemark",timeToRead:29,frontmatter:{date:"2021-12-19 23:44:24",path:"/css-new-world-overview-prepare/",tags:"前端, CSS, CSS新世界, 读书笔记",title:"CSS新世界概述及准备",draft:null}},{excerpt:"line-height 的另外一个朋友 font-size 第 5 章介绍过 line-height 和 vertical-align 的好朋友关系，实际上 font-size 也和 line-height 是好朋友，同样也无处不在，并且纸面上 line-height 的数值属性值和百分比值属性值都是相对于 font-size 计算的，其关系可谓不言而喻。 font-size 和 vertical-align 的隐秘故事 line-height 的部分类别属性值是相对于 font-size…",html:'<h1 id="line-height-的另外一个朋友-font-size"><a href="#line-height-%E7%9A%84%E5%8F%A6%E5%A4%96%E4%B8%80%E4%B8%AA%E6%9C%8B%E5%8F%8B-font-size" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>line-height 的另外一个朋友 font-size</h1>\n<p>第 5 章介绍过 line-height 和 vertical-align 的好朋友关系，实际上 font-size 也和 line-height 是好朋友，同样也无处不在，并且纸面上 line-height 的数值属性值和百分比值属性值都是相对于 font-size 计算的，其关系可谓不言而喻。</p>\n<h2 id="font-size-和-vertical-align-的隐秘故事"><a href="#font-size-%E5%92%8C-vertical-align-%E7%9A%84%E9%9A%90%E7%A7%98%E6%95%85%E4%BA%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>font-size 和 vertical-align 的隐秘故事</h2>\n<p>line-height 的部分类别属性值是相对于 font-size 计算的，vertical-align 百分比值属性值又是相对于 line-height 计算的，于是，看上去八辈子都搭不上边的 vertical-align 和 font-size 属性背后其实也有有着关联的。</p>\n<p>例如，下面的 CSS 代码组合：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67676181411864380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p {\n   font-size: 16px;\n   line-height: 1.5;\n}\n\np > img {\n   vertical-align: -25%;\n}`, `67676181411864380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">p > img</span> <span class="token punctuation">{</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> -25%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，p > img 选择器对应元素的 vertical-align 计算值应该是：</p>\n<p>16px * 1.5 * -25% = -6px</p>\n<p>也就是上面的 CSS 代码等同于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21555989610084490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p {\n   font-size: 16px;\n   line-height: 1.5;\n}\n\np > img {\n   vertical-align: -6px;\n}`, `21555989610084490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 1.5<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">p > img</span> <span class="token punctuation">{</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> -6px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是两者又有所不同，很显然 <code class="language-text">-25%</code> 是一个相对计算属性值，如果此时元素的 font-size 发生变化，则图片会自动进行垂直位置调整。我们可以看一个无论 font-size 如何变化、后面图标都垂直居中对齐的例子，无论文字字号是大还是小，后面的图标都非常良好地垂直居中对齐，如图 8-1 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-01-10-11-53-07-9938aa85812a1fb84f2ae86eeeec6915-70b68.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 266px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 44.73684210526316%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABHElEQVQoz31QyWqFQBD0/z/Dk8tVwaMGPCR4EYQoonEDd8cVd5NCyUsi5NVh6O7q6q5p6vMvuq6r67ppmqqq8jxP07SqSNu2hJC+72/N1O9k2zZo8B7HkcSxZVnyy2sUxaDGcQKFANS/YixZlgXvVcE2FBHs+w47zzYDrutKkiQIgqZpqqrSNC2KIj6yrltZls82r+s6jqNpmrIsE1Ih4DiOZVl4edP0d9O+i49vXITveYqiMAyj63pRlDzPh2E4TVPbdrjf5f/R/7P5ynFV2EN3HMe4vOd58zzDzjAMKN7/jBvatp0kyXQiPwENxFEUpSfAIkbRMAwYwXTf9zGOwg2DIHiIEbvuB1rDExhUFEWWZZgFynEcyNB8ib8ASuP46qRLJt4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 01 10 11 53 07" title="" data-src="/static/2020-01-10-11-53-07-9938aa85812a1fb84f2ae86eeeec6915-70b68.png" data-srcset="/static/2020-01-10-11-53-07-9938aa85812a1fb84f2ae86eeeec6915-74086.png 200w,\n/static/2020-01-10-11-53-07-9938aa85812a1fb84f2ae86eeeec6915-70b68.png 266w" data-sizes="(max-width: 266px) 100vw, 266px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>核心 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95598537125659080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`p > img {\n   width: 16px;\n   height: 16px;\n   vertical-align: 25%;\n   position: relative;\n   top: 8px;\n}`, `95598537125659080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">p > img</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> 25%<span class="token punctuation">;</span>\n   <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n   <span class="token property">top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>原理如下：内联元素默认基线对齐，图片的基线可以看成是图片的下边缘，文字内容的基线是字符 x 下边缘，因此，本例中，图片下边缘默认和“中文”两个汉字字形底边缘往上一点的位置对齐。然后，我们通过 <code class="language-text">vertical-align: 25%</code> 声明让图片的下边缘和中文汉字的中心线对齐。此时，图标和文字的状态应该如图 8-2 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-01-10-11-55-22-e5a618701a17fdcd82a83923c544c0b6-3a985.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 186px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.91397849462365%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABuElEQVQoz41RXW+iUBD1n/cPtE/btElj3Jj2wZpN3WW7gWLVxA3djcaP4lcFEVRULuUCAuIGUfdEmybd+LDzAHNnzpk5M5PY7Xbb7Rbf5XLpeR4xjKGiwHcdJwiC0WikqWrg+5RS0zQptcIwfKck3j1d13+w7Je7u6tkkuP535XKt+9MMpX6nE5/ZZihpgEkKaphGEfIrm1XSiXh8dHU9dz19cqynp+efnJc+vJS4POR63rk9dPpRf9FAniz2Xwgm4Rs47h0f39zfh4Aapq/WPYhmz07OSnmcnQ4xGBU1V4JOdJ5Pp8/iyIUQmq+UJgR4odhjmHyxeKfKFruR12tVhalR8jYB8dyk8kEe8rzvCiKNqW3mUy/3/cWCwIzjKmuY6kfyP/YIfE/lnBdt1wua5o2GAxwGITG47EgCN1u13EcVVWRQnNEms1mrVbDdFAnSZLv+wmIRBR3Amg6nR70g4mT4No4L1Ive+t0OqiFLMiz2SyKojfZcRyDCQLQrVYLPvqDhp6QgydGtm3bsqx2u71er99kH34oAxAKK4rSaDTr9YYsSxgEUGyu1+vJsqzsrVqtYueH1fwFnSdPPjUI9wcAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 01 10 11 55 22" title="" data-src="/static/2020-01-10-11-55-22-e5a618701a17fdcd82a83923c544c0b6-3a985.png" data-srcset="/static/2020-01-10-11-55-22-e5a618701a17fdcd82a83923c544c0b6-3a985.png 186w" data-sizes="(max-width: 186px) 100vw, 186px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 8-2 完全就是实例效果注释 <code class="language-text">top: 8px</code> 后的截图标注，没有任何加工。看上去似乎上面小，实际上是视觉误差，分隔线上下完全均等，1 像素不差。</p>\n<p>由于我们这里的图标是固定的像素尺寸，因此，通过偏移自身 1/2 高度来实现真正的居中，可以使用 CSS3 transform 位移，我这里为了兼容性，使用了 relative 相对定位。</p>\n<p>其居中原理本质上和绝对定位元素 50% 定位加偏移自身 1/2 尺寸实现居中是一样的，只不过这里的偏移使用的是 vertical-align 百分比值。</p>\n<p>这么一看，vertical-align 百分比属性值似乎还是有点用的！如果再联想到 <code class="language-text">vertical-align: middle</code> 实现垂直居中效果经常不尽如人意，说不定还能找到一块更好的宝。但我要告诉你，其实还有更好的实现，那就是使用单位 ex。例如，将前面例子中的 <code class="language-text">vertical-align: 25%</code> 改成 <code class="language-text">vertical-align: .6ex</code>，效果基本上就是一样的，并且还多了一个优点，就是使用 <code class="language-text">vertical-align: .6ex</code> 实现的垂直居中效果不会受 line-height 变化影响，而使用 <code class="language-text">vertical-align: 25%</code>，line-height 一旦变化，就必须改变原来的 vertical-align 大小、重新调整垂直位置，这容错性明显就降了一个层次。</p>\n<p>因此，虽然例子演示的是 vertical-align 百分比值，实际上是推荐使用与 font-size 有着密切关系的 ex 单位。</p>\n<p>说到这里，忍不住想介绍另外一些和 font-size 有着密切的关系的东西。</p>\n<h2 id="理解-font-size-与-ex、em-和-rem-的关系"><a href="#%E7%90%86%E8%A7%A3-font-size-%E4%B8%8E-ex%E3%80%81em-%E5%92%8C-rem-%E7%9A%84%E5%85%B3%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>理解 font-size 与 ex、em 和 rem 的关系</h2>\n<p>ex 是字符 x 高度，显然和 font-size 关系密切，font-size 值越大，自然 ex 对应的大小也就大，对此本书前面已经有介绍，这里不赘述。</p>\n<p>下面来看看单位 em。如果说 ex 是字符 x 高度，那是不是 em 就是字符 m 的高度？</p>\n<p>我的回答是“不是的”，但是 em 和字符 m 确实有关。em 在传统排版中指一个字模的高度（可以脑补下活字印刷的字模）。</p>\n<p>例如，浏览器默认 font-size 大小是 16px，假设一个<code class="language-text">&lt;div&gt;</code>宽度是 160px，则正好可以放下 10 个汉字不换行；如果是 159px 像素，第十个汉字就会掉下来；如果再同时设置 line-height:1 和一个背景色，代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64077389431939170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`div {\n   width: 160px;\n   line-height: 1;\n   background-color: #eee;\n}`, `64077389431939170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 160px<span class="token punctuation">;</span>\n   <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n   <span class="token property">background-color</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们就会发现中文汉字的尺寸就可以看作 em 单位的代名词，尤其在高度这一块，简直分毫不差，如图 8-3 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-01-13-15-12-20-4714542444b599c959ead4224b3f1738-2ee65.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 220px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.45454545454545%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABW0lEQVQoz12SSY+CQBCF+f+/gqsJ8eYSIqLCJB6MQqJBUTQuxCWekE3FYT5ohzhTiZXqV+81r6qVXq/XZrNZrVbz+Zzsed5yuVwsFl4ZAiRc1wWkWK/Xs9nscDjkeS7dbjdZlpvNZqPRUFW1Vqv1ej1N0+r1OmCr1ep2u4DtdpuuoigcacEpxGmaQup0OoZhAEH6KgMqPKMMCP1+H5AuR64eDoeFOC/j+zfyv/GJVHVVSFRZljG5QKtC1FWI478PSIyOQ5Y0mUwulwtbieOYxvl8FohlWWx0Op3u93vf92GCMAXzFmJd19EMBgMyAiGGx3jX65WFn04n9GT04gloJUki4fnTSVbG8/nkCnIURY/Hgxe53+/U5DAMQd62+XHAHhZom6bJVm3bdhzneDxyxD9vgxG+udvtRqPReDwWeynEQRCweiaBJ1zhHzGe+T8g4DoyhO12y3WMJsQ/Qu0Qoyp8orIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 01 13 15 12 20" title="" data-src="/static/2020-01-13-15-12-20-4714542444b599c959ead4224b3f1738-2ee65.png" data-srcset="/static/2020-01-13-15-12-20-4714542444b599c959ead4224b3f1738-6af5a.png 200w,\n/static/2020-01-13-15-12-20-4714542444b599c959ead4224b3f1738-2ee65.png 220w" data-sizes="(max-width: 220px) 100vw, 220px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>也就是说，em 就是’中’等汉字的高度！于是，我们对 em 的理解就更加简单了，直接看一个很容易理解错误的题目，在 Chrome 浏览器下，<code class="language-text">&lt;h1&gt;</code>元素有如下的默认 CSS：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18019813343420688000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`h1 {\n   font-size: 2em;\n   -webkit-margin-before: 0.67em;\n   -webkit-margin-after: 0.67em;\n}`, `18019813343420688000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">h1</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span>\n   <span class="token property">-webkit-margin-before</span><span class="token punctuation">:</span> 0.67em<span class="token punctuation">;</span>\n   <span class="token property">-webkit-margin-after</span><span class="token punctuation">:</span> 0.67em<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么，假设页面没有任何 CSS 重置，根元素 font-size 就是默认的 16px，请问：此时<code class="language-text">&lt;h1&gt;</code>元素 margin-before 的像素计算值是多少？</p>\n<p>如果对 em 了解不够，很容易认为 1em 大小就是 16px，于是计算值是 <code class="language-text">16px × 0.67 = 10.72px</code>，实际上这是错误的。</p>\n<p>我们可以这样想，假设 <code class="language-text">&lt;h1&gt;</code> 里面有汉字，此时汉字的高度是多少？这个高度就是此时 1em 大小。<code class="language-text">&lt;h1&gt;</code> 元素此时 font-size 是 2em，算一下就是 32px，因此，此时里面汉字的高度应该是 32px，也就是说，此时<code class="language-text">&lt;h1&gt;</code>元素的 1em 应该是 32px，于是 margin-before 的像素计算值为 <code class="language-text">32px × 0.67 = 21.44px</code>，和浏览器自己的计算值一样，如图 8-4 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-01-13-15-15-42-1bf2eb3d92fd3fe07d9f3f18a628b52e-4c7f3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 384px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.92708333333333%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABKklEQVQY001Qi46DIBD0/z+uD2MkqGe1obSaCoIilVO5OWmTToIs7u7szEZ6GIwQNs+nspybZqJ0+vmZ29ZQ+ivE5v22rtsHTdM8Ho+6rp1z3vtI9r243VQcK0p1XcvzuSdkqGuVpqoozDBMHxhjGGNVVRFClFLoj5TWQ9uOhJiytJwPaWqKAsFUVYtzy7Ks67rsQICZUsrwhJBISNkx1p9OGKguF3E4yCTRjIk41pwba80HGE4phezX6zWO4zzPEQhAieM3GPQbJji3R/+f/X4HIQ5Yd0Qhd71e8zzHPrTW1lrI45zfOBdCIJVlGawWRQGroSBwvZvRhjTqns8nJAUu9LAd2Q5oRlmLBY3ju/lbG1hRkSQJBnZdh92AC1bv9zt+Ho9HMH4b+QO7rL/fNhCp+QAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 01 13 15 15 42" title="" data-src="/static/2020-01-13-15-15-42-1bf2eb3d92fd3fe07d9f3f18a628b52e-4c7f3.png" data-srcset="/static/2020-01-13-15-15-42-1bf2eb3d92fd3fe07d9f3f18a628b52e-370ca.png 200w,\n/static/2020-01-13-15-15-42-1bf2eb3d92fd3fe07d9f3f18a628b52e-4c7f3.png 384w" data-sizes="(max-width: 384px) 100vw, 384px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>乍一看，似乎出现了死循环悖论：<code class="language-text">font-size: 2em</code>，于是 1em 变成 32px，那此时的 2em 不又是 64px，然后又……</p>\n<p>正如前面提到过的一样，CSS 世界的渲染是一次渲染，是不会有死循环的。这里是先计算 font-size，然后再计算给其他使用 em 单位的属性值大小。</p>\n<p>总结如下：在 CSS 中，1em 的计算值等同于当前元素所在的 font-size 计算值，可以将其想象成当前元素中（如果有）汉字的高度。</p>\n<p>所有相对单位的好处都是一样的，样式表现更具有弹性。例如，理论上，有一个布局，希望小屏时整体缩小，大屏时再弹性扩大，此时就可以让所有元素宽高尺寸等都使用 em，于是，最后只要改变布局祖先元素的 font-size 大小就可以实现整体的弹性变化。</p>\n<p>这种策略很棒，也确实可行，但是有一个比较麻烦的事情，它和上面 <code class="language-text">&lt;h1&gt;</code> 元素计算一样的麻烦，em 是根据当前 font-size 大小计算的，一旦布局中出现标题这种跟基础 font-size 大小不一样的场景的时候，标题里面所有元素 em 都要重新计算一遍，甚为麻烦，最终的成品维护成本就比较高了。</p>\n<p>正是由于这种局限性，另外一个和 font-size 密切相关的单位出现了，就是 rem，即 root em，顾名思义，就是根元素 em 大小。em 相对于当前元素，rem 相对于根元素，本质差别在于当前元素是多变的，根元素是固定的，也就是说，如果使用 rem，我们的计算值不会受当前元素 font-size 大小的影响，假设 <code class="language-text">&lt;h1&gt;</code> 的默认 CSS 是这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72473135009512980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`h1 {\n   font-size: 2em;\n   -webkit-margin-before: 0.67rem;\n   -webkit-margin-after: 0.67rem;\n}`, `72473135009512980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">h1</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span>\n   <span class="token property">-webkit-margin-before</span><span class="token punctuation">:</span> 0.67rem<span class="token punctuation">;</span>\n   <span class="token property">-webkit-margin-after</span><span class="token punctuation">:</span> 0.67rem<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么 2em 的 font-size 计算值会被忽略，直接使用根元素的 16px 进行计算，于是 margin-before 计算值是 16 像素 ×0.67 = 10.72 像素。</p>\n<p>因此，要想实现带有缩放性质的弹性布局，使用 rem 是最佳策略，但 rem 是 CSS3 单位，IE9 以上浏览器才支持，需要注意兼容性，我这里就不再多介绍了。</p>\n<p>回到 em 单位。em 实际上更适用于图文内容展示的场景，对此进行弹性布局。例如 <code class="language-text">&lt;h1&gt;～&lt;h6&gt;</code> 以及 <code class="language-text">&lt;p&gt;</code> 等与文本内容展示的元素的 margin 都是用 em 作为单位，这样，当用户把浏览器默认字号从“中”设置成“大”或改成“小”的时候，上下间距也能根据字号大小自动调整，使阅读更舒服。</p>\n<p>再举个适用于 em 的场景，如果我们使用 SVG 矢量图标，建议设置 SVG 宽高如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93362157598310480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`svg {\n   width: 1em;\n   height: 1em;\n}`, `93362157598310480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">svg</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 1em<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 1em<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样，无论图标是个大号文字混在一起还是和小号文字混在一起，都能和当前文字大小保持一致，既省时又省力。</p>\n<h2 id="理解-font-size-的关键字属性值"><a href="#%E7%90%86%E8%A7%A3-font-size-%E7%9A%84%E5%85%B3%E9%94%AE%E5%AD%97%E5%B1%9E%E6%80%A7%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>理解 font-size 的关键字属性值</h2>\n<p>font-size 支持长度值，如 1em，也支持百分比值，如 100%。这两点想必众所周知，但 font-size 还支持关键字属性值这一点怕是就有不少人不清楚了。</p>\n<p>font-size 的关键字属性值分以下两类。</p>\n<ol>\n<li>\n<p><strong>相对尺寸关键字。</strong></p>\n<p>指相对于当前元素 font-size 计算，包括：</p>\n<ul>\n<li>larger：大一点，是 <code class="language-text">&lt;big&gt;</code> 元素的默认 font-size 属性值。</li>\n<li>smaller：小一点，是 <code class="language-text">&lt;small&gt;</code> 元素的默认 font-size 属性值。</li>\n</ul>\n</li>\n<li>\n<p><strong>绝对尺寸关键字。</strong></p>\n<p>与当前元素 font-size 无关，仅受浏览器设置的字号影响。注意这里的措辞，是“浏览器设置”，而非“根元素”，两者是有区别的。</p>\n<ul>\n<li>xx-large：好大好大，和 <code class="language-text">&lt;h1&gt;</code> 元素计算值一样。</li>\n<li>x-large：好大，和 <code class="language-text">&lt;h2&gt;</code> 元素计算值一样。</li>\n<li>large：大，和 <code class="language-text">&lt;h3&gt;</code> 元素计算值近似</li>\n<li>medium：不上不下，是 font-size 的初始值，和 <code class="language-text">&lt;h4&gt;</code> 元素计算值一样。</li>\n<li>small：小，和 <code class="language-text">&lt;h5&gt;</code> 元素计算值近似。</li>\n<li>x-small：好小，和 <code class="language-text">&lt;h6&gt;</code> 元素计算值近似。</li>\n<li>xx-small：好小好小，无对应的 HTML 元素。</li>\n</ul>\n</li>\n</ol>\n<p>其中，相对尺寸关键字 larger 和 smaller 由于计算的系数在不同浏览器下差异很大，因此实用价值有限，只有类似文档页、帮助页这类对文字尺寸要求不高的场合才有用；而绝对尺寸关键字的实用性要大一些，而且在某些场合是推荐使用的关键字属性值，这个要慢慢讲。</p>\n<p>下面两个 CSS 代码有什么区别？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7122971028153891000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-size: 14px;\n}\n\nhtml {\n   font-size: 87.5%;\n}`, `7122971028153891000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 87.5%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在绝大多数场景下，两者没有差别，全都计算为 14px，但是如果用户对浏览器的字号进行了调整，例如，把默认的“中”设置成了“大”，如图 8-5 所示（截自 Chrome 浏览器），那么此时，font-size: 14px 计算值还是 14px，但 font-size: 87.5% 的计算值则大了一圈，于是差别就出现了。如果是像素单位 font-size，用户改变浏览器的默认字号后，页面会微丝不动；如果是百分比值 font-size，则字号相应放大，这就涉及用户体验和可访问性问题了。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-14-13-54-00-e41e5062f8fdbd9552cf845c2b9ac92f-f0556.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 596px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.56375838926174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB7ElEQVQoz1VSy46bMBTlN6tuqq7bZX+kf9FNNYuRKs1ITTaV2pm0E5WnDcZgA+ERCIQBAhjoJUyT9ujKutb1uY9zLVnEXq9WP75/+/W0jaI4CILdbheChefzamEUzogA59N1XYlSxzRNzlmaZsMwCCG6XuRlUzyfjlV3sbw8Hcq6LMvDIQeU5TMhtpQkyX6/T/bZ9BetmBREMWFemLIgAeO7vUl97IQmxpvHzXa7VWRZUVQJGkjTNI5jyCHEAGQxTrrFZcyySqRld7WibU9gM/qum9sGGpA93+Oc930/k4fpWBz6tpr+xzAO4ziCs5ygjuR5XlW9vFtCdTveq4c71KzouKZiTYev9nBniY3XQQZIANK8kFVNe3h4XO4LuThNH75Urz8d39xO72/ydzfHt7fTq8/jx4el/j+V58XMGwijOIIRYA+E0qefG+X3NuCu59iujcOABZxijFVNRxib2KzqBsaUsiwjNoGARSzOmONQFaAjYjs6MjUDqwYyTEszkCyfI7ouy7LjuoHvSxc9mrqmNoEdNqe2rutdEBR5fixykBOKeIzB36COG8XJRTNpPGMmNw0oTimFGaB/w4AaBsbIcVxwETIgBH6czORhFm68Vl5S+D7XNA2ZlqrAL1BgQGiBMWZZBHKen1zxB7rpj8T9dgNrAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 14 13 54 00" title="" data-src="/static/2021-12-14-13-54-00-e41e5062f8fdbd9552cf845c2b9ac92f-f0556.png" data-srcset="/static/2021-12-14-13-54-00-e41e5062f8fdbd9552cf845c2b9ac92f-ae33b.png 200w,\n/static/2021-12-14-13-54-00-e41e5062f8fdbd9552cf845c2b9ac92f-daf23.png 400w,\n/static/2021-12-14-13-54-00-e41e5062f8fdbd9552cf845c2b9ac92f-f0556.png 596w" data-sizes="(max-width: 596px) 100vw, 596px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>正常情况下，14 像素的文字大小是足够的，但是，如果是高度近视的用户，或者上班急急忙忙忘记戴眼镜，或者在投影仪上投影网页内容，此时就有大字号浏览网页的需求，如果使用固定的像素单位，显然对这些使用场景是不友好的。</p>\n<p>好在浏览器还提供了“网页缩放”功能，但是此功能也是有局限性的：如果网页是定宽非响应式的，则网页放大后窗体以外的内容就看不到了，在 Chrome/Firefox 浏览器下甚至连个水平滚动条都没有，说不定重要信息就会看不到。由此可见，我们是不能轻易忽视浏览器字号设置功能的。</p>\n<p>然而，现代网页设计得很精致，要想网页布局跟随字体内容缩放实在两难，要么使用 em，但 em 计算与当前 font-size 耦合，不好维护；要么使用 rem，但 IE8 不支持，桌面端使用尴尬。因此，现实的压迫导致我们只能使用 px 进行布局，尤其桌面端网页。</p>\n<p>如何权衡“易于实现维护”“视觉还原”“可访问性”这三者，我这里有两个建议。</p>\n<ol>\n<li>\n<p>即使是定宽的传统桌面端网页，也需要做响应式处理，尤其是针对 1200 像素宽度设计的网页，但只需要响应到 800 像素即可，可以保证至少有 1.5 倍的缩放空间，如果做到这一步，那么是否需要响应浏览器的字号设置这一点就可以忽略。</p>\n</li>\n<li>\n<p>如果因各种原因无法做响应式处理，也没有必要全局都使用相对单位，毕竟成本等现实问题摆在那里，其实只需要在图文内容为主的重要局部区域使用可缩放的 font-size 处理即可。例如，小说网站的阅读页、微信公众号文章展示区、私信对话内容区、搜索引擎的落地页、评论区等，都强烈建议摒弃 px 单位，而采用下面的实践策略。</p>\n<ul>\n<li>\n<p>容器设置 font-size: medium，此时，这个局部展示区域的字号就跟着浏览器的设置走了，默认计算值是 16px。</p>\n</li>\n<li>\n<p>容器内的文字字号全部使用相对单位，如百分比值或者 em 都可以，然后基于 16px 进行转换。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17436993374897658000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.article {\n font-size: medium;\n}\n.article h1 {\n font-size: 2em;\n margin: 0.875em 0;\n}\n.article p {\n font-size: 87.5%; /* 默认字号下计算值是 14px */\n margin: 1em 0;\n}`, `17436993374897658000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.article</span> <span class="token punctuation">{</span>\n <span class="token property">font-size</span><span class="token punctuation">:</span> medium<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">.article h1</span> <span class="token punctuation">{</span>\n <span class="token property">font-size</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span>\n <span class="token property">margin</span><span class="token punctuation">:</span> 0.875em 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">.article p</span> <span class="token punctuation">{</span>\n <span class="token property">font-size</span><span class="token punctuation">:</span> 87.5%<span class="token punctuation">;</span> <span class="token comment">/* 默认字号下计算值是 14px */</span>\n <span class="token property">margin</span><span class="token punctuation">:</span> 1em 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n</li>\n</ol>\n<p>同时使用自适应流体布局，间距什么的也使用相对单位，例如上面 margin 使用的是 em 单位。于是，当用户改变了浏览器的字号后，整个阅读区域的所有字样甚至布局都会跟着放大，文字一下子就看清楚了。这种局部处理的好处在于，页面的导航、侧边栏这些不需要长时间阅读的模块还是原来的像素布局，还是那么精致，丝毫不受影响。就这么很微小的变动，就可以让你的网页在可访问性这一块超越大多数的网站，何乐而不为？</p>\n<p>可以看到，绝对尺寸关键字在实际项目中还有很有价值的，但有价值的仅仅是 medium，至于其他关键字，作用仅限于字面上的那点儿，大家了解一下即可。</p>\n<h2 id="font-size-0-与文本的隐藏"><a href="#font-size-0-%E4%B8%8E%E6%96%87%E6%9C%AC%E7%9A%84%E9%9A%90%E8%97%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>font-size: 0 与文本的隐藏</h2>\n<p>桌面 Chrome 浏览器下有个 12px 的字号限制，就是文字的 font-size 计算值不能小于 12px，我猜是因为中文，如宋体，要是小于 12px，就会挤成成一团，略丑，Chrome 看不下去，就直接禁用了。</p>\n<p>正是这种限制导致我们在使用 em 或 rem 进行布局的时候，不能这么处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46523837844996320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-size: 62.5%;\n}`, `46523837844996320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 62.5%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>理论上，此时根字号计算值是 16px*0.625=10px，于是 <code class="language-text">width: 14px</code> 可以写成 <code class="language-text">width: 1.4em</code>，省了很多计算的麻烦。但是，在 Chrome 下由于 12px 的限制，根字号计算值实际不是 10px，而是 12px，所以，可以试试处理成这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32454980096326304000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-size: 625%;\n}`, `32454980096326304000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 625%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>此时根字号计算值是 100px，既计算无忧，又没有 12px 的最小字号限制。</p>\n<p>但是我个人建议还是不要这样处理，尤其使用 em 的时候，因为 font-size 属性和 line-height 属性一样，由于继承性的存在，会影响贯穿整个网页，100px 的环境 font-size 一定会将平时不显山露水的底边对齐问题、间隙问题等放大，导致出现一些明显的样式问题，如果对 CSS 了解不是很深刻，怕是很难明白为什么会发生这样的问题。同时这样做也限制了 px 等其他单位的使用，有时候是比较要命的。</p>\n<p>因此，我的建议是仍基于浏览器默认的字号进行相对计算，也就是 medium 对应的 16px，16 这个数字是一定可以整除的，因此计算成本还行，或者使用 Sass 或 Less 之类的工具辅助计算。</p>\n<p>还是回到字号限制的问题。实际上，并不是所有小于 12px 的 font-size 都会被当作 12px 处理，有一个值例外，那就是 0，也就是说，如果 font-size:0 的字号表现就是 0，那么文字会直接被隐藏掉，并且只能是 <code class="language-text">font-size: 0</code>，哪怕设置成 font-size: 0.0000001px，都还是会被当作 12px 处理的。</p>\n<p>因此，如果希望隐藏 logo 对应元素内的文字，除了 text-indent 缩进隐藏外，还可以试试下面这种方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59353458425260294000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.logo {\n   font-size: 0;\n}`, `59353458425260294000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.logo</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h1 id="字体属性家族的大家长-font-family"><a href="#%E5%AD%97%E4%BD%93%E5%B1%9E%E6%80%A7%E5%AE%B6%E6%97%8F%E7%9A%84%E5%A4%A7%E5%AE%B6%E9%95%BF-font-family" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字体属性家族的大家长 font-family</h1>\n<p>font-family 默认值由操作系统和浏览器共同决定，例如 Windows 和 OS X 下的 Chrome 默认字体不一样，同一台 Windows 系统的 Chrome 和 Firefox 浏览器默认字体也不一样。</p>\n<p>font-family 支持两类属性值，一类是“字体名”，一类是“字体族”。“字体名”很好理解，就是使用的对应字体的名称。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46264910077958430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   font-family: simsun;\n}`, `46264910077958430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> simsun<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>就表示使用的是“宋体”。如果字体名包含空格，需要使用引号包起来。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="677217283177888900"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   font-family: \'Microsoft Yahei\';\n}`, `677217283177888900`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'Microsoft Yahei\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>根据我的实践，可以不用区分大小写。如果有多个字体设定，从左往右依次寻找本地是否有对应的字体即可。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72922085012244310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   font-family: \'PingFang SC\', \'Microsoft Yahei\';\n}`, `72922085012244310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'PingFang SC\'</span><span class="token punctuation">,</span> <span class="token string">\'Microsoft Yahei\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>就是先寻找是否本地有 PingFang SC 字体；如果没有，则继续寻找本地是否有 Microsoft Yahei 字体；如果都没找到，就使用默认值。</p>\n<p>但是，“字体族”分为很多类，MDN 上文档分类如下：</p>\n<ul>\n<li>font-family: serif;</li>\n<li>font-family: sans-serif;</li>\n<li>font-family: monospace;</li>\n<li>font-family: cursive;</li>\n<li>font-family: fantasy;</li>\n<li>font-family: system-ui;</li>\n</ul>\n<p>具体含义解释如下。</p>\n<ul>\n<li>serif：衬线字体。</li>\n<li>sans-serif：无衬线字体。</li>\n<li>monospace：等宽字体。</li>\n<li>cursive：手写字体。</li>\n<li>fantasy：奇幻字体。</li>\n<li>system-ui：系统 UI 字体。</li>\n</ul>\n<p>对于中文网站，cursive 和 fantasy 应用场景有限，因此这里不予探讨，这里着重介绍一下衬线字体、无衬线字体和等宽字体。</p>\n<h2 id="了解衬线字体和无衬线字体"><a href="#%E4%BA%86%E8%A7%A3%E8%A1%AC%E7%BA%BF%E5%AD%97%E4%BD%93%E5%92%8C%E6%97%A0%E8%A1%AC%E7%BA%BF%E5%AD%97%E4%BD%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解衬线字体和无衬线字体</h2>\n<p>字体分衬线字体和无衬线字体。所谓衬线字体，通俗讲就是笔画开始、结束的地方有额外装饰而且笔画的粗细会有所不同的字体。网页中常用中文衬线字体是“宋体”，常用英文衬线字体有 Times New Roman、Georgia 等。无衬线字体没有这些额外的装饰，而且笔画的粗细差不多，如中文的“雅黑”字体，英文包括 Arial、Verdana、Tahoma、Helivetica、Calibri 等</p>\n<p>以前人们排正文喜欢使用衬线字体，但是如今，不知是审美疲劳还是人们更加追求简洁干净的缘故，更喜欢使用无衬线字体，如“微软雅黑”或者“苹方”之类的字体。</p>\n<p>在 CSS 世界中，字体是有对应的属性值的，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23115116589202800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`font-family: serif; /* 衬线字体 */\nfont-family: sans-serif; /* 无衬线字体 */`, `23115116589202800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">font-family</span><span class="token punctuation">:</span> serif<span class="token punctuation">;</span> <span class="token comment">/* 衬线字体 */</span>\n<span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span> <span class="token comment">/* 无衬线字体 */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>我们在移动端 Web 开发的时候，虽然设备的默认中文字体不一样，但都是无衬线，都挺好看的，因此可以直接使用下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58010361740460990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   font-family: sans-serif;\n}`, `58010361740460990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>没有必要特别指定中文字体，否则说不定会画蛇添足。</p>\n<p>serif 和 sans-serif 还可以和具体的字体名称写在一起，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70943407306008190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   font-family: \'Microsoft Yahei\', sans-serif;\n}`, `70943407306008190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'Microsoft Yahei\'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但是需要注意的是，serif 和 sans-serif 一定要写在最后，因为在大多数浏览器下，写在 serif 和 sans-serif 后面的所有字体都会被忽略。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2244087169006392300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`body {\n   font-family: sans-serif, \'Microsoft Yahei\';\n}`, `2244087169006392300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> sans-serif<span class="token punctuation">,</span> <span class="token string">\'Microsoft Yahei\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在 Chrome 浏览器下，后面的 Microsoft Yahei 字体是不会被渲染的。据我的推测，有可能浏览器认为当前“字体族”已经满足了文本渲染的需要，没必要再往后解析了</p>\n<h2 id="等宽字体的实践价值"><a href="#%E7%AD%89%E5%AE%BD%E5%AD%97%E4%BD%93%E7%9A%84%E5%AE%9E%E8%B7%B5%E4%BB%B7%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>等宽字体的实践价值</h2>\n<p>所谓等宽字体，一般是针对英文字体而言的。据我所知，东亚字体应该都是等宽的，就是每个字符在同等 font-size 下占据的宽度是一样的。但是英文字体就不一定了，我随便写一个单词，就 iMac 吧，大家很明显地发现这个字符 i 要比 M 占据的宽度小。如果这样看着还不够清楚，那我换一种呈现方式，上下两行，上一行 6 个 i，下一行 6 个 M，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18552614946268300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`iiiiii\nMMMMMM`, `18552614946268300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">iiiiii\nMMMMMM</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>实际的两行文本的宽度可能就如图 8-6 所示这般差异明显。</p>\n<p>但是，如果是等宽字体（可以让英文字符同等宽度显示的字体就称为“等宽字体”），如 Consolas、Monaco、monospace，则宽度表现就不一样了，如图 8-7 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-15-11-28-20-1e4bef06e0935327554432992b9e4271-8aa68.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 758px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 17.150395778364118%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAbUlEQVQI14WNQQ6DMAwE8/83lkDcUBuRCuQEirBLapVbJdSV9jCH2XW1VhUhItV3/RdmfqY0zfPxRWcVEd/c7gBd2yENqnrhHojoW49EJ7tSymvb7BlCgAAxxmVdfySbyznLvpvcP/o0jobM+QNTTK0T0xvTPwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 15 11 28 20" title="" data-src="/static/2021-12-15-11-28-20-1e4bef06e0935327554432992b9e4271-8aa68.png" data-srcset="/static/2021-12-15-11-28-20-1e4bef06e0935327554432992b9e4271-9e0f4.png 200w,\n/static/2021-12-15-11-28-20-1e4bef06e0935327554432992b9e4271-8ee5b.png 400w,\n/static/2021-12-15-11-28-20-1e4bef06e0935327554432992b9e4271-8aa68.png 758w" data-sizes="(max-width: 758px) 100vw, 758px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>等宽字体在 Web 中有什么用呢？</p>\n<ol>\n<li>\n<p>等宽字体与代码呈现</p>\n<p>首先等宽字体利于代码呈现。对于写代码的人来说，无论是什么语言，易读是第一位，使用等宽字体，我们阅读起来会更轻松舒服。因此，一般编辑器使用的字体或者 Web 上需要呈现源代码的字体都是等宽字体。例如，即将出现的演示页面的源代码如图 8-8 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-15-11-30-20-2e255f122f2cc56180ecf01cc7d98fd1-5df43.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 503px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.5506958250497%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABLElEQVQY05VRR27EMAz0/z+318W6xyq25CKrd0deZIEAOWVAELzMDIespml6PB5t2wruvqaEcDpZQEgvq8Q7Ahv4WqfSD86vN/J1pXyldA9VjNFa3492HAMlEQINkZl3OlJATkoogRhCBLedKWWlNEIYCMKM036E6hZLaRjDMOaVRgDUMCp44Hp+DWRkp3DWWWtOprvG9n0g1BVKcS5VhZCEiE3rJxAZi2Qx82JXvqEDz2yR2sQbQUpXDDFOB/PXB5UxnpJESDYmXf9EISets/ORK3Xqs5TzXorIheNaMMWE5sY4fkal4vtev8iCx+O4N9+52OTG7ZlSPnbPeVRe7XKTVpZojGWp/jj/PCDfkkrK+lXPJbQ1fdc8n08IUFO3bddvGx2GTr4F8sf+G9SJyPCpbeFTAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 15 11 30 20" title="" data-src="/static/2021-12-15-11-30-20-2e255f122f2cc56180ecf01cc7d98fd1-5df43.png" data-srcset="/static/2021-12-15-11-30-20-2e255f122f2cc56180ecf01cc7d98fd1-ac36e.png 200w,\n/static/2021-12-15-11-30-20-2e255f122f2cc56180ecf01cc7d98fd1-3a669.png 400w,\n/static/2021-12-15-11-30-20-2e255f122f2cc56180ecf01cc7d98fd1-5df43.png 503w" data-sizes="(max-width: 503px) 100vw, 503px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>等宽字体与图形呈现案例一则</p>\n<p>假设某工具有这么一个功能：通过下拉选择，可以改变元素的边框样式，也就是 borderStyle 在 solid/dashed/dotted 间切换。</p>\n<p>大家都知道，原生的 <code class="language-text">&lt;select&gt;</code> 的 <code class="language-text">&lt;option&gt;</code> 元素的 innerHTML 只能是纯 text 字符，不能有 html，也不支持伪元素，因此，要模拟 solid、dashed 和 dotted，只能使用字符，而字符有长有短，可以模拟成像样的规整的图形吗？</p>\n<p>可以的，试试使用等宽字体。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/g72o6b?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n</li>\n<li>\n<p>ch 单位与等宽字体布局</p>\n<p>ch 和 em、rem、ex 一样，是 CSS 中和字符相关的相对单位。和 ch 相关的字符是 0，没错，就是阿拉伯数字 0。1ch 表示一个 0 字符的宽度，所以 6 个 0 所占据的宽度就是 6ch。</p>\n<p>由于 ch 是个 CSS3 单位，且 IE9 浏览器的宽度和其他浏览器明显不一样，因此此处不展开，但可以提一提一些不错的应用场景。例如，有些输入框是输入手机号的，在中国，手机号是 11 位，因此我们可以设置该输入框宽度为 11ch，同时让字体等宽，则用户一眼就能看出自己是否少输入或者多输入了 1 位数字。又如，我们想实现一个屏幕上代码一个一个出现的动效，如果代码是等宽字体，此时使用 ch 单位来控制宽度，配合 overflow 属性和 CSS animation 就能在完全不使用 JavaScript 的情况下将此效果模拟出来。当然，还有其他一些应用场景，不一一说明。</p>\n</li>\n</ol>\n<h2 id="中文字体和英文名称"><a href="#%E4%B8%AD%E6%96%87%E5%AD%97%E4%BD%93%E5%92%8C%E8%8B%B1%E6%96%87%E5%90%8D%E7%A7%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>中文字体和英文名称</h2>\n<p>使用中文字体，就必须要知道其对应的英文名称，下面是一些常见中文字体对应的 font-family 英文属性名称。</p>\n<ol>\n<li>Windows 常见内置中文字体和对应英文名称见图 8-10</li>\n<li>OS X 系统内置中文字体和对应英文名称见图 8-11</li>\n<li>Office 软件安装新增中文字体和对应英文名称见图 8-12</li>\n<li>其他一些中文字体和对应英文名称见图 8-13</li>\n</ol>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-15-13-39-01-82d0a90f746c275e5e4a267ccdec2e89-27a33.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 352px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 152.27272727272728%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADBklEQVQ4y41ViXKiQBDl//9od2t3o6lNjMYLPBDlBgFFQeWcAbMPiBExqcqrcQqn53X3dL8BJopjjJRQQrM4SesjjOKEEEwYSUoaViwxp9Op8/Ty++ffbncwHrLPT113fyBZHoTha2/468efh9+tQZ/999jZ7P2UZhGYcFT6YsI43u08XTNte7PZuGvTPpzChFBs2u99TTMMY+04rqGbxyDC+juzIhNK325xvuCr9QpZljFxHLMsO51OG7spSTVVm8/mmq6jHG93KMiEkDAMgyBoOM7zHOue55+OR+w736Eg00va9+avEq6lHYWd585sxue3aadpYtu2ICyd7fbtMxTkJIlFUTLNdSMaMnK3m+Xyg3wuf+fmmev+chy2HPfVbuyhGUXkRNP09XptWZa5trIsvzimrrvz/QPagZp5nnc4HHzPRxWvkaMwaLdbvd5rq/XQaj8m6Xv9IL9ZgbksyyzHyooirlbD4UjR9CuZflskdwWjxZkLjZMUQLdxBT4aDRNcV12BHc9oPgyg4aFqVdR5eh6zY9S82+2NRmNQ4BhdmE2ni4WgqSqSX61WgiDwiwVOMuEm7m6PDMvIAKYyThWqUlhhItWUIg5M2BYEIZayKnL9zF8p7N30dq76XD1nFCKJY47lJFn52FzRguC0EmXcijAKG/K4EYnv+6cgQJ4NG3qLEt63o0amV4XlNTQuRn4HOGWiKOJ5XipRD05IYllru0QYRZ9HBhkawg7TNOtkSsl2uzFKQKTfSPtyKxpp35zosqdIGwU7Ho5Ao2Cw4Q5AKpihgHu1FpEhEMMwDeTceBkkia7phcI0VZYVvCs/unhDrtKplEyuoFVJCxmX64WVXoEVpu7vO5epDua194JWiaI4m89olpu62h8MhOWCX/Cqqm5sGy0csyzHcStJXi2FdvthISwlUbEchzEMzcGnwnEc28aXyXW3kijyfHGNFFl2nI2NdluWqiqSJKNt4O/23h7wPKauZ01VRuPRYNCfcIg1FRY8N5lOJhNFlsDpD4b4Wz/mf7mbuPaXmxUHAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 15 13 39 01" title="" data-src="/static/2021-12-15-13-39-01-82d0a90f746c275e5e4a267ccdec2e89-27a33.png" data-srcset="/static/2021-12-15-13-39-01-82d0a90f746c275e5e4a267ccdec2e89-a9510.png 200w,\n/static/2021-12-15-13-39-01-82d0a90f746c275e5e4a267ccdec2e89-27a33.png 352w" data-sizes="(max-width: 352px) 100vw, 352px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-15-13-39-14-e964d4aa205be3bb736a3ec31baa91ee-2a196.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 762px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 90.15748031496064%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAACQElEQVQ4y0WTiXajMAxF+f8f6wfM2pmmlECGzTbYZgsEOtcWbXVyHC960tOTSLLs+vP7779/Lsr0WZb/+PYrTa+m65tW970tbrfn5+fXy2Ucx7Ztizwvy/IfVpZKqaQsK62Ms37bd2sd10rp9fG4r6u11hhT1zWw4/39vtw7Y8ZhsH0/DKP3PuFtnuf3aN65pmnatlnXdX88nHNtq/I8J8RxHLg10bQxOA/DkHBIX1OycXbOdn0vgbZt895ppUO2aQK8LDPhvPOEDmAyG635URJnVsgcxy5gYmdvwbiUVFAgAYHOzJw7003jFGh7wg3xCXCgzRvCUDw30zh2HcwoeIhgn0DMGH2eIeqc0H7EmiMt42LmZQ60acE0zTGTD5mts6IZtHm+3+8C5rmsyltxg4XwVFp9qesjbZyWZREwrKR+ycwrN/IKzPYhzbHvJzj2RgltvDmQjQ2qsFIwDvQ/1DxNSmsu9xPsk6oq0VNahx6AcdqiIcGVkapK6Y21fVVV9gMc1KYZT09PDClnxi4vis8+B8GUYmUfBFuWcRih/ZXZdB1/4zjEmget9TQvZ83eh5q7bl03UUTatu/HWTNnRneQMYitksCiNjyZ33UT8ERoAskgBDBIPEQwvKUTqBXH08tX8YitGuOEHdFO2kHtjxnicymKQuSJ4+lfXl4ul9fP4W2aWkb1BKMwMwiY5Owhxi17F62OJiPJyiueUzQ2CRykSK1VcSugXVd1lmV892maRtr19XrlhuqK4oZGogjA/6n9AH2sBjRgAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 15 13 39 14" title="" data-src="/static/2021-12-15-13-39-14-e964d4aa205be3bb736a3ec31baa91ee-2a196.png" data-srcset="/static/2021-12-15-13-39-14-e964d4aa205be3bb736a3ec31baa91ee-ac3c7.png 200w,\n/static/2021-12-15-13-39-14-e964d4aa205be3bb736a3ec31baa91ee-daea7.png 400w,\n/static/2021-12-15-13-39-14-e964d4aa205be3bb736a3ec31baa91ee-2a196.png 762w" data-sizes="(max-width: 762px) 100vw, 762px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-15-13-39-37-4fbc123eacb7a79030b0f8761b26bc35-dbf5d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 789px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.7769328263625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABUklEQVQ4y5WTyXKDMBBE/f9faaiUY5DQvm+4QU4qFS6WODBIeprpUXPTxt7vs5BqJXSev5SxPsTW2v7BuMUYrbVtb855Z137GR/BIQTwiBCUUsZgkJzxUqpzDjymBuCcs9a61hOOse0jmVNKSqlSCySneLSq4vk8c/AeCX0I77L3Ec29bO89SogxjTVMCFlOWEoRYxiAjTHTNOVSBM5QElNXzf3zeugNDgGccuaCS9nhkW4jOe4ZZkHD6jn+wkrpdSVwMaXs+SQ+phAT9r81o08AQKLz1/IopTA/DE8IfTy+Ic5Yh/3vq0Lm3m1IuMJaK845ArjIWqOkPP6FcwPgwyS1lNDv+eJtmOfXglobYw3SwEqn5pyEgLeLNX22/dMMC3HOsIocjHEpRK/0gHHexhiEzdNECNnotiwLoRQxeon7U1qxjaFyhtdGl2U91ghxPrwA9lblrIeGmsAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 15 13 39 37" title="" data-src="/static/2021-12-15-13-39-37-4fbc123eacb7a79030b0f8761b26bc35-dbf5d.png" data-srcset="/static/2021-12-15-13-39-37-4fbc123eacb7a79030b0f8761b26bc35-604dc.png 200w,\n/static/2021-12-15-13-39-37-4fbc123eacb7a79030b0f8761b26bc35-70418.png 400w,\n/static/2021-12-15-13-39-37-4fbc123eacb7a79030b0f8761b26bc35-dbf5d.png 789w" data-sizes="(max-width: 789px) 100vw, 789px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="一些补充说明"><a href="#%E4%B8%80%E4%BA%9B%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一些补充说明</h2>\n<p>微软正黑体是一款全面支持 ClearType 技术的 TrueType 无衬线字体，用于繁体中文系统。相对应地，中国大陆地区用的是微软雅黑。但由于中国大陆和中国港、澳、台地区在各自的文字规范中对汉字的写法规定有很多细节上的不同，所以这两套字形在正式场合是不能混淆使用的。</p>\n<p>我们平常所说的“宋体”，指的都是“中易宋体”，英文名称 SimSun，“黑体”类似的是“中易黑体”。在 OS X 常见内置中文字体中我罗列了一个“宋体-简”，需要注意的是，这个“宋体- 简”和我们平常所说的“宋体”并不是同一个字体，其英文名称是“Songti SC”，字形表现也有差异。</p>\n<p>OS X 也就是苹果操作系统的字体名称中经常会出现“SC”，这个“SC”指的是“简体” （simplified chinese）的意思，相对应的还有“TC”，指的是“繁体”（traditional chinese）的意思。</p>\n<h1 id="字体家族其他成员"><a href="#%E5%AD%97%E4%BD%93%E5%AE%B6%E6%97%8F%E5%85%B6%E4%BB%96%E6%88%90%E5%91%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字体家族其他成员</h1>\n<h2 id="貌似粗犷、实则精细无比的-font-weight"><a href="#%E8%B2%8C%E4%BC%BC%E7%B2%97%E7%8A%B7%E3%80%81%E5%AE%9E%E5%88%99%E7%B2%BE%E7%BB%86%E6%97%A0%E6%AF%94%E7%9A%84-font-weight" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>貌似粗犷、实则精细无比的 font-weight</h2>\n<p>font-weight 都支持哪些属性值。具体如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66316443878358650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 平常用的最多的 */\nfont-weight: normal;\nfont-weight: bold;\n/* 相对于父级元素 */\nfont-weight: lighter;\nfont-weight: bolder;\n/* 字重的精细控制 */\nfont-weight: 100;\nfont-weight: 200;\nfont-weight: 300;\nfont-weight: 400;\nfont-weight: 500;\nfont-weight: 600;\nfont-weight: 700;\nfont-weight: 800;\nfont-weight: 900;`, `66316443878358650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 平常用的最多的 */</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>\n<span class="token comment">/* 相对于父级元素 */</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> lighter<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> bolder<span class="token punctuation">;</span>\n<span class="token comment">/* 字重的精细控制 */</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 100<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 200<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 500<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 600<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 700<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 800<span class="token punctuation">;</span>\n<span class="token property">font-weight</span><span class="token punctuation">:</span> 900<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果使用数值作为 font-weight 属性值，必须是 100 ～ 900 的整百数。这里的数值关键字和字母关键字之间是有对应关系的，例如，font-weight:400 实际上等同于 font-weight: normal，font-weight:700 等同于 font-weight:bold。</p>\n<p>因此 400 和 700 是文字粗细与否的重要临界点，加上最小的 100 和最大的 900，就构成了 font-weight 完整的字重临界点。知道这个有什么意义呢？意义就在于 lighter 和 bolder 这两个具有相对特定的关键字就是基于这 4 个临界点进行解析和渲染的。</p>\n<p>以下是 lighter 和 bolder 解析规则表</p>\n<table>\n<thead>\n<tr>\n<th align="center">继承的值</th>\n<th align="center">bolder</th>\n<th align="center">lighter</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">100</td>\n<td align="center">400</td>\n<td align="center">100</td>\n</tr>\n<tr>\n<td align="center">200</td>\n<td align="center">400</td>\n<td align="center">100</td>\n</tr>\n<tr>\n<td align="center">300</td>\n<td align="center">400</td>\n<td align="center">100</td>\n</tr>\n<tr>\n<td align="center">400</td>\n<td align="center">700</td>\n<td align="center">100</td>\n</tr>\n<tr>\n<td align="center">500</td>\n<td align="center">700</td>\n<td align="center">100</td>\n</tr>\n<tr>\n<td align="center">600</td>\n<td align="center">900</td>\n<td align="center">400</td>\n</tr>\n<tr>\n<td align="center">700</td>\n<td align="center">900</td>\n<td align="center">400</td>\n</tr>\n<tr>\n<td align="center">800</td>\n<td align="center">900</td>\n<td align="center">700</td>\n</tr>\n<tr>\n<td align="center">900</td>\n<td align="center">900</td>\n<td align="center">700</td>\n</tr>\n</tbody>\n</table>\n<p>然而很多人发现 font-weight 无论是设置 300、400、500 还是 600，文字的粗细都没有任何变化，只有到 700 的时候才会加粗一下，感觉浏览器好像不支持这些数值，那么搞这么多档位不就是多余的吗？</p>\n<p>实际上，所有这些数值关键字浏览器都是支持的，之所以没有看到任何粗细的变化，是因为我们的系统里面缺乏对应粗细的字体。尤其我们做桌面端项目时，大部分用户都是使用 Windows 系统，而 Windows 系统中的中文字体粗细就一个型号，如“宋体”，或者说“微软雅黑”，因此，最终的效果就是 CSS 层面的“加粗”和“正常尺寸” 两种表现。</p>\n<p>假如我们的操作系统安装了该字体家族全部的字重字体，则设置 300、400、500 时，彼此之间就能看出明显的变化了。例如，OS X 系统中的“苹方”，又如我这里即将要演示的“思源黑体”。“思源黑体”是一款免费的开源字体，我自己电脑上的版本有 7 个字重，如图 8-14 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-22-39-31-23bd8a6cede3dd198c7fdd0bbb1c9249-db488.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 292px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.35616438356165%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACwklEQVQ4y5VT2XbaMBTk/7+pUILjGGIw4H2VvNuSbQJhS8OWEdCXvlUHOMjS3Lkzd9wzTNfzPEWWtZmmqu+Dfl8aSaORpLwp4/F49PIykobD38PXV/lNeZtpGucc94/H4+126xGaHA6Hqix403RdV1dVVZRFUbCasbouyxJHZYGn2NWHO6ZpGkAE2PXpx8fa91xCKCXE1HXLNG3Ldh03DEPTMgPfcVwHDx3Lmc+mEaG/BoPtdivANE62ux2rq6btOON1VYIcfJyJVdV1w3lV1WDLs4wSulp9hGH0aKHneFHXrWwTDGEQBMv5XF8s8bFMC+S6oVuGoS+XlmUTQpbLxel8WnXds20ap7vdHuVXKzzsQCrEMcZZ07VdzcDJob+E7rpu2wYYnD8N8wICzZ7jRGEURaEQbAjNnuP6vm/ZNo1CbTrzPc+yHbgHDPvrXI/EKdRnacphd9OkcZKnaRzH0FnkBerFNPLDKAwJjOjaNqZAZH++vgTYD+jm8zOJaZKkMaXQjQ+JSBSEaZphpWmKR7btCFSSRISkWf71AAchDFwBkGV5kiboP/B81/VgLGgdsXWDIEKVAFPFMKOwqvnxeDcMbR4ORy6MwbBaEZJSRINVDC6KacFCxtfrdVVUDW82mzXjzdOwxdJG1dm7quvGYrGQJUkRQRyrExWBVRSEVBlJkjySVVU1Let9qgaB/wTzpkX5okAEMqSyKiv4BOoiz/Fb30MC3cgfTvO8wOW2bc/nswBfr9fb/6/L5QJ8z7ZtwzAQ4+l0+v39jZxgTrIsjxWl3+8Ph0NN0waDQZ7nIER3OEXUgEJTPXzFO8QYjk+nE6puNhsx3jh2XRcvIC7g/+W+IBWh2O/3GBAS2nu08Wget9EFCkMtCLHFqGA/pXQymQD8T/NC86MqNkmSAIlUgA1gvCfAoy/Ums/nD5MeNNf7+gFMpcUwIPT+OgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 22 39 31" title="" data-src="/static/2021-12-19-22-39-31-23bd8a6cede3dd198c7fdd0bbb1c9249-db488.png" data-srcset="/static/2021-12-19-22-39-31-23bd8a6cede3dd198c7fdd0bbb1c9249-b8b66.png 200w,\n/static/2021-12-19-22-39-31-23bd8a6cede3dd198c7fdd0bbb1c9249-db488.png 292w" data-sizes="(max-width: 292px) 100vw, 292px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>此时，应用如下 HTML 和 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41343026686240520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p class=&quot;f100&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f200&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f300&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f400&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f500&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f600&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f700&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f800&quot;>轻如鸿毛，重如泰山</p>\n<p class=&quot;f900&quot;>轻如鸿毛，重如泰山</p>\n<style>\n   p {\n      font-family: \'Source Han Sans CN\';\n   }\n   .f100 {\n      font-weight: 100;\n   }\n   .f200 {\n      font-weight: 200;\n   }\n   .f300 {\n      font-weight: 300;\n   }\n   .f400 {\n      font-weight: 400;\n   }\n   .f500 {\n      font-weight: 500;\n   }\n   .f600 {\n      font-weight: 600;\n   }\n   .f700 {\n      font-weight: 700;\n   }\n   .f800 {\n      font-weight: 800;\n   }\n   .f900 {\n      font-weight: 900;\n   }\n</style>`, `41343026686240520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f100<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f200<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f300<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f400<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f500<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f600<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f700<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f800<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>f900<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>轻如鸿毛，重如泰山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'Source Han Sans CN\'</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f100</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 100<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f200</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 200<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f300</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 300<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f400</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 400<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f500</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 500<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f600</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 600<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f700</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 700<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f800</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 800<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.f900</span> <span class="token punctuation">{</span>\n      <span class="token property">font-weight</span><span class="token punctuation">:</span> 900<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果可以看到明显的字重变化，而不是单纯的加粗和正常两种形态，如图 8-15 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-22-41-24-9a79d11ff8cfbf8877a2be9071bc9aeb-a4730.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 357px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 96.63865546218487%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC70lEQVQ4y52TWVPaUBTH/bzt9As4dayj41SppVi1GkAFJKGalMWtoh21ZZPVkAVISAhZIBsEiPjgONpb2/Ghk770PNy585/zu/9zztwz8fj4+PDwAM7hcHh9XSEpCidJ/LpM01RHVRVZzheuCIrECaLeaNB1xh7Zz8jE863f79WZmihJvCgqsqSq6uhmfHs7JmiqLUlMk5MVpckLA2v4D7hRawkCw/Ntge90FMCOxzdVqtrkuDrDipJYZ5vOsNXvUxTJclyT54UW1xJa9vj2xh4VSyWggJpFUWoJ7cHA0dk0c5k06LlKETRNEBRh9KzR0Lq4OCcpulAqkDWqhOO9vuUAm4Z+dnqau8qlUplMOp3NZM3+0OqZiXg8m7s6PUnm88VSsdzr9Zxg0zhNJlNpENlCPp9JZVTN7Bk6uoumM9nL8/NKpZLL5JxhQ9cRGN7FUDSR+HZ2FovGuJZo6t1NyIfGEjswfHx0mECjmqo5w+je3sHR0cHx8UkyebB/oKia1pGh9Y3Dr0kEgU++nlx+/2GYpgOs69ra2mowtAN/jmAYFggEaywvCdz83FxkD11e9sBhBI3Gu5ruBGuqz+cNhkIhBI7HE+FQWBAVqcXNTE+HYMSz/AGBf8GqZjhPO7C9DcMRLBbd308gSIQDdJt/53LtYTG/F/qCYfuHR5ruBOuqOjM15fZ4IMgXCu0sLrwt4wTXoF+9fOHbCszPzq5+WvMHtlTHgXU7intpCbS6tR0Mh2EIggRRFnn2zfQ0HNldWnRtbm3uRjFnZ9MwlhYXP66sQF4/aNztfn9+maqWi68nJzd8ftfCwvrGunfTr/01sP+OiWw222g0BEHgeX48Htu2TZJUoVAolUrgSxWLRZZlb2ybYVlFUWq1Gk3TnU4HIOA+ASTDMMCnsyzr7u7uaTf7QJRlGYhgq4F+f3/f7XZ1XZckCdgMnsI0zT9la5oGngAnSAUYyAMltNvt0WgErBiGAW44jlNg56pVUNRv6idORdA9NIpEGwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 22 41 24" title="" data-src="/static/2021-12-19-22-41-24-9a79d11ff8cfbf8877a2be9071bc9aeb-a4730.png" data-srcset="/static/2021-12-19-22-41-24-9a79d11ff8cfbf8877a2be9071bc9aeb-11629.png 200w,\n/static/2021-12-19-22-41-24-9a79d11ff8cfbf8877a2be9071bc9aeb-a4730.png 357w" data-sizes="(max-width: 357px) 100vw, 357px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>也就是说，font-weight 要想真正发挥潜力，问题不在于 CSS 的支持，而在于是否存在对应的字体文件。如果没有对应的字体文件，我又想有多档字重效果，该怎么办呢？可以试试看看之后的 font-face 章节</p>\n<h2 id="具有近似姐妹花属性值的-font-style"><a href="#%E5%85%B7%E6%9C%89%E8%BF%91%E4%BC%BC%E5%A7%90%E5%A6%B9%E8%8A%B1%E5%B1%9E%E6%80%A7%E5%80%BC%E7%9A%84-font-style" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具有近似姐妹花属性值的 font-style</h2>\n<p>font-style 表示文字造型是斜还是正，与 font-weight 相比，其属性值就要少很多，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90419950011156300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`font-style: normal;\nfont-style: italic;\nfont-style: oblique;`, `90419950011156300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>\n<span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>\n<span class="token property">font-style</span><span class="token punctuation">:</span> oblique<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>italic 和 oblique 这两个关键字都表示“斜体”的意思，差别在于：italic 是使用当前字体的斜体字体，而 oblique 只是单纯地让文字倾斜。如果当前字体没有对应的斜体字体，则退而求其次，解析为 oblique，也就是单纯形状倾斜。</p>\n<p>我们平常在 Web 上使用比较多的中文字体，如“宋体”“微软雅黑”等，是没有专门的倾斜字体的，因此，从最终表现上来看 font-style:italic 和 font-style:oblique 是没有区别的。但是，对于一些英文字体，如“Georgia”，情况就不一样了，因为“Georgia”有一个专门设计的斜体字体文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2003807533836665600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p class=&quot;i&quot;>Georgia italic</p>\n<p class=&quot;o&quot;>Georgia oblique</p>\n<p>Georgia normal</p>\n<style>\n   p {\n      font-size: 50px;\n      font-family: Georgia;\n   }\n   .i {\n      font-style: italic;\n   }\n   .o {\n      font-style: oblique;\n   }\n</style>`, `2003807533836665600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>i<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Georgia italic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>o<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Georgia oblique<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Georgia normal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">p</span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n      <span class="token property">font-family</span><span class="token punctuation">:</span> Georgia<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.i</span> <span class="token punctuation">{</span>\n      <span class="token property">font-style</span><span class="token punctuation">:</span> italic<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token selector">.o</span> <span class="token punctuation">{</span>\n      <span class="token property">font-style</span><span class="token punctuation">:</span> oblique<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果可以看出，两个“倾斜”有着明显的不同，例如非常明显的字母 g，属性值为 italic 时长得像鱼钩，而为 oblique 时长得像糖葫芦，如图 8-16 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-22-47-44-0e5f1d6d55a8367f8b53fe55881d7cb1-ff6e4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 479px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.57620041753654%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABsUlEQVQozz2SSdPBUBBF3///D5SFIXwxBWXBhoWFIlXGGBMUMU8RM8WRVH1voTrdr2+f2494v9+VSqVarU4mk+VyOZ1OCebzeafTmc1m6/W62Wz2ej2CfD5PsFgsLMvabDaXy0Wcz+d0Ok1BkqRMJhMMBrPZrCzLkUiEzGg0CofDf86RnDMejz+fz/V6pVE8n08mMIqxyJ9OJxpUVSUmzyV+t9utSwHX/X6n+Xa7/Zpfrxdtuq6vVitStm3zCRhyCFFFvdFodLvder0O6n6/5w7wVAUyqVSqWCyClEgksBCPx8FOJpPk6YnFYoFAABf8KopCiQBrSPwmm6aJEqMAYxOtVqtUKgHP5hhlOse9UCgU8EyeazgSj8ej3W5TdgmxBM/hcDgej0BRJcOLuBuiREy13+9TEtiDEIxQKASzz+eDDbBoNJrL5Wq1msfjgd/r9WLH7/fjjipPyySBEiQoDYdDeIjL5TJauGWLGOFtDcPABavmDu8PKRYgEpBgHSow3OD/wLnb7UjCCSCfeCFmEZZzxGAwYALCqPCeDOQvpWkaN1gSnwyEi+E8ErukigpdlL6bhTe18QjkZgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 22 47 44" title="" data-src="/static/2021-12-19-22-47-44-0e5f1d6d55a8367f8b53fe55881d7cb1-ff6e4.png" data-srcset="/static/2021-12-19-22-47-44-0e5f1d6d55a8367f8b53fe55881d7cb1-d5807.png 200w,\n/static/2021-12-19-22-47-44-0e5f1d6d55a8367f8b53fe55881d7cb1-dba8d.png 400w,\n/static/2021-12-19-22-47-44-0e5f1d6d55a8367f8b53fe55881d7cb1-ff6e4.png 479w" data-sizes="(max-width: 479px) 100vw, 479px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>之所以会专门为一个字体设计倾斜字体，就是因为单纯倾斜的时候不好看，比方说上面的 “Georgia” 字体，当字号比较小同时文字倾斜的时候，字符会挤作一团，疏密不规则，可读性比较糟糕。相比之下，专门设计的“Georgia”斜体阅读体验就要好很多。再加上没有斜体字体时 italic 表现会和 oblique 一致，因此，我们在实际开发的时候，几乎没有任何理由需要使用 font-style: oblique。</p>\n<h2 id="不适合国情的-font-variant"><a href="#%E4%B8%8D%E9%80%82%E5%90%88%E5%9B%BD%E6%83%85%E7%9A%84-font-variant" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不适合国情的 font-variant</h2>\n<p>font-variant 是一个从 IE6 时代就过来的 CSS 属性，实现小体型大写字母，两个属性值要么 normal，要么 small-caps，font-variant: small-caps 就是可以让英文字符表现为小体型大写字母。</p>\n<p>代码示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40803131902642020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`http://www.<span style=&quot;font-variant:small-caps&quot;>css-world.com</span>/`, `40803131902642020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html">http://www.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">font-variant</span><span class="token punctuation">:</span>small-caps</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>css-world.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-22-51-50-f3904a07d8406945f66f7f7a2917a761-fb41b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 334px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 8.982035928143713%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAfUlEQVQI1w3IUQqCQBAAUO9/EukAkhmFGG4alta2o4KzA21qI62LXSDf5/PaBuRTzdY654hIa0IixI6ZnZvX+Vo7mH6FGgfmzzQtv8WY18jsJadk4/v3qnr3I2GX55fiWmTnTEEt5SPcRRJqUOpWlkG4DfZRLFKARoj0GB/+3cJlS8I4QOAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 22 51 50" title="" data-src="/static/2021-12-19-22-51-50-f3904a07d8406945f66f7f7a2917a761-fb41b.png" data-srcset="/static/2021-12-19-22-51-50-f3904a07d8406945f66f7f7a2917a761-7193b.png 200w,\n/static/2021-12-19-22-51-50-f3904a07d8406945f66f7f7a2917a761-fb41b.png 334w" data-sizes="(max-width: 334px) 100vw, 334px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>也就是大小跟小写字母一样，但样式是大写。</p>\n<h1 id="font-属性"><a href="#font-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>font 属性</h1>\n<h2 id="作为缩写的-font-属性"><a href="#%E4%BD%9C%E4%B8%BA%E7%BC%A9%E5%86%99%E7%9A%84-font-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>作为缩写的 font 属性</h2>\n<p>如果在一段 CSS 代码中发现了 font 属性，八九不离十就是利用 font 属性进行文本相关样式的缩写。可以缩写在 font 属性中的属性非常多，包括 font-style、font-variant、 font-weight、font-size、line-height、font-family 等。完整语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41472971695954320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`font: [ [ font-style || font-variant || font-weight ]? font-size [ / line-height ]? font-family ];`, `41472971695954320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">font</span><span class="token punctuation">:</span> [ [ font-style || font-variant || font-weight ]? font-size [ / line-height ]? font-family ]<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>|| 表示或，? 和正则表达式中的 ? 的含义一致，表示 0 个或 1 个。仔细观察上面的语法，会发现 font-size 和 font-family 后面没有问号，也就是说是必需的，是不可以省略的。这和 background 属性不一样，background 属性虽然也支持缩写，但是并没有需要两个属性值同时存在的限制。</p>\n<p>因此，如果你的 font 属性缩写无效，检查一下 font-size 和 font-family 这两个属性是否同时存在。例如，下面 CSS 语句看上去写了很多属性，实际却是无效的，因为缺字体：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53817481158787170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.font {\n   font: normal 700 14px/20px;\n}`, `53817481158787170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.font</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> normal 700 14px/20px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>而下面这个反而是有效的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51976414277842880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.font {\n   font: 14px \'☺\';\n}`, `51976414277842880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.font</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> 14px <span class="token string">\'☺\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>需要注意的是，font 缩写会破坏部分属性的继承性。举个简单的例子，假设你的页面行高是 20px，当你使用了下面的 CSS 后：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30128738992680493000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.font {\n   font: 400 30px \'Microsoft Yahei\';\n}`, `30128738992680493000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.font</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> 400 30px <span class="token string">\'Microsoft Yahei\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>.font 元素的行高 line-height 属性值就被重置为了 normal，而不同浏览器上 line-height: normal 是不一样的，因此，在使用 font 缩写的时候，如果不设定行高值，一定会出现不兼容的问题。换句话说，如果你的 CSS 代码原本就没有 line-height 属性，使用 font 缩写反而是不推荐的。</p>\n<p>另外，还有一个令人很头疼的问题，就是 font 缩写必须要带上 font-family，然而，原本真实继承的 font-family 属性值可能会很长，每次 font 缩写后面都挂一个长长的字体列表，有什么小技巧可以避免吗？</p>\n<p>这里有两个方法。</p>\n<ol>\n<li>\n<p>我们可以随便找一个系统根本不存在的字体名占位，如字母 a，或者特殊一点，用笑脸表情 ☺，然后再设置 font-family: inherit 来重置这个占位字体。例如，我们想把字号和行高合并缩写，就可以这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23045112878602780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.font {\n  font: 30px/30px \'☺\';\n  font-family: inherit;\n}`, `23045112878602780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.font</span> <span class="token punctuation">{</span>\n  <span class="token property">font</span><span class="token punctuation">:</span> 30px/30px <span class="token string">\'☺\'</span><span class="token punctuation">;</span>\n  <span class="token property">font-family</span><span class="token punctuation">:</span> inherit<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>是不是有点拆东墙补西墙的感觉？这么做主要是因为 font 缩写不能使用 inherit 等全局关键字。</p>\n</li>\n<li>\n<p>利用 @font-face 规则将我们的字体列表重定义为一个字体，这是兼容性很好、效益很高的一种解决方法，会在之后详细介绍</p>\n</li>\n</ol>\n<h2 id="使用关键字值的-font-属性"><a href="#%E4%BD%BF%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97%E5%80%BC%E7%9A%84-font-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用关键字值的 font 属性</h2>\n<p>font 属性除了缩写用法，还支持关键字属性值，这个怕是很多人都不知道的。其语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19963738704367206000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`font: caption | icon | menu | message-box | small-caption | status-bar;`, `19963738704367206000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">font</span><span class="token punctuation">:</span> caption | icon | menu | message-box | small-caption | status-bar<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果将 font 属性设置为上面的一个值，就等同于设置 font 为操作系统该部件对应的 font，也就是说直接使用系统字体。</p>\n<p>根据 W3C 官方维基的解释，以及我自己在 Windows 系统下的测试，各个关键字的含义如下。</p>\n<ul>\n<li>caption：活动窗口标题栏使用的字体。</li>\n<li>icon：包含图标内容所使用的字体，如所有文件夹名称、文件名称、磁盘名称，甚至浏览器窗口标题所使用的字体。</li>\n<li>menu：菜单使用的字体，如文件夹菜单。</li>\n<li>message-box：消息盒里面使用的字体。</li>\n<li>small-caption：调色板标题所使用的字体。</li>\n<li>status-bar：窗体状态栏使用的字体</li>\n</ul>\n<p>使用示例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35173092962220777000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.menu {\n   font: menu;\n}`, `35173092962220777000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.menu</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> menu<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>需要注意的是，使用关键字作为属性值的时候必须是独立的，不能添加 font-family 或者 font-size 之类的，这和 font 属性缩写不是一个路子。如果混用，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5166433620482147000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.menu {\n   font: 14px menu;\n}`, `5166433620482147000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.menu</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> 14px menu<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>则此时的 menu 是作为自定义的字体名称存在的，而不是表示系统的 menu 菜单字体。</p>\n<p>实际上，font 关键字属性值本质上也是一种缩写，里面已经包含了诸如 font-size 等信息，如图 8-17、图 8-19 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-23-10-10-2feb81c5ba170d9e80859d57062f94e6-c328b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.820895522388064%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABBUlEQVQY02WQx27EMAxE9f/fl4UPVnFRody9lnvZjBMkWSA6EALIx5khk1IKIdI0lUpxITx551wI47qur5+ntf54PHgcR1EkhbTGNE3T9z0zxnhfVFVVFHcdhuE4juu6tm37hT2RShQmsyyz1j6fTwyM48i00UT+W7Dregju+z7P87Is/2EYtNZ1fT9PMyqDJWBFAZiwom1bWKrrBvwf7D0wcpTnORFBGR7xZ0ZrOAFvrA1hAAvb53m+23bOxjwGr6QEg91Vecdk90oiWFJK1XWNCLgE9KdpAoZsqGVZogsNecMaIe/nHOu6DhNoc84RIUkSDIF8t4382BhCSJTCzfSXEix8AkJPhPYhzRlvAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 23 10 10" title="" data-src="/static/2021-12-19-23-10-10-2feb81c5ba170d9e80859d57062f94e6-fee1c.png" data-srcset="/static/2021-12-19-23-10-10-2feb81c5ba170d9e80859d57062f94e6-a67b7.png 200w,\n/static/2021-12-19-23-10-10-2feb81c5ba170d9e80859d57062f94e6-0b187.png 400w,\n/static/2021-12-19-23-10-10-2feb81c5ba170d9e80859d57062f94e6-fee1c.png 800w,\n/static/2021-12-19-23-10-10-2feb81c5ba170d9e80859d57062f94e6-c328b.png 871w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-23-11-15-278767d697e6edde5b28f75ceeefa4ae-4fbc8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 431px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.35730858468676%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAB8UlEQVQoz0VSiZKjIBD1/79ttiaJOcoJgpyKFyIeSTbHPnWqtlNFALv7HU1EruTr68/pdDocDqc1vr938SFmjGmtkuRHSqm1lmsIKSmlZVl2XVdVVcQ5NyYvS1vkeV3XVV0Zbay1QxjGaarqep7n+9/HNM/DMNzuN9/7+/3++Xycc1FKSJJcs4ylKUEjxugPjpTWVeVa17muda5t26Zpm7a1tng8Hp81lmIUKKVxC3xrwahUUoGF934cxxDC7XYD5jROOOISRN7v928xpWmaUil4xhi6KKVSQtERaMF7yEA2akLfu4WCg9r/yIxSQinM4DxDJUyhKVuLXe/7PC/wgyNN64Zx6Hzn0WWRURtjooyhRoMnLLWFLYoCnuKv73ugNXVT2hLJOMI/3EDIMIR5mpC8IAupBAeyNDqH4IxzayskFSYHiMlz2AbBC+PO+XVIEA0tEYVghTEqISQ8AwvBBZwLfaiaJaBtWp3rkb7Ud8/nE5pBJxKc/5CUUjBgKMPbuF6J0hr8Oc5CwAeMXa9h9NIaZeiDRxFt1k3QEwKmj2eASWCPG/iMFcfX6wU0fMUGyduKiLYdfI7jGE8PUHgG2BNCgBnHh+PxuNvtoBNQGwXnlmmh6S/ydtgoJElyuVyyLDufz9hjRdP9fo/iDXbLRPwDfcnMf5qKYxQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 23 11 15" title="" data-src="/static/2021-12-19-23-11-15-278767d697e6edde5b28f75ceeefa4ae-4fbc8.png" data-srcset="/static/2021-12-19-23-11-15-278767d697e6edde5b28f75ceeefa4ae-3b445.png 200w,\n/static/2021-12-19-23-11-15-278767d697e6edde5b28f75ceeefa4ae-b6b36.png 400w,\n/static/2021-12-19-23-11-15-278767d697e6edde5b28f75ceeefa4ae-4fbc8.png 431w" data-sizes="(max-width: 431px) 100vw, 431px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这 3 张图透露出不少重要的信息。从 Windows 下 Chrome 和 IE 浏览器部分关键字的字体和字号表现不一样可以看出，同一系统下浏览器的表现是有差异的。既然 font 关键字属性值的样式表现是跟着系统走的，那为何同一系统下不同浏览器的表现会不一样呢？</p>\n<p>显然是某个浏览器出现了问题。后来，通过设置修改 Windows 系统相关控件的默认字体我发现，这次是 Chrome 浏览器拖了后腿。caption、icon、message-box 这 3 个关键字在 Windows 系统下的 Chrome 浏览器中似乎是无效的，并不会实时跟着系统字体走。</p>\n<p>而所有这些问题在 Firefox 和 IE 浏览器中一个都没有，表现非常一致，非常符合预期，例如，修改“图标”字体为“思源黑体”，如图 8-20 所示，则所有文件名称全部变成了“思源黑体”，同时 font: icon 所在元素 font-family 计算值也成了“思源黑体”，如图 8-21 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-23-14-51-eb81252f8bc0145b4b704c36203fa8f4-7c992.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 18.28463713477851%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAkElEQVQI12VPOQ7DIBDk/2+LOzoHZJAAmcNcokGCZBQUF8kUq9md2YtQSkMI3vvwhdY6xvT6YM55x38QxlgpJeecUoox1lpbazmXMcZvD9I57yII2R4b5/w4hLV2rcU4EMi9d0ioCCGcczgH07EGKlIQcp7n/twZZ6sNVaXUisYYnCOFhHu1xeuSUuJHOOF/A2QL4JyByeKIAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 23 14 51" title="" data-src="/static/2021-12-19-23-14-51-eb81252f8bc0145b4b704c36203fa8f4-fee1c.png" data-srcset="/static/2021-12-19-23-14-51-eb81252f8bc0145b4b704c36203fa8f4-a67b7.png 200w,\n/static/2021-12-19-23-14-51-eb81252f8bc0145b4b704c36203fa8f4-0b187.png 400w,\n/static/2021-12-19-23-14-51-eb81252f8bc0145b4b704c36203fa8f4-fee1c.png 800w,\n/static/2021-12-19-23-14-51-eb81252f8bc0145b4b704c36203fa8f4-7c992.png 1061w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>考虑到 Chrome 浏览器的市场占有率，我们在使用 font 属性的时候，要避开 caption、icon 和 message-box 这 3 个关键字。</p>\n<p>对于不同的操作系统，字体表现不一样，这是预料之中的，毕竟使用系统字体，而不同系统默认字体肯定是不一样的；然后字体大小也不一样。例如，在 Windows 下 Chrome 的 caption 字体大小 16px，而在 OS X 下却只有 13px。因此，在实际使用时，我们还需要在下面再设定一下 font-size 大小来保证一致性。照理讲，直接这样设置就可以了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98812636867088200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font: menu;\n   font-size: 16px;\n}`, `98812636867088200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> menu<span class="token punctuation">;</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是，实际上 IE8 浏览器会莫名其妙地忽略这里的 font-size: 16px，因此，一般都是下面这样处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46933596018164800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font: menu;\n}\nbody {\n   font-size: 16px;\n}`, `46933596018164800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> menu<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>除了 caption、icon、menu、message-box、small-caption 和 status-bar，还有很多其他非标准的关键字，如 button、checkbox、checkbox-group、combo-box、desktop、dialog、document、field、hyperlink、list-menu、menu-item、menubar、outline-tree、password、pop-up-menu、 pull-down-menu、push-button、radio-button、radio-group、range、signature、tab、tooltip、window 和 workspace。不过，这些关键字浏览器大多不支持，尽管 Firefox 浏览器支持一部分，但是需要添加私有前缀 -moz-。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82596118341306970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`font: -moz-button;`, `82596118341306970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">font</span><span class="token punctuation">:</span> -moz-button<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>因此，它们的实际应用价值不大。另外，WebKit 浏览器还支持其他关键字，如 font: -webkit-control，如下图所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-12-19-23-20-00-bd6052472aca2dc0286023e9454c9225-f5a61.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 226px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.38938053097345%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB60lEQVQoz01Si46bMBDk//+pUlWpTXXNpWpCHryOtzGYRzAGG0Ogc0l6vZVlrWFnZ2ZtoyzLjFLKWKdUkmUZzQllGWUJoUVZN62QahKD6oTsein+LRylGo11XSetVV0rSmXTJEXz/eXw5dvL1x+vppPsTHezPbpxWfUrbfSnNeWVMKZ5XuZ5jGPlOCLPeS/jNLMcz3J9WtRYYURiUrCad/2opkXpm9LLOK9cDAbnfJ7n9R63260XIvD9y/li23Zd11VVkYwUeZ4RIqVcPwWOhhACRaLrcEZeVXUUxQA7rvfIKc2v1/Z6vcZxQrIsTVKlFIqHYTCKorAdJ0nSdVnqe2B+juO67+Aqz3NCCGNlyUp0YYw1TaO1fjI/5OowHCyr9wP88zzPPJin0xngKAwBC4LAsuzgHrD2XzY8o9NtHBelJqU473Bfb29eFEZoBCow4zpRVhQMQrBD3RMMAx/NpmmCE4BB7r/5bduCPE1TfEFZdY/yHk/PaHa+XGjBeilHrTvO77IPp9MJgt/dlhWoIPhoHh+cy7I8wdAsWs6jSOIyuq7tuiAIMeogDMMoRl4wFsUxJg8LbcshAYKxA2iggRqGCcJcd6AUM/2z3e42P/e7nbnf//61PR8Or5uNfb7MegIhHsU4QqIeBvkXWGSZcLi35d4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 12 19 23 20 00" title="" data-src="/static/2021-12-19-23-20-00-bd6052472aca2dc0286023e9454c9225-f5a61.png" data-srcset="/static/2021-12-19-23-20-00-bd6052472aca2dc0286023e9454c9225-a2845.png 200w,\n/static/2021-12-19-23-20-00-bd6052472aca2dc0286023e9454c9225-f5a61.png 226w" data-sizes="(max-width: 226px) 100vw, 226px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="font-关键字属性值的应用价值"><a href="#font-%E5%85%B3%E9%94%AE%E5%AD%97%E5%B1%9E%E6%80%A7%E5%80%BC%E7%9A%84%E5%BA%94%E7%94%A8%E4%BB%B7%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>font 关键字属性值的应用价值</h2>\n<p>font 关键字属性值的价值如何呢？有没有合适的使用场景呢？有，并且相当适合！</p>\n<p>目前，非常多网站的通用 font-family 直接就是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85784548455813370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-family: \'Microsoft YaHei\';\n}`, `85784548455813370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'Microsoft YaHei\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>知道问题在哪里吗？这样一设置，就意味着所有操作系统下的所有浏览器都要使用“微软雅黑”字体。假如说用户的 iMac 或者 macbook 因为某些原因安装了“微软雅黑”字体，那岂不是这些系统原本更加漂亮的中文字体就不能使用了？</p>\n<p>于是，人们就会有这样的需求：希望非 Windows 系统下不要使用“微软雅黑”字体，而是使用其系统字体。怎么处理呢？</p>\n<p>一种方法是可以试试使用非标准的 -apple-system 等关键字字体，具体方法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95667625215064870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-family: -apple-system, BlinkMacSystemFont, \'Microsoft YaHei\';\n}`, `95667625215064870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> -apple-system<span class="token punctuation">,</span> BlinkMacSystemFont<span class="token punctuation">,</span> <span class="token string">\'Microsoft YaHei\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这能够一定程度上满足我们的需求，但是毕竟是非标准的属性值，说不定哪天就被浏览器舍弃了，因此若非迫不得已，还是少用为妙。</p>\n<p>顺便多说两句，实际上还真有标准的系统字体关键字，叫作 system-ui，使用示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24766902650289070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font-family: system-ui;\n}`, `24766902650289070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font-family</span><span class="token punctuation">:</span> system-ui<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在我写这段内容的时候，仅 Chrome 浏览器支持它（从版本 56 开始），并且，根据我的在 Windows 电脑上的测试，Chrome 浏览器的 system-ui 指的就是“调色板标题”对应关键字 small-caption 使用的字体，有点儿出乎我的意料。</p>\n<p>显然还有个更好的方法就是使用这里的 font 关键字，这是标准属性，10 年前浏览器就支持了，可以放心使用。CSS 代码如下（三选一即可）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18037270321925280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font: menu;\n}\nbody {\n   font-size: 16px;\n}\n\nhtml {\n   font: small-caption;\n}\nbody {\n   font-size: 16px;\n}\n\nhtml {\n   font: status-bar;\n}\nbody {\n   font-size: 16px;\n}`, `18037270321925280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> menu<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> small-caption<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> status-bar<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这几个声明就可以让各个系统使用各自引以为傲的字体，推荐最短的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71459088885410310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n   font: menu;\n}\nbody {\n   font-size: 16px;\n}`, `71459088885410310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> menu<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">body</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后，我要对 font 关键字属性值的用法做一个点评。</p>\n<p>让网页的字体跟系统走，对设计师而言，其实是一个比较冒险的做法，因为最终呈现的字体是不可控的。举个例子，某女生非常喜欢可爱风格，于是就把她的电脑主题变成了非常可爱的风格，菜单栏的字体全部变成那种很可爱的字体，此时，font: menu 所呈现的就不是“微软雅黑”，而是这个用户定义的“可爱字体”，这可能不是设计师想看到的，因为往往会跟自己的网页设计风格不一致。但是，转念一想，万一这是用户想看到的呢？既然用户把自己的主题设为该字体，那就说明这个用户对这个字体并不排斥，而是喜欢。当她浏览网页的时候，发现就你的网站呈现出了她喜欢的那种字体，你说会不会给用户一种“你懂我的心”的感觉呢？对用户而言，反而成了一种情感化的设计！</p>\n<p>另外，让网页的字体跟系统走，还有一个更加长远的好处。随着软件的不断发展，我们的操作系统的默认中文字体一定是越来越好看，如果网页的 font-family 定死为某个字体，用户就无法及时享受到新系统新字体带来的愉悦的视觉感受。举个例子，OS X 的默认中文字体其实已经变过好多次了，例如，你今天写了个页面，字体设置为很潮的“苹方”，过两年说不定会出来更好的名叫“梨方”的字体，我打包票，网站绝对是不会跟进的，因为大多数的线上项目维护都不会管 font-family 这种边边角角的事情，因此，就算很多年过去了，网站使用的依然是老字体。但是，如果使用的是 font 关键字属性值，就完全不会有这样的问题，网站字体能时时刻刻与时俱进。</p>\n<p>// TODO CSS 世界读书笔记待完成</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS世界强大文本处理能力/index.md absPath of file >>> MarkdownRemark",timeToRead:18,frontmatter:{date:"2021-12-14 14:07:08",path:"/css-world-text-processing/",tags:"前端, CSS, CSS世界, 读书笔记",title:"CSS世界强大文本处理能力",draft:null}},{excerpt:"…",html:'<h1 id="语法综述"><a href="#%E8%AF%AD%E6%B3%95%E7%BB%BC%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语法综述</h1>\n<p>语言中的标识符一般可以分为两类，一类用于命名语法、符号等抽象概念，另一类用于命名数据（的存储位置）。前者被称为“语法关键字”，后者则被称为“变量”和“常量”。</p>\n<p>由此引入了一个概念：绑定。从标识符的角度来说，绑定分为语法关键字与语义逻辑的绑定，以及变量与它所存储数据和位置性质的绑定。</p>\n<p>其中，语法关键字对语义逻辑的绑定结果，是对作用域的限定；变量对位置性质的绑定结果，则是对变量生存周期的限定</p>\n<h2 id="标识符所绑定的语义"><a href="#%E6%A0%87%E8%AF%86%E7%AC%A6%E6%89%80%E7%BB%91%E5%AE%9A%E7%9A%84%E8%AF%AD%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>标识符所绑定的语义</h2>\n<p>所谓声明，即约定数据的生存周期和逻辑的作用域</p>\n<ul>\n<li>纯粹陈述“数据”的过程，被称为变量和类型声明</li>\n<li>纯粹陈述“逻辑”的过程，被称为语句（含流程控制子句）。</li>\n<li>陈述“数据与（算法的）逻辑”的关系的过程，被称为表达式。</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-27-20-18-23-e74e56622481acc0c3632ceed54cba74-00ca1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 79.97601918465229%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAAB60lEQVQoz1WTC4/BQBSF5///p7UkVCphSbQlinqsxdKipd72Mydrs5Pgztxz7j33zDD3+/12uz0ej49m0w+Cfr/vVKuO45QrlVKp5NZq9UbjrVB4LxbLjuO6ruf7gKFANI/fdTqd2F+v1zzPL5cL2/1+fzgczufzIc+Jc7tIvShmMpmMx2O+u92u7/ufdgVBwPbLrl4YdjodtrPZjK3neagDP5/PDZ84jlerFQpJEEyn0yiKRqPRYrEg2+v1Wq1WvV5vt9vEg8GAw2+7zHa73Ww2aNvtdqhiGGJKrNdrztGWpiniUctEStFsOBxS2ojDKWgKAYGP8uPxqMEoAQGYfGKbZRnlYBl+OAUKk5gAbxhPckCoM2T5RyFSDAXmKZsEqpbLJQkppDOW6ArpAx8CZLacA4OVJInBwDAM0SwxdCbAEqDEdBYttYsAO2UqzQx7nFC3YRShghJYCk1DZlYthS524RY91czwAaEHAFqPBFVnu3gqQGkuMinRYrv+Oqs88Gf5JDnZgLqQmYJCKq0puGTwhgGIgDIDHuqSGAkvdHlplnEi8/imIZ0pQcpILeTXxRLjDU301HFBXsIkpZlhET9n1t+A/ughpgp3qJhzOijWFoH/XhhoCiMVMaQpR445lZI3chQYc5ECzOEPQe6C8347q6QAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 27 20 18 23" title="" data-src="/static/2021-09-27-20-18-23-e74e56622481acc0c3632ceed54cba74-fee1c.png" data-srcset="/static/2021-09-27-20-18-23-e74e56622481acc0c3632ceed54cba74-a67b7.png 200w,\n/static/2021-09-27-20-18-23-e74e56622481acc0c3632ceed54cba74-0b187.png 400w,\n/static/2021-09-27-20-18-23-e74e56622481acc0c3632ceed54cba74-fee1c.png 800w,\n/static/2021-09-27-20-18-23-e74e56622481acc0c3632ceed54cba74-00ca1.png 834w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>“符号（Symbol）”是 ES6 添加的新数据类型，可以同其他数据一样绑定给变量或标识符。</li>\n<li>表达式首先是与数据相关的，但因为存在运算的先后顺序，所以也有逻辑相关的含义。</li>\n<li>JavaScript 中的逻辑语句是有值的，因此它也是数据相关的。这一点与其他多数语言不一样。</li>\n<li>一些模块的实现方案与逻辑（例如流程控制）相关，例如 Node.js。但一些实现方案则是逻辑无关的，例如 ECMAScript 的静态模块机制就是如此，它只描述模块之间的依赖关系。</li>\n</ul>\n<p>除了“声明”在语义上对绑定内容的限制之外，当一个被声明的标识符（变量、常量或符号等）去绑定一个数据时，事实上还有其他两个方面的语义：数据（受作用域限制）的生存周期及可写性。这三者是 JavaScript 在</p>\n<ul>\n<li>用于显式数据声明的语句 let/var/const、函数声明与类声明</li>\n<li>for 语句、<code class="language-text">try...catch</code> 语句、赋值语句</li>\n<li>在函数调用和 new 运算符等语法中通过形式参数传入值</li>\n</ul>\n<p>这些语义中都存在着隐式或显式数据声明的原因：它们有着各自在“作用域、值和可写性”三方面的不同性质。</p>\n<p>从 ES6 开始提供了一些新的具有绑定标识符语义的语法，尽管在这几类绑定操作上存在着处理细节上的不同，但总体还是围绕上述三种性质来设计的，如表 2-2 所示</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-27-20-24-53-2acbc2f5dd068cd2ee7766a181d59700-68451.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.03550295857988%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABPUlEQVQoz1WQWWuDUBSE/f8/Jg8hD6FQCQbzUC+IpEFISI1Z3KLiRt2y9Iu3Kekgh/HcmbMp9ydutxvREMLZ7WzbfldVdTbT5nNN0z6EgHyuVn8yCeX+H23bdl1H/B4gf5u2resa/trmYfZ933Xdw+FA3O/3xOPxeDqdyBAZwTRNx3E8z0MpZev1erlchmGobLdb+wVCiLcBlmXBR6PRZDJBulgsILquG4YxHo+n0+lms3l0/nIcuhHjOKYeDSFFUQRBQKskSeBykDRNoyhCQxKuoGNKUjyfz+c8z8mihmRZdhnA2lVV9X1/vV55Yn8IGQWbXJIR2I3InXhumgYdheDYZFGqUJE8mbIsFYbYuS5mLsE8j/P2PV9/ueQD5MGZUzbHjO3XTBYbx2RsVsDTDsCfFwWKbsDrCNJcleUPGzPtQZzzD6sAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 27 20 24 53" title="" data-src="/static/2021-09-27-20-24-53-2acbc2f5dd068cd2ee7766a181d59700-fee1c.png" data-srcset="/static/2021-09-27-20-24-53-2acbc2f5dd068cd2ee7766a181d59700-a67b7.png 200w,\n/static/2021-09-27-20-24-53-2acbc2f5dd068cd2ee7766a181d59700-0b187.png 400w,\n/static/2021-09-27-20-24-53-2acbc2f5dd068cd2ee7766a181d59700-fee1c.png 800w,\n/static/2021-09-27-20-24-53-2acbc2f5dd068cd2ee7766a181d59700-68451.png 845w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>在实参中传入 undefined 值，表明对应的形参使用参数默认值</li>\n<li>使用 const/let/var 时可以理解为“标识符声明+一般赋值运算”两个步骤。但在一般赋值运算过程中，其左侧操作数尽管可以使用赋值模板和剩余参数的语法，但是不具有标识符声明的语义（变量的隐式声明除外）</li>\n</ul>\n<p>表 2-2 意味着其实只有“展开运算”是作为运算符来使用的，其他所有特性都是声明语法中的绑定，它们在词法阶段就决定了标识符的那些性质，例如它与（将来的）值之间的关系。</p>\n<h2 id="识别语法错误与运行错误"><a href="#%E8%AF%86%E5%88%AB%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF%E4%B8%8E%E8%BF%90%E8%A1%8C%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>识别语法错误与运行错误</h2>\n<p>一般来说，JavaScript 引擎会在代码装入时先进行语法分析，如果语法分析通不过，整个脚本代码块都不执行；当语法分析通过时，脚本代码才会执行。若在执行过程中出错，那么在同一代码上下文中、出错点之后的代码将不再执行。</p>\n<p>不同引擎处理这两类错误的提示的策略并不相同，在 Node.js 中可以方便地使用 <code class="language-text">require()</code> 将脚本文件作为一个模块来装载，并有效地识别、提示这两类错误信息。例如</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-27-20-28-05-9f63a00aab5384dbbe6a18d4fae0ff7a-fac45.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.944237918215606%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAAApklEQVQY04WQUQ6DIBBEuf+hQEQDKiBCiban6QvGv2rnY7Pqzs5bhTHGORdj7LrOe/9qqrXu+/5pet9LDMOgtbbWSilp2EUzTVPOuTYdx3FrJmFZlnmet22jAeGsCJBSypM5pRRCIIfpdV2ZprKIb/+xTRPJSqlxHAHu+55HLsdJLGh34YK/hZmb8XA/fi6nAZ6XIMDCot9mtp4XMkRlOl2Cn9gH7C8I0ljXSuALgAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 27 20 28 05" title="" data-src="/static/2021-09-27-20-28-05-9f63a00aab5384dbbe6a18d4fae0ff7a-fee1c.png" data-srcset="/static/2021-09-27-20-28-05-9f63a00aab5384dbbe6a18d4fae0ff7a-a67b7.png 200w,\n/static/2021-09-27-20-28-05-9f63a00aab5384dbbe6a18d4fae0ff7a-0b187.png 400w,\n/static/2021-09-27-20-28-05-9f63a00aab5384dbbe6a18d4fae0ff7a-fee1c.png 800w,\n/static/2021-09-27-20-28-05-9f63a00aab5384dbbe6a18d4fae0ff7a-fac45.png 807w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>事实上，Node.js 命令行上传入的主文件也是作为模块加载的，因此下面的示例与上述效果相同：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-27-20-28-38-2bc4fd7dbd9a49acb166385ab9f35471-6ec11.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 23.739237392373923%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAdElEQVQY04WPSQrAIBAE/f+nBHHB5WCMW3xNGicegoHUYWjE6lGmtY4xcs6llOei93696Rs4ZMYYay0qENCC7JyrtV5/jDGYUopkOKWUnDPmWNClH1kI4b2HRs9urdUJhf0XjxxCSCnRhHZMsD9NqA4Vn/INoaj4nr1Yv8wAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 27 20 28 38" title="" data-src="/static/2021-09-27-20-28-38-2bc4fd7dbd9a49acb166385ab9f35471-fee1c.png" data-srcset="/static/2021-09-27-20-28-38-2bc4fd7dbd9a49acb166385ab9f35471-a67b7.png 200w,\n/static/2021-09-27-20-28-38-2bc4fd7dbd9a49acb166385ab9f35471-0b187.png 400w,\n/static/2021-09-27-20-28-38-2bc4fd7dbd9a49acb166385ab9f35471-fee1c.png 800w,\n/static/2021-09-27-20-28-38-2bc4fd7dbd9a49acb166385ab9f35471-6ec11.png 813w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>或者，也可以直接使用 Node.js 在命令行上做语法检测：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-27-20-29-04-1a8fb5e93f15cc99d1f0508fb5d3d3d7-6ec11.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 19.68019680196802%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAAXElEQVQI142OwQ3AIAwD2X+oPIiAEKCiSCD6YZZaTJB7WP6cbEdEtVZkjFFVc84iUkr5DLje+5zzvaCstfbe5xyTjB2s6eW54Ai6SWbmlFIIwXuPtyittTGGRf4BQo3Ganpe4G8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 27 20 29 04" title="" data-src="/static/2021-09-27-20-29-04-1a8fb5e93f15cc99d1f0508fb5d3d3d7-fee1c.png" data-srcset="/static/2021-09-27-20-29-04-1a8fb5e93f15cc99d1f0508fb5d3d3d7-a67b7.png 200w,\n/static/2021-09-27-20-29-04-1a8fb5e93f15cc99d1f0508fb5d3d3d7-0b187.png 400w,\n/static/2021-09-27-20-29-04-1a8fb5e93f15cc99d1f0508fb5d3d3d7-fee1c.png 800w,\n/static/2021-09-27-20-29-04-1a8fb5e93f15cc99d1f0508fb5d3d3d7-6ec11.png 813w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="声明"><a href="#%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>声明</h1>\n<p>JavaScript 是弱类型语言。但所谓弱类型语言，只表明该语言在表达式运算中不强制校验操作数的数据类型，而并不表明该语言是否具有类型系统。</p>\n<h2 id="变量的数据类型"><a href="#%E5%8F%98%E9%87%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量的数据类型</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-27-20-32-49-5b6657c9e25ce7dd743dba8ce31a209e-3f6d7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.26215895610914%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABe0lEQVQoz1WR527CQBCE7/0fKkKhSBFS4AfC5VwptgF3MC4U5+OsKGEEqznf7s7snng8Hn3fbzabxXIZRpFlWYZh6Lqu6frXfP69WIwnk8l0+jkef4xG09msrmvyqXo+n6JX6LquaRrOt9utbVv4+XzOi4LULM/haZrGSZJm2f1+738hTNMMwxBB3/chHHFxPB4Ph8MQT6fTwAcSBMF+vydGUSQM04St12vquVsq4JwvmCeuVisppeM4cM/zXNdFZhATmLxer1VVEbGNPXptt1uawyFkIxvHMcrkMCDOiWVZiqIomJNrBoOQjQ4KLC8IQ9txKObv+T7izIUMxWRmWSb4c2YAPNOYYtu2mQXneJOWZUrpei8wRZIkaNQKcEEzDLADrqvLhbUgyK9QyPO8VIAjk6vN/xUzDA9DC+4gfBqWSSR1eLnuHa0CGxGsgWak4pxKjtgelsmQPBuEW0Zr3vEq3u12WCKDPAQZj2Jem0qiVNA0DWtolP+AzA+G8VnzluMFFwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 27 20 32 49" title="" data-src="/static/2021-09-27-20-32-49-5b6657c9e25ce7dd743dba8ce31a209e-fee1c.png" data-srcset="/static/2021-09-27-20-32-49-5b6657c9e25ce7dd743dba8ce31a209e-a67b7.png 200w,\n/static/2021-09-27-20-32-49-5b6657c9e25ce7dd743dba8ce31a209e-0b187.png 400w,\n/static/2021-09-27-20-32-49-5b6657c9e25ce7dd743dba8ce31a209e-fee1c.png 800w,\n/static/2021-09-27-20-32-49-5b6657c9e25ce7dd743dba8ce31a209e-3f6d7.png 843w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>直到 JavaScript 1.3/ES3 时，字符串都是不能通过下标来索引单个字符的。在 ES5 之后，规范约定将字符串下标索引理解为属性存取；在 ES6 之后，字符串被映射为可迭代对象，因此也可以用 <code class="language-text">for...of</code> 来列举单个字符，但这种情况下得到的字符是迭代成员（而不是属性描述符）</li>\n<li>在 JavaScript 中，函数的多重含义包括函数、方法、构造器、生成器、类以及函数对象等</li>\n<li>在 ES6 以前，因为不具备对象系统的全部特性，因此 JavaScript 通常被称为基于对象而非面向对象的语言。而在 ES6 中标准化了 class 和 super 等关键字以支持基于类继承的面向</li>\n</ul>\n<h3 id="基本数据类型"><a href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本数据类型</h3>\n<p>任何一个变量或值的类型都可以（而且应当首先）使用 typeof 运算得到。typeof 是 JavaScript 内部保留的一个关键字，它是一个运算符而不是一个函数。尽管它看起来可以像函数调用一样在后面跟上一对括号，例如</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-28-13-51-58-6f8ec63dd47cc38f7b68ba5235d88eaa-167f8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 755px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 22.649006622516556%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAX0lEQVQY05WPyQ3AIAwE6b8pQOIUEBseHN1kRRpw5uHfaMcqhJBzNsZorUspvfc555GhiAgCXcYYzLz3lsq11tZaSinGiLvWOmLUc0Ew4r/sHzLWoHnvrbXOOezLf34BI/L5KyNjYkoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 28 13 51 58" title="" data-src="/static/2021-09-28-13-51-58-6f8ec63dd47cc38f7b68ba5235d88eaa-167f8.png" data-srcset="/static/2021-09-28-13-51-58-6f8ec63dd47cc38f7b68ba5235d88eaa-acd3d.png 200w,\n/static/2021-09-28-13-51-58-6f8ec63dd47cc38f7b68ba5235d88eaa-69d76.png 400w,\n/static/2021-09-28-13-51-58-6f8ec63dd47cc38f7b68ba5235d88eaa-167f8.png 755w" data-sizes="(max-width: 755px) 100vw, 755px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="宿主定义的其他对象类型"><a href="#%E5%AE%BF%E4%B8%BB%E5%AE%9A%E4%B9%89%E7%9A%84%E5%85%B6%E4%BB%96%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>宿主定义的其他对象类型</h3>\n<p>在具体宿主的实现上，ECMAScript 规范接受（但不推荐）typeof 返回上述 7 种类型之外的值。在这种情况下，该变量或值应该是一个宿主自定义的对象（是引用类型，而非其他值类型），并且不能实现对象的 <code class="language-text">[[call]]</code> 内部方法。因为一旦实现该方法，那么该对象的行为就与函数类型一致了。</p>\n<p>在早期的 JavaScript 语言中，正则表达式对象是可执行的，因此兼容这一早期特性（而又不得不遵循 ECMAScript 规范）的 JavaScript 引擎就只能为正则表达式对象的 typeof 值返回为 <code class="language-text">function</code>。</p>\n<h3 id="值类型与引用类型"><a href="#%E5%80%BC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>值类型与引用类型</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-28-13-57-18-1c57ff2947cd4b76f1feb2c3a535927c-87be2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 774px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.02842377260982%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABNUlEQVQoz22Q226CQBRF5///pfGh1sbUpJr6UkOCMCRFDQJVEKoSrxUtF1dnUl/qCiHnvs8ZUZZlXdfvg4E5HEZR9OG6lm1Lx+Hr9nrP7fZTq/XYbL52u2/9/kun89BoDC2LlqqqRK0oikJP0VGcSvFT/FKqLKHyD10pXNc1DCMMw8ViMRqNHMexpYzjeDweB0FAML7HbDZL01RMJhPLsnzfXy6X0rZN08QmIaX0PG+1WmF/3YN6kWXZZrO5KJIkYSrb5nl+Op30LXAzbhChQOjFdrvd4XDwgwA1DNz1es1clDOFdjUEKdjv90Knz+czarz2fD5nBWyGfipCBbfw96ZTIhzyrRCpAjUcngHl7XZ7PB456abDhYm6nEriKLEzLULfTic+ajTTgE0/K1B3+QdZVqPgCuIs78jD0dD4AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 28 13 57 18" title="" data-src="/static/2021-09-28-13-57-18-1c57ff2947cd4b76f1feb2c3a535927c-87be2.png" data-srcset="/static/2021-09-28-13-57-18-1c57ff2947cd4b76f1feb2c3a535927c-7e637.png 200w,\n/static/2021-09-28-13-57-18-1c57ff2947cd4b76f1feb2c3a535927c-40c63.png 400w,\n/static/2021-09-28-13-57-18-1c57ff2947cd4b76f1feb2c3a535927c-87be2.png 774w" data-sizes="(max-width: 774px) 100vw, 774px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在 JavaScript 中，严格相等（===）运算符用来对值类型/引用类型的实际数据进行比较和检查。按照约定，在基于上述类型系统的运算中</p>\n<ul>\n<li>一般表达式运算的结果总是值</li>\n<li>函数/方法调用的结果可以返回值类型或者引用</li>\n<li>值与引用、值与值之间即使相等（==），也不一定严格相等（===）</li>\n<li>两个引用之间如果相等（==），则一定严格相等（===）</li>\n</ul>\n<p>同其他语言一样，在 JavaScript 中，值类型与引用类型也用于表明运算时使用数据的方式：参与运算的是其值还是其引用。因此，在下面的示例中，当两次调用函数 <code class="language-text">func()</code> 时，各自传入的数据采用了不同的方式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9381059535005676000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var str = \'abcde\';\nvar obj = new String(str);\n\nfunction newToString() {\n  return \'hello, world!\';\n}\n\nfunction func(val) {\n  val.toString = newToString;\n}\n\n// 示例 1：传入值\nfunc(str);\nconsole.log(str); // \'abcde\'\n\n// 示例 2：传入引用\nfunc(obj);\nconsole.log(String(obj)); // \'hello, world!\'`, `9381059535005676000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">\'abcde\'</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">newToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token string">\'hello, world!\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  val<span class="token punctuation">.</span>toString <span class="token operator">=</span> newToString<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 示例 1：传入值</span>\n<span class="token function">func</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \'abcde\'</span>\n\n<span class="token comment">// 示例 2：传入引用</span>\n<span class="token function">func</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \'hello, world!\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从语义上来说，由于在示例 1 中实际只传入了 str 的值，因此对它的 toString 属性的修改是无意义的；而在示例 2 中传入了 obj 的引用，因此对它的 toString 属性的修改将会影响到后来调用 <code class="language-text">obj.toString()</code> 的效果。因此两个示例返回的结果不同</p>\n<h3 id="讨论：ecmascript-的类型系统"><a href="#%E8%AE%A8%E8%AE%BA%EF%BC%9Aecmascript-%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>讨论：ECMAScript 的类型系统</h3>\n<p>JavaScript 存在如下两套类型系统。</p>\n<ul>\n<li>类型系统 1: 7 种基本数据类型</li>\n<li>类型系统 2：值类型与引用类型</li>\n</ul>\n<p>然而 ECMAScript 规范又对类型系统做了另外的约定。</p>\n<ul>\n<li>类型系统 3：ECMAScript 语言类型（ECMAScript language types）</li>\n<li>类型系统 4：ECMAScript 规范类型（ECMAScript specification types）</li>\n<li>类型系统 5：对象类型（参见“3.4 JavaScript 的对象系统”）</li>\n<li>类型系统 6：原子对象类型系统（Atom objecttype）</li>\n</ul>\n<p>首先，ECMAScript 语言类型并不是“典型的” JavaScript 语言类型。试图使用 ECMAScript language types 来直接映射 JavaScript language types 是徒劳的，并且将会引入更多的混淆和不可解释的特例。</p>\n<p>ECMAScript 语言类型的存在，就是为了撰写 ECMAScript 规范本身，以明确叙述该语言的规范。这些数据类型与 JavaScript 对数据类型的约定有如下三点不同</p>\n<ul>\n<li>ECMAScript 语言类型用首字符大写的单词作为类型名，例如 Undefined；而 JavaScript 语言类型使用字符串作为类型名，且首字符小写，例如 undefined，并且叙述中通常在不混淆的情况下也可以省掉单/双引号来直接作为类型名，例如 undefined。</li>\n<li>ECMAScript 语言类型中的 Null 是一个类型，并且有一个唯一值 null；而在 JavaScript 语言类型中没有 Null 类型，null 值是对象类型的一个特殊实例</li>\n<li>ECMAScript 语言类型中没有函数类型，函数是对象类型的一个变体（Exotic Object），即对象类型的一种实现；而 JavaScript 语言类型中函数是第一类类型（First class type），即能用 typeof 关键字检查的、与 string、object 等同级别的基本类型</li>\n</ul>\n<p>ECMAScript 的这种类型定义极大地方便了它的规范制定。由于 Null 值是特殊的、在语言层面就被解释的（而不是作为对象类型的特例），因此它被广泛用于各种结构、定义和逻辑中的识别条件；反过来，由于 function 是对象的实例，因此大多数时候它就只需要按对象的特性来操作和处理。后者的典型表现，就是在 ECMAScript 中有一个专门的过程来判断“是/不是对象”，而无须用这一方式来判断“是/不是函数”</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84878271651747970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`... Type(v) is Object`, `84878271651747970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">... Type(v) is Object</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>基于此，ECMAScript 约定它的类型也可以归纳成两类：对象（Object）和基础类型（即除开 Object 之外的其他 6 种类型）。这两种类型是可以转换的，这些内部过程称为抽象操作（Abstract Operations），包括 <code class="language-text">ToPrimitive()</code> 和 <code class="language-text">ToObject()</code> 等</p>\n<p>我们接下来讨论“类型系统 4”，即 ECMAScript 规范类型。</p>\n<p>在 ECMAScript 规范类型中没有与上述两种语言类型（ECMAScript 或 JavaScript 的语言类型）重合的任何类型或语义。准确地说，所谓 ECMAScript 规范类型，就是为了在规范的行文中实现 ECMAScript 语言类型而存在的。总共约定了 10 种规范类型，包括：</p>\n<ul>\n<li>List、Record、Set、Relation，其中主要的是 List 和 Record 类型，是整个 ECMAScript 规范实现中采用最多的数据类型</li>\n<li>Completion Record、Reference、PropertyDescriptor，主要用来作为运算的结果（Result）或中间结果，其中属性描述符（Property Descriptor）是实现 JavaScript 对象时使用的核心组件</li>\n<li>Data Blocks，主要用在内存、共享数据等的描述中</li>\n<li>Lexical Environment、Environment Record，主要用在词法和运行期环境等的描述中。</li>\n</ul>\n<p>最后，重点地、再次总结一下上述内容，即</p>\n<ul>\n<li>ECMAScript 规范类型是为了实现 ECMAScript 语言类型而存在的。</li>\n<li>ECMAScript 语言类型是为了叙述 JavaScript 语言的规范而存在的。</li>\n</ul>\n<p>因此后文中将尽量避免使用和讨论 ECMAScript 规范类型，并且在多数情况下不会对 ECMAScript 语言类型的特殊性再作说明。</p>\n<h2 id="变量声明"><a href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量声明</h2>\n<p>JavaScript 中的变量声明有两种方法：</p>\n<ul>\n<li>显式声明</li>\n<li>隐式声明（即用即声明）</li>\n</ul>\n<p>所谓显式声明，一般是指使用 var 等关键字进行的声明。一般语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37499480010174360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var variable1 [ = value1 ] [, variable2 [ = value2 ], ... ]\nlet variable2 = ...`, `37499480010174360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> variable1 <span class="token punctuation">[</span> <span class="token operator">=</span> value1 <span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> variable2 <span class="token punctuation">[</span> <span class="token operator">=</span> value2 <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token punctuation">]</span>\n<span class="token keyword">let</span> variable2 <span class="token operator">=</span> <span class="token operator">...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21014959495450403000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 声明变量 str、num，以及 x、y\nvar str = \'test\';\nvar x,\n  y,\n  num = 3 + 2 - 5;`, `21014959495450403000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 声明变量 str、num，以及 x、y</span>\n<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">\'test\'</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> x<span class="token punctuation">,</span>\n  y<span class="token punctuation">,</span>\n  num <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也包括在一些语句中使用 var 等关键字进行声明，例如 for 语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39396208969836730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 声明变量 n\nfor (var n in Object) {\n  // ...\n}\n// 声明变量 i, j, k\nfor (let i, j, k = 0; k < 100; k++) {\n  // ...\n}`, `39396208969836730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 声明变量 n</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token keyword">in</span> Object<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 声明变量 i, j, k</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有两种情况是具名函数声明和异常捕获子句中声明的异常对象。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96818750443517330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 声明函数 foo\nfunction foo() {\n  str = \'test\';\n}\n\n// 声明异常对象 e\ntry {\n  // ...\n} catch (e) {\n  // ...\n}`, `96818750443517330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 声明函数 foo</span>\n<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  str <span class="token operator">=</span> <span class="token string">\'test\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 声明异常对象 e</span>\n<span class="token keyword">try</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而隐式声明则发生在一般的赋值语句中。例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38301078187240825000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 当 aVar 未被声明时，以下语句将隐式声明它\naVar = 100;`, `38301078187240825000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 当 aVar 未被声明时，以下语句将隐式声明它</span>\naVar <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>解释器总是将显式声明理解为“变量声明”，而对隐式声明则不一定，如图 2-1 所示。</p>\n<ul>\n<li>如果变量未被声明，则先声明该变量并立即给它赋值</li>\n<li>如果变量已经声明过，则该语句是赋值语句</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-28-16-51-45-b8ae0277937b67e769cfe900630e81a9-5032e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 438px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.40639269406392%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACLUlEQVQoz31S62vacBTNP+0nQRBXpEVlWrbVt1EZ6xpQP/nED+pkTQaaxFhNFHUqRuNjPlqdTrPTxI5+2HYgl5tf7vnde88Jsd1uV6vVZrN5esHjKzw9nl9fn/85JMBUVXU4HPp8PpIkw+FwLBaLx+MURWWzWXwdjUbdbrfVavV6ve8akOBElmVisVjgc7vdttvtDofD6XS63W5c5PV6cQUaDgYDSZIqlco3DRzH1et1QRAURSF+aBBF0Ww2W61Wm80GcjQa9fv9iUTidDqhFaoZhgG/3++jeDqdzufz8XhMrNdrjD2bzVKpVKlU+vKCYrHIsizIu91urQFTIP+p4XA4QCYCz/F4RJH6N6BI5+z3e0iLXI9gQY5zZ0ySz+fRrVAoICLP5XLlcnm5XEKeugYkGBv7I+KuyWRyJnc6HYPBYDQaTSaTy+WCWh6PR98Z60FYbDjTAJ1wAp+QP6sNnyAYOJAaEbSgBpAxHqrRBGRFAxJZA4Y9q41hLBYLrNLbRiIRaA6rsR7P81COoRmappEjwrBarYbhnztDD/gBV7Enfox0Op3JZJLJJMTHUrgXpTAWDjcaDd3kZrMJCQjo+S+p/w94RKjqieU4luNHsqxMlcGgf0/TTUnieA4Jy1Yr1SrL8+gpPDxIksijr1D7ek8vV2vidPzlC/jfXr+rstxoPC6XS9arS28wdHt395miAsHAxeXVx9tPH9w31+9vQmQoFAkHSdL85kJstX8Dh0zBcapJPv4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 28 16 51 45" title="" data-src="/static/2021-09-28-16-51-45-b8ae0277937b67e769cfe900630e81a9-5032e.png" data-srcset="/static/2021-09-28-16-51-45-b8ae0277937b67e769cfe900630e81a9-86481.png 200w,\n/static/2021-09-28-16-51-45-b8ae0277937b67e769cfe900630e81a9-1ca59.png 400w,\n/static/2021-09-28-16-51-45-b8ae0277937b67e769cfe900630e81a9-5032e.png 438w" data-sizes="(max-width: 438px) 100vw, 438px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="块级作用域的变量声明与一般-var-声明"><a href="#%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%9A%84%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E%E4%B8%8E%E4%B8%80%E8%88%AC-var-%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>块级作用域的变量声明与一般 var 声明</h3>\n<p>除了以下三点不同，let 的语法以及使用场景都与 var 一致：</p>\n<ul>\n<li>var 声明的变量，其作用域为当前函数、模块或全局；let 声明的变量，其作用域总是在当前的代码块，例如语句块</li>\n<li>在同一个代码块中，可以用 var 来多次声明变量名，这在语法分析中与声明一次没有区别；而用 let 却只能声明一次，覆盖一个已经声明的 let 变量（或者用 let 去覆盖一个已声明过的标识符）会导致语法错误</li>\n<li>用户代码可以在声明语句之前使用所声明的 var 变量，这时该变量的值是 undefined；而 let 声明的变量必须先声明后使用，声明语句之前的代码引用了 let 变量会触发异常，这也会导致 typeof 成为一个不安全的运算</li>\n</ul>\n<p>当 let 声明发生在全局代码块时，它与 var 声明存在细微的差别。这是因为按照早期 JavaScript 的约定，在全局代码块使用 var 声明（和具名函数声明语法）时，相当于在全局对象 global 上声明了一个属性，进而使所有代码都能将这些声明作为全局变量来访问。</p>\n<p>而 let 声明与其他一些较新的语法元素遵从“块级作用域”规则，因此即使出现在全局代码块中，它们也只是声明为“全局作用域”中的标识符，而不作为对象 global 上的属性，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43368566038269575000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var x = 100;\nlet y = 200;\nconsole.log(Object.getOwnPropertyDescriptor(global, \'x\').value); // 100\nconsole.log(Object.getOwnPropertyDescriptor(global, \'y\')); // undefined`, `43368566038269575000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>global<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>常量声明 const、类声明 class 在块级作用域上的特性与 let 声明是类似的。</p>\n<h3 id="用赋值模板声明一批变量"><a href="#%E7%94%A8%E8%B5%8B%E5%80%BC%E6%A8%A1%E6%9D%BF%E5%A3%B0%E6%98%8E%E4%B8%80%E6%89%B9%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用赋值模板声明一批变量</h3>\n<p>JavaScript 声明一批变量的传统方法是用 var 关键字，即在一个 var 中声明多个变量名。而 ES6 开始支持更为灵活的解构赋值语法，这个表达式的左侧操作数称为“赋值模板（AssignmentPattern）”：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69049985411097170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`AssignmentPattern = expression`, `69049985411097170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">AssignmentPattern = expression</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当这个模板使用在 var 等变量声明中时，也可以成批地声明变量。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73192118531905010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用数组解构赋值，声明变量 x, y\nvar [x, y] = [1, 2];\n// 使用对象解构赋值，声明变量 height, width\nlet { clientHeight: height, clientWidth: width } = window.document.body;`, `73192118531905010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 使用数组解构赋值，声明变量 x, y</span>\n<span class="token keyword">var</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token comment">// 使用对象解构赋值，声明变量 height, width</span>\n<span class="token keyword">let</span> <span class="token punctuation">{</span> clientHeight<span class="token punctuation">:</span> height<span class="token punctuation">,</span> clientWidth<span class="token punctuation">:</span> width <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在赋值模板中可以使用剩余参数语法来声明数组或对象。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52219515807571760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 在变量声明的赋值模板中使用剩余参数，可以声明数组变量 more\nvar [x, y, ...more] = [1, 2, 3, 4, 5];\n\n// 在对象解构赋值中使用剩余参数，可以声明对象变量 moreProps\nlet [x, y, ...moreProps] = { x: 100, y: 200, z: 300 };`, `52219515807571760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 在变量声明的赋值模板中使用剩余参数，可以声明数组变量 more</span>\n<span class="token keyword">var</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>more<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在对象解构赋值中使用剩余参数，可以声明对象变量 moreProps</span>\n<span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>moreProps<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> z<span class="token punctuation">:</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="使用字面量风格的值"><a href="#%E4%BD%BF%E7%94%A8%E5%AD%97%E9%9D%A2%E9%87%8F%E9%A3%8E%E6%A0%BC%E7%9A%84%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用字面量风格的值</h2>\n<p>除了定义一个可用的标识符，变量声明通常还具有两方面的功能，一是声明类型，二是声明初值。但 JavaScript 中没有类型声明的概念，因此这时变量声明就只用来说明一个变量的初值。在声明中，等号右边既可以是表达式，这意味着将表达式运算的结果作为该变量的初值，也可以是更为强大和灵活的字面量声明。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94375143465404550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var num = 3 + 2 - 5; // 3 + 2 - 5 是一个表达式\nvar str = \'test\'; // \'test\' 是字面量`, `94375143465404550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 3 + 2 - 5 是一个表达式</span>\n<span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">\'test\'</span><span class="token punctuation">;</span> <span class="token comment">// \'test\' 是字面量</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>字面量类似汇编语言中的立即值—无须声明就可以立即使用的常值。从它的语法形式来说，也被称为或翻译为直接量。表 2-5 简要说明了 JavaScript 中能用字面量风格来声明的数据类型和对象</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-30-16-44-32-9f06c85e7feb4cce5b97a6172bd8fd54-d152b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 71.2085308056872%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABr0lEQVQoz02S62rCQBCF9/1fqIiSNhpBaCIoilTNBdtq1CRGTc3FRPq5U4vnxzI7c87Z2dlVQRDYw2G43S5ddzKdfsznk+nk3Xa6ltXt9dqdTscwXk3z9a3bsyziVrvN+tJqfX59q6Zpao2qqq4aZVmylfg/eb3WMKsnwFHj8di27cVi0e/3DcMYjUae5y01fN9na5qm4ziDwWA2m5HxHgh8X201drsd62azWa/XaZpmWXY+ny+XC8n9fk9mtVolSXI6nQ6HQ6oRx7GCl+d5URSwaZh+brdbo0Hwo0EeX2RYuK4rdmwVBlEUocRYziwewIgqTVFFBo2VzjmfC5NUiQZ7lPAI0JQaBNhzDklMydAjd2ElJqkiDSIsMHs+GQYnU0IQhiFGuOMlpbsYNu/AxRAfj0eC/AEYcj3EKCllGmINWcmc0Evzcs6zmPmTlLFJiRgxq2LDVBHjJFeSruTOOKKXmVOlCxktKzRFlleRxqjJ5IWKXp6UqgxSOpJXvE9b+pQ7o5cOpTEY3JAYgjwYXTDC+1+t67+25dPKYGETyPcCBPBK3X8Sx3w4xo4FfEq/QGwOSbwxiCgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 30 16 44 32" title="" data-src="/static/2021-09-30-16-44-32-9f06c85e7feb4cce5b97a6172bd8fd54-fee1c.png" data-srcset="/static/2021-09-30-16-44-32-9f06c85e7feb4cce5b97a6172bd8fd54-a67b7.png 200w,\n/static/2021-09-30-16-44-32-9f06c85e7feb4cce5b97a6172bd8fd54-0b187.png 400w,\n/static/2021-09-30-16-44-32-9f06c85e7feb4cce5b97a6172bd8fd54-fee1c.png 800w,\n/static/2021-09-30-16-44-32-9f06c85e7feb4cce5b97a6172bd8fd54-d152b.png 844w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ol>\n<li>undefined 并没有被称为字面量，这可能是有着其历史原因的：在早期的 JavaScript 中，undefined 既不是关键字，也不能直接声明。</li>\n</ol>\n<h3 id="字符串字面量、转义符"><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E9%87%8F%E3%80%81%E8%BD%AC%E4%B9%89%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符串字面量、转义符</h3>\n<p>你总是可以用一对双引号或一对单引号来表示字符串字面量。早期 Netscape 的 JavaScript 中允许出现非 Unicode 的字符，但现在 ECMAScript 标准统一要求字符串必须是 Unicode 字符序列。</p>\n<p>转义符主要用于在字符串中包含控制字符，以及当前操作系统语言和字符集中不能直接输入的字符；也可以用于在字符串中嵌套引号（可以在单引号声明的字符串中直接使用双引号，或反过来在双引号中使用单引号）。转义符总是用一个反斜线字符“\\”引导，包括表 2-6 中所示的转义序列。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-30-16-46-28-8d9e3b9fe5e931ea89a97b51008bb74f-31afd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.35790725326992%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABKElEQVQY02WPWW/CMBCE/f//UHmqaMshkfCSEJxQrlyIhEOhJOQgDf1qiydGljW7O+Mdi8fj0XUdt2Vblm1Hcex63ly6zlzOZvZgOHzv9wej0VuvZ5jmaDz++Pz6VXogOoW2bZv7nVPXdVmWdd1Aqqq602wa3awU4O0TwnGcyWTi+75hGPAoisIgmCpsNhvTnLquGwSB/wKaIo7jw+GQZZmcS8xJksCxHY/H0+mEc7Va5Xl+uVx+FLInzuezQFEq8Bjm7XZLtt1ud7vdiqKgZMN+v/cDnyach7SeqWBtrrBer/FrTxiG9K/XKxGWy6WrAPE8jxH7kTH9N6Om+FbQHIX+DpkXiwVOQsG5pZSMkLFPkJ4MGEjF5jRNKfkLY/1JRIWCDqVjassf9X2z+42hvSAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 30 16 46 28" title="" data-src="/static/2021-09-30-16-46-28-8d9e3b9fe5e931ea89a97b51008bb74f-fee1c.png" data-srcset="/static/2021-09-30-16-46-28-8d9e3b9fe5e931ea89a97b51008bb74f-a67b7.png 200w,\n/static/2021-09-30-16-46-28-8d9e3b9fe5e931ea89a97b51008bb74f-0b187.png 400w,\n/static/2021-09-30-16-46-28-8d9e3b9fe5e931ea89a97b51008bb74f-fee1c.png 800w,\n/static/2021-09-30-16-46-28-8d9e3b9fe5e931ea89a97b51008bb74f-31afd.png 841w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ol>\n<li>将被转换为 Unicode 字符存储</li>\n</ol>\n<p>除了定义转义符之外，当反斜线字符“\\”位于一行的末尾（其后立即是代码文本中的换行）时，也用于表示连续的字符串声明。这在声明大段文本块时很有用。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14277534414756033000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var aTextBlock =\n  \'\\\nabcde\\\n \\\n123456789\\\n \\\n+-*/\';`, `14277534414756033000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> aTextBlock <span class="token operator">=</span>\n  <span class="token string">\'\\\nabcde\\\n \\\n123456789\\\n \\\n+-*/\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>该示例第 4 行与第 6 行中各包括了一个空格，因此输出时第 3、5、7 行将用一个空格分开。显示为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15869081772336257000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`abcde 123456789 +-*/`, `15869081772336257000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">abcde 123456789 +-*/</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在各行中仍然可以使用其他转义符—只要它们出现在文本行最后的这个“\\”字符之前即可。不过与某些语言的语法不同的是，不能在这种表示法的文本行末使用注释。</p>\n<p>另外一个需要特别说明的是“\\0”，它表示 NUL 字符。在某些语言中，NUL 用于说明一种“以＃0 字符结束的字符串”（这也是 Windows 操作系统直接支持的一种字符串形式），在这种情况下，字符串是不能包括该 NUL 字符串的。但在 JavaScript 中，这是允许存在的。这时，NUL 字符是一个真实存在于字符序列中的字符。下例说明了 NUL 字符在 JavaScript 中的真实性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60999327449451360"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 示例\nstr1 = String.fromCharCode(0, 0, 0, 0, 0);\nstr2 = \'\\0\\0\\0\\0\\0\';\n\n// 显示字符串长&quot;5&quot;，表明 NUL 字符在字符串中是真实存在的\nconsole.log(str1.length);\nconsole.log(str2.length);`, `60999327449451360`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 示例</span>\nstr1 <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nstr2 <span class="token operator">=</span> <span class="token string">\'\\0\\0\\0\\0\\0\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 显示字符串长"5"，表明 NUL 字符在字符串中是真实存在的</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str1<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 ES6 中增加了“\\u{nnnnn}”来表示码点大于 0xFFFF 的 Unicode 字符的语法，这意味着它支持直接声明和使用 UTF-16 字符。所以在这种情况下，在当前字符集使用 UTF-8 时，一个用“\\u{nnnnn}”表达的 Unicode 字符的长度将是 2。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99200151371652300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 如果当前字符集为 UTF-8，则将显示字符串长“2”\nconsole.log(\'\\u{20BB7}\'.length);`, `99200151371652300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 如果当前字符集为 UTF-8，则将显示字符串长“2”</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'\\u{20BB7}\'</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>在 JavaScript 中也可以用一对不包含任意字符的单引号或双引号来表示一个空字符串（Null String），其长度值总是为 0。比较容易被忽视的是，空字符串与其他字符串一样也可以用作对象成员名。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43761629391528034000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`obj = {\n  \'\': 100\n};\n\n// 显示该成员的值：100\nconsole.log(obj[\'\']);`, `43761629391528034000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">obj <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token string">\'\'</span><span class="token punctuation">:</span> <span class="token number">100</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 显示该成员的值：100</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模板字面量"><a href="#%E6%A8%A1%E6%9D%BF%E5%AD%97%E9%9D%A2%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板字面量</h3>\n<p>从 ES6 开始出现的模板字面量（template literal）用一对反引号（`）来标识，可以将其理解为一种增强的字符串声明。在使用反引号声明的字符串中，可以使用 <code class="language-text">${...}</code> 这样的语法来捕获当前上下文中的变量、常量、字面量或对象成员属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84920915321574310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var message = \'Hello world\';\nconsole.log(\\`The message is: \\${message}\\`);`, `84920915321574310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">\'Hello world\'</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The message is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>以及计算一个表达式并将结果转换为字符串值—这也意味着这样的字符串其实是动态的。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13862637574551128000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(\\`The null is \\${typeof null} type.\\`); // The null is object type.`, `13862637574551128000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The null is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">typeof</span> <span class="token keyword">null</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> type.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// The null is object type.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>模板字面量本质上来说是一个字面量的引用—该字面量在 JavaScript 内部表达为一个对象（array-like object）或数组：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70772141930142450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`foo = (tpl) => console.log(typeof tpl, tpl instanceof Array, (ref = tpl));\nfoo\\`xyz\\`; // object true [\'xyz\']`, `70772141930142450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tpl</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> tpl<span class="token punctuation">,</span> tpl <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ref <span class="token operator">=</span> tpl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nfoo<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">xyz</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// object true [\'xyz\']</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>用户代码也可以使用一个带 .raw 属性的类数组对象来替代它，这个 .raw 属性指向该“表达该模板字面量的内部数组”的一个原始的、未经转义的格式。例如，用在 String.raw() 中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85973015805360720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(String.raw({ raw: [\'\', \',\\nworld\'] }, \'Hi\'));\n// Hi,\n// world`, `85973015805360720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token punctuation">{</span> raw<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token string">\',\\nworld\'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'Hi\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Hi,</span>\n<span class="token comment">// world</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>它等义于：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42384066859910610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`foo = (tpl) => String.raw(tpl, \'Hi\');\nconsole.log(foo\\`\\${1},\\nworld\\`);`, `42384066859910610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tpl</span><span class="token punctuation">)</span> <span class="token operator">=></span> String<span class="token punctuation">.</span><span class="token function">raw</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span> <span class="token string">\'Hi\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,\\nworld</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>另外，模板也可以用于多行字符串的声明</p>\n<h3 id="数值字面量"><a href="#%E6%95%B0%E5%80%BC%E5%AD%97%E9%9D%A2%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数值字面量</h3>\n<p>数值字面量总是以一个数字字符，或一个点字符“.”，以及不多于一个的正值符号“+”或负值符号“-”开始。当以数字字符开始时，它有四条规则：</p>\n<ol>\n<li>如果以 0x 或 0X 开始，则表明是一个十六进制数值。</li>\n<li>如果以 0o 或 0O 开始，则表明是一个八进制数值。</li>\n<li>如果以 0b 或 0B 开始，则表明是一个二进制数值。</li>\n<li>在其他情况下，表明是一个十进制整数或浮点数。</li>\n</ol>\n<p>当以点字符“.”开始时，它总是表明一个十进制浮点数。正值符号“+”、负值符号“-”总是可以出现在上述两种表示法（以数字字符或以点字符）的前面。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98237675016141540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1234 // 十进制整数\n0x1234 // 十六进制整数\n0o1234 // 八进制整数\n0b1101 // 二进制整数`, `98237675016141540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1234 // 十进制整数\n0x1234 // 十六进制整数\n0o1234 // 八进制整数\n0b1101 // 二进制整数</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当一个字面量被识别为十六进制数值时，该字面量由 0 ～ 9 和 A ～ F 字符构成；当被识别为八进制数值时，该字面量由 0 ～ 7 字符构成—类似地，如果在语法分析中发现其他字符，则出现语法分析错误。</p>\n<p>当一个字面量被识别为十进制整型数时，它内部的存放格式可能是浮点数，也可能是整型数，这取决于不同引擎的实现。因此不能指望 JavaScript 中的整型数会有较高的运算性能。但是你可以用位运算来替代算术运算，这时引擎总是以整型数的形式来运算的—即使操作数是一个浮点数。</p>\n<p>当一个字面量被识别为十进制数时，它可以由 0 ～ 9，以及（不多于一个的）点字符“.”或字符 e、E 组成。当包括点字符“.”、字符 e 或 E 时，该字面量总被识别为浮点数（注意，某些引擎会优化一些字面量的内部存储形式）。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34219053237698980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`3.1415926\n12.345\n.1234\n.0e8\n1.02E30`, `34219053237698980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">3.1415926\n12.345\n.1234\n.0e8\n1.02E30</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当使用带字符 e、E 的指数法表示时，也可以使用正、负符号来表示正、负整数指数。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65840002053194020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1.555E+30\n1.555E-30`, `65840002053194020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1.555E+30\n1.555E-30</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="其他声明"><a href="#%E5%85%B6%E4%BB%96%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他声明</h2>\n<h3 id="常量声明"><a href="#%E5%B8%B8%E9%87%8F%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常量声明</h3>\n<p>const 关键字用于常量声明。常量声明与变量声明都是用来将一个标识符（变量名/常量名）与其对应的数据存储绑定起来，这在本质上并没有不同。但是从语义上来讲，变量表明相应的数据是可修改的，而常量表明它不可修改。除了这一点语义上的不同之外，所有与变量声明相关的特性（例如，数据的类型、字面量声明、字符串转义等）也都体现在常量声明上。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49078323412759500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用字面量的常量声明\nconst stringValue = \'abcd\\nefg\';\n\n// 正则表达式常量\nconst regexpInstace = /./;`, `49078323412759500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 使用字面量的常量声明</span>\n<span class="token keyword">const</span> stringValue <span class="token operator">=</span> <span class="token string">\'abcd\\nefg\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 正则表达式常量</span>\n<span class="token keyword">const</span> regexpInstace <span class="token operator">=</span> <span class="token regex">/./</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>const 与 let 对作用域的理解类似，也是块级作用域的，因此也同样有别于 var 声明：既不能覆盖一个已经声明的常量，也不可能在它的声明语句之前访问它：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30430776086961340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const i = 100;\nconst i = 100; // Uncaught SyntaxError: Identifier \'i\' has already been declared`, `30430776086961340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught SyntaxError: Identifier \'i\' has already been declared</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>而对常量进行重新赋值的操作通常会无效或触发异常：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50552948435489370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 续上例\ni = 300; // 尝试修改常量的值\n\nconsole.log(i); // 100，显示上述修改无效`, `50552948435489370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 续上例</span>\ni <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span> <span class="token comment">// 尝试修改常量的值</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 100，显示上述修改无效</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="符号声明"><a href="#%E7%AC%A6%E5%8F%B7%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>符号声明</h3>\n<p>符号是从 ES6 开始支持的一种数据类型，它可以使用一般形式的变量声明或常量声明（const/var/let），与其他数据类型在声明上并没有特别的不同：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17906105798467654000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var aSymbol = Symbol();\nconst aSymbolConst = Symbol();`, `17906105798467654000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> aSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> aSymbolConst <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>符号没有字面量声明形式。由于符号是值而非对象（我称之为“近似对象的”一种值类型数据），所以也不能使用 new 运算符来创建它。</p>\n<h3 id="函数声明"><a href="#%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数声明</h3>\n<p>在 JavaScript 中，函数是一种数据类型，所以函数声明是变量声明的一种特殊形式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38283261385671910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function functionName() {\n  // ...\n}`, `38283261385671910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">functionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当 functionName 是一个有效标识符时，表示声明的是一个具名函数。functionName 后使用一对不能省略的“()”来表示形式参数列表。所谓形式参数，是指可以在函数体内部使用的、有效的标识符名。可以声明零至多个形式参数，即使在函数体内部并不使用它们。或者也可以不声明形式参数，这时也可以在函数体内使用一个名为 arguments 的内部对象来存取函数调用时的传入值。在函数体中，可以有零至任意多行代码、内嵌函数。在函数体内出现的使用 var 进行的显式变量声明，或者隐式的变量声明，都将被视为函数体内部的局部变量；该函数的内嵌函数的名字，也将作为局部变量。</p>\n<p>不同于早期的 JScript，在 ES5 以后的规范中，明确规定了在表达式中出现的具名函数名只影响该函数内的代码，而不会影响该表达式所在的作用域，示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61174432793606414000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 在 if 语句的条件表达式中使用具名函数 foo\nif (function foo() {});\n\n// 在早期的 JScript 中，会显示有效的类型名 function\n// 这是因为上述 foo 函数会声明在全局，这是不规范的实现\nconsole.log(typeof foo);`, `61174432793606414000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 在 if 语句的条件表达式中使用具名函数 foo</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在早期的 JScript 中，会显示有效的类型名 function</span>\n<span class="token comment">// 这是因为上述 foo 函数会声明在全局，这是不规范的实现</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在声明函数的形式参数时，可以为参数指定默认值“（default parameters）”：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6188523289799219000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(x, y = 100) {\n  console.log([x, y]);\n}\n\n// 示例\nfoo(\'abc\'); // abc,100`, `6188523289799219000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">100</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 示例</span>\n<span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// abc,100</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果默认值并没有放在参数列表的尾部，那么可以使用 undefined，在传参时表明该参数使用默认值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87501936697468300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(x = \'abc\', y) {\n  console.log([x, y]);\n}\n\n// 示例\nfoo(undefined, \'abc\'); // abc,abc`, `87501936697468300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token string">\'abc\'</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 示例</span>\n<span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token string">\'abc\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// abc,abc</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以在参数列表尾部使用“剩余参数（rest parameter）”，它用一个带 <code class="language-text">...</code> 前缀的参数名（形参）来捕获所有未被声明的实参。在这种情况下，该形参总是一个包含所有剩余参数的数组，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10120305357836657000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(x, y, ...z) {\n  console.log(z);\n}\n\n// 示例\nfoo(\'a\', \'b\', \'c\', \'d\'); // [\'c\', \'d\']`, `10120305357836657000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>z</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 示例</span>\n<span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [\'c\', \'d\']</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也可以在剩余参数中使用赋值模板。例如，下面用一个数组赋值模板替代了上例中的形参 z：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37878187391296340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(x, y, ...[m, n]) {\n  console.log(m);\n}\n\n// 示例\nfoo(\'a\', \'b\', \'c\', \'d\'); // \'c\'`, `37878187391296340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">[</span>m<span class="token punctuation">,</span> n<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 示例</span>\n<span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \'c\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>并且反过来，也可以在赋值模板中使用剩余参数语法。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87453751616110150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var [x, y, ...more] = [1, 2, 3, 4, 5];\n\n// 示例\nconsole.log(more); // [3, 4, 5]`, `87453751616110150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>more<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 示例</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>more<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [3, 4, 5]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 class 关键字来声明的类，也是一个函数。因此可以将类声明理解为函数声明的一种特殊语法。但是类声明得到的函数只能使用 new 运算来创建对象实例，而不能直接作为函数调用。而如果在语法关键字 function 之后加 * 字符，则会声明一个特殊的函数：生成器。</p>\n<p>// TODO js 精髓待完成</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/JavaScript语言精髓与编程实践——语法/index.md absPath of file >>> MarkdownRemark",timeToRead:12,frontmatter:{date:"2021-09-26 17:45:33",path:"/javascript-essence-practice-grammar/",tags:"前端, JS, 读书笔记",title:"JavaScript语言精髓与编程实践——语法",draft:null}},{excerpt:"焦油坑 编程系统产品 图 1-1 的左上是程序，本身是完整的，可以在作者开发的系统平台上运行。它通常是车库中产出的产品，以及作为单个程序员生产率的评估标准 有 2 种途径可以使程序转变成更有用但成本更高的产物，这 2 种途径表现为图中的边界 水平边界以下，程序转变为编程产品，这是可以被任何人运行、测试、修复和拓展的程序。相同功能的编程产品的成本，至少是已调试程序成本的…",html:'<h1 id="焦油坑"><a href="#%E7%84%A6%E6%B2%B9%E5%9D%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>焦油坑</h1>\n<h2 id="编程系统产品"><a href="#%E7%BC%96%E7%A8%8B%E7%B3%BB%E7%BB%9F%E4%BA%A7%E5%93%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编程系统产品</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-25-15-53-03-09954c8213c510a0fd29a2f399fb7831-63cf7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 693px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 109.37950937950937%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAAsSAAALEgHS3X78AAACGklEQVQ4y22U124CMRBF/f9fhEQTIIpEET30FjYBwoYiAjxBzu6FAZTMg/fanjvd67bbre/73//JVyh+KJvNxs7BnEB0s9lsOp3OQnkPxfO8+XzOOhgM+v0++PlWQKv7eJLPUNrt9ng8Ho1Gb6Fgotvt6naxWLCaspMfuUIwOZlMZFiewdhCwTgWmvPuwilKjUbDTtgOh0MAhkitXC6XSiU7uZFlBjLhoWGZQ8a5buHkcrlCoUBSCjAgE4lC0ooJZQEWWX7YUvnlcgmQdcAjbNkjPJjcseKNnBVaq9WqVqu6UvHBgWcxATBxZScUXJ4Roo1EIul0GiuPnPlQXmisuKI3dtLr9dgCsMIJUVAUYTLCeTAkg1Bgcler1ZrNprYw8YM2VjgBqP/SBz/6TKm4qNfrmipVWNVWheZ3sa3T9D2PnlJCFKfGRiOshquuwXiiqr2sapikB7nT6YhMFQWkr6bcyCAuYrFYJpMhZ7YcGpl0stlsKpViSGiYArmR1TeVlzxRVSx6EprtSqUCjfqp/rdXJSdqVTQaxbnaoIcBWXlqEFRIVefFMyAejycSCascZGL5+55t6+yJMbeMfjKZtKdC/GqbGiPnz31xUiJUwiZIXGmArGAA3ZpoVIIJO5/Ph8PhJ5TT6bTf73e7HZgfFc9ovV7zrwIDWDk/Ho9SBrjrXS6XC+tqtcI5VqgtT79YLGrs8vk8Jbi+yi+X5IuGtVIz0wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 25 15 53 03" title="" data-src="/static/2021-09-25-15-53-03-09954c8213c510a0fd29a2f399fb7831-63cf7.png" data-srcset="/static/2021-09-25-15-53-03-09954c8213c510a0fd29a2f399fb7831-9e32f.png 200w,\n/static/2021-09-25-15-53-03-09954c8213c510a0fd29a2f399fb7831-65403.png 400w,\n/static/2021-09-25-15-53-03-09954c8213c510a0fd29a2f399fb7831-63cf7.png 693w" data-sizes="(max-width: 693px) 100vw, 693px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>图 1-1 的左上是程序，本身是完整的，可以在作者开发的系统平台上运行。它通常是车库中产出的产品，以及作为单个程序员生产率的评估标准</p>\n<p>有 2 种途径可以使程序转变成更有用但成本更高的产物，这 2 种途径表现为图中的边界</p>\n<p>水平边界以下，程序转变为编程产品，这是可以被任何人运行、测试、修复和拓展的程序。相同功能的编程产品的成本，至少是已调试程序成本的 3 倍</p>\n<p>垂直边界的右边，程序转变为编程系统中的一个构件单元。它是在功能上能相互协作、具有规范的格式、可以进行交互的程序集合，并可以用来组装和搭建整个系统。相同功能编程系统构件的成本至少是独立程序的 3 倍，如果系统有大量的组成单元，成本还会更高</p>\n<p>右下部分代表编程系统产品，与以上所有简单的程序不同的是，它的成本高达 9 倍。然后只有它才是真正有用的产品，是大多数系统开发的目标</p>\n<h2 id="职业的乐趣"><a href="#%E8%81%8C%E4%B8%9A%E7%9A%84%E4%B9%90%E8%B6%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>职业的乐趣</h2>\n<ol>\n<li>创建事物的纯粹快乐</li>\n<li>来自于开发对他人有用的东西</li>\n<li>来自于整个过程体现出的魅力——将各种零部件组装在一起，看到它们以精妙的方式运行，并收到了预期的效果</li>\n<li>是持续学习的快乐，来自于这项工作的非重复特性</li>\n<li>在易于驾驭的介质上工作</li>\n</ol>\n<h2 id="职业的苦恼"><a href="#%E8%81%8C%E4%B8%9A%E7%9A%84%E8%8B%A6%E6%81%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>职业的苦恼</h2>\n<ol>\n<li>追求完美</li>\n<li>由他人设定目标、供给资源和提供信息，很少能控制工作环境与目标。典型表现为对其他人的依赖，而被依赖人的程序往往有各种问题，所以需要对其进行研究、修改，而它们在理想情况下本应该是可靠完整的</li>\n<li>概念性设计是有趣的，但寻找 bug 却是一项重复性活动。bug 往往有二次方的复杂度，导致测试一拖再拖，寻找最后一个错误比第一个错误将花费更多时间</li>\n<li>当花费了劳动，产品在即将完成或者终于完成的时候，却已显得陈旧过时</li>\n</ol>\n<h1 id="人月神话"><a href="#%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>人月神话</h1>\n<p>导致项目滞后的最主要原因是什么？</p>\n<ol>\n<li>对估算技术缺乏有效的研究，反映了一个虚假的假设——一切都将运行良好</li>\n<li>隐含的假设人和月可以互相转换，错误的将进度与工作量相互混淆</li>\n<li>由于对自己的估算缺乏信心，软件经理通常不会有耐心持续估算这项工作</li>\n<li>对进度缺少跟踪与监督</li>\n<li>意识到进度偏移时，下意识的反应是增加人力</li>\n</ol>\n<h2 id="乐观主义"><a href="#%E4%B9%90%E8%A7%82%E4%B8%BB%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>乐观主义</h2>\n<p>一个错误的假设：一切都将运行良好，每一项任务仅花费它“应该”花费的时间</p>\n<p>由于计算机编程是易于掌握的介质，相对于物理介质。我们期待在实现过程中不会遇到困难，而构思有缺陷的情况下，总会发现 bug</p>\n<p>大型的编程工作或多或少的包含了很多任务，某些任务还有前后次序，从而一切正常的概率非常小，甚至接近于 0</p>\n<h2 id="人月"><a href="#%E4%BA%BA%E6%9C%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>人月</h2>\n<p>另一个错误的思考方式是在估计和进度安排中使用的工作量单位：人月。成本的确随开发产品的人数和时间的不同，有着很大的变化，进度却不是这样。</p>\n<p>人数和时间的转换仅仅适用于以下情况：某个任务可以分解给参与人员，并且之间不需要相互的交流</p>\n<p>当任务由于次序上的限制不能分解时，人手的添加对进度没有帮助</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-25-16-46-47-8ada3b611e2dc933b698f2b30752b5d9-9f4d2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 619px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 93.05331179321486%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAABiUlEQVQ4y32UW6+CQAyE+f//zWcFL6AGFAHvIXjD82XHUxZinIdN7Xba7rQYvB3atr07PB6P+zfcbjcLAM/nE1Zg5J1DnudlWRZFoVMenQDP4XCoqup8Pnfk1+uFK8uyOI4xiC7+YUk5SweM0+nUq0wc5OVyeTweRbbiRjZ7WJnQNE0hk1Vki95utxA2mw2GyL3KapvrJEl4VenBb17tgF5l2sYFfzabSTOfbBIoBlyv1w+ZsnVdSw8EW6/XhQdyqVsrDi6XS0dumkYXxEVRZHXkMWhgRHZka5vQ/X5P58hmA/OZaqFX2ZYErziTyUQvzz2IP2zbKpseyA6fE3tAVlgn2ICs1xIKf7FYkGKwZL8qS2H9RPzxeByGYeKwWq2YBYs4rLzzYLMhEZUhRA7T6XQ+n5PlsyTMqXVgseBoBzMHM8zmlqYw2H8on8o/wNdL3NergN5IQwR7og+L3Hj06Ukh/gmYP7f4EUUriCdAT34gAG2zHmjDiTN00MDIy4Px81qePRqN8GP8AUEaJcLHFj0qAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 25 16 46 47" title="" data-src="/static/2021-09-25-16-46-47-8ada3b611e2dc933b698f2b30752b5d9-9f4d2.png" data-srcset="/static/2021-09-25-16-46-47-8ada3b611e2dc933b698f2b30752b5d9-a6aa8.png 200w,\n/static/2021-09-25-16-46-47-8ada3b611e2dc933b698f2b30752b5d9-6c7b5.png 400w,\n/static/2021-09-25-16-46-47-8ada3b611e2dc933b698f2b30752b5d9-9f4d2.png 619w" data-sizes="(max-width: 619px) 100vw, 619px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-25-16-47-22-6c8736f8d66604629d5203909eaad641-2c55a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 587px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 99.14821124361158%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsSAAALEgHS3X78AAABeklEQVQ4y32U2XbCMAxE8/8/GEoTmkJWUgjrYQnQ3npSH+EC82AUWyONZJno2+F2u/V9f/mH3sDuX69XWBE0fs7nc9M0q9VqsVh8GbRtO3doHDC0udvtQnLXdZ6Mh4z5PVqHkFzXtSX7EEqo5J683W5DsvcGylkbVFXFqkAhOUmSNE3fHRKH8Xj8ZjAajdiRA9HvyAQOdL7IvF6vf8m6p+PxWBQFBXuy+owNQYV4A2w2m4EMkw/VKY5arUAktLEeN4zM9mLlJOWe/PSey7JUhxXeT0Xl4CtXiEG2bZgu2ae1mX0jdP+PZQfDpMy2YRJ1l5m5x8l3RbBkiVf+kKyaJVs0yVNCe8mPZzvPc/iss9ksd6CQ6XTK56dDlmWsbLLDKxjIgPeJks5huVzK4IVi2xUwW6z7/X4Ykhcg7ul0enYaUSdiCIwTVU0mkw8HSuBtIJvXwunhcMBAMK8ijmNKwDlCBn6I1P9B8QdsmByxUhFkmLSNuCRjn7b9AI+4XXIvEfIzAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 25 16 47 22" title="" data-src="/static/2021-09-25-16-47-22-6c8736f8d66604629d5203909eaad641-2c55a.png" data-srcset="/static/2021-09-25-16-47-22-6c8736f8d66604629d5203909eaad641-44ad4.png 200w,\n/static/2021-09-25-16-47-22-6c8736f8d66604629d5203909eaad641-d4623.png 400w,\n/static/2021-09-25-16-47-22-6c8736f8d66604629d5203909eaad641-2c55a.png 587w" data-sizes="(max-width: 587px) 100vw, 587px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>对于可以分解，但子任务之间需要沟通交流的任务，必须在计划中考虑沟通的工作量。因此在相同人月的前提下，采用增加人手来减少时间得到的最好情况，还是比未调整前差一些</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-25-16-53-09-04a52daa8e77835dd49b72b1db3514a2-715c5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 658px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 94.07294832826747%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAABpklEQVQ4y3WUiY6CQBBE+f8/c000RqJgwJtDEONtxGP3ZUpG2WAltsN011QfA86vwfP5vN1ul8ulLEsWZYXr9Vo24X6/w3Kg8cdDkiSe58VxnOf5arVK05R1FEVYHrMsY4eY2OBwONTIRAyHQ6LTCgQtl0tLxuo4jjgejzUyjiAIwjCUrFVmkRus12vxG8gEzWYz3/clojggclEUIivzF1kNkzIOMpesglRzZqBcmmtW0Gg0Go/HKEQfSCqIyc6LzO/xeJzPZwXhc12XPqFjyVbQrt9kZE+nE0x1lcp7vR5xlIpVw8UUuaZsG6baaAzuwWBA/mpEVsE28j8Zgh0SvcXS+X6/zymhQVBhOp3WGkbZmor6DLQm58lk4ht4FSDv9/u3MmRkKVK5QZNVIzRkoABkvpJtbYIOsodqIg1p25qTD6hn9sLqwr+URcYi+zmPxWLBQtaOl0fsfD6vpf0NZMTb+83r8AHgehHEN4Crwo3HssPZemSfCrfbLXa32+FiHy9EhzQYA47NZsNbwWAZBlPtdDquAdFstlqtHwNuTrfbbbfbxPwBdhgd2bgzRzUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 25 16 53 09" title="" data-src="/static/2021-09-25-16-53-09-04a52daa8e77835dd49b72b1db3514a2-715c5.png" data-srcset="/static/2021-09-25-16-53-09-04a52daa8e77835dd49b72b1db3514a2-c456f.png 200w,\n/static/2021-09-25-16-53-09-04a52daa8e77835dd49b72b1db3514a2-60786.png 400w,\n/static/2021-09-25-16-53-09-04a52daa8e77835dd49b72b1db3514a2-715c5.png 658w" data-sizes="(max-width: 658px) 100vw, 658px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="系统测试"><a href="#%E7%B3%BB%E7%BB%9F%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>系统测试</h2>\n<p>对于软件任务的进度安排，以下是经验法则</p>\n<ul>\n<li>1/3 计划</li>\n<li>1/6 编码</li>\n<li>1/4 构件测试和早期系统测试</li>\n<li>1/4 系统测试，所有的构件已完成</li>\n</ul>\n<p>和传统进度安排的不同点在于：</p>\n<ol>\n<li>分配给计划的时间比平常的多，其只是包含计划规格说明，并不包含预研部分</li>\n<li>对所完成的代码调试、测试投入近一半的时间</li>\n<li>容易估计的部分如编码，分配了很少时间</li>\n</ol>\n<h2 id="空泛的估算"><a href="#%E7%A9%BA%E6%B3%9B%E7%9A%84%E4%BC%B0%E7%AE%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>空泛的估算</h2>\n<p>开发并推行生产率图表、缺陷率图表、估算规则或者在这些数据出来之前，项目经理需要坚持自己的经验直觉</p>\n<h2 id="重复产生的进度灾难"><a href="#%E9%87%8D%E5%A4%8D%E4%BA%A7%E7%94%9F%E7%9A%84%E8%BF%9B%E5%BA%A6%E7%81%BE%E9%9A%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重复产生的进度灾难</h2>\n<p>推荐的解决方式是重新安排进度或者削减任务（在延期成本非常高的情况下）</p>\n<p>向进度落后的项目中增加人手，只会使进度更加落后</p>\n<h1 id="外科手术队伍"><a href="#%E5%A4%96%E7%A7%91%E6%89%8B%E6%9C%AF%E9%98%9F%E4%BC%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>外科手术队伍</h1>\n<h2 id="问题"><a href="#%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题</h2>\n<p>对于效率和概念的完整性来说，最好由少数干练的人员来设计开发，而对于大型系统，则需要人手，以便产品在时间上满足要求</p>\n<h2 id="mills-的建议"><a href="#mills-%E7%9A%84%E5%BB%BA%E8%AE%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mills 的建议</h2>\n<p>Mils 建议大型项目的每一个部分由一个团队解决，由一个人完成问题的分解，其他人给予他需要的支持，以提高效率和生产力</p>\n<p>外科医生即首席程序员，亲自定义功能和性能说明书，设计程序，编制源代码，测试以及书写技术文档。</p>\n<p>副手，能完成任何一部分工作，但是相对经验较少，主要作用是作为设计的思考者、讨论者和评估人员</p>\n<p>管理员，是外科手术的老板，必须在人员、薪酬、办公空间等方面有决定权，是充当与组织中其他管理机构的接口</p>\n<p>编辑，外科医生负责文档的生成，他必须创建各种文档，而编辑根据外科医生的草稿或口述，进行分析和重新组织，提供各种参考信息和书目，对多个版本就行维护，监督文档生成的机制</p>\n<p>2 个文秘，管理员与编辑每个人需要一个文秘，管理员的文秘负责非产品文件和使项目协作一致</p>\n<p>程序职员，负责维护编程产品库中所有团队的技术记录。该职员接受文秘性质的培训，承担机器码文件和可读文件的相关管理责任</p>\n<p>工具维护人员，保证基础服务的可靠性，以及承担团队成员所需要的特殊工具</p>\n<p>测试人员，为各个功能设计测试用例、测试数据，负责计划测试的步骤和为单元测试搭建测试平台</p>\n<p>语言专家，不同于外科医生，外科医生主要是系统设计者以及考虑系统的整体表现，而语言专家则寻找一种简洁、有效的使用语言的方法来解决复杂的问题，他通常需要对一些技术进行一些研究</p>\n<h2 id="如何运作"><a href="#%E5%A6%82%E4%BD%95%E8%BF%90%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何运作</h2>\n<ol>\n<li>和传统 2 人队伍区别：传统的队伍将工作进行划分，每人负责一部分工作的设计和实现。在外科手术团队中，外科医生与副手都了解所有的设计和全部的代码</li>\n<li>遇到冲突时外科手术团队可以由外科医生单方面来统一</li>\n<li>团队中剩余人员职能的专业化分工是高效的关键，减少了之间的交流</li>\n</ol>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-25-17-54-06-ae693ff710c8a51fc1dfb44d500976fc-a51d2.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 644px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 93.47826086956522%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAACOklEQVQ4y32TR48aQRCF588j/gI3xAUQCCFAINKBIIKJIhgwS845LkGk9TfT0ni8WK5Dq9Preu9VtfT1d9xut06n02w2G41GrVar1+u/lBgOh19vIamz1+vFeDweXS6X3W43GAw6nU6v1xuNRrPZ7Pf7xR1x7TtYxP1+7/f7P5UQ+T8+PqrVqsj8eDwE/vl8Mkqvf8Xn5+flclFfPJ/PbPJQuVxOpVLZbLZSqaBOelfC8/v9HjxzMjCyvF6vxWIRpNvtDoVCyWQSahIZNpvNXondbrfdbmGO8tPppM3MOJvNID+fz8fjMdJYSqx5xuFwmEymeDyeSCQWi4UKFvYcDgfwZA6HwxaLBf+CwSASpOVyiTFoQAneQIarsBW01RJQwna7DeCHEkx6vZ6sebVaoZ4z1oIhsrVgwWIymXS73b4S3IS/DMZGamuz2Xw+H7LfwWxijVBH/a1WK5NMJiODMUl9D1eFyQKsNQx30NVWotVqYZv0UEJtMqzWgrWasSaXy2Eq7hQKBbnO0+mULWyEczqdZg5JrmKbCqaKJM/n85iM1R6Ph/uy22SnBpFIhAOOeXW9Xt+U+EabNKPRCJ9wDpRsGJxxmzUHbJFE2/oikIAXkCIBf8bpdPJPSqWSbBg/zuv1YmAgEACsstU2LF7QArRnLBZDNhNQkiggAvg6/F5tY/0nnkr8+RjAMIkMlBSRdB5yaHssED3Pkn7WllBS81BnuoV7g8GAOT1Iz8KIEmAkLRGNRpFKkVXwbz0ZB4lkIAldAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 25 17 54 06" title="" data-src="/static/2021-09-25-17-54-06-ae693ff710c8a51fc1dfb44d500976fc-a51d2.png" data-srcset="/static/2021-09-25-17-54-06-ae693ff710c8a51fc1dfb44d500976fc-3ed9e.png 200w,\n/static/2021-09-25-17-54-06-ae693ff710c8a51fc1dfb44d500976fc-b94d0.png 400w,\n/static/2021-09-25-17-54-06-ae693ff710c8a51fc1dfb44d500976fc-a51d2.png 644w" data-sizes="(max-width: 644px) 100vw, 644px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="团队的扩建"><a href="#%E5%9B%A2%E9%98%9F%E7%9A%84%E6%89%A9%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>团队的扩建</h2>\n<p>整个系统必须具备概念上的完整性，需要有一个系统结构师自上而下的进行所有的设计，必须清晰的划分体系结构设计和实现之间的界线</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/人月神话读书笔记/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2021-09-25 14:47:15",path:"/man-moon-myth-notes/",tags:"软件工程, 人月神话, 读书笔记",title:"人月神话读书笔记",draft:null}},{excerpt:"基础 简介 entry（入口） 入口起点（entry point）即是 webpack 通过该起点找到本次项目所直接或间接依赖的资源（模块、库等），并对其进行处理，最后输出到 bundle 中。入口文件由用户自定义，可以是一个或者多个，每一个 entry 最后对应一个 bundle。 output（出口） 通过配置 output 属性可以告诉 webpack 将 bundle 命名并输出到对应的位置。 loader webpack 核心，webpack 本身只能识别 js 文件，对于非 js…",html:'<h1 id="基础"><a href="#%E5%9F%BA%E7%A1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基础</h1>\n<h2 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h2>\n<h3 id="entry（入口）"><a href="#entry%EF%BC%88%E5%85%A5%E5%8F%A3%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>entry（入口）</h3>\n<p>入口起点（entry point）即是 webpack 通过该起点找到本次项目所直接或间接依赖的资源（模块、库等），并对其进行处理，最后输出到 bundle 中。入口文件由用户自定义，可以是一个或者多个，每一个 entry 最后对应一个 bundle。</p>\n<h3 id="output（出口）"><a href="#output%EF%BC%88%E5%87%BA%E5%8F%A3%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>output（出口）</h3>\n<p>通过配置 output 属性可以告诉 webpack 将 bundle 命名并输出到对应的位置。</p>\n<h3 id="loader"><a href="#loader" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>loader</h3>\n<p>webpack 核心，webpack 本身只能识别 js 文件，对于非 js 文件，即需要 loader 转换为 js 文件。换句话说，Loader 就是资源转换器。由于在 webpack 里，所有的资源都是模块，不同资源都最终转化成 js 去处理。针对不同形式的资源采用不同的 Loader 去编译，这就是 Loader 的意义。</p>\n<h3 id="插件（plugin）"><a href="#%E6%8F%92%E4%BB%B6%EF%BC%88plugin%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>插件（plugin）</h3>\n<p>webpack 核心，loader 处理非 js 文件，那么插件可以有更广泛的用途。整个 webpack 其实就是各类的插件形成的，插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。</p>\n<h3 id="chunk"><a href="#chunk" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Chunk</h3>\n<p>被 entry 所依赖的额外的代码块，同样可以包含一个或者多个文件。chunk 也就是一个个的 js 文件，在异步加载中用处很大。chunk 实际上就是 webpack 打包后的产物，如果你不想最后生成一个包含所有的 bundle，那么可以生成一个个 chunk，并通过按需加载引入。同时它还能通过插件提取公共依赖生成公共 chunk，避免多个 bundle 中有多个相同的依赖代码。</p>\n<h2 id="实践--优化"><a href="#%E5%AE%9E%E8%B7%B5--%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实践 &#x26; 优化</h2>\n<h3 id="url-loader--image-webpack-loader"><a href="#url-loader--image-webpack-loader" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>url-loader &#x26; image-webpack-loader</h3>\n<p>url-loader 可以在文件大小（单位 byte）低于指定的限制，将文件转换为 DataURL，这在实际开发中非常有效，能够减少请求数，在 vue-cli 和 create-react-app 中也都能看到对这个 loader 的使用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96535371335741260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// &quot;url&quot; loader works just like &quot;file&quot; loader but it also embeds\n// assets smaller than specified size as data URLs to avoid requests.\n{\n  test: [/\\.bmp\\$/, /\\.gif\\$/, /\\.jpe?g\\$/, /\\.png\\$/],\n  loader: require.resolve(\'url-loader\'),\n  options: {\n    limit: 10000,\n    name: \'static/media/[name].[hash:8].[ext]\',\n  },\n},`, `96535371335741260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// "url" loader works just like "file" loader but it also embeds</span>\n<span class="token comment">// assets smaller than specified size as data URLs to avoid requests.</span>\n<span class="token punctuation">{</span>\n  test<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/\\.bmp$/</span><span class="token punctuation">,</span> <span class="token regex">/\\.gif$/</span><span class="token punctuation">,</span> <span class="token regex">/\\.jpe?g$/</span><span class="token punctuation">,</span> <span class="token regex">/\\.png$/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  loader<span class="token punctuation">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'url-loader\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    limit<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>\n    name<span class="token punctuation">:</span> <span class="token string">\'static/media/[name].[hash:8].[ext]\'</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>image-webpack-loader 这是一个可以通过设置质量参数来压缩图片的插件，但个人觉得在实际开发中并不会经常使用，图片一般是 UI 提供，一般来说，他们是不会同意改变图片的质量。</p>\n<h3 id="资源私有化"><a href="#%E8%B5%84%E6%BA%90%E7%A7%81%E6%9C%89%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>资源私有化</h3>\n<p>以这种方式加载资源，你可以以更直观的方式将模块和资源组合在一起。无需依赖于含有全部资源的 /assets 目录，而是将资源与代码组合在一起。例如，类似这样的结构会非常有用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81808241093605310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`- |- /assets\n+ |– /components\n+ |  |– /my-component\n+ |  |  |– index.jsx\n+ |  |  |– index.css\n+ |  |  |– icon.svg\n+ |  |  |– img.png`, `81808241093605310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">- |- /assets\n+ |– /components\n+ |  |– /my-component\n+ |  |  |– index.jsx\n+ |  |  |– index.css\n+ |  |  |– icon.svg\n+ |  |  |– img.png</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然，这种选择见仁见智</p>\n<h3 id="tree-shaking"><a href="#tree-shaking" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tree-Shaking</h3>\n<p>前端中的 tree-shaking 就是将一些无关的代码删掉不打包。在 Webpack 项目中，我们通常会引用很多文件，但实际上我们只引用了其中的某些模块，但却需要引入整个文件进行打包，会导致我们的打包结果变得很大，通过 tree-shaking 将没有使用的模块摇掉，这样来达到删除无用代码的目的。</p>\n<p>Tree-Shaking 的原理可以参考<a href="https://juejin.cn/post/6844903544756109319" target="_blank" rel="nofollow noreferrer noopener">这篇文章</a></p>\n<p>归纳起来就是</p>\n<blockquote>\n<ol>\n<li>ES6 的模块引入是静态分析的，故而可以在编译时正确判断到底加载了什么代码。</li>\n<li>分析程序流，判断哪些变量未被使用、引用，进而删除此代码</li>\n</ol>\n</blockquote>\n<p><a href="https://segmentfault.com/a/1190000012794598" target="_blank" rel="nofollow noreferrer noopener">Tree-Shaking 不起作用，代码没有被删？</a></p>\n<p>归纳起来就是</p>\n<blockquote>\n<p>因为 Babel 的转译，使得引用包的代码有了副作用，而副作用会导致 Tree-Shaking 失效。</p>\n</blockquote>\n<p>Webpack 4 默认启用了 Tree Shaking。对副作用进行了消除，以下是在 4.19.1 的实验</p>\n<p>index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84430027051754930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { cube } from \'./math.js\';\n\nconsole.log(cube(5));`, `84430027051754930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> cube <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./math.js\'</span><span class="token punctuation">;</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">cube</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>math.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21019948249962450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不打包 square\nexport class square {\n  constructor() {\n    console.log(\'square\');\n  }\n}\n\nexport class cube {\n  constructor(x) {\n    return x * x * x;\n  }\n}`, `21019948249962450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 不打包 square</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">square</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'square\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">cube</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25122934978108980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// babel 编译后，同不打包\n\'use strict\';\n\nObject.defineProperty(exports, \'__esModule\', {\n  value: true\n});\nexports.cube = cube;\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\'Cannot call a class as a function\');\n  }\n}\n\nvar square = (exports.square = function square() {\n  _classCallCheck(this, square);\n\n  console.log(\'square\');\n});\n\nfunction cube(x) {\n  console.log(\'cube\');\n  return x * x * x;\n}`, `25122934978108980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// babel 编译后，同不打包</span>\n<span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\nObject<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">\'__esModule\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nexports<span class="token punctuation">.</span>cube <span class="token operator">=</span> cube<span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> Constructor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>instance <span class="token keyword">instanceof</span> <span class="token class-name">Constructor</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">\'Cannot call a class as a function\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">var</span> square <span class="token operator">=</span> <span class="token punctuation">(</span>exports<span class="token punctuation">.</span><span class="token function-variable function">square</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">_classCallCheck</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> square<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'square\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'cube\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8284137072746644000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不打包\nexport function square(x) {\n  console.log(\'square\');\n  return x.a;\n}\n\nexport function cube(x) {\n  return x * x * x;\n}`, `8284137072746644000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 不打包</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'square\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> x<span class="token punctuation">.</span>a<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16040293465196775000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// wow 被打包\nexport function square() {\n  console.log(\'square\');\n  return x.a;\n}\n\nsquare({ a: 1 });\n\nexport function cube() {\n  return x * x * x;\n}`, `16040293465196775000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// wow 被打包</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'square\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> x<span class="token punctuation">.</span>a<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">square</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="sourcemap"><a href="#sourcemap" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>sourcemap</h3>\n<p>简单说，Source map 就是一个信息文件，里面储存着位置信息。也就是说，转换后的代码的每一个位置，所对应的转换前的位置。</p>\n<p>有了它，出错的时候，除错工具将直接显示原始代码，而不是转换后的代码，这无疑给开发者带来了很大方便。</p>\n<p>webpack 中的 devtool 配置项可以设置 sourcemap，可以参考官方文档，然而 devtool 的许多选项都讲的不是很清楚，这里推荐该<a href="https://juejin.cn/post/6844903450644316174" target="_blank" rel="nofollow noreferrer noopener">文章</a>，讲的比较详细</p>\n<p>要注意，避免在生产中使用 <code class="language-text">inline-*</code> 和 <code class="language-text">eval-*</code>，因为它们可以增加 bundle 大小，并降低整体性能。</p>\n<h3 id="模块热替换"><a href="#%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块热替换</h3>\n<p>热替换这一块目前大多数都是用的 webpack-dev-middleware 插件配合服务器使用的，而官方提供的 watch 模式反而比较少用，当然 webpack-dev-middleware 的底层监听 watch mode</p>\n<p>至于为什么不直接使用 watch 模式，则是 webpack-dev-middleware 快速编译，走内存；只依赖 webpack 的 watch mode 来监听文件变更，自动打包、每次变更都将新文件打包到本地，就会很慢。</p>\n<h3 id="defineplugin"><a href="#defineplugin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DefinePlugin</h3>\n<p>webpack.DefinePlugin 定义环境变量 process.env，这在实际开发中比较常用，参考 create-react-app 中的代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84308836164758600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Makes some environment variables available to the JS code, for example:\n// if (process.env.NODE_ENV === \'development\') { ... }. See \\`./env.js\\`.\nnew webpack.DefinePlugin(env.stringified)`, `84308836164758600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Makes some environment variables available to the JS code, for example:</span>\n<span class="token comment">// if (process.env.NODE_ENV === \'development\') { ... }. See `./env.js`.</span>\n<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>stringified<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>不过，要注意不能在 config 中使用，因为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88069007420632660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`process.env.NODE_ENV === \'production\' ? \'[name].[hash].bundle.js\' : \'[name].bundle.js\';`, `88069007420632660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">\'production\'</span> <span class="token operator">?</span> <span class="token string">\'[name].[hash].bundle.js\'</span> <span class="token punctuation">:</span> <span class="token string">\'[name].bundle.js\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<blockquote>\n<p>NODE_ENV is set in the compiled code, not in the webpack.config.js file. You should not use enviroment variables in your configuration. Pass options via —env.option abc and export a function from the webpack.config.js.</p>\n</blockquote>\n<p>大致意思就是 NODE_ENV 是设置在 compiled 里面，而不是 config 文件里。</p>\n<h3 id="extracttextwebpackplugin"><a href="#extracttextwebpackplugin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ExtractTextWebpackPlugin</h3>\n<p>ExtractTextWebpackPlugin 将 css 抽取成单独文件，可以通过这种方式配合后端对 css 文件进行缓存。</p>\n<h3 id="splitchunksplugin"><a href="#splitchunksplugin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SplitChunksPlugin</h3>\n<p>webpack4 的代码分割插件。</p>\n<p>webpack4 中支持了零配置的特性，同时对块打包也做了优化，CommonsChunkPlugin 已经被移除了，现在是使用 optimization.splitChunks 代替。SplitChunksPlugin 的配置有几个需要比较关注一下</p>\n<ul>\n<li>async: 默认值， 将按需引用的模块打包</li>\n<li>initial: 分开优化打包异步和非异步模块</li>\n<li>all: all 会把异步和非异步同时进行优化打包。也就是说 moduleA 在 indexA 中异步引入，indexB 中同步引入，initial 下 moduleA 会出现在两个打包块中，而 all 只会出现一个。</li>\n</ul>\n<p>使用 cacheGroups 可以自定义配置打包块。</p>\n<h3 id="动态引入"><a href="#%E5%8A%A8%E6%80%81%E5%BC%95%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动态引入</h3>\n<p>利用动态引入的文件打包成另一个包并懒加载它，其与 SplitChunksPlugin 的 cacheGroups 区别：</p>\n<ul>\n<li>Bundle splitting：实际上就是创建多个更小的文件，并行加载，以获得更好的缓存效果；主要的作用就是使浏览器并行下载，提高下载速度。并且运用浏览器缓存，只有代码被修改，文件名中的哈希值改变了才会去再次加载</li>\n<li>Code splitting：只加载用户最需要的部分，其余的代码都遵从懒加载的策略；主要的作用就是加快页面加载速度，不加载不必要加载的东西。</li>\n</ul>\n<p>参考代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33306854615114090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import _ from \'lodash\';\n\nfunction component() {\n  var element = document.createElement(\'div\');\n  var button = document.createElement(\'button\');\n  var br = document.createElement(\'br\');\n\n  button.innerHTML = \'Click me and look at the console!\';\n  element.innerHTML = _.join([\'Hello\', \'webpack\'], \' \');\n  element.appendChild(br);\n  element.appendChild(button);\n\n  // Note that because a network request is involved, some indication\n  // of loading would need to be shown in a production-level site/app.\n  button.onclick = (e) =>\n    import(/* webpackChunkName: &quot;print&quot; */ \'./print\').then((module) => {\n      var print = module.default;\n\n      print();\n    });\n\n  return element;\n}\n\ndocument.body.appendChild(component());`, `33306854615114090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">\'lodash\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> br <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'br\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  button<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">\'Click me and look at the console!\'</span><span class="token punctuation">;</span>\n  element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'Hello\'</span><span class="token punctuation">,</span> <span class="token string">\'webpack\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>br<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  element<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Note that because a network request is involved, some indication</span>\n  <span class="token comment">// of loading would need to be shown in a production-level site/app.</span>\n  button<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "print" */</span> <span class="token string">\'./print\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> print <span class="token operator">=</span> module<span class="token punctuation">.</span>default<span class="token punctuation">;</span>\n\n      <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> element<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\ndocument<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>注意当调用 ES6 模块的 import() 方法（引入模块）时，必须指向模块的 .default 值，因为它才是 promise 被处理后返回的实际的 module 对象。</p>\n</blockquote>\n<h3 id="缓存-runtimechunk"><a href="#%E7%BC%93%E5%AD%98-runtimechunk" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缓存 runtimeChunk</h3>\n<p>因为 webpack 会把运行时代码放到最后的一个 bundle 中，所以即使我们修改了其他文件的代码，最后的一个 bundle 的 hash 也会改变，runtimeChunk 是把运行时代码单独提取出来的配置。这样就有利于我们和后端配合缓存文件。</p>\n<ul>\n<li>single: 所有入口共享一个生成的 runtimeChunk</li>\n<li>true/mutiple: 每个入口生成一个单独的 runtimeChunk</li>\n</ul>\n<h3 id="模块标识符"><a href="#%E6%A8%A1%E5%9D%97%E6%A0%87%E8%AF%86%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块标识符</h3>\n<p>有时候我们只是添加了个文件 print.js， 并在 index 引入</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23981110366577705000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import Print from \'./print\';`, `23981110366577705000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> Print <span class="token keyword">from</span> <span class="token string">\'./print\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>打包的时候，期望只有 runtime 和 main 两个 bundle 的 hash 发生改变，但是通常所有 bundle 都发生了变化，因为每个 module.id 会基于默认的解析顺序(resolve order)进行增量。也就是说，当解析顺序发生变化，ID 也会随之改变。</p>\n<p>可以使用两个插件来解决这个问题。第一个插件是 NamedModulesPlugin，将使用模块的路径，而不是数字标识符。虽然此插件有助于在开发过程中输出结果的可读性，然而执行时间会长一些。第二个选择是使用 HashedModuleIdsPlugin。</p>\n<h3 id="provideplugin"><a href="#provideplugin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ProvidePlugin</h3>\n<p>通过 ProvidePlugin 处理全局变量，以及其他更细粒度的<a href="https://www.webpackjs.com/guides/shimming/" target="_blank" rel="nofollow noreferrer noopener">处理</a></p>\n<h3 id="polyfills-的处理"><a href="#polyfills-%E7%9A%84%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>polyfills 的处理</h3>\n<p>首先了解一下 polyfills， 虽然在 webpack 中能够使用 es6\\es7 等的 API，但并不代表编译器支持这些 API，所以通常我们会用 polyfills 来自定义一个 API。</p>\n<p>那么在 webpack 中，一般是使用 babel-polyfill VS babel-runtime VS babel-preset-env 等来支持这些 API，而这三种怎么选择也是一个问题。</p>\n<p>在真正进入主题之前，我们先看一个 preset-env 的配置项，同时也是 package.json 中的一个配置项 browserslist</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82306959211986220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;browserslist&quot;: [&quot;last 1 version&quot;, &quot;> 1%&quot;, &quot;maintained node versions&quot;, &quot;not dead&quot;]\n}`, `82306959211986220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"last 1 version"</span><span class="token punctuation">,</span> <span class="token string">"> 1%"</span><span class="token punctuation">,</span> <span class="token string">"maintained node versions"</span><span class="token punctuation">,</span> <span class="token string">"not dead"</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>根据这个配置，preset-env 或者 postcss 等会根据你的参数支持不同的 polyfills，具体的参数配置参考该<a href="https://juejin.cn/post/6844903669524086797" target="_blank" rel="nofollow noreferrer noopener">文章</a></p>\n<ul>\n<li>babel-polyfill 只需要引入一次，但会重写一些原生的已支持的方法，而且体积很大。</li>\n<li>transform-runtime 是利用 plugin 自动识别并替换代码中的新特性，你不需要再引入，只需要装好 babel-runtime 和 配好 plugin 就可以了。好处是按需替换，检测到你需要哪个，就引入哪个 polyfill，值得注意的是，instance 上新添加的一些方法，babel-plugin-transform-runtime 是没有做处理的，比如 数组的 includes, filter, fill 等</li>\n<li>babel-preset-env 根据当前的运行环境，自动确定你需要的 plugins 和 polyfills。通过各个 es 标准 feature 在不同浏览器以及 node 版本的支持情况，再去维护一个 feature 跟 plugins 之间的映射关系，最终确定需要的 plugins。</li>\n</ul>\n<h3 id="后编译"><a href="#%E5%90%8E%E7%BC%96%E8%AF%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后编译</h3>\n<p>日常我们引用的 Npm 包都是编译好的，这样带来的方便的同时也暴露了一些问题。</p>\n<p>代码冗余：一般来说，这些 NPM 包也是基于 ES2015+ 开发的，每个包都需要经过 babel 编译发布后才能被主应用使用，而这个编译过程往往会附加很多“编译代码”；每个包都会有一些相同的编译代码，这就造成大量代码的冗余，并且这部分冗余代码是不能通过 Tree Shaking 等技术去除掉的。</p>\n<p>非必要的依赖：考虑到组件库的场景，通常我们为了方便一股脑引入了所有组件；但实际情况下对于一个应用而言可能只是用到了部分组件，此时如果全部引入，也会造成代码冗余。</p>\n<p>所以我们自己的公司组件可以采用后编译的形式，即发布的是未经编译的 npm 包，在项目构建时才编译，我们公司采用的也是这种做法，因为我们的包都在一个目录下，所以不用考虑递归编译的问题。</p>\n<h3 id="设置环境变量"><a href="#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置环境变量</h3>\n<p>这个比较简单，直接看代码或者官方文档即可</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68058340640783040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`webpack --env.NODE_ENV=local --env.production --progress`, `68058340640783040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">webpack --env.NODE_ENV<span class="token operator">=</span>local --env.production --progress</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="其他插件"><a href="#%E5%85%B6%E4%BB%96%E6%8F%92%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他插件</h3>\n<ul>\n<li>CompressionWebpackPlugin 将文件压缩 文件大小减小很多 需要后端协助配置</li>\n<li>mini-css-extract-plugin 将 CSS 分离出来</li>\n<li>wbepack.IgnorePlugin 忽略匹配的模块</li>\n<li>uglifyjs-webpack-plugin 代码丑化，webpack4 的 mode（product）自动配置</li>\n<li>optimize-css-assets-webpack-plugincss 压缩</li>\n<li>webpack-md5-hash 使你的 chunk 根据内容生成 md5，用这个 md5 取代 webpack chunkhash。</li>\n<li>dllPlugin 提高构建速度</li>\n</ul>\n<h1 id="插件机制"><a href="#%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>插件机制</h1>\n<h2 id="tapable"><a href="#tapable" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tapable</h2>\n<p>Webpack 的插件机制依赖于一个核心的库 Tapable。</p>\n<h3 id="tapable-是什么"><a href="#tapable-%E6%98%AF%E4%BB%80%E4%B9%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tapable 是什么</h3>\n<p>tapable 是一个类似于 nodejs 的 EventEmitter 的库, 主要是控制钩子函数的发布与订阅。当然，tapable 提供的 hook 机制比较全面，分为同步和异步两个大类(异步中又区分异步并行和异步串行)，而根据事件执行的终止条件的不同，由衍生出 Bail/Waterfall/Loop 类型。</p>\n<h3 id="tapable-的使用"><a href="#tapable-%E7%9A%84%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tapable 的使用</h3>\n<h4 id="基本使用"><a href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本使用</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94734236813474050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const { SyncHook } = require(\'tapable\');\n\n// 创建一个同步 Hook，指定参数\nconst hook = new SyncHook([\'arg1\', \'arg2\']);\n\n// 注册\nhook.tap(\'a\', function(arg1, arg2) {\n  console.log(\'a\');\n});\n\nhook.tap(\'b\', function(arg1, arg2) {\n  console.log(\'b\');\n});\n\nhook.call(1, 2);`, `94734236813474050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> SyncHook <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'tapable\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 创建一个同步 Hook，指定参数</span>\n<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'arg1\'</span><span class="token punctuation">,</span> <span class="token string">\'arg2\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 注册</span>\nhook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nhook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="钩子类型"><a href="#%E9%92%A9%E5%AD%90%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>钩子类型</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-11-08-07-97daa6010e75947671c8dd6a6f2953d9-5fd75.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 97.3901098901099%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAACIUlEQVQ4y2NgoAwwAjE7Pz+HmDgjExOyBBs3N7+CIhMrG26tjCDNKjKyflZWbKysyIL8vLzB9vbiAoJwEXTABBat8PS42FBnKCcHEWFiAgm6aGtda2lItLGCK8O0GUTqysrGWVnycHBAvAFRKMLHl2RrrSQmygATIeB54gSRgKSmdnL/lII5i9xzClnY2SGCnHz8QVX1hXMXR7X18ImJq1pYJU2YHtfemzZpholfECIUhOXkvXKLwqobTIPCmFmgYcbGxWUXmxhWXe+WkcslICijpQNU45aW6Z1bpG5tizMIsYULE06lLGxsEmoaisZm/OLiCA1MTCLyCkom5sKy8kAuj5AwUI24sioIqagBPQJVp2hqXr52S8uO/ZEdfaycnBBBEXnF3AXLWnfuz5i9iFtI2DwssmrTzsJla0qWr6vZtNM1Kx+qmZmFRUJFTdHAmE8U2WZGYVk5BT1DIWkZIJdbUEhMURmIxJWUxRWV+UTFGKgAhOUU/Esr41q7LEIjmVhYIILsPDzG3j6uiUn67h5snFyQUGBiBgIWlPCTUFWP7+zPnTnfJT2bGZYNOPn5baNigopKLUPDgQZB0zIzMwOWYGcEGkwwwhiB9mJJ244umhU1XuKS/BBFjOCMoWcoU13vpaEtDQ5UZizWQlzv7a/b0RMoIwfNfZBcZW6l1Dsx1MBEHuxg3A5jZWMREOJEz63MjAJCXBBXoNnHwsICDD4A+2delzfOjGkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 11 08 07" title="" data-src="/static/2021-09-02-11-08-07-97daa6010e75947671c8dd6a6f2953d9-fee1c.png" data-srcset="/static/2021-09-02-11-08-07-97daa6010e75947671c8dd6a6f2953d9-a67b7.png 200w,\n/static/2021-09-02-11-08-07-97daa6010e75947671c8dd6a6f2953d9-0b187.png 400w,\n/static/2021-09-02-11-08-07-97daa6010e75947671c8dd6a6f2953d9-fee1c.png 800w,\n/static/2021-09-02-11-08-07-97daa6010e75947671c8dd6a6f2953d9-b1a91.png 1200w,\n/static/2021-09-02-11-08-07-97daa6010e75947671c8dd6a6f2953d9-5fd75.png 1456w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-a5264.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 82.09934395501406%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACe0lEQVQ4y41US08aURidGWYYBaHRARGGOqC2zkB5jI80PnkKihGhgpI0rTUpBVvS1iY+i5LGLrpp0k033bar9keeXmZQRCVh8eXe3Pnm3O8753yXoigKvQUNiqZ7yaXQb7VCEN0wcFzXRKd9GKOieOecvnsJhQVFxq/qG9DNHxU/cqcX2Dq/hBSevk6sRJZwtr6m7Y0sowVzBXob8AHDYGbYph2wPA+b5IHdM9ZRsdXIwWsdQB/Zm0hVHFk9bhGRWAwPRRfsNuGqWgrKcgyLe2XYRiVIwTCm1rMIrazCH0vqFZnMyB4conB4iiGXG6vVGoqnDVR+/MTa8114HQ4CHIWBZXXAqXQGOfLDkEuEmsniw++/OPjzD8nyWw2QMRjgmlTg9gfAm83axY7xRxA8XvSZB7RqO1q+GQOCDbPZPOYKJW2v0WDk8SSeRCCRAsVykNRpKEtRKJE4XIQaE8nhObYNOF/YwfbJOQaJ0vLiMqKvXiP6Yg9TmQ0ties3IU7OSid1vKzuo0ZaLda/YPfbd4TiKS2HZw1tQHl+EXP5AsxDAiZmn2KhWMICucRHuL3dgSAIyH48RO64ju2LS/gS9wCKkzLURBIWm/1eDzbVDibTCBGu7/vOMkR1hm4Dzmw8w9ZxA87Hsi4CUYshVqJJaC2bTEiV97H5/hOCahhjig9SIAhvSMXgyAiMzG0fWliE1ZGeRjAWXUbx6AybR5+x0/iKQCzRHs1rDn1OVGoRYg+mK9BVtQaaQrr6DnkiYpNDf4vDG3Pe6+PQAiae1H04AUlWYGlZq6sP7w6/vq6s+rBdmtE5bkXX16aX8I4LhBqHDkgU1eeW7nh1mvEfJj2Z83rrNUoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 11 08 24" title="" data-src="/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-fee1c.png" data-srcset="/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-a67b7.png 200w,\n/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-0b187.png 400w,\n/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-fee1c.png 800w,\n/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-b1a91.png 1200w,\n/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-95179.png 1600w,\n/static/2021-09-02-11-08-24-67e3a49b25714423879b47b26d5e39b9-a5264.png 2134w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h5 id="basichook"><a href="#basichook" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BasicHook</h5>\n<p>执行每一个，不关心函数的返回值，有 SyncHook、AsyncParallelHook、AsyncSeriesHook。</p>\n<h5 id="bailhook"><a href="#bailhook" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BailHook</h5>\n<p>顺序执行 Hook，遇到第一个结果 result!==undefined 则返回，不再继续执行。有：SyncBailHook、AsyncSeriseBailHook, AsyncParallelBailHook。</p>\n<p>什么样的场景下会使用到 BailHook 呢？设想如下一个例子：假设我们有一个模块 M，如果它满足 A 或者 B 或者 C 三者任何一个条件，就将其打包为一个单独的。这里的 A、B、C 不存在先后顺序，那么就可以使用 AsyncParallelBailHook 来解决:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99068298251722180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x.hooks.拆分模块的Hook.tap(\'A\', () => {\n  if (A 判断条件满足) {\n    return true\n  }\n})\nx.hooks.拆分模块的Hook.tap(\'B\', () => {\n  if (B 判断条件满足) {\n    return true\n  }\n})\nx.hooks.拆分模块的Hook.tap(\'C\', () => {\n  if (C 判断条件满足) {\n    return true\n  }\n})`, `99068298251722180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">x<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>拆分模块的Hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">A</span> 判断条件满足<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\nx<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>拆分模块的Hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">B</span> 判断条件满足<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\nx<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>拆分模块的Hook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'C\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">C</span> 判断条件满足<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 A 中返回为 true，那么就无须再去判断 B 和 C。但是当 A、B、C 的校验，需要严格遵循先后顺序时，就需要使用有顺序的 SyncBailHook(A、B、C 是同步函数时使用) 或者 AsyncSeriseBailHook(A、B、C 是异步函数时使用)。</p>\n<h5 id="waterfallhook"><a href="#waterfallhook" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WaterfallHook</h5>\n<p>类似于 reduce，如果前一个 Hook 函数的结果 result !== undefined，则 result 会作为后一个 Hook 函数的第一个参数。既然是顺序执行，那么就只有 Sync 和 AsyncSeries 类中提供这个 Hook：SyncWaterfallHook，AsyncSeriesWaterfallHook</p>\n<p>当一个数据，需要经过 A，B，C 三个阶段的处理得到最终结果，并且 A 中如果满足条件 a 就处理，否则不处理，B 和 C 同样，那么可以使用如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40441839151291140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x.hooks.tap(\'A\', (data) => {\n  if (满足 A 需要处理的条件) {\n    // 处理数据 data\n    return data\n  } else {\n    return\n  }\n})\nx.hooks.tap(\'B\', (data) => {\n  if (满足B需要处理的条件) {\n    // 处理数据 data\n    return data\n  } else {\n    return\n  }\n})\nx.hooks.tap(\'C\', (data) => {\n  if (满足 C 需要处理的条件) {\n    // 处理数据 data\n    return data\n  } else {\n    return\n  }\n})`, `40441839151291140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">x<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>满足 <span class="token constant">A</span> 需要处理的条件<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 处理数据 data</span>\n    <span class="token keyword">return</span> data\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\nx<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>满足<span class="token constant">B</span>需要处理的条件<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 处理数据 data</span>\n    <span class="token keyword">return</span> data\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\nx<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'C\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>满足 <span class="token constant">C</span> 需要处理的条件<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 处理数据 data</span>\n    <span class="token keyword">return</span> data\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="loophook"><a href="#loophook" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LoopHook</h5>\n<p>不停的循环执行 Hook，直到所有函数结果 result === undefined。同样的，由于对串行性有依赖，所以只有 SyncLoopHook 和 AsyncSeriseLoopHook</p>\n<h3 id="tapable-的源码分析"><a href="#tapable-%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tapable 的源码分析</h3>\n<p>Tapable 基本逻辑是，先通过类实例的 tap 方法注册对应 Hook 的处理函数， 这里直接分析 sync 同步钩子的主要流程，其他的异步钩子和拦截器等就不赘述了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32294438893431665000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const hook = new SyncHook([\'arg1\', \'arg2\']);`, `32294438893431665000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'arg1\'</span><span class="token punctuation">,</span> <span class="token string">\'arg2\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>从该句代码，作为源码分析的入口</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60084708604191660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class SyncHook extends Hook {\n  // 错误处理，防止调用者调用异步钩子\n  tapAsync() {\n    throw new Error(\'tapAsync is not supported on a SyncHook\');\n  }\n  // 错误处理，防止调用者调用 promise 钩子\n  tapPromise() {\n    throw new Error(\'tapPromise is not supported on a SyncHook\');\n  }\n  // 核心实现\n  compile(options) {\n    factory.setup(this, options);\n    return factory.create(options);\n  }\n}`, `60084708604191660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">SyncHook</span> <span class="token keyword">extends</span> <span class="token class-name">Hook</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 错误处理，防止调用者调用异步钩子</span>\n  <span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'tapAsync is not supported on a SyncHook\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 错误处理，防止调用者调用 promise 钩子</span>\n  <span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'tapPromise is not supported on a SyncHook\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 核心实现</span>\n  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    factory<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> factory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从类 SyncHook 看到，他是继承于一个基类 Hook，他的核心实现 compile 等会再讲，我们先看看基类 Hook</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25945579990878120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 变量的初始化\nconstructor(args) {\n if (!Array.isArray(args)) args = [];\n this._args = args;\n this.taps = [];\n this.interceptors = [];\n this.call = this._call;\n this.promise = this._promise;\n this.callAsync = this._callAsync;\n this._x = undefined;\n}`, `25945579990878120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 变量的初始化</span>\n<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>_args <span class="token operator">=</span> args<span class="token punctuation">;</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>taps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>interceptors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>call <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_call<span class="token punctuation">;</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>promise <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_promise<span class="token punctuation">;</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>callAsync <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_callAsync<span class="token punctuation">;</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>_x <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>初始化完成后，通常会注册一个事件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23352627254841217000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 注册\nhook.tap(\'a\', function(arg1, arg2) {\n  console.log(\'a\');\n});\n\nhook.tap(\'b\', function(arg1, arg2) {\n  console.log(\'b\');\n});`, `23352627254841217000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 注册</span>\nhook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nhook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>很明显这两个语句都会调用基类中的 tap 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9451864991394388000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`tap(options, fn) {\n    // 参数处理\n if (typeof options === &quot;string&quot;) options = { name: options };\n if (typeof options !== &quot;object&quot; || options === null)\n  throw new Error(\n   &quot;Invalid arguments to tap(options: Object, fn: function)&quot;\n  );\n options = Object.assign({ type: &quot;sync&quot;, fn: fn }, options);\n if (typeof options.name !== &quot;string&quot; || options.name === &quot;&quot;)\n  throw new Error(&quot;Missing name for tap&quot;);\n // 执行拦截器的 register 函数， 比较简单不分析\n options = this._runRegisterInterceptors(options);\n // 处理注册事件\n this._insert(options);\n}`, `9451864991394388000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">tap</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 参数处理</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> options <span class="token punctuation">}</span><span class="token punctuation">;</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">!==</span> <span class="token string">"object"</span> <span class="token operator">||</span> options <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span>\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>\n   <span class="token string">"Invalid arguments to tap(options: Object, fn: function)"</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">"sync"</span><span class="token punctuation">,</span> fn<span class="token punctuation">:</span> fn <span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">"string"</span> <span class="token operator">||</span> options<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">""</span><span class="token punctuation">)</span>\n  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Missing name for tap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token comment">// 执行拦截器的 register 函数， 比较简单不分析</span>\n options <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_runRegisterInterceptors</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token comment">// 处理注册事件</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_insert</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从上面的源码分析， 可以看到 _insert 方法是注册阶段的关键函数， 直接进入该方法内部</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2380235950001275000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`_insert(item) {\n    // 重置所有的 调用 方法\n this._resetCompilation();\n // 将注册事件排序后放进taps数组\n let before;\n if (typeof item.before === &quot;string&quot;) before = new Set([item.before]);\n else if (Array.isArray(item.before)) {\n  before = new Set(item.before);\n }\n let stage = 0;\n if (typeof item.stage === &quot;number&quot;) stage = item.stage;\n let i = this.taps.length;\n while (i > 0) {\n  i--;\n  const x = this.taps[i];\n  this.taps[i + 1] = x;\n  const xStage = x.stage || 0;\n  if (before) {\n   if (before.has(x.name)) {\n    before.delete(x.name);\n    continue;\n   }\n   if (before.size > 0) {\n    continue;\n   }\n  }\n  if (xStage > stage) {\n   continue;\n  }\n  i++;\n  break;\n }\n this.taps[i] = item;\n}`, `2380235950001275000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">_insert</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 重置所有的 调用 方法</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_resetCompilation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token comment">// 将注册事件排序后放进taps数组</span>\n <span class="token keyword">let</span> before<span class="token punctuation">;</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> item<span class="token punctuation">.</span>before <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> before <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>item<span class="token punctuation">.</span>before<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>before<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  before <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>before<span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token punctuation">}</span>\n <span class="token keyword">let</span> stage <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> item<span class="token punctuation">.</span>stage <span class="token operator">===</span> <span class="token string">"number"</span><span class="token punctuation">)</span> stage <span class="token operator">=</span> item<span class="token punctuation">.</span>stage<span class="token punctuation">;</span>\n <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>taps<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  i<span class="token operator">--</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>taps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>taps<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> xStage <span class="token operator">=</span> x<span class="token punctuation">.</span>stage <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>before<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>before<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    before<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">continue</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>before<span class="token punctuation">.</span>size <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">continue</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>xStage <span class="token operator">></span> stage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">continue</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  i<span class="token operator">++</span><span class="token punctuation">;</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n <span class="token punctuation">}</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>taps<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>_insert 主要是排序 tap 并放入到 taps 数组里面，排序的算法并不是特别复杂，这里就不赘述了，到了这里注册阶段就已经结束了，继续看触发阶段。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87035847371896000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`hook.call(1, 2); // 触发函数`, `87035847371896000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">hook</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发函数</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在基类 hook 中有一个初始化过程</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34086650617557045000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`this.call = this._call;\n\nObject.defineProperties(Hook.prototype, {\n  _call: {\n    value: createCompileDelegate(\'call\', \'sync\'),\n    configurable: true,\n    writable: true\n  },\n  _promise: {\n    value: createCompileDelegate(\'promise\', \'promise\'),\n    configurable: true,\n    writable: true\n  },\n  _callAsync: {\n    value: createCompileDelegate(\'callAsync\', \'async\'),\n    configurable: true,\n    writable: true\n  }\n});`, `34086650617557045000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>call <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_call<span class="token punctuation">;</span>\n\nObject<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span><span class="token class-name">Hook</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  _call<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    value<span class="token punctuation">:</span> <span class="token function">createCompileDelegate</span><span class="token punctuation">(</span><span class="token string">\'call\'</span><span class="token punctuation">,</span> <span class="token string">\'sync\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    writable<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  _promise<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    value<span class="token punctuation">:</span> <span class="token function">createCompileDelegate</span><span class="token punctuation">(</span><span class="token string">\'promise\'</span><span class="token punctuation">,</span> <span class="token string">\'promise\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    writable<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  _callAsync<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    value<span class="token punctuation">:</span> <span class="token function">createCompileDelegate</span><span class="token punctuation">(</span><span class="token string">\'callAsync\'</span><span class="token punctuation">,</span> <span class="token string">\'async\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    writable<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以看出 _call 是由 createCompileDelegate 生成的，往下看</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59022207257446230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createCompileDelegate(name, type) {\n  return function lazyCompileHook(...args) {\n    this[name] = this._createCall(type);\n    return this[name](...args);\n  };\n}`, `59022207257446230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createCompileDelegate</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">lazyCompileHook</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_createCall</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>createCompileDelegate 返回一个名为 lazyCompileHook 的函数，顾名思义即懒编译，直到调用 call 的时候，才会编译出正在的 call 函数。</p>\n<p>createCompileDelegate 也是调用的 _createCall， 而 _createCall 调用了 Compier 函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71423251084688590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`_createCall(type) {\n return this.compile({\n  taps: this.taps,\n  interceptors: this.interceptors,\n  args: this._args,\n  type: type\n });\n}\ncompile(options) {\n throw new Error(&quot;Abstract: should be overriden&quot;);\n}`, `71423251084688590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">_createCall</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  taps<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>taps<span class="token punctuation">,</span>\n  interceptors<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptors<span class="token punctuation">,</span>\n  args<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_args<span class="token punctuation">,</span>\n  type<span class="token punctuation">:</span> type\n <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Abstract: should be overriden"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到 compiler 必须由子类重写，返回到 syncHook 的 compile 函数，即我们一开始说的核心方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80149458811497710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class SyncHookCodeFactory extends HookCodeFactory {\n  content({ onError, onResult, onDone, rethrowIfPossible }) {\n    return this.callTapsSeries({\n      onError: (i, err) => onError(err),\n      onDone,\n      rethrowIfPossible\n    });\n  }\n}\n\nconst factory = new SyncHookCodeFactory();\n\nclass SyncHook extends Hook {\n  compile(options) {\n    factory.setup(this, options);\n    return factory.create(options);\n  }\n}`, `80149458811497710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">SyncHookCodeFactory</span> <span class="token keyword">extends</span> <span class="token class-name">HookCodeFactory</span> <span class="token punctuation">{</span>\n  <span class="token function">content</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> onError<span class="token punctuation">,</span> onResult<span class="token punctuation">,</span> onDone<span class="token punctuation">,</span> rethrowIfPossible <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callTapsSeries</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token function-variable function">onError</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      onDone<span class="token punctuation">,</span>\n      rethrowIfPossible\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHookCodeFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">SyncHook</span> <span class="token keyword">extends</span> <span class="token class-name">Hook</span> <span class="token punctuation">{</span>\n  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    factory<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> factory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>关键就在于 SyncHookCodeFactory 和工厂类 HookCodeFactory，先看 setup 函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84731945367476390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`setup(instance, options) {\n  // 这里的 instance 是 syncHook 实例, 其实就是把 tap 进来的钩子数组给到钩子的 _x 属性里.\n  instance._x = options.taps.map(t => t.fn);\n}`, `84731945367476390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 这里的 instance 是 syncHook 实例, 其实就是把 tap 进来的钩子数组给到钩子的 _x 属性里.</span>\n  instance<span class="token punctuation">.</span>_x <span class="token operator">=</span> options<span class="token punctuation">.</span>taps<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">t</span> <span class="token operator">=></span> t<span class="token punctuation">.</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后是最关键的 create 函数， 可以看到最后返回的 fn，其实是一个 new Function 动态生成的函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7976043717689030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`create(options) {\n  // 初始化参数，保存 options 到本对象 this.options，保存 new Hook([&quot;options&quot;]) 传入的参数到 this._args\n  this.init(options);\n  let fn;\n  // 动态构建钩子，这里是抽象层，分同步、异步、promise\n  switch (this.options.type) {\n    // 先看同步\n    case &quot;sync&quot;:\n      // 动态返回一个钩子函数\n      fn = new Function(\n        // 生成函数的参数 no before no after 返回参数字符串 xxx,xxx 在\n        // 注意这里 this.args 返回的是一个字符串,\n        // 在这个例子中是 options\n        this.args(),\n        \'&quot;use strict&quot;;\\n\' +\n          this.header() +\n          this.content({\n            onError: err => \\`throw \\${err};\\n\\`,\n            onResult: result => \\`return \\${result};\\n\\`,\n            onDone: () => &quot;&quot;,\n            rethrowIfPossible: true\n          })\n      );\n      break;\n    case &quot;async&quot;:\n      fn = new Function(\n        this.args({\n          after: &quot;_callback&quot;\n        }),\n        \'&quot;use strict&quot;;\\n\' +\n          this.header() +\n          // 这个 content 调用的是子类类的 content 函数,\n          // 参数由子类传,实际返回的是 this.callTapsSeries() 返回的类容\n          this.content({\n            onError: err => \\`_callback(\\${err});\\n\\`,\n            onResult: result => \\`_callback(null, \\${result});\\n\\`,\n            onDone: () => &quot;_callback();\\n&quot;\n          })\n      );\n      break;\n    case &quot;promise&quot;:\n      let code = &quot;&quot;;\n      code += \'&quot;use strict&quot;;\\n\';\n      code += &quot;return new Promise((_resolve, _reject) => {\\n&quot;;\n      code += &quot;var _sync = true;\\n&quot;;\n      code += this.header();\n      code += this.content({\n        onError: err => {\n          let code = &quot;&quot;;\n          code += &quot;if(_sync)\\n&quot;;\n          code += \\`_resolve(Promise.resolve().then(() => { throw \\${err}; }));\\n\\`;\n          code += &quot;else\\n&quot;;\n          code += \\`_reject(\\${err});\\n\\`;\n          return code;\n        },\n        onResult: result => \\`_resolve(\\${result});\\n\\`,\n        onDone: () => &quot;_resolve();\\n&quot;\n      });\n      code += &quot;_sync = false;\\n&quot;;\n      code += &quot;});\\n&quot;;\n      fn = new Function(this.args(), code);\n      break;\n  }\n  // 把刚才 init 赋的值初始化为 undefined\n  // this.options = undefined;\n  // this._args = undefined;\n  this.deinit();\n\n  return fn;\n}`, `7976043717689030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 初始化参数，保存 options 到本对象 this.options，保存 new Hook(["options"]) 传入的参数到 this._args</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> fn<span class="token punctuation">;</span>\n  <span class="token comment">// 动态构建钩子，这里是抽象层，分同步、异步、promise</span>\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 先看同步</span>\n    <span class="token keyword">case</span> <span class="token string">"sync"</span><span class="token punctuation">:</span>\n      <span class="token comment">// 动态返回一个钩子函数</span>\n      fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>\n        <span class="token comment">// 生成函数的参数 no before no after 返回参数字符串 xxx,xxx 在</span>\n        <span class="token comment">// 注意这里 this.args 返回的是一个字符串,</span>\n        <span class="token comment">// 在这个例子中是 options</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">\'"use strict";\\n\'</span> <span class="token operator">+</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            <span class="token function-variable function">onError</span><span class="token punctuation">:</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">throw </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n            <span class="token function-variable function">onResult</span><span class="token punctuation">:</span> <span class="token parameter">result</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n            <span class="token function-variable function">onDone</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">""</span><span class="token punctuation">,</span>\n            rethrowIfPossible<span class="token punctuation">:</span> <span class="token boolean">true</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> <span class="token string">"async"</span><span class="token punctuation">:</span>\n      fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          after<span class="token punctuation">:</span> <span class="token string">"_callback"</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">\'"use strict";\\n\'</span> <span class="token operator">+</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>\n          <span class="token comment">// 这个 content 调用的是子类类的 content 函数,</span>\n          <span class="token comment">// 参数由子类传,实际返回的是 this.callTapsSeries() 返回的类容</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            <span class="token function-variable function">onError</span><span class="token punctuation">:</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_callback(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);\\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n            <span class="token function-variable function">onResult</span><span class="token punctuation">:</span> <span class="token parameter">result</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_callback(null, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);\\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n            <span class="token function-variable function">onDone</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"_callback();\\n"</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> <span class="token string">"promise"</span><span class="token punctuation">:</span>\n      <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>\n      code <span class="token operator">+=</span> <span class="token string">\'"use strict";\\n\'</span><span class="token punctuation">;</span>\n      code <span class="token operator">+=</span> <span class="token string">"return new Promise((_resolve, _reject) => {\\n"</span><span class="token punctuation">;</span>\n      code <span class="token operator">+=</span> <span class="token string">"var _sync = true;\\n"</span><span class="token punctuation">;</span>\n      code <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      code <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        <span class="token function-variable function">onError</span><span class="token punctuation">:</span> <span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>\n          code <span class="token operator">+=</span> <span class="token string">"if(_sync)\\n"</span><span class="token punctuation">;</span>\n          code <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_resolve(Promise.resolve().then(() => { throw </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">; }));\\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n          code <span class="token operator">+=</span> <span class="token string">"else\\n"</span><span class="token punctuation">;</span>\n          code <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_reject(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>err<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);\\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> code<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function-variable function">onResult</span><span class="token punctuation">:</span> <span class="token parameter">result</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_resolve(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>result<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);\\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n        <span class="token function-variable function">onDone</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"_resolve();\\n"</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      code <span class="token operator">+=</span> <span class="token string">"_sync = false;\\n"</span><span class="token punctuation">;</span>\n      code <span class="token operator">+=</span> <span class="token string">"});\\n"</span><span class="token punctuation">;</span>\n      fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 把刚才 init 赋的值初始化为 undefined</span>\n  <span class="token comment">// this.options = undefined;</span>\n  <span class="token comment">// this._args = undefined;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">deinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> fn<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后生成的代码大致如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44058977657292770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;use strict&quot;;\nfunction (options) {\n  var _context;\n  var _x = this._x;\n  var _taps = this.taps;\n  var _interterceptors = this.interceptors;\n  // 我们只有一个拦截器所以下面的只会生成一个\n  _interceptors[0].call(options);\n\n  var _tap0 = _taps[0];\n  _interceptors[0].tap(_tap0);\n  var _fn0 = _x[0];\n  _fn0(options);\n  var _tap1 = _taps[1];\n  _interceptors[1].tap(_tap1);\n  var _fn1 = _x[1];\n  _fn1(options);\n  var _tap2 = _taps[2];\n  _interceptors[2].tap(_tap2);\n  var _fn2 = _x[2];\n  _fn2(options);\n  var _tap3 = _taps[3];\n  _interceptors[3].tap(_tap3);\n  var _fn3 = _x[3];\n  _fn3(options);\n}`, `44058977657292770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">"use strict"</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> _context<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_x<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _taps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>taps<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _interterceptors <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptors<span class="token punctuation">;</span>\n  <span class="token comment">// 我们只有一个拦截器所以下面的只会生成一个</span>\n  _interceptors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">var</span> _tap0 <span class="token operator">=</span> _taps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  _interceptors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>_tap0<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _fn0 <span class="token operator">=</span> _x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token function">_fn0</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _tap1 <span class="token operator">=</span> _taps<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  _interceptors<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>_tap1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _fn1 <span class="token operator">=</span> _x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token function">_fn1</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _tap2 <span class="token operator">=</span> _taps<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  _interceptors<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>_tap2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _fn2 <span class="token operator">=</span> _x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token function">_fn2</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _tap3 <span class="token operator">=</span> _taps<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  _interceptors<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>_tap3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> _fn3 <span class="token operator">=</span> _x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token function">_fn3</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上就是 Tapabled 的机制，然而本篇的主要对象其实是基于 tapable 实现的 compile 和 compilation 对象。不过由于他们都是基于 tapable，所以介绍的篇幅相对短一点。</p>\n<h2 id="compile"><a href="#compile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compile</h2>\n<h3 id="compile-是什么"><a href="#compile-%E6%98%AF%E4%BB%80%E4%B9%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compile 是什么</h3>\n<p>compiler 对象代表了完整的 webpack 环境配置。这个对象在启动 webpack 时被一次性建立，并配置好所有可操作的设置，包括 options，loader 和 plugin。当在 webpack 环境中应用一个插件时，插件将收到此 compiler 对象的引用。可以使用 compiler 来访问 webpack 的主环境。</p>\n<p>也就是说，compile 是 webpack 的整体环境。</p>\n<h3 id="compile-的内部实现"><a href="#compile-%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compile 的内部实现</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38139640619516850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Compiler extends Tapable {\n  constructor(context) {\n    super();\n    this.hooks = {\n      /** @type {SyncBailHook<Compilation>} */\n      shouldEmit: new SyncBailHook([\'compilation\']),\n      /** @type {AsyncSeriesHook<Stats>} */\n      done: new AsyncSeriesHook([\'stats\']),\n      /** @type {AsyncSeriesHook<>} */\n      additionalPass: new AsyncSeriesHook([])\n      /** @type {AsyncSeriesHook<Compiler>} */\n    };\n  }\n}`, `38139640619516850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token comment">/** @type {SyncBailHook&lt;Compilation>} */</span>\n      shouldEmit<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'compilation\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">/** @type {AsyncSeriesHook&lt;Stats>} */</span>\n      done<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'stats\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">/** @type {AsyncSeriesHook&lt;>} */</span>\n      additionalPass<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n      <span class="token comment">/** @type {AsyncSeriesHook&lt;Compiler>} */</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到 Compier 继承了 Tapable, 并且在实例上绑定了一个 hook 对象，使得 Compier 的实例 compier 可以像这样使用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15922671907004537000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`compiler.hooks.compile.tapAsync(\'afterCompile\', (compilation, callback) => {\n  console.log(\'This is an example plugin!\');\n  console.log(\'Here’s the \\`compilation\\` object which represents a single build of assets:\', compilation);\n\n  // 使用 webpack 提供的 plugin API 操作构建结果\n  compilation.addModule(/* ... */);\n\n  callback();\n});`, `15922671907004537000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compile<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">\'afterCompile\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'This is an example plugin!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Here’s the `compilation` object which represents a single build of assets:\'</span><span class="token punctuation">,</span> compilation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 使用 webpack 提供的 plugin API 操作构建结果</span>\n  compilation<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="compilation"><a href="#compilation" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compilation</h2>\n<h3 id="什么是-compilation"><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-compilation" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>什么是 compilation</h3>\n<p>compilation 对象代表了一次资源版本构建。当运行 webpack 开发环境中间件时，每当检测到一个文件变化，就会创建一个新的 compilation，从而生成一组新的编译资源。一个 compilation 对象表现了当前的模块资源、编译生成资源、变化的文件、以及被跟踪依赖的状态信息。compilation 对象也提供了很多关键时机的回调，以供插件做自定义处理时选择使用。</p>\n<h3 id="compilation-的实现"><a href="#compilation-%E7%9A%84%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compilation 的实现</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10828032552770028000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Compilation extends Tapable {\n  /**\n   * Creates an instance of Compilation.\n   * @param {Compiler} compiler the compiler which created the compilation\n   */\n  constructor(compiler) {\n    super();\n    this.hooks = {\n      /** @type {SyncHook<Module>} */\n      buildModule: new SyncHook([\'module\']),\n      /** @type {SyncHook<Module>} */\n      rebuildModule: new SyncHook([\'module\']),\n      /** @type {SyncHook<Module, Error>} */\n      failedModule: new SyncHook([\'module\', \'error\']),\n      /** @type {SyncHook<Module>} */\n      succeedModule: new SyncHook([\'module\']),\n\n      /** @type {SyncHook<Dependency, string>} */\n      addEntry: new SyncHook([\'entry\', \'name\'])\n      /** @type {SyncHook<Dependency, string, Error>} */\n    };\n  }\n}`, `10828032552770028000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Compilation</span> <span class="token keyword">extends</span> <span class="token class-name">Tapable</span> <span class="token punctuation">{</span>\n  <span class="token comment">/**\n   * Creates an instance of Compilation.\n   * @param {Compiler} compiler the compiler which created the compilation\n   */</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token comment">/** @type {SyncHook&lt;Module>} */</span>\n      buildModule<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'module\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">/** @type {SyncHook&lt;Module>} */</span>\n      rebuildModule<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'module\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">/** @type {SyncHook&lt;Module, Error>} */</span>\n      failedModule<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'module\'</span><span class="token punctuation">,</span> <span class="token string">\'error\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">/** @type {SyncHook&lt;Module>} */</span>\n      succeedModule<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'module\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n      <span class="token comment">/** @type {SyncHook&lt;Dependency, string>} */</span>\n      addEntry<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'entry\'</span><span class="token punctuation">,</span> <span class="token string">\'name\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n      <span class="token comment">/** @type {SyncHook&lt;Dependency, string, Error>} */</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>具体参考上面提到的 compiler 实现。</p>\n<h2 id="编写一个插件"><a href="#%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编写一个插件</h2>\n<p>了解到 tapable\\compiler\\compilation 之后， 再来看插件的实现就不再一头雾水了</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19152638355826920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyExampleWebpackPlugin {\n  // 定义 \\`apply\\` 方法\n  apply(compiler) {\n    // 指定要追加的事件钩子函数\n    compiler.hooks.compile.tapAsync(\'afterCompile\', (compilation, callback) => {\n      console.log(\'This is an example plugin!\');\n      console.log(\'Here’s the \\`compilation\\` object which represents a single build of assets:\', compilation);\n\n      // 使用 webpack 提供的 plugin API 操作构建结果\n      compilation.addModule(/* ... */);\n\n      callback();\n    });\n  }\n}`, `19152638355826920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">MyExampleWebpackPlugin</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 定义 `apply` 方法</span>\n  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 指定要追加的事件钩子函数</span>\n    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compile<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">\'afterCompile\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'This is an example plugin!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Here’s the `compilation` object which represents a single build of assets:\'</span><span class="token punctuation">,</span> compilation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 使用 webpack 提供的 plugin API 操作构建结果</span>\n      compilation<span class="token punctuation">.</span><span class="token function">addModule</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到其实就是在 apply 中传入一个 Compiler 实例，然后基于该实例注册事件，compilation 同理，最后 webpack 会在各流程执行 call 方法。</p>\n<h2 id="compiler-和-compilation-一些比较重要的事件钩子"><a href="#compiler-%E5%92%8C-compilation-%E4%B8%80%E4%BA%9B%E6%AF%94%E8%BE%83%E9%87%8D%E8%A6%81%E7%9A%84%E4%BA%8B%E4%BB%B6%E9%92%A9%E5%AD%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compiler 和 compilation 一些比较重要的事件钩子</h2>\n<h3 id="compier"><a href="#compier" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compier</h3>\n<table>\n<thead>\n<tr>\n<th align="left">事件钩子</th>\n<th align="left">触发时机</th>\n<th align="left">参数</th>\n<th align="left">类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">entry-option</td>\n<td align="left">初始化 option</td>\n<td align="left">-</td>\n<td align="left">SyncBailHook</td>\n</tr>\n<tr>\n<td align="left">run</td>\n<td align="left">开始编译</td>\n<td align="left">compiler</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n<tr>\n<td align="left">compile</td>\n<td align="left">真正开始的编译，在创建 compilation 对象之前</td>\n<td align="left">compilation</td>\n<td align="left">SyncHook</td>\n</tr>\n<tr>\n<td align="left">compilation</td>\n<td align="left">生成好了 compilation 对象，可以操作这个对象啦</td>\n<td align="left">compilation</td>\n<td align="left">SyncHook</td>\n</tr>\n<tr>\n<td align="left">make</td>\n<td align="left">从 entry 开始递归分析依赖，准备对每个模块进行 build</td>\n<td align="left">compilation</td>\n<td align="left">AsyncParallelHook</td>\n</tr>\n<tr>\n<td align="left">after-compile</td>\n<td align="left">编译 build 过程结束</td>\n<td align="left">compilation</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n<tr>\n<td align="left">emit</td>\n<td align="left">在将内存中 assets 内容写到磁盘文件夹之前</td>\n<td align="left">compilation</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n<tr>\n<td align="left">after-emit</td>\n<td align="left">在将内存中 assets 内容写到磁盘文件夹之后</td>\n<td align="left">compilation</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n<tr>\n<td align="left">done</td>\n<td align="left">完成所有的编译过程</td>\n<td align="left">stats</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n<tr>\n<td align="left">failed</td>\n<td align="left">编译失败的时候</td>\n<td align="left">error</td>\n<td align="left">SyncHook</td>\n</tr>\n</tbody>\n</table>\n<h3 id="compilation-1"><a href="#compilation-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compilation</h3>\n<table>\n<thead>\n<tr>\n<th align="left">事件钩子</th>\n<th align="left">触发时机</th>\n<th align="left">参数</th>\n<th align="left">类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">normal-module-loader</td>\n<td align="left">普通模块 loader，真正（一个接一个地）加载模块图(graph)中所有模块的函数。</td>\n<td align="left">loaderContext module</td>\n<td align="left">SyncHook</td>\n</tr>\n<tr>\n<td align="left">seal</td>\n<td align="left">编译(compilation)停止接收新模块时触发。</td>\n<td align="left">-</td>\n<td align="left">SyncHook</td>\n</tr>\n<tr>\n<td align="left">optimize</td>\n<td align="left">优化阶段开始时触发。</td>\n<td align="left">-</td>\n<td align="left">SyncHook</td>\n</tr>\n<tr>\n<td align="left">optimize-modules</td>\n<td align="left">模块的优化</td>\n<td align="left">modules</td>\n<td align="left">SyncBailHook</td>\n</tr>\n<tr>\n<td align="left">optimize-chunks</td>\n<td align="left">优化 chunk</td>\n<td align="left">chunks</td>\n<td align="left">SyncBailHook</td>\n</tr>\n<tr>\n<td align="left">additional-assets</td>\n<td align="left">为编译(compilation)创建附加资源(asset)。</td>\n<td align="left">-</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n<tr>\n<td align="left">optimize-chunk-assets</td>\n<td align="left">优化所有 chunk 资源(asset)。</td>\n<td align="left">chunks</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n<tr>\n<td align="left">optimize-assets</td>\n<td align="left">优化存储在 compilation.assets 中的所有资源(asset)</td>\n<td align="left">assets</td>\n<td align="left">AsyncSeriesHook</td>\n</tr>\n</tbody>\n</table>\n<h1 id="流程"><a href="#%E6%B5%81%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>流程</h1>\n<h2 id="调试"><a href="#%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调试</h2>\n<ol>\n<li>\n<p>使用以下命令运行项目，./scripts/build.js 是你想要开始调试的地方</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73459221508001480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`node --inspect-brk ./scripts/build.js --inline --progress`, `73459221508001480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">node --inspect-brk ./scripts/build.js --inline --progress</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p>打开 chrome://inspect/#devices 即可调试</p>\n</li>\n</ol>\n<h2 id="流程图"><a href="#%E6%B5%81%E7%A8%8B%E5%9B%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>流程图</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-11-37-01-4b67a83026d69459b48355b62550d276-fa1ac.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 110.37567084078712%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABlElEQVQ4y42U246CQBBE+f+fI74Q9GEFgyIXEbwBArJHenccBxa3EggzdE1XdTdYvYaHBrXU3/bvsNhK0zRJksvlcjqdgiCIoqgoCu5xHDdNo5jn81ktf8hcVVWVZdl1XV3X1+uV5/v9Xg5gU5HzPCfAJCtwMBH9FCC3bTshGw4veOBgyO0AISDh8Y43Mpoxg2dMhmF4PB5ZIl7IKO//hkVa8UzOw+EArRogrznr6xfr9drzPN/3KbDpGal6PUThfr9fLBa2bbuu6zgOZFpQ5MWLTEnJf7vd6BZHqAoDerZcLlerFS3EFOrYIexFRjNHbjab7Xa72+1U/s+eJTMJKSxWkaCXdFxtvebWfJN1C9OZBTjJssyIxmE8AMO0k3bgC3di21L2JAKdOpnjqAUcpoA7S5kIvgJTtmwZA/tBtgyjzKYslXhmRoo//h6fZEKJYGjQjDDE44eeCx+R7E8yn2SCCGWe0wEolwkVgnyec7IlDg6TPP6B/KtVMp7zjZ0mw0EwXZ0RafzqzFbJMH4kUxFkEv8NGZsHmVmE/M0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 11 37 01" title="" data-src="/static/2021-09-02-11-37-01-4b67a83026d69459b48355b62550d276-fee1c.png" data-srcset="/static/2021-09-02-11-37-01-4b67a83026d69459b48355b62550d276-a67b7.png 200w,\n/static/2021-09-02-11-37-01-4b67a83026d69459b48355b62550d276-0b187.png 400w,\n/static/2021-09-02-11-37-01-4b67a83026d69459b48355b62550d276-fee1c.png 800w,\n/static/2021-09-02-11-37-01-4b67a83026d69459b48355b62550d276-fa1ac.png 1118w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="入口"><a href="#%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>入口</h2>\n<p>入口处在 bulid.js，可以看到其中的代码是先实例化 webpack，然后调用 compiler 的 run 方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90455189096026570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function build(previousFileSizes) {\n  let compiler = webpack(config);\n  return new Promise((resolve, reject) => {\n    compiler.run((err, stats) => {\n      // ...\n    });\n  });\n}`, `90455189096026570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">previousFileSizes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="entry-option（compiler）"><a href="#entry-option%EF%BC%88compiler%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>entry-option（compiler）</h2>\n<h3 id="webpackjs"><a href="#webpackjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.js</h3>\n<p>webpack 在 node_moduls 下面的 <code class="language-text">\\webpack\\lib\\webpack.js</code>（在此前面有入口参数合并），找到该文件可以看到相关的代码如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96521034391571960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const webpack = (options, callback) => {\n  let compiler;\n  // 处理多个入口\n  if (Array.isArray(options)) {\n    compiler = new MultiCompiler(options.map((options) => webpack(options)));\n  } else if (typeof options === \'object\') {\n    // webpack 的默认参数\n    options = new WebpackOptionsDefaulter().process(options);\n    console.log(options); // 见下图\n    // 实例化 compiler\n    compiler = new Compiler(options.context);\n    compiler.options = options;\n    // 对 webpack 的运行环境处理\n    new NodeEnvironmentPlugin().apply(compiler);\n    // 根据上篇的 tabpable 可知，这里是为了注册插件\n    if (options.plugins && Array.isArray(options.plugins)) {\n      for (const plugin of options.plugins) {\n        plugin.apply(compiler);\n      }\n    }\n    // 触发两个事件点 environment/afterEnviroment\n    compiler.hooks.environment.call();\n    compiler.hooks.afterEnvironment.call();\n    // 设置 compiler 的属性并调用默认配置的插件，同时触发事件点 entry-option\n    compiler.options = new WebpackOptionsApply().process(options, compiler);\n  } else {\n    throw new Error(\'Invalid argument: options\');\n  }\n  if (callback) {\n    compiler.run(callback);\n  }\n  return compiler;\n};`, `96521034391571960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">webpack</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> compiler<span class="token punctuation">;</span>\n  <span class="token comment">// 处理多个入口</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiCompiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">webpack</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">\'object\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// webpack 的默认参数</span>\n    options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsDefaulter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 见下图</span>\n    <span class="token comment">// 实例化 compiler</span>\n    compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> options<span class="token punctuation">;</span>\n    <span class="token comment">// 对 webpack 的运行环境处理</span>\n    <span class="token keyword">new</span> <span class="token class-name">NodeEnvironmentPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 根据上篇的 tabpable 可知，这里是为了注册插件</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// 触发两个事件点 environment/afterEnviroment</span>\n    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 设置 compiler 的属性并调用默认配置的插件，同时触发事件点 entry-option</span>\n    compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Invalid argument: options\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> compiler<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-13-36-05-25c9b47ad4d9a98b1697769e0be81428-a368f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 17.228739002932553%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAh0lEQVQI112OwQ6DIBBE+f8fNApaq9FELagsrl1ZoNRbO3mHmTlMRsAKsLxOAEQkRO8vz3yx9xzSn0KMv6VwGsw4gdHHvsO2IsD7OOg8w0UxcOSbbPLaMrNzKeXE8ZbYVDsX1VwWRpamrkyjtKy0LO2jtn1n+yd0bca1jWuUHfpvMw5ElC9+AAo2qugJ1ddtAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 13 36 05" title="" data-src="/static/2021-09-02-13-36-05-25c9b47ad4d9a98b1697769e0be81428-fee1c.png" data-srcset="/static/2021-09-02-13-36-05-25c9b47ad4d9a98b1697769e0be81428-a67b7.png 200w,\n/static/2021-09-02-13-36-05-25c9b47ad4d9a98b1697769e0be81428-0b187.png 400w,\n/static/2021-09-02-13-36-05-25c9b47ad4d9a98b1697769e0be81428-fee1c.png 800w,\n/static/2021-09-02-13-36-05-25c9b47ad4d9a98b1697769e0be81428-b1a91.png 1200w,\n/static/2021-09-02-13-36-05-25c9b47ad4d9a98b1697769e0be81428-a368f.png 1364w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>可以看出 options 保存的就是本次 webpack 的一些配置参数，而其中的 plugins 属性则是 webpack 中最重要的插件。</p>\n<h3 id="new-webpackoptionsapplyprocess"><a href="#new-webpackoptionsapplyprocess" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>new WebpackOptionsApply().process</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53192180877429900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function process(options, compiler) {\n  let ExternalsPlugin;\n  compiler.outputPath = options.output.path;\n  compiler.recordsInputPath = options.recordsInputPath || options.recordsPath;\n  compiler.recordsOutputPath = options.recordsOutputPath || options.recordsPath;\n  compiler.name = options.name;\n  compiler.dependencies = options.dependencies;\n  if (typeof options.target === \'string\') {\n    let JsonpTemplatePlugin;\n    let FetchCompileWasmTemplatePlugin;\n    let ReadFileCompileWasmTemplatePlugin;\n    let NodeSourcePlugin;\n    let NodeTargetPlugin;\n    let NodeTemplatePlugin;\n\n    switch (options.target) {\n      case \'web\':\n        JsonpTemplatePlugin = require(\'./web/JsonpTemplatePlugin\');\n        FetchCompileWasmTemplatePlugin = require(\'./web/FetchCompileWasmTemplatePlugin\');\n        NodeSourcePlugin = require(\'./node/NodeSourcePlugin\');\n        new JsonpTemplatePlugin().apply(compiler);\n        new FetchCompileWasmTemplatePlugin({\n          mangleImports: options.optimization.mangleWasmImports\n        }).apply(compiler);\n        new FunctionModulePlugin().apply(compiler);\n        new NodeSourcePlugin(options.node).apply(compiler);\n        new LoaderTargetPlugin(options.target).apply(compiler);\n        break;\n      case \'webworker\':\n        // ...\n        break;\n    }\n    // ...\n  }\n  new JavascriptModulesPlugin().apply(compiler);\n  new JsonModulesPlugin().apply(compiler);\n  new WebAssemblyModulesPlugin({\n    mangleImports: options.optimization.mangleWasmImports\n  }).apply(compiler);\n\n  new EntryOptionPlugin().apply(compiler);\n  // 触发事件点 entry-options 并传入参数 context 和 entry\n  compiler.hooks.entryOption.call(options.context, options.entry);\n  new CompatibilityPlugin().apply(compiler);\n  // ...\n  new ImportPlugin(options.module).apply(compiler);\n  new SystemPlugin(options.module).apply(compiler);\n}`, `53192180877429900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> ExternalsPlugin<span class="token punctuation">;</span>\n  compiler<span class="token punctuation">.</span>outputPath <span class="token operator">=</span> options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>path<span class="token punctuation">;</span>\n  compiler<span class="token punctuation">.</span>recordsInputPath <span class="token operator">=</span> options<span class="token punctuation">.</span>recordsInputPath <span class="token operator">||</span> options<span class="token punctuation">.</span>recordsPath<span class="token punctuation">;</span>\n  compiler<span class="token punctuation">.</span>recordsOutputPath <span class="token operator">=</span> options<span class="token punctuation">.</span>recordsOutputPath <span class="token operator">||</span> options<span class="token punctuation">.</span>recordsPath<span class="token punctuation">;</span>\n  compiler<span class="token punctuation">.</span>name <span class="token operator">=</span> options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n  compiler<span class="token punctuation">.</span>dependencies <span class="token operator">=</span> options<span class="token punctuation">.</span>dependencies<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options<span class="token punctuation">.</span>target <span class="token operator">===</span> <span class="token string">\'string\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> JsonpTemplatePlugin<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> FetchCompileWasmTemplatePlugin<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ReadFileCompileWasmTemplatePlugin<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> NodeSourcePlugin<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> NodeTargetPlugin<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> NodeTemplatePlugin<span class="token punctuation">;</span>\n\n    <span class="token keyword">switch</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">case</span> <span class="token string">\'web\'</span><span class="token punctuation">:</span>\n        JsonpTemplatePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./web/JsonpTemplatePlugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        FetchCompileWasmTemplatePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./web/FetchCompileWasmTemplatePlugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        NodeSourcePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./node/NodeSourcePlugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">new</span> <span class="token class-name">JsonpTemplatePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">new</span> <span class="token class-name">FetchCompileWasmTemplatePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          mangleImports<span class="token punctuation">:</span> options<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>mangleWasmImports\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">new</span> <span class="token class-name">FunctionModulePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">new</span> <span class="token class-name">NodeSourcePlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">new</span> <span class="token class-name">LoaderTargetPlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">break</span><span class="token punctuation">;</span>\n      <span class="token keyword">case</span> <span class="token string">\'webworker\'</span><span class="token punctuation">:</span>\n        <span class="token comment">// ...</span>\n        <span class="token keyword">break</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">new</span> <span class="token class-name">JavascriptModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">new</span> <span class="token class-name">JsonModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">new</span> <span class="token class-name">WebAssemblyModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    mangleImports<span class="token punctuation">:</span> options<span class="token punctuation">.</span>optimization<span class="token punctuation">.</span>mangleWasmImports\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">new</span> <span class="token class-name">EntryOptionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发事件点 entry-options 并传入参数 context 和 entry</span>\n  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">entryOption</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">,</span> options<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">new</span> <span class="token class-name">CompatibilityPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n  <span class="token keyword">new</span> <span class="token class-name">ImportPlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>module<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">new</span> <span class="token class-name">SystemPlugin</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>module<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="run（compiler）"><a href="#run%EF%BC%88compiler%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>run（compiler）</h2>\n<p>调用 run 时，会先在内部触发 beforeRun 事件点，然后再在读取 <a href="https://webpack.docschina.org/configuration/other-options/#recordspath" target="_blank" rel="nofollow noreferrer noopener">records</a> 之前触发 run 事件点，这两个事件都是异步的形式，注意 run 方法是实际上整个 webpack 打包流程的入口。可以看到，最后调用的是 compile 方法，同时传入的是 onCompiled 函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26504247840051320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function run(callback) {\n  if (this.running) return callback(new ConcurrentCompilationError());\n  const finalCallback = (err, stats) => {\n    // ......\n  };\n  this.running = true;\n\n  const onCompiled = (err, compilation) => {\n    // ....\n  };\n\n  this.hooks.beforeRun.callAsync(this, (err) => {\n    if (err) return finalCallback(err);\n\n    this.hooks.run.callAsync(this, (err) => {\n      if (err) return finalCallback(err);\n\n      this.readRecords((err) => {\n        if (err) return finalCallback(err);\n\n        this.compile(onCompiled);\n      });\n    });\n  });\n}`, `26504247840051320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>running<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConcurrentCompilationError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">finalCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ......</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">onCompiled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> compilation</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ....</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeRun<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">finalCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">finalCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readRecords</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">finalCallback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>onCompiled<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="compile（compiler）"><a href="#compile%EF%BC%88compiler%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compile（compiler）</h2>\n<p>compile 方法主要上触发 beforeCompile、compile、make 等事件点，并实例化 compilation，这里我们可以看到传给 compile 的 newCompilationParams 参数，这个参数在后面相对流程中也是比较重要，可以在这里先看一下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96007695304568270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function compile(callback) {\n  const params = this.newCompilationParams();\n  // 触发事件点 beforeCompile，并传入参数 CompilationParams\n  this.hooks.beforeCompile.callAsync(params, (err) => {\n    if (err) return callback(err);\n    // 触发事件点 compile，并传入参数 CompilationParams\n    this.hooks.compile.call(params);\n    // 实例化 compilation\n    const compilation = this.newCompilation(params);\n    // 触发事件点 make\n    this.hooks.make.callAsync(compilation, (err) => {\n      // ....\n    });\n  });\n}`, `96007695304568270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilationParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发事件点 beforeCompile，并传入参数 CompilationParams</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeCompile<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 触发事件点 compile，并传入参数 CompilationParams</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 实例化 compilation</span>\n    <span class="token keyword">const</span> compilation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilation</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 触发事件点 make</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// ....</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>newCompilationParams 返回的参数分别是两个工厂函数和一个 Set 集合</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56126464792071710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function newCompilationParams() {\n  const params = {\n    normalModuleFactory: this.createNormalModuleFactory(),\n    contextModuleFactory: this.createContextModuleFactory(),\n    compilationDependencies: new Set()\n  };\n  return params;\n}`, `56126464792071710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">newCompilationParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>\n    normalModuleFactory<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createNormalModuleFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    contextModuleFactory<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createContextModuleFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    compilationDependencies<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> params<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="compilation（compiler）"><a href="#compilation%EF%BC%88compiler%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>compilation（compiler）</h2>\n<p>从上面的 compile 方法看， compilation 是通过 newCompilation 方法调用生成的，然后触发事件点 thisCompilation 和 compilation，可以看出 compilation 在这两个事件点中最早当成参数传入，如果你在编写插件的时候需要尽快使用该对象，则应该在该两个事件中进行。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7655245456807091000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createCompilation() {\n  return new Compilation(this);\n}\nfunction newCompilation(params) {\n  const compilation = this.createCompilation();\n  compilation.fileTimestamps = this.fileTimestamps;\n  compilation.contextTimestamps = this.contextTimestamps;\n  compilation.name = this.name;\n  compilation.records = this.records;\n  compilation.compilationDependencies = params.compilationDependencies;\n  // 触发事件点 thisCompilation 和 compilation， 同时传入参数 compilation 和 params\n  this.hooks.thisCompilation.call(compilation, params);\n  this.hooks.compilation.call(compilation, params);\n  return compilation;\n}`, `7655245456807091000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createCompilation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Compilation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">newCompilation</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> compilation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createCompilation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  compilation<span class="token punctuation">.</span>fileTimestamps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fileTimestamps<span class="token punctuation">;</span>\n  compilation<span class="token punctuation">.</span>contextTimestamps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>contextTimestamps<span class="token punctuation">;</span>\n  compilation<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n  compilation<span class="token punctuation">.</span>records <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>records<span class="token punctuation">;</span>\n  compilation<span class="token punctuation">.</span>compilationDependencies <span class="token operator">=</span> params<span class="token punctuation">.</span>compilationDependencies<span class="token punctuation">;</span>\n  <span class="token comment">// 触发事件点 thisCompilation 和 compilation， 同时传入参数 compilation 和 params</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">thisCompilation</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">compilation</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> compilation<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面是打印出来的 compilation 属性</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-e3184.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.12551079976649%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA/ElEQVQoz4VR0ZKDIAzk/3/xXvpQbZGKSEAFg3QBe+1Mb+Z2djIhJmFZhR0tGRdj3JkTuO8nYzxjTT6R0pErBD2INGE4hlCILejGd6DGXFmQ8/uYEqKwo9NyJufLzajnV+fxAlakgnYtN3UxoijspR9/LnN3pb6zfYfE3nq69f5+Wwe5qGHT425nXpf8BUHS6Ks0D2WUmqTUg3TT5IxZzARu1gZHwbvgPdfHH8wfw5CtDB4KYd+73+KbfubCxM0UGOb0MDlH82wBR+SJ1mWBc818LkBaxn7/BRfPkyBF+q7hcq201nNx/g/CG4/hLWzQwm0WEXs5Vev/5lbxBOytDfSYx3HfAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 13 59 52" title="" data-src="/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-fee1c.png" data-srcset="/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-a67b7.png 200w,\n/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-0b187.png 400w,\n/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-fee1c.png 800w,\n/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-b1a91.png 1200w,\n/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-95179.png 1600w,\n/static/2021-09-02-13-59-52-58f7d2541d648fff9d5585dbbd43bdc5-e3184.png 1713w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>关于这里为什么要有 thisCompilation 这个事件点和子编译器（childCompiler），可以参考该<a href="https://lxzjj.github.io/2017/11/08/%E7%8E%A9%E8%BD%ACwebpack%EF%BC%88%E4%BA%8C%EF%BC%89/" target="_blank" rel="nofollow noreferrer noopener">文章</a></p>\n<p>总结起来就是:</p>\n<p>子编译器拥有完整的模块解析和 chunk 生成阶段,但是少了某些事件点，如”make”, “compile”, “emit”, “after-emit”, “invalid”, “done”, “this-compilation”。 也就是说我们可以利用子编译器来独立（于父编译器）跑完一个核心构建流程，额外生成一些需要的模块或者 chunk。</p>\n<h2 id="make（compiler）"><a href="#make%EF%BC%88compiler%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>make（compiler）</h2>\n<p>从上面的 compile 方法知道， 实例化 Compilation 后就会触发 make 事件点了。触发了 make 时， 因为 webpack 在前面实例化 SingleEntryPlugin 或者 MultleEntryPlugin，SingleEntryPlugin 则在其 apply 方法中注册了一个 make 事件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88643632749615960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function apply(compiler) {\n  compiler.hooks.compilation.tap(\'SingleEntryPlugin\', (compilation, { normalModuleFactory }) => {\n    compilation.dependencyFactories.set(\n      SingleEntryDependency,\n      normalModuleFactory // 工厂函数，存在 compilation 的 dependencyFactories 集合\n    );\n  });\n\n  compiler.hooks.make.tapAsync(\'SingleEntryPlugin\', (compilation, callback) => {\n    const { entry, name, context } = this;\n\n    const dep = SingleEntryPlugin.createDependency(entry, name);\n    // 进入到 addEntry\n    compilation.addEntry(context, dep, name, callback);\n  });\n}`, `88643632749615960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'SingleEntryPlugin\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> <span class="token punctuation">{</span> normalModuleFactory <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    compilation<span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>\n      SingleEntryDependency<span class="token punctuation">,</span>\n      normalModuleFactory <span class="token comment">// 工厂函数，存在 compilation 的 dependencyFactories 集合</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">\'SingleEntryPlugin\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> entry<span class="token punctuation">,</span> name<span class="token punctuation">,</span> context <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> dep <span class="token operator">=</span> SingleEntryPlugin<span class="token punctuation">.</span><span class="token function">createDependency</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 进入到 addEntry</span>\n    compilation<span class="token punctuation">.</span><span class="token function">addEntry</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> dep<span class="token punctuation">,</span> name<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>事实上 addEntry 调用的是 <code class="language-text">Comilation._addModuleChain</code>，acquire 函数比较简单，主要是处理 module 时如果任务太多，就将 moduleFactory.create 存入队列等待</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49894509493840710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function _addModuleChain(context, dependency, onModule, callback) {\n  // ......\n  // 取出对应的Factory\n  const Dep = /** @type {DepConstructor} */ (dependency.constructor);\n  const moduleFactory = this.dependencyFactories.get(Dep);\n  // ......\n  this.semaphore.acquire(() => {\n    moduleFactory.create(\n      {\n        contextInfo: {\n          issuer: \'\',\n          compiler: this.compiler.name\n        },\n        context: context,\n        dependencies: [dependency]\n      },\n      (err, module) => {\n        // ......\n      }\n    );\n  });\n}`, `49894509493840710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">_addModuleChain</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> dependency<span class="token punctuation">,</span> onModule<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ......</span>\n  <span class="token comment">// 取出对应的Factory</span>\n  <span class="token keyword">const</span> Dep <span class="token operator">=</span> <span class="token comment">/** @type {DepConstructor} */</span> <span class="token punctuation">(</span>dependency<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> moduleFactory <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>Dep<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ......</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    moduleFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>\n      <span class="token punctuation">{</span>\n        contextInfo<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          issuer<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n          compiler<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>compiler<span class="token punctuation">.</span>name\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>\n        dependencies<span class="token punctuation">:</span> <span class="token punctuation">[</span>dependency<span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token comment">// ......</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>moduleFactory.create 则是收集一系列信息然后创建一个 module 传入回调</p>\n<h2 id="buildmodule（compilation）"><a href="#buildmodule%EF%BC%88compilation%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>buildModule（compilation）</h2>\n<p>回调函数主要上执行 buildModule 方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34181789081483550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`this.buildModule(module, false, null, null, (err) => {\n  // ......\n  afterBuild();\n});`, `34181789081483550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// ......</span>\n  <span class="token function">afterBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58268717018430370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function buildModule(module, optional, origin, dependencies, thisCallback) {\n  // 处理回调函数\n  let callbackList = this._buildingModules.get(module);\n  if (callbackList) {\n    callbackList.push(thisCallback);\n    return;\n  }\n  this._buildingModules.set(module, (callbackList = [thisCallback]));\n\n  const callback = (err) => {\n    this._buildingModules.delete(module);\n    for (const cb of callbackList) {\n      cb(err);\n    }\n  };\n  // 触发 buildModule 事件点\n  this.hooks.buildModule.call(module);\n  module.build(\n    this.options,\n    this,\n    this.resolverFactory.get(\'normal\', module.resolveOptions),\n    this.inputFileSystem,\n    (error) => {\n      // ......\n    }\n  );\n}`, `58268717018430370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> optional<span class="token punctuation">,</span> origin<span class="token punctuation">,</span> dependencies<span class="token punctuation">,</span> thisCallback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 处理回调函数</span>\n  <span class="token keyword">let</span> callbackList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_buildingModules<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>callbackList<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    callbackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>thisCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>_buildingModules<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> <span class="token punctuation">(</span>callbackList <span class="token operator">=</span> <span class="token punctuation">[</span>thisCallback<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>_buildingModules<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> cb <span class="token keyword">of</span> callbackList<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发 buildModule 事件点</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  module<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span>\n    <span class="token keyword">this</span><span class="token punctuation">,</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>resolverFactory<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'normal\'</span><span class="token punctuation">,</span> module<span class="token punctuation">.</span>resolveOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>inputFileSystem<span class="token punctuation">,</span>\n    <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// ......</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>build 方法中调用的是 doBuild，doBuild 又通过 runLoaders 获取 loader 相关的信息并转换成 webpack 需要的 js 文件，最后通过 doBuild 的回调函数调用 parse 方法，创建依赖 Dependency 并放入依赖数组</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35439576089182310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`return this.doBuild(options, compilation, resolver, fs, (err) => {\n  // 在 createLoaderContext 函数中触发事件 normal-module-loader\n  const loaderContext = this.createLoaderContext(resolver, options, compilation, fs);\n  // .....\n  const handleParseResult = (result) => {\n    this._lastSuccessfulBuildMeta = this.buildMeta;\n    this._initBuildHash(compilation);\n    return callback();\n  };\n\n  try {\n    // 调用 parser.parse\n    const result = this.parser.parse(\n      this._ast || this._source.source(),\n      {\n        current: this,\n        module: this,\n        compilation: compilation,\n        options: options\n      },\n      (err, result) => {\n        if (err) {\n          handleParseError(err);\n        } else {\n          handleParseResult(result);\n        }\n      }\n    );\n    if (result !== undefined) {\n      // parse is sync\n      handleParseResult(result);\n    }\n  } catch (e) {\n    handleParseError(e);\n  }\n});`, `35439576089182310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doBuild</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> resolver<span class="token punctuation">,</span> fs<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// 在 createLoaderContext 函数中触发事件 normal-module-loader</span>\n  <span class="token keyword">const</span> loaderContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createLoaderContext</span><span class="token punctuation">(</span>resolver<span class="token punctuation">,</span> options<span class="token punctuation">,</span> compilation<span class="token punctuation">,</span> fs<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// .....</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">handleParseResult</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>_lastSuccessfulBuildMeta <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>buildMeta<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_initBuildHash</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 调用 parser.parse</span>\n    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>_ast <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_source<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        current<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>\n        module<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>\n        compilation<span class="token punctuation">:</span> compilation<span class="token punctuation">,</span>\n        options<span class="token punctuation">:</span> options\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">handleParseError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          <span class="token function">handleParseResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// parse is sync</span>\n      <span class="token function">handleParseResult</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">handleParseError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 ast 转换过程中也很容易得到了需要依赖的哪些其他模块。</p>\n<h2 id="succeedmodule（compilation）"><a href="#succeedmodule%EF%BC%88compilation%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>succeedModule（compilation）</h2>\n<p>最后执行了 module.build 的回调函数，触发了事件点 succeedModule，并回到 Compilation.buildModule 函数的回调函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44013989906752980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.build(\n  this.options,\n  this,\n  this.resolverFactory.get(\'normal\', module.resolveOptions),\n  this.inputFileSystem,\n  (error) => {\n    // ......\n    触发了事件点succeedModule;\n    this.hooks.succeedModule.call(module);\n    return callback();\n  }\n);\n\nthis.buildModule(module, false, null, null, (err) => {\n  // ......\n  // 执行afterBuild\n  afterBuild();\n});`, `44013989906752980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span>\n  <span class="token keyword">this</span><span class="token punctuation">,</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>resolverFactory<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'normal\'</span><span class="token punctuation">,</span> module<span class="token punctuation">.</span>resolveOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>inputFileSystem<span class="token punctuation">,</span>\n  <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ......</span>\n    触发了事件点succeedModule<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">succeedModule</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// ......</span>\n  <span class="token comment">// 执行afterBuild</span>\n  <span class="token function">afterBuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于当前模块，或许存在着多个依赖模块。当前模块会开辟一个依赖模块的数组，在遍历 AST 时，将 require() 中的模块通过 addDependency() 添加到数组中。当前模块构建完成后，webpack 调用 processModuleDependencies 开始递归处理依赖的 module，接着就会重复之前的构建步骤。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96366248988751740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Compilation.prototype.addModuleDependencies = function(module, dependencies, bail, cacheGroup, recursive, callback) {\n  // 根据依赖数组(dependencies)创建依赖模块对象\n  var factories = [];\n  for (var i = 0; i < dependencies.length; i++) {\n    var factory = _this.dependencyFactories.get(dependencies[i][0].constructor);\n    factories[i] = [factory, dependencies[i]];\n  }\n  // ...\n  // 与当前模块构建步骤相同\n};`, `96366248988751740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token class-name">Compilation</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addModuleDependencies</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> dependencies<span class="token punctuation">,</span> bail<span class="token punctuation">,</span> cacheGroup<span class="token punctuation">,</span> recursive<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 根据依赖数组(dependencies)创建依赖模块对象</span>\n  <span class="token keyword">var</span> factories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dependencies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> factory <span class="token operator">=</span> _this<span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    factories<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>factory<span class="token punctuation">,</span> dependencies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 与当前模块构建步骤相同</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后，所有的模块都会被放入到 Compilation 的 modules 里面， 如下：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-14-09-58-6a4b9e1046337e17b52c08d4c9f425c5-115a3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.590511860174782%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAAAkklEQVQY05WPSw7DIAwFuf8dESC+hiagBAEBKa0Fmy66aGZhzcMGGQIAIQTrLDhUsNZ6793kO8IEBYc9+HVOOOdKKsaYUgpdcIFCKZVS8smKq4tjWuvVFUIQYww+mXMeY9Rae+/XdbXWUFb9GVcluMm2vVqr7+cQ/GqAUMqzy/eElKOUo55nxp3v/0gp7fseY/wAnxVWKsneRuQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 14 09 58" title="" data-src="/static/2021-09-02-14-09-58-6a4b9e1046337e17b52c08d4c9f425c5-fee1c.png" data-srcset="/static/2021-09-02-14-09-58-6a4b9e1046337e17b52c08d4c9f425c5-a67b7.png 200w,\n/static/2021-09-02-14-09-58-6a4b9e1046337e17b52c08d4c9f425c5-0b187.png 400w,\n/static/2021-09-02-14-09-58-6a4b9e1046337e17b52c08d4c9f425c5-fee1c.png 800w,\n/static/2021-09-02-14-09-58-6a4b9e1046337e17b52c08d4c9f425c5-115a3.png 801w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-19100.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 45.19230769230769%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAAA70lEQVQoz31Si27DIAzk/39z0ramaSDYYLs8sqOJ2j3anS7SQbDPNjg/hbBEzVLNriKllNZarRVfr3V7DZx0dCEOUVKyGDXSFSm+ASeeCmQnIseezKz13rdtcEc7ANH/APtwZmYXpjWcznldU1jNFLBBGS6qYH0GxIuIC6cwv0+aGERBYL3VNnq+OfQXQLzjheL5UiRX1VZKP0ZVdv3PwEYwzSScMGoYbqPxn7jv/PoF51pdnOPyMWeKRRXZ9qE9iBVaMLsHN9Uish1lez6/fXIIQpTWkINXaO9lWSCMSKdJcYsp4RWgwOI9GlTmzPwFWZAPgovjOkEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 14 10 14" title="" data-src="/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-fee1c.png" data-srcset="/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-a67b7.png 200w,\n/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-0b187.png 400w,\n/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-fee1c.png 800w,\n/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-b1a91.png 1200w,\n/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-95179.png 1600w,\n/static/2021-09-02-14-10-14-118fc84aa9c24820182f01e91d8089e1-19100.png 1872w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>总结一下：</p>\n<p>module 是 webpack 构建的核心实体，也是所有 module 的 父类，它有几种不同子类：NormalModule、MultiModule、ContextModule、DelegatedModule 等，一个依赖对象（Dependency，还未被解析成模块实例的依赖对象。比如我们运行 webpack 时传入的入口模块，或者一个模块依赖的其他模块，都会先生成一个 Dependency 对象。）经过对应的工厂对象（Factory）创建之后，就能够生成对应的模块实例（Module）。</p>\n<h2 id="seal（compilation）"><a href="#seal%EF%BC%88compilation%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>seal（compilation）</h2>\n<p>构建 module 后， 就会调用 Compilation.seal， 该函数主要是触发了事件点 seal， 构建 chunk， 在所有 chunks 生成之后，webpack 会对 chunks 和 modules 进行一些优化相关的操作，比如分配 id、排序等，并且触发一系列相关的事件点</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9678179334550774000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function seal(callback) {\n  // 触发事件点 seal\n  this.hooks.seal.call();\n  // 优化\n  // ......\n  this.hooks.afterOptimizeDependencies.call(this.modules);\n\n  this.hooks.beforeChunks.call();\n  // 生成 chunk\n  for (const preparedEntrypoint of this._preparedEntrypoints) {\n    const module = preparedEntrypoint.module;\n    const name = preparedEntrypoint.name;\n    // 整理每个 Module 和 chunk，每个 chunk 对应一个输出文件。\n    const chunk = this.addChunk(name);\n    const entrypoint = new Entrypoint(name);\n    entrypoint.setRuntimeChunk(chunk);\n    entrypoint.addOrigin(null, name, preparedEntrypoint.request);\n    this.namedChunkGroups.set(name, entrypoint);\n    this.entrypoints.set(name, entrypoint);\n    this.chunkGroups.push(entrypoint);\n\n    GraphHelpers.connectChunkGroupAndChunk(entrypoint, chunk);\n    GraphHelpers.connectChunkAndModule(chunk, module);\n\n    chunk.entryModule = module;\n    chunk.name = name;\n\n    this.assignDepth(module);\n  }\n  this.processDependenciesBlocksForChunkGroups(this.chunkGroups.slice());\n  this.sortModules(this.modules);\n  this.hooks.afterChunks.call(this.chunks);\n\n  this.hooks.optimize.call();\n\n  // ......\n  this.hooks.afterOptimizeModules.call(this.modules);\n\n  // ......\n  this.hooks.afterOptimizeChunks.call(this.chunks, this.chunkGroups);\n\n  this.hooks.optimizeTree.callAsync(this.chunks, this.modules, (err) => {\n    // ......\n    this.hooks.beforeChunkAssets.call();\n    this.createChunkAssets(); // 生成对应的 Assets\n    this.hooks.additionalAssets.callAsync(/* ... */);\n  });\n}`, `9678179334550774000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">seal</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 触发事件点 seal</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 优化</span>\n  <span class="token comment">// ......</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterOptimizeDependencies</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">beforeChunks</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 生成 chunk</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> preparedEntrypoint <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_preparedEntrypoints<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> module <span class="token operator">=</span> preparedEntrypoint<span class="token punctuation">.</span>module<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> name <span class="token operator">=</span> preparedEntrypoint<span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n    <span class="token comment">// 整理每个 Module 和 chunk，每个 chunk 对应一个输出文件。</span>\n    <span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addChunk</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> entrypoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entrypoint</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    entrypoint<span class="token punctuation">.</span><span class="token function">setRuntimeChunk</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    entrypoint<span class="token punctuation">.</span><span class="token function">addOrigin</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> preparedEntrypoint<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>namedChunkGroups<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>entrypoints<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>chunkGroups<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    GraphHelpers<span class="token punctuation">.</span><span class="token function">connectChunkGroupAndChunk</span><span class="token punctuation">(</span>entrypoint<span class="token punctuation">,</span> chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    GraphHelpers<span class="token punctuation">.</span><span class="token function">connectChunkAndModule</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    chunk<span class="token punctuation">.</span>entryModule <span class="token operator">=</span> module<span class="token punctuation">;</span>\n    chunk<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">assignDepth</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processDependenciesBlocksForChunkGroups</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chunkGroups<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sortModules</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterChunks</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">optimize</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// ......</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterOptimizeModules</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// ......</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterOptimizeChunks</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunkGroups<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>optimizeTree<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ......</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">beforeChunkAssets</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createChunkAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成对应的 Assets</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>additionalAssets<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每个 chunk 的生成就是找到需要包含的 modules。这里大致描述一下 chunk 的生成算法：</p>\n<ol>\n<li>webpack 先将 entry 中对应的 module 都生成一个新的 chunk</li>\n<li>遍历 module 的依赖列表，将依赖的 module 也加入到 chunk 中</li>\n<li>如果一个依赖 module 是动态引入的模块，那么就会根据这个 module 创建一个新的 chunk，继续遍历依赖</li>\n<li>重复上面的过程，直至得到所有的 chunks</li>\n</ol>\n<p>chunk 属性图</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-14-13-52-d82d1292b382e4d317d0ef1e4d81b4f5-446cc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.86324786324786%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAy0lEQVQoz51S227DMAj1/39lVa0vjS8Y48QmhJR4irRqVafu4IcjzO0gXJwiZqy1LsvSmVW3X9DxvqluPyJcuEaYsPXGzOu68jPMI9ylNWEW433w1jaRfd9duMUUsHf7Ex1V9ayto4+erfWZH8nZw9r74B/D+YufvgJAtnIfJ+d7RixmtrB2og+YR9+O5CjRUo+gl/ijMwERkmzyH80QIYRQSgFI0x2yiUD03seYEtD+fmyEYtGmc55nKodws0o0H2gvJ7d12FHZFTwAfPFMteYZV7QAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 14 13 52" title="" data-src="/static/2021-09-02-14-13-52-d82d1292b382e4d317d0ef1e4d81b4f5-fee1c.png" data-srcset="/static/2021-09-02-14-13-52-d82d1292b382e4d317d0ef1e4d81b4f5-a67b7.png 200w,\n/static/2021-09-02-14-13-52-d82d1292b382e4d317d0ef1e4d81b4f5-0b187.png 400w,\n/static/2021-09-02-14-13-52-d82d1292b382e4d317d0ef1e4d81b4f5-fee1c.png 800w,\n/static/2021-09-02-14-13-52-d82d1292b382e4d317d0ef1e4d81b4f5-446cc.png 1170w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="beforechunkassets--additionalchunkassets（compilation）"><a href="#beforechunkassets--additionalchunkassets%EF%BC%88compilation%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>beforeChunkAssets &#x26;&#x26; additionalChunkAssets（Compilation）</h2>\n<p>在触发这两个事件点的中间时，会调用 Compilation.createCHunkAssets 来创建 assets</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72737852872826840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createChunkAssets() {\n  // ......\n  // 遍历 chunk\n  for (let i = 0; i < this.chunks.length; i++) {\n    const chunk = this.chunks[i];\n    chunk.files = [];\n    let source;\n    let file;\n    let filenameTemplate;\n    try {\n      // 调用何种 Template\n      const template = chunk.hasRuntime() ? this.mainTemplate : this.chunkTemplate;\n      const manifest = template.getRenderManifest({\n        chunk,\n        hash: this.hash,\n        fullHash: this.fullHash,\n        outputOptions,\n        moduleTemplates: this.moduleTemplates,\n        dependencyTemplates: this.dependencyTemplates\n      }); // [{ render(), filenameTemplate, pathOptions, identifier, hash }]\n      for (const fileManifest of manifest) {\n        // .....\n      }\n      // .....\n      // 写入 assets 对象\n      this.assets[file] = source;\n      chunk.files.push(file);\n      this.hooks.chunkAsset.call(chunk, file);\n      alreadyWrittenFiles.set(file, {\n        hash: usedHash,\n        source,\n        chunk\n      });\n    } catch (err) {\n      // ......\n    }\n  }\n}`, `72737852872826840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createChunkAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ......</span>\n  <span class="token comment">// 遍历 chunk</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> chunk <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    chunk<span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> source<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> file<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> filenameTemplate<span class="token punctuation">;</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 调用何种 Template</span>\n      <span class="token keyword">const</span> template <span class="token operator">=</span> chunk<span class="token punctuation">.</span><span class="token function">hasRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainTemplate <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunkTemplate<span class="token punctuation">;</span>\n      <span class="token keyword">const</span> manifest <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">getRenderManifest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        chunk<span class="token punctuation">,</span>\n        hash<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hash<span class="token punctuation">,</span>\n        fullHash<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fullHash<span class="token punctuation">,</span>\n        outputOptions<span class="token punctuation">,</span>\n        moduleTemplates<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>moduleTemplates<span class="token punctuation">,</span>\n        dependencyTemplates<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dependencyTemplates\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [{ render(), filenameTemplate, pathOptions, identifier, hash }]</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> fileManifest <span class="token keyword">of</span> manifest<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// .....</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// .....</span>\n      <span class="token comment">// 写入 assets 对象</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">[</span>file<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">;</span>\n      chunk<span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">chunkAsset</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      alreadyWrittenFiles<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n        hash<span class="token punctuation">:</span> usedHash<span class="token punctuation">,</span>\n        source<span class="token punctuation">,</span>\n        chunk\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ......</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>createChunkAssets 会生成文件名和对应的文件内容，并放入 Compilation.assets 对象， 这里有四个 Template 的子类，分别是 MainTemplate.js、ChunkTemplate.js、ModuleTemplate.js、HotUpdateChunkTemplate.js</p>\n<ul>\n<li>MainTemplate.js: 对应了在 entry 配置的入口 chunk 的渲染模板</li>\n<li>ChunkTemplate: 动态引入的非入口 chunk 的渲染模板</li>\n<li>ModuleTemplate.js: chunk 中的 module 的渲染模板</li>\n<li>HotUpdateChunkTemplate.js: 对热替换模块的一个处理。</li>\n</ul>\n<p>模块在封装的时候和它在构建时一样，都是调用各模块类中的方法。封装通过调用 module.source() 来进行各操作，比如说 require() 的替换。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62064624406739900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`MainTemplate.prototype.requireFn = \'__webpack_require__\';\nMainTemplate.prototype.render = function(hash, chunk, moduleTemplate, dependencyTemplates) {\n  var buf = [];\n  // 每一个 module 都有一个 moduleId，在最后会替换。\n  buf.push(\'function \' + this.requireFn + \'(moduleId) {\');\n  buf.push(this.indent(this.applyPluginsWaterfall(\'require\', \'\', chunk, hash)));\n  buf.push(\'}\');\n  buf.push(\'\');\n  // ... // 其余封装操作\n};`, `62064624406739900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token class-name">MainTemplate</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>requireFn <span class="token operator">=</span> <span class="token string">\'__webpack_require__\'</span><span class="token punctuation">;</span>\n<span class="token class-name">MainTemplate</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">hash<span class="token punctuation">,</span> chunk<span class="token punctuation">,</span> moduleTemplate<span class="token punctuation">,</span> dependencyTemplates</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token comment">// 每一个 module 都有一个 moduleId，在最后会替换。</span>\n  buf<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'function \'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>requireFn <span class="token operator">+</span> <span class="token string">\'(moduleId) {\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  buf<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">applyPluginsWaterfall</span><span class="token punctuation">(</span><span class="token string">\'require\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">,</span> chunk<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  buf<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'}\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  buf<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ... // 其余封装操作</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后看看 Compilation.assets 对象</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-09-02-14-19-35-d3f7efd0da5a5becf814a74bbea3ac0e-f37c3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.54578754578754%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABKklEQVQoz4WR62rDMAyF8/7P118bbG3usS3JkZ34kjSdkm7Q3agQ4oD5pMNxAZ3BDrA3oA0ze0SntUdgrdloD8BKORHGyNM8+ZxzOkpEgSVSRbYh0ysk8mrwTTP1nWtqLi++bV1dua71e3eR+fZQBVQIF6SOjNYAQErFcczeR2tFJObsnMx0zDWlbzBWiCUJDFoj4hc8pYOUjpZk0Sec809YbN9hALQHvEzzTgp/MOI2ef83LJetwEoD7raDpWXysiIgCCy2A6KIyGOe519wRXgBI7Fb0sOg+14CvS7LGuM+U9pFznsvy7ZtD4GVAiOUYKpaztZty87dntV2VCFRS+uzMe9v8PpyPp0c0f58vT5dUbAiZ8bZuhCjfPzEvIRwN/kfs66rkyBC+ACrej0wpgRdPgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 09 02 14 19 35" title="" data-src="/static/2021-09-02-14-19-35-d3f7efd0da5a5becf814a74bbea3ac0e-fee1c.png" data-srcset="/static/2021-09-02-14-19-35-d3f7efd0da5a5becf814a74bbea3ac0e-a67b7.png 200w,\n/static/2021-09-02-14-19-35-d3f7efd0da5a5becf814a74bbea3ac0e-0b187.png 400w,\n/static/2021-09-02-14-19-35-d3f7efd0da5a5becf814a74bbea3ac0e-fee1c.png 800w,\n/static/2021-09-02-14-19-35-d3f7efd0da5a5becf814a74bbea3ac0e-b1a91.png 1200w,\n/static/2021-09-02-14-19-35-d3f7efd0da5a5becf814a74bbea3ac0e-f37c3.png 1365w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="done（compiler）"><a href="#done%EF%BC%88compiler%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>done（Compiler）</h2>\n<p>最后一步 webpack 调用 Compiler 中的 emitAssets()，按照 output 中的配置项将文件输出到了对应的 path 中，从而 webpack 整个打包过程结束。要注意的是，若想对结果进行处理，则需要在 emit 触发后对自定义插件进行扩展。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Webpack深入学习/index.md absPath of file >>> MarkdownRemark",timeToRead:26,frontmatter:{date:"2021-09-01 18:12:15",path:"/webpack-deep-learn/",tags:"前端, webpack, 前端构建工具, 读书笔记",title:"Webpack 深入学习",draft:null}}],length:74,tag:"读书笔记",pagesSum:15,page:6}}}});