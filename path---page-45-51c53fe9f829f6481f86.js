webpackJsonp([0x8c3edb7c93bd],{1364:function(n,a){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"翻译转载： Webpack 3, Dynamic Imports, Code Splitting, and Long Term Caching… Made Easy.  在与 Webpack 1.x 升级到 3.x（比我想承认的更长的时间）后，突然点击了一下。看到揭开的奥秘： TL：DR 示例应用程序回购 让我们通过这些配置文件，并揭秘发生了什么事情。 我总是从文件开始查看新的代码库的 package.json。这使我能够在代码中看到它们之前了解依赖关系。 在我们的应用程序中，react…",html:'<p>翻译转载：<a href="https://blog.cloudboost.io/webpack-3-dynamic-imports-code-splitting-and-long-term-caching-made-easy-1892981e0ae7" target="_blank" rel="nofollow noreferrer noopener">Webpack 3, Dynamic Imports, Code Splitting, and Long Term Caching… Made Easy.</a> 在与 Webpack 1.x 升级到 3.x（比我想承认的更长的时间）后，突然点击了一下。看到揭开的奥秘：</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 46.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <div align="center"><iframe src="https://giphy.com/embed/xUOxeX2W00FmKjNsUo" frameborder="0" class="giphy-embed" allowfullscreen style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe><p><a href="https://giphy.com/gifs/code-splitting-dynamic-imports-webpack-3-xUOxeX2W00FmKjNsUo">via GIPHY</a></p></div>\n&#x6F14;&#x793A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x591A;&#x4E2A;&#x8DEF;&#x7EBF;&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#x7F16;&#x8F91;&#x201C;&#x9875;&#x9762;2&#x201D;&#x540E;&#x7684;200&#x54CD;&#x5E94;&#xFF0C;&#x800C;&#x672A;&#x66F4;&#x6539;&#x7684;&#x6587;&#x4EF6;&#x5219;&#x4E3A;304&#x3002;\n          </div>\n          </div>\n<p>TL：DR 示例应用程序回购</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75899322237169730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// webpack.config.js\nconst webpack = require(\'webpack\');\nconst path = require(\'path\');\nconst HtmlWebpackPlugin = require(\'html-webpack-plugin\');\n\nconst APP_DIR = path.resolve(__dirname, \'./src\');\nconst MODULES_DIR = path.resolve(__dirname, \'./node_modules\');\n\nconst package = require(\'./package.json\');\n\nmodule.exports = {\n  devServer: {\n    historyApiFallback: true\n  },\n  entry: {\n    app: APP_DIR + \'/index.js\',\n    vendor: Object.keys(package.dependencies)\n  },\n  output: {\n    publicPath: \'/\',\n    chunkFilename: \'[name].[chunkhash].js\',\n    filename: \'[name].[chunkhash].js\'\n  },\n  resolve: {\n    extensions: [\'.js\', \'.jsx\'],\n    modules: [APP_DIR, MODULES_DIR]\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.jsx?\\$/,\n        exclude: /node_modules/,\n        include: APP_DIR,\n        use: {\n          loader: \'babel-loader\'\n        }\n      }\n    ]\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: \'Caching and Code Splitting\',\n      template: APP_DIR + \'/index.html\'\n    }),\n    new webpack.HashedModuleIdsPlugin(),\n    new webpack.optimize.CommonsChunkPlugin({\n      name: \'vendor\',\n      filename: \'vendor.[chunkhash].js\'\n    }),\n    new webpack.optimize.CommonsChunkPlugin({\n      name: \'manifest\'\n    })\n  ]\n};`, `75899322237169730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// webpack.config.js</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">APP_DIR</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'./src\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token constant">MODULES_DIR</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'./node_modules\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token keyword">package</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    historyApiFallback<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    app<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span> <span class="token string">\'/index.js\'</span><span class="token punctuation">,</span>\n    vendor<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'.js\'</span><span class="token punctuation">,</span> <span class="token string">\'.jsx\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">APP_DIR</span><span class="token punctuation">,</span> <span class="token constant">MODULES_DIR</span><span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.jsx?$/</span><span class="token punctuation">,</span>\n        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          loader<span class="token punctuation">:</span> <span class="token string">\'babel-loader\'</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      title<span class="token punctuation">:</span> <span class="token string">\'Caching and Code Splitting\'</span><span class="token punctuation">,</span>\n      template<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span> <span class="token string">\'/index.html\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n      filename<span class="token punctuation">:</span> <span class="token string">\'vendor.[chunkhash].js\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'manifest\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73418649690984730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// .babelrc\n{\n  &quot;presets&quot;: [\n    &quot;react&quot;,\n    [&quot;env&quot;, {\n      &quot;targets&quot;: {\n        &quot;browsers&quot;: [&quot;last 2 versions&quot;]\n      }\n    }],\n    &quot;stage-0&quot;\n  ],\n  &quot;comments&quot;: true\n}`, `73418649690984730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="javaScript"\n              >\n                <span class="gatsby-code-button-language">javaScript</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// .babelrc</span>\n<span class="token punctuation">{</span>\n  <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token string">"react"</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      <span class="token string">"targets"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">"browsers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"last 2 versions"</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token string">"stage-0"</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token string">"comments"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69020149734887510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;name&quot;: &quot;webpack-cs-ltc&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;description&quot;: &quot;A simple boilerplate for Webpack 3, dynamic imports, code splitting, and long term caching.&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;scripts&quot;: {\n    &quot;start&quot;: &quot;webpack --config webpack.config.js&quot;,\n    &quot;dev-server&quot;: &quot;webpack-dev-server&quot;,\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; && exit 1&quot;\n  },\n  &quot;author&quot;: &quot;Geoff Miller&quot;,\n  &quot;license&quot;: &quot;MIT&quot;,\n  &quot;dependencies&quot;: {\n    &quot;react&quot;: &quot;^16.2.0&quot;,\n    &quot;react-dom&quot;: &quot;^16.2.0&quot;,\n    &quot;react-loadable&quot;: &quot;^5.3.1&quot;,\n    &quot;react-router-dom&quot;: &quot;^4.2.2&quot;\n  },\n  &quot;devDependencies&quot;: {\n    &quot;babel-core&quot;: &quot;^6.26.0&quot;,\n    &quot;babel-loader&quot;: &quot;^7.1.2&quot;,\n    &quot;babel-preset-env&quot;: &quot;^1.6.1&quot;,\n    &quot;babel-preset-react&quot;: &quot;^6.24.1&quot;,\n    &quot;babel-preset-stage-0&quot;: &quot;^6.24.1&quot;,\n    &quot;html-webpack-plugin&quot;: &quot;^2.30.1&quot;,\n    &quot;webpack&quot;: &quot;^3.10.0&quot;,\n    &quot;webpack-dev-server&quot;: &quot;^2.9.7&quot;\n  }\n}`, `69020149734887510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>\n  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"webpack-cs-ltc"</span><span class="token punctuation">,</span>\n  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>\n  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"A simple boilerplate for Webpack 3, dynamic imports, code splitting, and long term caching."</span><span class="token punctuation">,</span>\n  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>\n  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"start"</span><span class="token punctuation">:</span> <span class="token string">"webpack --config webpack.config.js"</span><span class="token punctuation">,</span>\n    <span class="token string">"dev-server"</span><span class="token punctuation">:</span> <span class="token string">"webpack-dev-server"</span><span class="token punctuation">,</span>\n    <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"echo \\"Error: no test specified\\" &amp;&amp; exit 1"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">"Geoff Miller"</span><span class="token punctuation">,</span>\n  <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>\n  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"react"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-dom"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-loadable"</span><span class="token punctuation">:</span> <span class="token string">"^5.3.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-router-dom"</span><span class="token punctuation">:</span> <span class="token string">"^4.2.2"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token string">"devDependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"babel-core"</span><span class="token punctuation">:</span> <span class="token string">"^6.26.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-loader"</span><span class="token punctuation">:</span> <span class="token string">"^7.1.2"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-env"</span><span class="token punctuation">:</span> <span class="token string">"^1.6.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-react"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-stage-0"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"html-webpack-plugin"</span><span class="token punctuation">:</span> <span class="token string">"^2.30.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack"</span><span class="token punctuation">:</span> <span class="token string">"^3.10.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack-dev-server"</span><span class="token punctuation">:</span> <span class="token string">"^2.9.7"</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>让我们通过这些配置文件，并揭秘发生了什么事情。</p>\n<p>我总是从文件开始查看新的代码库的 package.json。这使我能够在代码中看到它们之前了解依赖关系。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42610484935991310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// package.json\n&quot;dependencies&quot;: {\n    &quot;react&quot;: &quot;^16.2.0&quot;,\n    &quot;react-dom&quot;: &quot;^16.2.0&quot;,\n    &quot;react-loadable&quot;: &quot;^5.3.1&quot;, <-- dynamic imports for react\n    &quot;react-router-dom&quot;: &quot;^4.2.2&quot;\n  },`, `42610484935991310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// package.json</span>\n<span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"react"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-dom"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-loadable"</span><span class="token punctuation">:</span> <span class="token string">"^5.3.1"</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">--</span> dynamic imports <span class="token keyword">for</span> react\n    <span class="token string">"react-router-dom"</span><span class="token punctuation">:</span> <span class="token string">"^4.2.2"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在我们的应用程序中，react-loadable 将完成所有繁重的动态导入工作。这是一个小包装，减少样板和增加一些方便的功能。所以，而不是必须为每个动态导入执行此操作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27935440162959544000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyComponent extends React.Component {\n  state = {\n    Bar: null\n  };\n\n  componentWillMount() {\n    import(\'./components/Bar\').then((Bar) => {\n      this.setState({ Bar });\n    });\n  }\n\n  render() {\n    let { Bar } = this.state;\n    if (!Bar) {\n      return <div>Loading...</div>;\n    } else {\n      return <Bar />;\n    }\n  }\n}`, `27935440162959544000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span>\n    Bar<span class="token punctuation">:</span> <span class="token keyword">null</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'./components/Bar\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">Bar</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Bar <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">{</span> Bar <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Bar<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token operator">&lt;</span>Bar <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们现在可以做到：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8879962246231066000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import Loadable from \'react-loadable\';\n\nconst LoadableBar = Loadable({\n  loader: () => import(\'./components/Bar\'),\n  loading() {\n    return <div>Loading...</div>;\n  }\n});\n\nclass MyComponent extends React.Component {\n  render() {\n    return <LoadableBar />;\n  }\n}`, `8879962246231066000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">\'react-loadable\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> LoadableBar <span class="token operator">=</span> <span class="token function">Loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function-variable function">loader</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'./components/Bar\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>LoadableBar <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>好的，到 devDependencies：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62785967624460845000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// package.json\n&quot;devDependencies&quot;: {\n    &quot;babel-core&quot;: &quot;^6.26.0&quot;,\n    &quot;babel-loader&quot;: &quot;^7.1.2&quot;,\n    &quot;babel-preset-env&quot;: &quot;^1.6.1&quot;,\n    &quot;babel-preset-react&quot;: &quot;^6.24.1&quot;,\n    &quot;babel-preset-stage-0&quot;: &quot;^6.24.1&quot;, <-- needed for dynamic import\n    &quot;html-webpack-plugin&quot;: &quot;^2.30.1&quot;,\n    &quot;webpack&quot;: &quot;^3.10.0&quot;,\n    &quot;webpack-dev-server&quot;: &quot;^2.9.7&quot;\n  }`, `62785967624460845000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// package.json</span>\n<span class="token string">"devDependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"babel-core"</span><span class="token punctuation">:</span> <span class="token string">"^6.26.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-loader"</span><span class="token punctuation">:</span> <span class="token string">"^7.1.2"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-env"</span><span class="token punctuation">:</span> <span class="token string">"^1.6.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-react"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-stage-0"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">--</span> needed <span class="token keyword">for</span> dynamic <span class="token keyword">import</span>\n    <span class="token string">"html-webpack-plugin"</span><span class="token punctuation">:</span> <span class="token string">"^2.30.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack"</span><span class="token punctuation">:</span> <span class="token string">"^3.10.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack-dev-server"</span><span class="token punctuation">:</span> <span class="token string">"^2.9.7"</span>\n  <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里唯一不同寻常的软件包是 babel-preset-stage-0。动态导入是第三阶段的建议。如果你想你可以使用 babel-preset-stage-3，但 babel-preset-stage-0 将包括所有的阶段 1，阶段 2 和阶段 3。根据需要将其配置为您的代码库/喜好，你需要的是动态导入功能的阶段 3。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33844241040519930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// .babelrc\n{\n  &quot;presets&quot;: [\n    &quot;react&quot;,\n    [&quot;env&quot;, {\n      &quot;targets&quot;: {\n        &quot;browsers&quot;: [&quot;last 2 versions&quot;]\n      }\n    }],\n    &quot;stage-0&quot; <-- no big surprise here\n  ],\n  &quot;comments&quot;: true\n}`, `33844241040519930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// .babelrc</span>\n<span class="token punctuation">{</span>\n  <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token string">"react"</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      <span class="token string">"targets"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">"browsers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"last 2 versions"</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token string">"stage-0"</span> <span class="token operator">&lt;</span><span class="token operator">--</span> no big surprise here\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token string">"comments"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>确保包含 stage-0 在你的 babel 预设中。有些事情要注意，有几个动态的输入插件 webpack/babel 在那。在这个用例中你不需要使用 Webpack 3（前端只有 react）。如果我错了希望有人能纠正我。请注意”comments”: true 设置。这将帮助我们使用 Webpack 的神奇评论来命名我们的动态导入文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43061181666446020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// webpack.config.js\n...\nentry: {\n    app: APP_DIR +\'/index.js\',\n    vendor: Object.keys(package.dependencies)\n},\noutput: {\n    publicPath: \'/\',\n    chunkFilename: \'[name].[chunkhash].js\',\n    filename: \'[name].[chunkhash].js\'\n  },\n...\nplugins: [\n    ...\n    new webpack.HashedModuleIdsPlugin(),\n    new webpack.optimize.CommonsChunkPlugin({\n      name:\'vendor\',\n      filename: \'vendor.[chunkhash].js\'\n    }),\n    new webpack.optimize.CommonsChunkPlugin({\n      name:\'manifest\'\n    })\n  ]\n...`, `43061181666446020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// webpack.config.js</span>\n<span class="token operator">...</span>\nentry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    app<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span><span class="token string">\'/index.js\'</span><span class="token punctuation">,</span>\n    vendor<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\noutput<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token operator">...</span>\nplugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token operator">...</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span><span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n      filename<span class="token punctuation">:</span> <span class="token string">\'vendor.[chunkhash].js\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span><span class="token string">\'manifest\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span>\n<span class="token operator">...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这就是“普通”React webpack 安装程序之外所需要的。这里有一些关于这个配置的更多细节。定义您的输入分割点。在我们的例子中，我们需要一个 app.x.js 和一个 vendor.x.js 文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67148393917470564000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`entry: {\n  app: APP_DIR +\'/index.js\',\n  vendor: Object.keys(package.dependencies)\n},`, `67148393917470564000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  app<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span><span class="token string">\'/index.js\'</span><span class="token punctuation">,</span>\n  vendor<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>[chunkhash]在输出中使用您的文件名 hash：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42934157800240790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`output: {\n  publicPath: \'/\',\n  chunkFilename: \'[name].[chunkhash].js\',\n  filename: \'[name].[chunkhash].js\'\n},`, `42934157800240790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n  chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n  filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在插件中，使用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54377017612347990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new webpack.HashedModuleIdsPlugin();`, `54377017612347990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>那么你的 CommonsChunkPlugin 需要再次 chunkhash：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87105873167846750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new webpack.optimize.CommonsChunkPlugin({\n  name:\'vendor\',\n  filename: \'vendor.[chunkhash].js\'\n}),`, `87105873167846750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span><span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n  filename<span class="token punctuation">:</span> <span class="token string">\'vendor.[chunkhash].js\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后，但一个容易忽略的细节：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5752255884370028000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new webpack.optimize.CommonsChunkPlugin({\n  name: \'manifest\'\n});`, `5752255884370028000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span> <span class="token string">\'manifest\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>深入了解为什么清单文件在这里很重要。随意跳到 React 代码的下一节。没有 manifest chunk 块，Webpack 将产生这些文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75205714086872150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pageOne.58e60ef81ba97426a00d.js 679 bytes\n   home.b65cb7fd922ea7126e95.js 671 bytes\n    app.3c3fcb4d6bcba55f3bb7.js 3.44 kB\nvendor.da901bd61614a0e9f2fe.js 1.25 MB\n                     index.html 397 bytes`, `75205714086872150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">pageOne<span class="token punctuation">.</span><span class="token number">58e60</span>ef81ba97426a00d<span class="token punctuation">.</span>js <span class="token number">679</span> bytes\n   home<span class="token punctuation">.</span>b65cb7fd922ea7126e95<span class="token punctuation">.</span>js <span class="token number">671</span> bytes\n    app<span class="token punctuation">.</span><span class="token number">3</span>c3fcb4d6bcba55f3bb7<span class="token punctuation">.</span>js <span class="token number">3.44</span> kB\nvendor<span class="token punctuation">.</span>da901bd61614a0e9f2fe<span class="token punctuation">.</span>js <span class="token number">1.25</span> <span class="token constant">MB</span>\n                     index<span class="token punctuation">.</span>html <span class="token number">397</span> bytes</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可能会想：“太棒了，它正在工作！” 你去做你的事情，改变 home 组件，Webpack 建立你的文件，然后你会伤心的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56978906732914340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  home.5a5f308381fc5670d102.js  674 bytes <--new hash expected\nvendor.c509e728faa4374eee45.js  1.25 MB <--new hash not expected\n                    index.html  397 bytes`, `56978906732914340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">  home<span class="token punctuation">.</span><span class="token number">5</span>a5f308381fc5670d102<span class="token punctuation">.</span>js  <span class="token number">674</span> bytes <span class="token operator">&lt;</span><span class="token operator">--</span><span class="token keyword">new</span> <span class="token class-name">hash</span> expected\nvendor<span class="token punctuation">.</span>c509e728faa4374eee45<span class="token punctuation">.</span>js  <span class="token number">1.25</span> <span class="token constant">MB</span> <span class="token operator">&lt;</span><span class="token operator">--</span><span class="token keyword">new</span> <span class="token class-name">hash</span> not expected\n                    index<span class="token punctuation">.</span>html  <span class="token number">397</span> bytes</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>是什么导致了？你没有给你的 package.json 改变/添加任何东西 。Webpack 文档简要地解释了这里发生了什么。这是非常高的水平，但我想知道什么是实际上改变的代码，以保证生成一个新的哈希 vendors.x.js 文件。</p>\n<p>如果你看看里面的生成，vendor.x.js 你会看到：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77290129182771890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/******/ script.src =\n  __webpack_require__.p +\n  \'\' +\n  ({ \'0\': \'pageOne\', \'1\': \'home\', \'2\': \'app\' }[chunkId] || chunkId) +\n  \'.\' +\n  { \'0\': \'58e60ef81ba97426a00d\', \'1\': \'5a5f308381fc5670d102\', \'2\': \'3c3fcb4d6bcba55f3bb7\' }[chunkId] +\n  \'.js\';`, `77290129182771890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/******/</span> script<span class="token punctuation">.</span>src <span class="token operator">=</span>\n  __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span>\n  <span class="token string">\'\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'pageOne\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'home\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'app\'</span> <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">||</span> chunkId<span class="token punctuation">)</span> <span class="token operator">+</span>\n  <span class="token string">\'.\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">{</span> <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'58e60ef81ba97426a00d\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'5a5f308381fc5670d102\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'3c3fcb4d6bcba55f3bb7\'</span> <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">+</span>\n  <span class="token string">\'.js\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>啊哈！这是所有我们的[chunkhash]价值观。因为我们改变了 home 组件，所以生成了一个新的散列，并将其添加到“webpack 样板文件”中，然后将其反转到我们的 vendor.x.js 文件中。不完全是我们想要发生的，看到我们的 vendor 文件不会经常更改，通常是我们构建的最大的文件。让我们用一个 webpack manifest 文件运行相同的练习。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27123606078227104000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pageOne.58e60ef81ba97426a00d.js 679 bytes\n    home.5a5f308381fc5670d102.js 674 bytes\n  vendor.db2436c7653388db768a.js 1.24 MB\n     app.8e527bb7a890edfc1ef3.js 3.44 kB\nmanifest.2b89533b2a3dea66348d.js 5.96 kB`, `27123606078227104000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">pageOne<span class="token punctuation">.</span><span class="token number">58e60</span>ef81ba97426a00d<span class="token punctuation">.</span>js <span class="token number">679</span> bytes\n    home<span class="token punctuation">.</span><span class="token number">5</span>a5f308381fc5670d102<span class="token punctuation">.</span>js <span class="token number">674</span> bytes\n  vendor<span class="token punctuation">.</span>db2436c7653388db768a<span class="token punctuation">.</span>js <span class="token number">1.24</span> <span class="token constant">MB</span>\n     app<span class="token punctuation">.</span><span class="token number">8e527</span>bb7a890edfc1ef3<span class="token punctuation">.</span>js <span class="token number">3.44</span> kB\nmanifest<span class="token punctuation">.</span><span class="token number">2</span>b89533b2a3dea66348d<span class="token punctuation">.</span>js <span class="token number">5.96</span> kB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>改变 home</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76202801350973500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`    home.b65cb7fd922ea7126e95.js  671 bytes\nmanifest.c4a2e5b1ff1dcfbe35ae.js    5.96 kB`, `76202801350973500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">    home<span class="token punctuation">.</span>b65cb7fd922ea7126e95<span class="token punctuation">.</span>js  <span class="token number">671</span> bytes\nmanifest<span class="token punctuation">.</span>c4a2e5b1ff1dcfbe35ae<span class="token punctuation">.</span>js    <span class="token number">5.96</span> kB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>🎉 只有一个 home 组件和 manifest 产生新的散列 。让我们看看 manifest 文件里面：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83394696974003270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/******/ script.src =\n  __webpack_require__.p +\n  \'\' +\n  ({ \'0\': \'pageOne\', \'1\': \'home\', \'2\': \'vendor\', \'3\': \'app\' }[chunkId] || chunkId) +\n  \'.\' +\n  {\n    \'0\': \'58e60ef81ba97426a00d\',\n    \'1\': \'b65cb7fd922ea7126e95\',\n    \'2\': \'db2436c7653388db768a\',\n    \'3\': \'8e527bb7a890edfc1ef3\'\n  }[chunkId] +\n  \'.js\';`, `83394696974003270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/******/</span> script<span class="token punctuation">.</span>src <span class="token operator">=</span>\n  __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span>\n  <span class="token string">\'\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'pageOne\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'home\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'vendor\'</span><span class="token punctuation">,</span> <span class="token string">\'3\'</span><span class="token punctuation">:</span> <span class="token string">\'app\'</span> <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">||</span> chunkId<span class="token punctuation">)</span> <span class="token operator">+</span>\n  <span class="token string">\'.\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">{</span>\n    <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'58e60ef81ba97426a00d\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'b65cb7fd922ea7126e95\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'db2436c7653388db768a\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'3\'</span><span class="token punctuation">:</span> <span class="token string">\'8e527bb7a890edfc1ef3\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">+</span>\n  <span class="token string">\'.js\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们在 manifest 中的[chunkhash]值正与我们的 vendor 文件混淆起来。在你的 vendor 文件中搜索这个代码，你会发现它已经消失了。感觉不错。最后是 React 代码。这可能是最酷的部分。我可以看到如此多的反应可加载的潜力。正常导入看起来像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44963769921604624000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import Home from \'./home\';`, `44963769921604624000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">\'./home\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>所有我们必须做的，以获得正确的动态导入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79952260068098030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import Loadable from \'react-loadable\'\nimport Loading from \'./loading\'\nconst Home = Loadable({\n  loader: () => import(\'./home\' /* webpackChunkName: \'home\' */),\n  loading: Loading, <-- a &quot;loading&quot; comp required by react-loadable\n})`, `79952260068098030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">\'react-loadable\'</span>\n<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">\'./loading\'</span>\n<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">Loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function-variable function">loader</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'./home\'</span> <span class="token comment">/* webpackChunkName: \'home\' */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  loading<span class="token punctuation">:</span> Loading<span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">--</span> a <span class="token string">"loading"</span> comp required by react<span class="token operator">-</span>loadable\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里的所有都是它的。用 react-loadable 方式包装导入，并使用新的 import()语法。注意到 Webpack 中的评论/_ webpackChunkName: ‘your<em>component</em>name’ _/ 。无需指定 0.db2436c7653388db768a.js 的文件名。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Webpack3代码拆分/index.md absPath of file >>> MarkdownRemark",timeToRead:6,frontmatter:{date:"2017-12-13 14:50:16",path:"/webpack-code-split/",tags:"前端, 前端构建工具, webpack",title:"Webpack3代码拆分",draft:null}},{excerpt:"翻译转载： Optimize React Performance 如何提高生产中的 React 性能，避免常见的错误 您是否知道 key 在列表中使用不正确可以将 DOM 操作增加 10 倍以上？据了解，React 的 Virtual DOM 实现速度非常快。但是，即使使用 React 的内置性能，也有一些 UI 可能开始感觉迟缓的情况。造成业绩不佳的罪魁祸首是产生了太多渲染和状态同步。我们将介绍 4 种技术，以帮助确保您的应用程序得到优化，并提供快速的用户体验。 key…",html:'<p>翻译转载：<a href="https://levelup.gitconnected.com/optimize-react-performance-c1a491ed9c36?ref=reddit&#x26;utm_source=reddit&#x26;utm_medium=react-12-12-2017" target="_blank" rel="nofollow noreferrer noopener">Optimize React Performance</a></p>\n<h1 id="如何提高生产中的-react-性能，避免常见的错误"><a href="#%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E4%B8%AD%E7%9A%84-react-%E6%80%A7%E8%83%BD%EF%BC%8C%E9%81%BF%E5%85%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何提高生产中的 React 性能，避免常见的错误</h1>\n<blockquote>\n<p>您是否知道 key 在列表中使用不正确可以将 DOM 操作增加 10 倍以上？据了解，React 的 Virtual DOM 实现速度非常快。但是，即使使用 React 的内置性能，也有一些 UI 可能开始感觉迟缓的情况。造成业绩不佳的罪魁祸首是产生了太多渲染和状态同步。我们将介绍 4 种技术，以帮助确保您的应用程序得到优化，并提供快速的用户体验。</p>\n</blockquote>\n<ol>\n<li>key 正确使用</li>\n<li>管理 shouldComponentUpdate</li>\n<li>扩展 PureComponent 而不是 Component</li>\n<li>建立生产</li>\n</ol>\n<h1 id="衡量效率"><a href="#%E8%A1%A1%E9%87%8F%E6%95%88%E7%8E%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>衡量效率</h1>\n<p>在深入研究代码之前，了解您正在优化的内容以及它所带来的影响是非常重要的。我建议使用的两个工具是 Lighthouse 和 react-addons-perf。这两个工具都可以通过 NPM（安装<a href="https://www.npmjs.com/package/lighthouse" target="_blank" rel="nofollow noreferrer noopener">1</a>，<a href="https://www.npmjs.com/package/react-addons-perf" target="_blank" rel="nofollow noreferrer noopener">2</a>），并都提供一个浏览器扩展（<a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk" target="_blank" rel="nofollow noreferrer noopener">1</a>，<a href="https://chrome.google.com/webstore/detail/react-perf/hacmcodfllhbnekmghgdlplbdnahmhmm?hl=en-US" target="_blank" rel="nofollow noreferrer noopener">2</a>）。我个人建议使用 npm for Lighthouse，因为结果似乎更可靠，并使用 React Perf 的 Chrome 扩展。以下是来自 Lighthouse 的输出示例，我们将在以下部分查看 React Perf 的结果。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABrElEQVQoz4VTy27UMBTND7HjBwpC6r5iYMEHQLvqD/BbqKuyREgIdYMqIdRJMjOOEzuOE9t5+BFO0oemmVKOrqIb2eeec33t6MWrLy+PL1Yfv7/99Pvd6fWPqw3nWZxutjuAcMbbth1mOOtuEwsM1hgTvV59PTq5fPP+24fz+Ozzdp3qcbS2YeOMUgnVKSTOO2GEDx65GUzdNUiiX9fk51X854aLOjBmrPVa1RXLoIDloixkI5Hgd1cQSE4VqzLn+USWkiMmlTC60AtRJgBsb7dd18/R9f2U9G1n2kF3zjnv4UTLqKqqshS3JtEWOslzKoTQWoNmZqDt+Wtq1UtlfQjY7FsZhRnjPVCWMYaKUANnf+kB4Q5jtFjw3lNK4zher2PYz0gG/QeCD3sYhkNyqCjNk4RvNjxNabxWjAWtXdN4radQCnlwDlsfkcOk4CXNWJJMQUgl5ZPOZx23VEbPJSGC7Doh2rrGhMK/sSSjQ0JIXhQ47fF/WJIhpZSarmQ/oI1nZN2hbUw4TXG9OUaF2eLwn9S03tKaLsnQxIMArWkaWID59h77teAJ9/wvdxUf23cOg3YAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="1 P0wwSgmIoA48qFnsMbSamg" title="" data-src="/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-fee1c.png" data-srcset="/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-a67b7.png 200w,\n/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-0b187.png 400w,\n/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>注意：Lighthouse 从版本 60 开始可以通过 Chrome 本地浏览，而 react-addons-perf 将不再与 React 16.0 +兼容，但以下结果对任何版本的 React 仍然有效。</p>\n<h1 id="正确的使用-key"><a href="#%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BD%BF%E7%94%A8-key" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>正确的使用 key</h1>\n<p><code class="language-text">key</code>:React 中在应用程序生命周期的任何时刻唯一标识列表中的元素。如果 DOM 被更新，React 能够识别哪些项目已经改变。因此，key 组件上的值必须是唯一的，并且与列表中的同级组件相关。这是 React 开发人员倾向于使用的一个属性，但是不论经验多少的 React 开发人员在生成列表时可能不会真正理解使用该属性。两个常见的错误是使用 index 期间 map(element, index) 或使用 Math.random() 生成一个 key。最好的解决方案是与列表项关联 UUID，但任何唯一标识符都可以。在列表中您将使用 key 的典型场景如下。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97845997395385090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function ListItem(props) {\n  // Correct! There is no need to specify the key here:\n  return <li>{props.value}</li>;\n}\n\nfunction UserList(props) {\n  const users = props.users;\n  const listItems = users.map((user) => (\n    // Correct! Key should be specified inside the array.\n    <ListItem key={user.id.toString()} value={user.name} />\n  ));\n  return <ul>{listItems}</ul>;\n}\n\nconst users = [{ id: 1, name: \'Khaleesi\' }, { id: 2, name: \'Jon\' }, { id: 3, name: \'Arya\' }];\n\n<UserList users={users} />;`, `97845997395385090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">ListItem</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Correct! There is no need to specify the key here:</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">UserList</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> users <span class="token operator">=</span> props<span class="token punctuation">.</span>users<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> listItems <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n    <span class="token comment">// Correct! Key should be specified inside the array.</span>\n    <span class="token operator">&lt;</span>ListItem key<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>ul<span class="token operator">></span><span class="token punctuation">{</span>listItems<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'Khaleesi\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'Jon\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'Arya\'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token operator">&lt;</span>UserList users<span class="token operator">=</span><span class="token punctuation">{</span>users<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于用户 ID 是唯一的，我们可以确信地使用它作为列表项的关键字。对于更实际的应用程序，我创建了一个 Postmate 的 feed 的模拟版本，当点击时从 DOM 中删除了一个商店。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/1_hJJK3sBRN2g3NbXDPHTF9A-b1e4f3dbdcc103eeb1f73771729ca5e0-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.75%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAAD0ElEQVQozw3L/VOSdwAA8O/sct2WOK211m1zK6fpJdPNTMUwsWQKKOILiDyIKO8P8AgIPDzA4/MCjw+QQKCApniSpG5qUzfX1nlbdV3e+Uu3u/bvbJ/fPwA5PAEOopRgSkiiJBQEjA+wDhC1goStJA2fWzJ9kNOdX9O7F2OLlH/vMb3C6AppD4ubj349BOjvr4A3coVJljPRygh77VGEk6IqM3NXc0FO1l254ipfRT7dQNA0Ewr4o5hpwWdOYDqDpH5tKQIchy+Bk60g4udwppQKXVtgv808rFlmK1IYSM58uIhwcnbOms2TwBdCRIQmsvH45lo+GQn98fw5QPZOgIUsQ+eBmyzx4R/jgYsUxgl7L4SdgLWWRC1lcQtnCUbI6VlFT8xvzKfon5+ub+/svnv3D0D3/wLG0AVX9Lw7/AlGVwTJsoDvIj5bTro+ou0gbCydN1xKWGCPElMII6gxTfkSNJbN5t6+OQWF/d0HKvGQSd2jEI/oVUJtv4nEdOTcqFbDGxzg9nbehWRy1ApBsoF7bVZIvJwhU+GAsbPxaGsZHB89Ewq40wq+feSOUd6tGuKF/TbCj9EzOp9xIkVYnHqFYUrLBJ1R3FbI0NvrkVzEPtxW+9NmBhwe7Cg0IrtNZZq8Z54YlPC/d8wYHQ6E9MCYTZ9LEjOIdkw1HsbMAYc6m8QiuNOm7Brrqz/+ZRsUt3eUIyLcOeW3qFDEjLph2g3jdg2tFFpaap1qGa6SupUPXI4JjbTTNyk1D3XDEv6cR7f/rAj2iqvGwQ7cNLa6QOdCvnnDaAiBcPOoS3Ar2tvkaa+CGj/j8a72d1VLGr6Y+JGv7eNBbXVysXCnWADbGUp6p0qrnSaJAKGRa25zB0X3UaUgaFGnI5SvuRrt4Jq6m3BxY8qhgvk3XQYVHqObv7mcp4IgxoQUkNLvhfHJLgbVB4mAQiH3jvBnIXEsFIA10n5ZC+rRJ13ahalRV9OXmOx+sFdg4lUf5DNgZSmpG2jCZgaipHIl5n1IOl1ev1kpcoyL56Yhw+RwS0fVuOi2V9KKtH9tba3R/HDTxG+H+zp2kyxIP4qL7tZZtbLHhRxqUQy01SrkUHcrV9peJ2+umeBeV924Mln/uUPWY5PyUbuOZikqRltN6t21FMjFGdVwF8sE5ukgS9miMcYwLtH0fGcVXIf7G0a6bnU2fKUU1C6l4ltbW/nV5SebhWLxSTYZe/P67/8z5bcM/Xa8u5yYe3GQ399bD9iEs4LqDXnjcc5fIOxOdY/b1PR0Y+XPFyevX708PX17dnZ2cHj0/v2//wHWRJckVRr6QAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="1 hJJK3sBRN2g3NbXDPHTF9A" title="" data-src="/static/1_hJJK3sBRN2g3NbXDPHTF9A-b1e4f3dbdcc103eeb1f73771729ca5e0-fee1c.png" data-srcset="/static/1_hJJK3sBRN2g3NbXDPHTF9A-b1e4f3dbdcc103eeb1f73771729ca5e0-a67b7.png 200w,\n/static/1_hJJK3sBRN2g3NbXDPHTF9A-b1e4f3dbdcc103eeb1f73771729ca5e0-0b187.png 400w,\n/static/1_hJJK3sBRN2g3NbXDPHTF9A-b1e4f3dbdcc103eeb1f73771729ca5e0-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/1_K9z91UAqGDb8pbcU1GRcPg-90999d6f0558c80acdafb9d7de5765ad-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.5%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACO0lEQVQoz1VSiY7aMBDN/39UW2m7y3KFBAiBwJKQ2449PsZJWMpRh1VbdWRZlmee35vncdr+s23PndANAcokz0uDXSfwTJipG63x2veGUgSpjWkp7UB0QtwB7lo7DWgBWsUZlkzJ1ixW6nDSi3U7WdCXdzfYAREqLkQFAi/S36jwQwR78e4qf+PUXDVMi6QSFecc5dTnx1y4axy51Wi+CveaKcwqpEJ3F+0HuI91eDCjeesHTs2E5AqPJ8xrCRpXoUpyHUbtckPm/swPWcEgOvGUMNWzdcTDDxZ+wGwpg8ihgByMPJWy4gCopj4cUmmZ3936dbraHhTXOq21ZW4vyjJvP9QyND8nZh06hCtgWiaFKqiwdV4g49z2Y9wlGbtesJMEbM+yZMJ8itVW7WJh8WNPh3vLbA1Dm1ZlYw96YcHFAJ76ZLJYWDC1huWy5gKf4CgWm70au7iJHAJ68CmtZQ2D7IkHx3yQ/TYjL+P19jAYlhN8yra6cHccDHudDoZRLhVok+SmpErgl2EYRJ23pnPP2+x5CXDIIG+YOvN1BNsj3x7F2FOWuea64cjjgheMNhreZmyX2F3/GFXf3wZm+xenEiko8ylnPm72ehWaby92Ipy26y59/0vIR9s+rtdHTe4grnlxy7LulB6zGmxT1jMw2N+waExG5KmSuxjTynk843a7ZXkeJ0mcphUhj//jfD4TQpI4TrK0ovR+v3/dO38r+q4zdnqN6fv+YdPPdf/ztMUjYtu2ffcv+xutxcTyeb4sWwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="1 K9z91UAqGDb8pbcU1GRcPg" title="" data-src="/static/1_K9z91UAqGDb8pbcU1GRcPg-90999d6f0558c80acdafb9d7de5765ad-fee1c.png" data-srcset="/static/1_K9z91UAqGDb8pbcU1GRcPg-90999d6f0558c80acdafb9d7de5765ad-a67b7.png 200w,\n/static/1_K9z91UAqGDb8pbcU1GRcPg-90999d6f0558c80acdafb9d7de5765ad-0b187.png 400w,\n/static/1_K9z91UAqGDb8pbcU1GRcPg-90999d6f0558c80acdafb9d7de5765ad-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>使用 react-addons-perf Chrome 扩展，我计算了使用 UUID 作为关键字以及使用 Math.random() 一个关键字来移除一个元素的操作次数。结果表明，使用唯一一致的密钥只需要 28 个操作来移除项目，而随机生成的密钥需要超过<code class="language-text">25 倍的数目操作才能执行完全相同的任务</code>。谨慎用你的<code class="language-text">key</code>。</p>\n<h1 id="管理-shouldcomponentupdate"><a href="#%E7%AE%A1%E7%90%86-shouldcomponentupdate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>管理 shouldComponentUpdate</h1>\n<p>管理组件生命周期允许您准确指定组件应该呈现的时间。既然您作为开发人员了解您的应用程序并不知道您的应用程序，您就可以确定组件是否需要重新渲染。渲染和重绘是 React 中最昂贵的操作，因此根据您的领域知识消除任何不必要的调用可以为您的性能和用户体验带来巨大的改进。</p>\n<h1 id="使用-reactpurecomponent-而不是-reactcomponent"><a href="#%E4%BD%BF%E7%94%A8-reactpurecomponent-%E8%80%8C%E4%B8%8D%E6%98%AF-reactcomponent" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 React.PureComponent 而不是 React.Component</h1>\n<p>React 提供 PureComponent 了管理 shouldComponentUpdate 开发人员的生命周期钩子。PureComponent 将做所有道具/状态的浅层比较，并且只会在任何道具/状态发生变化时进行渲染。大多数情况下，您可以放弃使用 PureComponent 而不是自己处理。它确实带有一些仔细的考虑，可能导致讨厌的错误。在将对象分配给变量时，JavaScript 使用指针。这意味着变量指向内存中的特定位置，而不是指向对象本身的任何特定位置。如果更新对象的属性，指针将保持不变，因此浅比较将无法识别更新。为了避免这种情况，您可以</p>\n<ol>\n<li>直接将变量传递给组件，而不是传递给对象</li>\n<li>包含不可变的数据结构。</li>\n</ol>\n<p>以下示例使用 PureComponent 将获得与我们的示例相同的结果 shouldComponentUpdate。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63052189015283620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class CounterButton extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = { count: 1 };\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  handleClick() {\n    this.setState((state) => ({ count: state.count + 1 }));\n  }\n\n  render() {\n    return (\n      <button color={this.props.color} onClick={this.handleClick}>\n        Count: {this.state.count}\n      </button>\n    );\n  }\n}`, `63052189015283620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">CounterButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>button color<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>\n        Count<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后一个考虑因素是功能组件还没有针对 React 进行优化，但是团队已经答应在将来这样做。如果您在应用程序中确定了需要优化的区域，则最好使用类组件来确保获得所需的性能。</p>\n<h1 id="建立生产"><a href="#%E5%BB%BA%E7%AB%8B%E7%94%9F%E4%BA%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>建立生产</h1>\n<p>建设生产看起来很明显，但重要的是你检查你的过程，以确保它编译使用 NODE_ENV = ‘production’。React 包含许多警告，可帮助您调试在生产中被剥离的内容。这些警告使开发更友好，但也使得 React 的构建变得越来越慢。生产 React 构建比开发构建渲染速度快 2-8 倍。</p>\n<p>以下 Webpack 插件将提供所需的生产版本：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11836284829362942000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`plugins: [\n  new webpack.DefinePlugin({\n    \'process.env\': {\n      NODE_ENV: JSON.stringify(\'production\')\n    }\n  }),\n  new webpack.optimize.UglifyJsPlugin()\n  \'transform-react-constant-elements\',\n  \'transform-react-inline-elements\',\n  ...otherPlugins\n]`, `11836284829362942000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token string">\'process.env\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token constant">NODE_ENV</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">\'production\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token string">\'transform-react-constant-elements\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'transform-react-inline-elements\'</span><span class="token punctuation">,</span>\n  <span class="token operator">...</span>otherPlugins\n<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 DefinePlugin 确保 NODE_ENV 设置是否正确，以及 UglifyJsPlugin 压缩的 JavaScript。所述 transform-react-constant-elements 移动常数元件以更高的范围，和 transform-react-inline-elements 替换天然 React.createElement() 具有更优化的版本。请注意，这些只能在生产中使用，因为它们会产生模糊的错误，使开发调试变得困难。您可以使用 React Developer for Chrome 来评估您是否使用 React 的生产版本。</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/优化React性能/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2017-12-13 10:13:24",path:"/optimize-react/",tags:"前端, React 性能",title:"优化 React 性能",draft:null}},{excerpt:"学习地址： 新手指南 ReactJS 视频 ， React 事件处理（3:42） React 组件状态（7:09） React 用 componentWillUnmount 方法停止内存泄漏（1:14） React Class（4:16）",html:'<p>学习地址：<a href="https://blog.kentcdodds.com/learn-react-fundamentals-and-advanced-patterns-eac90341c9db" target="_blank" rel="nofollow noreferrer noopener">新手指南 ReactJS 视频</a>，<code class="language-text">以下标题均采用链接+视频时长的方式展示</code></p>\n<h2 id="react-事件处理（342）"><a href="#react-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%88342%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/egghead-use-event-handlers-with-react" target="_blank" rel="nofollow noreferrer noopener">React 事件处理（3:42）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25385050028103963000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      // 函数式编程\n      const state = { eventCount: 0, username: \'\' };\n      function App() {\n        return (\n          <div>\n            <p>There have been {state.eventCount} events</p>\n            <p>\n              <button onClick={increment}>Press</button>\n            </p>\n            <p>You typed: {state.username}</p>\n            <p>\n              <input onChange={updateUsername} />\n            </p>\n          </div>\n        );\n      }\n\n      function updateUsername(event) {\n        console.log(event);\n        setState({\n          username: event.target.value\n        });\n      }\n\n      function increment() {\n        setState({\n          eventCount: state.eventCount + 1\n        });\n      }\n\n      function setState(newState) {\n        Object.assign(state, newState);\n        renderApp();\n      }\n\n      function renderApp() {\n        ReactDOM.render(<App />, document.getElementById(\'root\'));\n      }\n\n      renderApp();\n    </script>\n  </body>\n</html>`, `25385050028103963000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token comment">// 函数式编程</span>\n      <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> eventCount<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> <span class="token string">\'\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span>\n          <span class="token operator">&lt;</span>div<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>There have been <span class="token punctuation">{</span>state<span class="token punctuation">.</span>eventCount<span class="token punctuation">}</span> events<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>\n              <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">></span>Press<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>You typed<span class="token punctuation">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>\n              <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span>updateUsername<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">updateUsername</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          username<span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          eventCount<span class="token punctuation">:</span> state<span class="token punctuation">.</span>eventCount <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> newState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">renderApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">renderApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">renderApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-组件状态（709）"><a href="#react-%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81%EF%BC%88709%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/react-use-component-state-with-react" target="_blank" rel="nofollow noreferrer noopener">React 组件状态（7:09）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68348434270844300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      class StopWatch extends React.Component {\n        state = { lapse: 0, running: false };\n        handleRunClick = () => {\n          this.setState((state) => {\n            if (state.running) {\n              clearInterval(this.timer);\n            } else {\n              const startTime = Date.now() - this.state.lapse;\n              this.timer = setInterval((state) => {\n                this.setState({ lapse: Date.now() - startTime });\n              });\n            }\n            return { running: !state.running };\n          });\n        };\n        handleClearClick = () => {\n          clearInterval(this.timer);\n          this.setState({ lapse: 0, running: false });\n        };\n        render() {\n          const { lapse, running } = this.state;\n          const buttonStyle = {\n            border: \'1px solid #ccc\',\n            background: \'#fff\',\n            fontSize: \'2em\',\n            padding: 15,\n            margin: 5,\n            width: 200\n          };\n          return (\n            <div style={{ textAlign: \'center\' }}>\n              <label style={{ fontSize: \'5em\', display: \'block\' }}>{lapse}ms</label>\n              <button style={buttonStyle} onClick={this.handleRunClick}>\n                {running ? \'Stop\' : \'Start\'}\n              </button>\n              <button style={buttonStyle} onClick={this.handleClearClick}>\n                Clear\n              </button>\n            </div>\n          );\n        }\n      }\n      ReactDOM.render(<StopWatch />, document.getElementById(\'root\'));\n    </script>\n  </body>\n</html>`, `68348434270844300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">class</span> <span class="token class-name">StopWatch</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n        state <span class="token operator">=</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleRunClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              <span class="token keyword">const</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lapse<span class="token punctuation">;</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">return</span> <span class="token punctuation">{</span> running<span class="token punctuation">:</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>running <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleClearClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">,</span> running <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n          <span class="token keyword">const</span> buttonStyle <span class="token operator">=</span> <span class="token punctuation">{</span>\n            border<span class="token punctuation">:</span> <span class="token string">\'1px solid #ccc\'</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'#fff\'</span><span class="token punctuation">,</span>\n            fontSize<span class="token punctuation">:</span> <span class="token string">\'2em\'</span><span class="token punctuation">,</span>\n            padding<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>\n            margin<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n            width<span class="token punctuation">:</span> <span class="token number">200</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token punctuation">(</span>\n            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> textAlign<span class="token punctuation">:</span> <span class="token string">\'center\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>\n              <span class="token operator">&lt;</span>label style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> fontSize<span class="token punctuation">:</span> <span class="token string">\'5em\'</span><span class="token punctuation">,</span> display<span class="token punctuation">:</span> <span class="token string">\'block\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>lapse<span class="token punctuation">}</span>ms<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>\n              <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleRunClick<span class="token punctuation">}</span><span class="token operator">></span>\n                <span class="token punctuation">{</span>running <span class="token operator">?</span> <span class="token string">\'Stop\'</span> <span class="token punctuation">:</span> <span class="token string">\'Start\'</span><span class="token punctuation">}</span>\n              <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n              <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClearClick<span class="token punctuation">}</span><span class="token operator">></span>\n                Clear\n              <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n          <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>StopWatch <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-用-componentwillunmount-方法停止内存泄漏（114）"><a href="#react-%E7%94%A8-componentwillunmount-%E6%96%B9%E6%B3%95%E5%81%9C%E6%AD%A2%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%EF%BC%88114%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/react-stop-memory-leaks-with-componentwillunmount-lifecycle-method-in-react" target="_blank" rel="nofollow noreferrer noopener">React 用 componentWillUnmount 方法停止内存泄漏（1:14）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21652171855077507000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      class StopWatch extends React.Component {\n        state = { lapse: 0, running: false, isShow: true };\n        handleRunClick = () => {\n          this.setState((state) => {\n            if (state.running) {\n              clearInterval(this.timer);\n            } else {\n              const startTime = Date.now() - this.state.lapse;\n              this.timer = setInterval((state) => {\n                this.setState({ lapse: Date.now() - startTime }, () => {\n                  console.log(this.state.lapse);\n                });\n              });\n            }\n            return { running: !state.running };\n          });\n        };\n        handleClearClick = () => {\n          clearInterval(this.timer);\n          this.setState({ lapse: 0, running: false });\n        };\n        handleShow = (event) => {\n          this.setState({ isShow: event.target.checked });\n        };\n        componentWillUnmount() {\n          // 注意释放，否则报错\n          clearInterval(this.timer);\n        }\n        render() {\n          const { lapse, running, isShow } = this.state;\n          const buttonStyle = {\n            border: \'1px solid #ccc\',\n            background: \'#fff\',\n            fontSize: \'2em\',\n            padding: 15,\n            margin: 5,\n            width: 200\n          };\n          return (\n            <div style={{ textAlign: \'center\' }}>\n              Show or hide ? <input type=\'checkbox\' checked={isShow} onChange={this.handleShow} />\n              {isShow ? (\n                <div>\n                  <label style={{ fontSize: \'5em\', display: \'block\' }}>{lapse}ms</label>\n                  <button style={buttonStyle} onClick={this.handleRunClick}>\n                    {running ? \'Stop\' : \'Start\'}\n                  </button>\n                  <button style={buttonStyle} onClick={this.handleClearClick}>\n                    Clear\n                  </button>\n                </div>\n              ) : null}\n            </div>\n          );\n        }\n      }\n      ReactDOM.render(<StopWatch />, document.getElementById(\'root\'));\n    </script>\n  </body>\n</html>`, `21652171855077507000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">class</span> <span class="token class-name">StopWatch</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n        state <span class="token operator">=</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isShow<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleRunClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              <span class="token keyword">const</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lapse<span class="token punctuation">;</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lapse<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">return</span> <span class="token punctuation">{</span> running<span class="token punctuation">:</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>running <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleClearClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isShow<span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>checked <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// 注意释放，否则报错</span>\n          <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">,</span> running<span class="token punctuation">,</span> isShow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n          <span class="token keyword">const</span> buttonStyle <span class="token operator">=</span> <span class="token punctuation">{</span>\n            border<span class="token punctuation">:</span> <span class="token string">\'1px solid #ccc\'</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'#fff\'</span><span class="token punctuation">,</span>\n            fontSize<span class="token punctuation">:</span> <span class="token string">\'2em\'</span><span class="token punctuation">,</span>\n            padding<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>\n            margin<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n            width<span class="token punctuation">:</span> <span class="token number">200</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token punctuation">(</span>\n            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> textAlign<span class="token punctuation">:</span> <span class="token string">\'center\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>\n              Show or hide <span class="token operator">?</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">\'checkbox\'</span> checked<span class="token operator">=</span><span class="token punctuation">{</span>isShow<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleShow<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n              <span class="token punctuation">{</span>isShow <span class="token operator">?</span> <span class="token punctuation">(</span>\n                <span class="token operator">&lt;</span>div<span class="token operator">></span>\n                  <span class="token operator">&lt;</span>label style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> fontSize<span class="token punctuation">:</span> <span class="token string">\'5em\'</span><span class="token punctuation">,</span> display<span class="token punctuation">:</span> <span class="token string">\'block\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>lapse<span class="token punctuation">}</span>ms<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>\n                  <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleRunClick<span class="token punctuation">}</span><span class="token operator">></span>\n                    <span class="token punctuation">{</span>running <span class="token operator">?</span> <span class="token string">\'Stop\'</span> <span class="token punctuation">:</span> <span class="token string">\'Start\'</span><span class="token punctuation">}</span>\n                  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n                  <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClearClick<span class="token punctuation">}</span><span class="token operator">></span>\n                    Clear\n                  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n              <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n          <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>StopWatch <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-class（416）"><a href="#react-class%EF%BC%88416%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/egghead-use-class-components-with-react" target="_blank" rel="nofollow noreferrer noopener">React Class（4:16）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74424622545792630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      class Counter extends React.Component {\n        state = { count: 0 };\n        handleClick = () => {\n          // 注意箭头函数写法，参数、返回值都带括号\n          this.setState(({ count }) => ({\n            count: count + 1\n          }));\n        };\n        render() {\n          return <button onClick={this.handleClick}>{this.state.count}</button>;\n        }\n      }\n      ReactDOM.render(<Counter />, document.getElementById(\'root\'));\n    </script>\n  </body>\n</html>`, `74424622545792630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n        state <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token comment">// 注意箭头函数写法，参数、返回值都带括号</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n            count<span class="token punctuation">:</span> count <span class="token operator">+</span> <span class="token number">1</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/React基础知识第三部分/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2017-12-11 23:45:34",path:"/react-usage-part-3/",tags:"前端, React",title:"React基础知识第三部分",draft:null}},{excerpt:"安装／升级你的 Docker 客户端 推荐安装 1.10.0 以上版本的 Docker，参考文档 Docker 安装 如何配置镜像加速器 针对 Docker 客户端版本大于 1.10.0 的用户 您可以通过修改 daemon 配置文件/etc/docker/daemon.json 来使用加速器：",html:'<ul>\n<li>\n<p>安装／升级你的 Docker 客户端</p>\n</li>\n<li>\n<p>推荐安装 1.10.0 以上版本的 Docker，参考文档<a href="/2017/12/11/Docker%E5%AE%89%E8%A3%85/">Docker 安装</a></p>\n</li>\n</ul>\n<h2 id="如何配置镜像加速器"><a href="#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何配置镜像加速器</h2>\n<ul>\n<li>针对 Docker 客户端版本大于 1.10.0 的用户</li>\n</ul>\n<p>您可以通过修改 daemon 配置文件/etc/docker/daemon.json 来使用加速器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74050358241038630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`sudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-\'EOF\'\n{\n  &quot;registry-mirrors&quot;: [&quot;https://cfyic0ek.mirror.aliyuncs.com&quot;]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docke`, `74050358241038630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker\n<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">\'EOF\'\n{\n  "registry-mirrors": ["https://cfyic0ek.mirror.aliyuncs.com"]\n}\nEOF</span>\n<span class="token function">sudo</span> systemctl daemon-reload\n<span class="token function">sudo</span> systemctl restart docke</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Docker国内源加速/index.md absPath of file >>> MarkdownRemark",timeToRead:1,frontmatter:{date:"2017-12-11 23:37:24",path:"/docker-origin-guonei/",tags:"后端, Docker, Docker源",title:"Docker源国内加速",draft:null}},{excerpt:"翻译 深入 Docker：容器和镜像 这篇文章，通过一些实例向大家介绍 容器和镜像的具体区别。 是一个非常有趣的项目。它自己宣称可以减轻部署服务器的难度，当然我相信里面有炒作的成分。但是实际使用后，我觉得 Docker 的表现还是可圈可点的。本篇文章将会从头开始进行操作镜像，同时试图通过实例和文档来解答实际操作 Docker 中遇到的问题。 本文仅仅是试图使用深入讲解 镜像和容器的基础知识，而不是像了解  Docker：一种更好的虚拟化方式 一样试图总结出 Docker…",html:'<blockquote>\n<p>翻译<a href="http://opensolitude.com/2015/04/26/discovering-docker-containers-images.html" target="_blank" rel="nofollow noreferrer noopener">深入 Docker：容器和镜像</a>这篇文章，通过一些实例向大家介绍<code class="language-text">Docker</code>容器和镜像的具体区别。</p>\n</blockquote>\n<p><code class="language-text">Docker</code>是一个非常有趣的项目。它自己宣称可以减轻部署服务器的难度，当然我相信里面有炒作的成分。但是实际使用后，我觉得 Docker 的表现还是可圈可点的。本篇文章将会从头开始进行操作镜像，同时试图通过实例和文档来解答实际操作 Docker 中遇到的问题。</p>\n<p>本文仅仅是试图使用深入讲解<code class="language-text">Docker</code>镜像和容器的基础知识，而不是像了解 <a href="https://redstack.wordpress.com/2014/11/14/gettingn-to-know-docker-a-better-way-to-do-virtualization/" target="_blank" rel="nofollow noreferrer noopener">Docker：一种更好的虚拟化方式</a>一样试图总结出 Docker 的所有操作方法。</p>\n<p>如果你打算按照本文操作的话，那么你首先有台安装好 Docker 的 Linux 主机。使用 Docker Machine 安装 Docker 很简单，但是同时我也推荐使用 Digital Ocean 中已经安装好 Docker 的云主机直接操作。本篇文章所使用的 Docker 版本为 1.6.0，同时文中所有的命令都需要 root 权限。</p>\n<h2 id="技巧"><a href="#%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技巧</h2>\n<p>同样，译者在正文开始提供一个操作<code class="language-text">Docker</code>的小知识。下文中也会多次使用到这一点。</p>\n<p><code class="language-text">Docker</code>会为所有已经运行（包括已经停止）的容器随机分配一个唯一的名字和一个唯一的 ID，docker 命令可以识别 ID，也可以识别这个名字。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 16.249999999999996%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAhElEQVQI1x2Oaw4DIQiE9zZNmqYr+ELWqtvEGL3/gTqWH2SA+SYcay0RUdUxRs4XdGstipRSsGTilFKM8fF8GSJrLXTvXWI0xhxzTihYAePGzPf9rbVuOCViRhwAQ2z+FcKGVdOG4fPeee8/OcMXQkA/3ycQZBHRtUthEPyg6pzDjA74B3KoJ6W9mQpfAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2697097349 56fe3e372067b articlex" title="" data-src="/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-fee1c.png" data-srcset="/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-a67b7.png 200w,\n/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-0b187.png 400w,\n/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如图所示，第一行的容器的 ID 是 43de70a54ec1，名字是 admiring_ardinghelli</p>\n<p>想删除第一行对应的容器，我们只需要 docker rm 43de70a54ec1,或者简写成 docker rm 43de，或者 docker rm admiring_ardinghelli。</p>\n<h2 id="容器去哪儿了？"><a href="#%E5%AE%B9%E5%99%A8%E5%8E%BB%E5%93%AA%E5%84%BF%E4%BA%86%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器去哪儿了？</h2>\n<p>刚开始使用 Docker 的用户会发现，运行完一个容器，再次运行这个容器，原来的容器内的内容已经消失了，例如：</p>\n<p>现在我们使用 -i（交互式）和 -t（临时终端）参数运行一个容器，然后输入一些交互命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13649374159321880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker run -it ubuntu /bin/bash\n(CONTAINER) root@1f608dc4e5b4:/# echo hello docker > /message.txt\n(CONTAINER) root@1f608dc4e5b4:/# cat /message.txt\nhello docker\n(CONTAINER) root@1f608dc4e5b4:/# exit`, `13649374159321880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker run -it ubuntu /bin/bash</span>\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># echo hello docker > /message.txt</span>\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># cat /message.txt</span>\nhello docker\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># exit</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在上面那个容器内，我们创建了 /message.txt 文件，现在我们尝试重新读取这个文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23090692014038348000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker run -it ubuntu cat /message.txt\ncat: /message.txt: No such file or directory`, `23090692014038348000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker run -it ubuntu cat /message.txt</span>\ncat: /message.txt: No such <span class="token function">file</span> or directory</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>刚刚我们明明新建了这个文件，现在怎么没了？</p>\n<p>同时，运行 docker ps 列出容器，刚刚那个 1f608dc4e5b4 容器到哪里去了？</p>\n<p>好吧，那么我们用 docker ps -a 命令列出所有容器，然后仔细观察一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26306807048145252000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\nb3d8c3ef31a0        ubuntu:latest         &quot;cat /message.txt&quot;   33 minutes ago      Exited (1) 33 minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         &quot;/bin/bash&quot;          34 minutes ago      Exited (0) 15 minutes ago                       insane_wright`, `26306807048145252000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\nb3d8c3ef31a0        ubuntu:latest         <span class="token string">"cat /message.txt"</span>   <span class="token number">33</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">33</span> minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         <span class="token string">"/bin/bash"</span>          <span class="token number">34</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">15</span> minutes ago                       insane_wright</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在大家应该可以发现问题了：居然有两个不同的容器，一个执行了 /bin/bash，一个执行了 cat /message.txt。</p>\n<p>在本专栏以往的文章中，多次提到：Docker 使用一个叫做 UnionFS 的层级文件系统进行镜像操作。容器对镜像文件的所有操作均是在虚拟出的“改动层”上进行的。当然对容器而言，UnionFS 和普通的文件系统并无差别，也无法看到任何“改动层”。</p>\n<p>每次运行 docker run 命令的时候，Docker 都会指定新建容器，并且为容器自己的改动层。所以我们两次都运行了 ubuntu 镜像，那么我们也将会有两个新的、不同的容器，每个容器也都会有自己独立的的“改动层”。因此，在第一个容器内创建的 /message.txt 文件在第二个容器内是无法访问的。当然，要是能互相访问，那我们就得为 Docker 的安全性担心了。</p>\n<h2 id="容器到底去哪儿了？"><a href="#%E5%AE%B9%E5%99%A8%E5%88%B0%E5%BA%95%E5%8E%BB%E5%93%AA%E5%84%BF%E4%BA%86%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器到底去哪儿了？</h2>\n<blockquote>\n<p>刚刚的问题是：“容器去哪儿了？” 现在的问题是：“容器到底去哪儿了？我需要里面的 message.txt 文件，怎么才能取出来？”</p>\n</blockquote>\n<p>已经停止的容器中的数据并不会消失，而是被存储在相应的“改动层”中。我们可以通过 docker ps -a 进行查找容器。在这个例子中，我们要找的容器便是执行了 /bin/bash 命令的容器，ID 是 1f608dc4e5b4，名称是 insane_wright。</p>\n<p>对比起 ID，容器的名称更加易读。因此在本篇文章后面的例子中，我都将用名称来进行操作和识别容器。当然，你也可以在 docker run 的时候用 —name 参数指定容器的名称。</p>\n<p>那么现在我们现在运行上面例子中已经停止的 insane_wright 容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5634522236835937000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker start -ai insane_wright\n(CONTAINER) root@1f608dc4e5b4:/# cat /message.txt\nhello docker\n(CONTAINER) root@1f608dc4e5b4:/# exit`, `5634522236835937000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker start -ai insane_wright</span>\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># cat /message.txt</span>\nhello docker\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># exit</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 -a 参数将容器的输出导出到终端，同时使用 -i 参数进行交互式的操作。这条命令可以让我们继续运行容器 insane_wright，现在你应该能看得到我们刚刚创建的 /message.txt 文件了。</p>\n<h2 id="容器能不能提取出来？"><a href="#%E5%AE%B9%E5%99%A8%E8%83%BD%E4%B8%8D%E8%83%BD%E6%8F%90%E5%8F%96%E5%87%BA%E6%9D%A5%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器能不能提取出来？</h2>\n<blockquote>\n<p>现在我们已经运行了自己的容器，容器内也有独立的数据，我们也知道如何获取容器内的数据，那么问题来了：我们能不能把这个状态下的容器给保存起来？</p>\n</blockquote>\n<p>本专栏前面的文章提到过得益于 UnionFS，对于 Docker 来说，其实容器和镜像的差别并不大。容器可以认为是已经运行过的或正在运行的镜像，只不过是镜像上面添加了几个改动层。当然，大部分镜像也是如此。例如某些 mysql 镜像，便仅仅是在官方 ubuntu 镜像的基础上增加了一个 mysql 改动层。</p>\n<p>对于上面例子中的容器，我们可以用下面这条命令将其打包成镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="585826121357868500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) \\$ docker commit -a &quot;Jordan Bach&quot; -m &quot;saved my message&quot; insane_wright jbgo/message:v0.0.1\n1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409`, `585826121357868500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> $ docker commit -a <span class="token string">"Jordan Bach"</span> -m <span class="token string">"saved my message"</span> insane_wright jbgo/message:v0.0.1\n1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>本条命令将容器 insange_wright 的改动层的属性变为“只读”，并且指定存储为 jbgo/message 镜像。镜像基于原 ubuntu 镜像，增加了一个改动层，标签为 v0.0.1。标签可以为任意，当然一般用来记录版本信息。</p>\n<p>当然，如果你打算自己尝试的话，记得将我的名字 jbgo 替换为你自己在 Docker Hub 上的用户名。即便你没有 Docker Hub 账户，也要养成给镜像做签名的习惯。</p>\n<p>可以用如下命令检查当前的镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1867496279805269800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\njbgo/message        v0.0.1              1c9195e4c24c        18 seconds ago      188.3 MB\nubuntu              latest              b7cf8f0d9e82        4 days ago          188.3 MB`, `1867496279805269800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker images</span>\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\njbgo/message        v0.0.1              1c9195e4c24c        <span class="token number">18</span> seconds ago      <span class="token number">188.3</span> MB\nubuntu              latest              b7cf8f0d9e82        <span class="token number">4</span> days ago          <span class="token number">188.3</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们有两个镜像了：一个是原有的 ubuntu 镜像，镜像是我们在刚开始进行 docker run 的时候自动从 Docker Hub 上面下载下来的；另一个便是我们刚刚保存的，有一个 /message.txt 文件的镜像。</p>\n<p>不信？那我运行给你看。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21325312346036720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker run -it jbgo/message:v0.0.1 cat /message.txt\nhello docker\n这里我们并没有运行刚刚的 insane_wright 容器，而是运行了我们刚刚保存的镜像。\n我们确实把刚刚的容器保存为一个新的镜像了。`, `21325312346036720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker run -it jbgo/message:v0.0.1 cat /message.txt</span>\nhello docker\n这里我们并没有运行刚刚的 insane_wright 容器，而是运行了我们刚刚保存的镜像。\n我们确实把刚刚的容器保存为一个新的镜像了。</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还不信？那我检查给你看。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96224400755116180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\n01bd4c098203        jbgo/message:v0.0.1   &quot;cat /message.txt&quot;   10 seconds ago      Exited (0) 9 seconds ago                        hopeful_lovelace\nb3d8c3ef31a0        ubuntu:latest         &quot;cat /message.txt&quot;   33 minutes ago      Exited (1) 33 minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         &quot;/bin/bash&quot;          34 minutes ago      Exited (0) 15 minutes ago                       insane_wright`, `96224400755116180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\n01bd4c098203        jbgo/message:v0.0.1   <span class="token string">"cat /message.txt"</span>   <span class="token number">10</span> seconds ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">9</span> seconds ago                        hopeful_lovelace\nb3d8c3ef31a0        ubuntu:latest         <span class="token string">"cat /message.txt"</span>   <span class="token number">33</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">33</span> minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         <span class="token string">"/bin/bash"</span>          <span class="token number">34</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">15</span> minutes ago                       insane_wright</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>容器运行记录里面多了一个叫做 hopeful_lovelace 的容器，是运行 jdgo/message:v0.0.1 镜像而创建的这个容器。</p>\n<h2 id="如何备份镜像？"><a href="#%E5%A6%82%E4%BD%95%E5%A4%87%E4%BB%BD%E9%95%9C%E5%83%8F%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何备份镜像？</h2>\n<blockquote>\n<p>上面我们创建了带有一个 /message.txt 文件的镜像，也用它运行了容器，那么如果 Docker 宿主机崩溃了或者文件消失了怎么办？如何保证我们创建的镜像在系统崩溃后仍然不丢失？</p>\n</blockquote>\n<p>我们需要 Docker Registry，可以存储和下载镜像的地方。Docker Hub 官方提供了 Docker Hub Registry 让我们来存储镜像，当然我们也可以自己搭建 Docker Registry。本篇文章将会使用 Docker Hub Registry，如果你想按照本文中继续操作的话，记得将我的名字 jbgo 换成你自己在 Docker Hub 上的用户名。</p>\n<p>使用如下操作将镜像上传到 Docker Registry 上：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95427390543698740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker push jbgo/message\nThe push refers to a repository [jbgo/message] (len: 1)\n1c9195e4c24c: Image push failed\n\nPlease login prior to push:\nUsername: jbgo\nPassword:\nEmail: jordanbach@gmail.com\nWARNING: login credentials saved in /root/.dockercfg.\nLogin Succeeded\nThe push refers to a repository [jbgo/message] (len: 1)\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed\nDigest: sha256:b2a98b19e06a4df91150f8a2cd47a6e440cbc13b39f1fc235d46f97f631ad117`, `95427390543698740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker push jbgo/message</span>\nThe push refers to a repository <span class="token punctuation">[</span>jbgo/message<span class="token punctuation">]</span> <span class="token punctuation">(</span>len: <span class="token number">1</span><span class="token punctuation">)</span>\n1c9195e4c24c: Image push failed\n\nPlease login prior to push:\nUsername: jbgo\nPassword:\nEmail: jordanbach@gmail.com\nWARNING: login credentials saved <span class="token keyword">in</span> /root/.dockercfg.\nLogin Succeeded\nThe push refers to a repository <span class="token punctuation">[</span>jbgo/message<span class="token punctuation">]</span> <span class="token punctuation">(</span>len: <span class="token number">1</span><span class="token punctuation">)</span>\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed\nDigest: sha256:b2a98b19e06a4df91150f8a2cd47a6e440cbc13b39f1fc235d46f97f631ad117</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为我是第一次在本机执行 docker push 操作，所以 Docker Registry 需要验证我的身份。</p>\n<p>本次上传的镜像被保存在这里。你可以使用 docker pull jbgo/message 来下载我的镜像。</p>\n<p>当然，如果你按照上面的来操作的话，可能会出现一点小问题：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65991749187925385000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker pull jbgo/message\nPulling repository jbgo/message\nFATA[0007] Tag latest not found in repository jbgo/message`, `65991749187925385000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker pull jbgo/message</span>\nPulling repository jbgo/message\nFATA<span class="token punctuation">[</span>0007<span class="token punctuation">]</span> Tag latest not found <span class="token keyword">in</span> repository jbgo/message</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>下面我来解释一下到底出了什么问题：当你使用 docker push jbgo/message 命令的时候，默认上传标签为 latest 的镜像。如果没有便会报错。你可以采用如下命令解决： docker tag jbgo/message:v0.0.1 jbgo/message:latest。这次再尝试推送：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67761037695190820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker push jbgo/message:latest\nThe push refers to a repository [jbgo/message] (len: 1)\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image already exists\n2c014f14d3d9: Image already exists\na62a42e77c9c: Image already exists\n706766fe1019: Image already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3`, `67761037695190820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker push jbgo/message:latest</span>\nThe push refers to a repository <span class="token punctuation">[</span>jbgo/message<span class="token punctuation">]</span> <span class="token punctuation">(</span>len: <span class="token number">1</span><span class="token punctuation">)</span>\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image already exists\n2c014f14d3d9: Image already exists\na62a42e77c9c: Image already exists\n706766fe1019: Image already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这次上传会快得多，因为服务器上已经有了这个镜像，我们上传的仅仅是相同镜像的不同标签而已。</p>\n<p>你不信？那我验证给你看：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18120456509932747000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker pull jbgo/message\nlatest: Pulling from jbgo/message\n1c9195e4c24c: Already exists\n706766fe1019: Already exists\na62a42e77c9c: Already exists\n2c014f14d3d9: Already exists\nb7cf8f0d9e82: Already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3\nStatus: Downloaded newer image for jbgo/message:latest`, `18120456509932747000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker pull jbgo/message</span>\nlatest: Pulling from jbgo/message\n1c9195e4c24c: Already exists\n706766fe1019: Already exists\na62a42e77c9c: Already exists\n2c014f14d3d9: Already exists\nb7cf8f0d9e82: Already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3\nStatus: Downloaded newer image <span class="token keyword">for</span> jbgo/message:latest</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然，别台服务器一样可以使用这个命令下载我的镜像。</p>\n<p>当然，也可以使用如下命令上传特定标签的镜像：docker push jbgo/message:v0.0.1。建议使用版本标签标记镜像，并推送特定版本标签的镜像和 latest 标签的镜像。</p>\n<h2 id="使用完毕的容器如何处理？"><a href="#%E4%BD%BF%E7%94%A8%E5%AE%8C%E6%AF%95%E7%9A%84%E5%AE%B9%E5%99%A8%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用完毕的容器如何处理？</h2>\n<blockquote>\n<p>上面只是介绍了容器如何理解容器和镜像，如果有很多历史容器被保存在硬盘上，想要释放掉这些空间，我们应该怎么做？</p>\n</blockquote>\n<p>使用如下命令删除多个容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72291781625820750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker rm hopeful_lovelace insane_wright admiring_lalande\nhopeful_lovelace\ninsane_wright\nadmiring_lalande`, `72291781625820750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker rm hopeful_lovelace insane_wright admiring_lalande</span>\nhopeful_lovelace\ninsane_wright\nadmiring_lalande</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在再检查一下还有没有这些容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87320210881873480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES`, `87320210881873480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>我们运行的所有容器和所有的历史容器都会被保存在硬盘上，除非你手动 docker rm 它们。手动删除的容器不能恢复。</p>\n<h2 id="为什么上传了不止一个镜像？"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8A%E4%BC%A0%E4%BA%86%E4%B8%8D%E6%AD%A2%E4%B8%80%E4%B8%AA%E9%95%9C%E5%83%8F%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么上传了不止一个镜像？</h2>\n<p>有心人注意到，刚刚我们第一次上传 jbgo/message 镜像的时候，Docker 上传了不止一个镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16104065841700565000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker push jbgo/message:v0.0.1\n...\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed`, `16104065841700565000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker push jbgo/message:v0.0.1</span>\n<span class="token punctuation">..</span>.\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="到底发生了什么？"><a href="#%E5%88%B0%E5%BA%95%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>到底发生了什么？</h2>\n<p>首先使用 docker history 检查一下镜像改动历史：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8967152900329767000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker history jbgo/message:v0.0.1\nIMAGE               CREATED             CREATED BY                                      SIZE\n1c9195e4c24c        33 minutes ago      /bin/bash                                       108 B\nb7cf8f0d9e82        4 days ago          /bin/sh -c #(nop) CMD [&quot;/bin/bash&quot;]             0 B\n2c014f14d3d9        4 days ago          /bin/sh -c sed -i \'s/^#\\s*\\(deb.*universe\\)\\$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'#!/bin/sh\' > /usr/sbin/polic   194.5 kB\n706766fe1019        4 days ago          /bin/sh -c #(nop) ADD file:777fad733fc954c0c1   188.1 MB`, `8967152900329767000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker history jbgo/message:v0.0.1</span>\nIMAGE               CREATED             CREATED BY                                      SIZE\n1c9195e4c24c        <span class="token number">33</span> minutes ago      /bin/bash                                       <span class="token number">108</span> B\nb7cf8f0d9e82        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) CMD ["/bin/bash"]             0 B</span>\n2c014f14d3d9        <span class="token number">4</span> days ago          /bin/sh -c <span class="token function">sed</span> -i <span class="token string">\'s/^#\\s*\\(deb.*universe\\)$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'</span><span class="token comment">#!/bin/sh\' > /usr/sbin/polic   194.5 kB</span>\n706766fe1019        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) ADD file:777fad733fc954c0c1   188.1 MB</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>会发现，其实我们创建了不止一个镜像，也就是有不止一个改动层。使用 docker inspect 命令仔细观察第一个镜像（第一层）进行过的改动：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="622724721753043000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker inspect 1c9195e4c24c\n[{\n    &quot;Architecture&quot;: &quot;amd64&quot;,\n    &quot;Author&quot;: &quot;Jordan Bach&quot;,\n    &quot;Comment&quot;: &quot;saved my message&quot;,\n    &quot;Config&quot;: {`, `622724721753043000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker inspect 1c9195e4c24c</span>\n<span class="token punctuation">[</span><span class="token punctuation">{</span>\n    <span class="token string">"Architecture"</span><span class="token builtin class-name">:</span> <span class="token string">"amd64"</span>,\n    <span class="token string">"Author"</span><span class="token builtin class-name">:</span> <span class="token string">"Jordan Bach"</span>,\n    <span class="token string">"Comment"</span><span class="token builtin class-name">:</span> <span class="token string">"saved my message"</span>,\n    <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个肯定就是我们的 /message.txt 改动层了，那么其他的那么多是什么？</p>\n<p>jbgo/message 是基于 ubuntu 镜像的，我们来检查一下 ubuntu 镜像的改动历史：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45906775421318320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker history ubuntu\nIMAGE               CREATED             CREATED BY                                      SIZE\nb7cf8f0d9e82        4 days ago          /bin/sh -c #(nop) CMD [&quot;/bin/bash&quot;]             0 B\n2c014f14d3d9        4 days ago          /bin/sh -c sed -i \'s/^#\\s*\\(deb.*universe\\)\\$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'#!/bin/sh\' > /usr/sbin/polic   194.5 kB\n706766fe1019        4 days ago          /bin/sh -c #(nop) ADD file:777fad733fc954c0c1   188.1 MB`, `45906775421318320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker history ubuntu</span>\nIMAGE               CREATED             CREATED BY                                      SIZE\nb7cf8f0d9e82        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) CMD ["/bin/bash"]             0 B</span>\n2c014f14d3d9        <span class="token number">4</span> days ago          /bin/sh -c <span class="token function">sed</span> -i <span class="token string">\'s/^#\\s*\\(deb.*universe\\)$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'</span><span class="token comment">#!/bin/sh\' > /usr/sbin/polic   194.5 kB</span>\n706766fe1019        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) ADD file:777fad733fc954c0c1   188.1 MB</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么这样一切就很明确了：那些是 ubuntu 镜像的改动历史。为了确保本地和上传到 Docker Hub 的镜像一致，我们上传到 Docker Hub 中的镜像便是包含着五层改动层的新镜像。</p>\n<h2 id="如何删除镜像？"><a href="#%E5%A6%82%E4%BD%95%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何删除镜像？</h2>\n<blockquote>\n<p>前面提到过，我们删除容器，那么我们本机上仍然保存着镜像，如何删掉它们？</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82230864678880280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`（HOST） # docker rmi jbgo/message\nError response from daemon: Conflict, cannot delete 1c9195e4c24c because the container 2ea39e64a130 is using it, use -f to force\nFATA[0000] Error: failed to remove one or more images`, `82230864678880280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">（HOST） <span class="token comment"># docker rmi jbgo/message</span>\nError response from daemon: Conflict, cannot delete 1c9195e4c24c because the container 2ea39e64a130 is using it, use -f to force\nFATA<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> Error: failed to remove one or <span class="token function">more</span> images</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>提示出错了，根据错误信息可以看出，还有容器在用这一个镜像。</p>\n<p>但是我们没有正在运行着的容器啊，到底哪儿出错了？</p>\n<p>检查所有容器，发现容器 2ea39e64a130。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71050278724626300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                     PORTS               NAMES\n2ea39e64a130        jbgo/message:latest   &quot;cat /message.txt&quot;   2 minutes ago       Exited (0) 2 minutes ago                       lonely_jones`, `71050278724626300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                     PORTS               NAMES\n2ea39e64a130        jbgo/message:latest   <span class="token string">"cat /message.txt"</span>   <span class="token number">2</span> minutes ago       Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> minutes ago                       lonely_jones</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当然，这是 Docker 的机制：如果你仍然有容器的历史记录，那么为了确保你能再次启动这个容器，这些镜像是不能删除的。</p>\n<p>首先删除掉这个容器：docker rm lonely_jones。</p>\n<p>然后删除镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57036282959852970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker rmi jbgo/message\nUntagged: jbgo/message:latest\nDeleted: 1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409\nDeleted: b7cf8f0d9e82c9d96bd7afd22c600bfdb86b8d66c50d29164e5ad2fb02f7187b\nDeleted: 2c014f14d3d95811df672ddae2af376f9557f6b8f5623e3e3f8c5ca3f6ff42e6\nDeleted: a62a42e77c9c3626118dc411092d23cf658220261acdafe21a7589a8eeba627e\nDeleted: 706766fe101906a1a6628173c2677173a5f8c6c469075083f3cf3a8f5e5eb367`, `57036282959852970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker rmi jbgo/message</span>\nUntagged: jbgo/message:latest\nDeleted: 1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409\nDeleted: b7cf8f0d9e82c9d96bd7afd22c600bfdb86b8d66c50d29164e5ad2fb02f7187b\nDeleted: 2c014f14d3d95811df672ddae2af376f9557f6b8f5623e3e3f8c5ca3f6ff42e6\nDeleted: a62a42e77c9c3626118dc411092d23cf658220261acdafe21a7589a8eeba627e\nDeleted: 706766fe101906a1a6628173c2677173a5f8c6c469075083f3cf3a8f5e5eb367</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这次我们可以很轻松地删除掉 jbgo/message 镜像了。确认一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39697808725848250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE`, `39697808725848250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker images</span>\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>确实没了。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Docker初步了解/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2017-12-11 23:32:56",path:"/docker-know/",tags:"后端, Docker, Docker初级入门",title:"Docker初步了解",draft:null}}],page:45,pagesSum:47,length:233,prevPath:"/page/44",nextPath:"/page/46"}}}});