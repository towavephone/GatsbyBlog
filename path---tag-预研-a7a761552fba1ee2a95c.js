webpackJsonp([3112546720375],{1678:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"背景 网页在不同平台上展示的布局不一致，需要改成类似等比缩放的效果以便在各平台显示 选型 主流方案 官网方案 实现 核心逻辑 使用 postcss-px-to-viewport 插件，将 src 以及三方库(node_modules)下的所有样式文件   里面的 px 单位转换到 rem 单位 在公共样式下根据媒体查询（屏幕宽度 or 屏幕 dpi）设置每种字体的大小 由于目前插件不能转换非样式文件里面的 px 单位，所以需要写两种公共样式，这里会通过 url…",html:'<h1 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h1>\n<p>网页在不同平台上展示的布局不一致，需要改成类似等比缩放的效果以便在各平台显示</p>\n<h1 id="选型"><a href="#%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型</h1>\n<ol>\n<li><a href="/mobile-page-adaptation/">主流方案</a></li>\n<li><a href="/international-official-website-technical-difficulties/#%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%80%82%E9%85%8D">官网方案</a></li>\n</ol>\n<h1 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h1>\n<h2 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h2>\n<ol>\n<li>\n<p>使用 postcss-px-to-viewport 插件，将 src 以及三方库(node_modules)下的所有样式文件 <code class="language-text">(*.css|*.module.css|*.less|*.module.less)</code> 里面的 px 单位转换到 rem 单位</p>\n</li>\n<li>\n<p>在公共样式下根据媒体查询（屏幕宽度 or 屏幕 dpi）设置每种字体的大小</p>\n</li>\n<li>\n<p>由于目前插件不能转换非样式文件里面的 px 单位，所以需要写两种公共样式，这里会通过 url 来决定哪种生效</p>\n<ol>\n<li>需要等比缩放的，根据屏幕宽度改变字体大小（新页面，即此次重构页面）</li>\n<li>需要固定大小的，固定设置为 1920 下的字体大小（老页面）</li>\n</ol>\n</li>\n</ol>\n<p>重构目标：重构页面采用等比缩放，老页面维持固定大小，注意上线之后所有非样式代码即 js 文件里面禁止使用 px 单位，需要手动转换为 rem 单位，转换公式为 px 大小 / 10</p>\n<p>最终目标：所有页面统一采用等比缩放 （即将 js 代码里面的 px 单位全部改为 rem 单位，三方库里面的 js 代码暂不考虑，之后才能全部采用此方案）</p>\n<h2 id="postcssconfigjs（插件转换-px-为-rem）"><a href="#postcssconfigjs%EF%BC%88%E6%8F%92%E4%BB%B6%E8%BD%AC%E6%8D%A2-px-%E4%B8%BA-rem%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>postcss.config.js（插件转换 px 为 rem）</h2>\n<h3 id="配置分离"><a href="#%E9%85%8D%E7%BD%AE%E5%88%86%E7%A6%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置分离</h3>\n<p>由于想让 cra 使用 postcss.config.js 的配置（cra 默认不使用），在 cra 5 版本和 customize-cra 情况下，addPostcssPlugins <a href="https://github.com/arackaf/customize-cra/issues/327#issuecomment-1210459104" target="_blank" rel="nofollow noreferrer noopener">不起作用</a>，有 2 种方式可以解决</p>\n<ol>\n<li>\n<p>重写 addPostcssPlugins</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93072216571164330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const addPostcssPlugins = (plugins) => (config) => {\n  const rules = config.module.rules.find((rule) => Array.isArray(rule.oneOf)).oneOf;\n  rules.forEach(\n     (r) =>\n        r.use &&\n        r.use.forEach((u) => {\n           if (u.options && u.options.ident === \'postcss\') {\n              const postcssOptions = {\n                 ident: \'postcss\',\n                 config: false\n              };\n              if (!u.options.plugins) {\n                 // u.options.plugins = () => [...plugins]\n                 postcssOptions.plugins = plugins;\n              } else {\n                 // const originalPlugins = u.options.plugins\n                 // u.options.plugins = () => [...originalPlugins(), ...plugins]\n                 postcssOptions.plugins = plugins;\n              }\n\n              delete u.options.plugins;\n              delete u.options.ident;\n\n              u.options.postcssOptions = postcssOptions;\n           } else if (u.options && u.options.postcssOptions && u.options.postcssOptions.ident === \'postcss\') {\n              if (!u.options.postcssOptions.plugins) {\n                 u.options.postcssOptions.plugins = plugins;\n              } else {\n                 const originalPlugins = u.options.postcssOptions.plugins;\n                 u.options.postcssOptions.plugins = [...originalPlugins, ...plugins];\n              }\n           }\n        })\n  );\n  return config;\n};`, `93072216571164330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">addPostcssPlugins</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plugins</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> rules <span class="token operator">=</span> config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=></span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>oneOf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>oneOf<span class="token punctuation">;</span>\n  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>\n     <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n        r<span class="token punctuation">.</span>use <span class="token operator">&amp;&amp;</span>\n        r<span class="token punctuation">.</span>use<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">u</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n           <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">const</span> postcssOptions <span class="token operator">=</span> <span class="token punctuation">{</span>\n                 ident<span class="token punctuation">:</span> <span class="token string">\'postcss\'</span><span class="token punctuation">,</span>\n                 config<span class="token punctuation">:</span> <span class="token boolean">false</span>\n              <span class="token punctuation">}</span><span class="token punctuation">;</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                 <span class="token comment">// u.options.plugins = () => [...plugins]</span>\n                 postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins<span class="token punctuation">;</span>\n              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n                 <span class="token comment">// const originalPlugins = u.options.plugins</span>\n                 <span class="token comment">// u.options.plugins = () => [...originalPlugins(), ...plugins]</span>\n                 postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins<span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">;</span>\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>\n\n              u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions <span class="token operator">=</span> postcssOptions<span class="token punctuation">;</span>\n           <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                 u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> plugins<span class="token punctuation">;</span>\n              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n                 <span class="token keyword">const</span> originalPlugins <span class="token operator">=</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins<span class="token punctuation">;</span>\n                 u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>originalPlugins<span class="token punctuation">,</span> <span class="token operator">...</span>plugins<span class="token punctuation">]</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n           <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> config<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>去掉相关配置，<a href="https://github.com/arackaf/customize-cra/issues/327#issuecomment-1371815281" target="_blank" rel="nofollow noreferrer noopener">依赖 postcss.config.js</a></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77299418943656330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const enablePostcssRc = () => (config) => {\n  const rules = config.module.rules.find((rule) => Array.isArray(rule.oneOf)).oneOf;\n  rules.forEach(\n     (r) =>\n        r.use &&\n        r.use.forEach((u) => {\n           if (u.options && u.options.ident === \'postcss\') {\n              delete u.options.ident;\n              if (u.options.plugins) {\n                 delete u.options.plugins; // 删除 plugins 属性，使用 postcss.config.js 中的配置\n              }\n           }\n\n           if (u.options && u.options.postcssOptions && u.options.postcssOptions.ident === \'postcss\') {\n              delete u.options.postcssOptions;\n           }\n        })\n  );\n  return config;\n};`, `77299418943656330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">enablePostcssRc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> rules <span class="token operator">=</span> config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=></span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>oneOf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>oneOf<span class="token punctuation">;</span>\n  rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>\n     <span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n        r<span class="token punctuation">.</span>use <span class="token operator">&amp;&amp;</span>\n        r<span class="token punctuation">.</span>use<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">u</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n           <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                 <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">;</span> <span class="token comment">// 删除 plugins 属性，使用 postcss.config.js 中的配置</span>\n              <span class="token punctuation">}</span>\n           <span class="token punctuation">}</span>\n\n           <span class="token keyword">if</span> <span class="token punctuation">(</span>u<span class="token punctuation">.</span>options <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">.</span>ident <span class="token operator">===</span> <span class="token string">\'postcss\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">delete</span> u<span class="token punctuation">.</span>options<span class="token punctuation">.</span>postcssOptions<span class="token punctuation">;</span>\n           <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> config<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>采用方案二</p>\n<h3 id="rspack-适配"><a href="#rspack-%E9%80%82%E9%85%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rspack 适配</h3>\n<p>rule 需要添加以下规则来兼容业务代码/三方库的样式文件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72893507550230160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   module: {\n      rules: [\n         {\n            test: /\\.css\\$/,\n            exclude: /\\.module\\.css\\$/,\n            use: [\'postcss-loader\'],\n            type: \'css\'\n         },\n         {\n            test: /\\.module\\.css\\$/,\n            use: [\'postcss-loader\'],\n            type: \'css/module\'\n         },\n         {\n            test: /\\.less\\$/,\n            exclude: /\\.module\\.less\\$/,\n            use: [\n               \'postcss-loader\',\n               {\n                  loader: \'less-loader\',\n                  options: {\n                     lessOptions: { javascriptEnabled: true }\n                  }\n               }\n            ],\n            type: \'css\'\n         },\n         {\n            test: /\\.module\\.less\\$/,\n            use: [\n               \'postcss-loader\',\n               {\n                  loader: \'less-loader\',\n                  options: {\n                     lessOptions: { javascriptEnabled: true }\n                  }\n               }\n            ],\n            type: \'css/module\'\n         }\n      ];\n   }\n}`, `72893507550230160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>\n   module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.css$/</span><span class="token punctuation">,</span>\n            exclude<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.css$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'postcss-loader\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.css$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'postcss-loader\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css/module\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.less$/</span><span class="token punctuation">,</span>\n            exclude<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.less$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n               <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n               <span class="token punctuation">{</span>\n                  loader<span class="token punctuation">:</span> <span class="token string">\'less-loader\'</span><span class="token punctuation">,</span>\n                  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.module\\.less$/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n               <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n               <span class="token punctuation">{</span>\n                  loader<span class="token punctuation">:</span> <span class="token string">\'less-loader\'</span><span class="token punctuation">,</span>\n                  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css/module\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="配置代码"><a href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置代码</h3>\n<p>postcss.config.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38255398585799790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n   plugins: [\n      \'postcss-flexbugs-fixes\',\n      [\n         \'postcss-preset-env\',\n         {\n            autoprefixer: {\n               flexbox: \'no-2009\'\n            },\n            stage: 3\n         }\n      ],\n      \'postcss-normalize\',\n      [\n         \'postcss-px-to-viewport\',\n         {\n            // https://github.com/evrone/postcss-px-to-viewport/blob/master/README_CN.md\n            unitToConvert: \'px\', // 需要转换的单位，默认为&quot;px&quot;\n            viewportWidth: 1000, // 视窗的宽度，对应设计稿的宽度\n            unitPrecision: 8, // 指定 px 转换为视窗单位值的小数后 x 位数，转换精度尽可能的大，防止出现图片比例问题\n            viewportUnit: \'rem\', // 希望使用的视口单位\n            fontViewportUnit: \'rem\', // 字体使用的视口单位\n            minPixelValue: 1, // 最小的转换数值\n            mediaQuery: true, // 媒体查询里的单位是否需要转换单位\n            selectorBlackList: [/^html\\$/, \'hack\'] // 需要忽略的 CSS 选择器，不会转为视口单位，使用原有的 px 等单位\n            // include: /\\/src\\//\n            // exclude: /node_modules/,\n         }\n      ]\n   ]\n};`, `38255398585799790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token string">\'postcss-flexbugs-fixes\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span>\n         <span class="token string">\'postcss-preset-env\'</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            autoprefixer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n               flexbox<span class="token punctuation">:</span> <span class="token string">\'no-2009\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            stage<span class="token punctuation">:</span> <span class="token number">3</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token string">\'postcss-normalize\'</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span>\n         <span class="token string">\'postcss-px-to-viewport\'</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            <span class="token comment">// https://github.com/evrone/postcss-px-to-viewport/blob/master/README_CN.md</span>\n            unitToConvert<span class="token punctuation">:</span> <span class="token string">\'px\'</span><span class="token punctuation">,</span> <span class="token comment">// 需要转换的单位，默认为"px"</span>\n            viewportWidth<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 视窗的宽度，对应设计稿的宽度</span>\n            unitPrecision<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// 指定 px 转换为视窗单位值的小数后 x 位数，转换精度尽可能的大，防止出现图片比例问题</span>\n            viewportUnit<span class="token punctuation">:</span> <span class="token string">\'rem\'</span><span class="token punctuation">,</span> <span class="token comment">// 希望使用的视口单位</span>\n            fontViewportUnit<span class="token punctuation">:</span> <span class="token string">\'rem\'</span><span class="token punctuation">,</span> <span class="token comment">// 字体使用的视口单位</span>\n            minPixelValue<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 最小的转换数值</span>\n            mediaQuery<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 媒体查询里的单位是否需要转换单位</span>\n            selectorBlackList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/^html$/</span><span class="token punctuation">,</span> <span class="token string">\'hack\'</span><span class="token punctuation">]</span> <span class="token comment">// 需要忽略的 CSS 选择器，不会转为视口单位，使用原有的 px 等单位</span>\n            <span class="token comment">// include: /\\/src\\//</span>\n            <span class="token comment">// exclude: /node_modules/,</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span>\n   <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="commonless（缩放规则）"><a href="#commonless%EF%BC%88%E7%BC%A9%E6%94%BE%E8%A7%84%E5%88%99%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>common.less（缩放规则）</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90010753161197600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 固定大小的页面\n.hackFixedPage {\n   font-size: 10px;\n}\n\n// 等比缩放的页面\n.hackResponsivePage {\n   // 大于 1500px (10px)\n   @media screen and (min-width: 1501px) {\n      font-size: 10px;\n   }\n\n   // 1300px～1500px 的宽度区间的根字号大小是某个范围（8px～10px）\n   @media screen and (min-width: 1300px) and (max-width: 1500px) {\n      font-size: calc(8px + 2 * (100vw - 1300px) / 200);\n   }\n\n   // 小于 1300px 的屏幕宽度，固定根字号大小（8px）\n   @media screen and (max-width: 1299px) {\n      font-size: 8px;\n   }\n}`, `90010753161197600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="less"\n              >\n                <span class="gatsby-code-button-language">less</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="less"><pre style="counter-reset: linenumber NaN" class="language-less line-numbers"><code class="language-less"><span class="token comment">// 固定大小的页面</span>\n<span class="token selector">.hackFixedPage</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 等比缩放的页面</span>\n<span class="token selector">.hackResponsivePage</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 大于 1500px (10px)</span>\n   <span class="token atrule">@media screen and <span class="token punctuation">(</span>min-width<span class="token punctuation">:</span> 1501px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token comment">// 1300px～1500px 的宽度区间的根字号大小是某个范围（8px～10px）</span>\n   <span class="token atrule">@media screen and <span class="token punctuation">(</span>min-width<span class="token punctuation">:</span> 1300px<span class="token punctuation">)</span> and <span class="token punctuation">(</span>max-width<span class="token punctuation">:</span> 1500px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>8px <span class="token operator">+</span> 2 <span class="token operator">*</span> <span class="token punctuation">(</span>100vw <span class="token operator">-</span> 1300px<span class="token punctuation">)</span> <span class="token operator">/</span> 200<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token comment">// 小于 1300px 的屏幕宽度，固定根字号大小（8px）</span>\n   <span class="token atrule">@media screen and <span class="token punctuation">(</span>max-width<span class="token punctuation">:</span> 1299px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实际使用"><a href="#%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实际使用</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52406740093730095000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.hintIcon {\n   font-size: 14px; // 实际转换为 14 / 10 = 1.4rem\n   margin-left: 8px; // 实际转换为 8 / 10 = 0.8rem\n   vertical-align: 1px; // 不做转换\n}`, `52406740093730095000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="less"\n              >\n                <span class="gatsby-code-button-language">less</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="less"><pre style="counter-reset: linenumber NaN" class="language-less line-numbers"><code class="language-less"><span class="token selector">.hintIcon</span> <span class="token punctuation">{</span>\n   <span class="token property">font-size</span><span class="token punctuation">:</span> 14px<span class="token punctuation">;</span> <span class="token comment">// 实际转换为 14 / 10 = 1.4rem</span>\n   <span class="token property">margin-left</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span> <span class="token comment">// 实际转换为 8 / 10 = 0.8rem</span>\n   <span class="token property">vertical-align</span><span class="token punctuation">:</span> 1px<span class="token punctuation">;</span> <span class="token comment">// 不做转换</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="三方库非样式文件单位转换"><a href="#%E4%B8%89%E6%96%B9%E5%BA%93%E9%9D%9E%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6%E5%8D%95%E4%BD%8D%E8%BD%AC%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>三方库非样式文件单位转换</h1>\n<p>在上面适配规则上线之后，发现有的三方库不能正确的缩放，导致页面看起来不协调，以下是各个三方库的修复</p>\n<h2 id="pro-components"><a href="#pro-components" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pro components</h2>\n<p>参考<a href="https://github.com/ant-design/cssinjs?tab=readme-ov-file" target="_blank" rel="nofollow noreferrer noopener">文档</a>，对应<a href="https://github.com/ant-design/cssinjs/blob/master/src/transformers/px2rem.ts" target="_blank" rel="nofollow noreferrer noopener">源码</a>，可以看出是运行时的单位转换</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36238297750511084000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { px2remTransformer, StyleProvider } from \'@ant-design/cssinjs\';\n\nconst StyleHoc = ({ children }) => {\n   // 和上面的 postcss-px-to-viewport 的适配策略保持一致\n   // 以 10 为根字体大小进行转换，保留 8 位小数，媒体查询下也进行转换\n   return (\n      <StyleProvider transformers={[px2remTransformer({ rootValue: 10, precision: 8, mediaQuery: true })]}>\n         {children}\n      </StyleProvider>\n   );\n};`, `36238297750511084000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> px2remTransformer<span class="token punctuation">,</span> StyleProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ant-design/cssinjs\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">StyleHoc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token comment">// 和上面的 postcss-px-to-viewport 的适配策略保持一致</span>\n   <span class="token comment">// 以 10 为根字体大小进行转换，保留 8 位小数，媒体查询下也进行转换</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>StyleProvider transformers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token function">px2remTransformer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> rootValue<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> mediaQuery<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">></span>\n         <span class="token punctuation">{</span>children<span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>StyleProvider<span class="token operator">></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="mui"><a href="#mui" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>mui</h2>\n<p>参考<a href="https://v5.mui.com/material-ui/customization/theming/" target="_blank" rel="nofollow noreferrer noopener">文档</a></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22708623197848277000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { createTheme, ThemeProvider } from \'@mui/material/styles\';\n\nconst theme = createTheme({\n   // 和上面的 postcss-px-to-viewport 的适配策略保持一致\n   // 以 10 为根字体大小进行转换\n   typography: {\n      pxToRem: (size) => \\`\\${size / 10}rem\\`\n   }\n});\n\nconst ThemeHoc = ({ children }) => {\n   return <ThemeProvider theme={theme}>{children}</ThemeProvider>;\n};`, `22708623197848277000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> createTheme<span class="token punctuation">,</span> ThemeProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@mui/material/styles\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">createTheme</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token comment">// 和上面的 postcss-px-to-viewport 的适配策略保持一致</span>\n   <span class="token comment">// 以 10 为根字体大小进行转换</span>\n   typography<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function-variable function">pxToRem</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size <span class="token operator">/</span> <span class="token number">10</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rem</span><span class="token template-punctuation string">`</span></span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">ThemeHoc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeProvider theme<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ThemeProvider<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/前端多平台页面适配/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2025-10-27 11:43:35",path:"/frontend-multi-platform-page-adaptation/",tags:"前端, 页面适配, 预研",title:"前端多平台页面适配",draft:null}},{excerpt:"背景 统计线上用户各个功能的使用情况，以便后续针对性的优化 实现 前端 使用  https://github.com/nytimes/react-tracking  三方库埋点 使用 sendBeacon 异步发送埋点信息 埋点信息默认发送 location，type（默认为 enter，即进入页面类型），create_by（埋点触发人） utils/sendReport.js index.js 后端 数据库表 web_track 记录了以下字段 用户(create_by…",html:'<h1 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h1>\n<p>统计线上用户各个功能的使用情况，以便后续针对性的优化</p>\n<h1 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h1>\n<h2 id="前端"><a href="#%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端</h2>\n<ol>\n<li>使用 <a href="https://github.com/nytimes/react-tracking" target="_blank" rel="nofollow noreferrer noopener">https://github.com/nytimes/react-tracking</a> 三方库埋点</li>\n<li>使用 sendBeacon 异步发送埋点信息</li>\n<li>埋点信息默认发送 location，type（默认为 enter，即进入页面类型），create_by（埋点触发人）</li>\n</ol>\n<p>utils/sendReport.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66335878561634850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function sendBeacon(url, data) {\n   if (!navigator.sendBeacon) {\n      return false;\n   }\n\n   return navigator.sendBeacon(url, data);\n}\n\nexport default function sendReport(data) {\n   const newData = new FormData();\n   newData.append(\'data\', JSON.stringify(data));\n   return sendBeacon(\'/web_track/send/\', newData);\n}`, `66335878561634850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>sendBeacon<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">return</span> navigator<span class="token punctuation">.</span><span class="token function">sendBeacon</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">sendReport</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> newData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   newData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token function">sendBeacon</span><span class="token punctuation">(</span><span class="token string">\'/web_track/send/\'</span><span class="token punctuation">,</span> newData<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77971317906188700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { pick } from \'lodash\'\n\nimport sendReport from \'./utils/sendReport\';\n\nconst isProd = process.env.NODE_ENV === \'production\';\n\nconst TrackHoc = ({ children }) => {\n   const { Track } = useTracking(\n      () => ({\n         location: pick(window.location, [\'origin\', \'hash\', \'href\']),\n         type: \'enter\', // 默认值\n         create_by: \'当前登录用户或者不传根据 cookie 来判断用户\'\n      }),\n      {\n         dispatch: (data) => {\n            console.log(\'tracking\', data);\n            // 不是正式环境不上传埋点数据\n            if (!isProd) {\n               return;\n            }\n            sendReport(data);\n         }\n      }\n   );\n\n   return <Track>{children}</Track>\n};`, `77971317906188700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> pick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'lodash\'</span>\n\n<span class="token keyword">import</span> sendReport <span class="token keyword">from</span> <span class="token string">\'./utils/sendReport\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> isProd <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">TrackHoc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> Track <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTracking</span><span class="token punctuation">(</span>\n      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n         location<span class="token punctuation">:</span> <span class="token function">pick</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'origin\'</span><span class="token punctuation">,</span> <span class="token string">\'hash\'</span><span class="token punctuation">,</span> <span class="token string">\'href\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'enter\'</span><span class="token punctuation">,</span> <span class="token comment">// 默认值</span>\n         create_by<span class="token punctuation">:</span> <span class="token string">\'当前登录用户或者不传根据 cookie 来判断用户\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         <span class="token function-variable function">dispatch</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'tracking\'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token comment">// 不是正式环境不上传埋点数据</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token function">sendReport</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token operator">&lt;</span>Track<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Track<span class="token operator">></span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="后端"><a href="#%E5%90%8E%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后端</h2>\n<p>数据库表 web_track 记录了以下字段</p>\n<ol>\n<li>用户(create_by)</li>\n<li>访问信息(location)</li>\n<li>对应页面(page)</li>\n<li>对应功能(function)</li>\n<li>埋点类型(type，目前有 enter/click 两类，对应进入页面/事件点击)</li>\n</ol>\n<h1 id="使用方式"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方式</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88998040554921900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { useTracking } from \'react-tracking\';\n\n// 在函数组件使用，进入页面触发专用\nuseTracking({ page: \'human_driver_compare\' }, { dispatchOnMount: true });\n\n// 在函数组件使用，事件触发专用\nconst { trackEvent, Track } = useTracking({ page: \'job_detail\' });\n// 这里使用 Track 高阶组件包裹之后，孙子组件调用 trackEvent 时候就会合并父级 data（当然这里的 trackEvent 触发也会合并），即孙子组件不需要在重复 page: \'job_detail\'，默认 type 为 enter\nreturn <Track>{children}</Track>;\n\n// 在类组件中使用，装饰器装饰之后 props 就带有 tracking 属性\n@track()\nexport default class Statistic extends React.Component {\n   handleShowSummaryClick = (e) => {\n      const { checked } = e.target;\n      this.setState({ show_summary: checked });\n      if (checked) {\n         // 事件触发\n         this.props.tracking.trackEvent({ function: \'show_summary\', type: \'click\' });\n      }\n   };\n\n   // 点击事件触发，即调用这个函数就触发，注意和上面的触发逻辑不同\n   @track({ function: \'show_summary\', type: \'click\' })\n   handleShowSummaryClick = (e) => {\n      const { checked } = e.target;\n      this.setState({ show_summary: checked });\n   };\n}`, `88998040554921900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> useTracking <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-tracking\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在函数组件使用，进入页面触发专用</span>\n<span class="token function">useTracking</span><span class="token punctuation">(</span><span class="token punctuation">{</span> page<span class="token punctuation">:</span> <span class="token string">\'human_driver_compare\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> dispatchOnMount<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在函数组件使用，事件触发专用</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> trackEvent<span class="token punctuation">,</span> Track <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTracking</span><span class="token punctuation">(</span><span class="token punctuation">{</span> page<span class="token punctuation">:</span> <span class="token string">\'job_detail\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 这里使用 Track 高阶组件包裹之后，孙子组件调用 trackEvent 时候就会合并父级 data（当然这里的 trackEvent 触发也会合并），即孙子组件不需要在重复 page: \'job_detail\'，默认 type 为 enter</span>\n<span class="token keyword">return</span> <span class="token operator">&lt;</span>Track<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>Track<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在类组件中使用，装饰器装饰之后 props 就带有 tracking 属性</span>\n@<span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Statistic</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n   <span class="token function-variable function">handleShowSummaryClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> checked <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> show_summary<span class="token punctuation">:</span> checked <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// 事件触发</span>\n         <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>tracking<span class="token punctuation">.</span><span class="token function">trackEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">function</span><span class="token punctuation">:</span> <span class="token string">\'show_summary\'</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">\'click\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 点击事件触发，即调用这个函数就触发，注意和上面的触发逻辑不同</span>\n   @<span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">function</span><span class="token punctuation">:</span> <span class="token string">\'show_summary\'</span><span class="token punctuation">,</span> type<span class="token punctuation">:</span> <span class="token string">\'click\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>\n   <span class="token function-variable function">handleShowSummaryClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> checked <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> show_summary<span class="token punctuation">:</span> checked <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>之后使用 redash 读取 mongo 数据库进行统计</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/React 前端埋点选型/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2025-10-27 11:17:30",path:"/react-frontend-tracking-selection/",tags:"前端, 埋点, 预研",title:"React 前端埋点选型",draft:null}},{excerpt:"背景 前端页面需要量化页面性能，以此来说明优化前后的效果 选型 本地 选型 Star 数 最后代码提交时间 优点 缺点 截图 实现效果 备注 Chrome DevTools Performance 面板 无 无 浏览器自带 只能简单的说明性能 Performance API（window.performance） 无 无 浏览器原生方法 需要自己写代码来生成报告 Lighthouse 29.2K 2025-08-05 浏览器自带，很快可以出报告 1. 需要用隐私模式打开排除干扰 2. CLI…",html:'<h1 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h1>\n<p>前端页面需要量化页面性能，以此来说明优化前后的效果</p>\n<h1 id="选型"><a href="#%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型</h1>\n<h2 id="本地"><a href="#%E6%9C%AC%E5%9C%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>本地</h2>\n<table>\n<thead>\n<tr>\n<th>选型</th>\n<th>Star 数</th>\n<th>最后代码提交时间</th>\n<th>优点</th>\n<th>缺点</th>\n<th>截图</th>\n<th>实现效果</th>\n<th>备注</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Chrome DevTools Performance 面板</td>\n<td>无</td>\n<td>无</td>\n<td>浏览器自带</td>\n<td>只能简单的说明性能</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Performance API（window.performance）</td>\n<td>无</td>\n<td>无</td>\n<td>浏览器原生方法</td>\n<td>需要自己写代码来生成报告</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><a href="https://github.com/GoogleChrome/lighthouse" target="_blank" rel="nofollow noreferrer noopener">Lighthouse</a></td>\n<td>29.2K</td>\n<td>2025-08-05</td>\n<td>浏览器自带，很快可以出报告</td>\n<td>1. 需要用隐私模式打开排除干扰\n<br>\n2. CLI/node 版本需要 Node 18</td>\n<td><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-24-13-44-51-b31c0786cd977a0c88a7ea01d23a00a3-15a59.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 143.1767337807606%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAIAAAAl5NuSAAAACXBIWXMAAAsSAAALEgHS3X78AAABtUlEQVQ4y5VUW3LjIBDM/e+233sDZa1IQhIwPAZG2wI75cRxwP0hY4qunul5vEXvgJzzcQ8RwZdo95rY14t6d4+34wnwkL130XFOz948IRtzKIXf4MM4TpdxHN4v5EOTLEjAjqN9v+AQQtyNNZbUpkPktrJzbMy+GKcpH7/iOxmu+Ohz4pL1kVNijuehoK2sttl5X8/JWj1Np805d7kdlsWTvRbLGfXxL6fc57YIkY98fZ0kxczIgJnbYUMQrn4GiL+cko2COiH7NpmMcURVR7LkbUuLiuvaJuO92dQ8zxxjNRy1PrZVNiU9ZBhsrUXLhyQezXkNIUm7VGfYlmAaesXaRPRYod9KZTVKO6/rSlqj1zKz3NBBNlYtSmsNfVgNIJyjk6xP5cnA8zrnhVj5PYbZKuscWfI+ng1etdt15pLk3c31PndukhLngYhZ8gsjedtBp8hA05/l72vkz5hd9Iq218gwubjl+KEf24bFGOsAygPaymgstBcKFkL4QmiTS6lO2bK0pEyW9C/9H5dGFxk0WIWAkXn9YrB9ueHmPIO87zv46NBhGMYPzBft+znh8VwPX/Afjhq2hFcE1oMAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 24 13 44 51" title="" data-src="/static/2025-10-24-13-44-51-b31c0786cd977a0c88a7ea01d23a00a3-fee1c.png" data-srcset="/static/2025-10-24-13-44-51-b31c0786cd977a0c88a7ea01d23a00a3-a67b7.png 200w,\n/static/2025-10-24-13-44-51-b31c0786cd977a0c88a7ea01d23a00a3-0b187.png 400w,\n/static/2025-10-24-13-44-51-b31c0786cd977a0c88a7ea01d23a00a3-fee1c.png 800w,\n/static/2025-10-24-13-44-51-b31c0786cd977a0c88a7ea01d23a00a3-15a59.png 894w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><a href="https://developers.google.com/speed/docs/insights/v5/get-started" target="_blank" rel="nofollow noreferrer noopener">PageSpeed Insights API</a>\n 或者叫 \n<a href="https://github.com/sitespeedio/plugin-gpsi" target="_blank" rel="nofollow noreferrer noopener">Google Page Speed Insights</a></td>\n<td></td>\n<td></td>\n<td>返回关键性页面渲染指标</td>\n<td>1. 只适用于线上\n<br>\n2. 需要申请秘钥</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><a href="https://chromewebstore.google.com/detail/checkbot-seo-web-speed-se/dagohlmlhagincbfilmkadjgmdnkjinl/reviews" target="_blank" rel="nofollow noreferrer noopener">Checkbot</a></td>\n<td>无</td>\n<td>无</td>\n<td>安装简单，只需要安装浏览器拓展</td>\n<td>只能展示 100 个 URL，超过收费</td>\n<td><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-24-13-46-50-95bd9b3e28a09ecb8fd18eb07d8db8f8-a9fd5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.328125%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABmUlEQVQoz22SyU4bQRCG5x045AKKBxvhmMx4gWPyOLnkkEtu5D04obwFiAM2i0MIwrckiiHIQlZAYDDGy/R0dy1N9QSUQFL6pZZ66qv6p6qDSq1WrVTK5bi5t+ecU9oYQCAyeC9LBA8iwqHhX4Pk4maE7ILq4lKpVCoWi58+7wsMSMSOmXuKTsfYHdPYsuRZ4t9KDNwmaX+UTJQO4jguFOae53KbW9vonLACizLAC8h1h9juw9ENnAwgtXiZ4NkElIEgiuL54vxsGNbrDenMTO5xMDultE7vJaakvrVWPnk4iqJ8GO7s7AoHAE9hsSMF/MkPJKRGRkFBuVJdeBnN5vONrW1JJZ/3FO6n1Eu824nBrAIjSiIHLwrhXG5m+tlUo173MKL7J/6atjAEiAbAw68+fHy9vLr0fqX5raO1NvY/tocarpXXSKP4djKXrEzw5ot713JvD93BmRrdDmTP/Ni5LM6oVMvMRImSXTLKDrLO663jjcP22sGP1tfjo5+d7+2T84ur7K/+hG8jDeWFXPXO+xML/kru7wATlAiymg/8/QAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 24 13 46 50" title="" data-src="/static/2025-10-24-13-46-50-95bd9b3e28a09ecb8fd18eb07d8db8f8-fee1c.png" data-srcset="/static/2025-10-24-13-46-50-95bd9b3e28a09ecb8fd18eb07d8db8f8-a67b7.png 200w,\n/static/2025-10-24-13-46-50-95bd9b3e28a09ecb8fd18eb07d8db8f8-0b187.png 400w,\n/static/2025-10-24-13-46-50-95bd9b3e28a09ecb8fd18eb07d8db8f8-fee1c.png 800w,\n/static/2025-10-24-13-46-50-95bd9b3e28a09ecb8fd18eb07d8db8f8-b1a91.png 1200w,\n/static/2025-10-24-13-46-50-95bd9b3e28a09ecb8fd18eb07d8db8f8-a9fd5.png 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></td>\n<td></td>\n<td><a href="https://www.checkbot.io/" target="_blank" rel="nofollow noreferrer noopener">https://www.checkbot.io/</a></td>\n</tr>\n<tr>\n<td><a href="https://github.com/catchpoint/WebPageTest" target="_blank" rel="nofollow noreferrer noopener">WebPageTest</a></td>\n<td>3.2K</td>\n<td>2025-07-14</td>\n<td>测试结果完善，有录屏，有瀑布图</td>\n<td>1. 可能收费\n<br>\n2. 不支持私有域名</td>\n<td><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-24-13-48-21-67673a4bfecfa116c7ede8777edfdf8d-1e123.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 154.96368038740923%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAAsSAAALEgHS3X78AAAEuElEQVQ4y6VU2U9cVRif6IOmpj5QKQVaWUPLUhsRKTAijUljE6MPxpYEAg9WjVEfffDZv8TWJmwt2+CwOTOlgFYKbWmhxTDAzDB35u5z93vuOn733mGEkTe/nDnnzD3f7/y+7Xy+vns4jP5R/JsA+W2A7BvBewb2u3/duX4reuN2FOYvfnHmG7eivYPx3qFEjzPveyjf2/6bMCo7v7p47Yema9+f838Jf6s7+mv9/TDXdfY1XOmr6+wtb+k+fenzsubr5e91n23t8VC+U6WNMIpKG4pgLmvyNuU1l6saPjhX529p+/DTT7o6u65UnO+oPN9WXd9RU99+tqbFQ/nOVLedrrxc+85Hzf7PGls+rm++euHdq1WNXcUVLSVVrWW1HSeKm/q+/hFLEevrm6uPnu3EUncGJ96qeB+AvlffrH3lZM3Jksby2tbS2vYzlW3l1f7iqvY3Si69duri60UXfL7im9/9lM1mBYEXRQk2C4t/+k5UAdA3NR3+bSYyOjEzODozMDY3GghNBkPDY3N37w2N3Pl5KjgzOjn3+MnzbNaWZVlRFMs0cJwKBEMA9GX/h/h0w7Bsm2WYJIbxIBwvShJSVQInFAUhpKsq0jWNoWhR4E3T0DRDN0wQmHLMGpJ5LiOIAs2SYJ6GVIZIC3yG5Wg2wwCYY6gMTWc4FlRs08gxewuQO7dZJtIV0zBMy9J0HYxSNQVpqmXZMpJFVVQQvx7Ho7gTNts+AIOiLKuKihQVUMZ/3bNscA8cNDEWYRk1x2zDDdksSWewNJ0mmBROUzQnK6ooKbwoq5rMS5yma+A4UhSWJlmGVWX5CJigWJygUziVSlP7GEGQDMNySYxiBCJJxmRV4kRB4kmRie8mSODImW254PWN6ND4/cm5h7ORtfmFtbnI6kx4dWF5Lbzw18KD1dnwynRoJTT/MLL0ZGlp6enz6BHm3Xhqcyu2tb2/tR3f/BtGLLqHgVICS2xubyQwfDuWiO9he9vPXrzcgqMcc85skgFrkykS7E/jdJpkBUmK7xOCxMXSu+AwyzGSLAtMPJUmQS3HDGmAZfXp1u3h+eGJByOBxbHg4uz072Pj4dHg8sjk4mQwMj4VGp8KD47fHwksD4xFllc2Dsx2F16QkmmKoDLIzS8UEizIKS3d0DXDMHRdc4+cL/lc5vMMh8gpE1eQpsEjAL9gDz9RFOEIHISroGJdh+1DzJKapATwAJQoisKxpCwpXuXJjrh7y6JFDarPi9YhZtOSkAlgsJCkyGQiIQleDdpumRoe2CP891V5C9jmbcA5mqFZnhI43gPkVW1XjgEfKDnPgxdEisY5hrBdL/Iwj/nwFTmwKCsEw3nakkgx9I7EJW33UqQiCLTtPjtWcn0uAMvISGUU3XBCLUlQ/AmRw71oO71HRZ51SDePYYYnDHjdiSREyJIoxtJlz0ynVSgqRUqQ7ALPC3x2tkjJpv4Ia+QL09FxvhvMHvPoLrQDu6CH5cH2ITEN6JKm882C2bQtPWvJedpC5sK+YdlQh1CeSMIQ99hQEl4usscyQ8UybAaS5P0lSDqewKAtGdAtNdWrcrgMBFavZo6YDS0WDnLBVxS4CJTAarcvOlkwDyQfoH8AX58quirQdYkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 24 13 48 21" title="" data-src="/static/2025-10-24-13-48-21-67673a4bfecfa116c7ede8777edfdf8d-fee1c.png" data-srcset="/static/2025-10-24-13-48-21-67673a4bfecfa116c7ede8777edfdf8d-a67b7.png 200w,\n/static/2025-10-24-13-48-21-67673a4bfecfa116c7ede8777edfdf8d-0b187.png 400w,\n/static/2025-10-24-13-48-21-67673a4bfecfa116c7ede8777edfdf8d-fee1c.png 800w,\n/static/2025-10-24-13-48-21-67673a4bfecfa116c7ede8777edfdf8d-1e123.png 826w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html>\n \n<html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-f7915.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 825.7328990228012%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAClCAIAAADTfUqKAAAACXBIWXMAAAsSAAALEgHS3X78AAAO1klEQVRo3p1a2Y9k11lv8QhicWwTbM+MJ5FjO55kpLg1YCfOJAoEHi0gjpIYHpwHlLzyBI9I/BNIIfAQTCCL07E9Y5txFBGPkYhsT6+13H3f932pan7nnKrqruru6S6uP9869/b9nW893/ede2fj5f/QQH/9n9rf/Mz8zpaJ8Td+IH79X0cv/csQ9LXvD//ie8O//OfhS98ffvPfhG+9KpLzv0sMtXH5869c+vwrV1/49rWvfvfan3wXl1e+8O1PPP9Xn3z+ZZyf+uK3rv/xy0/ffPmxza9//PqfP/q5r13afOnSjW/iMdDGg49+htK1hy5df/Cxz37skWsPPHLtsU89/8lrNy8/9cIffuHmiy9+6YUvf/nSp567/MSNx5987upTzz3yiU2G2vj9qzc+dmXzietf2fzii5+58WfPbH7105t/evWZmw9e3nzoyubDj//Rb/zup1/5zt9bjjcYcNvbQ1n3fvDDrQcuPfvw1Rsbv/MH13/74599+MqzV558/vGnb15+8uYT175y6ekvPfDYs7/36LMPXv7cxm9d/du/+8fDw8Msy9Ikw+AXv3z/Nx96BsCNN26/++Zbv3jt52//aOudN9/+Jej1W+/+eOvOj3/ywx+9+g9v3Hrnp6+/c2/34PBwWpGjnE4nlu3+/M07AG4c3u+YLEbT6ZSc6YCNcWxMJhNc1HUNmfIsLcuyaRpcVlVdNx0Gfd9P5k8vJprQY8a5KCrPj4I488Mkz8vJpMfzx5mcOMj9jekMXAZR4kZZkldlWTdtMz0Evp90TVVBEHIm95uOXDbtTGw2t+PFg5E6GGuy5iiao5qm4etB6LmGPBgrqu5Kij0cq5rhqrqjm95CZwL+YHv86k/efe3We1tv3f3prfd+dvv91279z9bt/7595+7tO7/aeuu9rdt3b99+7607v7r99n/9+qPhgjP5SZJElqQwDCbTSY//pj05H05SeDZLIf2E2IgoQnSZ9DOd2Rxd1+Z53rbtilk63Gra42abnmKwsnLcME5zcGBGnhwz9ewO5T6/eYwzbsKUZV13MG+JqcqWeDupU77a26uStKonTdPjGeBXwFN20bV1nKZp6MZObDtRkuihO7S2dwJNNf0wCuO2bJb8vJALP2kSjTlOEgVds1TVMRw1KYusKCM3dr28yBED1Zlg2Hw4HB4MBp7vtXWpi3tR5NZ5kgVFFDY1XRlngqMoGtPD9308aoofaoO7ljRKwzIM6wuBBwcHju3gWWks8geSKipJkIchVkpxDng0GnEcF4BzUYkHqq7ZoevPwNV9wXEcM7GDMMTC1MZD4+AgsPUsqIjY9XliDwaD/f1913URWE6gh57v20bkJQCfzxkya5qGARZgVAZFWySOrYlGFLd1XZ6vs+M4iJSyrMLcS8u0iEN1X/T97Hyx4WdBEIIgwJIPcz8t0rrMI8tzTLO6kKsGA6pzFxV+VqZ1kWVBqooqAh5GO0dsHOAMgy3AaZAJQ6lIi7qqp4fTc/yMCAM4LHzoXOdZFlU6L3u6TLLX9Aww8gbP8zBYlqYV1kPuJ3lc4iIqbNUzVTXLilPEZhdYwlEUEk6R73uOYgmeZ4SuaiHzmW4QamkSnqYz/cFa9/0gTtIgjk073tk/0MKhefCm8OEbvPC+9evvhc5w/vj0KAGmeaVage3HZdM3k8O6m7Q9e2RyOO0PkZQw6PvDo2S2lIaQEvsCmb3Iujxuyq7KyqYrqrzOixppCf+nRdW23dmuSlJNk6vQN5RAM3zHUN3QdRzfMG1T0TXPReSdCc6SGNbO8jzNszBI1L1RqEtVbMdW6Ft+WyZ13U7PchVdkiMkowJHWVqW5BtO6vmBFoY+bmBV1fdbVaIoYiUDi2SQ1GHeZGUSB3pgq34exyimZ4IRunEcAQk/B75rOLLnmRG465ZheGFko4afGiTkQG0JwwhBEqeR7cT3dvfUYGDsv859sDXm7xr/+0+BfXA8qGblJifFPQ7jjLYBrO5P+67rJk3flh1c11WTuphMTnEV/D/pOtJAkLpBQH3foRpOuhajdoIxIuRkZ8BGeA4ryTQtF1nXtnVdN00TZ1GABUUkJgWHLKuKAkLcL3UGURDu6fxOII1iWcxlLuLEVBx6Qz7ihYQQ7nAhR84JZ+XWEthznG2D207VDwKZrzUh45RGGSVjpVONqWEcGnIjE6pltVfd1l0C+667Z3K7mbodyXyl8hmH53g6hd7r+gSBJs2okZzGWeHsEs6Jci+UpVYbJ2OhELiUU1qVgcVSBEmlxOecXdtLYNd2dg1uJ9N2YkVqND7lxFLiUh6cjYkByQm4ICSUwgmwQ8EpEVuoVSHnISHhPBebshXlUhZr0a6sVc7bOsRW7xEwxB6JlXRcZ4DlSsaMYgXwCc57BreXqTuRIlQaYGqnQkO1UZnYGEu1DDzur4qNwKAGUz8M5FGhculYaRXYDJzVXtN6jRpMAsmdvCo2wDvGeDdTIDZXKXw2A8stWClKK4ulIFUiSAG4XtXZ3kGExTo6H77Q+VhQah2hplS6WutsLOaKVChKrVmls6KztT2w73H1R6MSk4/HiUQYQdFKVVtV6wSRjCW54vnSNIsVsL03cPb5dndcCVLLc5kiNwQvljCxLNWwMglOqVLkzraqRd4+xnnc3BuVgtJy45iGYgkpDWpuYmgZnInRLatcAjuOtTNwdrl2l4NNWqRQ8KHglnhZn7K5IAgvlJZZLlvbsQHeGTfb4Cy3Ap8pSoNoZGAwn6lA+DencN4dOHt8+9Gw2OcrbpwCLAg0muElOE0oiLu1XlE784TONsA7XPPRqBgINRW7YayItdUOnDEdSJZby6pWgsTaPiAG2+MqiA1X8XzONKeAmi1IOh0T+zRXAczLDZINMw8cRjm3zMnUbLVlVyeDxNnmoHMlyj10RsoQRSwFGIzkIZJBCNWCAFfVJ60t7fLu9tgSFY/nVFmxJMlUFMcwfMMIZMmSZZCNs20HJ8Qecgeitssriq5LIq+qiqrKuq7atgnCGHc0DZlXwvpdXVW7Q2FfMHY57MtMgecJVJaRsW16qCqdjR7o0k4kgxEP8B6vKZohigJ9GkLoFj3o1Qztud4JzgN+l9d3eU3VDXBW55wZmFYMhdWNVc4O0Vk4ECln3QRn+qC6AFOpFTbjKmcSYUMOnLfH6kjSufFYEERJkhaiAkO5kvMJnV1nwIljxR5IpqASPuCmaxpsgcOmpc+gB+6jM52B5yW2a5q2bjvs1tuOFFk0dFGcxUmOzTOptceOfl5uj7aDbC+8OFCrw6QI4gIPn7lzZ0N0aVleznab99nsnwpGjwcw2gAID2K7zekFwWTHVVSQsGk7ENrE87gvgRv0NDAV4Uz22+uAsRFKs4JsoasaY9h8DZ0hNuXc11TnpmnXNljHDEbap8kaYEibz8FnOPY+YtcNs3ZLTY0Z5u8GLsaZGqytyJsc7Pua8yRfBZcNiW0cLRH94uACrqI6M9x6OsO3M2sT5u0F8Ct+zmmEXSg2T9cZO2yi83p+hnkhdkPe2zUU36wVYUc6XyxOlsMTfu7m6xno9SIsX6xnAu7XNxiNMIy79cEFA4PWBTdzg7H1vE4mwZJK04Lp3JO0vfqW9QIRRqx1kfA6GSRZie0gArufTNYDI0iSlFSWkrwfbteLbSY22fpRP0P4NTIJizC2quYvOtfx86LcdCSBTdcLTwommYCsqrZbL5McjzASZBfPYRUTu52tqgusjeUIS+iSZEkb8q9T6BYGo7Hd0W37ffEnwTMnEyLv7++XQ5f9TCOsXbz+x/i+aXCluOcVS0MXy/vLnKMkL2mVJq/Gy3pG5HVUXVHPs5RO3LDSSuG5OM3powRZUGLIgrxzbBgMMlFsv/Q1Ic0Lz48RJ6RxS/MkLeLkaJBmOSSaE/kWssQZt7wwxtNhnOJMGVYLOoYkdPwLCvkBQ9VwHTe03cB2AnJ2Q8sJ6J0FBY4XmnaA2ZfBUcqJuqiYIEE2QLwE0nEWZJPHpawLZGxwkh5EKTP3UZAsMgkyKcu+9AURSYYtfV1E+9l+7vylJYkIm5VYRgxzzieno4WRFi2t7DUtsfTN1vSM48R6hokP1ziOvzTNCtgzCBM/TGAPkB/EuIQXQnoJF4bkTC6L+aeQBWeEZ0bcOw9PRDvCqu/nZqPELheJdWU9d3Q9d+vm7Wbeh7VrV8lFZ8AWQLdWQ1PQ7HmsM/h/tRXtfNGu1xlk8z4MCaheq1mftRUswmpC67TMiz6smSXQdbpeGtuLdbNm+1jXLHv289WwpsGOqiQx2HlV9rjYJBkUbI+wEsAXszb57DxZb0meDM9m3c5g0QG2izS0TnFnfRjdv9NydZ7JT2tc63lbUdH9wvoLg6YEwnxyseKOjSTSFQQmHSBlC2+3NPsSavujMWkapqs6w88IUsxCi1MJE0AR+I+eZ5TRy8WCPfoUEUYZScAAFxX404Bp2JnVECoOOS8i/xSd2ZKafzw/PPqGvpz1j97QIC1LimXYvmF5uknJ8jTTxZkMDBd32FnRbFbojpI+UvmQV3nRQK2k9dFATRwLGidq7BIVcyyQQjniNRTaJTDKP8onZpVB6pxmYwv3CekgBwKiqiyJHUTJiFfxB1KEJRPEz8q1Rcu1SQu1Icom+DtetCx2nOIJTC+plkzOhKGqOwspiFCqhftggO5lVWdMiYkxxbw/YISewJiNJVOkIrgrnKnOJmHLVCXkEBEUa8ZWs9hfoYgXxKs6w7ZMN56pjbkUi4ggzRoVsAXBHa4frYo919me8afKMz0XLsADmMgPlq0NMAediW2p2jiLBrU8Y8juU7OLJ6wdwdqSweSkelpsDGJ64lKSiSyYyw9OWBvhxTAQW5ydiQkXM7KJwMM96Sp+xnkGZmwlhXludoeKbawaDJmAgGkkMrGJtMTnFrtc3Ifm3qrYMRFbouqJ1EkLaYX5FMx58NyqzjAYmkqR/o2fWXhG7JJGmIEH4JSjCFtkzyDK6FvSDLmmpN09khEjlpjYAH89apnZD7KHh5WWzFa543rDsUD/oVRHmnvSkHWkyWpqXK5uE9i/nWJvXaEI/Q7eT88+GOr/AF0yOUoIWAUFAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 24 13 48 44" title="" data-src="/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-fee1c.png" data-srcset="/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-a67b7.png 200w,\n/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-0b187.png 400w,\n/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-fee1c.png 800w,\n/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-b1a91.png 1200w,\n/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-95179.png 1600w,\n/static/2025-10-24-13-48-44-1e09e8d330005ce8316631032d341f55-f7915.png 1842w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></td>\n<td><a href="https://www.webpagetest.org/result/250807_ZiDc4K_4PX/" target="_blank" rel="nofollow noreferrer noopener">https://www.webpagetest.org/result/250807<em>ZiDc4K</em>4PX/</a></td>\n<td>1. 安装过程：\n<a href="https://github.com/catchpoint/WebPageTest.agent/blob/master/docs/docker.md" target="_blank" rel="nofollow noreferrer noopener">https://github.com/catchpoint/WebPageTest.agent/blob/master/docs/docker.md</a>\n \n<br>\n 2. 说明文档：\n<a href="https://docs.webpagetest.org/getting-started/" target="_blank" rel="nofollow noreferrer noopener">https://docs.webpagetest.org/getting-started/</a></td>\n</tr>\n<tr>\n<td><a href="https://github.com/sitespeedio/sitespeed.io" target="_blank" rel="nofollow noreferrer noopener">sitespeed.io</a></td>\n<td>4.9K</td>\n<td>2025-08-05</td>\n<td>1. 支持 Firefox、Chrome、Android 版 Chrome，并对 OS X 和 iOS 版 Safari 提供有限支持\n<br>\n2. 支持本地在线测试（Docker 本地私有化部署）\n<br>\n3. 支持各种\n<a href="https://www.sitespeed.io/documentation/sitespeed.io/plugins/" target="_blank" rel="nofollow noreferrer noopener">插件</a>\n，包含 Lighthouse/WebPageTest/PageSpeed Insights API\n<br>\n4. 支持\n<a href="https://www.sitespeed.io/documentation/sitespeed.io/continuously-run-your-tests/" target="_blank" rel="nofollow noreferrer noopener">持续集成</a>\n<br>\n5. 支持模拟慢速网络连接\n<br>\n6. 支持\n<a href="https://compare.sitespeed.io/" target="_blank" rel="nofollow noreferrer noopener">页面性能/har 比较</a>\n<br>\n7. 支持\n<a href="https://dashboard.sitespeed.io/d/9NDMzFfMk/page-metrics-desktop" target="_blank" rel="nofollow noreferrer noopener">线上性能监控</a>\n<br>\n8. \n<a href="https://www.sitespeed.io/documentation/sitespeed.io/metrics/" target="_blank" rel="nofollow noreferrer noopener">指标全面</a>\n<br>\n9. 支持\n<a href="https://www.sitespeed.io/documentation/sitespeed.io/scripting/" target="_blank" rel="nofollow noreferrer noopener">脚本</a>\n<br>\n10. 支持\n<a href="https://www.sitespeed.io/documentation/sitespeed.io/video/" target="_blank" rel="nofollow noreferrer noopener">视频比较</a></td>\n<td>想完全用起来还需要编写登录脚本或者让网站支持自动登录</td>\n<td><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-24-13-52-23-fc758e87b31fc43a03bcd6ee5374f6f6-6e10a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 308.8%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAA+CAIAAACk3KwKAAAACXBIWXMAAAsSAAALEgHS3X78AAAGbklEQVRIx41X247juBGd707+Yz8gr/mEAAEWi2wyu8F0T9DTtiXZ8k33O++kJHsPRdvTcrtnQ6htia3iKZ46VSx/qtSpMWcvrVNman3GI66wVX4lglouc7YqedjqUo3uKsSQceNe+3Q6nTGqqhJcnN8Nzihn7O2MMaauKnf/yX11XTcMg7uvuS6oyjqxL5pD2REhmR4wk1OJx0PRFd1lOSBb6DRNq+t6w3gaT2cuZbjbbff7tu3cZD+Mx2MUbndJms6Mi6Ko63rmntZ5nsdx3DSNm8GbAMjyLH1vLMRsz5jf7/ee57dt6x7da57nJUkyM8aSVV27++9scR5FMSHkZgy2sizDEjPC4FsURWxOLAbcoXQ22fd9M/nyHRnrBUHw1rgfBm16sHULDN5USnMhs9ue3ZeexhxTNYRVTdc27RVzqFtKKM/zcmYspbzF+TKjNOOSdLS7Gg/DCEsgl8Xc+I4qDKVNXrVZUbs423fGsazbvOrukbuOvJWhW2o8nWpuVD++XZQoQ1R/I8x+lWUZHmIxnuUAgPH8/40Lcl3VXw/5//bZt12Rx3lYkKQlDWXG9NjRaMdpujkN0+0sVIiz7612m4B0zVmPP73+8x/hopeGcwUuBeWEKKk1QsCZwvzMGMJerbxgvYYABjO8NuvP2wXjQjDJQEZH21YgVRiTlAgt9L22fd/fbDZpkiqjz+b81fOOddHLXkjBKe+6CzLszR1ynuVQ/GScSAVX1esujOtScf3nyMg+3/Og0CSONVgy/a4uouaCbPf8A2SrbT9YB+vD/qC07rXZV8U6TzSHmDknrGulUIpzSakwYm6cZhnchv1hv4fbSICorl6SUFI1d1sQwu/dBk/eyroNY3AskDp189txxTtOKCFNV9cohQgYa1umuLp3Gz6DsDiKkPHwnHL5OV4xlD8l+RRndYuzerdnhGq9Xh8PR7htwZn65fgalxWopx2B22Jy+wHbrhgA+Xg8gm1wM8jxX/Fike5REzhlN4Uxpu7ZRkEMgAy2DweHbET/Wuy+HHysRDvaWGTBH8Z52nOwWa9RaxFlS7gwOWt/P3hayklhEI56jOz2DLeBPBEDA9UJ/sv+G6on3G4bG6rHyPm05zAMsWfLNgodt/T+fHxJmkIzaZE/Uhj2bLW93jiRAJlQ0ev+P9HSz/aaCossPtJ2lgN5G26jiW1lq59CbvpF5Od745DVB/mME2S1WmHb4Sa0WczBED5EUpcv8Ya31CqMQSq8e68wGPueb8G3W4gBZq7KVm3323EB46bhqA3Uphd/IE/sGQqLoxg8wUVsD8rEEr9HS9YQuD0tKhl9lJLO2OUzjPGezUEmnxMPFQ4KEwoqUQ+MwbaLMwizyMoiM9Q+rpfZtigLFAPh4ox8lu8qyXqKM1axyDbvsTWIqY/rvChLSvRVYY9qWDBRDXne9syE1NxELY6Xgjpk/gg5uyoscvk8KYxLhfSISZX9GDlLM4QqDLeI2ZUwa4zqWbIOvQCQbVV4zPZkDLZxcN/c5hNhLafbJEWosJa4uD03xkHn3Eb7cmGbO2PFBN/myaGoDk2JSgLk/n2cF4sFQt02zUVhSER0NARSZbwjOJaTtjiUeVbW8qawW2eAJhCpa9B/2T8tpIHCcDqLqRi0LbyBR8aW3lsB/OjsRVaiCRn6wfQ91i2KCqv2CIRU/XTuztoKN942UeiaBvwZQ6xxgRBiQqPfMOZPjNHfvG0R8HT77+nucEcDuN3u0jS7c34ECninyOMGutGMkaYEJ/d7fruwux+HoVguNsunl5dfl98+b7zn9fJp9e0zYuDe+872zcnvxugUw9ALvgT+cxA8+/5T4D+tg69Q2gwZfICah8aw8T1rdrvkxfiKjK7zI+TJ+MvMWLCZsW2TQKgxMMA1TDeDlFUYLL3/+qsvsL9d98iIJq8r0baaUlyKEHx2Wb7ZrNIqxvEoBLFaFbjorUu9NnGkror8rnedOsgfdoBue7vtDsfF4AJ2OkGWSJUkSSFQVKhkapFQZDhnVVkWeTHvANt2u9k8h0kp+itnI9IX28ED6AQhqKGUUvdLYeY2+uIsTdZRnjCrHqzXn874OcXNYE5nFwjEEievk/2HWeWU9veA/PXf+V9+zf72WrvlPux6b4MKXTEwzTdR+rQrvu7zRYxzSuFnHr0WkA+NT1fkpqkL1OskbdJstCSe3/0YOP8Bi2/iG4yHsNMAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 24 13 52 23" title="" data-src="/static/2025-10-24-13-52-23-fc758e87b31fc43a03bcd6ee5374f6f6-fee1c.png" data-srcset="/static/2025-10-24-13-52-23-fc758e87b31fc43a03bcd6ee5374f6f6-a67b7.png 200w,\n/static/2025-10-24-13-52-23-fc758e87b31fc43a03bcd6ee5374f6f6-0b187.png 400w,\n/static/2025-10-24-13-52-23-fc758e87b31fc43a03bcd6ee5374f6f6-fee1c.png 800w,\n/static/2025-10-24-13-52-23-fc758e87b31fc43a03bcd6ee5374f6f6-6e10a.png 1000w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></td>\n<td></td>\n<td><a href="https://www.sitespeed.io/documentation/sitespeed.io/web-performance-testing-in-practice/" target="_blank" rel="nofollow noreferrer noopener">最佳实践</a></td>\n</tr>\n</tbody>\n</table>\n<h2 id="线上监控"><a href="#%E7%BA%BF%E4%B8%8A%E7%9B%91%E6%8E%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>线上监控</h2>\n<table>\n<thead>\n<tr>\n<th>选型</th>\n<th>Star 数</th>\n<th>最后代码提交时间</th>\n<th>优点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>sentry</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><a href="https://github.com/GoogleChrome/web-vitals" target="_blank" rel="nofollow noreferrer noopener">web-vitals</a></td>\n<td>8.1K</td>\n<td>2025-08-01</td>\n<td>健康网站基本指标</td>\n</tr>\n<tr>\n<td><a href="https://github.com/GoogleChrome/lighthouse" target="_blank" rel="nofollow noreferrer noopener">Lighthouse</a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><a href="https://github.com/Zizzamia/perfume.js" target="_blank" rel="nofollow noreferrer noopener">Perfume.js</a></td>\n<td>3.2K</td>\n<td>2024-06-04</td>\n<td>用于测量所有性能重要指标的 Web 性能库，web-vitals 的超集</td>\n</tr>\n<tr>\n<td><a href="https://github.com/akamai/boomerang" target="_blank" rel="nofollow noreferrer noopener">boomerang</a></td>\n<td></td>\n<td></td>\n<td>面向最终用户的 Web 性能测试和指标</td>\n</tr>\n<tr>\n<td><a href="https://developers.google.com/speed/docs/insights/v5/get-started" target="_blank" rel="nofollow noreferrer noopener">PageSpeed Insights API</a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td><a href="https://github.com/sitespeedio/sitespeed.io" target="_blank" rel="nofollow noreferrer noopener">sitespeed.io</a></td>\n<td>4.9K</td>\n<td>2025-08-05</td>\n<td></td>\n</tr>\n<tr>\n<td>OpenTelemetry</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Elastic APM</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Jaeger</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Pinpoint</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>Prometheus + Grafana</td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>最终选定 sitespeed.io 作为性能测试工具，暂不考虑线上性能监控</p>\n<h1 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h1>\n<p>这里只量化首次进入页面的性能</p>\n<h2 id="目录结构"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77933449149596140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`└── test\n    └── perf\n        ├── .env.example\n        ├── .gitignore\n        ├── config.json\n        ├── index.mjs\n        ├── loadEnv.js\n        └── start.sh`, `77933449149596140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">└── test\n    └── perf\n        ├── .env.example\n        ├── .gitignore\n        ├── config.json\n        ├── index.mjs\n        ├── loadEnv.js\n        └── start.sh</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="核心代码"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h2>\n<p>.env.example</p>\n<p>配置样例代码，复制一份为 env，在改为自己的账号信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8838313603089753000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ACCOUNT=xxx\nTOKEN=xxx`, `8838313603089753000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">ACCOUNT=xxx\nTOKEN=xxx</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>.gitignore</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27090894180433555000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`output\n.env`, `27090894180433555000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">output\n.env</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>config.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48239221530484430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;browsertime&quot;: {\n      &quot;iterations&quot;: 1,\n      &quot;urls&quot;: [\n         {\n            &quot;url&quot;: &quot;网页链接1&quot;,\n            &quot;label&quot;: &quot;网页名称1&quot;\n         },\n         {\n            &quot;url&quot;: &quot;网页链接2&quot;,\n            &quot;label&quot;: &quot;网页名称2&quot;\n         }\n      ]\n   },\n   &quot;multi&quot;: true,\n   &quot;cpu&quot;: true\n}`, `48239221530484430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"browsertime"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"iterations"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n      <span class="token property">"urls"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"网页链接1"</span><span class="token punctuation">,</span>\n            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"网页名称1"</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"网页链接2"</span><span class="token punctuation">,</span>\n            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"网页名称2"</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"multi"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   <span class="token property">"cpu"</span><span class="token operator">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>index.mjs</p>\n<p>主要实现自动登录功能</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88986759000299600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import loadEnv from \'./loadEnv.js\';\n\nawait loadEnv();\n\nconst { ACCOUNT, TOKEN } = process.env;\n\nexport default async function(context, commands) {\n   const urls = context.options.urls;\n   if (!urls || urls.length === 0) {\n      throw new Error(\'No URLs provided to test\');\n   }\n\n   for (let item of urls) {\n      const [base, hash] = item.url.split(\'#\'); // 分离基础URL和哈希部分\n      const [hashPath, hashQuery] = hash.split(\'?\'); // 分离哈希路径和参数\n      const params = new URLSearchParams(hashQuery);\n      // 用于登录的参数通过 url 传递，业务端需要实现对应功能\n      params.append(\'username\', ACCOUNT); // 添加新参数\n      params.append(\'token\', TOKEN); // 添加新参数\n      const newUrl = \\`\\${base}#\\${hashPath}?\\${params.toString()}\\`;\n\n      await commands.measure.start(newUrl, item.label);\n      // When the test is finished, clear the browser cache\n      await commands.cache.clear();\n      // Navigate to a blank page so you kind of start from scratch for the next URL\n      await commands.navigate(\'about:blank\');\n   }\n}`, `88986759000299600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> loadEnv <span class="token keyword">from</span> <span class="token string">\'./loadEnv.js\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">await</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">ACCOUNT</span><span class="token punctuation">,</span> <span class="token constant">TOKEN</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> commands</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> urls <span class="token operator">=</span> context<span class="token punctuation">.</span>options<span class="token punctuation">.</span>urls<span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>urls <span class="token operator">||</span> urls<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'No URLs provided to test\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> item <span class="token keyword">of</span> urls<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">[</span>base<span class="token punctuation">,</span> hash<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'#\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分离基础URL和哈希部分</span>\n      <span class="token keyword">const</span> <span class="token punctuation">[</span>hashPath<span class="token punctuation">,</span> hashQuery<span class="token punctuation">]</span> <span class="token operator">=</span> hash<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'?\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分离哈希路径和参数</span>\n      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>hashQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 用于登录的参数通过 url 传递，业务端需要实现对应功能</span>\n      params<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">,</span> <span class="token constant">ACCOUNT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加新参数</span>\n      params<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">\'token\'</span><span class="token punctuation">,</span> <span class="token constant">TOKEN</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加新参数</span>\n      <span class="token keyword">const</span> newUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>base<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hashPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n\n      <span class="token keyword">await</span> commands<span class="token punctuation">.</span>measure<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>newUrl<span class="token punctuation">,</span> item<span class="token punctuation">.</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// When the test is finished, clear the browser cache</span>\n      <span class="token keyword">await</span> commands<span class="token punctuation">.</span>cache<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// Navigate to a blank page so you kind of start from scratch for the next URL</span>\n      <span class="token keyword">await</span> commands<span class="token punctuation">.</span><span class="token function">navigate</span><span class="token punctuation">(</span><span class="token string">\'about:blank\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>loadEnv.js</p>\n<p>实现读取 env 配置的功能</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22889380691912930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import fs from \'fs/promises\';\nimport path from \'path\';\nimport { fileURLToPath } from \'url\';\n\n// 解决ES模块中__dirname缺失问题\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n/**\n * 解析.env文件并设置环境变量\n * @param {string} [envPath=\'.env\'] - 自定义.env文件路径\n */\nasync function loadEnv(envPath = \'.env\') {\n   try {\n      // 构建.env文件绝对路径\n      const resolvedPath = path.resolve(__dirname, envPath);\n\n      // 读取文件内容\n      const content = await fs.readFile(resolvedPath, \'utf8\');\n\n      // 解析每一行并设置环境变量\n      content.split(\'\\n\').forEach((line) => {\n         // 忽略注释和空行\n         const trimmedLine = line.trim();\n         if (!trimmedLine || trimmedLine.startsWith(\'#\')) return;\n\n         // 提取键值对（支持等号前后有空格的情况）\n         const [key, value] = trimmedLine.split(\'=\').map((item) => item.trim());\n         if (key && value) {\n            process.env[key] = value; // 设置环境变量\n         }\n      });\n\n      // console.log(\\`✅ .env loaded from \\${resolvedPath}\\`);\n   } catch (error) {\n      // console.warn(\\`⚠️ No .env file found at \\${envPath}, using system environment variables\\`);\n   }\n}\n\n// 导出默认函数\nexport default loadEnv;`, `22889380691912930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">\'fs/promises\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">\'path\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'url\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 解决ES模块中__dirname缺失问题</span>\n<span class="token keyword">const</span> __filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> __dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * 解析.env文件并设置环境变量\n * @param {string} [envPath=\'.env\'] - 自定义.env文件路径\n */</span>\n<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>envPath <span class="token operator">=</span> <span class="token string">\'.env\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 构建.env文件绝对路径</span>\n      <span class="token keyword">const</span> resolvedPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> envPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 读取文件内容</span>\n      <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>resolvedPath<span class="token punctuation">,</span> <span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 解析每一行并设置环境变量</span>\n      content<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'\\n\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token comment">// 忽略注释和空行</span>\n         <span class="token keyword">const</span> trimmedLine <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>trimmedLine <span class="token operator">||</span> trimmedLine<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">\'#\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// 提取键值对（支持等号前后有空格的情况）</span>\n         <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> trimmedLine<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'=\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            process<span class="token punctuation">.</span>env<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token comment">// 设置环境变量</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// console.log(`✅ .env loaded from ${resolvedPath}`);</span>\n   <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// console.warn(`⚠️ No .env file found at ${envPath}, using system environment variables`);</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 导出默认函数</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> loadEnv<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>start.sh</p>\n<p>各终端性能测试运行策略，这里除了测试性能，还测试了各个终端浏览器缩放比例的显示效果，以下为需要测试的终端</p>\n<table>\n<thead>\n<tr>\n<th>屏幕类型</th>\n<th>物理分辨率</th>\n<th>推荐缩放比例</th>\n<th>适用场景与说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>24 英寸及以下显示器</td>\n<td>1920×1080</td>\n<td>100%</td>\n<td>日常办公与网页浏览，PPI 约 93-102，文字清晰不累眼</td>\n</tr>\n<tr>\n<td>15.6 英寸笔记本普通屏</td>\n<td>1366\n*\n768</td>\n<td>Windows 默认缩放 125%，macOS（如 MacBook 外接）推荐 125%-150%</td>\n<td>文字清晰且兼顾性能，适合文档处理、网页浏览和视频播放</td>\n</tr>\n<tr>\n<td>13 英寸 MacBook Pro</td>\n<td>2560×1600（等效逻辑分辨率 1440×900）</td>\n<td>200%（Retina）</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90382499199084280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`current_time=\\$(date +&quot;%Y-%m-%d-%H-%M-%S&quot;)\n\n# 台式机桌面端 1920x1080 运行 5 次\ndocker run -e MAX_OLD_SPACE_SIZE=4096 -e TZ=Asia/Shanghai --rm -v \\$(pwd):/sitespeed.io sitespeedio/sitespeed.io:38.1.1 --config config.json index.mjs --browsertime.viewPort 1920x1080 --outputFolder ./output/\\$current_time/desktop -n 5\n\n# 苹果笔记本端 1440*900 运行 1 次\ndocker run -e MAX_OLD_SPACE_SIZE=4096 -e TZ=Asia/Shanghai --rm -v &quot;\\$(pwd):/sitespeed.io&quot; sitespeedio/sitespeed.io:38.1.1 --config config.json index.mjs --browsertime.viewPort 1440*900 --outputFolder ./output/\\$current_time/mac\n\n# windows/ubuntu 笔记本端 1366x768 运行 1 次\ndocker run -e MAX_OLD_SPACE_SIZE=4096 -e TZ=Asia/Shanghai --rm -v &quot;\\$(pwd):/sitespeed.io&quot; sitespeedio/sitespeed.io:38.1.1 --config config.json index.mjs --browsertime.viewPort 1366x768 --outputFolder ./output/\\$current_time/laptop`, `90382499199084280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">current_time</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +<span class="token string">"%Y-%m-%d-%H-%M-%S"</span><span class="token variable">)</span></span>\n\n<span class="token comment"># 台式机桌面端 1920x1080 运行 5 次</span>\ndocker run -e <span class="token assign-left variable">MAX_OLD_SPACE_SIZE</span><span class="token operator">=</span><span class="token number">4096</span> -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai --rm -v <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>:/sitespeed.io sitespeedio/sitespeed.io:38.1.1 --config config.json index.mjs --browsertime.viewPort 1920x1080 --outputFolder ./output/<span class="token variable">$current_time</span>/desktop -n <span class="token number">5</span>\n\n<span class="token comment"># 苹果笔记本端 1440*900 运行 1 次</span>\ndocker run -e <span class="token assign-left variable">MAX_OLD_SPACE_SIZE</span><span class="token operator">=</span><span class="token number">4096</span> -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai --rm -v <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>:/sitespeed.io"</span> sitespeedio/sitespeed.io:38.1.1 --config config.json index.mjs --browsertime.viewPort <span class="token number">1440</span>*900 --outputFolder ./output/<span class="token variable">$current_time</span>/mac\n\n<span class="token comment"># windows/ubuntu 笔记本端 1366x768 运行 1 次</span>\ndocker run -e <span class="token assign-left variable">MAX_OLD_SPACE_SIZE</span><span class="token operator">=</span><span class="token number">4096</span> -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Asia/Shanghai --rm -v <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>:/sitespeed.io"</span> sitespeedio/sitespeed.io:38.1.1 --config config.json index.mjs --browsertime.viewPort 1366x768 --outputFolder ./output/<span class="token variable">$current_time</span>/laptop</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="运行步骤"><a href="#%E8%BF%90%E8%A1%8C%E6%AD%A5%E9%AA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行步骤</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31397123585406718000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cp ./.env.example ./.env && vim ./.env # 在线上环境找到对应的 token，设置自己的环境变量 ACCOUNT/TOKEN，否则不能正常测试\n\ncd ./test/perf && chmod +x ./start.sh && ./start.sh`, `31397123585406718000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">cp</span> ./.env.example ./.env <span class="token operator">&amp;&amp;</span> <span class="token function">vim</span> ./.env <span class="token comment"># 在线上环境找到对应的 token，设置自己的环境变量 ACCOUNT/TOKEN，否则不能正常测试</span>\n\n<span class="token builtin class-name">cd</span> ./test/perf <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x ./start.sh <span class="token operator">&amp;&amp;</span> ./start.sh</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h1 id="对比维度"><a href="#%E5%AF%B9%E6%AF%94%E7%BB%B4%E5%BA%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对比维度</h1>\n<p>选择以下维度进行对比</p>\n<ol>\n<li>页面传输资源大小（KB）</li>\n<li>本页面相关 xhr 请求数量</li>\n<li>85% 页面可见耗时 5 次耗时中位数（s）</li>\n</ol>\n<h1 id="其他"><a href="#%E5%85%B6%E4%BB%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他</h1>\n<p>在性能测试的过程中，发现 nginx 没有开启 gzip，需要配置一下 nginx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83853011600928900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gzip on;\ngzip_comp_level 6;         # 压缩等级，1-9，推荐 5~6，数值越大压缩率越高但 CPU 占用更高\ngzip_min_length 1k;        # 只压缩大于 1k 的响应体\ngzip_buffers 16 8k;        # 压缩缓冲区设置\ngzip_http_version 1.1;     # 默认即可，http/1.1及以上\ngzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript image/svg+xml; # 需要压缩的内容类型\ngzip_vary on;              # 响应头增加 Vary: Accept-Encoding，便于代理缓存\ngzip_proxied any;          # 允许代理服务器压缩\ngzip_disable &quot;msie6&quot;;      # 禁用 IE6 gzip\n\n# 可选: 避免对图片、压缩包等二进制文件压缩\n# gzip_types 省略常见的二进制类型，如 image/*, application/zip, application/gzip`, `83853011600928900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="nginx"\n              >\n                <span class="gatsby-code-button-language">nginx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="nginx"><pre style="counter-reset: linenumber NaN" class="language-nginx line-numbers"><code class="language-nginx"><span class="token keyword">gzip</span> on<span class="token punctuation">;</span>\n<span class="token keyword">gzip_comp_level</span> <span class="token number">6</span><span class="token punctuation">;</span>         <span class="token comment"># 压缩等级，1-9，推荐 5~6，数值越大压缩率越高但 CPU 占用更高</span>\n<span class="token keyword">gzip_min_length</span> <span class="token number">1</span>k<span class="token punctuation">;</span>        <span class="token comment"># 只压缩大于 1k 的响应体</span>\n<span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8</span>k<span class="token punctuation">;</span>        <span class="token comment"># 压缩缓冲区设置</span>\n<span class="token keyword">gzip_http_version</span> <span class="token number">1.1</span><span class="token punctuation">;</span>     <span class="token comment"># 默认即可，http/1.1及以上</span>\n<span class="token keyword">gzip_types</span> text<span class="token operator">/</span>plain text<span class="token operator">/</span>css application<span class="token operator">/</span>json application<span class="token operator">/</span>javascript text<span class="token operator">/</span>xml application<span class="token operator">/</span>xml application<span class="token operator">/</span>xml<span class="token operator">+</span>rss text<span class="token operator">/</span>javascript image<span class="token operator">/</span>svg<span class="token operator">+</span>xml<span class="token punctuation">;</span> <span class="token comment"># 需要压缩的内容类型</span>\n<span class="token keyword">gzip_vary</span> on<span class="token punctuation">;</span>              <span class="token comment"># 响应头增加 Vary: Accept-Encoding，便于代理缓存</span>\n<span class="token keyword">gzip_proxied</span> any<span class="token punctuation">;</span>          <span class="token comment"># 允许代理服务器压缩</span>\n<span class="token keyword">gzip_disable</span> <span class="token string">"msie6"</span><span class="token punctuation">;</span>      <span class="token comment"># 禁用 IE6 gzip</span>\n\n<span class="token comment"># 可选: 避免对图片、压缩包等二进制文件压缩</span>\n<span class="token comment"># gzip_types 省略常见的二进制类型，如 image/*, application/zip, application/gzip</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/前端性能测试工具/index.md absPath of file >>> MarkdownRemark",timeToRead:8,frontmatter:{date:"2025-10-24 11:23:45",path:"/frontend-performance-testing-tools/",tags:"前端, 性能测试, 预研",title:"前端性能测试工具",draft:null}},{excerpt:"介绍 dbgate 支持多种数据库连接，详见  https://github.com/dbgate/dbgate?tab=readme-ov-file Dockerfile 以下是开发过程中用到的连接格式 启动 打开  http://localhost:3010",html:'<h1 id="介绍"><a href="#%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>介绍</h1>\n<p>dbgate 支持多种数据库连接，详见 <a href="https://github.com/dbgate/dbgate?tab=readme-ov-file" target="_blank" rel="nofollow noreferrer noopener">https://github.com/dbgate/dbgate?tab=readme-ov-file</a></p>\n<h1 id="dockerfile"><a href="#dockerfile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile</h1>\n<p>以下是开发过程中用到的连接格式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66125897391640190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`version: \'3\'\nservices:\n   dbgate:\n      image: dbgate/dbgate\n      restart: always\n      # network_mode: host\n      extra_hosts:\n         - \'host.docker.internal:host-gateway\'\n      ports:\n         - 3010:3000\n      volumes:\n         - dbgate-data:/root/.dbgate\n      environment:\n         # LOGIN: user1,user2\n\n         # 这里可以配置登录用户的账号密码，不配置的默认不要密码\n         # LOGIN_PASSWORD_user1: xxxx\n         # LOGIN_PASSWORD_user2: xxxx\n\n         # 这里配置哪些用户能看到哪些数据库连接\n         # LOGIN_PERMISSIONS_user1: ~connections/*,connections/con1,connections/con2\n         # LOGIN_PERMISSIONS_user2: ~connections/*,connections/con3\n\n         CONNECTIONS: con1,con2,con3\n\n         LABEL_con1: 正式服\n         SERVER_con1: xxxx\n         USER_con1: xxxx\n         PASSWORD_con1: xxxx\n         PORT_con1: 5432\n         ENGINE_con1: postgres@dbgate-plugin-postgres\n\n         LABEL_con2: 正式服\n         # 格式为：mongodb://用户名:密码@地址:端口/数据库名\n         # 密码里面遇到 # 需要转义成 %23\n         # 遇到不是分片的 mongo 数据库时候需要加上 ?directConnection=true 查询字符串\n         URL_con2: xxxx\n         ENGINE_con2: mongo@dbgate-plugin-mongo\n\n         LABEL_con3: 本地（读写）\n         SERVER_con3: host.docker.internal\n         PORT_con3: 6379\n         ENGINE_con3: redis@dbgate-plugin-redis\n\nvolumes:\n   dbgate-data:\n      driver: local`, `66125897391640190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="yml"\n              >\n                <span class="gatsby-code-button-language">yml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="yml"><pre style="counter-reset: linenumber NaN" class="language-yml line-numbers"><code class="language-yml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'3\'</span>\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n   <span class="token key atrule">dbgate</span><span class="token punctuation">:</span>\n      <span class="token key atrule">image</span><span class="token punctuation">:</span> dbgate/dbgate\n      <span class="token key atrule">restart</span><span class="token punctuation">:</span> always\n      <span class="token comment"># network_mode: host</span>\n      <span class="token key atrule">extra_hosts</span><span class="token punctuation">:</span>\n         <span class="token punctuation">-</span> <span class="token string">\'host.docker.internal:host-gateway\'</span>\n      <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n         <span class="token punctuation">-</span> 3010<span class="token punctuation">:</span><span class="token number">3000</span>\n      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n         <span class="token punctuation">-</span> dbgate<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/root/.dbgate\n      <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n         <span class="token comment"># LOGIN: user1,user2</span>\n\n         <span class="token comment"># 这里可以配置登录用户的账号密码，不配置的默认不要密码</span>\n         <span class="token comment"># LOGIN_PASSWORD_user1: xxxx</span>\n         <span class="token comment"># LOGIN_PASSWORD_user2: xxxx</span>\n\n         <span class="token comment"># 这里配置哪些用户能看到哪些数据库连接</span>\n         <span class="token comment"># LOGIN_PERMISSIONS_user1: ~connections/*,connections/con1,connections/con2</span>\n         <span class="token comment"># LOGIN_PERMISSIONS_user2: ~connections/*,connections/con3</span>\n\n         <span class="token key atrule">CONNECTIONS</span><span class="token punctuation">:</span> con1<span class="token punctuation">,</span>con2<span class="token punctuation">,</span>con3\n\n         <span class="token key atrule">LABEL_con1</span><span class="token punctuation">:</span> 正式服\n         <span class="token key atrule">SERVER_con1</span><span class="token punctuation">:</span> xxxx\n         <span class="token key atrule">USER_con1</span><span class="token punctuation">:</span> xxxx\n         <span class="token key atrule">PASSWORD_con1</span><span class="token punctuation">:</span> xxxx\n         <span class="token key atrule">PORT_con1</span><span class="token punctuation">:</span> <span class="token number">5432</span>\n         <span class="token key atrule">ENGINE_con1</span><span class="token punctuation">:</span> postgres@dbgate<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>postgres\n\n         <span class="token key atrule">LABEL_con2</span><span class="token punctuation">:</span> 正式服\n         <span class="token comment"># 格式为：mongodb://用户名:密码@地址:端口/数据库名</span>\n         <span class="token comment"># 密码里面遇到 # 需要转义成 %23</span>\n         <span class="token comment"># 遇到不是分片的 mongo 数据库时候需要加上 ?directConnection=true 查询字符串</span>\n         <span class="token key atrule">URL_con2</span><span class="token punctuation">:</span> xxxx\n         <span class="token key atrule">ENGINE_con2</span><span class="token punctuation">:</span> mongo@dbgate<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>mongo\n\n         <span class="token key atrule">LABEL_con3</span><span class="token punctuation">:</span> 本地（读写）\n         <span class="token key atrule">SERVER_con3</span><span class="token punctuation">:</span> host.docker.internal\n         <span class="token key atrule">PORT_con3</span><span class="token punctuation">:</span> <span class="token number">6379</span>\n         <span class="token key atrule">ENGINE_con3</span><span class="token punctuation">:</span> redis@dbgate<span class="token punctuation">-</span>plugin<span class="token punctuation">-</span>redis\n\n<span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n   <span class="token key atrule">dbgate-data</span><span class="token punctuation">:</span>\n      <span class="token key atrule">driver</span><span class="token punctuation">:</span> local</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="启动"><a href="#%E5%90%AF%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>启动</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83617378356272870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`docker-compose -f ./dbgate.yml up -d`, `83617378356272870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">docker-compose -f ./dbgate.yml up -d</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>打开 <a href="http://localhost:3010" target="_blank" rel="nofollow noreferrer noopener">http://localhost:3010</a></p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/开源数据库连接工具 web 版/index.md absPath of file >>> MarkdownRemark",timeToRead:1,frontmatter:{date:"2025-10-23 16:40:42",path:"/database-connection-tool-web-based/",tags:"后端, 数据库, 预研",title:"数据库连接工具 web 版",draft:null}},{excerpt:"背景 目前老项目使用的 redux 性能较差且难上手/代码复杂，useContext 虽然使用上简单但性能较差，需要选型一个易上手/性能好/组件化的三方库，以下是 redux/useContext 在处理复杂业务时的缺点 组件间的状态共享只能通过将 state 提升至它们的公共祖先来实现，但这样做可能导致重新渲染一颗巨大的组件树（管理成本和子组件意外渲染问题） Context…",html:'<h1 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h1>\n<p>目前老项目使用的 redux 性能较差且难上手/代码复杂，useContext 虽然使用上简单但性能较差，需要选型一个易上手/性能好/组件化的三方库，以下是 redux/useContext 在处理复杂业务时的缺点</p>\n<ol>\n<li>组件间的状态共享只能通过将 state 提升至它们的公共祖先来实现，但这样做可能导致重新渲染一颗巨大的组件树（管理成本和子组件意外渲染问题）</li>\n<li>Context 只能存储单一值，无法存储多个各自拥有消费者的值的集合</li>\n<li>以上两种方式都很难将组件树的顶层与子组件进行代码分割</li>\n<li>useContext 也没有提供对异步请求的解决方案，redux 虽然有但较难上手</li>\n</ol>\n<h1 id="目标"><a href="#%E7%9B%AE%E6%A0%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目标</h1>\n<p>提供一种机制来管理和维护 React 应用中的状态，并且使得这些状态能够跨组件共享、状态的变化可以预测</p>\n<ol>\n<li>做到数据共享，兼顾子组件精准渲染</li>\n<li>获取和修改状态</li>\n<li>管理异步工作流</li>\n</ol>\n<h1 id="模式"><a href="#%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式</h1>\n<h2 id="store"><a href="#store" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Store</h2>\n<p>Store 模式通过集中式的存储来管理应用的状态，这种模式的基本思想是将应用的所有状态存储在一个单一的地方，通常称为“store”。组件通过与 store 的交互来读取和更新状态，而不是直接在组件内部管理状态</p>\n<p>Redux、Zustand 正是使用了 store 模式设计，Redux 官网的 gif 很好的演示了 redux 中数据流动的方向及 Store、 Dispach、Action、Reducer 的配合过程</p>\n<p><img src="/static/2025-10-22-18-43-58-edcdc14f32727d2aa89fe335da19034b.gif"></p>\n<h2 id="响应"><a href="#%E5%93%8D%E5%BA%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>响应</h2>\n<p>响应模式是一种通过观察（observe）状态变化并自动更新界面的方法。这种模式的核心思想是，当数据发生变化时，界面能够自动地响应并更新显示，可以使得状态管理更加直观、高效和模块化</p>\n<p>MobX、Valtio 都使用了响应模式，MobX 官网流程图很好的解释了其 data flow</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-23-10-47-41-ab316e215018c0c656602e5ce3a3f29b-a9fd5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 21.5625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAApElEQVQI112NzQuCQBDF/ev7eyro2sGTYJEHLwUmJBTiB7qu7syuOzbrB0S/y7zHm8fzpJRN21bp9R2dqiRk2wlxuDx3+/AcZwOnTfN4BUF8zOtUCFnleRbd7r5fJIk3zWjEuviMxhA5a63tFFpLS2qMUTCM1q52HLXWLNbyRJMCVArUDB8EBQBlWfIygnMuGBysiEeItvIPtMGaX5eRPxCx7/svkVzkrDJb6KUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 23 10 47 41" title="" data-src="/static/2025-10-23-10-47-41-ab316e215018c0c656602e5ce3a3f29b-fee1c.png" data-srcset="/static/2025-10-23-10-47-41-ab316e215018c0c656602e5ce3a3f29b-a67b7.png 200w,\n/static/2025-10-23-10-47-41-ab316e215018c0c656602e5ce3a3f29b-0b187.png 400w,\n/static/2025-10-23-10-47-41-ab316e215018c0c656602e5ce3a3f29b-fee1c.png 800w,\n/static/2025-10-23-10-47-41-ab316e215018c0c656602e5ce3a3f29b-b1a91.png 1200w,\n/static/2025-10-23-10-47-41-ab316e215018c0c656602e5ce3a3f29b-a9fd5.png 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="原子"><a href="#%E5%8E%9F%E5%AD%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原子</h2>\n<p>不同于 Store 模式和响应模式把 State 集中起来管理，状态维护在组件顶部，子组件需要的话通过 selector 按需获取，数据自上向下流动。原子模式提倡把应用的全局状态拆分为多个小的、独立的状态单元——这些状态单元被称为原子（Atom），提供更细粒度的状态管理，以便组件可以更高效地更新和渲染</p>\n<p>原子模式是对 useState + useContext 的升级，原子模式的代表作是 Recoil 和 Jotai</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-23-10-56-17-090276aed9e3109dd178671828683c3d-a9fd5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 51.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABqklEQVQoz01SPZPTMBDNf6ajo6SCoaGm4KOAoYAGuoOBYYDhiM85X85OnPgs2Y5iR9+yJX+wtpm7e6NZP8na3bdvtIjjOAgC55rKf6bpXkSvzNGXyUeJv5riBw3fDMPQd+0wfnoI3YR+4ouiKBBCwHR9ImUiGZGs7DunRNV1zijmbANLsOOU3g33sLhl/dDrmtm+ef/80db7+evzu+8fXq5/f/n04slN6L99+pAS9Prxg+j6KoyiPMvGZBAAMpxzEE0jbWfj9Z/jISVJhEKPAtsEklMUXtzgw7ezs0107V2MkFKOnRljwLTWjFFS5nVjhRGMFlpQJSjMp7QpTgrlVYhOcLOqKkJIXddjctu2SinYLJfebh9LxeCwVqeCoEOWCM6LSlrXgkfBBiul72aefQPZnPMsy61tGqestTjZSsmzksS7bYZS8JVUPK8UF1Ir1U+4M2zuD0QqfnnpX/nLKE64aoQsA//varU691braAcSoL4x5r/bc5m5vxACRtrvE4yzNE2hSVmWQLIRGGNEKYU7eZ6DU4vbzP7eG5jJXA4UzX/ntwHRToDzf73vL2xIupl3AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 23 10 56 17" title="" data-src="/static/2025-10-23-10-56-17-090276aed9e3109dd178671828683c3d-fee1c.png" data-srcset="/static/2025-10-23-10-56-17-090276aed9e3109dd178671828683c3d-a67b7.png 200w,\n/static/2025-10-23-10-56-17-090276aed9e3109dd178671828683c3d-0b187.png 400w,\n/static/2025-10-23-10-56-17-090276aed9e3109dd178671828683c3d-fee1c.png 800w,\n/static/2025-10-23-10-56-17-090276aed9e3109dd178671828683c3d-b1a91.png 1200w,\n/static/2025-10-23-10-56-17-090276aed9e3109dd178671828683c3d-a9fd5.png 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="状态机"><a href="#%E7%8A%B6%E6%80%81%E6%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>状态机</h2>\n<p>状态机是一种数学模型，它描述了在任何给定时间只能处于一种状态的系统，系统在不同的状态之间可以通过确定的事件进行转化</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-23-10-56-28-215f7f0632ac27f4ecb13d83e21181c8-180cb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 780px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.84615384615385%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB10lEQVQoz2WS22sTQRTG+4/5KPjkv2EpPlhqoGgUpUR8ExEU9UFp8R68gJKq8YKiqTam2WSz7U67t5nZ2ZnJXjKz2ZhERacJbZMKv4dhON+c7ztnZhBLx0AqvUA4pGPjyPGTq0V+4S5bWmHn79AvjRgFse0nqkCxL5nZV5KwF6V/dtCuUrG0HORu0sXbdP568L7KgzDdtBlLBrwzhHRCPFZqhvvo6erjZ68fFkuf15oy60ciVcis50BefFFevv/8wZNXbz9+w7x7IFZOuPhVKldm506fyRfmTuZu3LrXFkPMJWaSJ/3vG+aJ2YWz5y7NL+QLl6+pTojKA9uj/qmNY1W3A0OPyoYlNoCob4saEABKGHTqhgsc5pHO4cxj1JMWii3I15rsaA4eW0TH8/jIKVhYwYTFACUkHgTJAI7a/ieOB347UylcInRbIQ1HqoPld8E21H/UgN6qr9dI1IeHbCtaumnBCPIM85S09+C749w03dUrFxuf3hgtE7enM8ORZ6Na4Q6IxU9vz9gYlVMO/6baO/C17Ce/0ZRtKv2o39KavlGD6x9iFqitwonPQ8LMQZT4KEm6Hk2nB6bEYW8LuJXSy3pVM50AUTHZWS1W2/J0E1o4mrz/Bx30ODHeQb04AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 23 10 56 28" title="" data-src="/static/2025-10-23-10-56-28-215f7f0632ac27f4ecb13d83e21181c8-180cb.png" data-srcset="/static/2025-10-23-10-56-28-215f7f0632ac27f4ecb13d83e21181c8-b84dc.png 200w,\n/static/2025-10-23-10-56-28-215f7f0632ac27f4ecb13d83e21181c8-8d9eb.png 400w,\n/static/2025-10-23-10-56-28-215f7f0632ac27f4ecb13d83e21181c8-180cb.png 780w" data-sizes="(max-width: 780px) 100vw, 780px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="选型"><a href="#%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型</h1>\n<table>\n<thead>\n<tr>\n<th>状态库</th>\n<th align="right">响应粒度</th>\n<th align="right">API 简洁度</th>\n<th align="right">性能</th>\n<th align="right">类型支持</th>\n<th align="right">异步处理</th>\n<th align="right">持久化/中间件</th>\n<th align="right">DevTools</th>\n<th align="right">社区生态</th>\n<th align="right">应用规模</th>\n<th>适用场景/特点</th>\n<th>适用具体范围</th>\n<th>优点</th>\n<th>缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Context API</td>\n<td align="right">粗粒度</td>\n<td align="right">简单</td>\n<td align="right">一般</td>\n<td align="right">完善</td>\n<td align="right">需手动</td>\n<td align="right">需手动</td>\n<td align="right">无</td>\n<td align="right">极成熟</td>\n<td align="right">小/中</td>\n<td>全局共享、简单场景，易用</td>\n<td><ol>\n<li>\n应用中全局状态较少、简单的场景；\n</li>\n<li>\n如主题切换、登录状态、国际化等\n</li>\n</ol></td>\n<td><ol>\n<li>\n无需额外安装库，官方内置；\n</li>\n<li>\n简单易用，轻量级；\n</li>\n<li>\n适合简单的全局状态共享（如主题、语言）\n</li>\n</ol></td>\n<td><ol>\n<li>\n性能较差，任何 context 改变会导致所有消费组件重渲染；\n</li>\n<li>\n不适合管理复杂状态\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>Redux</td>\n<td align="right">粗粒度</td>\n<td align="right">复杂</td>\n<td align="right">一般</td>\n<td align="right">完善</td>\n<td align="right">完善</td>\n<td align="right">完善</td>\n<td align="right">强（Redux DevTools）</td>\n<td align="right">极成熟</td>\n<td align="right">中/大</td>\n<td>可预测性、可扩展性、生态强</td>\n<td><ol>\n<li>\n复杂的大型应用，业务逻辑复杂，状态交互频繁；\n</li>\n<li>\n需要时间旅行、调试工具、可预测性强的场景\n</li>\n</ol></td>\n<td><ol>\n<li>\n社区成熟，生态丰富（如 Redux Toolkit）；\n</li>\n<li>\n可预测性强，状态集中管理；\n</li>\n<li>\n易于调试，工具支持好（Redux DevTools）；\n</li>\n<li>\n与 React 以外的框架也可结合使用\n</li>\n</ol></td>\n<td><ol>\n<li>\n写法繁琐（action、reducer、store 等），模板代码多；\n</li>\n<li>\n学习曲线较高；\n</li>\n<li>\n对于简单场景显得“重”\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>MobX</td>\n<td align="right">中等粒度</td>\n<td align="right">简单</td>\n<td align="right">高</td>\n<td align="right">完善</td>\n<td align="right">支持</td>\n<td align="right">支持</td>\n<td align="right">有</td>\n<td align="right">成熟</td>\n<td align="right">中/大</td>\n<td>响应式、面向对象、灵活</td>\n<td><ol>\n<li>\n中小型项目；\n</li>\n<li>\n对响应式编程有需求；\n</li>\n<li>\n不需要严格的状态可预测性\n</li>\n</ol></td>\n<td><ol>\n<li>\n使用简单，代码量少，响应式编程体验好；\n</li>\n<li>\n自动追踪依赖，数据变化自动更新视图；\n</li>\n<li>\n学习成本低，易于集成\n</li>\n</ol></td>\n<td><ol>\n<li>\n状态分散，不易全局管控；\n</li>\n<li>\n调试和开发工具支持较 Redux 差；\n</li>\n<li>\n难以追踪复杂的状态变更\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>Recoil</td>\n<td align="right">原子粒度</td>\n<td align="right">适中</td>\n<td align="right">高</td>\n<td align="right">完善</td>\n<td align="right">完善</td>\n<td align="right">需手动</td>\n<td align="right">有（Recoil DevTools）</td>\n<td align="right">较成熟</td>\n<td align="right">中/大</td>\n<td>原子+选择器、复杂依赖关系</td>\n<td><ol>\n<li>\n中大型应用；\n</li>\n<li>\n需要细粒度状态管理和较高性能的场景\n</li>\n</ol></td>\n<td><ol>\n<li>\n原生支持 React，API 简洁；\n</li>\n<li>\n支持原子化状态管理，细粒度控制；\n</li>\n<li>\n性能优秀，支持异步 selector\n</li>\n</ol></td>\n<td><ol>\n<li>\n社区和生态相对较小；\n</li>\n<li>\n有些高级用法不如 Redux 成熟\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>Zustand</td>\n<td align="right">任意粒度</td>\n<td align="right">极简</td>\n<td align="right">高</td>\n<td align="right">完善</td>\n<td align="right">需手动</td>\n<td align="right">完善</td>\n<td align="right">有（Zustand DevTools）</td>\n<td align="right">极成熟</td>\n<td align="right">小/中/大</td>\n<td>Hook 风格、中间件、极简</td>\n<td><ol>\n<li>\n中小型应用；\n</li>\n<li>\n想要简单高效状态管理的场景；\n</li>\n</ol></td>\n<td><ol>\n<li>\nAPI 极简，零模板代码\n</li>\n<li>\n性能好，支持局部订阅；\n</li>\n<li>\n支持 hooks，易于集成\n</li>\n</ol></td>\n<td><ol>\n<li>\n社区相对较小；\n</li>\n<li>\n功能不如 Redux 完善，如中间件、调试工具等较弱\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>Jotai</td>\n<td align="right">原子粒度</td>\n<td align="right">极简</td>\n<td align="right">高</td>\n<td align="right">完善</td>\n<td align="right">支持</td>\n<td align="right">需手动</td>\n<td align="right">有（Jotai DevTools）</td>\n<td align="right">新兴</td>\n<td align="right">小/中</td>\n<td>函数式、原子化、极简</td>\n<td><ol>\n<li>\n轻量级项目；\n</li>\n<li>\n需要响应式原子状态的场景\n</li>\n</ol></td>\n<td><ol>\n<li>\n响应式原子状态，API 简单；\n</li>\n<li>\n体积小，性能优秀\n</li>\n</ol></td>\n<td><ol>\n<li>\n社区还在成长；\n</li>\n<li>\n功能相对精简\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>XState</td>\n<td align="right">状态机/流程</td>\n<td align="right">复杂</td>\n<td align="right">高</td>\n<td align="right">完善</td>\n<td align="right">完善</td>\n<td align="right">支持</td>\n<td align="right">有</td>\n<td align="right">成熟</td>\n<td align="right">中/大</td>\n<td>复杂业务流程、可视化</td>\n<td>多状态流转、流程编排、复杂异步与副作用管理</td>\n<td><ol>\n<li>\n可视化与状态图；\n</li>\n<li>\n严格的状态流转；\n</li>\n<li>\n适合复杂业务流程建模\n</li>\n</ol></td>\n<td><ol>\n<li>\n学习曲线高；心智模型重；\n</li>\n<li>\n在简单场景偏重\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>Preact Signals</td>\n<td align="right">极细粒度</td>\n<td align="right">极简</td>\n<td align="right">极高</td>\n<td align="right">好</td>\n<td align="right">需手动</td>\n<td align="right">需手动</td>\n<td align="right">有限</td>\n<td align="right">新兴</td>\n<td align="right">小/中</td>\n<td>微秒级响应、性能极致</td>\n<td><ol>\n<li>\n极致性能需求的组件局部状态；\n</li>\n<li>\n频繁更新的 UI\n</li>\n</ol></td>\n<td><ol>\n<li>\n超高性能；\n</li>\n<li>\n信号机制带来精准更新；\n</li>\n<li>\n极小 API\n</li>\n</ol></td>\n<td><ol>\n<li>\n生态有限；\n</li>\n<li>\nDevTools 支持弱；\n</li>\n<li>\n需手动做异步与持久化方案\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>Pinia</td>\n<td align="right">原子/模块粒度</td>\n<td align="right">简单</td>\n<td align="right">高</td>\n<td align="right">完善</td>\n<td align="right">支持</td>\n<td align="right">支持</td>\n<td align="right">有</td>\n<td align="right">成熟</td>\n<td align="right">小/中/大</td>\n<td>Vue 原生、社区有 React 适配</td>\n<td><ol>\n<li>\n跨框架（主要 Vue）或在微前端中复用；\n</li>\n<li>\n模块化状态\n</li>\n</ol></td>\n<td><ol>\n<li>\nAPI 直观；\n</li>\n<li>\n模块/插件生态好；\n</li>\n<li>\n类型友好\n</li>\n</ol></td>\n<td><ol>\n<li>\n在纯 React 项目里并非主流；\n</li>\n<li>\n适配层可能增加复杂度\n</li>\n</ol></td>\n</tr>\n<tr>\n<td>helux</td>\n<td align="right">极细粒度</td>\n<td align="right">丰富</td>\n<td align="right">极高</td>\n<td align="right">极好</td>\n<td align="right">完善</td>\n<td align="right">有限/需手动</td>\n<td align="right">有</td>\n<td align="right">新兴</td>\n<td align="right">小/中</td>\n<td>响应式+按需渲染、类型友好</td>\n<td>需要极细粒度渲染优化与强类型结合场景</td>\n<td><ol>\n<li>\n按需渲染性能优秀；\n</li>\n<li>\n类型支持出色；\n</li>\n<li>\n组合灵活\n</li>\n</ol></td>\n<td><ol>\n<li>\n生态新；\n</li>\n<li>\n文档与社区资源少；\n</li>\n<li>\n部分特性稳定性待验证\n</li>\n</ol></td>\n</tr>\n</tbody>\n</table>\n<h1 id="对比"><a href="#%E5%AF%B9%E6%AF%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对比</h1>\n<h2 id="代码"><a href="#%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码</h2>\n<h3 id="context-api"><a href="#context-api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Context API</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57718828834601620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { createContext, useContext, useState } from \'react\';\n\nconst DemoContext = createContext();\n\nconst DemoProvider = ({ children }) => {\n   const [count, setCount] = useState(0);\n   const [name, setName] = useState(\'Anonymous\');\n\n   return <DemoContext.Provider value={{ count, setCount, name, setName }}>{children}</DemoContext.Provider>;\n};\n\nconst GrandSonName = () => {\n   const { name } = useContext(DemoContext);\n   return (\n      <div style={{ border: \'1px #333 solid\' }}>\n         <h3>GrandSonName</h3>\n         <p>name: {name}</p>\n      </div>\n   );\n};\n\nconst GrandSonCount = () => {\n   const { count } = useContext(DemoContext);\n   return (\n      <div style={{ border: \'1px #333 solid\' }}>\n         <h3>GrandSonCount</h3>\n         <p>count: {count}</p>\n      </div>\n   );\n};\n\nconst Son1 = () => {\n   const { count, setCount, name } = useContext(DemoContext);\n\n   return (\n      <div style={{ border: \'1px #333 solid\', padding: 5 }}>\n         <h2>Child 1</h2>\n         <p>Count: {count}</p>\n         <p>Name: {name}</p>\n         <button onClick={() => setCount(count + 1)}>Increment Count</button>\n         <GrandSonName />\n         <GrandSonCount />\n      </div>\n   );\n};\n\nconst Son2 = () => {\n   const { name, setName } = useContext(DemoContext);\n\n   return (\n      <div style={{ border: \'1px #333 solid\', padding: 5, marginTop: 10 }}>\n         <h2>Child 2</h2>\n         <input type=\'text\' value={name} onChange={(e) => setName(e.target.value)} />\n         <GrandSonName />\n      </div>\n   );\n};\n\nconst Son3 = () => {\n   return (\n      <div style={{ border: \'1px #333 solid\', padding: 5, marginTop: 10 }}>\n         <h2>Child 3</h2>\n         <GrandSonName />\n         <GrandSonCount />\n      </div>\n   );\n};\n\nexport default function App() {\n   return (\n      <DemoProvider>\n         <Son1 />\n         <Son2 />\n         <Son3 />\n      </DemoProvider>\n   );\n}`, `57718828834601620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> createContext<span class="token punctuation">,</span> useContext<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> DemoContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">DemoProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">\'Anonymous\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DemoContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> count<span class="token punctuation">,</span> setCount<span class="token punctuation">,</span> name<span class="token punctuation">,</span> setName <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">DemoContext.Provider</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">GrandSonName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>DemoContext<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">GrandSonName</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">name: </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">GrandSonCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> count <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>DemoContext<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">GrandSonCount</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">count: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Son1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> count<span class="token punctuation">,</span> setCount<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>DemoContext<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span><span class="token punctuation">,</span> padding<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Child 1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Count: </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Name: </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Increment Count</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonName</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonCount</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Son2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> setName <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>DemoContext<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span><span class="token punctuation">,</span> padding<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> marginTop<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Child 2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>text<span class="token punctuation">\'</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonName</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Son3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span><span class="token punctuation">,</span> padding<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> marginTop<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Child 3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonName</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonCount</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DemoProvider</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son3</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">DemoProvider</span></span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="helux"><a href="#helux" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>helux</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54206542782679155000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { sharex, \\$, useAtom } from \'helux\';\nimport React from \'react\';\n\nconst GlobalModel = sharex({\n   count: 1,\n   name: \'Anonymous\'\n});\n\nconst { state, setState } = GlobalModel;\n\nconst GrandSonName = () => {\n   return (\n      <div style={{ border: \'1px #333 solid\' }}>\n         <h3>GrandSonName</h3>\n         <p>name: {\\$(state.name)}</p>\n      </div>\n   );\n};\n\nconst GrandSonCount = () => {\n   return (\n      <div style={{ border: \'1px #333 solid\' }}>\n         <h3>GrandSonCount</h3>\n         <p>count: {\\$(state.count)}</p>\n      </div>\n   );\n};\n\nconst Son1 = () => {\n   return (\n      <div style={{ border: \'1px #333 solid\', padding: 5 }}>\n         <h2>Child 1</h2>\n         <p>Count: {\\$(state.count)}</p>\n         <p>Name: {\\$(state.name)}</p>\n         <button\n            onClick={() =>\n               setState((draft) => {\n                  draft.count += 1;\n               })\n            }\n         >\n            Increment Count\n         </button>\n         <GrandSonName />\n         <GrandSonCount />\n      </div>\n   );\n};\n\n// 这里需要抽出一个组件，否则依然会有性能问题\nconst Input = () => {\n   const [dictState] = useAtom(state);\n   return (\n      <input\n         type=\'text\'\n         value={dictState.name}\n         onChange={(e) => {\n            setState((draft) => {\n               draft.name = e.target.value;\n            });\n         }}\n      />\n   );\n};\n\nconst Son2 = () => {\n   return (\n      <div style={{ border: \'1px #333 solid\', padding: 5, marginTop: 10 }}>\n         <h2>Child 2</h2>\n         <Input />\n         <GrandSonName />\n      </div>\n   );\n};\n\nconst Son3 = () => {\n   return (\n      <div style={{ border: \'1px #333 solid\', padding: 5, marginTop: 10 }}>\n         <h2>Child 3</h2>\n         <GrandSonName />\n         <GrandSonCount />\n      </div>\n   );\n};\n\nexport default function App() {\n   return (\n      <>\n         <Son1 />\n         <Son2 />\n         <Son3 />\n      </>\n   );\n}`, `54206542782679155000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> sharex<span class="token punctuation">,</span> $<span class="token punctuation">,</span> useAtom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'helux\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> GlobalModel <span class="token operator">=</span> <span class="token function">sharex</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'Anonymous\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> GlobalModel<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">GrandSonName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">GrandSonName</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">name: </span><span class="token punctuation">{</span><span class="token function">$</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">GrandSonCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">GrandSonCount</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">count: </span><span class="token punctuation">{</span><span class="token function">$</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Son1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span><span class="token punctuation">,</span> padding<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Child 1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Count: </span><span class="token punctuation">{</span><span class="token function">$</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Name: </span><span class="token punctuation">{</span><span class="token function">$</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>\n            <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n               <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  draft<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span></span>\n         <span class="token punctuation">></span></span><span class="token plain-text">\n            Increment Count\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonName</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonCount</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 这里需要抽出一个组件，否则依然会有性能问题</span>\n<span class="token keyword">const</span> <span class="token function-variable function">Input</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>dictState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAtom</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>\n         <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>text<span class="token punctuation">\'</span></span>\n         <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>dictState<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>\n         <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n               draft<span class="token punctuation">.</span>name <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n      <span class="token punctuation">/></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Son2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span><span class="token punctuation">,</span> padding<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> marginTop<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Child 2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonName</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Son3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> border<span class="token punctuation">:</span> <span class="token string">\'1px #333 solid\'</span><span class="token punctuation">,</span> padding<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> marginTop<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Child 3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonName</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GrandSonCount</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son1</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son2</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Son3</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="效果"><a href="#%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>效果</h2>\n<table>\n<thead>\n<tr>\n<th>状态库</th>\n<th>React 层重渲染</th>\n<th>浏览器重渲染</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Context API</td>\n<td><html><head></head><body><video style="max-width: 200px" data-src="/examples/react-global-state-selection/1.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></td>\n<td><html><head></head><body><video style="max-width: 200px" data-src="/examples/react-global-state-selection/2.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></td>\n</tr>\n<tr>\n<td>helux</td>\n<td><html><head></head><body><video style="max-width: 200px" data-src="/examples/react-global-state-selection/3.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></td>\n<td><html><head></head><body><video style="max-width: 200px" data-src="/examples/react-global-state-selection/4.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></td>\n</tr>\n</tbody>\n</table>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>以 React 层重渲染（即组件是否触发 render）为准，此标准比浏览器重渲染更高，由上面的视频可得出以下结论</p>\n<ol>\n<li>\n<p>虽然最终浏览器重渲染的效果一样，但 helux 对比 Context API 明显在 React 层性能更好，归功于 helux 的 dom 粒度更新</p>\n</li>\n<li>\n<p>helux 的 signal 语法只适用于展示型即普通的 dom 元素，无法适用于 react 组件，需要使用 useAtom 转换为真实状态，但此时就失去了 dom 粒度更新的优势，需要将 react 组件抽出一个单独组件防止性能劣化</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-23-14-52-50-918985131cae7518d0d4bfd63ac071fe-2517a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.70190274841438%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABV0lEQVQoz5VRi2rCUAztb4z1vl+5r97WWq06piJujLH//52lVoTBcO4QckvJyUlOKhcTFYxqjlFzQiQjimNQzWrOCKF3UCkfSszvm9XbdnkY+kObjl04LvJLVzbOSMbu0CsdUrGwb8dlLJ2PC2vXYAaAhYu9lH+QbcyE0aF0p3G3S6kHP/gwaC1J/VTfHRrJLmXOee/Dx+l8Opx3q822H1Y+eqUYglL2G65kQLKQXAhoCpTWpCLBy9h069E6hxVCCKUkZjmlK+YWlQkRyVorJnDSml78ZfQh4M5JKkkuoP9EZUMUBgC8s0oILjiqTm3mZvPHVIh5ip9kyFlIE1MXG7xOhNQoY53Vbds6hdtqm4oyRoM3IRtU0PK2VhVKeaZsDOFz//q1HvqMl0N9LpXCKfAQQio+PWLylfOb1RPZl4LFAXxqcvCg5/0fHBuV8Qb4syZo9v9s+wYKvGpzilWPowAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 23 14 52 50" title="" data-src="/static/2025-10-23-14-52-50-918985131cae7518d0d4bfd63ac071fe-fee1c.png" data-srcset="/static/2025-10-23-14-52-50-918985131cae7518d0d4bfd63ac071fe-a67b7.png 200w,\n/static/2025-10-23-14-52-50-918985131cae7518d0d4bfd63ac071fe-0b187.png 400w,\n/static/2025-10-23-14-52-50-918985131cae7518d0d4bfd63ac071fe-fee1c.png 800w,\n/static/2025-10-23-14-52-50-918985131cae7518d0d4bfd63ac071fe-2517a.png 946w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ol>\n<h1 id="快速上手"><a href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>快速上手</h1>\n<p><a href="https://heluxjs.github.io/helux/" target="_blank" rel="nofollow noreferrer noopener">https://heluxjs.github.io/helux/</a></p>\n<h2 id="全局状态"><a href="#%E5%85%A8%E5%B1%80%E7%8A%B6%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全局状态</h2>\n<p>文件夹结构</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71950683103709200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`├── model\n│   ├── actions.js\n│   ├── index.js\n│   └── state.js`, `71950683103709200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">├── model\n│   ├── actions.js\n│   ├── index.js\n│   └── state.js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>index.js</p>\n<p>导出主入口</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66030519737152905000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { \\$, useAtom } from \'helux\';\n\nimport { GlobalState } from \'./state\';\nimport * as actions from \'./actions\'; // action 函数定义\n\nexport default GlobalState;\n\nexport const action = GlobalState.defineActions()(actions);\n\nconst { state, setState } = GlobalState;\n\nexport { \\$, useAtom, state, setState };`, `66030519737152905000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> $<span class="token punctuation">,</span> useAtom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'helux\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> GlobalState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./state\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> actions <span class="token keyword">from</span> <span class="token string">\'./actions\'</span><span class="token punctuation">;</span> <span class="token comment">// action 函数定义</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> GlobalState<span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> action <span class="token operator">=</span> GlobalState<span class="token punctuation">.</span><span class="token function">defineActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>actions<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token operator">=</span> GlobalState<span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token punctuation">{</span> $<span class="token punctuation">,</span> useAtom<span class="token punctuation">,</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>state.js</p>\n<p>全局状态定义</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95620107700690520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { sharex } from \'helux\';\n\nexport const GlobalState = sharex(\n   {\n      key: null,\n      key2: null,\n      jobInfo: {}\n   },\n   { moduleName: \'JobDetailState\' }\n);`, `95620107700690520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> sharex <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'helux\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> GlobalState <span class="token operator">=</span> <span class="token function">sharex</span><span class="token punctuation">(</span>\n   <span class="token punctuation">{</span>\n      key<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n      key2<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n      jobInfo<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span> moduleName<span class="token punctuation">:</span> <span class="token string">\'JobDetailState\'</span> <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>actions.js</p>\n<p>异步 action 定义</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97813614537466760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { getJobInfo } from \'../services\';\n\nexport async function queryJobInfo({ draft, payload }) {\n   const [error, res] = await getJobInfo({ id: payload.jobId });\n   if (error) {\n      return null;\n   }\n   draft.jobInfo = res;\n   return res;\n}`, `97813614537466760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> getJobInfo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'../services\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">queryJobInfo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> draft<span class="token punctuation">,</span> payload <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> res<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getJobInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> payload<span class="token punctuation">.</span>jobId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   draft<span class="token punctuation">.</span>jobInfo <span class="token operator">=</span> res<span class="token punctuation">;</span>\n   <span class="token keyword">return</span> res<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="纯展示类型"><a href="#%E7%BA%AF%E5%B1%95%E7%A4%BA%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纯展示类型</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58306366843289210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { \\$, state, setState } from \'./model\';\n\n// 纯展示型即 dom 结点直接使用 signal 语法，即 \\$(state.key)\nexport default function Example() {\n   return (\n      <div>\n         <Button\n            onClick={() =>\n               setState((draft) => {\n                  draft.key += 1;\n               })\n            }\n         >\n            {\\$(state.key)}\n         </Button>\n      </div>\n   );\n}`, `58306366843289210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> $<span class="token punctuation">,</span> state<span class="token punctuation">,</span> setState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./model\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 纯展示型即 dom 结点直接使用 signal 语法，即 $(state.key)</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>\n            <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n               <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  draft<span class="token punctuation">.</span>key <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span></span>\n         <span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span><span class="token function">$</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-状态类型"><a href="#react-%E7%8A%B6%E6%80%81%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React 状态类型</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15882736728753754000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { \\$, state, setState, useAtom } from \'./model\';\n\n// 这里需要抽出一个组件隔离渲染，即 useAtom 会触发组件重渲染\nconst Input = () => {\n   const [dictState] = useAtom(state); // 由于下面使用了 key2，更新 key2 时才会触发重渲染，即更新 key 时不会触发重渲染\n   return (\n      <input\n         type=\'text\'\n         value={dictState.key2}\n         onChange={(e) => {\n            setState((draft) => {\n               draft.key2 = e.target.value;\n            });\n         }}\n      />\n   );\n};\n\n// React 组件由于需要取到原始值，需要使用 useAtom 包一下取出\nexport default function Example2() {\n   return (\n      <div>\n         <Input />\n         {\\$(state.key2)}\n      </div>\n   );\n}`, `15882736728753754000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> $<span class="token punctuation">,</span> state<span class="token punctuation">,</span> setState<span class="token punctuation">,</span> useAtom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./model\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 这里需要抽出一个组件隔离渲染，即 useAtom 会触发组件重渲染</span>\n<span class="token keyword">const</span> <span class="token function-variable function">Input</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>dictState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useAtom</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 由于下面使用了 key2，更新 key2 时才会触发重渲染，即更新 key 时不会触发重渲染</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>\n         <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>text<span class="token punctuation">\'</span></span>\n         <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>dictState<span class="token punctuation">.</span>key2<span class="token punctuation">}</span></span>\n         <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n               draft<span class="token punctuation">.</span>key2 <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n      <span class="token punctuation">/></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// React 组件由于需要取到原始值，需要使用 useAtom 包一下取出</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Example2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Input</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token punctuation">{</span><span class="token function">$</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>key2<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="异步请求类型"><a href="#%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步请求类型</h2>\n<p>这里将请求放到全局状态里面，而不是组件里面，推荐在全局状态和异步请求有关时，优先在这里去请求，理由如下</p>\n<ol>\n<li>\n<p>为了避免组件的重渲染，即如果请求在顶级组件的话，那么所有组件都会重渲染</p>\n</li>\n<li>\n<p>写成 action 也有利于调试，安装 <a href="https://chromewebstore.google.com/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd" target="_blank" rel="nofollow noreferrer noopener">Redux DevTools 插件</a></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-23-16-21-40-d54ab074942669dd475a45e76f6f881e-a9fd5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.96875%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABVklEQVQoz42QvUvDQBjG+6cougjSTVFwUEoHP8BKFdQ66SA4+d8I7pZ2kGqyilMGQXBqB6famqSlVtPc5e6SyyXx7SVI+qH48C539/7ueZ83E4ggGpUQgY2JZeNhDRBzfV+E0TRl/EgQ6mCEMMa2bXueN9kUSraH/Nvnr+rTp/aKE5iGvPPRbzZbumHqug78sFvWGNzue9ePvauHnvpiJTBYWo6HmYCSfeGEbaIpYzOXU+YiTAhlYGtZAzYqX0oIAbgIwrgSOP2Tpmm12p2qqkosVb1XlEqlelMuwyFeR3qEzE88uHUwLA4RQmB54Mk5f9eNw9Lpylr+/OKSMjYOp7NRKWBgTvgFUhimmcvvzsxlC8USBPsVhlSxJzBg22g06vV6p9stFI+XVjeOSmcYO385A+ykxLn31mqv57Zn57NbOwfw+l9YxqaQOb9ZXFhc3ts/mYS/AZ4ZWMKvhvwfAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 23 16 21 40" title="" data-src="/static/2025-10-23-16-21-40-d54ab074942669dd475a45e76f6f881e-fee1c.png" data-srcset="/static/2025-10-23-16-21-40-d54ab074942669dd475a45e76f6f881e-a67b7.png 200w,\n/static/2025-10-23-16-21-40-d54ab074942669dd475a45e76f6f881e-0b187.png 400w,\n/static/2025-10-23-16-21-40-d54ab074942669dd475a45e76f6f881e-fee1c.png 800w,\n/static/2025-10-23-16-21-40-d54ab074942669dd475a45e76f6f881e-b1a91.png 1200w,\n/static/2025-10-23-16-21-40-d54ab074942669dd475a45e76f6f881e-a9fd5.png 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2025-10-23-16-22-01-e038724b4b2b091ce38af2aef53bc906-055ed.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 119.09604519774012%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsSAAALEgHS3X78AAACQElEQVQ4y51U75OTMBDlP1ex7TnV8aanp//R+fE+6gfHTvlRIAkpkEBIIOAL6MzVoZ71DbNkIG/fZje73ufb7e7u9v7j7sPu/af7Oyzevb1Zr19t3ONvNv7Nxtn12l+t/O12g+fN6qXvv/Bf+174fR8nKcvzoiyLsiqrClbKulGqUe1sZV3zQhRCadO12jRNk6RZmlGPPT4mhJRFcTqdKocSC6UU55wxxidkWRbHMWM0TdI8Z8W0mfPcA8Pa3pgO6Pt+HMcaOpwTQpIkmckce4sCb7iglM5kwMMnFzBQFogHZCkEpIQQ+CKLoqtrU0sDKyVE7DBAo7e9tdYjhOY5p4QiyEoIR5YSZDnhlOd921qtB2tBgh2fwIN6WVawiLYz3TAMSA9iAxO+jTG9NrbrxiVAmUDZ6XMO/qyM04oJSPdgNDwuk13KKSUTGGVN4/IcRRHyDl/B4aCkHC/ASx2ZwQXIyBBEQDsej7DISxiFtVLYtyjtTQX6BTvlAwscFbJYwIuoLytf+jGTwzDkJ94qBXdXk3H4OIqCIEA9rybHcQTx/X6fkmz4dzIKhgsbBg5ZllaiGq8lZxPqplks9d/Cdq2XJJRRrO35xXyejFLP+v9TKq01xNFVdqlOz5CFlFopkPvpkl1BbtGJS+c8IyON9hx976YKTmu07ib8sWGiuJHgYQa4oYFB8hv44losy4hrFjLPtvIJMJEwFx8evni4PWhJ8Kfph1kisBstyhzyefrBzn8xNppafDvkX3+kcRT8BP+TVbxbS3rAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2025 10 23 16 22 01" title="" data-src="/static/2025-10-23-16-22-01-e038724b4b2b091ce38af2aef53bc906-fee1c.png" data-srcset="/static/2025-10-23-16-22-01-e038724b4b2b091ce38af2aef53bc906-a67b7.png 200w,\n/static/2025-10-23-16-22-01-e038724b4b2b091ce38af2aef53bc906-0b187.png 400w,\n/static/2025-10-23-16-22-01-e038724b4b2b091ce38af2aef53bc906-fee1c.png 800w,\n/static/2025-10-23-16-22-01-e038724b4b2b091ce38af2aef53bc906-055ed.png 885w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41265758608755876000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { \\$, state, setState, action } from \'./model\';\n\nconst JobDetail = ({ jobId }) => {\n   // const { queryJobInfo } = action.useLoading();\n   // console.log(\'useLoading\', queryJobInfo) // 请求的状态\n\n   const handleEvent = () => {\n      console.log(\'state.jobId\', state.jobInfo); // 事件触发的可以直接通过 state 拿到最新值\n   };\n\n   return (\n      <div className={styles.container}>\n         <Button\n            onClick={() =>\n               setState(async (draft) => {\n                  const data = await action.eActions.queryJobInfo({ jobId });\n                  console.log(\'data\', data);\n               })\n            }\n         >\n            {\\$(state.failedFNGPMetrics.total)} // 用 \\$ 或者 useAtom 取到\n         </Button>\n      </div>\n   );\n};\n\nexport default JobDetail;`, `41265758608755876000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> $<span class="token punctuation">,</span> state<span class="token punctuation">,</span> setState<span class="token punctuation">,</span> action <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./model\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">JobDetail</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> jobId <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token comment">// const { queryJobInfo } = action.useLoading();</span>\n   <span class="token comment">// console.log(\'useLoading\', queryJobInfo) // 请求的状态</span>\n\n   <span class="token keyword">const</span> <span class="token function-variable function">handleEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'state.jobId\'</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span>jobInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 事件触发的可以直接通过 state 拿到最新值</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>\n            <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n               <span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">draft</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> action<span class="token punctuation">.</span>eActions<span class="token punctuation">.</span><span class="token function">queryJobInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span> jobId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span></span>\n         <span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span><span class="token function">$</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>failedFNGPMetrics<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"> // 用 $ 或者 useAtom 取到\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> JobDetail<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="参考链接"><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参考链接</h1>\n<ol>\n<li><a href="https://juejin.cn/post/7172509907403407391" target="_blank" rel="nofollow noreferrer noopener">全都要!一文带你全面体验八种状态管理库</a></li>\n<li><a href="https://juejin.cn/post/7322840234365059084" target="_blank" rel="nofollow noreferrer noopener">你踩过 react 生态的 signal 坑吗?且看 helux 如何应对</a></li>\n<li><a href="https://juejin.cn/post/7399276698619035657" target="_blank" rel="nofollow noreferrer noopener">Redux、Zustand、Mobx、Valtio、Recoil、jotai、XState 状态管理怎么选</a></li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/React 全局状态库选型/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2025-10-22 18:34:06",path:"/react-global-state-selection/",tags:"前端, React, 状态库, 预研",title:"React 全局状态库选型",draft:null}}],length:36,tag:"预研",pagesSum:8,page:1}}}});