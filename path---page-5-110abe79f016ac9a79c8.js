webpackJsonp([0x9e7fb4e3147],{1386:function(n,s){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"背景知识 Rust 语言圣经 变量绑定与解构 问题一 变量只有在初始化后才能被使用 我的解答 问题二 可以使用 mut 将变量标记为可变 我的解答 问题三 作用域是一个变量在程序中能够保持合法的范围 我的解答 最佳解答 问题四 我的解答 最佳解答 问题五 若后面的变量声明的名称和之前的变量相同，则我们说：第一个变量被第二个同名变量遮蔽了（shadowing） 我的解答 问题六 删除一行代码以通过编译 我的解答 问题七 使用以下方法来修复编译器输出的 warning…",html:'<h1 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h1>\n<p><a href="https://course.rs/about-book.html" target="_blank" rel="nofollow noreferrer noopener">Rust 语言圣经</a></p>\n<h1 id="变量绑定与解构"><a href="#%E5%8F%98%E9%87%8F%E7%BB%91%E5%AE%9A%E4%B8%8E%E8%A7%A3%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量绑定与解构</h1>\n<h2 id="问题一"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h2>\n<p>变量只有在初始化后才能被使用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23409785102440760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let x: i32; // 未初始化，但被使用\n    let y: i32; // 未初始化，也未被使用\n    println!(&quot;x is equal to {}&quot;, x);\n}`, `23409785102440760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">;</span> <span class="token comment">// 未初始化，但被使用</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">;</span> <span class="token comment">// 未初始化，也未被使用</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is equal to {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22023475756198097000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let x: i32 = 0; // 未初始化，但被使用\n    let _y: i32; // 未初始化，也未被使用\n    println!(&quot;x is equal to {}&quot;, x);\n}`, `22023475756198097000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 未初始化，但被使用</span>\n    <span class="token keyword">let</span> _y<span class="token punctuation">:</span> i32<span class="token punctuation">;</span> <span class="token comment">// 未初始化，也未被使用</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is equal to {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题二"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h2>\n<p>可以使用 mut 将变量标记为可变</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4218959131915611600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 完形填空，让代码编译\nfn main() {\n    let __ =  1;\n    __ += 2;\n\n    println!(&quot;x = {}&quot;, x);\n}`, `4218959131915611600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 完形填空，让代码编译</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> __ <span class="token operator">=</span>  <span class="token number">1</span><span class="token punctuation">;</span>\n    __ <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x = {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-1"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37602345046860595000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 完形填空，让代码编译\nfn main() {\n    let mut x = 1;\n    x += 2;\n\n    println!(&quot;x = {}&quot;, x);\n}`, `37602345046860595000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 完形填空，让代码编译</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x = {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题三"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h2>\n<p>作用域是一个变量在程序中能够保持合法的范围</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3722766252260534300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并使用尽可能少的改变\nfn main() {\n    let x: i32 = 10;\n    {\n        let y: i32 = 5;\n        println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n    }\n    println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n}`, `3722766252260534300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并使用尽可能少的改变</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-2"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22970182851270636000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并使用尽可能少的改变\nfn main() {\n    let x: i32 = 10;\n    let y: i32 = 5;\n    {\n        println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n    }\n    println!(&quot;x 的值是 {}, y 的值是 {}&quot;, x, y);\n}`, `22970182851270636000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并使用尽可能少的改变</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的值是 {}, y 的值是 {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84809683120869720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x: i32 = 10;\n    {\n        let y: i32 = 5;\n        println!(&quot;The value of x is {} and value of y is {}&quot;, x, y);\n    }\n    println!(&quot;The value of x is {}&quot;, x);\n}`, `84809683120869720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> y<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x is {} and value of y is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The value of x is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题四"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9922760875505764000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    println!(&quot;{}, world&quot;, x);\n}\n\nfn define_x() {\n    let x = &quot;hello&quot;;\n}`, `9922760875505764000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, world"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-3"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46257901477622874000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let x = define_x();\n    println!(&quot;{}, world&quot;, x);\n}\n\nfn define_x() -> &\'static str {\n    let x = &quot;hello&quot;;\n    x\n}`, `46257901477622874000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, world"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> str <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n    x\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-1"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37553525259021470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = define_x();\n    println!(&quot;{}, world&quot;, x);\n}\n\nfn define_x() -> String {\n    let x = &quot;hello&quot;.to_string();\n    x\n}`, `37553525259021470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, world"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">define_x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    x\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题五"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h2>\n<p>若后面的变量声明的名称和之前的变量相同，则我们说：第一个变量被第二个同名变量遮蔽了（shadowing）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4993535012514649000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只允许修改 \\`assert_eq!\\` 来让 \\`println!\\` 工作(在终端输出 \\`42\\`)\nfn main() {\n    let x: i32 = 5;\n    {\n        let x = 12;\n        assert_eq!(x, 5);\n    }\n\n    assert_eq!(x, 12);\n\n    let x = 42;\n    println!(&quot;{}&quot;, x); // 输出 &quot;42&quot;.\n}`, `4993535012514649000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 只允许修改 `assert_eq!` 来让 `println!` 工作(在终端输出 `42`)</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 "42".</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-4"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5311559130187016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只允许修改 \\`assert_eq!\\` 来让 \\`println!\\` 工作(在终端输出 \\`42\\`)\nfn main() {\n    let x: i32 = 5;\n    {\n        let x = 12;\n        assert_eq!(x, 12);\n    }\n\n    assert_eq!(x, 5);\n\n    let x = 42;\n    println!(&quot;{}&quot;, x); // 输出 &quot;42&quot;.\n}`, `5311559130187016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 只允许修改 `assert_eq!` 来让 `println!` 工作(在终端输出 `42`)</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 "42".</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题六"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h2>\n<p>删除一行代码以通过编译</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44865315672963420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut x: i32 = 1;\n    x = 7;\n    // 遮蔽且再次绑定\n    let x = x;\n    x += 3;\n\n\n    let y = 4;\n    // 遮蔽\n    let y = &quot;I can also be bound to text!&quot;;\n}`, `44865315672963420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    x <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽且再次绑定</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">"I can also be bound to text!"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-5"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38534939294287640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut x: i32 = 1;\n    x = 7;\n    // 遮蔽且再次绑定\n    let x = x;\n\n    let y = 4;\n    // 遮蔽\n    let y = &quot;I can also be bound to text!&quot;;\n}`, `38534939294287640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    x <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽且再次绑定</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> x<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n    <span class="token comment">// 遮蔽</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">"I can also be bound to text!"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题七"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h2>\n<p>使用以下方法来修复编译器输出的 warning:</p>\n<ul>\n<li>一种方法</li>\n<li>两种方法</li>\n</ul>\n<blockquote>\n<p>注意: 你可以使用两种方法解决，但是它们没有一种是移除 <code class="language-text">let x = 1</code> 所在的代码行</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19363102135290642000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 1;\n}\n\n// compiler warning: unused variable: \\`x\\``, `19363102135290642000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// compiler warning: unused variable: `x`</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-6"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16305032583824675000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _x = 1;\n}\n\n// compiler warning: unused variable: \\`x\\``, `16305032583824675000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// compiler warning: unused variable: `x`</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94292645196949550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[allow(unused_variables)]\nfn main() {\n    let x = 1;\n}\n\n// compiler warning: unused variable: \\`x\\``, `94292645196949550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[allow(unused_variables)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// compiler warning: unused variable: `x`</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题八"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h2>\n<p>我们可以将 let 跟一个模式一起使用来解构一个元组，最终将它解构为多个独立的变量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54169878062151836000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let (x, y) = (1, 2);\n    x += 2;\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 2);\n}`, `54169878062151836000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-7"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48472558372941000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let (mut x, y) = (1, 2);\n    x += 2;\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 2);\n}`, `48472558372941000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">mut</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50665920418994890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复下面代码的错误并尽可能少的修改\nfn main() {\n    let (x, y) = (1, 2);\n    let x = 3;\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 2);\n}`, `50665920418994890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复下面代码的错误并尽可能少的修改</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题九"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h2>\n<p>在赋值语句的左式中使用元组、切片或结构体进行匹配赋值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64006524028160630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y);\n    (x, ..) = (3, 4);\n    [.., y] = [1, 2];\n    // 填空，让代码工作\n    assert_eq!([x, y], __);\n}`, `64006524028160630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空，让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-8"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71236330128221350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y);\n    (x, ..) = (3, 4);\n    [.., y] = [1, 2];\n    // 填空，让代码工作\n    assert_eq!([x, y], [3, 2]);\n}`, `71236330128221350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空，让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="基本类型"><a href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本类型</h1>\n<h2 id="数值类型"><a href="#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数值类型</h2>\n<h3 id="问题一-1"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>如果我们没有显式的给予变量一个类型，那编译器会自动帮我们推导一个类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20601560750286897000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除某个部分让代码工作\nfn main() {\n    let x: i32 = 5;\n    let mut y: u32 = 5;\n\n    y = x;\n\n    let z = 10; // 这里 z 的类型是?\n}`, `20601560750286897000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除某个部分让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> u32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 这里 z 的类型是?</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-9"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67715206087932290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除某个部分让代码工作\nfn main() {\n    let x: i32 = 5;\n    let mut y: u32 = 5;\n\n    // y = x;\n\n    let z = 10; // 这里 z 的类型是?\n}`, `67715206087932290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除某个部分让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> u32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// y = x;</span>\n\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 这里 z 的类型是?</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="最佳解答-2"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53381109993800900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x: i32 = 5;\n    let mut y = 5;\n\n    y = x;\n\n    let z = 10; // type of z : i32\n}`, `53381109993800900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// type of z : i32</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-1"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47239582133448655000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let v: u16 = 38_u8 as __;\n}`, `47239582133448655000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> u16 <span class="token operator">=</span> <span class="token number">38_u8</span> <span class="token keyword">as</span> __<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-10"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81354798345593720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let v: u16 = 38_u8 as u16;\n}`, `81354798345593720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> u16 <span class="token operator">=</span> <span class="token number">38_u8</span> <span class="token keyword">as</span> u16<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-1"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47343780309490205000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//  修改 \\`assert_eq!\\` 让代码工作\nfn main() {\n    let x = 5;\n    assert_eq!(&quot;u32&quot;.to_string(), type_of(&x));\n}\n\n// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  &quot;i8&quot;, &quot;u8&quot;, &quot;i32&quot;, &quot;u32&quot;\nfn type_of<T>(_: &T) -> String {\n    format!(&quot;{}&quot;, std::any::type_name::<T>())\n}`, `47343780309490205000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//  修改 `assert_eq!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"u32"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type_of</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  "i8", "u8", "i32", "u32"</span>\n<span class="token keyword">fn</span> type_of<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> std<span class="token punctuation">::</span>any<span class="token punctuation">::</span>type_name<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-11"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12831657885007241000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//  修改 \\`assert_eq!\\` 让代码工作\nfn main() {\n    let x = 5;\n    assert_eq!(&quot;i32&quot;.to_string(), type_of(&x));\n}\n\n// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  &quot;i8&quot;, &quot;u8&quot;, &quot;i32&quot;, &quot;u32&quot;\nfn type_of<T>(_: &T) -> String {\n    format!(&quot;{}&quot;, std::any::type_name::<T>())\n}`, `12831657885007241000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//  修改 `assert_eq!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"i32"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type_of</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 以下函数可以获取传入参数的类型，并返回类型的字符串形式，例如  "i8", "u8", "i32", "u32"</span>\n<span class="token keyword">fn</span> type_of<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> std<span class="token punctuation">::</span>any<span class="token punctuation">::</span>type_name<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-1"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69292855061788550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nfn main() {\n    assert_eq!(i8::MAX, __);\n    assert_eq!(u8::MAX, __);\n}`, `69292855061788550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>i8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>u8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-12"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52542328007853590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nfn main() {\n    assert_eq!(i8::MAX, 127);\n    assert_eq!(u8::MAX, 255);\n}`, `52542328007853590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>i8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>u8<span class="token punctuation">::</span>MAX<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-1"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86695193280833260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 解决代码中的错误和 \\`panic\\`\nfn main() {\n   let v1 = 251_u8 + 8;\n   let v2 = i8::checked_add(251, 8).unwrap();\n   println!(&quot;{},{}&quot;,v1,v2);\n}`, `86695193280833260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 解决代码中的错误和 `panic`</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">251_u8</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> v2 <span class="token operator">=</span> i8<span class="token punctuation">::</span><span class="token function">checked_add</span><span class="token punctuation">(</span><span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-13"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48167909527884520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 解决代码中的错误和 \\`panic\\`\nfn main() {\n    let v1 = 251_u16 + 8;\n    let v2 = i16::checked_add(251, 8).unwrap();\n    println!(&quot;{},{}&quot;, v1, v2);\n}`, `48167909527884520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 解决代码中的错误和 `panic`</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">251_u16</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v2 <span class="token operator">=</span> i16<span class="token punctuation">::</span><span class="token function">checked_add</span><span class="token punctuation">(</span><span class="token number">251</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="最佳解答-3"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57258344852458110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v1 = 247_u8 + 8;\n    let v2 = i8::checked_add(119, 8).unwrap();\n    println!(&quot;{},{}&quot;, v1, v2);\n}`, `57258344852458110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">247_u8</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v2 <span class="token operator">=</span> i8<span class="token punctuation">::</span><span class="token function">checked_add</span><span class="token punctuation">(</span><span class="token number">119</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-1"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73625906050612675000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改 \\`assert!\\` 让代码工作\nfn main() {\n    let v = 1_024 + 0xff + 0o77 + 0b1111_1111;\n    assert!(v == 1579);\n}`, `73625906050612675000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改 `assert!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token number">1_024</span> <span class="token operator">+</span> <span class="token number">0xff</span> <span class="token operator">+</span> <span class="token number">0o77</span> <span class="token operator">+</span> <span class="token number">0b1111_1111</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">1579</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-14"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87072762249069530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改 \\`assert!\\` 让代码工作\nfn main() {\n    let v = 1_024 + 0xff + 0o77 + 0b1111_1111;\n    assert!(v == 1597);\n}`, `87072762249069530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改 `assert!` 让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token number">1_024</span> <span class="token operator">+</span> <span class="token number">0xff</span> <span class="token operator">+</span> <span class="token number">0o77</span> <span class="token operator">+</span> <span class="token number">0b1111_1111</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">1597</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-1"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95558176220591000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将 ? 替换成你的答案\nfn main() {\n    let x = 1_000.000_1; // ?\n    let y: f32 = 0.12; // f32\n    let z = 0.01_f64; // f64\n}`, `95558176220591000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 将 ? 替换成你的答案</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1_000.000_1</span><span class="token punctuation">;</span> <span class="token comment">// ?</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> f32 <span class="token operator">=</span> <span class="token number">0.12</span><span class="token punctuation">;</span> <span class="token comment">// f32</span>\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">0.01_f64</span><span class="token punctuation">;</span> <span class="token comment">// f64</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-15"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33736654892216600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将 ? 替换成你的答案\nfn main() {\n    let x = 1_000.000_1; // f64\n    let y: f32 = 0.12; // f32\n    let z = 0.01_f64; // f64\n}`, `33736654892216600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 将 ? 替换成你的答案</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1_000.000_1</span><span class="token punctuation">;</span> <span class="token comment">// f64</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> f32 <span class="token operator">=</span> <span class="token number">0.12</span><span class="token punctuation">;</span> <span class="token comment">// f32</span>\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">0.01_f64</span><span class="token punctuation">;</span> <span class="token comment">// f64</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-1"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<p>使用两种方法来让下面代码工作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70993970873292644000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert!(0.1 + 0.2 == 0.3);\n}`, `70993970873292644000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">==</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-16"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16558589565611825000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert!((0.1_f64 + 0.2 - 0.3).abs() < 0.00001);\n}`, `16558589565611825000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.1_f64</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">-</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.00001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42218911633583020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert!(0.1_f32 + 0.2_f32 == 0.3_f32);\n}`, `42218911633583020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">0.1_f32</span> <span class="token operator">+</span> <span class="token number">0.2_f32</span> <span class="token operator">==</span> <span class="token number">0.3_f32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-1"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<p>两个目标:</p>\n<ol>\n<li>修改 assert! 让它工作</li>\n<li>让 println! 输出: 97 - 122</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32457766708816638000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut sum = 0;\n    for i in -3..2 {\n        sum += i\n    }\n\n    assert!(sum == -3);\n\n    for c in \'a\'..=\'z\' {\n        println!(&quot;{}&quot;, c);\n    }\n}`, `32457766708816638000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        sum <span class="token operator">+=</span> i\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token char string">\'a\'</span><span class="token punctuation">..=</span><span class="token char string">\'z\'</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-17"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43715162225351120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut sum = 0;\n    for i in -3..2 {\n        sum += i\n    }\n\n    assert!(sum == -5);\n\n    for c in \'a\'..=\'z\' {\n        println!(&quot;{}&quot;, c);\n    }\n}`, `43715162225351120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        sum <span class="token operator">+=</span> i\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token char string">\'a\'</span><span class="token punctuation">..=</span><span class="token char string">\'z\'</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="最佳解答-4"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18912408799155835000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut sum = 0;\n    for i in -3..2 {\n        sum += i\n    }\n\n    assert!(sum == -5);\n\n    for c in \'a\'..=\'z\' {\n        println!(&quot;{}&quot;, c as u8);\n    }\n}`, `18912408799155835000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        sum <span class="token operator">+=</span> i\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>sum <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token char string">\'a\'</span><span class="token punctuation">..=</span><span class="token char string">\'z\'</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c <span class="token keyword">as</span> u8<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74192547830738680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::ops::{Range, RangeInclusive};\nfn main() {\n    assert_eq!((1..__), Range{ start: 1, end: 5 });\n    assert_eq!((1..__), RangeInclusive::new(1, 5));\n}`, `74192547830738680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span><span class="token punctuation">{</span>Range<span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span>__<span class="token punctuation">)</span><span class="token punctuation">,</span> Range<span class="token punctuation">{</span> start<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span>__<span class="token punctuation">)</span><span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-18"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61742430270536280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::ops::{Range, RangeInclusive};\nfn main() {\n    assert_eq!((1..5), Range { start: 1, end: 5 });\n    assert_eq!((1..=5), RangeInclusive::new(1, 5));\n}`, `61742430270536280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span><span class="token punctuation">{</span>Range<span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Range <span class="token punctuation">{</span> start<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RangeInclusive<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十一"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75408385790086070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，并解决错误\nfn main() {\n    // 整数加法\n    assert!(1u32 + 2 == __);\n\n    // 整数减法\n    assert!(1i32 - 2 == __);\n    assert!(1u8 - 2 == -1);\n\n    assert!(3 * 50 == __);\n\n    assert!(9.6 / 3.2 == 3.0); // error ! 修改它让代码工作\n\n    assert!(24 % 5 == __);\n\n    // 逻辑与或非操作\n    assert!(true && false == __);\n    assert!(true || false == __);\n    assert!(!true == __);\n\n    // 位操作\n    println!(&quot;0011 AND 0101 is {:04b}&quot;, 0b0011u32 & 0b0101);\n    println!(&quot;0011 OR 0101 is {:04b}&quot;, 0b0011u32 | 0b0101);\n    println!(&quot;0011 XOR 0101 is {:04b}&quot;, 0b0011u32 ^ 0b0101);\n    println!(&quot;1 << 5 is {}&quot;, 1u32 << 5);\n    println!(&quot;0x80 >> 2 is 0x{:x}&quot;, 0x80u32 >> 2);\n}`, `75408385790086070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，并解决错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 整数加法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1u32</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 整数减法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1i32</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1u8</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">9.6</span> <span class="token operator">/</span> <span class="token number">3.2</span> <span class="token operator">==</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error ! 修改它让代码工作</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 逻辑与或非操作</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">||</span> <span class="token keyword">false</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">true</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 位操作</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 AND 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">&amp;</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 OR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">|</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 XOR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">^</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"1 &lt;&lt; 5 is {}"</span><span class="token punctuation">,</span> <span class="token number">1u32</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0x80 >> 2 is 0x{:x}"</span><span class="token punctuation">,</span> <span class="token number">0x80u32</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-19"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43881418555788640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，并解决错误\nfn main() {\n    // 整数加法\n    assert!(1u32 + 2 == 3);\n\n    // 整数减法\n    assert!(1i32 - 2 == -1);\n    assert!(1i8 - 2 == -1);\n\n    assert!(3 * 50 == 150);\n\n    assert!(9.6_f32 / 3.2_f32 == 3.0_f32); // error ! 修改它让代码工作\n\n    assert!(24 % 5 == 4);\n\n    // 逻辑与或非操作\n    assert!(true && false == false);\n    assert!(true || false == true);\n    assert!(!true == false);\n\n    // 位操作\n    println!(&quot;0011 AND 0101 is {:04b}&quot;, 0b0011u32 & 0b0101);\n    println!(&quot;0011 OR 0101 is {:04b}&quot;, 0b0011u32 | 0b0101);\n    println!(&quot;0011 XOR 0101 is {:04b}&quot;, 0b0011u32 ^ 0b0101);\n    println!(&quot;1 << 5 is {}&quot;, 1u32 << 5);\n    println!(&quot;0x80 >> 2 is 0x{:x}&quot;, 0x80u32 >> 2);\n}`, `43881418555788640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，并解决错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 整数加法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1u32</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 整数减法</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1i32</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">1i8</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">50</span> <span class="token operator">==</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">9.6_f32</span> <span class="token operator">/</span> <span class="token number">3.2_f32</span> <span class="token operator">==</span> <span class="token number">3.0_f32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error ! 修改它让代码工作</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 逻辑与或非操作</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span> <span class="token operator">==</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token keyword">true</span> <span class="token operator">||</span> <span class="token keyword">false</span> <span class="token operator">==</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">true</span> <span class="token operator">==</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 位操作</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 AND 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">&amp;</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 OR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">|</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0011 XOR 0101 is {:04b}"</span><span class="token punctuation">,</span> <span class="token number">0b0011u32</span> <span class="token operator">^</span> <span class="token number">0b0101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"1 &lt;&lt; 5 is {}"</span><span class="token punctuation">,</span> <span class="token number">1u32</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"0x80 >> 2 is 0x{:x}"</span><span class="token punctuation">,</span> <span class="token number">0x80u32</span> <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="字符、布尔、单元类型"><a href="#%E5%AD%97%E7%AC%A6%E3%80%81%E5%B8%83%E5%B0%94%E3%80%81%E5%8D%95%E5%85%83%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符、布尔、单元类型</h2>\n<h3 id="问题一-2"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91887094496748080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//  修改 2 处 \\`assert_eq!\\` 让代码工作\n\nuse std::mem::size_of_val;\nfn main() {\n    let c1 = \'a\';\n    assert_eq!(size_of_val(&c1), 1);\n\n    let c2 = \'中\';\n    assert_eq!(size_of_val(&c2), 3);\n\n    println!(&quot;Success!&quot;)\n}`, `91887094496748080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//  修改 2 处 `assert_eq!` 让代码工作</span>\n\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token char string">\'a\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-20"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63850832341908185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改 2 处 \\`assert_eq!\\` 让代码工作\n\nuse std::mem::size_of_val;\nfn main() {\n    let c1 = \'a\';\n    assert_eq!(size_of_val(&c1), 4);\n\n    let c2 = \'中\';\n    assert_eq!(size_of_val(&c2), 4);\n\n    println!(&quot;Success!&quot;)\n}`, `63850832341908185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改 2 处 `assert_eq!` 让代码工作</span>\n\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token char string">\'a\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> c2 <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-2"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24841052028314014000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改一行让代码正常打印\nfn main() {\n    let c1 = &quot;中&quot;;\n    print_char(c1);\n}\n\nfn print_char(c : char) {\n    println!(&quot;{}&quot;, c);\n}`, `24841052028314014000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改一行让代码正常打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token string">"中"</span><span class="token punctuation">;</span>\n    <span class="token function">print_char</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_char</span><span class="token punctuation">(</span>c <span class="token punctuation">:</span> char<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-21"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37576219360833220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改一行让代码正常打印\nfn main() {\n    let c1 = \'中\';\n    print_char(c1);\n}\n\nfn print_char(c: char) {\n    println!(&quot;{}&quot;, c);\n}`, `37576219360833220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改一行让代码正常打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c1 <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n    <span class="token function">print_char</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_char</span><span class="token punctuation">(</span>c<span class="token punctuation">:</span> char<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-2"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77722615959265480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使成功打印\nfn main() {\n    let _f: bool = false;\n\n    let t = true;\n    if !t {\n        println!(&quot;Success!&quot;)\n    }\n}`, `77722615959265480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使成功打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _f<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token operator">!</span>t <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-22"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40710699593240520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使成功打印\nfn main() {\n    let _f: bool = false;\n\n    let t = true;\n    if t {\n        println!(&quot;Success!&quot;)\n    }\n}`, `40710699593240520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使成功打印</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _f<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> t <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-2"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53505968111996590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let f = true;\n    let t = true && false;\n    assert_eq!(t, f);\n\n    println!(&quot;Success!&quot;)\n}`, `53505968111996590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-23"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93801275963759670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let f = true;\n    let t = true && false;\n    assert_eq!(t, !f);\n\n    println!(&quot;Success!&quot;)\n}`, `93801275963759670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">true</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token operator">!</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-2"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11301048943320934000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作，但不要修改 \\`implicitly_ret_unit\\` !\nfn main() {\n    let _v: () = ();\n\n    let v = (2, 3);\n    assert_eq!(v, implicitly_ret_unit());\n\n    println!(&quot;Success!&quot;)\n}\n\nfn implicitly_ret_unit() {\n    println!(&quot;I will return a ()&quot;)\n}\n\n// 不要使用下面的函数，它只用于演示！\nfn explicitly_ret_unit() -> () {\n    println!(&quot;I will return a ()&quot;)\n}`, `11301048943320934000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作，但不要修改 `implicitly_ret_unit` !</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _v<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 不要使用下面的函数，它只用于演示！</span>\n<span class="token keyword">fn</span> <span class="token function">explicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-24"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23694885414908650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作，但不要修改 \\`implicitly_ret_unit\\` !\nfn main() {\n    let _v: () = ();\n\n    let v = ();\n    assert_eq!(v, implicitly_ret_unit());\n\n    println!(&quot;Success!&quot;)\n}\n\nfn implicitly_ret_unit() {\n    println!(&quot;I will return a ()&quot;)\n}\n\n// 不要使用下面的函数，它只用于演示！\nfn explicitly_ret_unit() -> () {\n    println!(&quot;I will return a ()&quot;)\n}`, `23694885414908650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作，但不要修改 `implicitly_ret_unit` !</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _v<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">implicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 不要使用下面的函数，它只用于演示！</span>\n<span class="token keyword">fn</span> <span class="token function">explicitly_ret_unit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"I will return a ()"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-2"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>单元类型占用的内存大小是多少？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69917375507716506000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作：修改 \\`assert!\\` 中的 \\`4\\`\nuse std::mem::size_of_val;\nfn main() {\n    let unit: () = ();\n    assert!(size_of_val(&unit) == 4);\n\n    println!(&quot;Success!&quot;)\n}`, `69917375507716506000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作：修改 `assert!` 中的 `4`</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> unit<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>unit<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-25"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82502636480055570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 让代码工作：修改 \\`assert!\\` 中的 \\`4\\`\nuse std::mem::size_of_val;\nfn main() {\n    let unit: () = ();\n    assert!(size_of_val(&unit) == 0);\n\n    println!(&quot;Success!&quot;)\n}`, `82502636480055570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 让代码工作：修改 `assert!` 中的 `4`</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of_val<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> unit<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>unit<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="语句与表达式"><a href="#%E8%AF%AD%E5%8F%A5%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语句与表达式</h2>\n<h3 id="问题一-3"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4118473320653071000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用两种方法让代码工作起来\nfn main() {\n    let v = {\n        let mut x = 1;\n        x += 2\n    };\n\n    assert_eq!(v, 3);\n}`, `4118473320653071000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用两种方法让代码工作起来</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        x <span class="token operator">+=</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-26"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24075054170156675000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = {\n        let mut x = 1;\n        x += 2\n    };\n\n    assert_eq!(v, ());\n}`, `24075054170156675000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        x <span class="token operator">+=</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39315847566955520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = {\n        let mut x = 1;\n        x += 2;\n        x\n    };\n\n    assert_eq!(v, 3);\n}`, `39315847566955520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        x <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n        x\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-3"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3745250605931271700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = (let x = 3);\n\n    assert!(v == 3);\n}`, `3745250605931271700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-27"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31285672890186820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let v = {\n        let x = 3;\n        x\n    };\n\n    assert!(v == 3);\n}`, `31285672890186820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n        x\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-3"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67286297543430850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = sum(1, 2);\n    assert_eq!(s, 3);\n}\n\nfn sum(x: i32, y: i32) -> i32 {\n    x + y;\n}`, `67286297543430850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-28"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76768272951314170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = sum(1, 2);\n    assert_eq!(s, 3);\n}\n\nfn sum(x: i32, y: i32) -> i32 {\n    x + y\n}`, `76768272951314170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="函数"><a href="#%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数</h2>\n<h3 id="问题一-4"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19407965127140380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 不要修改下面两行代码!\n    let (x, y) = (1, 2);\n    let s = sum(x, y);\n\n    assert_eq!(s, 3);\n}\n\nfn sum(x, y: i32) {\n    x + y;\n}`, `19407965127140380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 不要修改下面两行代码!</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-29"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39092934810265166000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y) = (1, 2);\n    let s = sum(x, y);\n\n    assert_eq!(s, 3);\n}\n\nfn sum(x: i32, y: i32) -> i32 {\n    x + y\n}`, `39092934810265166000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-4"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78625710877425880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    print();\n}\n\n// 使用另一个类型来替代 i32\nfn print() -> i32 {\n    println!(&quot;hello,world&quot;);\n}`, `78625710877425880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用另一个类型来替代 i32</span>\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"hello,world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-30"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52226080101291350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    print();\n}\n\nfn print() -> () {\n    println!(&quot;hello,world&quot;);\n}`, `52226080101291350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"hello,world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-4"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50471809787209020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 用两种方法求解\nfn main() {\n    never_return();\n}\n\nfn never_return() -> ! {\n    // 实现这个函数，不要修改函数签名!\n}`, `50471809787209020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 用两种方法求解</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 实现这个函数，不要修改函数签名!</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-31"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41279368646833504000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    never_return();\n}\n\nfn never_return() -> ! {\n    loop {}\n}`, `41279368646833504000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token keyword">loop</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53865030155495645000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    never_return();\n}\n\nfn never_return() -> ! {\n    panic!(&quot;error&quot;)\n}`, `53865030155495645000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">never_return</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-3"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>发散函数(Diverging function)不会返回任何值，因此它们可以用于替代需要返回任何值的地方</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16712583163666084000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    println!(&quot;Success!&quot;);\n}\n\nfn get_option(tp: u8) -> Option<i32> {\n    match tp {\n        1 => {\n        }\n        _ => {\n        }\n    };\n\n    // 这里与其返回一个 None，不如使用发散函数替代\n    never_return_fn()\n}\n\n// 使用三种方法实现以下发散函数\nfn never_return_fn() -> ! {}`, `16712583163666084000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">get_option</span><span class="token punctuation">(</span>tp<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> tp <span class="token punctuation">{</span>\n        <span class="token number">1</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token punctuation">}</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 这里与其返回一个 None，不如使用发散函数替代</span>\n    <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用三种方法实现以下发散函数</span>\n<span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-32"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-32" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9864406847528229000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn never_return_fn() -> ! {\n    panic!()\n}`, `9864406847528229000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23038772486529815000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn never_return_fn() -> ! {\n    todo!();\n}`, `23038772486529815000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token function">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18305251849672733000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn never_return_fn() -> ! {\n    loop {\n        std::thread::sleep(std::time::Duration::from_secs(1))\n    }\n}`, `18305251849672733000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">never_return_fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">!</span> <span class="token punctuation">{</span>\n    <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span><span class="token function">sleep</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>time<span class="token punctuation">::</span>Duration<span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-3"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26039437778300887000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空\n    let b = __;\n\n    let _v = match b {\n        true => 1,\n        // 发散函数也可以用于 \\`match\\` 表达式，用于替代任何类型的值\n        false => {\n            println!(&quot;Success!&quot;);\n            panic!(&quot;we have no value for \\`false\\`, but we can panic&quot;)\n        }\n    };\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}`, `26039437778300887000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> b <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _v <span class="token operator">=</span> <span class="token keyword">match</span> b <span class="token punctuation">{</span>\n        <span class="token keyword">true</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span>\n        <span class="token comment">// 发散函数也可以用于 `match` 表达式，用于替代任何类型的值</span>\n        <span class="token keyword">false</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"we have no value for `false`, but we can panic"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-33"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-33" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22930646167977333000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let b = false;\n\n    let _v = match b {\n        true => 1,\n        // 发散函数也可以用于 \\`match\\` 表达式，用于替代任何类型的值\n        false => {\n            println!(&quot;Success!&quot;);\n            panic!(&quot;we have no value for \\`false\\`, but we can panic&quot;)\n        }\n    };\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}`, `22930646167977333000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">false</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _v <span class="token operator">=</span> <span class="token keyword">match</span> b <span class="token punctuation">{</span>\n        <span class="token keyword">true</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span>\n        <span class="token comment">// 发散函数也可以用于 `match` 表达式，用于替代任何类型的值</span>\n        <span class="token keyword">false</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"we have no value for `false`, but we can panic"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="所有权与借用"><a href="#%E6%89%80%E6%9C%89%E6%9D%83%E4%B8%8E%E5%80%9F%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>所有权与借用</h1>\n<h2 id="所有权"><a href="#%E6%89%80%E6%9C%89%E6%9D%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>所有权</h2>\n<h3 id="问题一-5"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40290620072277975000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 使用尽可能多的方法来通过编译\n    let x = String::from(&quot;hello, world&quot;);\n    let y = x;\n    println!(&quot;{},{}&quot;, x, y);\n}`, `40290620072277975000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用尽可能多的方法来通过编译</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-34"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-34" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80947311012173680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = String::from(&quot;hello, world&quot;);\n    let y = x.clone();\n    println!(&quot;{},{}&quot;, x, y);\n}`, `80947311012173680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50164279719763490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = String::from(&quot;hello, world&quot;);\n    let y = &x;\n    println!(&quot;{},{}&quot;, x, y);\n}`, `50164279719763490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12055987864092744000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = &quot;hello, world&quot;;\n    let y = x;\n    println!(&quot;{},{}&quot;, x, y);\n}`, `12055987864092744000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13157397548702577000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = String::from(&quot;hello, world&quot;);\n    let y = x.as_str();\n    println!(&quot;{},{}&quot;, x, y);\n}`, `13157397548702577000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{},{}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-5"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56941469786306080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不要修改 main 中的代码\nfn main() {\n    let s1 = String::from(&quot;hello, world&quot;);\n    let s2 = take_ownership(s1);\n\n    println!(&quot;{}&quot;, s2);\n}\n\n// 只能修改下面的代码!\nfn take_ownership(s: String) {\n    println!(&quot;{}&quot;, s);\n}`, `56941469786306080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 不要修改 main 中的代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 只能修改下面的代码!</span>\n<span class="token keyword">fn</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-35"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-35" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64908847663438770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hello, world&quot;);\n    let s2 = take_ownership(s1);\n\n    println!(&quot;{}&quot;, s2);\n}\n\nfn take_ownership(s: String) -> String {\n    println!(&quot;{}&quot;, s);\n    s\n}`, `64908847663438770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">take_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-5"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21892617866850193000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = give_ownership();\n    println!(&quot;{}&quot;, s);\n}\n\n// 只能修改下面的代码!\nfn give_ownership() -> String {\n    let s = String::from(&quot;hello, world&quot;);\n    // convert String to Vec\n    // 将 String 转换成 Vec 类型\n    let _s = s.into_bytes();\n    s\n}`, `21892617866850193000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 只能修改下面的代码!</span>\n<span class="token keyword">fn</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// convert String to Vec</span>\n    <span class="token comment">// 将 String 转换成 Vec 类型</span>\n    <span class="token keyword">let</span> _s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">into_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-36"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-36" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63700460573464370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = give_ownership();\n    println!(&quot;{}&quot;, s);\n}\n\nfn give_ownership() -> String {\n    let s = String::from(&quot;hello, world&quot;);\n    // convert String to Vec\n    // 将 String 转换成 Vec 类型\n    let _s = s.as_bytes();\n    s\n}`, `63700460573464370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// convert String to Vec</span>\n    <span class="token comment">// 将 String 转换成 Vec 类型</span>\n    <span class="token keyword">let</span> _s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80013222585429560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = give_ownership();\n    println!(&quot;{}&quot;, s);\n}\n\n// Only modify the code below!\nfn give_ownership() -> String {\n    let s = String::from(&quot;hello, world&quot;);\n    s\n}`, `80013222585429560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Only modify the code below!</span>\n<span class="token keyword">fn</span> <span class="token function">give_ownership</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-4"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58438581039296490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要删除任何代码行\nfn main() {\n    let s = String::from(&quot;hello, world&quot;);\n\n    print_str(s);\n\n    println!(&quot;{}&quot;, s);\n}\n\nfn print_str(s: String)  {\n    println!(&quot;{}&quot;,s)\n}`, `58438581039296490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要删除任何代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-37"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-37" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27940195751744090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, world&quot;);\n\n    print_str(&s);\n\n    println!(&quot;{}&quot;, s);\n}\n\nfn print_str(s: &String) {\n    println!(&quot;{}&quot;, s)\n}`, `27940195751744090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62402807615536580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, world&quot;);\n\n    print_str(s.clone());\n\n    println!(&quot;{}&quot;, s);\n}\n\nfn print_str(s: String)  {\n    println!(&quot;{}&quot;,s)\n}`, `62402807615536580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-4"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30497598892200296000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不要使用 clone，使用 copy 的方式替代\nfn main() {\n    let x = (1, 2, (), &quot;hello&quot;.to_string());\n    let y = x.clone();\n    println!(&quot;{:?}, {:?}&quot;, x, y);\n}`, `30497598892200296000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 不要使用 clone，使用 copy 的方式替代</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-38"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-38" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4287807779771735000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = (1, 2, (), &quot;hello&quot;);\n    let y = x;\n    println!(&quot;{:?}, {:?}&quot;, x, y);\n}`, `4287807779771735000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-3"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>当所有权转移时，可变性也可以随之改变</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96288718816183840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, &quot;);\n\n    // 只修改下面这行代码 !\n    let s1 = s;\n\n    s1.push_str(&quot;world&quot;)\n}`, `96288718816183840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 只修改下面这行代码 !</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> s<span class="token punctuation">;</span>\n\n    s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-39"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-39" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71110129992890925000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, &quot;);\n\n    let mut s1 = s;\n\n    s1.push_str(&quot;world&quot;)\n}`, `71110129992890925000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s1 <span class="token operator">=</span> s<span class="token punctuation">;</span>\n\n    s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-2"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95212962626492530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = Box::new(5);\n\n    let ...      // 完成该行代码，不要修改其它行！\n\n    *y = 4;\n\n    assert_eq!(*x, 5);\n}`, `95212962626492530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token punctuation">...</span>      <span class="token comment">// 完成该行代码，不要修改其它行！</span>\n\n    <span class="token operator">*</span>y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-40"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-40" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59219712921467330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = Box::new(5);\n\n    let mut y = Box::new(1);\n\n    *y = 4;\n\n    assert_eq!(*x, 5);\n}`, `59219712921467330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> y <span class="token operator">=</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token operator">*</span>y <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-2"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<p>当解构一个变量时，可以同时使用 move 和引用模式绑定的方式。当这么做时，部分 move 就会发生：变量中一部分的所有权被转移给其它变量，而另一部分我们获取了它的引用。</p>\n<p>在这种情况下，原变量将无法再被使用，但是它没有转移所有权的那一部分依然可以使用，也就是之前被引用的那部分。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93435779627098310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n   let _s = t.0;\n\n   // 仅修改下面这行代码，且不要使用 \\`_s\\`\n   println!(&quot;{:?}&quot;, t);\n}`, `93435779627098310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> _s <span class="token operator">=</span> t<span class="token number">.0</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 仅修改下面这行代码，且不要使用 `_s`</span>\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-41"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-41" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22488833951662256000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n    let _s = t.0;\n\n    println!(&quot;{:?}&quot;, t.1);\n}`, `22488833951662256000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _s <span class="token operator">=</span> t<span class="token number">.0</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> t<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-2"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21553607851256173000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n   // 填空，不要修改其它代码\n   let (__, __) = __;\n\n   println!(&quot;{:?}, {:?}, {:?}&quot;, s1, s2, t); // -> &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)\n}`, `21553607851256173000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 填空，不要修改其它代码</span>\n   <span class="token keyword">let</span> <span class="token punctuation">(</span>__<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}, {:?}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> "hello", "world", ("hello", "world")</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-42"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-42" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57147993397086990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n    let (ref s1, ref s2) = t;\n\n    println!(&quot;{:?}, {:?}, {:?}&quot;, s1, s2, t); // -> &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)\n}`, `57147993397086990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">ref</span> s1<span class="token punctuation">,</span> <span class="token keyword">ref</span> s2<span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}, {:?}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> "hello", "world", ("hello", "world")</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84814256661105540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (String::from(&quot;hello&quot;), String::from(&quot;world&quot;));\n\n    let (ref s1, ref s2) = t.clone();\n\n    println!(&quot;{:?}, {:?}, {:?}&quot;, s1, s2, t); // -> &quot;hello&quot;, &quot;world&quot;, (&quot;hello&quot;, &quot;world&quot;)\n}`, `84814256661105540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">ref</span> s1<span class="token punctuation">,</span> <span class="token keyword">ref</span> s2<span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}, {:?}, {:?}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -> "hello", "world", ("hello", "world")</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="引用与借用"><a href="#%E5%BC%95%E7%94%A8%E4%B8%8E%E5%80%9F%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引用与借用</h2>\n<h3 id="问题一-6"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>引用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94009168868181950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let x = 5;\n   // 填写空白处\n   let p = __;\n\n   println!(&quot;x 的内存地址是 {:p}&quot;, p); // output: 0x16fa3ac84\n}`, `94009168868181950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n   <span class="token comment">// 填写空白处</span>\n   <span class="token keyword">let</span> p <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的内存地址是 {:p}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: 0x16fa3ac84</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-43"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-43" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33514306139241333000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 5;\n    // 填写空白处\n    let p = &x;\n\n    println!(&quot;x 的内存地址是 {:p}&quot;, p); // output: 0x16fa3ac84\n}`, `33514306139241333000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填写空白处</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x 的内存地址是 {:p}"</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: 0x16fa3ac84</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-6"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29548345761714434000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 5;\n    let y = &x;\n\n    // 只能修改以下行\n    assert_eq!(5, y);\n}`, `29548345761714434000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n\n    <span class="token comment">// 只能修改以下行</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-44"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-44" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70043167744364790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let x = 5;\n    let y = &x;\n\n    // 只能修改以下行\n    assert_eq!(5, *y);\n}`, `70043167744364790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>\n\n    <span class="token comment">// 只能修改以下行</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">*</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-6"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79159347718529530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    borrow_object(s)\n}\n\nfn borrow_object(s: &String) {}`, `79159347718529530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-45"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-45" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63325101170958440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    borrow_object(&s)\n}\n\nfn borrow_object(s: &String) {}`, `63325101170958440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-5"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70912621747898010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    push_str(s)\n}\n\nfn push_str(s: &mut String) {\n    s.push_str(&quot;world&quot;)\n}`, `70912621747898010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">push_str</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">push_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-46"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-46" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10906982854507063000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    push_str(&mut s)\n}\n\nfn push_str(s: &mut String) {\n    s.push_str(&quot;world&quot;)\n}`, `10906982854507063000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">push_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">push_str</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-5"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73457150715602035000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    // 填写空白处，让代码工作\n    let p = __;\n\n    p.push_str(&quot;world&quot;);\n}`, `73457150715602035000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填写空白处，让代码工作</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-47"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-47" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10372561892288810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    // 填写空白处，让代码工作\n    let p = &mut s;\n\n    p.push_str(&quot;world&quot;);\n}`, `10372561892288810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填写空白处，让代码工作</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-4"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>ref 与 &#x26; 类似，可以用来获取一个值的引用，但是它们的用法有所不同。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16380266242071407000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let c = \'中\';\n\n    let r1 = &c;\n    // 填写空白处，但是不要修改其它行的代码\n    let __ r2 = c;\n\n    assert_eq!(*r1, *r2);\n\n    // 判断两个内存地址的字符串是否相等\n    assert_eq!(get_addr(r1),get_addr(r2));\n}\n\n// 获取传入引用的内存地址的字符串形式\nfn get_addr(r: &char) -> String {\n    format!(&quot;{:p}&quot;, r)\n}`, `16380266242071407000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>c<span class="token punctuation">;</span>\n    <span class="token comment">// 填写空白处，但是不要修改其它行的代码</span>\n    <span class="token keyword">let</span> __ r2 <span class="token operator">=</span> c<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>r1<span class="token punctuation">,</span> <span class="token operator">*</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 判断两个内存地址的字符串是否相等</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">get_addr</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">get_addr</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 获取传入引用的内存地址的字符串形式</span>\n<span class="token keyword">fn</span> <span class="token function">get_addr</span><span class="token punctuation">(</span>r<span class="token punctuation">:</span> <span class="token operator">&amp;</span>char<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{:p}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-48"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-48" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44997988961906450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let c = \'中\';\n\n    let r1 = &c;\n    let ref r2 = c;\n\n    assert_eq!(*r1, *r2);\n\n    assert_eq!(get_addr(r1), get_addr(r2));\n}\n\nfn get_addr(r: &char) -> String {\n    format!(&quot;{:p}&quot;, r)\n}`, `44997988961906450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token char string">\'中\'</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>c<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">ref</span> r2 <span class="token operator">=</span> c<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>r1<span class="token punctuation">,</span> <span class="token operator">*</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">get_addr</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">get_addr</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">get_addr</span><span class="token punctuation">(</span>r<span class="token punctuation">:</span> <span class="token operator">&amp;</span>char<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{:p}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-3"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<p>借用规则</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8799192752191320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除代码某个部分，让它工作\n// 你不能移除整行的代码！\nfn main() {\n    let mut s = String::from(&quot;hello&quot;);\n\n    let r1 = &mut s;\n    let r2 = &mut s;\n\n    println!(&quot;{}, {}&quot;, r1, r2);\n}`, `8799192752191320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除代码某个部分，让它工作</span>\n<span class="token comment">// 你不能移除整行的代码！</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-49"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-49" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92109713273026280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 移除代码某个部分，让它工作\n// 你不能移除整行的代码！\nfn main() {\n    let mut s = String::from(&quot;hello&quot;);\n\n    let r1 = &s;\n    let r2 = &s;\n\n    println!(&quot;{}, {}&quot;, r1, r2);\n}`, `92109713273026280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 移除代码某个部分，让它工作</span>\n<span class="token comment">// 你不能移除整行的代码！</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-3"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<p>错误: 从不可变对象借用可变</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13440843649797075000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 通过修改下面一行代码来修复错误\n    let s = String::from(&quot;hello, &quot;);\n\n    borrow_object(&mut s)\n}\n\nfn borrow_object(s: &mut String) {}`, `13440843649797075000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 通过修改下面一行代码来修复错误</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-50"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-50" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97607705264470100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    borrow_object(&mut s)\n}\n\nfn borrow_object(s: &mut String) {}`, `97607705264470100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35682946545268224000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    borrow_object(&s);\n\n    s.push_str(&quot;world&quot;);\n}\n\nfn borrow_object(s: &String) {}`, `35682946545268224000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">borrow_object</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">borrow_object</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-3"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<p>NLL</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80669156381058900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 注释掉一行代码让它工作\nfn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    r1.push_str(&quot;world&quot;);\n    let r2 = &mut s;\n    r2.push_str(&quot;!&quot;);\n\n    println!(&quot;{}&quot;,r1);\n}`, `80669156381058900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 注释掉一行代码让它工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r2<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-51"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-51" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12070318663344470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    r1.push_str(&quot;world&quot;);\n    let r2 = &mut s;\n    r2.push_str(&quot;!&quot;);\n\n    // println!(&quot;{}&quot;,r1);\n}`, `12070318663344470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    r2<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// println!("{}",r1);</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十-1"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97240371553134150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    let r2 = &mut s;\n\n    // 在下面增加一行代码人为制造编译错误：cannot borrow \\`s\\` as mutable more than once at a time\n    // 你不能同时使用 r1 和 r2\n}`, `97240371553134150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    <span class="token comment">// 在下面增加一行代码人为制造编译错误：cannot borrow `s` as mutable more than once at a time</span>\n    <span class="token comment">// 你不能同时使用 r1 和 r2</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-52"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-52" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79428554724743610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello, &quot;);\n\n    let r1 = &mut s;\n    let r2 = &mut s;\n\n    println!(&quot;{}&quot;, r1)\n}`, `79428554724743610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="复合类型"><a href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复合类型</h1>\n<h2 id="字符串"><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字符串</h2>\n<h3 id="问题一-7"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>正常情况下我们无法使用 str 类型，但是可以使用 &#x26;str 来替代</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59881175883694060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要新增代码行\nfn main() {\n    let s: str = &quot;hello, world&quot;;\n}`, `59881175883694060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要新增代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-53"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-53" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1143745108456983800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s: &str = &quot;hello, world&quot;;\n}`, `1143745108456983800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-7"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>如果要使用 str 类型，只能配合 Box。 &#x26; 可以用来将 <code class="language-text">Box&lt;str&gt;</code> 转换为 &#x26;str 类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68611875656805650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用至少两种方法来修复错误\nfn main() {\n    let s: Box<str> = &quot;hello, world&quot;.into();\n    greetings(s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;,s)\n}`, `68611875656805650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用至少两种方法来修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span>str<span class="token operator">></span> <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-54"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-54" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9886139015470619000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s: Box<str> = &quot;hello, world&quot;.into();\n    greetings(&s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;, s)\n}`, `9886139015470619000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span>str<span class="token operator">></span> <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84275691886960380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s: Box<&str> = &quot;hello, world&quot;.into();\n    greetings(*s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;, s);\n}`, `84275691886960380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span><span class="token operator">&amp;</span>str<span class="token operator">></span> <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-7"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>String 是定义在标准库中的类型，分配在堆上，可以动态的增长。它的底层存储是动态字节数组的方式(<code class="language-text">Vec&lt;u8&gt;</code>)，但是与字节数组不同，String 是 UTF-8 编码。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19454889676287480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut s = __;\n    s.push_str(&quot;hello, world&quot;);\n    s.push(\'!\');\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n}`, `19454889676287480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> __<span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-55"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-55" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48224233050839785000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;&quot;);\n    s.push_str(&quot;hello, world&quot;);\n    s.push(\'!\');\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n}`, `48224233050839785000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19914354754069600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::new();\n    s.push_str(&quot;hello, world&quot;);\n    s.push(\'!\');\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n}`, `19914354754069600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-6"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86815628353906130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有错误，并且不要新增代码行\nfn main() {\n    let  s = String::from(&quot;hello&quot;);\n    s.push(\',\');\n    s.push(&quot; world&quot;);\n    s += &quot;!&quot;.to_string();\n\n    println!(&quot;{}&quot;, s)\n}`, `86815628353906130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有错误，并且不要新增代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span>  s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">" world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s <span class="token operator">+=</span> <span class="token string">"!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-56"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-56" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96585467101282040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello&quot;);\n    s.push(\',\');\n    s.push_str(&quot; world&quot;);\n    s += &quot;!&quot;;\n\n    println!(&quot;{}&quot;, s)\n}`, `96585467101282040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s <span class="token operator">+=</span> <span class="token string">"!"</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-6"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>我们可以用 replace 方法来替换指定的子字符串</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43387206891161354000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let s = String::from(&quot;I like dogs&quot;);\n    // 以下方法会重新分配一块内存空间，然后将修改后的字符串存在这里\n    let s1 = s.__(&quot;dogs&quot;, &quot;cats&quot;);\n\n    assert_eq!(s1, &quot;I like cats&quot;)\n}`, `43387206891161354000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 以下方法会重新分配一块内存空间，然后将修改后的字符串存在这里</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token string">"dogs"</span><span class="token punctuation">,</span> <span class="token string">"cats"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">"I like cats"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-57"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-57" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95309955094364600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;I like dogs&quot;);\n    let s1 = s.replace(&quot;dogs&quot;, &quot;cats&quot;);\n\n    assert_eq!(s1, &quot;I like cats&quot;)\n}`, `95309955094364600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I like dogs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"dogs"</span><span class="token punctuation">,</span> <span class="token string">"cats"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token string">"I like cats"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-5"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>你只能将 String 跟 &#x26;str 类型进行拼接，并且 String 的所有权在此过程中会被 move</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84576366165663220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有错误，不要删除任何一行代码\nfn main() {\n    let s1 = String::from(&quot;hello,&quot;);\n    let s2 = String::from(&quot;world!&quot;);\n    let s3 = s1 + s2;\n    assert_eq!(s3,&quot;hello,world!&quot;);\n    println!(&quot;{}&quot;,s1);\n}`, `84576366165663220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有错误，不要删除任何一行代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s3 <span class="token operator">=</span> s1 <span class="token operator">+</span> s2<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s3<span class="token punctuation">,</span><span class="token string">"hello,world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-58"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-58" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1650576072503185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hello,&quot;);\n    let s2 = String::from(&quot;world!&quot;);\n    let s3 = s1.clone() + &s2;\n    assert_eq!(s3, &quot;hello,world!&quot;);\n    println!(&quot;{}&quot;, s1);\n}`, `1650576072503185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s2 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s3 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s3<span class="token punctuation">,</span> <span class="token string">"hello,world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-4"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<p>我们可以使用两种方法将 &#x26;str 转换成 String 类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56817872223934190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用至少两种方法来修复错误\nfn main() {\n    let s = &quot;hello, world&quot;;\n    greetings(s)\n}\n\nfn greetings(s: String) {\n    println!(&quot;{}&quot;,s)\n}`, `56817872223934190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用至少两种方法来修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-59"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-59" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56435634901217320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;;\n    greetings(s)\n}\n\nfn greetings(s: &str) {\n    println!(&quot;{}&quot;, s)\n}`, `56435634901217320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20972654618639507000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    greetings(s)\n}\n\nfn greetings(s: String) {\n    println!(&quot;{}&quot;, s)\n}`, `20972654618639507000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94558099214853030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello, world&quot;);\n    greetings(s)\n}\n\nfn greetings(s: String) {\n    println!(&quot;{}&quot;, s)\n}`, `94558099214853030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">greetings</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-4"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<p>我们可以使用 String::from 或 <code class="language-text">to_string</code> 将 &#x26;str 转换成 String 类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57932330869835140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用两种方法来解决错误，不要新增代码行\nfn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = s;\n}`, `57932330869835140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用两种方法来解决错误，不要新增代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-60"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-60" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90198281228793940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = &s;\n}`, `90198281228793940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88743915515295900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;;\n    let s1: &str = &s;\n}`, `88743915515295900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87903128572823600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = &s[..];\n}`, `87903128572823600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98234924996882040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;hello, world&quot;.to_string();\n    let s1: &str = s.as_str();\n}`, `98234924996882040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-4"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90828476133222530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 你可以使用转义的方式来输出想要的字符，这里我们使用十六进制的值，例如 \\x73 会被转义成小写字母 \'s\'\n    // 填空以输出 &quot;I\'m writing Rust&quot;\n    let byte_escape = &quot;I\'m writing Ru\\x73__!&quot;;\n    println!(&quot;What are you doing\\x3F (\\\\x3F means ?) {}&quot;, byte_escape);\n\n    // 也可以使用 Unicode 形式的转义字符\n    let unicode_codepoint = &quot;\\u{211D}&quot;;\n    let character_name = &quot;\\&quot;DOUBLE-STRUCK CAPITAL R\\&quot;&quot;;\n\n    println!(&quot;Unicode character {} (U+211D) is called {}&quot;,\n                unicode_codepoint, character_name );\n\n    // 还能使用 \\ 来连接多行字符串\n    let long_string = &quot;String literals\n                        can span multiple lines.\n                        The linebreak and indentation here \\\n                         can be escaped too!&quot;;\n    println!(&quot;{}&quot;, long_string);\n}`, `90828476133222530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 你可以使用转义的方式来输出想要的字符，这里我们使用十六进制的值，例如 \\x73 会被转义成小写字母 \'s\'</span>\n    <span class="token comment">// 填空以输出 "I\'m writing Rust"</span>\n    <span class="token keyword">let</span> byte_escape <span class="token operator">=</span> <span class="token string">"I\'m writing Ru\\x73__!"</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"What are you doing\\x3F (\\\\x3F means ?) {}"</span><span class="token punctuation">,</span> byte_escape<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 也可以使用 Unicode 形式的转义字符</span>\n    <span class="token keyword">let</span> unicode_codepoint <span class="token operator">=</span> <span class="token string">"\\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> character_name <span class="token operator">=</span> <span class="token string">"\\"DOUBLE-STRUCK CAPITAL R\\""</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Unicode character {} (U+211D) is called {}"</span><span class="token punctuation">,</span>\n                unicode_codepoint<span class="token punctuation">,</span> character_name <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 还能使用 \\ 来连接多行字符串</span>\n    <span class="token keyword">let</span> long_string <span class="token operator">=</span> "String literals\n                        can span multiple lines<span class="token punctuation">.</span>\n                        The linebreak and indentation here \\\n                         can <span class="token keyword">be</span> escaped <span class="token macro-rules function">too!</span>"<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> long_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-61"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-61" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33108537290070750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let byte_escape = &quot;I\'m writing Ru\\x73\\x74!&quot;;\n    println!(&quot;What are you doing\\x3F (\\\\x3F means ?) {}&quot;, byte_escape);\n\n    let unicode_codepoint = &quot;\\u{211D}&quot;;\n    let character_name = &quot;\\&quot;DOUBLE-STRUCK CAPITAL R\\&quot;&quot;;\n\n    println!(&quot;Unicode character {} (U+211D) is called {}&quot;,\n                unicode_codepoint, character_name );\n\n   let long_string = &quot;String literals\n                        can span multiple lines.\n                        The linebreak and indentation here \\\n                         can be escaped too!&quot;;\n    println!(&quot;{}&quot;, long_string);\n}`, `33108537290070750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> byte_escape <span class="token operator">=</span> <span class="token string">"I\'m writing Ru\\x73\\x74!"</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"What are you doing\\x3F (\\\\x3F means ?) {}"</span><span class="token punctuation">,</span> byte_escape<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> unicode_codepoint <span class="token operator">=</span> <span class="token string">"\\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> character_name <span class="token operator">=</span> <span class="token string">"\\"DOUBLE-STRUCK CAPITAL R\\""</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Unicode character {} (U+211D) is called {}"</span><span class="token punctuation">,</span>\n                unicode_codepoint<span class="token punctuation">,</span> character_name <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> long_string <span class="token operator">=</span> "String literals\n                        can span multiple lines<span class="token punctuation">.</span>\n                        The linebreak and indentation here \\\n                         can <span class="token keyword">be</span> escaped <span class="token macro-rules function">too!</span>"<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> long_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十-2"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h3>\n<p>有时候需要转义的字符很多，我们会希望使用更方便的方式来书写字符串: raw string.</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72825715949900530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 填空并修复所有错误 */\nfn main() {\n    let raw_str = r&quot;Escapes don\'t work here: \\x3F \\u{211D}&quot;;\n    // 修改上面的行让代码工作\n    assert_eq!(raw_str, &quot;Escapes don\'t work here: ? ℝ&quot;);\n\n    // 如果你希望在字符串中使用双引号，可以使用以下形式\n    let quotes = r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#;\n    println!(&quot;{}&quot;, quotes);\n\n    // 如果希望在字符串中使用 # 号，可以如下使用：\n    let  delimiter = r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###;\n    println!(&quot;{}&quot;, delimiter);\n\n    // 填空\n    let long_delimiter = __;\n    assert_eq!(long_delimiter, &quot;Hello, \\&quot;##\\&quot;&quot;)\n}`, `72825715949900530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 填空并修复所有错误 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> raw_str <span class="token operator">=</span> <span class="token string">r"Escapes don\'t work here: \\x3F \\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token comment">// 修改上面的行让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>raw_str<span class="token punctuation">,</span> <span class="token string">"Escapes don\'t work here: ? ℝ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 如果你希望在字符串中使用双引号，可以使用以下形式</span>\n    <span class="token keyword">let</span> quotes <span class="token operator">=</span> <span class="token string">r#"And then I said: "There is no escape!""#</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> quotes<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 如果希望在字符串中使用 # 号，可以如下使用：</span>\n    <span class="token keyword">let</span>  delimiter <span class="token operator">=</span> <span class="token string">r###"A string with "# in it. And even "##!"###</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> long_delimiter <span class="token operator">=</span> __<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>long_delimiter<span class="token punctuation">,</span> <span class="token string">"Hello, \\"##\\""</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-62"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-62" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43352353294133210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let raw_str = &quot;Escapes don\'t work here: \\x3F \\u{211D}&quot;;\n    assert_eq!(raw_str, &quot;Escapes don\'t work here: ? ℝ&quot;);\n\n    let quotes = r#&quot;And then I said: &quot;There is no escape!&quot;&quot;#;\n    println!(&quot;{}&quot;, quotes);\n\n    let delimiter = r###&quot;A string with &quot;# in it. And even &quot;##!&quot;###;\n    println!(&quot;{}&quot;, delimiter);\n\n    let long_delimiter = r###&quot;Hello, &quot;##&quot;&quot;###;\n    assert_eq!(long_delimiter, &quot;Hello, \\&quot;##\\&quot;&quot;)\n}`, `43352353294133210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> raw_str <span class="token operator">=</span> <span class="token string">"Escapes don\'t work here: \\x3F \\u{211D}"</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>raw_str<span class="token punctuation">,</span> <span class="token string">"Escapes don\'t work here: ? ℝ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> quotes <span class="token operator">=</span> <span class="token string">r#"And then I said: "There is no escape!""#</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> quotes<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> delimiter <span class="token operator">=</span> <span class="token string">r###"A string with "# in it. And even "##!"###</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> long_delimiter <span class="token operator">=</span> <span class="token string">r###"Hello, "##""###</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>long_delimiter<span class="token punctuation">,</span> <span class="token string">"Hello, \\"##\\""</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十一-1"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%B8%80-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十一</h3>\n<p>你无法通过索引的方式去访问字符串中的某个字符，但是可以使用切片的方式 <code class="language-text">&amp;s1[start..end]</code>，但是 start 和 end 必须准确落在字符的边界处</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22141199875397865000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hi,中国&quot;);\n    let h = s1[0]; // 修改当前行来修复错误，提示: \\`h\\` 字符在 UTF-8 格式中只需要 1 个字节来表示\n    assert_eq!(h, &quot;h&quot;);\n\n    let h1 = &s1[3..5];// 修改当前行来修复错误，提示: \\`中\\` 字符在 UTF-8 格式中需要 3 个字节来表示\n    assert_eq!(h1, &quot;中&quot;);\n}`, `22141199875397865000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi,中国"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> h <span class="token operator">=</span> s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 修改当前行来修复错误，提示: `h` 字符在 UTF-8 格式中只需要 1 个字节来表示</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> h1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 修改当前行来修复错误，提示: `中` 字符在 UTF-8 格式中需要 3 个字节来表示</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h1<span class="token punctuation">,</span> <span class="token string">"中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-63"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-63" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10080275642413715000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s1 = String::from(&quot;hi,中国&quot;);\n    let h = &s1[0..1];\n    assert_eq!(h, &quot;h&quot;);\n\n    let h1 = &s1[3..6];\n    assert_eq!(h1, &quot;中&quot;);\n}`, `10080275642413715000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi,中国"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> h <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> h1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>h1<span class="token punctuation">,</span> <span class="token string">"中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十二"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84905424144182720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空，打印出 &quot;你好，世界&quot; 中的每一个字符\n    for c in &quot;你好，世界&quot;.__ {\n        println!(&quot;{}&quot;, c)\n    }\n}`, `84905424144182720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空，打印出 "你好，世界" 中的每一个字符</span>\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"你好，世界"</span><span class="token punctuation">.</span>__ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-64"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-64" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60306341730052200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    for c in &quot;你好，世界&quot;.chars() {\n        println!(&quot;{}&quot;, c)\n    }\n}`, `60306341730052200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"你好，世界"</span><span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十三"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十三</h3>\n<p>我们可以使用三方库 <code class="language-text">utf8_slice</code> 来访问 UTF-8 字符串的某个子串，但是与之前不同的是，该库索引的是字符，而不是字节</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8146973527094192000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use utf8_slice;\nfn main() {\n    let s = &quot;The 🚀 goes to the 🌑!&quot;;\n\n    let rocket = utf8_slice::slice(s, 4, 5);\n    // 结果是 &quot;🚀&quot;，索引的是字符\n}`, `8146973527094192000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> utf8_slice<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"The 🚀 goes to the 🌑!"</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> rocket <span class="token operator">=</span> utf8_slice<span class="token punctuation">::</span><span class="token function">slice</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 结果是 "🚀"，索引的是字符</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="数组"><a href="#%E6%95%B0%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数组</h2>\n<h3 id="问题一-8"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>数组的类型是 [T; Length]，就如你所看到的，数组的长度是类型签名的一部分，因此数组的长度必须在编译期就已知</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84642766509192450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 使用合适的类型填空\n    let arr: __ = [1, 2, 3, 4, 5];\n\n    // 修改以下代码，让它顺利运行\n    assert!(arr.len() == 4);\n}`, `84642766509192450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用合适的类型填空</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> __ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 修改以下代码，让它顺利运行</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-65"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-65" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86391963214452950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [i32; 5] = [1, 2, 3, 4, 5];\n\n    assert!(arr.len() == 5);\n}`, `86391963214452950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-8"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21401513295133980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 很多时候，我们可以忽略数组的部分类型，也可以忽略全部类型，让编译器帮助我们推导\n    let arr0 = [1, 2, 3];\n    let arr: [_; 3] = [\'a\', \'b\', \'c\'];\n\n    // 填空\n    // 数组分配在栈上， \\`std::mem::size_of_val\\` 函数会返回整个数组占用的内存空间\n    // 数组中的每个 char 元素占用 4 字节的内存空间，因为在 Rust 中， char 是 Unicode 字符\n    assert!(std::mem::size_of_val(&arr) == __);\n}`, `21401513295133980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 很多时候，我们可以忽略数组的部分类型，也可以忽略全部类型，让编译器帮助我们推导</span>\n    <span class="token keyword">let</span> arr0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>_<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token comment">// 数组分配在栈上， `std::mem::size_of_val` 函数会返回整个数组占用的内存空间</span>\n    <span class="token comment">// 数组中的每个 char 元素占用 4 字节的内存空间，因为在 Rust 中， char 是 Unicode 字符</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arr<span class="token punctuation">)</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-66"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-66" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58476301720646290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr0 = [1, 2, 3];\n    let arr: [_; 3] = [\'a\', \'b\', \'c\'];\n\n    assert!(std::mem::size_of_val(&arr) == 12);\n}`, `58476301720646290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr0 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>_<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>arr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-8"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>数组中的所有元素可以一起初始化为同一个值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79100879452841790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空\n    let list: [i32; 100] = __ ;\n\n    assert!(list[0] == 1);\n    assert!(list.len() == 100);\n}`, `79100879452841790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> __ <span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-67"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-67" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11934955682908144000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let list: [i32; 100] = [1; 100];\n\n    assert!(list[0] == 1);\n    assert!(list.len() == 100);\n}`, `11934955682908144000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> list<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-7"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>数组中的所有元素必须是同一类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30925238278250377000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 修复错误\n    let _arr = [1, 2, \'3\'];\n}`, `30925238278250377000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 修复错误</span>\n    <span class="token keyword">let</span> _arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token char string">\'3\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-68"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-68" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6689260826799148000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _arr = [1, 2, 3];\n}`, `6689260826799148000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-7"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>数组的下标索引从 0 开始</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90805937052605150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr = [\'a\', \'b\', \'c\'];\n\n    let ele = arr[1]; // 只修改此行来让代码工作\n\n    assert!(ele == \'a\');\n}`, `90805937052605150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 只修改此行来让代码工作</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>ele <span class="token operator">==</span> <span class="token char string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-69"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-69" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42942221150223745000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr = [\'a\', \'b\', \'c\'];\n\n    let ele = arr[0];\n\n    assert!(ele == \'a\');\n}`, `42942221150223745000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> <span class="token char string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>ele <span class="token operator">==</span> <span class="token char string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-6"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>越界索引会导致代码的 panic</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67901576821194490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码中的错误\nfn main() {\n    let names = [String::from(&quot;Sunfei&quot;), &quot;Sunface&quot;.to_string()];\n\n    // \\`get\\` 返回 \\`Option<T>\\` 类型，因此它的使用非常安全\n    let name0 = names.get(0).unwrap();\n\n    // 但是下标索引就存在越界的风险了\n    let _name1 = &names[2];\n}`, `67901576821194490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码中的错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// `get` 返回 `Option&lt;T>` 类型，因此它的使用非常安全</span>\n    <span class="token keyword">let</span> name0 <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 但是下标索引就存在越界的风险了</span>\n    <span class="token keyword">let</span> _name1 <span class="token operator">=</span> <span class="token operator">&amp;</span>names<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-70"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-70" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73046940869301660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let names = [String::from(&quot;Sunfei&quot;), &quot;Sunface&quot;.to_string()];\n\n    let name0 = names.get(0).unwrap();\n\n    let _name1 = &names[1];\n}`, `73046940869301660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> name0 <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _name1 <span class="token operator">=</span> <span class="token operator">&amp;</span>names<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="切片"><a href="#%E5%88%87%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切片</h2>\n<h3 id="问题一-9"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>这里 <code class="language-text">[i32]</code> 和 str 都是切片类型，但是直接使用它们会造成编译错误，如下代码所示。为了解决，你需要使用切片的引用： <code class="language-text">&amp;[i32]</code>，&#x26;str</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64182703751677650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码中的错误，不要新增代码行!\nfn main() {\n    let arr = [1, 2, 3];\n    let s1: [i32] = arr[0..2];\n\n    let s2: str = &quot;hello, world&quot; as str;\n}`, `64182703751677650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码中的错误，不要新增代码行!</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> s2<span class="token punctuation">:</span> str <span class="token operator">=</span> <span class="token string">"hello, world"</span> <span class="token keyword">as</span> str<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-71"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-71" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88572021904174250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr = [1, 2, 3];\n    let s1: &[i32] = &arr[0..2];\n\n    let s2: &str = &quot;hello, world&quot;;\n}`, `88572021904174250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>i32<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token string">"hello, world"</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-9"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>一个切片引用占用了 2 个字大小的内存空间(从现在开始，为了简洁性考虑，如无特殊原因，我们统一使用切片来特指切片引用)。该切片的第一个字是指向数据的指针，第二个字是切片的长度。字的大小取决于处理器架构，例如在 x86-64 上，字的大小是 64 位也就是 8 个字节，那么一个切片引用就是 16 个字节大小。</p>\n<p>切片(引用)可以用来借用数组的某个连续的部分，对应的签名是 <code class="language-text">&amp;[T]</code>，大家可以与数组的签名对比下 <code class="language-text">[T; Length]</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77908500331304370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [char; 3] = [\'中\', \'国\', \'人\'];\n\n    let slice = &arr[..2];\n\n    // 修改数字 \\`8\\` 让代码工作\n    // 小提示: 切片和数组不一样，它是引用。如果是数组的话，那下面的 \\`assert!\\` 将会通过： \'中\'和\'国\'是 char 类型，char 类型是 Unicode 编码，大小固定为 4 字节，两个字符为 8 字节。\n    assert!(std::mem::size_of_val(&slice) == 8);\n}`, `77908500331304370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>char<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'中\'</span><span class="token punctuation">,</span> <span class="token char string">\'国\'</span><span class="token punctuation">,</span> <span class="token char string">\'人\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 修改数字 `8` 让代码工作</span>\n    <span class="token comment">// 小提示: 切片和数组不一样，它是引用。如果是数组的话，那下面的 `assert!` 将会通过： \'中\'和\'国\'是 char 类型，char 类型是 Unicode 编码，大小固定为 4 字节，两个字符为 8 字节。</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>slice<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-72"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-72" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66639013936696350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [char; 3] = [\'中\', \'国\', \'人\'];\n\n    let slice = &arr[..2];\n\n    // 16 是切片大小\n    assert!(std::mem::size_of_val(&slice) == 16);\n    // 8 是数组大小\n    assert!(std::mem::size_of_val(slice) == 8);\n}`, `66639013936696350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>char<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'中\'</span><span class="token punctuation">,</span> <span class="token char string">\'国\'</span><span class="token punctuation">,</span> <span class="token char string">\'人\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 16 是切片大小</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>slice<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 8 是数组大小</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span><span class="token function">size_of_val</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-9"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85611040991364170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let arr: [i32; 5] = [1, 2, 3, 4, 5];\n  // 填空让代码工作起来\n  let slice: __ = __;\n  assert_eq!(slice, &[2, 3, 4]);\n}`, `85611040991364170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token comment">// 填空让代码工作起来</span>\n  <span class="token keyword">let</span> slice<span class="token punctuation">:</span> __ <span class="token operator">=</span> __<span class="token punctuation">;</span>\n  <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-73"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-73" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57801608294974780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [i32; 5] = [1, 2, 3, 4, 5];\n    // let slice: &[i32] = &arr[1..=3];\n    let slice: &[i32] = &arr[1..4];\n    assert_eq!(slice, &[2, 3, 4]);\n}`, `57801608294974780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>i32<span class="token punctuation">;</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// let slice: &amp;[i32] = &amp;arr[1..=3];</span>\n    <span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>i32<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-8"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39874865872712204000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello&quot;);\n\n    let slice1 = &s[0..2];\n    // 填空，不要再使用 0..2\n    let slice2 = &s[__];\n\n    assert_eq!(slice1, slice2);\n}`, `39874865872712204000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空，不要再使用 0..2</span>\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span>__<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-74"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-74" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82482933857923420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = String::from(&quot;hello&quot;);\n\n    let slice1 = &s[0..2];\n    // let slice2 = &s[..=1];\n    let slice2 = &s[..2];\n\n    assert_eq!(slice1, slice2);\n}`, `82482933857923420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// let slice2 = &amp;s[..=1];</span>\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-8"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82168356747615960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;你好，世界&quot;;\n    // 修改以下代码行，让代码工作起来\n    let slice = &s[0..2];\n\n    assert!(slice == &quot;你&quot;);\n}`, `82168356747615960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"你好，世界"</span><span class="token punctuation">;</span>\n    <span class="token comment">// 修改以下代码行，让代码工作起来</span>\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>slice <span class="token operator">==</span> <span class="token string">"你"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-75"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-75" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44913511585040000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;你好，世界&quot;;\n    let slice = &s[0..3];\n\n    assert!(slice == &quot;你&quot;);\n}`, `44913511585040000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"你好，世界"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> slice <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>slice <span class="token operator">==</span> <span class="token string">"你"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-7"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>&#x26;String 可以被隐式地转换成 &#x26;str 类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60754000956013445000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有错误\nfn main() {\n    let mut s = String::from(&quot;hello world&quot;);\n\n    // 这里, &s 是 \\`&String\\` 类型，但是 \\`first_character\\` 函数需要的是 \\`&str\\` 类型。\n    // 尽管两个类型不一样，但是代码仍然可以工作，原因是 \\`&String\\` 会被隐式地转换成 \\`&str\\` 类型，如果大家想要知道更多，可以看看 Deref 章节: https://course.rs/advance/smart-pointer/deref.html\n    let ch = first_character(&s);\n\n    s.clear(); // error!\n\n    println!(&quot;the first character is: {}&quot;, ch);\n}\nfn first_character(s: &str) -> &str {\n    &s[..1]\n}`, `60754000956013445000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 这里, &amp;s 是 `&amp;String` 类型，但是 `first_character` 函数需要的是 `&amp;str` 类型。</span>\n    <span class="token comment">// 尽管两个类型不一样，但是代码仍然可以工作，原因是 `&amp;String` 会被隐式地转换成 `&amp;str` 类型，如果大家想要知道更多，可以看看 Deref 章节: https://course.rs/advance/smart-pointer/deref.html</span>\n    <span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token function">first_character</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    s<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error!</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the first character is: {}"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">first_character</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n    <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-76"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-76" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37720451265051860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut s = String::from(&quot;hello world&quot;);\n\n    let ch = first_character(&s);\n\n    println!(&quot;the first character is: {}&quot;, ch);\n\n    s.clear(); // error!\n}\n\nfn first_character(s: &str) -> &str {\n    &s[..1]\n}`, `37720451265051860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ch <span class="token operator">=</span> <span class="token function">first_character</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the first character is: {}"</span><span class="token punctuation">,</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    s<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error!</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">first_character</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n    <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="元组"><a href="#%E5%85%83%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>元组</h2>\n<h3 id="问题一-10"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>元组中的元素可以是不同的类型。元组的类型签名是(T1, T2, …), 这里 T1, T2 是相对应的元组成员的类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88171102158613920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _t0: (u8,i16) = (0, -1);\n    // 元组的成员还可以是一个元组\n    let _t1: (u8, (i16, u32)) = (0, (-1, 1));\n    // 填空让代码工作\n    let t: (u8, __, i64, __, __) = (1u8, 2u16, 3i64, &quot;hello&quot;, String::from(&quot;, world&quot;));\n}`, `88171102158613920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _t0<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span>i16<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 元组的成员还可以是一个元组</span>\n    <span class="token keyword">let</span> _t1<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> <span class="token punctuation">(</span>i16<span class="token punctuation">,</span> u32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 填空让代码工作</span>\n    <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> __<span class="token punctuation">,</span> i64<span class="token punctuation">,</span> __<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1u8</span><span class="token punctuation">,</span> <span class="token number">2u16</span><span class="token punctuation">,</span> <span class="token number">3i64</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-77"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-77" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46805429866848850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let _t0: (u8,i16) = (0, -1);\n    let _t1: (u8, (i16, u32)) = (0, (-1, 1));\n    let t: (u8, u16, i64, &str, String) = (1u8, 2u16, 3i64, &quot;hello&quot;, String::from(&quot;, world&quot;));\n}`, `46805429866848850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _t0<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span>i16<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _t1<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> <span class="token punctuation">(</span>i16<span class="token punctuation">,</span> u32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token punctuation">(</span>u8<span class="token punctuation">,</span> u16<span class="token punctuation">,</span> i64<span class="token punctuation">,</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> String<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1u8</span><span class="token punctuation">,</span> <span class="token number">2u16</span><span class="token punctuation">,</span> <span class="token number">3i64</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-10"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>可以使用索引来获取元组的成员</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65960263634047210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改合适的地方，让代码工作\nfn main() {\n    let t = (&quot;i&quot;, &quot;am&quot;, &quot;sunface&quot;);\n    assert_eq!(t.1, &quot;sunface&quot;);\n}`, `65960263634047210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改合适的地方，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token number">.1</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-78"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-78" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29873500634939480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let t = (&quot;i&quot;, &quot;am&quot;, &quot;sunface&quot;);\n    assert_eq!(t.2, &quot;sunface&quot;);\n}`, `29873500634939480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"i"</span><span class="token punctuation">,</span> <span class="token string">"am"</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token number">.2</span><span class="token punctuation">,</span> <span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-10"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>过长的元组无法被打印输出</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77501584729135920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码错误\nfn main() {\n    let too_long_tuple = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13);\n    println!(&quot;too long tuple: {:?}&quot;, too_long_tuple);\n}`, `77501584729135920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> too_long_tuple <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"too long tuple: {:?}"</span><span class="token punctuation">,</span> too_long_tuple<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-79"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-79" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="861340434241708500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let too_long_tuple = (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12);\n    println!(&quot;too long tuple: {:?}&quot;, too_long_tuple);\n}`, `861340434241708500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> too_long_tuple <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"too long tuple: {:?}"</span><span class="token punctuation">,</span> too_long_tuple<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-9"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>使用模式匹配来解构元组</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56763323197363814000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let tup = (1, 6.4, &quot;hello&quot;);\n\n    // 填空\n    let __ = tup;\n\n    assert_eq!(x, 1);\n    assert_eq!(y, &quot;hello&quot;);\n    assert_eq!(z, 6.4);\n}`, `56763323197363814000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> tup <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> __ <span class="token operator">=</span> tup<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-80"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32287230782863240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let tup = (1, 6.4, &quot;hello&quot;);\n\n    let (x, z, y) = tup;\n\n    assert_eq!(x, 1);\n    assert_eq!(y, &quot;hello&quot;);\n    assert_eq!(z, 6.4);\n}`, `32287230782863240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> tup <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> z<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> tup<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">6.4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-9"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>解构式赋值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50929221376207100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y, z);\n\n    // 填空\n    __ = (1, 2, 3);\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 1);\n    assert_eq!(z, 2);\n}`, `50929221376207100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    __ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-81"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85711256877230470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y, z);\n\n    (y, z, x) = (1, 2, 3);\n\n    assert_eq!(x, 3);\n    assert_eq!(y, 1);\n    assert_eq!(z, 2);\n}`, `85711256877230470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token punctuation">(</span>y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> x<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-8"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>元组可以用于函数的参数和返回值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19271309422840345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 填空，需要稍微计算下\n    let (x, y) = sum_multiply(__);\n\n    assert_eq!(x, 5);\n    assert_eq!(y, 6);\n}\n\nfn sum_multiply(nums: (i32, i32)) -> (i32, i32) {\n    (nums.0 + nums.1, nums.0 * nums.1)\n}`, `19271309422840345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空，需要稍微计算下</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">(</span>nums<span class="token number">.0</span> <span class="token operator">+</span> nums<span class="token number">.1</span><span class="token punctuation">,</span> nums<span class="token number">.0</span> <span class="token operator">*</span> nums<span class="token number">.1</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-82"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13311472226377097000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let (x, y) = sum_multiply((2, 3));\n\n    assert_eq!(x, 5);\n    assert_eq!(y, 6);\n}\n\nfn sum_multiply(nums: (i32, i32)) -> (i32, i32) {\n    (nums.0 + nums.1, nums.0 * nums.1)\n}`, `13311472226377097000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">sum_multiply</span><span class="token punctuation">(</span>nums<span class="token punctuation">:</span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">(</span>nums<span class="token number">.0</span> <span class="token operator">+</span> nums<span class="token number">.1</span><span class="token punctuation">,</span> nums<span class="token number">.0</span> <span class="token operator">*</span> nums<span class="token number">.1</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="结构体"><a href="#%E7%BB%93%E6%9E%84%E4%BD%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结构体</h2>\n<h3 id="问题一-11"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>对于结构体，我们必须为其中的每一个字段都指定具体的值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98827516589996100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// fix the error\nstruct Person {\n    name: String,\n    age: u8,\n    hobby: String\n}\nfn main() {\n    let age = 30;\n    let p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n    };\n}`, `98827516589996100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// fix the error</span>\n<span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n    hobby<span class="token punctuation">:</span> String\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-83"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25851471866309538000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Person {\n    name: String,\n    age: u8,\n    hobby: String,\n}\nfn main() {\n    let age = 30;\n    let p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n        hobby: String::from(&quot;dsa&quot;),\n    };\n}`, `25851471866309538000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n    hobby<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n        hobby<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"dsa"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-11"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>单元结构体没有任何字段</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41633556614605090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Unit;\ntrait SomeTrait {\n    // ...定义一些行为\n}\n\n// 我们并不关心结构体中有什么数据( 字段 )，但我们关心它的行为。\n// 因此这里我们使用没有任何字段的单元结构体，然后为它实现一些行为\nimpl SomeTrait for Unit {  }\nfn main() {\n    let u = Unit;\n    do_something_with_unit(u);\n}\n\n// 填空，让代码工作\nfn do_something_with_unit(u: __) {   }`, `41633556614605090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Unit<span class="token punctuation">;</span>\n<span class="token keyword">trait</span> SomeTrait <span class="token punctuation">{</span>\n    <span class="token comment">// ...定义一些行为</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 我们并不关心结构体中有什么数据( 字段 )，但我们关心它的行为。</span>\n<span class="token comment">// 因此这里我们使用没有任何字段的单元结构体，然后为它实现一些行为</span>\n<span class="token keyword">impl</span> SomeTrait <span class="token keyword">for</span> Unit <span class="token punctuation">{</span>  <span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u <span class="token operator">=</span> Unit<span class="token punctuation">;</span>\n    <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> __<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-84"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46745649709764534000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Unit;\ntrait SomeTrait {\n}\n\nimpl SomeTrait for Unit {}\nfn main() {\n    let u = Unit;\n    do_something_with_unit(u);\n}\n\nfn do_something_with_unit(u: Unit) {}`, `46745649709764534000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Unit<span class="token punctuation">;</span>\n<span class="token keyword">trait</span> SomeTrait <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> SomeTrait <span class="token keyword">for</span> Unit <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u <span class="token operator">=</span> Unit<span class="token punctuation">;</span>\n    <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">do_something_with_unit</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> Unit<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-11"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>元组结构体看起来跟元组很像，但是它拥有一个结构体的名称，该名称可以赋予它一定的意义。由于它并不关心内部数据到底是什么名称，因此此时元组结构体就非常适合</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36302443800366113000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nstruct Color(i32, i32, i32);\nstruct Point(i32, i32, i32);\nfn main() {\n    let v = Point(__, __, __);\n    check_color(v);\n}\n\nfn check_color(p: Color) {\n   let (x, _, _) = p;\n   assert_eq!(x, 0);\n   assert_eq!(p.1, 127);\n   assert_eq!(__, 255);\n}`, `36302443800366113000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">struct</span> <span class="token function">Color</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">struct</span> <span class="token function">Point</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> __<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">check_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">check_color</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> Color<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p<span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-85"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22097834196961096000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Color(i32, i32, i32);\nstruct Point(i32, i32, i32);\nfn main() {\n    let v = Point(0, 127, 255);\n    check_color(v);\n}\n\nfn check_color(p: Point) {\n    let Point(x, y, z) = p;\n    assert_eq!(x, 0);\n    assert_eq!(p.1, 127);\n    assert_eq!(z, 255);\n}`, `22097834196961096000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> <span class="token function">Color</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">struct</span> <span class="token function">Point</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">check_color</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">check_color</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token function">Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">=</span> p<span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p<span class="token number">.1</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>z<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-10"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>你可以在实例化一个结构体时将它整体标记为可变的，但是 Rust 不允许我们将结构体的某个字段专门指定为可变的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92690099318287100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误，不要增加或移除代码行\nstruct Person {\n    name: String,\n    age: u8,\n}\nfn main() {\n    let age = 18;\n    let p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n    };\n\n    // how can you believe sunface is only 18?\n    p.age = 30;\n\n    // 填空\n    __ = String::from(&quot;sunfei&quot;);\n}`, `92690099318287100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误，不要增加或移除代码行</span>\n<span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// how can you believe sunface is only 18?</span>\n    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    __ <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-86"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35866488158078382000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Person {\n    name: String,\n    age: u8,\n}\nfn main() {\n    let age = 18;\n    let mut p = Person {\n        name: String::from(&quot;sunface&quot;),\n        age,\n    };\n\n    p.age = 30;\n\n    p.name = String::from(&quot;sunfei&quot;);\n}`, `35866488158078382000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> p <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>\n\n    p<span class="token punctuation">.</span>name <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunfei"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-10"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>使用结构体字段初始化缩略语法可以减少一些重复代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="532763372699252030"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nstruct Person {\n    name: String,\n    age: u8,\n}\nfn main() {}\n\nfn build_person(name: String, age: u8) -> Person {\n    Person {\n        age,\n        __\n    }\n}`, `532763372699252030`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">build_person</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> String<span class="token punctuation">,</span> age<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> Person <span class="token punctuation">{</span>\n    Person <span class="token punctuation">{</span>\n        age<span class="token punctuation">,</span>\n        __\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-87"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58830718990619440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Person {\n    name: String,\n    age: u8,\n}\nfn main() {}\n\nfn build_person(name: String, age: u8) -> Person {\n    Person {\n        age,\n        name\n    }\n}`, `58830718990619440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">build_person</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> String<span class="token punctuation">,</span> age<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> Person <span class="token punctuation">{</span>\n    Person <span class="token punctuation">{</span>\n        age<span class="token punctuation">,</span>\n        name\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-9"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>你可以使用结构体更新语法基于一个结构体实例来构造另一个</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68322187395498580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nstruct User {\n    active: bool,\n    username: String,\n    email: String,\n    sign_in_count: u64,\n}\nfn main() {\n    let u1 = User {\n        email: String::from(&quot;someone@example.com&quot;),\n        username: String::from(&quot;sunface&quot;),\n        active: true,\n        sign_in_count: 1,\n    };\n\n    let u2 = set_email(u1);\n}\n\nfn set_email(u: User) -> User {\n    User {\n        email: String::from(&quot;contact@im.dev&quot;),\n        __\n    }\n}`, `68322187395498580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">struct</span> User <span class="token punctuation">{</span>\n    active<span class="token punctuation">:</span> bool<span class="token punctuation">,</span>\n    username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    email<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    sign_in_count<span class="token punctuation">:</span> u64<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u1 <span class="token operator">=</span> User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        username<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        active<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>\n        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> u2 <span class="token operator">=</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">-></span> User <span class="token punctuation">{</span>\n    User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"contact@im.dev"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        __\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-88"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17042732746018198000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct User {\n    active: bool,\n    username: String,\n    email: String,\n    sign_in_count: u64,\n}\nfn main() {\n    let u1 = User {\n        email: String::from(&quot;someone@example.com&quot;),\n        username: String::from(&quot;sunface&quot;),\n        active: true,\n        sign_in_count: 1,\n    };\n\n    let u2 = set_email(u1);\n}\n\nfn set_email(u: User) -> User {\n    User {\n        email: String::from(&quot;contact@im.dev&quot;),\n        ..u\n    }\n}`, `17042732746018198000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> User <span class="token punctuation">{</span>\n    active<span class="token punctuation">:</span> bool<span class="token punctuation">,</span>\n    username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    email<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    sign_in_count<span class="token punctuation">:</span> u64<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> u1 <span class="token operator">=</span> User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"someone@example.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        username<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        active<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">,</span>\n        sign_in_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> u2 <span class="token operator">=</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">set_email</span><span class="token punctuation">(</span>u<span class="token punctuation">:</span> User<span class="token punctuation">)</span> <span class="token punctuation">-></span> User <span class="token punctuation">{</span>\n    User <span class="token punctuation">{</span>\n        email<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"contact@im.dev"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">..</span>u\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-5"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<p>我们可以使用 <code class="language-text">#[derive(Debug)]</code> 让结构体变成可打印的.</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84191696059334870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\n#[__]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nfn main() {\n    let scale = 2;\n    let rect1 = Rectangle {\n        width: dbg!(30 * scale), // 打印 debug 信息到标准错误输出 stderr,并将 \\`30 * scale\\` 的值赋给 \\`width\\`\n        height: 50,\n    };\n\n    dbg!(&rect1); // 打印 debug 信息到标准错误输出 stderr\n\n    println!(__, rect1); // 打印 debug 信息到标准输出 stdout\n}`, `84191696059334870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token attribute attr-name">#[__]</span>\n<span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>\n        width<span class="token punctuation">:</span> <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 打印 debug 信息到标准错误输出 stderr,并将 `30 * scale` 的值赋给 `width`</span>\n        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印 debug 信息到标准错误输出 stderr</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> rect1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印 debug 信息到标准输出 stdout</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-89"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84305423625357120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nfn main() {\n    let scale = 2;\n    let rect1 = Rectangle {\n        width: dbg!(30 * scale),\n        height: 50,\n    };\n\n    dbg!(&rect1);\n\n    println!(&quot;{:#?}&quot;, rect1);\n}`, `84305423625357120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> scale <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>\n        width<span class="token punctuation">:</span> <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token number">30</span> <span class="token operator">*</span> scale<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rect1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:#?}"</span><span class="token punctuation">,</span> rect1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-5"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<p>当解构一个变量时，可以同时使用 move 和引用模式绑定的方式。当这么做时，部分 move 就会发生：变量中一部分的所有权被转移给其它变量，而另一部分我们获取了它的引用。</p>\n<p>在这种情况下，原变量将无法再被使用，但是它没有转移所有权的那一部分依然可以使用，也就是之前被引用的那部分。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26424738795396506000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    #[derive(Debug)]\n    struct Person {\n        name: String,\n        age: Box<u8>,\n    }\n\n    let person = Person {\n        name: String::from(&quot;Alice&quot;),\n        age: Box::new(20),\n    };\n\n    // 通过这种解构式模式匹配，person.name 的所有权被转移给新的变量 \\`name\\`\n    // 但是，这里 \\`age\\` 变量确是对 person.age 的引用, 这里 ref 的使用相当于: let age = &person.age\n    let Person { name, ref age } = person;\n\n    println!(&quot;The person\'s age is {}&quot;, age);\n\n    println!(&quot;The person\'s name is {}&quot;, name);\n\n    // Error! 原因是 person 的一部分已经被转移了所有权，因此我们无法再使用它\n    //println!(&quot;The person struct is {:?}&quot;, person);\n\n    // 虽然 \\`person\\` 作为一个整体无法再被使用，但是 \\`person.age\\` 依然可以使用\n    println!(&quot;The person\'s age from person struct is {}&quot;, person.age);\n}`, `26424738795396506000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token attribute attr-name">#[derive(Debug)]</span>\n    <span class="token keyword">struct</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n        age<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">let</span> person <span class="token operator">=</span> Person <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">:</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 通过这种解构式模式匹配，person.name 的所有权被转移给新的变量 `name`</span>\n    <span class="token comment">// 但是，这里 `age` 变量确是对 person.age 的引用, 这里 ref 的使用相当于: let age = &amp;person.age</span>\n    <span class="token keyword">let</span> Person <span class="token punctuation">{</span> name<span class="token punctuation">,</span> <span class="token keyword">ref</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> person<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The person\'s age is {}"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The person\'s name is {}"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Error! 原因是 person 的一部分已经被转移了所有权，因此我们无法再使用它</span>\n    <span class="token comment">//println!("The person struct is {:?}", person);</span>\n\n    <span class="token comment">// 虽然 `person` 作为一个整体无法再被使用，但是 `person.age` 依然可以使用</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The person\'s age from person struct is {}"</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-5"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8233020668030599000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\n#[derive(Debug)]\nstruct File {\n    name: String,\n    data: String,\n}\nfn main() {\n    let f = File {\n        name: String::from(&quot;readme.md&quot;),\n        data: &quot;Rust By Practice&quot;.to_string()\n    };\n\n    let _name = f.name;\n\n    // 只能修改这一行\n    println!(&quot;{}, {}, {:?}&quot;,f.name, f.data, f);\n}`, `8233020668030599000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> File <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    data<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> File <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"readme.md"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        data<span class="token punctuation">:</span> <span class="token string">"Rust By Practice"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _name <span class="token operator">=</span> f<span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n\n    <span class="token comment">// 只能修改这一行</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}, {:?}"</span><span class="token punctuation">,</span>f<span class="token punctuation">.</span>name<span class="token punctuation">,</span> f<span class="token punctuation">.</span>data<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-90"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5536838960974433000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct File {\n    name: String,\n    data: String,\n}\nfn main() {\n    let f = File {\n        name: String::from(&quot;readme.md&quot;),\n        data: &quot;Rust By Practice&quot;.to_string(),\n    };\n\n    let _name = f.name;\n\n    println!(&quot;{}, {}&quot;, _name, f.data);\n}`, `5536838960974433000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> File <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    data<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> File <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"readme.md"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        data<span class="token punctuation">:</span> <span class="token string">"Rust By Practice"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> _name <span class="token operator">=</span> f<span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> _name<span class="token punctuation">,</span> f<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="枚举"><a href="#%E6%9E%9A%E4%B8%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>枚举</h2>\n<h3 id="问题一-12"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>在创建枚举时，你可以使用显式的整数设定枚举成员的值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22150513460798083000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nenum Number {\n    Zero,\n    One,\n    Two,\n}\n\nenum Number1 {\n    Zero = 0,\n    One,\n    Two,\n}\n\n// C语言风格的枚举定义\nenum Number2 {\n    Zero = 0.0,\n    One = 1.0,\n    Two = 2.0,\n}\n\n\nfn main() {\n    // 通过 \\`as\\` 可以将枚举值强转为整数类型\n    assert_eq!(Number::One, Number1::One);\n    assert_eq!(Number1::One, Number2::One);\n}`, `22150513460798083000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">enum</span> Number <span class="token punctuation">{</span>\n    Zero<span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Number1 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// C语言风格的枚举定义</span>\n<span class="token keyword">enum</span> Number2 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">,</span>\n    One <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">,</span>\n    Two <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 通过 `as` 可以将枚举值强转为整数类型</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number<span class="token punctuation">::</span>One<span class="token punctuation">,</span> Number1<span class="token punctuation">::</span>One<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number1<span class="token punctuation">::</span>One<span class="token punctuation">,</span> Number2<span class="token punctuation">::</span>One<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-91"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8535922449679134000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Number {\n    Zero,\n    One,\n    Two,\n}\n\nenum Number1 {\n    Zero = 0,\n    One,\n    Two,\n}\n\nenum Number2 {\n    Zero = 0,\n    One = 1,\n    Two = 2,\n}\n\n\nfn main() {\n    assert_eq!(Number::One as u8, Number1::One as u8);\n    assert_eq!(Number1::One as u8, Number2::One as u8);\n}`, `8535922449679134000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Number <span class="token punctuation">{</span>\n    Zero<span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Number1 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    One<span class="token punctuation">,</span>\n    Two<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Number2 <span class="token punctuation">{</span>\n    Zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    One <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    Two <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">,</span> Number1<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Number1<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">,</span> Number2<span class="token punctuation">::</span>One <span class="token keyword">as</span> u8<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-12"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>枚举成员可以持有各种类型的值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55247686150515760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg1 = Message::Move{__}; // 使用x = 1, y = 2 来初始化\n    let msg2 = Message::Write(__); // 使用 &quot;hello, world!&quot; 来初始化\n}`, `55247686150515760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg1 <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>__<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 使用x = 1, y = 2 来初始化</span>\n    <span class="token keyword">let</span> msg2 <span class="token operator">=</span> Message<span class="token punctuation">::</span><span class="token function">Write</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 "hello, world!" 来初始化</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-92"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22911509813288178000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg1 = Message::Move { x: 1, y: 2 };\n    let msg2 = Message::Write(String::from(&quot;hello, world!&quot;));\n}`, `22911509813288178000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg1 <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> msg2 <span class="token operator">=</span> Message<span class="token punctuation">::</span><span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-12"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>枚举成员中的值可以使用模式匹配来获取</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13139622822454490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 仅填空并修复错误\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg = Message::Move{x: 1, y: 2};\n\n    if let Message::Move{__} = msg {\n        assert_eq!(a, b);\n    } else {\n        panic!(&quot;不要让这行代码运行！&quot;);\n    }\n}`, `13139622822454490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 仅填空并修复错误</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>__<span class="token punctuation">}</span> <span class="token operator">=</span> msg <span class="token punctuation">{</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-93"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64098968929407700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msg = Message::Move { x: 1, y: 1 };\n\n    if let Message::Move { x: a, y: b } = msg {\n        assert_eq!(a, b);\n    } else {\n        panic!(&quot;不要让这行代码运行！&quot;);\n    }\n}`, `64098968929407700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> a<span class="token punctuation">,</span> y<span class="token punctuation">:</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> msg <span class="token punctuation">{</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-11"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>使用枚举对类型进行同一化</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51818227564415410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，并修复错误\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msgs: __ = [\n        Message::Quit,\n        Message::Move{x:1, y:3},\n        Message::ChangeColor(255,255,0)\n    ];\n\n    for msg in msgs {\n        show_message(msg)\n    }\n}\n\nfn show_message(msg: Message) {\n    println!(&quot;{}&quot;, msg);\n}`, `51818227564415410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，并修复错误</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msgs<span class="token punctuation">:</span> __ <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Message<span class="token punctuation">::</span>Quit<span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> msg <span class="token keyword">in</span> msgs <span class="token punctuation">{</span>\n        <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-94"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52008895711821880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msgs = [\n        Message::Quit,\n        Message::Move { x: 1, y: 3 },\n        Message::ChangeColor(255, 255, 0),\n    ];\n\n    for msg in msgs {\n        show_message(msg)\n    }\n}\n\nfn show_message(msg: Message) {\n    println!(&quot;{:#?}&quot;, msg);\n}`, `52008895711821880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msgs <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Message<span class="token punctuation">::</span>Quit<span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> msg <span class="token keyword">in</span> msgs <span class="token punctuation">{</span>\n        <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:#?}"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-11"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>Rust 中没有 null，我们通过 <code class="language-text">Option&lt;T&gt;</code> 枚举来处理值为空的情况</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96788310504435990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空让 \\`println\\` 输出，同时添加一些代码不要让最后一行的 \\`panic\\` 执行到\nfn main() {\n    let five = Some(5);\n    let six = plus_one(five);\n    let none = plus_one(None);\n\n    if let __ = six {\n        println!(&quot;{}&quot;, n)\n    }\n\n    panic!(&quot;不要让这行代码运行！&quot;);\n}\n\nfn plus_one(x: Option<i32>) -> Option<i32> {\n    match x {\n        __ => None,\n        __ => Some(i + 1),\n    }\n}`, `96788310504435990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空让 `println` 输出，同时添加一些代码不要让最后一行的 `panic` 执行到</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> five <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> six <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>five<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> none <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> __ <span class="token operator">=</span> six <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> x <span class="token punctuation">{</span>\n        __ <span class="token operator">=></span> None<span class="token punctuation">,</span>\n        __ <span class="token operator">=></span> <span class="token function">Some</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-95"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39653002910773340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let five = Some(5);\n    let six = plus_one(five);\n    let none = plus_one(None);\n\n    if let Some(n) = six {\n        println!(&quot;{}&quot;, n);\n        return\n    }\n\n    panic!(&quot;不要让这行代码运行！&quot;);\n}\n\nfn plus_one(x: Option<i32>) -> Option<i32> {\n    match x {\n        None => None,\n        Some(i) => Some(i + 1),\n    }\n}`, `39653002910773340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> five <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> six <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>five<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> none <span class="token operator">=</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>None<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=</span> six <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"不要让这行代码运行！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">plus_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> x <span class="token punctuation">{</span>\n        None <span class="token operator">=></span> None<span class="token punctuation">,</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Some</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-10"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>使用枚举来实现链表</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22028187927990305000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码运行\nuse crate::List::*;\n\nenum List {\n    // Cons: 链表中包含有值的节点，节点是元组类型，第一个元素是节点的值，第二个元素是指向下一个节点的指针\n    Cons(u32, Box<List>),\n    // Nil: 链表中的最后一个节点，用于说明链表的结束\n    Nil,\n}\n\n// 为枚举实现一些方法\nimpl List {\n    // 创建空的链表\n    fn new() -> List {\n        // 因为没有节点，所以直接返回 Nil 节点\n        // 枚举成员 Nil 的类型是 List\n        Nil\n    }\n\n    // 在老的链表前面新增一个节点，并返回新的链表\n    fn prepend(self, elem: u32) -> __ {\n        Cons(elem, Box::new(self))\n    }\n\n    // 返回链表的长度\n    fn len(&self) -> u32 {\n        match *self {\n            // 这里我们不能拿走 tail 的所有权，因此需要获取它的引用\n            Cons(_, __ tail) => 1 + tail.len(),\n            // 空链表的长度为 0\n            Nil => 0\n        }\n    }\n\n    // 返回链表的字符串表现形式，用于打印输出\n    fn stringify(&self) -> String {\n        match *self {\n            Cons(head, ref tail) => {\n                // 递归生成字符串\n                format!(&quot;{}, {}&quot;, head, tail.__())\n            },\n            Nil => {\n                format!(&quot;Nil&quot;)\n            },\n        }\n    }\n}\n\nfn main() {\n    // 创建一个新的链表(也是空的)\n    let mut list = List::new();\n\n    // 添加一些元素\n    list = list.prepend(1);\n    list = list.prepend(2);\n    list = list.prepend(3);\n\n    // 打印列表的当前状态\n    println!(&quot;链表的长度是: {}&quot;, list.len());\n    println!(&quot;{}&quot;, list.stringify());\n}`, `22028187927990305000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码运行</span>\n<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>List<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>\n\n<span class="token keyword">enum</span> List <span class="token punctuation">{</span>\n    <span class="token comment">// Cons: 链表中包含有值的节点，节点是元组类型，第一个元素是节点的值，第二个元素是指向下一个节点的指针</span>\n    <span class="token function">Cons</span><span class="token punctuation">(</span>u32<span class="token punctuation">,</span> Box<span class="token operator">&lt;</span>List<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment">// Nil: 链表中的最后一个节点，用于说明链表的结束</span>\n    Nil<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 为枚举实现一些方法</span>\n<span class="token keyword">impl</span> List <span class="token punctuation">{</span>\n    <span class="token comment">// 创建空的链表</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> List <span class="token punctuation">{</span>\n        <span class="token comment">// 因为没有节点，所以直接返回 Nil 节点</span>\n        <span class="token comment">// 枚举成员 Nil 的类型是 List</span>\n        Nil\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 在老的链表前面新增一个节点，并返回新的链表</span>\n    <span class="token keyword">fn</span> <span class="token function">prepend</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> elem<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> __ <span class="token punctuation">{</span>\n        <span class="token function">Cons</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 返回链表的长度</span>\n    <span class="token keyword">fn</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 这里我们不能拿走 tail 的所有权，因此需要获取它的引用</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> __ tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">1</span> <span class="token operator">+</span> tail<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token comment">// 空链表的长度为 0</span>\n            Nil <span class="token operator">=></span> <span class="token number">0</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 返回链表的字符串表现形式，用于打印输出</span>\n    <span class="token keyword">fn</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token keyword">ref</span> tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token comment">// 递归生成字符串</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> head<span class="token punctuation">,</span> tail<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            Nil <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Nil"</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 创建一个新的链表(也是空的)</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> list <span class="token operator">=</span> List<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 添加一些元素</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 打印列表的当前状态</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"链表的长度是: {}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-96"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97279982143808470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use crate::List::*;\n\nenum List {\n    Cons(u32, Box<List>),\n    Nil,\n}\n\nimpl List {\n    fn new() -> List {\n        Nil\n    }\n\n    fn prepend(self, elem: u32) -> List {\n        Cons(elem, Box::new(self))\n    }\n\n    fn len(&self) -> u32 {\n        match *self {\n            Cons(_, ref tail) => 1 + tail.len(),\n            Nil => 0\n        }\n    }\n\n    fn stringify(&self) -> String {\n        match *self {\n            Cons(head, ref tail) => {\n                format!(&quot;{}, {}&quot;, head, tail.stringify())\n            },\n            Nil => {\n                format!(&quot;Nil&quot;)\n            },\n        }\n    }\n}\n\nfn main() {\n    let mut list = List::new();\n\n    list = list.prepend(1);\n    list = list.prepend(2);\n    list = list.prepend(3);\n\n    println!(&quot;链表的长度是: {}&quot;, list.len());\n    println!(&quot;{}&quot;, list.stringify());\n}`, `97279982143808470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>List<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>\n\n<span class="token keyword">enum</span> List <span class="token punctuation">{</span>\n    <span class="token function">Cons</span><span class="token punctuation">(</span>u32<span class="token punctuation">,</span> Box<span class="token operator">&lt;</span>List<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    Nil<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> List <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> List <span class="token punctuation">{</span>\n        Nil\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">prepend</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> elem<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> List <span class="token punctuation">{</span>\n        <span class="token function">Cons</span><span class="token punctuation">(</span>elem<span class="token punctuation">,</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token keyword">ref</span> tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">1</span> <span class="token operator">+</span> tail<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            Nil <span class="token operator">=></span> <span class="token number">0</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token operator">*</span><span class="token keyword">self</span> <span class="token punctuation">{</span>\n            <span class="token function">Cons</span><span class="token punctuation">(</span>head<span class="token punctuation">,</span> <span class="token keyword">ref</span> tail<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> head<span class="token punctuation">,</span> tail<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            Nil <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Nil"</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> list <span class="token operator">=</span> List<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"链表的长度是: {}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="流程控制"><a href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>流程控制</h1>\n<h2 id="问题一-13"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74612283914694540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let n = 5;\n\n    if n < 0 {\n        println!(&quot;{} is negative&quot;, n);\n    } __ n > 0 {\n        println!(&quot;{} is positive&quot;, n);\n    } __ {\n        println!(&quot;{} is zero&quot;, n);\n    }\n}`, `74612283914694540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is negative"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> __ n <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is positive"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> __ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is zero"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-97"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88453619226173870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let n = 5;\n\n    if n < 0 {\n        println!(&quot;{} is negative&quot;, n);\n    } else if n > 0 {\n        println!(&quot;{} is positive&quot;, n);\n    } else {\n        println!(&quot;{} is zero&quot;, n);\n    }\n}`, `88453619226173870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is negative"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is positive"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is zero"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题二-13"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h2>\n<p>if / else 可以用作表达式来进行赋值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75278241909630120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let n = 5;\n\n    let big_n =\n        if n < 10 && n > -10 {\n            println!(&quot;数字太小，先增加 10 倍再说&quot;);\n\n            10 * n\n        } else {\n            println!(&quot;数字太大，我们得让它减半&quot;);\n\n            n / 2.0;\n        }\n\n    println!(&quot;{} -> {}&quot;, n, big_n);\n}`, `75278241909630120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> big_n <span class="token operator">=</span>\n        <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> n <span class="token operator">></span> <span class="token operator">-</span><span class="token number">10</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"数字太小，先增加 10 倍再说"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token number">10</span> <span class="token operator">*</span> n\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"数字太大，我们得让它减半"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            n <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} -> {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> big_n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-98"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58849260491768270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let n = 5;\n\n    let big_n = if n < 10 && n > -10 {\n        println!(&quot;数字太小，先增加 10 倍再说&quot;);\n\n        10 * n\n    } else {\n        println!(&quot;数字太大，我们得让它减半&quot;);\n\n        n / 2\n    };\n\n    println!(&quot;{} -> {}&quot;, n, big_n);\n}`, `58849260491768270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> big_n <span class="token operator">=</span> <span class="token keyword">if</span> n <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> n <span class="token operator">></span> <span class="token operator">-</span><span class="token number">10</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"数字太小，先增加 10 倍再说"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token number">10</span> <span class="token operator">*</span> n\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"数字太大，我们得让它减半"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        n <span class="token operator">/</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} -> {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> big_n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题三-13"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h2>\n<p>for in 可以用于迭代一个迭代器，例如序列 a..b</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13361341302999773000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    for n in 1..=100 { // 修改此行，让代码工作\n        if n == 100 {\n            panic!(&quot;NEVER LET THIS RUN&quot;)\n        }\n    }\n}`, `13361341302999773000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span> <span class="token comment">// 修改此行，让代码工作</span>\n        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">100</span> <span class="token punctuation">{</span>\n            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"NEVER LET THIS RUN"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-99"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42536495506119730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    for n in 1..100 { // 修改此行，让代码工作\n        if n == 100 {\n            panic!(&quot;NEVER LET THIS RUN&quot;)\n        }\n    }\n}`, `42536495506119730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">100</span> <span class="token punctuation">{</span> <span class="token comment">// 修改此行，让代码工作</span>\n        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">100</span> <span class="token punctuation">{</span>\n            <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"NEVER LET THIS RUN"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题四-12"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54529997709628470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要新增或删除代码行\nfn main() {\n    let names = [String::from(&quot;liming&quot;),String::from(&quot;hanmeimei&quot;)];\n    for name in names {\n        // do something with name...\n    }\n\n    println!(&quot;{:?}&quot;, names);\n\n    let numbers = [1, 2, 3];\n    // numbers 中的元素实现了 Copy，因此无需转移所有权\n    for n in numbers {\n        // do something with name...\n    }\n\n    println!(&quot;{:?}&quot;, numbers);\n}`, `54529997709628470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要新增或删除代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"liming"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hanmeimei"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> name <span class="token keyword">in</span> names <span class="token punctuation">{</span>\n        <span class="token comment">// do something with name...</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// numbers 中的元素实现了 Copy，因此无需转移所有权</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers <span class="token punctuation">{</span>\n        <span class="token comment">// do something with name...</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-100"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-100" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44854370984778514000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let names = [String::from(&quot;liming&quot;), String::from(&quot;hanmeimei&quot;)];\n    for name in &names {\n        // do something with name...\n    }\n\n    println!(&quot;{:?}&quot;, names);\n\n    let numbers = [1, 2, 3];\n    // numbers 中的元素实现了 Copy，因此无需转移所有权\n    for n in numbers {\n        // do something with name...\n    }\n\n    println!(&quot;{:?}&quot;, numbers);\n}`, `44854370984778514000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> names <span class="token operator">=</span> <span class="token punctuation">[</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"liming"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hanmeimei"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> name <span class="token keyword">in</span> <span class="token operator">&amp;</span>names <span class="token punctuation">{</span>\n        <span class="token comment">// do something with name...</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// numbers 中的元素实现了 Copy，因此无需转移所有权</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> numbers <span class="token punctuation">{</span>\n        <span class="token comment">// do something with name...</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题五-12"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37760657436968810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let a = [4,3,2,1];\n\n    // 通过索引和值的方式迭代数组 \\`a\\`\n    for (i,v) in a.__ {\n        println!(&quot;第{}个元素是{}&quot;,i+1,v);\n    }\n}`, `37760657436968810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 通过索引和值的方式迭代数组 `a`</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span>__ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"第{}个元素是{}"</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-101"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-101" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97624530808682990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let a = [4, 3, 2, 1];\n\n    for (i, v) in a.iter().enumerate() {\n        println!(&quot;第{}个元素是{}&quot;, i + 1, v);\n    }\n}`, `97624530808682990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> a<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"第{}个元素是{}"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题六-11"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h2>\n<p>当条件为 true 时，while 将一直循环</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67221330727175774000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让最后一行的 println! 工作 !\nfn main() {\n    // 一个计数值\n    let mut n = 1;\n\n    // 当条件为真时，不停的循环\n    while n __ 10 {\n        if n % 15 == 0 {\n            println!(&quot;fizzbuzz&quot;);\n        } else if n % 3 == 0 {\n            println!(&quot;fizz&quot;);\n        } else if n % 5 == 0 {\n            println!(&quot;buzz&quot;);\n        } else {\n            println!(&quot;{}&quot;, n);\n        }\n\n\n        __;\n    }\n\n    println!(&quot;n 的值是 {}, 循环结束&quot;,n);\n}`, `67221330727175774000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让最后一行的 println! 工作 !</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 一个计数值</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 当条件为真时，不停的循环</span>\n    <span class="token keyword">while</span> n __ <span class="token number">10</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">15</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"fizzbuzz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"fizz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"buzz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n\n        __<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n 的值是 {}, 循环结束"</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-102"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-102" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63346650651274560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut n = 1;\n\n    while n < 10 {\n        if n % 15 == 0 {\n            println!(&quot;fizzbuzz&quot;);\n        } else if n % 3 == 0 {\n            println!(&quot;fizz&quot;);\n        } else if n % 5 == 0 {\n            println!(&quot;buzz&quot;);\n        } else {\n            println!(&quot;{}&quot;, n);\n        }\n\n        n += 1;\n    }\n\n    println!(&quot;n 的值是 {}, 循环结束&quot;, n);\n}`, `63346650651274560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">while</span> n <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">15</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"fizzbuzz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"fizz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> n <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"buzz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n 的值是 {}, 循环结束"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题七-6"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h2>\n<p>使用 break 可以跳出循环</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34082989693672206000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，不要修改其它代码\nfn main() {\n    let mut n = 0;\n    for i in 0..=100 {\n       if n == 66 {\n           __\n       }\n       n += 1;\n    }\n\n    assert_eq!(n, 66);\n}`, `34082989693672206000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span>\n       <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">66</span> <span class="token punctuation">{</span>\n           __\n       <span class="token punctuation">}</span>\n       n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-103"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-103" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96931091076677030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut n = 0;\n    for i in 0..=100 {\n        if n == 66 {\n            break;\n        }\n        n += 1;\n    }\n\n    assert_eq!(n, 66);\n}`, `96931091076677030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">66</span> <span class="token punctuation">{</span>\n            <span class="token keyword">break</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题八-6"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h2>\n<p>continue 会结束当次循环并立即开始下一次循环</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41585406940176500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，不要修改其它代码\nfn main() {\n    let mut n = 0;\n    for i in 0..=100 {\n       if n != 66 {\n           n + =1;\n           __;\n       }\n\n       __\n    }\n\n    assert_eq!(n, 66);\n}`, `41585406940176500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span>\n       <span class="token keyword">if</span> n <span class="token operator">!=</span> <span class="token number">66</span> <span class="token punctuation">{</span>\n           n <span class="token operator">+</span> <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>\n           __<span class="token punctuation">;</span>\n       <span class="token punctuation">}</span>\n\n       __\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-104"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-104" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98654049727704990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，不要修改其它代码\nfn main() {\n    let mut n = 0;\n    for i in 0..=100 {\n        if n != 66 {\n            n += 1;\n            continue;\n        }\n    }\n\n    assert_eq!(n, 66);\n}`, `98654049727704990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">100</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> n <span class="token operator">!=</span> <span class="token number">66</span> <span class="token punctuation">{</span>\n            n <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n            <span class="token keyword">continue</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题九-6"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h2>\n<p>loop 一般都需要配合 break 或 continue 一起使用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43361963292102490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，不要修改其它代码\nfn main() {\n    let mut count = 0u32;\n\n    println!(&quot;Let\'s count until infinity!&quot;);\n\n    // 无限循环\n    loop {\n        count += 1;\n\n        if count == 3 {\n            println!(&quot;three&quot;);\n\n            // 跳过当此循环的剩余代码\n            __;\n        }\n\n        println!(&quot;{}&quot;, count);\n\n        if count == 5 {\n            println!(&quot;OK, that\'s enough&quot;);\n\n            __;\n        }\n    }\n\n    assert_eq!(count, 5);\n}`, `43361963292102490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0u32</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Let\'s count until infinity!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 无限循环</span>\n    <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token comment">// 跳过当此循环的剩余代码</span>\n            __<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"OK, that\'s enough"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            __<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-105"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-105" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91533260467382600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut count = 0u32;\n\n    println!(&quot;Let\'s count until infinity!&quot;);\n\n    // 无限循环\n    loop {\n        count += 1;\n\n        if count == 3 {\n            println!(&quot;three&quot;);\n\n            // 跳过当前此循环的剩余代码\n            continue;\n        }\n\n        println!(&quot;{}&quot;, count);\n\n        if count == 5 {\n            println!(&quot;OK, that\'s enough&quot;);\n\n            break;\n        }\n    }\n\n    assert_eq!(count, 5);\n}`, `91533260467382600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0u32</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Let\'s count until infinity!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 无限循环</span>\n    <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token comment">// 跳过当前此循环的剩余代码</span>\n            <span class="token keyword">continue</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"OK, that\'s enough"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token keyword">break</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题十-3"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h2>\n<p>loop 是一个表达式，因此我们可以配合 break 来返回一个值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30280817148385686000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut counter = 0;\n\n    let result = loop {\n        counter += 1;\n\n        if counter == 10 {\n            __;\n        }\n    };\n\n    assert_eq!(result, 20);\n}`, `30280817148385686000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> counter <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">{</span>\n            __<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-106"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-106" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5456843049510219000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut counter = 0;\n\n    let result = loop {\n        counter += 1;\n\n        if counter == 10 {\n            break counter * 2;\n        }\n    };\n\n    assert_eq!(result, 20);\n}`, `5456843049510219000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> counter <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">{</span>\n            <span class="token keyword">break</span> counter <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题十一-2"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E4%B8%80-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十一</h2>\n<p>当有多层循环时，你可以使用 continue 或 break 来控制外层的循环。要实现这一点，外部的循环必须拥有一个标签 <code class="language-text">&#39;label</code>，然后在 break 或 continue 时指定该标签</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33461255045725348000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut count = 0;\n    \'outer: loop {\n        \'inner1: loop {\n            if count >= 20 {\n                // 这只会跳出 inner1 循环\n                break \'inner1; // 这里使用 \\`break\\` 也是一样的\n            }\n            count += 2;\n        }\n\n        count += 5;\n\n        \'inner2: loop {\n            if count >= 30 {\n                break \'outer;\n            }\n\n            continue \'outer;\n        }\n    }\n\n    assert!(count == __)\n}`, `33461255045725348000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token lifetime-annotation symbol">\'outer:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        <span class="token lifetime-annotation symbol">\'inner1:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">20</span> <span class="token punctuation">{</span>\n                <span class="token comment">// 这只会跳出 inner1 循环</span>\n                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">\'inner1;</span> <span class="token comment">// 这里使用 `break` 也是一样的</span>\n            <span class="token punctuation">}</span>\n            count <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        count <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n        <span class="token lifetime-annotation symbol">\'inner2:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">30</span> <span class="token punctuation">{</span>\n                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">\'outer;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">continue</span> <span class="token lifetime-annotation symbol">\'outer;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>count <span class="token operator">==</span> __<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-107"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-107" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83613944926737420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let mut count = 0;\n    \'outer: loop {\n        \'inner1: loop {\n            if count >= 20 {\n                break \'inner1;\n            }\n            count += 2;\n        }\n\n        count += 5;\n\n        \'inner2: loop {\n            if count >= 30 {\n                break \'outer;\n            }\n\n            continue \'outer;\n        }\n    }\n\n    assert!(count == 30)\n}`, `83613944926737420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token lifetime-annotation symbol">\'outer:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n        <span class="token lifetime-annotation symbol">\'inner1:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">20</span> <span class="token punctuation">{</span>\n                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">\'inner1;</span>\n            <span class="token punctuation">}</span>\n            count <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        count <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n\n        <span class="token lifetime-annotation symbol">\'inner2:</span> <span class="token keyword">loop</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> count <span class="token operator">>=</span> <span class="token number">30</span> <span class="token punctuation">{</span>\n                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">\'outer;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">continue</span> <span class="token lifetime-annotation symbol">\'outer;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert!</span><span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO 练习到这里</p>\n<h1 id="模式匹配"><a href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式匹配</h1>\n<h2 id="match-和-if-let"><a href="#match-%E5%92%8C-if-let" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>match 和 if let</h2>\n<h3 id="问题一-14"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71226927481973280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Direction {\n    East,\n    West,\n    North,\n    South,\n}\n\nfn main() {\n    let dire = Direction::South;\n    match dire {\n        Direction::East => println!(&quot;East&quot;),\n        __  => { // 在这里匹配 South 或 North\n            println!(&quot;South or North&quot;);\n        },\n        _ => println!(__),\n    };\n}`, `71226927481973280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Direction <span class="token punctuation">{</span>\n    East<span class="token punctuation">,</span>\n    West<span class="token punctuation">,</span>\n    North<span class="token punctuation">,</span>\n    South<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> dire <span class="token operator">=</span> Direction<span class="token punctuation">::</span>South<span class="token punctuation">;</span>\n    <span class="token keyword">match</span> dire <span class="token punctuation">{</span>\n        Direction<span class="token punctuation">::</span>East <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        __  <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// 在这里匹配 South 或 North</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"South or North"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-108"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-108" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20596881031073956000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Direction {\n    East,\n    West,\n    North,\n    South,\n}\n\nfn main() {\n    let dire = Direction::South;\n    match dire {\n        Direction::East => println!(&quot;East&quot;),\n        Direction::South | Direction::North => {\n            // 在这里匹配 South 或 North\n            println!(&quot;South or North&quot;);\n        }\n        _ => println!(&quot;West&quot;),\n    };\n}`, `20596881031073956000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Direction <span class="token punctuation">{</span>\n    East<span class="token punctuation">,</span>\n    West<span class="token punctuation">,</span>\n    North<span class="token punctuation">,</span>\n    South<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> dire <span class="token operator">=</span> Direction<span class="token punctuation">::</span>South<span class="token punctuation">;</span>\n    <span class="token keyword">match</span> dire <span class="token punctuation">{</span>\n        Direction<span class="token punctuation">::</span>East <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"East"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Direction<span class="token punctuation">::</span>South <span class="token operator">|</span> Direction<span class="token punctuation">::</span>North <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token comment">// 在这里匹配 South 或 North</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"South or North"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        _ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"West"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-14"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>match 是一个表达式，因此可以用在赋值语句中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87847287991400780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let boolean = true;\n\n    // 使用 match 表达式填空，并满足以下条件\n    //\n    // boolean = true => binary = 1\n    // boolean = false => binary = 0\n    let binary = __;\n\n    assert_eq!(binary, 1);\n}`, `87847287991400780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> boolean <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 match 表达式填空，并满足以下条件</span>\n    <span class="token comment">//</span>\n    <span class="token comment">// boolean = true => binary = 1</span>\n    <span class="token comment">// boolean = false => binary = 0</span>\n    <span class="token keyword">let</span> binary <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-109"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-109" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63256716819353670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let boolean = true;\n\n    // 使用 match 表达式填空，并满足以下条件\n    //\n    // boolean = true => binary = 1\n    // boolean = false => binary = 0\n    let binary = match boolean {\n        true => 1,\n        false => 0,\n    };\n\n    assert_eq!(binary, 1);\n}`, `63256716819353670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> boolean <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 match 表达式填空，并满足以下条件</span>\n    <span class="token comment">//</span>\n    <span class="token comment">// boolean = true => binary = 1</span>\n    <span class="token comment">// boolean = false => binary = 0</span>\n    <span class="token keyword">let</span> binary <span class="token operator">=</span> <span class="token keyword">match</span> boolean <span class="token punctuation">{</span>\n        <span class="token keyword">true</span> <span class="token operator">=></span> <span class="token number">1</span><span class="token punctuation">,</span>\n        <span class="token keyword">false</span> <span class="token operator">=></span> <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>binary<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-14"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>使用 match 匹配出枚举成员持有的值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54337166973960405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msgs = [\n        Message::Quit,\n        Message::Move{x:1, y:3},\n        Message::ChangeColor(255,255,0)\n    ];\n\n    for msg in msgs {\n        show_message(msg)\n    }\n}\n\nfn show_message(msg: Message) {\n    match msg {\n        __ => { // 这里匹配 Message::Move\n            assert_eq!(a, 1);\n            assert_eq!(b, 3);\n        },\n        Message::ChangeColor(_, g, b) => {\n            assert_eq!(g, __);\n            assert_eq!(b, __);\n        }\n        __ => println!(&quot;no data in these variants&quot;)\n    }\n}`, `54337166973960405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msgs <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Message<span class="token punctuation">::</span>Quit<span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Move<span class="token punctuation">{</span>x<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> msg <span class="token keyword">in</span> msgs <span class="token punctuation">{</span>\n        <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>\n        __ <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token comment">// 这里匹配 Message::Move</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        __ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"no data in these variants"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-110"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-110" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86733614803495500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Message {\n    Quit,\n    Move { x: i32, y: i32 },\n    Write(String),\n    ChangeColor(i32, i32, i32),\n}\n\nfn main() {\n    let msgs = [\n        Message::Quit,\n        Message::Move { x: 1, y: 3 },\n        Message::ChangeColor(255, 255, 0),\n    ];\n\n    for msg in msgs {\n        show_message(msg)\n    }\n}\n\nfn show_message(msg: Message) {\n    match msg {\n        Message::Move { x: a, y: b } => {\n            // 这里匹配 Message::Move\n            assert_eq!(a, 1);\n            assert_eq!(b, 3);\n        }\n        Message::ChangeColor(_, g, b) => {\n            assert_eq!(g, 255);\n            assert_eq!(b, 0);\n        }\n        __ => println!(&quot;no data in these variants&quot;),\n    }\n}`, `86733614803495500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Quit<span class="token punctuation">,</span>\n    Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function">Write</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">ChangeColor</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msgs <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Message<span class="token punctuation">::</span>Quit<span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> msg <span class="token keyword">in</span> msgs <span class="token punctuation">{</span>\n        <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">show_message</span><span class="token punctuation">(</span>msg<span class="token punctuation">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>\n        Message<span class="token punctuation">::</span>Move <span class="token punctuation">{</span> x<span class="token punctuation">:</span> a<span class="token punctuation">,</span> y<span class="token punctuation">:</span> b <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token comment">// 这里匹配 Message::Move</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        Message<span class="token punctuation">::</span><span class="token function">ChangeColor</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        __ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"no data in these variants"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-13"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>matches! 看起来像 match, 但是它可以做一些特别的事情</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97415424362652910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let alphabets = [\'a\', \'E\', \'Z\', \'0\', \'x\', \'9\' , \'Y\'];\n\n    // 使用 \\`matches\\` 填空\n    for ab in alphabets {\n        assert!(__)\n    }\n}`, `97415424362652910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> alphabets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'E\'</span><span class="token punctuation">,</span> <span class="token char string">\'Z\'</span><span class="token punctuation">,</span> <span class="token char string">\'0\'</span><span class="token punctuation">,</span> <span class="token char string">\'x\'</span><span class="token punctuation">,</span> <span class="token char string">\'9\'</span> <span class="token punctuation">,</span> <span class="token char string">\'Y\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 `matches` 填空</span>\n    <span class="token keyword">for</span> ab <span class="token keyword">in</span> alphabets <span class="token punctuation">{</span>\n        <span class="token function">assert!</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-111"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-111" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15965528022787457000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let alphabets = [\'a\', \'E\', \'Z\', \'0\', \'x\', \'9\', \'Y\'];\n\n    // 使用 \\`matches\\` 填空\n    for ab in alphabets {\n        assert!(matches!(ab, \'a\'..=\'z\' | \'A\'..=\'Z\' | \'0\'..=\'9\'))\n    }\n}`, `15965528022787457000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> alphabets <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char string">\'a\'</span><span class="token punctuation">,</span> <span class="token char string">\'E\'</span><span class="token punctuation">,</span> <span class="token char string">\'Z\'</span><span class="token punctuation">,</span> <span class="token char string">\'0\'</span><span class="token punctuation">,</span> <span class="token char string">\'x\'</span><span class="token punctuation">,</span> <span class="token char string">\'9\'</span><span class="token punctuation">,</span> <span class="token char string">\'Y\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 `matches` 填空</span>\n    <span class="token keyword">for</span> ab <span class="token keyword">in</span> alphabets <span class="token punctuation">{</span>\n        <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">matches!</span><span class="token punctuation">(</span>ab<span class="token punctuation">,</span> <span class="token char string">\'a\'</span><span class="token punctuation">..=</span><span class="token char string">\'z\'</span> <span class="token operator">|</span> <span class="token char string">\'A\'</span><span class="token punctuation">..=</span><span class="token char string">\'Z\'</span> <span class="token operator">|</span> <span class="token char string">\'0\'</span><span class="token punctuation">..=</span><span class="token char string">\'9\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-13"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5698631956500977000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum MyEnum {\n    Foo,\n    Bar\n}\n\nfn main() {\n    let mut count = 0;\n\n    let v = vec![MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];\n    for e in v {\n        if e == MyEnum::Foo { // 修复错误，只能修改本行代码\n            count += 1;\n        }\n    }\n\n    assert_eq!(count, 2);\n}`, `5698631956500977000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> MyEnum <span class="token punctuation">{</span>\n    Foo<span class="token punctuation">,</span>\n    Bar\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Bar<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> e <span class="token keyword">in</span> v <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> e <span class="token operator">==</span> MyEnum<span class="token punctuation">::</span>Foo <span class="token punctuation">{</span> <span class="token comment">// 修复错误，只能修改本行代码</span>\n            count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-112"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-112" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26723436977535450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum MyEnum {\n    Foo,\n    Bar\n}\n\nfn main() {\n    let mut count = 0;\n\n    let v = vec![MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];\n    for e in v {\n        if matches!(e, MyEnum::Foo) { // 修复错误，只能修改本行代码\n            count += 1;\n        }\n    }\n\n    assert_eq!(count, 2);\n}`, `26723436977535450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> MyEnum <span class="token punctuation">{</span>\n    Foo<span class="token punctuation">,</span>\n    Bar\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Bar<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> e <span class="token keyword">in</span> v <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token function">matches!</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 修复错误，只能修改本行代码</span>\n            count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6421146936917910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum MyEnum {\n    Foo,\n    Bar\n}\n\nfn main() {\n    let mut count = 0;\n\n    let v = vec![MyEnum::Foo,MyEnum::Bar,MyEnum::Foo];\n    for e in v {\n        if let MyEnum::Foo = e { // 修复错误，只能修改本行代码\n            count += 1;\n        }\n    }\n\n    assert_eq!(count, 2);\n}`, `6421146936917910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> MyEnum <span class="token punctuation">{</span>\n    Foo<span class="token punctuation">,</span>\n    Bar\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Bar<span class="token punctuation">,</span>MyEnum<span class="token punctuation">::</span>Foo<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> e <span class="token keyword">in</span> v <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token keyword">let</span> MyEnum<span class="token punctuation">::</span>Foo <span class="token operator">=</span> e <span class="token punctuation">{</span> <span class="token comment">// 修复错误，只能修改本行代码</span>\n            count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-12"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>在有些时候, 使用 match 匹配枚举有些太重了，此时 if let 就非常适合</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18688422204403786000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let o = Some(7);\n\n    // 移除整个 \\`match\\` 语句块，使用 \\`if let\\` 替代\n    match o {\n        Some(i) => {\n            println!(&quot;This is a really long string and \\`{:?}\\`&quot;, i);\n        }\n        _ => {}\n    };\n}`, `18688422204403786000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 移除整个 `match` 语句块，使用 `if let` 替代</span>\n    <span class="token keyword">match</span> o <span class="token punctuation">{</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"This is a really long string and `{:?}`"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-113"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-113" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9354603777944125000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let o = Some(7);\n\n    if let Some(i) = o {\n        println!(&quot;This is a really long string and \\`{:?}\\`&quot;, i);\n    }\n}`, `9354603777944125000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> o <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"This is a really long string and `{:?}`"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-7"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63691262655729110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Foo {\n    Bar(u8)\n}\n\nfn main() {\n    let a = Foo::Bar(1);\n\n    __ {\n        println!(&quot;foobar 持有的值是: {}&quot;, i);\n    }\n}`, `63691262655729110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Foo <span class="token punctuation">{</span>\n    <span class="token function">Bar</span><span class="token punctuation">(</span>u8<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> Foo<span class="token punctuation">::</span><span class="token function">Bar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    __ <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"foobar 持有的值是: {}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-114"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-114" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99039775575230320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nenum Foo {\n    Bar(u8),\n}\n\nfn main() {\n    let a = Foo::Bar(1);\n\n    if let Foo::Bar(i) = a {\n        println!(&quot;foobar 持有的值是: {}&quot;, i);\n    }\n}`, `99039775575230320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">enum</span> Foo <span class="token punctuation">{</span>\n    <span class="token function">Bar</span><span class="token punctuation">(</span>u8<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> Foo<span class="token punctuation">::</span><span class="token function">Bar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token keyword">let</span> Foo<span class="token punctuation">::</span><span class="token function">Bar</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span> a <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"foobar 持有的值是: {}"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-7"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="740460590513292200"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Foo {\n    Bar,\n    Baz,\n    Qux(u32)\n}\n\nfn main() {\n    let a = Foo::Qux(10);\n\n    // 移除以下代码，使用 \\`match\\` 代替\n    if let Foo::Bar = a {\n        println!(&quot;match foo::bar&quot;)\n    } else if let Foo::Baz = a {\n        println!(&quot;match foo::baz&quot;)\n    } else {\n        println!(&quot;match others&quot;)\n    }\n}`, `740460590513292200`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Foo <span class="token punctuation">{</span>\n    Bar<span class="token punctuation">,</span>\n    Baz<span class="token punctuation">,</span>\n    <span class="token function">Qux</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> Foo<span class="token punctuation">::</span><span class="token function">Qux</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 移除以下代码，使用 `match` 代替</span>\n    <span class="token keyword">if</span> <span class="token keyword">let</span> Foo<span class="token punctuation">::</span>Bar <span class="token operator">=</span> a <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match foo::bar"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> Foo<span class="token punctuation">::</span>Baz <span class="token operator">=</span> a <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match foo::baz"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match others"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-115"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-115" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56927601184865980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum Foo {\n    Bar,\n    Baz,\n    Qux(u32),\n}\n\nfn main() {\n    let a = Foo::Qux(10);\n\n    match a {\n        Foo::Bar => println!(&quot;match foo::bar&quot;),\n        Foo::Baz => println!(&quot;match foo::baz&quot;),\n        _ => println!(&quot;match others&quot;),\n    }\n}`, `56927601184865980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">enum</span> Foo <span class="token punctuation">{</span>\n    Bar<span class="token punctuation">,</span>\n    Baz<span class="token punctuation">,</span>\n    <span class="token function">Qux</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> Foo<span class="token punctuation">::</span><span class="token function">Qux</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> a <span class="token punctuation">{</span>\n        Foo<span class="token punctuation">::</span>Bar <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match foo::bar"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Foo<span class="token punctuation">::</span>Baz <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match foo::baz"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match others"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-7"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72812432839455800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 就地修复错误\nfn main() {\n    let age = Some(30);\n    if let Some(age) = age { // 创建一个新的变量，该变量与之前的 \\`age\\` 变量同名\n       assert_eq!(age, Some(30));\n    } // 新的 \\`age\\` 变量在这里超出作用域\n\n    match age {\n        // \\`match\\` 也能实现变量遮蔽\n        Some(age) =>  println!(&quot;age 是一个新的变量，它的值是 {}&quot;,age),\n        _ => ()\n    }\n }`, `72812432839455800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 就地修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=</span> age <span class="token punctuation">{</span> <span class="token comment">// 创建一个新的变量，该变量与之前的 `age` 变量同名</span>\n       <span class="token function">assert_eq!</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token comment">// 新的 `age` 变量在这里超出作用域</span>\n\n    <span class="token keyword">match</span> age <span class="token punctuation">{</span>\n        <span class="token comment">// `match` 也能实现变量遮蔽</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"age 是一个新的变量，它的值是 {}"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-116"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-116" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93334623723876100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 就地修复错误\nfn main() {\n    let age = Some(30);\n    if let Some(age) = age { // 创建一个新的变量，该变量与之前的 \\`age\\` 变量同名\n        assert_eq!(age, 30);\n    } // 新的 \\`age\\` 变量在这里超出作用域\n\n    match age {\n        // \\`match\\` 也能实现变量遮蔽\n        Some(age) => println!(&quot;age 是一个新的变量，它的值是 {}&quot;, age),\n        _ => (),\n    }\n}`, `93334623723876100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 就地修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=</span> age <span class="token punctuation">{</span> <span class="token comment">// 创建一个新的变量，该变量与之前的 `age` 变量同名</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token comment">// 新的 `age` 变量在这里超出作用域</span>\n\n    <span class="token keyword">match</span> age <span class="token punctuation">{</span>\n        <span class="token comment">// `match` 也能实现变量遮蔽</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"age 是一个新的变量，它的值是 {}"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模式"><a href="#%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式</h2>\n<h3 id="问题一-15"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>使用 | 可以匹配多个值, 而使用 ..= 可以匹配一个闭区间的数值序列</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58057485435575450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {}\nfn match_number(n: i32) {\n    match n {\n        // 匹配一个单独的值\n        1 => println!(&quot;One!&quot;),\n        // 使用 \\`|\\` 填空，不要使用 \\`..\\` 或 \\`..=\\`\n        __ => println!(&quot;match 2 -> 5&quot;),\n        // 匹配一个闭区间的数值序列\n        6..=10 => {\n            println!(&quot;match 6 -> 10&quot;)\n        },\n        _ => {\n            println!(&quot;match 11 -> +infinite&quot;)\n        }\n    }\n}`, `58057485435575450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">match_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> n <span class="token punctuation">{</span>\n        <span class="token comment">// 匹配一个单独的值</span>\n        <span class="token number">1</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 使用 `|` 填空，不要使用 `..` 或 `..=`</span>\n        __ <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 2 -> 5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 匹配一个闭区间的数值序列</span>\n        <span class="token number">6</span><span class="token punctuation">..=</span><span class="token number">10</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 6 -> 10"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 11 -> +infinite"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-117"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-117" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77447519805136000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {}\nfn match_number(n: i32) {\n    match n {\n        // 匹配一个单独的值\n        1 => println!(&quot;One!&quot;),\n        // 使用 \\`|\\` 填空，不要使用 \\`..\\` 或 \\`..=\\`\n        2 | 3 | 4 | 5 => println!(&quot;match 2 -> 5&quot;),\n        // 匹配一个闭区间的数值序列\n        6..=10 => {\n            println!(&quot;match 6 -> 10&quot;)\n        }\n        _ => {\n            println!(&quot;match 11 -> +infinite&quot;)\n        }\n    }\n}`, `77447519805136000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">match_number</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> n <span class="token punctuation">{</span>\n        <span class="token comment">// 匹配一个单独的值</span>\n        <span class="token number">1</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 使用 `|` 填空，不要使用 `..` 或 `..=`</span>\n        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">5</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 2 -> 5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 匹配一个闭区间的数值序列</span>\n        <span class="token number">6</span><span class="token punctuation">..=</span><span class="token number">10</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 6 -> 10"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        _ <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"match 11 -> +infinite"</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-15"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>@ 操作符可以让我们将一个与模式相匹配的值绑定到新的变量上</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70221050799157305000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Point {\n    x: i32,\n    y: i32,\n}\n\nfn main() {\n    // 填空，让 p 匹配第二个分支\n    let p = Point { x: __, y: __ };\n\n    match p {\n        Point { x, y: 0 } => println!(&quot;On the x axis at {}&quot;, x),\n        // 第二个分支\n        Point { x: 0..=5, y: y@ (10 | 20 | 30) } => println!(&quot;On the y axis at {}&quot;, y),\n        Point { x, y } => println!(&quot;On neither axis: ({}, {})&quot;, x, y),\n    }\n}`, `70221050799157305000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Point <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空，让 p 匹配第二个分支</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> __<span class="token punctuation">,</span> y<span class="token punctuation">:</span> __ <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> p <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On the x axis at {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 第二个分支</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> y<span class="token operator">@</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">|</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On the y axis at {}"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On neither axis: ({}, {})"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-118"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-118" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88323021347625840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Point {\n    x: i32,\n    y: i32,\n}\n\nfn main() {\n    // 填空，让 p 匹配第二个分支\n    let p = Point { x: 0, y: 10 };\n\n    match p {\n        Point { x, y: 0 } => println!(&quot;On the x axis at {}&quot;, x),\n        // 第二个分支\n        Point { x: 0..=5, y: y@ (10 | 20 | 30) } => println!(&quot;On the y axis at {}&quot;, y),\n        Point { x, y } => println!(&quot;On neither axis: ({}, {})&quot;, x, y),\n    }\n}`, `88323021347625840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Point <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空，让 p 匹配第二个分支</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> p <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On the x axis at {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 第二个分支</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">..=</span><span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> y<span class="token operator">@</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">|</span> <span class="token number">20</span> <span class="token operator">|</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On the y axis at {}"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"On neither axis: ({}, {})"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-15"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46279072437308270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nenum Message {\n    Hello { id: i32 },\n}\n\nfn main() {\n    let msg = Message::Hello { id: 5 };\n\n    match msg {\n        Message::Hello {\n            id:  3..=7,\n        } => println!(&quot;id 值的范围在 [3, 7] 之间: {}&quot;, id),\n        Message::Hello { id: newid@10 | 11 | 12 } => {\n            println!(&quot;id 值的范围在 [10, 12] 之间: {}&quot;, newid)\n        }\n        Message::Hello { id } => println!(&quot;Found some other id: {}&quot;, id),\n    }\n}`, `46279072437308270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span>\n            id<span class="token punctuation">:</span>  <span class="token number">3</span><span class="token punctuation">..=</span><span class="token number">7</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"id 值的范围在 [3, 7] 之间: {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> newid<span class="token operator">@</span><span class="token number">10</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> <span class="token number">12</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"id 值的范围在 [10, 12] 之间: {}"</span><span class="token punctuation">,</span> newid<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Found some other id: {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-119"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-119" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52293611206935716000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nenum Message {\n    Hello { id: i32 },\n}\n\nfn main() {\n    let msg = Message::Hello { id: 5 };\n\n    match msg {\n        Message::Hello { id: id @ 3..=7 } => println!(&quot;id 值的范围在 [3, 7] 之间: {}&quot;, id),\n        Message::Hello {\n            id: newid @ (10 | 11 | 12),\n        } => {\n            println!(&quot;id 值的范围在 [10, 12] 之间: {}&quot;, newid)\n        }\n        Message::Hello { id } => println!(&quot;Found some other id: {}&quot;, id),\n    }\n}`, `52293611206935716000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">enum</span> Message <span class="token punctuation">{</span>\n    Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> i32 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> msg <span class="token operator">=</span> Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> msg <span class="token punctuation">{</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id<span class="token punctuation">:</span> id <span class="token operator">@</span> <span class="token number">3</span><span class="token punctuation">..=</span><span class="token number">7</span> <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"id 值的范围在 [3, 7] 之间: {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span>\n            id<span class="token punctuation">:</span> newid <span class="token operator">@</span> <span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"id 值的范围在 [10, 12] 之间: {}"</span><span class="token punctuation">,</span> newid<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        Message<span class="token punctuation">::</span>Hello <span class="token punctuation">{</span> id <span class="token punctuation">}</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Found some other id: {}"</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-14"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>匹配守卫（match guard）是一个位于 match 分支模式之后的额外 if 条件，它能为分支模式提供更进一步的匹配条件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55693572503436026000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空让代码工作，必须使用 \\`split\\`\nfn main() {\n    let num = Some(4);\n    let split = 5;\n    match num {\n        Some(x) __ => assert!(x < split),\n        Some(x) => assert!(x >= split),\n        None => (),\n    }\n}`, `55693572503436026000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空让代码工作，必须使用 `split`</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> split <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">match</span> num <span class="token punctuation">{</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> __ <span class="token operator">=></span> <span class="token function">assert!</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> split<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">assert!</span><span class="token punctuation">(</span>x <span class="token operator">>=</span> split<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        None <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-120"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-120" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15318359194481789000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空让代码工作，必须使用 \\`split\\`\nfn main() {\n    let num = Some(4);\n    let split = 5;\n    match num {\n        Some(x) if (x < split) => assert!(x < split),\n        Some(x) => assert!(x >= split),\n        None => (),\n    }\n}`, `15318359194481789000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空让代码工作，必须使用 `split`</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> split <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token keyword">match</span> num <span class="token punctuation">{</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> split<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">assert!</span><span class="token punctuation">(</span>x <span class="token operator">&lt;</span> split<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">assert!</span><span class="token punctuation">(</span>x <span class="token operator">>=</span> split<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        None <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-14"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>使用 .. 忽略一部分值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60012531276709890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nfn main() {\n    let numbers = (2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048);\n\n    match numbers {\n        __ => {\n           assert_eq!(first, 2);\n           assert_eq!(last, 2048);\n        }\n    }\n}`, `60012531276709890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> numbers <span class="token punctuation">{</span>\n        __ <span class="token operator">=></span> <span class="token punctuation">{</span>\n           <span class="token function">assert_eq!</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n           <span class="token function">assert_eq!</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-121"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-121" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82293184271684370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空，让代码工作\nfn main() {\n    let numbers = (2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048);\n\n    match numbers {\n        (first, .., last) => {\n            assert_eq!(first, 2);\n            assert_eq!(last, 2048);\n        }\n    }\n}`, `82293184271684370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> numbers <span class="token punctuation">{</span>\n        <span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">,</span> last<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-13"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>使用模式 &#x26;mut V 去匹配一个可变引用时，你需要格外小心，因为匹配出来的 V 是一个值，而不是可变引用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53698758013326640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，尽量少地修改代码\n// 不要移除任何代码行\nfn main() {\n    let mut v = String::from(&quot;hello,&quot;);\n    let r = &mut v;\n\n    match r {\n       &mut value => value.push_str(&quot; world!&quot;)\n    }\n}`, `53698758013326640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，尽量少地修改代码</span>\n<span class="token comment">// 不要移除任何代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> r <span class="token punctuation">{</span>\n       <span class="token operator">&amp;</span><span class="token keyword">mut</span> value <span class="token operator">=></span> value<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" world!"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-122"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-122" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26502078969561895000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，尽量少地修改代码\n// 不要移除任何代码行\nfn main() {\n    let mut v = String::from(&quot;hello,&quot;);\n    let r = &mut v;\n\n    match r {\n        value => value.push_str(&quot; world!&quot;),\n    }\n}`, `26502078969561895000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，尽量少地修改代码</span>\n<span class="token comment">// 不要移除任何代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello,"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">;</span>\n\n    <span class="token keyword">match</span> r <span class="token punctuation">{</span>\n        value <span class="token operator">=></span> value<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">" world!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="方法"><a href="#%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法</h1>\n<h2 id="问题一-16"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h2>\n<p>方法跟函数类似：都是使用 fn 声明，有参数和返回值。但是与函数不同的是，方法定义在结构体的上下文中(枚举、特征对象也可以定义方法)，而且方法的第一个参数一定是 self 或其变体 &#x26;self、&#x26;mut self，self 代表了当前调用的结构体实例。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62893421669167510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nimpl Rectangle {\n    // 完成 area 方法，返回矩形 Rectangle 的面积\n    fn area\n}\n\nfn main() {\n    let rect1 = Rectangle { width: 30, height: 50 };\n\n    assert_eq!(rect1.area(), 1500);\n}`, `62893421669167510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>\n    <span class="token comment">// 完成 area 方法，返回矩形 Rectangle 的面积</span>\n    <span class="token keyword">fn</span> area\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>rect1<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-123"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-123" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60938450724397340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Rectangle {\n    width: u32,\n    height: u32,\n}\n\nimpl Rectangle {\n    // 完成 area 方法，返回矩形 Rectangle 的面积\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n}\n\nfn main() {\n    let rect1 = Rectangle {\n        width: 30,\n        height: 50,\n    };\n\n    assert_eq!(rect1.area(), 1500);\n}`, `60938450724397340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>\n    <span class="token comment">// 完成 area 方法，返回矩形 Rectangle 的面积</span>\n    <span class="token keyword">fn</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> rect1 <span class="token operator">=</span> Rectangle <span class="token punctuation">{</span>\n        width<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>\n        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>rect1<span class="token punctuation">.</span><span class="token function">area</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题二-16"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h2>\n<p>self 会拿走当前结构体实例(调用对象)的所有权，而 &#x26;self 却只会借用一个不可变引用，&#x26;mut self 会借用一个可变引用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81459026574992750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只填空，不要删除任何代码行!\n#[derive(Debug)]\nstruct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    pub fn show_state(__)  {\n        println!(&quot;the current state is {}&quot;, __.color);\n    }\n}\nfn main() {\n    let light = TrafficLight{\n        color: &quot;red&quot;.to_owned(),\n    };\n    // 不要拿走 \\`light\\` 的所有权\n    light.show_state();\n    // 否则下面代码会报错\n    println!(&quot;{:?}&quot;, light);\n}`, `81459026574992750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 只填空，不要删除任何代码行!</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">show_state</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the current state is {}"</span><span class="token punctuation">,</span> __<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> light <span class="token operator">=</span> TrafficLight<span class="token punctuation">{</span>\n        color<span class="token punctuation">:</span> <span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token comment">// 不要拿走 `light` 的所有权</span>\n    light<span class="token punctuation">.</span><span class="token function">show_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 否则下面代码会报错</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> light<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-124"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-124" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78182180632062300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只填空，不要删除任何代码行!\n#[derive(Debug)]\nstruct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    pub fn show_state(&self) {\n        println!(&quot;the current state is {}&quot;, self.color);\n    }\n}\nfn main() {\n    let light = TrafficLight {\n        color: &quot;red&quot;.to_owned(),\n    };\n    // 不要拿走 \\`light\\` 的所有权\n    light.show_state();\n    // 否则下面代码会报错\n    println!(&quot;{:?}&quot;, light);\n}`, `78182180632062300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 只填空，不要删除任何代码行!</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">show_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the current state is {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> light <span class="token operator">=</span> TrafficLight <span class="token punctuation">{</span>\n        color<span class="token punctuation">:</span> <span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token comment">// 不要拿走 `light` 的所有权</span>\n    light<span class="token punctuation">.</span><span class="token function">show_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 否则下面代码会报错</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> light<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题三-16"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h2>\n<p>&#x26;self 实际上是 self: &#x26;Self 的缩写或者说语法糖</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21486225750128330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    // 使用 \\`Self\\` 填空\n    pub fn show_state(__)  {\n        println!(&quot;the current state is {}&quot;, self.color);\n    }\n\n    // 填空，不要使用 \\`Self\\` 或其变体\n    pub fn change_state(__) {\n        self.color = &quot;green&quot;.to_string()\n    }\n}\nfn main() {}`, `21486225750128330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token comment">// 使用 `Self` 填空</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">show_state</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the current state is {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 填空，不要使用 `Self` 或其变体</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">change_state</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">"green"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-125"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-125" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3019467968873468400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    // 使用 \\`Self\\` 填空\n    pub fn show_state(self: &Self) {\n        println!(&quot;the current state is {}&quot;, self.color);\n    }\n\n    // 填空，不要使用 \\`Self\\` 或其变体\n    pub fn change_state(&mut self) {\n        self.color = &quot;green&quot;.to_string()\n    }\n}\nfn main() {}`, `3019467968873468400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token comment">// 使用 `Self` 填空</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">show_state</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"the current state is {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 填空，不要使用 `Self` 或其变体</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">change_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">"green"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题四-15"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h2>\n<p>定义在 impl 语句块中的函数被称为关联函数，因为它们跟当前类型关联在一起。关联函数与方法最大的区别就是它第一个参数不是 self，原因是它们不需要使用当前的实例，因此关联函数往往可以用于构造函数：初始化一个实例对象</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49781622631584700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    // 1. 实现下面的关联函数 \\`new\\`,\n    // 2. 该函数返回一个 TrafficLight 实例，包含 \\`color\\` &quot;red&quot;\n    // 3. 该函数必须使用 \\`Self\\` 作为类型，不能在签名或者函数体中使用 \\`TrafficLight\\`\n    pub fn new()\n\n    pub fn get_state(&self) -> &str {\n        &self.color\n    }\n}\n\nfn main() {\n    let light = TrafficLight::new();\n    assert_eq!(light.get_state(), &quot;red&quot;);\n}`, `49781622631584700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token comment">// 1. 实现下面的关联函数 `new`,</span>\n    <span class="token comment">// 2. 该函数返回一个 TrafficLight 实例，包含 `color` "red"</span>\n    <span class="token comment">// 3. 该函数必须使用 `Self` 作为类型，不能在签名或者函数体中使用 `TrafficLight`</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">get_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>color\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> light <span class="token operator">=</span> TrafficLight<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span><span class="token function">get_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-126"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-126" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86172385506846900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct TrafficLight {\n    color: String,\n}\n\nimpl TrafficLight {\n    // 1. 实现下面的关联函数 \\`new\\`,\n    // 2. 该函数返回一个 TrafficLight 实例，包含 \\`color\\` &quot;red&quot;\n    // 3. 该函数必须使用 \\`Self\\` 作为类型，不能在签名或者函数体中使用 \\`TrafficLight\\`\n    pub fn new() -> Self {\n        TrafficLight {\n            color: &quot;red&quot;.to_string(),\n        }\n    }\n\n    pub fn get_state(&self) -> &str {\n        &self.color\n    }\n}\n\nfn main() {\n    let light = TrafficLight::new();\n    assert_eq!(light.get_state(), &quot;red&quot;);\n}`, `86172385506846900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> TrafficLight <span class="token punctuation">{</span>\n    color<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> TrafficLight <span class="token punctuation">{</span>\n    <span class="token comment">// 1. 实现下面的关联函数 `new`,</span>\n    <span class="token comment">// 2. 该函数返回一个 TrafficLight 实例，包含 `color` "red"</span>\n    <span class="token comment">// 3. 该函数必须使用 `Self` 作为类型，不能在签名或者函数体中使用 `TrafficLight`</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>\n        TrafficLight <span class="token punctuation">{</span>\n            color<span class="token punctuation">:</span> <span class="token string">"red"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">get_state</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>color\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> light <span class="token operator">=</span> TrafficLight<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>light<span class="token punctuation">.</span><span class="token function">get_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"red"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题五-15"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h2>\n<p>每一个结构体允许拥有多个 impl 语句块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65625009634553760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Rectangle {\n    width: u32,\n    height: u32,\n}\n\n// 使用多个 \\`impl\\` 语句块重写下面的代码\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n\n    fn can_hold(&self, other: &Rectangle) -> bool {\n        self.width > other.width && self.height > other.height\n    }\n}\n\nfn main() {}`, `65625009634553760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用多个 `impl` 语句块重写下面的代码</span>\n<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Rectangle<span class="token punctuation">)</span> <span class="token punctuation">-></span> bool <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">></span> other<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">></span> other<span class="token punctuation">.</span>height\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-127"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-127" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80656111094494530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Rectangle {\n    width: u32,\n    height: u32,\n}\n\n// 使用多个 \\`impl\\` 语句块重写下面的代码\nimpl Rectangle {\n    fn area(&self) -> u32 {\n        self.width * self.height\n    }\n}\n\n// 使用多个 \\`impl\\` 语句块重写下面的代码\nimpl Rectangle {\n    fn can_hold(&self, other: &Rectangle) -> bool {\n        self.width > other.width && self.height > other.height\n    }\n}\n\nfn main() {}`, `80656111094494530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Rectangle <span class="token punctuation">{</span>\n    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用多个 `impl` 语句块重写下面的代码</span>\n<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">area</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用多个 `impl` 语句块重写下面的代码</span>\n<span class="token keyword">impl</span> Rectangle <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">can_hold</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Rectangle<span class="token punctuation">)</span> <span class="token punctuation">-></span> bool <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">></span> other<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height <span class="token operator">></span> other<span class="token punctuation">.</span>height\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题六-14"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h2>\n<p>我们还可以为枚举类型定义方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4686154277356924000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nenum TrafficLightColor {\n    Red,\n    Yellow,\n    Green,\n}\n\n// 为 TrafficLightColor 实现所需的方法\nimpl TrafficLightColor {\n\n}\n\nfn main() {\n    let c = TrafficLightColor::Yellow;\n\n    assert_eq!(c.color(), &quot;yellow&quot;);\n\n    println!(&quot;{:?}&quot;,c);\n}`, `4686154277356924000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> TrafficLightColor <span class="token punctuation">{</span>\n    Red<span class="token punctuation">,</span>\n    Yellow<span class="token punctuation">,</span>\n    Green<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 为 TrafficLightColor 实现所需的方法</span>\n<span class="token keyword">impl</span> TrafficLightColor <span class="token punctuation">{</span>\n\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c <span class="token operator">=</span> TrafficLightColor<span class="token punctuation">::</span>Yellow<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-128"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-128" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75745350403692460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nenum TrafficLightColor {\n    Red,\n    Yellow,\n    Green,\n}\n\n// 为 TrafficLightColor 实现所需的方法\nimpl TrafficLightColor {\n    fn color(&self) -> &str {\n        match self {\n            TrafficLightColor::Yellow => &quot;yellow&quot;,\n            _ => &quot;None&quot;,\n        }\n    }\n}\n\nfn main() {\n    let c = TrafficLightColor::Yellow;\n\n    assert_eq!(c.color(), &quot;yellow&quot;);\n\n    println!(&quot;{:?}&quot;, c);\n}`, `75745350403692460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> TrafficLightColor <span class="token punctuation">{</span>\n    Red<span class="token punctuation">,</span>\n    Yellow<span class="token punctuation">,</span>\n    Green<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 为 TrafficLightColor 实现所需的方法</span>\n<span class="token keyword">impl</span> TrafficLightColor <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">color</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n        <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>\n            TrafficLightColor<span class="token punctuation">::</span>Yellow <span class="token operator">=></span> <span class="token string">"yellow"</span><span class="token punctuation">,</span>\n            _ <span class="token operator">=></span> <span class="token string">"None"</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> c <span class="token operator">=</span> TrafficLightColor<span class="token punctuation">::</span>Yellow<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="泛型和特征"><a href="#%E6%B3%9B%E5%9E%8B%E5%92%8C%E7%89%B9%E5%BE%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>泛型和特征</h1>\n<h2 id="泛型"><a href="#%E6%B3%9B%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>泛型</h2>\n<h3 id="问题一-17"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36824909822067300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nstruct A;          // 具体的类型 \\`A\\`.\nstruct S(A);       // 具体的类型 \\`S\\`.\nstruct SGen<T>(T); // 泛型 \\`SGen\\`.\n\nfn reg_fn(_s: S) {}\n\nfn gen_spec_t(_s: SGen<A>) {}\n\nfn gen_spec_i32(_s: SGen<i32>) {}\n\nfn generic<T>(_s: SGen<T>) {}\n\nfn main() {\n    // 使用非泛型函数\n    reg_fn(__);          // 具体的类型\n    gen_spec_t(__);   // 隐式地指定类型参数  \\`A\\`.\n    gen_spec_i32(__); // 隐式地指定类型参数\\`i32\\`.\n\n    // 显式地指定类型参数 \\`char\\`\n    generic::<char>(__);\n\n    // 隐式地指定类型参数 \\`char\\`.\n    generic(__);\n}`, `36824909822067300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">struct</span> A<span class="token punctuation">;</span>          <span class="token comment">// 具体的类型 `A`.</span>\n<span class="token keyword">struct</span> <span class="token function">S</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 具体的类型 `S`.</span>\n<span class="token keyword">struct</span> SGen<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 泛型 `SGen`.</span>\n\n<span class="token keyword">fn</span> <span class="token function">reg_fn</span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> S<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">gen_spec_t</span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> SGen<span class="token operator">&lt;</span>A<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">gen_spec_i32</span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> SGen<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> generic<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> SGen<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用非泛型函数</span>\n    <span class="token function">reg_fn</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 具体的类型</span>\n    <span class="token function">gen_spec_t</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 隐式地指定类型参数  `A`.</span>\n    <span class="token function">gen_spec_i32</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 隐式地指定类型参数`i32`.</span>\n\n    <span class="token comment">// 显式地指定类型参数 `char`</span>\n    generic<span class="token punctuation">::</span><span class="token operator">&lt;</span>char<span class="token operator">></span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 隐式地指定类型参数 `char`.</span>\n    <span class="token function">generic</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-129"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-129" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4211572389097662000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nstruct A;          // 具体的类型 \\`A\\`.\nstruct S(A);       // 具体的类型 \\`S\\`.\nstruct SGen<T>(T); // 泛型 \\`SGen\\`.\n\nfn reg_fn(_s: S) {}\n\nfn gen_spec_t(_s: SGen<A>) {}\n\nfn gen_spec_i32(_s: SGen<i32>) {}\n\nfn generic<T>(_s: SGen<T>) {}\n\nfn main() {\n    // 使用非泛型函数\n    reg_fn(S(A));          // 具体的类型\n    gen_spec_t(SGen(A));   // 隐式地指定类型参数  \\`A\\`.\n    gen_spec_i32(SGen(1)); // 隐式地指定类型参数\\`i32\\`.\n\n    // 显式地指定类型参数 \\`char\\`\n    generic::<char>(SGen(\'1\'));\n\n    // 隐式地指定类型参数 \\`char\\`.\n    generic(SGen(\'1\'));\n}`, `4211572389097662000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">struct</span> A<span class="token punctuation">;</span>          <span class="token comment">// 具体的类型 `A`.</span>\n<span class="token keyword">struct</span> <span class="token function">S</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 具体的类型 `S`.</span>\n<span class="token keyword">struct</span> SGen<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 泛型 `SGen`.</span>\n\n<span class="token keyword">fn</span> <span class="token function">reg_fn</span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> S<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">gen_spec_t</span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> SGen<span class="token operator">&lt;</span>A<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">gen_spec_i32</span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> SGen<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> generic<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>_s<span class="token punctuation">:</span> SGen<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用非泛型函数</span>\n    <span class="token function">reg_fn</span><span class="token punctuation">(</span><span class="token function">S</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 具体的类型</span>\n    <span class="token function">gen_spec_t</span><span class="token punctuation">(</span><span class="token function">SGen</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 隐式地指定类型参数  `A`.</span>\n    <span class="token function">gen_spec_i32</span><span class="token punctuation">(</span><span class="token function">SGen</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 隐式地指定类型参数`i32`.</span>\n\n    <span class="token comment">// 显式地指定类型参数 `char`</span>\n    generic<span class="token punctuation">::</span><span class="token operator">&lt;</span>char<span class="token operator">></span><span class="token punctuation">(</span><span class="token function">SGen</span><span class="token punctuation">(</span><span class="token char string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 隐式地指定类型参数 `char`.</span>\n    <span class="token function">generic</span><span class="token punctuation">(</span><span class="token function">SGen</span><span class="token punctuation">(</span><span class="token char string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-17"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26750651266424060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 实现下面的泛型函数 sum\nfn sum\n\nfn main() {\n    assert_eq!(5, sum(2i8, 3i8));\n    assert_eq!(50, sum(20, 30));\n    assert_eq!(2.46, sum(1.23, 1.23));\n}`, `26750651266424060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 实现下面的泛型函数 sum</span>\n<span class="token keyword">fn</span> sum\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">2i8</span><span class="token punctuation">,</span> <span class="token number">3i8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">2.46</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">,</span> <span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-130"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-130" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59323109543535500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 实现下面的泛型函数 sum\nfn sum<T: std::ops::Add<Output = T>>(a: T, b: T) -> T {\n    a + b\n}\n\nfn main() {\n    assert_eq!(5, sum(2i8, 3i8));\n    assert_eq!(50, sum(20, 30));\n    assert_eq!(2.46, sum(1.23, 1.23));\n}`, `59323109543535500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 实现下面的泛型函数 sum</span>\n<span class="token keyword">fn</span> sum<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>Add<span class="token operator">&lt;</span>Output <span class="token operator">=</span> T<span class="token operator">>></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> T<span class="token punctuation">,</span> b<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> T <span class="token punctuation">{</span>\n    a <span class="token operator">+</span> b\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">2i8</span><span class="token punctuation">,</span> <span class="token number">3i8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">2.46</span><span class="token punctuation">,</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1.23</span><span class="token punctuation">,</span> <span class="token number">1.23</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-17"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70916681184170340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 实现一个结构体 Point 让代码工作\n\nfn main() {\n    let integer = Point { x: 5, y: 10 };\n    let float = Point { x: 1.0, y: 4.0 };\n}`, `70916681184170340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 实现一个结构体 Point 让代码工作</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> integer <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> float <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-131"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-131" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79045363269431800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 实现一个结构体 Point 让代码工作\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\nfn main() {\n    let integer = Point { x: 5, y: 10 };\n    let float = Point { x: 1.0, y: 4.0 };\n}`, `79045363269431800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 实现一个结构体 Point 让代码工作</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> integer <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> float <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-16"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63967317875495570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改以下结构体让代码工作\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\nfn main() {\n    // 不要修改这行代码！\n    let p = Point{x: 5, y : &quot;hello&quot;.to_string()};\n}`, `63967317875495570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改以下结构体让代码工作</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 不要修改这行代码！</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Point<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token punctuation">:</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-132"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-132" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48734830679084440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改以下结构体让代码工作\nstruct Point<T, U> {\n    x: T,\n    y: U,\n}\n\nfn main() {\n    // 不要修改这行代码！\n    let p = Point{x: 5, y : &quot;hello&quot;.to_string()};\n}`, `48734830679084440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改以下结构体让代码工作</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> U<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 不要修改这行代码！</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Point<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y <span class="token punctuation">:</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-16"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67395569792178045000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 为 Val 增加泛型参数，不要修改 \\`main\\` 中的代码\nstruct Val {\n    val: f64,\n}\n\nimpl Val {\n    fn value(&self) -> &f64 {\n        &self.val\n    }\n}\n\nfn main() {\n    let x = Val{ val: 3.0 };\n    let y = Val{ val: &quot;hello&quot;.to_string()};\n    println!(&quot;{}, {}&quot;, x.value(), y.value());\n}`, `67395569792178045000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 为 Val 增加泛型参数，不要修改 `main` 中的代码</span>\n<span class="token keyword">struct</span> Val <span class="token punctuation">{</span>\n    val<span class="token punctuation">:</span> f64<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Val <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>f64 <span class="token punctuation">{</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>val\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> Val<span class="token punctuation">{</span> val<span class="token punctuation">:</span> <span class="token number">3.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> Val<span class="token punctuation">{</span> val<span class="token punctuation">:</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-133"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-133" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2383969933944496600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 为 Val 增加泛型参数，不要修改 \\`main\\` 中的代码\nstruct Val<T> {\n    val: T,\n}\n\nimpl<T> Val<T> {\n    fn value(&self) -> &T {\n        &self.val\n    }\n}\n\nfn main() {\n    let x = Val { val: 3.0 };\n    let y = Val {\n        val: &quot;hello&quot;.to_string(),\n    };\n    println!(&quot;{}, {}&quot;, x.value(), y.value());\n}`, `2383969933944496600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 为 Val 增加泛型参数，不要修改 `main` 中的代码</span>\n<span class="token keyword">struct</span> Val<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    val<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Val<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>T <span class="token punctuation">{</span>\n        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>val\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> Val <span class="token punctuation">{</span> val<span class="token punctuation">:</span> <span class="token number">3.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> Val <span class="token punctuation">{</span>\n        val<span class="token punctuation">:</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}, {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-15"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23070301229918980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Point<T, U> {\n    x: T,\n    y: U,\n}\n\nimpl<T, U> Point<T, U> {\n    // 实现 mixup，不要修改其它代码！\n    fn mixup\n}\n\nfn main() {\n    let p1 = Point { x: 5, y: 10 };\n    let p2 = Point { x: &quot;Hello&quot;, y: \'中\'};\n\n    let p3 = p1.mixup(p2);\n\n    assert_eq!(p3.x, 5);\n    assert_eq!(p3.y, \'中\');\n}`, `23070301229918980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> U<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">></span> Point<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 实现 mixup，不要修改其它代码！</span>\n    <span class="token keyword">fn</span> mixup\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> p1 <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p2 <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token char string">\'中\'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> p3 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">mixup</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token char string">\'中\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-134"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-134" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51489164385975510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Point<T, U> {\n    x: T,\n    y: U,\n}\n\nimpl<T, U> Point<T, U> {\n    // 实现 mixup，不要修改其它代码！\n    fn mixup<V, W>(self, other: Point<V, W>) -> Point<T, W> {\n        Point {\n            x: self.x,\n            y: other.y,\n        }\n    }\n}\n\nfn main() {\n    let p1 = Point { x: 5, y: 10 };\n    let p2 = Point {\n        x: &quot;Hello&quot;,\n        y: \'中\',\n    };\n\n    let p3 = p1.mixup(p2);\n\n    assert_eq!(p3.x, 5);\n    assert_eq!(p3.y, \'中\');\n}`, `51489164385975510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> U<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">></span> Point<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 实现 mixup，不要修改其它代码！</span>\n    <span class="token keyword">fn</span> mixup<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> W<span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> Point<span class="token operator">&lt;</span>V<span class="token punctuation">,</span> W<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Point<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> W<span class="token operator">></span> <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span>\n            x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>\n            y<span class="token punctuation">:</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> p1 <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> p2 <span class="token operator">=</span> Point <span class="token punctuation">{</span>\n        x<span class="token punctuation">:</span> <span class="token string">"Hello"</span><span class="token punctuation">,</span>\n        y<span class="token punctuation">:</span> <span class="token char string">\'中\'</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> p3 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">mixup</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p3<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>p3<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token char string">\'中\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-8"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60486336768500520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，让代码工作\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\nimpl Point<f32> {\n    fn distance_from_origin(&self) -> f32 {\n        (self.x.powi(2) + self.y.powi(2)).sqrt()\n    }\n}\n\nfn main() {\n    let p = Point{x: 5, y: 10};\n    println!(&quot;{}&quot;,p.distance_from_origin())\n}`, `60486336768500520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，让代码工作</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Point<span class="token operator">&lt;</span>f32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> f32 <span class="token punctuation">{</span>\n        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Point<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-135"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-135" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63192526418374790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，让代码工作\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\nimpl Point<f32> {\n    fn distance_from_origin(&self) -> f32 {\n        (self.x.powi(2) + self.y.powi(2)).sqrt()\n    }\n}\n\nfn main() {\n    let p = Point{x: 5.0, y: 10.0};\n    println!(&quot;{}&quot;,p.distance_from_origin())\n}`, `63192526418374790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，让代码工作</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Point<span class="token operator">&lt;</span>f32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> f32 <span class="token punctuation">{</span>\n        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> p <span class="token operator">=</span> Point<span class="token punctuation">{</span>x<span class="token punctuation">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>p<span class="token punctuation">.</span><span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="const-泛型"><a href="#const-%E6%B3%9B%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Const 泛型</h2>\n<h3 id="问题一-18"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>下面的例子同时使用泛型和 const 泛型来实现一个结构体，该结构体的字段中的数组长度是可变的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39338140168222390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct ArrayPair<T, const N: usize> {\n    left: [T; N],\n    right: [T; N],\n}\n\nimpl<T: Debug, const N: usize> Debug for ArrayPair<T, N> {\n    // ...\n}`, `39338140168222390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> ArrayPair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> N<span class="token punctuation">:</span> usize<span class="token operator">></span> <span class="token punctuation">{</span>\n    left<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">;</span> N<span class="token punctuation">]</span><span class="token punctuation">,</span>\n    right<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">;</span> N<span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Debug<span class="token punctuation">,</span> <span class="token keyword">const</span> N<span class="token punctuation">:</span> usize<span class="token operator">></span> Debug <span class="token keyword">for</span> ArrayPair<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> N<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-18"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>目前，const 泛型参数只能使用以下形式的实参:</p>\n<ul>\n<li>一个单独的 const 泛型参数</li>\n<li>一个字面量（i.e. 整数, 布尔值或字符）</li>\n<li>一个具体的 const 表达式（表达式中不能包含任何泛型参数）</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6077394152269889000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn foo<const N: usize>() {}\n\nfn bar<T, const M: usize>() {\n    foo::<M>(); // ok: 符合第一种\n    foo::<2021>(); // ok: 符合第二种\n    foo::<{20 * 100 + 20 * 10 + 1}>(); // ok: 符合第三种\n\n    foo::<{ M + 1 }>(); // error: 违背第三种，const 表达式中不能有泛型参数 M\n    foo::<{ std::mem::size_of::<T>() }>(); // error: 泛型表达式包含了泛型参数 T\n\n    let _: [u8; M]; // ok: 符合第一种\n    let _: [u8; std::mem::size_of::<T>()]; // error: 泛型表达式包含了泛型参数 T\n}\n\nfn main() {}`, `6077394152269889000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> foo<span class="token operator">&lt;</span><span class="token keyword">const</span> N<span class="token punctuation">:</span> usize<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> bar<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> M<span class="token punctuation">:</span> usize<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    foo<span class="token punctuation">::</span><span class="token operator">&lt;</span>M<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok: 符合第一种</span>\n    foo<span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token number">2021</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok: 符合第二种</span>\n    foo<span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token number">20</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok: 符合第三种</span>\n\n    foo<span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">{</span> M <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: 违背第三种，const 表达式中不能有泛型参数 M</span>\n    foo<span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">{</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error: 泛型表达式包含了泛型参数 T</span>\n\n    <span class="token keyword">let</span> _<span class="token punctuation">:</span> <span class="token punctuation">[</span>u8<span class="token punctuation">;</span> M<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// ok: 符合第一种</span>\n    <span class="token keyword">let</span> _<span class="token punctuation">:</span> <span class="token punctuation">[</span>u8<span class="token punctuation">;</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// error: 泛型表达式包含了泛型参数 T</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-18"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>const 泛型还能帮我们避免一些运行时检查，提升性能</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78965552105276520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pub struct MinSlice<T, const N: usize> {\n    pub head: [T; N],\n    pub tail: [T],\n}\n\nfn main() {\n    let slice: &[u8] = b&quot;Hello, world&quot;;\n    let reference: Option<&u8> = slice.get(6);\n    // 我们知道 \\`.get\\` 返回的是 \\`Some(b\' \')\\`\n    // 但编译器不知道\n    assert!(reference.is_some());\n\n    let slice: &[u8] = b&quot;Hello, world&quot;;\n\n    // 当编译构建 MinSlice 时会进行长度检查，也就是在编译期我们就知道它的长度是 12\n    // 在运行期，一旦 \\`unwrap\\` 成功，在 \\`MinSlice\\` 的作用域内，就再无需任何检查\n    let minslice = MinSlice::<u8, 12>::from_slice(slice).unwrap();\n    let value: u8 = minslice.head[6];\n    assert_eq!(value, b\' \')\n}`, `78965552105276520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">struct</span> MinSlice<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> N<span class="token punctuation">:</span> usize<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> head<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">;</span> N<span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token keyword">pub</span> tail<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>u8<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">b"Hello, world"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> reference<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span><span class="token operator">&amp;</span>u8<span class="token operator">></span> <span class="token operator">=</span> slice<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 我们知道 `.get` 返回的是 `Some(b\' \')`</span>\n    <span class="token comment">// 但编译器不知道</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>reference<span class="token punctuation">.</span><span class="token function">is_some</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>u8<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">b"Hello, world"</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 当编译构建 MinSlice 时会进行长度检查，也就是在编译期我们就知道它的长度是 12</span>\n    <span class="token comment">// 在运行期，一旦 `unwrap` 成功，在 `MinSlice` 的作用域内，就再无需任何检查</span>\n    <span class="token keyword">let</span> minslice <span class="token operator">=</span> MinSlice<span class="token punctuation">::</span><span class="token operator">&lt;</span>u8<span class="token punctuation">,</span> <span class="token number">12</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">from_slice</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> value<span class="token punctuation">:</span> u8 <span class="token operator">=</span> minslice<span class="token punctuation">.</span>head<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token char string">b\' \'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-17"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p><code class="language-text">&lt;T, const N: usize&gt;</code> 是结构体类型的一部分，和数组类型一样，这意味着长度不同会导致类型不同： <code class="language-text">Array&lt;i32, 3&gt;</code> 和 <code class="language-text">Array&lt;i32, 4&gt;</code> 是不同的类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7285357604994936000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nstruct Array<T, const N: usize> {\n    data : [T; N]\n}\n\nfn main() {\n    let arrays = [\n        Array{\n            data: [1, 2, 3],\n        },\n        Array {\n            data: [1.0, 2.0, 3.0],\n        },\n        Array {\n            data: [1, 2]\n        }\n    ];\n}`, `7285357604994936000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">struct</span> Array<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> N<span class="token punctuation">:</span> usize<span class="token operator">></span> <span class="token punctuation">{</span>\n    data <span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">;</span> N<span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arrays <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Array<span class="token punctuation">{</span>\n            data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Array <span class="token punctuation">{</span>\n            data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Array <span class="token punctuation">{</span>\n            data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-136"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-136" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57747837460666500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nstruct Array<T, const N: usize> {\n    data : [T; N]\n}\n\nfn main() {\n    let arrays = [\n        Array{\n            data: [1, 2, 3],\n        },\n        Array {\n            data: [1, 2, 3],\n        },\n        Array {\n            data: [1, 2, 3]\n        }\n    ];\n}`, `57747837460666500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">struct</span> Array<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> N<span class="token punctuation">:</span> usize<span class="token operator">></span> <span class="token punctuation">{</span>\n    data <span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">;</span> N<span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arrays <span class="token operator">=</span> <span class="token punctuation">[</span>\n        Array<span class="token punctuation">{</span>\n            data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Array <span class="token punctuation">{</span>\n            data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Array <span class="token punctuation">{</span>\n            data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-17"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1727765682012272000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn print_array<__>(__) {\n    println!(&quot;{:?}&quot;, arr);\n}\nfn main() {\n    let arr = [1, 2, 3];\n    print_array(arr);\n\n    let arr = [&quot;hello&quot;, &quot;world&quot;];\n    print_array(arr);\n}`, `1727765682012272000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> print_array<span class="token operator">&lt;</span>__<span class="token operator">></span><span class="token punctuation">(</span>__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">print_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">print_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-137"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-137" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53738914621873950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn print_array<T: std::fmt::Debug, const N: usize>(arr: [T; N]) {\n    println!(&quot;{:?}&quot;, arr);\n}\n\nfn main() {\n    let arr = [1, 2, 3];\n    print_array(arr);\n\n    let arr = [&quot;hello&quot;, &quot;world&quot;];\n    print_array(arr);\n}`, `53738914621873950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> print_array<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Debug<span class="token punctuation">,</span> <span class="token keyword">const</span> N<span class="token punctuation">:</span> usize<span class="token operator">></span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>T<span class="token punctuation">;</span> N<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">print_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">print_array</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-16"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>有时我们希望能限制一个变量占用内存的大小，例如在嵌入式环境中，此时 const 泛型参数的第三种形式 const 表达式 就非常适合</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67603643458628170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(incomplete_features)]\n#![feature(generic_const_exprs)]\n\nfn check_size<T>(val: T)\nwhere\n    Assert<{ core::mem::size_of::<T>() < 768 }>: IsTrue,\n{\n    //...\n}\n\n// 修复 main 函数中的错误\nfn main() {\n    check_size([0u8; 767]);\n    check_size([0i32; 191]);\n    check_size([&quot;hello你好&quot;; __]); // size of &str ?\n    check_size([(); __].map(|_| &quot;hello你好&quot;.to_string()));  // size of String?\n    check_size([\'中\'; __]); // size of char ?\n}\n\n\n\npub enum Assert<const CHECK: bool> {}\n\npub trait IsTrue {}\n\nimpl IsTrue for Assert<true> {}`, `67603643458628170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(incomplete_features)]</span>\n<span class="token attribute attr-name">#![feature(generic_const_exprs)]</span>\n\n<span class="token keyword">fn</span> check_size<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>val<span class="token punctuation">:</span> T<span class="token punctuation">)</span>\n<span class="token keyword">where</span>\n    Assert<span class="token operator">&lt;</span><span class="token punctuation">{</span> core<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">768</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">:</span> IsTrue<span class="token punctuation">,</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//...</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 修复 main 函数中的错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0u8</span><span class="token punctuation">;</span> <span class="token number">767</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0i32</span><span class="token punctuation">;</span> <span class="token number">191</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"hello你好"</span><span class="token punctuation">;</span> __<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// size of &amp;str ?</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>_<span class="token operator">|</span> <span class="token string">"hello你好"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// size of String?</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token char string">\'中\'</span><span class="token punctuation">;</span> __<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// size of char ?</span>\n<span class="token punctuation">}</span>\n\n\n\n<span class="token keyword">pub</span> <span class="token keyword">enum</span> Assert<span class="token operator">&lt;</span><span class="token keyword">const</span> CHECK<span class="token punctuation">:</span> bool<span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">trait</span> IsTrue <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> IsTrue <span class="token keyword">for</span> Assert<span class="token operator">&lt;</span><span class="token keyword">true</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-138"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-138" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90109118763040000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(incomplete_features)]\n#![feature(generic_const_exprs)]\n\nfn check_size<T>(val: T)\nwhere\n    Assert<{ core::mem::size_of::<T>() < 768 }>: IsTrue,\n{\n    //...\n}\n\n// 修复 main 函数中的错误\nfn main() {\n    check_size([0u8; 767]); // 1 * 768 = 768\n    check_size([0i32; 191]); // 4 * 192 = 768\n    check_size([&quot;hello你好&quot;; 47]); // 16 * 48 = 768，&str is a string reference, containing a pointer and string length in it, so it takes two word long, in x86-64, 1 word = 8 bytes\n    check_size([(); 31].map(|_| &quot;hello你好&quot;.to_string())); // 24 * 32 = 768，String is a smart pointer struct, it has three fields: pointer, length and capacity, each takes 8 bytes\n    check_size([\'中\'; 191]); // 192 * 4 = 768\n}\n\npub enum Assert<const CHECK: bool> {}\n\npub trait IsTrue {}\n\nimpl IsTrue for Assert<true> {}`, `90109118763040000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(incomplete_features)]</span>\n<span class="token attribute attr-name">#![feature(generic_const_exprs)]</span>\n\n<span class="token keyword">fn</span> check_size<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>val<span class="token punctuation">:</span> T<span class="token punctuation">)</span>\n<span class="token keyword">where</span>\n    Assert<span class="token operator">&lt;</span><span class="token punctuation">{</span> core<span class="token punctuation">::</span>mem<span class="token punctuation">::</span>size_of<span class="token punctuation">::</span><span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">768</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">:</span> IsTrue<span class="token punctuation">,</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//...</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 修复 main 函数中的错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0u8</span><span class="token punctuation">;</span> <span class="token number">767</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 * 768 = 768</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0i32</span><span class="token punctuation">;</span> <span class="token number">191</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4 * 192 = 768</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"hello你好"</span><span class="token punctuation">;</span> <span class="token number">47</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 16 * 48 = 768，&amp;str is a string reference, containing a pointer and string length in it, so it takes two word long, in x86-64, 1 word = 8 bytes</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">31</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>_<span class="token operator">|</span> <span class="token string">"hello你好"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 24 * 32 = 768，String is a smart pointer struct, it has three fields: pointer, length and capacity, each takes 8 bytes</span>\n    <span class="token function">check_size</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token char string">\'中\'</span><span class="token punctuation">;</span> <span class="token number">191</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 192 * 4 = 768</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">enum</span> Assert<span class="token operator">&lt;</span><span class="token keyword">const</span> CHECK<span class="token punctuation">:</span> bool<span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">trait</span> IsTrue <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> IsTrue <span class="token keyword">for</span> Assert<span class="token operator">&lt;</span><span class="token keyword">true</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="特征"><a href="#%E7%89%B9%E5%BE%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>特征</h2>\n<p>特征 Trait 可以告诉编译器一个特定的类型所具有的、且能跟其它类型共享的特性。我们可以使用特征通过抽象的方式来定义这种共享行为，还可以使用特征约束来限定一个泛型类型必须要具有某个特定的行为。</p>\n<blockquote>\n<p>特征跟其它语言的接口较为类似，但是仍然有一些区别</p>\n</blockquote>\n<h3 id="问题一-19"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27502968156180430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Sheep { naked: bool, name: String }\n\nimpl Sheep {\n    fn is_naked(&self) -> bool {\n        self.naked\n    }\n\n    fn shear(&mut self) {\n        if self.is_naked() {\n            // Sheep 结构体上定义的方法可以调用 Sheep 所实现的特征的方法\n            println!(&quot;{} is already naked...&quot;, self.name());\n        } else {\n            println!(&quot;{} gets a haircut!&quot;, self.name);\n\n            self.naked = true;\n        }\n    }\n}\n\ntrait Animal {\n    // 关联函数签名；Self 指代实现者的类型\n    // 例如我们在为 Pig 类型实现特征时，那 new 函数就会返回一个 Pig 类型的实例，这里的 Self 指代的就是 Pig 类型\n    fn new(name: String) -> Self;\n\n    // 方法签名\n    fn name(&self) -> String;\n\n    fn noise(&self) -> String;\n\n    // 方法还能提供默认的定义实现\n    fn talk(&self) {\n        println!(&quot;{} says {}&quot;, self.name(), self.noise());\n    }\n}\n\nimpl Animal for Sheep {\n    // Self 被替换成具体的实现者类型：Sheep\n    fn new(name: String) -> Sheep {\n        Sheep { name: name, naked: false }\n    }\n\n    fn name(&self) -> String {\n        self.name.clone()\n    }\n\n    fn noise(&self) -> String {\n        if self.is_naked() {\n            &quot;baaaaah?&quot;.to_string()\n        } else {\n            &quot;baaaaah!&quot;.to_string()\n        }\n    }\n\n    // 默认的特征方法可以被重写\n    fn talk(&self) {\n        println!(&quot;{} pauses briefly... {}&quot;, self.name, self.noise());\n    }\n}\n\nfn main() {\n    // 这里的类型注释时必须的\n    let mut dolly: Sheep = Animal::new(&quot;Dolly&quot;.to_string());\n    // 尝试去除类型注释，看看会发生什么\n\n    dolly.talk();\n    dolly.shear();\n    dolly.talk();\n}`, `27502968156180430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Sheep <span class="token punctuation">{</span> naked<span class="token punctuation">:</span> bool<span class="token punctuation">,</span> name<span class="token punctuation">:</span> String <span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Sheep <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">is_naked</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> bool <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>naked\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">shear</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">is_naked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// Sheep 结构体上定义的方法可以调用 Sheep 所实现的特征的方法</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} is already naked..."</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} gets a haircut!"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token keyword">self</span><span class="token punctuation">.</span>naked <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> Animal <span class="token punctuation">{</span>\n    <span class="token comment">// 关联函数签名；Self 指代实现者的类型</span>\n    <span class="token comment">// 例如我们在为 Pig 类型实现特征时，那 new 函数就会返回一个 Pig 类型的实例，这里的 Self 指代的就是 Pig 类型</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 方法签名</span>\n    <span class="token keyword">fn</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n\n    <span class="token comment">// 方法还能提供默认的定义实现</span>\n    <span class="token keyword">fn</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} says {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">noise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Animal <span class="token keyword">for</span> Sheep <span class="token punctuation">{</span>\n    <span class="token comment">// Self 被替换成具体的实现者类型：Sheep</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">-></span> Sheep <span class="token punctuation">{</span>\n        Sheep <span class="token punctuation">{</span> name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> naked<span class="token punctuation">:</span> <span class="token keyword">false</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">is_naked</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token string">"baaaaah?"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token string">"baaaaah!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 默认的特征方法可以被重写</span>\n    <span class="token keyword">fn</span> <span class="token function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} pauses briefly... {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">noise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 这里的类型注释时必须的</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> dolly<span class="token punctuation">:</span> Sheep <span class="token operator">=</span> Animal<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Dolly"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 尝试去除类型注释，看看会发生什么</span>\n\n    dolly<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    dolly<span class="token punctuation">.</span><span class="token function">shear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    dolly<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-19"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65316537457441750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 完成两个 \\`impl\\` 语句块\n// 不要修改 \\`main\\` 中的代码\ntrait Hello {\n    fn say_hi(&self) -> String {\n        String::from(&quot;hi&quot;)\n    }\n\n    fn say_something(&self) -> String;\n}\n\nstruct Student {}\nimpl Hello for Student {\n}\nstruct Teacher {}\nimpl Hello for Teacher {\n}\n\nfn main() {\n    let s = Student {};\n    assert_eq!(s.say_hi(), &quot;hi&quot;);\n    assert_eq!(s.say_something(), &quot;I\'m a good student&quot;);\n\n    let t = Teacher {};\n    assert_eq!(t.say_hi(), &quot;Hi, I\'m your new teacher&quot;);\n    assert_eq!(t.say_something(), &quot;I\'m not a bad teacher&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `65316537457441750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 完成两个 `impl` 语句块</span>\n<span class="token comment">// 不要修改 `main` 中的代码</span>\n<span class="token keyword">trait</span> Hello <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">say_hi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">say_something</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Student <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">impl</span> Hello <span class="token keyword">for</span> Student <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Teacher <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">impl</span> Hello <span class="token keyword">for</span> Teacher <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> Student <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">say_hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">say_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"I\'m a good student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> t <span class="token operator">=</span> Teacher <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">say_hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Hi, I\'m your new teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">say_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"I\'m not a bad teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-139"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-139" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2235915264201837600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 完成两个 \\`impl\\` 语句块\n// 不要修改 \\`main\\` 中的代码\ntrait Hello {\n    fn say_hi(&self) -> String {\n        String::from(&quot;hi&quot;)\n    }\n\n    fn say_something(&self) -> String;\n}\n\nstruct Student {}\nimpl Hello for Student {\n    fn say_something(&self) -> String {\n        String::from(&quot;I\'m a good student&quot;)\n    }\n}\nstruct Teacher {}\nimpl Hello for Teacher {\n    fn say_hi(&self) -> String {\n        String::from(&quot;Hi, I\'m your new teacher&quot;)\n    }\n\n    fn say_something(&self) -> String {\n        String::from(&quot;I\'m not a bad teacher&quot;)\n    }\n}\n\nfn main() {\n    let s = Student {};\n    assert_eq!(s.say_hi(), &quot;hi&quot;);\n    assert_eq!(s.say_something(), &quot;I\'m a good student&quot;);\n\n    let t = Teacher {};\n    assert_eq!(t.say_hi(), &quot;Hi, I\'m your new teacher&quot;);\n    assert_eq!(t.say_something(), &quot;I\'m not a bad teacher&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `2235915264201837600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 完成两个 `impl` 语句块</span>\n<span class="token comment">// 不要修改 `main` 中的代码</span>\n<span class="token keyword">trait</span> Hello <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">say_hi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">say_something</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Student <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">impl</span> Hello <span class="token keyword">for</span> Student <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">say_something</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I\'m a good student"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Teacher <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">impl</span> Hello <span class="token keyword">for</span> Teacher <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">say_hi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Hi, I\'m your new teacher"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">say_something</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"I\'m not a bad teacher"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> Student <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">say_hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">say_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"I\'m a good student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> t <span class="token operator">=</span> Teacher <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">say_hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Hi, I\'m your new teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">say_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"I\'m not a bad teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-19"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>我们可以使用 <code class="language-text">#[derive]</code> 属性来派生一些特征，对于这些特征编译器会自动进行默认实现，对于日常代码开发而言，这是非常方便的，例如大家经常用到的 Debug 特征，就是直接通过派生来获取默认实现，而无需我们手动去完成这个工作</p>\n<p>想要查看更多信息，可以访问<a href="https://course.rs/appendix/derive.html" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91128938872376300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// \\`Centimeters\\`, 一个元组结构体，可以被比较大小\n#[derive(PartialEq, PartialOrd)]\nstruct Centimeters(f64);\n\n// \\`Inches\\`, 一个元组结构体可以被打印\n#[derive(Debug)]\nstruct Inches(i32);\n\nimpl Inches {\n    fn to_centimeters(&self) -> Centimeters {\n        let &Inches(inches) = self;\n\n        Centimeters(inches as f64 * 2.54)\n    }\n}\n\n// 添加一些属性让代码工作\n// 不要修改其它代码！\nstruct Seconds(i32);\n\nfn main() {\n    let _one_second = Seconds(1);\n\n    println!(&quot;One second looks like: {:?}&quot;, _one_second);\n    let _this_is_true = _one_second == _one_second;\n    let _this_is_true = _one_second > _one_second;\n\n    let foot = Inches(12);\n\n    println!(&quot;One foot equals {:?}&quot;, foot);\n\n    let meter = Centimeters(100.0);\n\n    let cmp =\n        if foot.to_centimeters() < meter {\n            &quot;smaller&quot;\n        } else {\n            &quot;bigger&quot;\n        };\n\n    println!(&quot;One foot is {} than one meter.&quot;, cmp);\n}`, `91128938872376300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// `Centimeters`, 一个元组结构体，可以被比较大小</span>\n<span class="token attribute attr-name">#[derive(PartialEq, PartialOrd)]</span>\n<span class="token keyword">struct</span> <span class="token function">Centimeters</span><span class="token punctuation">(</span>f64<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// `Inches`, 一个元组结构体可以被打印</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> <span class="token function">Inches</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> Inches <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">to_centimeters</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Centimeters <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token operator">&amp;</span><span class="token function">Inches</span><span class="token punctuation">(</span>inches<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>\n\n        <span class="token function">Centimeters</span><span class="token punctuation">(</span>inches <span class="token keyword">as</span> f64 <span class="token operator">*</span> <span class="token number">2.54</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 添加一些属性让代码工作</span>\n<span class="token comment">// 不要修改其它代码！</span>\n<span class="token keyword">struct</span> <span class="token function">Seconds</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _one_second <span class="token operator">=</span> <span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One second looks like: {:?}"</span><span class="token punctuation">,</span> _one_second<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _this_is_true <span class="token operator">=</span> _one_second <span class="token operator">==</span> _one_second<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _this_is_true <span class="token operator">=</span> _one_second <span class="token operator">></span> _one_second<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> foot <span class="token operator">=</span> <span class="token function">Inches</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One foot equals {:?}"</span><span class="token punctuation">,</span> foot<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> meter <span class="token operator">=</span> <span class="token function">Centimeters</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> cmp <span class="token operator">=</span>\n        <span class="token keyword">if</span> foot<span class="token punctuation">.</span><span class="token function">to_centimeters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> meter <span class="token punctuation">{</span>\n            <span class="token string">"smaller"</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token string">"bigger"</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One foot is {} than one meter."</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-140"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-140" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69134893916030800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// \\`Centimeters\\`, 一个元组结构体，可以被比较大小\n#[derive(PartialEq, PartialOrd)]\nstruct Centimeters(f64);\n\n// \\`Inches\\`, 一个元组结构体可以被打印\n#[derive(Debug)]\nstruct Inches(i32);\n\nimpl Inches {\n    fn to_centimeters(&self) -> Centimeters {\n        let &Inches(inches) = self;\n\n        Centimeters(inches as f64 * 2.54)\n    }\n}\n\n// 添加一些属性让代码工作\n// 不要修改其它代码！\n#[derive(PartialEq, PartialOrd, Debug)]\nstruct Seconds(i32);\n\nfn main() {\n    let _one_second = Seconds(1);\n\n    println!(&quot;One second looks like: {:?}&quot;, _one_second);\n    let _this_is_true = _one_second == _one_second;\n    let _this_is_true = _one_second > _one_second;\n\n    let foot = Inches(12);\n\n    println!(&quot;One foot equals {:?}&quot;, foot);\n\n    let meter = Centimeters(100.0);\n\n    let cmp = if foot.to_centimeters() < meter {\n        &quot;smaller&quot;\n    } else {\n        &quot;bigger&quot;\n    };\n\n    println!(&quot;One foot is {} than one meter.&quot;, cmp);\n}`, `69134893916030800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// `Centimeters`, 一个元组结构体，可以被比较大小</span>\n<span class="token attribute attr-name">#[derive(PartialEq, PartialOrd)]</span>\n<span class="token keyword">struct</span> <span class="token function">Centimeters</span><span class="token punctuation">(</span>f64<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// `Inches`, 一个元组结构体可以被打印</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> <span class="token function">Inches</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> Inches <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">to_centimeters</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Centimeters <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token operator">&amp;</span><span class="token function">Inches</span><span class="token punctuation">(</span>inches<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>\n\n        <span class="token function">Centimeters</span><span class="token punctuation">(</span>inches <span class="token keyword">as</span> f64 <span class="token operator">*</span> <span class="token number">2.54</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 添加一些属性让代码工作</span>\n<span class="token comment">// 不要修改其它代码！</span>\n<span class="token attribute attr-name">#[derive(PartialEq, PartialOrd, Debug)]</span>\n<span class="token keyword">struct</span> <span class="token function">Seconds</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _one_second <span class="token operator">=</span> <span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One second looks like: {:?}"</span><span class="token punctuation">,</span> _one_second<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _this_is_true <span class="token operator">=</span> _one_second <span class="token operator">==</span> _one_second<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _this_is_true <span class="token operator">=</span> _one_second <span class="token operator">></span> _one_second<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> foot <span class="token operator">=</span> <span class="token function">Inches</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One foot equals {:?}"</span><span class="token punctuation">,</span> foot<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> meter <span class="token operator">=</span> <span class="token function">Centimeters</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> cmp <span class="token operator">=</span> <span class="token keyword">if</span> foot<span class="token punctuation">.</span><span class="token function">to_centimeters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> meter <span class="token punctuation">{</span>\n        <span class="token string">"smaller"</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token string">"bigger"</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"One foot is {} than one meter."</span><span class="token punctuation">,</span> cmp<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-18"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>在 Rust 中，许多运算符都可以被重载，事实上，运算符仅仅是特征方法调用的语法糖。例如 a + b 中的 + 是 std::ops::Add 特征的 add 方法调用，因此我们可以为自定义类型实现该特征来支持该类型的加法运算。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14703698685478228000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops;\n\n// 实现 fn multiply 方法\n// 如上所述，\\`+\\` 需要 \\`T\\` 类型实现 \\`std::ops::Add\\` 特征\n// 那么, \\`*\\` 运算符需要实现什么特征呢? 你可以在这里找到答案: https://doc.rust-lang.org/core/ops/\nfn multiply\n\nfn main() {\n    assert_eq!(6, multiply(2u8, 3u8));\n    assert_eq!(5.0, multiply(1.0, 5.0));\n\n    println!(&quot;Success!&quot;)\n}`, `14703698685478228000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">;</span>\n\n<span class="token comment">// 实现 fn multiply 方法</span>\n<span class="token comment">// 如上所述，`+` 需要 `T` 类型实现 `std::ops::Add` 特征</span>\n<span class="token comment">// 那么, `*` 运算符需要实现什么特征呢? 你可以在这里找到答案: https://doc.rust-lang.org/core/ops/</span>\n<span class="token keyword">fn</span> multiply\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">2u8</span><span class="token punctuation">,</span> <span class="token number">3u8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-141"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-141" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91033464983734370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops;\n\n// 实现 fn multiply 方法\n// 如上所述，\\`+\\` 需要 \\`T\\` 类型实现 \\`std::ops::Add\\` 特征\n// 那么, \\`*\\` 运算符需要实现什么特征呢? 你可以在这里找到答案: https://doc.rust-lang.org/core/ops/\nfn multiply<T: ops::Mul<Output = T>>(a: T, b: T) -> T {\n    a * b\n}\n\nfn main() {\n    assert_eq!(6, multiply(2u8, 3u8));\n    assert_eq!(5.0, multiply(1.0, 5.0));\n\n    println!(&quot;Success!&quot;)\n}`, `91033464983734370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">;</span>\n\n<span class="token comment">// 实现 fn multiply 方法</span>\n<span class="token comment">// 如上所述，`+` 需要 `T` 类型实现 `std::ops::Add` 特征</span>\n<span class="token comment">// 那么, `*` 运算符需要实现什么特征呢? 你可以在这里找到答案: https://doc.rust-lang.org/core/ops/</span>\n<span class="token keyword">fn</span> multiply<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> ops<span class="token punctuation">::</span>Mul<span class="token operator">&lt;</span>Output <span class="token operator">=</span> T<span class="token operator">>></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> T<span class="token punctuation">,</span> b<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> T <span class="token punctuation">{</span>\n    a <span class="token operator">*</span> b\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">2u8</span><span class="token punctuation">,</span> <span class="token number">3u8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-18"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21761267497584890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要修改 \\`main\\` 中的代码!\nuse std::ops;\n\nstruct Foo;\nstruct Bar;\n\nstruct FooBar;\n\nstruct BarFoo;\n\n// 下面的代码实现了自定义类型的相加： Foo + Bar = FooBar\nimpl ops::Add<Bar> for Foo {\n    type Output = FooBar;\n\n    fn add(self, _rhs: Bar) -> FooBar {\n        FooBar\n    }\n}\n\nimpl ops::Sub<Foo> for Bar {\n    type Output = BarFoo;\n\n    fn sub(self, _rhs: Foo) -> BarFoo {\n        BarFoo\n    }\n}\n\nfn main() {\n    // 不要修改下面代码\n    // 你需要为 FooBar 派生一些特征来让代码工作\n    assert_eq!(Foo + Bar, FooBar);\n    assert_eq!(Foo - Bar, BarFoo);\n\n    println!(&quot;Success!&quot;)\n}`, `21761267497584890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要修改 `main` 中的代码!</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">;</span>\n\n<span class="token keyword">struct</span> Foo<span class="token punctuation">;</span>\n<span class="token keyword">struct</span> Bar<span class="token punctuation">;</span>\n\n<span class="token keyword">struct</span> FooBar<span class="token punctuation">;</span>\n\n<span class="token keyword">struct</span> BarFoo<span class="token punctuation">;</span>\n\n<span class="token comment">// 下面的代码实现了自定义类型的相加： Foo + Bar = FooBar</span>\n<span class="token keyword">impl</span> ops<span class="token punctuation">::</span>Add<span class="token operator">&lt;</span>Bar<span class="token operator">></span> <span class="token keyword">for</span> Foo <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> FooBar<span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> _rhs<span class="token punctuation">:</span> Bar<span class="token punctuation">)</span> <span class="token punctuation">-></span> FooBar <span class="token punctuation">{</span>\n        FooBar\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> ops<span class="token punctuation">::</span>Sub<span class="token operator">&lt;</span>Foo<span class="token operator">></span> <span class="token keyword">for</span> Bar <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> BarFoo<span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> _rhs<span class="token punctuation">:</span> Foo<span class="token punctuation">)</span> <span class="token punctuation">-></span> BarFoo <span class="token punctuation">{</span>\n        BarFoo\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 不要修改下面代码</span>\n    <span class="token comment">// 你需要为 FooBar 派生一些特征来让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Foo <span class="token operator">+</span> Bar<span class="token punctuation">,</span> FooBar<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Foo <span class="token operator">-</span> Bar<span class="token punctuation">,</span> BarFoo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-142"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-142" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73521036264740090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，不要修改 \\`main\\` 中的代码!\nuse std::ops;\n\nstruct Foo;\nstruct Bar;\n\n#[derive(PartialEq, Debug)]\nstruct FooBar;\n\n#[derive(PartialEq, Debug)]\nstruct BarFoo;\n\n// 下面的代码实现了自定义类型的相加： Foo + Bar = FooBar\nimpl ops::Add<Bar> for Foo {\n    type Output = FooBar;\n\n    fn add(self, _rhs: Bar) -> FooBar {\n        FooBar\n    }\n}\n\nimpl ops::Sub<Bar> for Foo {\n    type Output = BarFoo;\n\n    fn sub(self, _rhs: Bar) -> BarFoo {\n        BarFoo\n    }\n}\n\nfn main() {\n    // 不要修改下面代码\n    // 你需要为 FooBar 派生一些特征来让代码工作\n    assert_eq!(Foo + Bar, FooBar);\n    assert_eq!(Foo - Bar, BarFoo);\n\n    println!(&quot;Success!&quot;)\n}`, `73521036264740090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，不要修改 `main` 中的代码!</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">;</span>\n\n<span class="token keyword">struct</span> Foo<span class="token punctuation">;</span>\n<span class="token keyword">struct</span> Bar<span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(PartialEq, Debug)]</span>\n<span class="token keyword">struct</span> FooBar<span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(PartialEq, Debug)]</span>\n<span class="token keyword">struct</span> BarFoo<span class="token punctuation">;</span>\n\n<span class="token comment">// 下面的代码实现了自定义类型的相加： Foo + Bar = FooBar</span>\n<span class="token keyword">impl</span> ops<span class="token punctuation">::</span>Add<span class="token operator">&lt;</span>Bar<span class="token operator">></span> <span class="token keyword">for</span> Foo <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> FooBar<span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> _rhs<span class="token punctuation">:</span> Bar<span class="token punctuation">)</span> <span class="token punctuation">-></span> FooBar <span class="token punctuation">{</span>\n        FooBar\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> ops<span class="token punctuation">::</span>Sub<span class="token operator">&lt;</span>Bar<span class="token operator">></span> <span class="token keyword">for</span> Foo <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> BarFoo<span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> _rhs<span class="token punctuation">:</span> Bar<span class="token punctuation">)</span> <span class="token punctuation">-></span> BarFoo <span class="token punctuation">{</span>\n        BarFoo\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 不要修改下面代码</span>\n    <span class="token comment">// 你需要为 FooBar 派生一些特征来让代码工作</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Foo <span class="token operator">+</span> Bar<span class="token punctuation">,</span> FooBar<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Foo <span class="token operator">-</span> Bar<span class="token punctuation">,</span> BarFoo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-17"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>除了使用具体类型来作为函数参数，我们还能通过 impl Trait 的方式来指定实现了该特征的参数：该参数能接受的类型必须要实现指定的特征。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92542154105495440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 实现 \\`fn summary\\`\n// 修复错误且不要移除任何代码行\ntrait Summary {\n    fn summarize(&self) -> String;\n}\n\n#[derive(Debug)]\nstruct Post {\n    title: String,\n    author: String,\n    content: String,\n}\n\nimpl Summary for Post {\n    fn summarize(&self) -> String {\n        format!(&quot;The author of post {} is {}&quot;, self.title, self.author)\n    }\n}\n\n#[derive(Debug)]\nstruct Weibo {\n    username: String,\n    content: String,\n}\n\nimpl Summary for Weibo {\n    fn summarize(&self) -> String {\n        format!(&quot;{} published a weibo {}&quot;, self.username, self.content)\n    }\n}\n\nfn main() {\n    let post = Post {\n        title: &quot;Popular Rust&quot;.to_string(),\n        author: &quot;Sunface&quot;.to_string(),\n        content: &quot;Rust is awesome!&quot;.to_string(),\n    };\n    let weibo = Weibo {\n        username: &quot;sunface&quot;.to_string(),\n        content: &quot;Weibo seems to be worse than Tweet&quot;.to_string(),\n    };\n\n    summary(post);\n    summary(weibo);\n\n    println!(&quot;{:?}&quot;, post);\n    println!(&quot;{:?}&quot;, weibo);\n}\n\n// 在下面实现 \\`fn summary\\` 函数`, `92542154105495440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 实现 `fn summary`</span>\n<span class="token comment">// 修复错误且不要移除任何代码行</span>\n<span class="token keyword">trait</span> Summary <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Post <span class="token punctuation">{</span>\n    title<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    author<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> Post <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"The author of post {} is {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>author<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Weibo <span class="token punctuation">{</span>\n    username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> Weibo <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{} published a weibo {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> post <span class="token operator">=</span> Post <span class="token punctuation">{</span>\n        title<span class="token punctuation">:</span> <span class="token string">"Popular Rust"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        author<span class="token punctuation">:</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        content<span class="token punctuation">:</span> <span class="token string">"Rust is awesome!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> weibo <span class="token operator">=</span> Weibo <span class="token punctuation">{</span>\n        username<span class="token punctuation">:</span> <span class="token string">"sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        content<span class="token punctuation">:</span> <span class="token string">"Weibo seems to be worse than Tweet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">summary</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">summary</span><span class="token punctuation">(</span>weibo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> post<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> weibo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 在下面实现 `fn summary` 函数</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-143"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-143" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74769897180087930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 实现 \\`fn summary\\`\n// 修复错误且不要移除任何代码行\ntrait Summary {\n    fn summarize(&self) -> String;\n}\n\n#[derive(Debug)]\nstruct Post {\n    title: String,\n    author: String,\n    content: String,\n}\n\nimpl Summary for Post {\n    fn summarize(&self) -> String {\n        format!(&quot;The author of post {} is {}&quot;, self.title, self.author)\n    }\n}\n\n#[derive(Debug)]\nstruct Weibo {\n    username: String,\n    content: String,\n}\n\nimpl Summary for Weibo {\n    fn summarize(&self) -> String {\n        format!(&quot;{} published a weibo {}&quot;, self.username, self.content)\n    }\n}\n\nfn summary(item: &impl Summary) {\n    item.summarize();\n}\n\nfn main() {\n    let post = Post {\n        title: &quot;Popular Rust&quot;.to_string(),\n        author: &quot;Sunface&quot;.to_string(),\n        content: &quot;Rust is awesome!&quot;.to_string(),\n    };\n    let weibo = Weibo {\n        username: &quot;sunface&quot;.to_string(),\n        content: &quot;Weibo seems to be worse than Tweet&quot;.to_string(),\n    };\n\n    summary(&post);\n    summary(&weibo);\n\n    println!(&quot;{:?}&quot;, post);\n    println!(&quot;{:?}&quot;, weibo);\n}\n\n// 在下面实现 \\`fn summary\\` 函数`, `74769897180087930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 实现 `fn summary`</span>\n<span class="token comment">// 修复错误且不要移除任何代码行</span>\n<span class="token keyword">trait</span> Summary <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Post <span class="token punctuation">{</span>\n    title<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    author<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> Post <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"The author of post {} is {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>author<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Weibo <span class="token punctuation">{</span>\n    username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> Weibo <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{} published a weibo {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">summary</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> Summary<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> post <span class="token operator">=</span> Post <span class="token punctuation">{</span>\n        title<span class="token punctuation">:</span> <span class="token string">"Popular Rust"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        author<span class="token punctuation">:</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        content<span class="token punctuation">:</span> <span class="token string">"Rust is awesome!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> weibo <span class="token operator">=</span> Weibo <span class="token punctuation">{</span>\n        username<span class="token punctuation">:</span> <span class="token string">"sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        content<span class="token punctuation">:</span> <span class="token string">"Weibo seems to be worse than Tweet"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">summary</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>post<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">summary</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>weibo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> post<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> weibo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 在下面实现 `fn summary` 函数</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-9"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<p>我们还可以在函数的返回值中使用 impl Trait 语法。然后只有在返回值是同一个类型时，才能这么使用，如果返回值是不同的类型，你可能更需要特征对象。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80716014132075350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Sheep {}\nstruct Cow {}\n\ntrait Animal {\n    fn noise(&self) -> String;\n}\n\nimpl Animal for Sheep {\n    fn noise(&self) -> String {\n        &quot;baaaaah!&quot;.to_string()\n    }\n}\n\nimpl Animal for Cow {\n    fn noise(&self) -> String {\n        &quot;moooooo!&quot;.to_string()\n    }\n}\n\n// 返回一个类型，该类型实现了 Animal 特征，但是我们并不能在编译期获知具体返回了哪个类型\n// 修复这里的错误，你可以使用虚假的随机，也可以使用特征对象\nfn random_animal(random_number: f64) -> impl Animal {\n    if random_number < 0.5 {\n        Sheep {}\n    } else {\n        Cow {}\n    }\n}\n\nfn main() {\n    let random_number = 0.234;\n    let animal = random_animal(random_number);\n    println!(&quot;You\'ve randomly chosen an animal, and it says {}&quot;, animal.noise());\n}`, `80716014132075350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Sheep <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Cow <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> Animal <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Animal <span class="token keyword">for</span> Sheep <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token string">"baaaaah!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Animal <span class="token keyword">for</span> Cow <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token string">"moooooo!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 返回一个类型，该类型实现了 Animal 特征，但是我们并不能在编译期获知具体返回了哪个类型</span>\n<span class="token comment">// 修复这里的错误，你可以使用虚假的随机，也可以使用特征对象</span>\n<span class="token keyword">fn</span> <span class="token function">random_animal</span><span class="token punctuation">(</span>random_number<span class="token punctuation">:</span> f64<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> Animal <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> random_number <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token punctuation">{</span>\n        Sheep <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        Cow <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> random_number <span class="token operator">=</span> <span class="token number">0.234</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token function">random_animal</span><span class="token punctuation">(</span>random_number<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"You\'ve randomly chosen an animal, and it says {}"</span><span class="token punctuation">,</span> animal<span class="token punctuation">.</span><span class="token function">noise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-144"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-144" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="617813206114359300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Sheep {}\nstruct Cow {}\n\ntrait Animal {\n    fn noise(&self) -> String;\n}\n\nimpl Animal for Sheep {\n    fn noise(&self) -> String {\n        &quot;baaaaah!&quot;.to_string()\n    }\n}\n\nimpl Animal for Cow {\n    fn noise(&self) -> String {\n        &quot;moooooo!&quot;.to_string()\n    }\n}\n\n// 返回一个类型，该类型实现了 Animal 特征，但是我们并不能在编译期获知具体返回了哪个类型\n// 修复这里的错误，你可以使用虚假的随机，也可以使用特征对象\nfn random_animal(random_number: f64) -> Box<dyn Animal> {\n    if random_number < 0.5 {\n        Box::new(Sheep {})\n    } else {\n        Box::new(Cow {})\n    }\n}\n\nfn main() {\n    let random_number = 0.234;\n    let animal = random_animal(random_number);\n    println!(\n        &quot;You\'ve randomly chosen an animal, and it says {}&quot;,\n        animal.noise()\n    );\n}`, `617813206114359300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> Sheep <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Cow <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> Animal <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Animal <span class="token keyword">for</span> Sheep <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token string">"baaaaah!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Animal <span class="token keyword">for</span> Cow <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">noise</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token string">"moooooo!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 返回一个类型，该类型实现了 Animal 特征，但是我们并不能在编译期获知具体返回了哪个类型</span>\n<span class="token comment">// 修复这里的错误，你可以使用虚假的随机，也可以使用特征对象</span>\n<span class="token keyword">fn</span> <span class="token function">random_animal</span><span class="token punctuation">(</span>random_number<span class="token punctuation">:</span> f64<span class="token punctuation">)</span> <span class="token punctuation">-></span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> Animal<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> random_number <span class="token operator">&lt;</span> <span class="token number">0.5</span> <span class="token punctuation">{</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>Sheep <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>Cow <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> random_number <span class="token operator">=</span> <span class="token number">0.234</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> animal <span class="token operator">=</span> <span class="token function">random_animal</span><span class="token punctuation">(</span>random_number<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span>\n        <span class="token string">"You\'ve randomly chosen an animal, and it says {}"</span><span class="token punctuation">,</span>\n        animal<span class="token punctuation">.</span><span class="token function">noise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-8"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<p>impl Trait 语法非常直观简洁，但它实际上是特征约束的语法糖。</p>\n<p>当使用泛型参数时，我们往往需要为该参数指定特定的行为，这种指定方式就是通过特征约束来实现的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90832546771231870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert_eq!(sum(1, 2), 3);\n}\n\n// 通过两种方法使用特征约束来实现 \\`fn sum\\`\nfn sum<T>(x: T, y: T) -> T {\n    x + y\n}`, `90832546771231870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 通过两种方法使用特征约束来实现 `fn sum`</span>\n<span class="token keyword">fn</span> sum<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">,</span> y<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> T <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-145"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-145" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20337926748011135000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops::Add;\n\nfn main() {\n    assert_eq!(sum(1, 2), 3);\n}\n\n// 通过两种方法使用特征约束来实现 \\`fn sum\\`\nfn sum<T: Add<Output = T>>(x: T, y: T) -> T {\n    x + y\n}`, `20337926748011135000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>Add<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 通过两种方法使用特征约束来实现 `fn sum`</span>\n<span class="token keyword">fn</span> sum<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Add<span class="token operator">&lt;</span>Output <span class="token operator">=</span> T<span class="token operator">>></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">,</span> y<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> T <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39375294588987410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops::Add;\n\nfn main() {\n    assert_eq!(sum(1, 2), 3);\n}\n\n// 通过两种方法使用特征约束来实现 \\`fn sum\\`\nfn sum<T>(x: T, y: T) -> T\nwhere\n    T: Add<Output = T>,\n{\n    x + y\n}`, `39375294588987410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>Add<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 通过两种方法使用特征约束来实现 `fn sum`</span>\n<span class="token keyword">fn</span> sum<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">,</span> y<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> T\n<span class="token keyword">where</span>\n    T<span class="token punctuation">:</span> Add<span class="token operator">&lt;</span>Output <span class="token operator">=</span> T<span class="token operator">></span><span class="token punctuation">,</span>\n<span class="token punctuation">{</span>\n    x <span class="token operator">+</span> y\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-8"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52446408793135960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码中的错误\nstruct Pair<T> {\n    x: T,\n    y: T,\n}\n\nimpl<T> Pair<T> {\n    fn new(x: T, y: T) -> Self {\n        Self {\n            x,\n            y,\n        }\n    }\n}\n\nimpl<T: std::fmt::Debug + PartialOrd> Pair<T> {\n    fn cmp_display(&self) {\n        if self.x >= self.y {\n            println!(&quot;The largest member is x = {:?}&quot;, self.x);\n        } else {\n            println!(&quot;The largest member is y = {:?}&quot;, self.y);\n        }\n    }\n}\n\nstruct Unit(i32);\n\nfn main() {\n    let pair = Pair{\n        x: Unit(1),\n        y: Unit(3)\n    };\n\n    pair.cmp_display();\n}`, `52446408793135960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码中的错误</span>\n<span class="token keyword">struct</span> Pair<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Pair<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">,</span> y<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>\n        <span class="token keyword">Self</span> <span class="token punctuation">{</span>\n            x<span class="token punctuation">,</span>\n            y<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Debug <span class="token operator">+</span> PartialOrd<span class="token operator">></span> Pair<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">cmp_display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">>=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is x = {:?}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is y = {:?}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> <span class="token function">Unit</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> pair <span class="token operator">=</span> Pair<span class="token punctuation">{</span>\n        x<span class="token punctuation">:</span> <span class="token function">Unit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        y<span class="token punctuation">:</span> <span class="token function">Unit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    pair<span class="token punctuation">.</span><span class="token function">cmp_display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-146"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-146" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41991984853776820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复代码中的错误\nstruct Pair<T> {\n    x: T,\n    y: T,\n}\n\nimpl<T> Pair<T> {\n    fn new(x: T, y: T) -> Self {\n        Self { x, y }\n    }\n}\n\nimpl<T: std::fmt::Debug + PartialOrd> Pair<T> {\n    fn cmp_display(&self) {\n        if self.x >= self.y {\n            println!(&quot;The largest member is x = {:?}&quot;, self.x);\n        } else {\n            println!(&quot;The largest member is y = {:?}&quot;, self.y);\n        }\n    }\n}\n\n#[derive(Debug, PartialOrd, PartialEq)]\nstruct Unit(i32);\n\nfn main() {\n    let pair = Pair {\n        x: Unit(1),\n        y: Unit(3),\n    };\n\n    pair.cmp_display();\n}`, `41991984853776820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复代码中的错误</span>\n<span class="token keyword">struct</span> Pair<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Pair<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">,</span> y<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>\n        <span class="token keyword">Self</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Debug <span class="token operator">+</span> PartialOrd<span class="token operator">></span> Pair<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">cmp_display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">>=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is x = {:?}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is y = {:?}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug, PartialOrd, PartialEq)]</span>\n<span class="token keyword">struct</span> <span class="token function">Unit</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> pair <span class="token operator">=</span> Pair <span class="token punctuation">{</span>\n        x<span class="token punctuation">:</span> <span class="token function">Unit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        y<span class="token punctuation">:</span> <span class="token function">Unit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    pair<span class="token punctuation">.</span><span class="token function">cmp_display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十-4"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67207684735689695000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn example1() {\n    // \\`T: Trait\\` 是最常使用的方式\n    // \\`T: Fn(u32) -> u32\\` 说明 \\`T\\` 只能接收闭包类型的参数\n    struct Cacher<T: Fn(u32) -> u32> {\n        calculation: T,\n        value: Option<u32>,\n    }\n\n    impl<T: Fn(u32) -> u32> Cacher<T> {\n        fn new(calculation: T) -> Cacher<T> {\n            Cacher {\n                calculation,\n                value: None,\n            }\n        }\n\n        fn value(&mut self, arg: u32) -> u32 {\n            match self.value {\n                Some(v) => v,\n                None => {\n                    let v = (self.calculation)(arg);\n                    self.value = Some(v);\n                    v\n                },\n            }\n        }\n    }\n\n    let mut cacher = Cacher::new(|x| x+1);\n    assert_eq!(cacher.value(10), __);\n    assert_eq!(cacher.value(15), __);\n}\n\nfn example2() {\n    // 还可以使用 \\`where\\` 来约束 T\n    struct Cacher<T>\n        where T: Fn(u32) -> u32,\n    {\n        calculation: T,\n        value: Option<u32>,\n    }\n\n    impl<T> Cacher<T>\n        where T: Fn(u32) -> u32,\n    {\n        fn new(calculation: T) -> Cacher<T> {\n            Cacher {\n                calculation,\n                value: None,\n            }\n        }\n\n        fn value(&mut self, arg: u32) -> u32 {\n            match self.value {\n                Some(v) => v,\n                None => {\n                    let v = (self.calculation)(arg);\n                    self.value = Some(v);\n                    v\n                },\n            }\n        }\n    }\n\n    let mut cacher = Cacher::new(|x| x+1);\n    assert_eq!(cacher.value(20), __);\n    assert_eq!(cacher.value(25), __);\n}\n\n\n\nfn main() {\n    example1();\n    example2();\n\n    println!(&quot;Success!&quot;)\n}`, `67207684735689695000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">example1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// `T: Trait` 是最常使用的方式</span>\n    <span class="token comment">// `T: Fn(u32) -> u32` 说明 `T` 只能接收闭包类型的参数</span>\n    <span class="token keyword">struct</span> Cacher<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token operator">></span> <span class="token punctuation">{</span>\n        calculation<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n        value<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>u32<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token operator">></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n        <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>calculation<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n            Cacher <span class="token punctuation">{</span>\n                calculation<span class="token punctuation">,</span>\n                value<span class="token punctuation">:</span> None<span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> arg<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n            <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token punctuation">{</span>\n                <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> v<span class="token punctuation">,</span>\n                None <span class="token operator">=></span> <span class="token punctuation">{</span>\n                    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>calculation<span class="token punctuation">)</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    v\n                <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> cacher <span class="token operator">=</span> Cacher<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">example2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 还可以使用 `where` 来约束 T</span>\n    <span class="token keyword">struct</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span>\n        <span class="token keyword">where</span> T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n        calculation<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n        value<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>u32<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span>\n        <span class="token keyword">where</span> T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>calculation<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n            Cacher <span class="token punctuation">{</span>\n                calculation<span class="token punctuation">,</span>\n                value<span class="token punctuation">:</span> None<span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> arg<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n            <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token punctuation">{</span>\n                <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> v<span class="token punctuation">,</span>\n                None <span class="token operator">=></span> <span class="token punctuation">{</span>\n                    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>calculation<span class="token punctuation">)</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    v\n                <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> cacher <span class="token operator">=</span> Cacher<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">example1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">example2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-147"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-147" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68922202943837970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn example1() {\n    // \\`T: Trait\\` 是最常使用的方式\n    // \\`T: Fn(u32) -> u32\\` 说明 \\`T\\` 只能接收闭包类型的参数\n    struct Cacher<T: Fn(u32) -> u32> {\n        calculation: T,\n        value: Option<u32>,\n    }\n\n    impl<T: Fn(u32) -> u32> Cacher<T> {\n        fn new(calculation: T) -> Cacher<T> {\n            Cacher {\n                calculation,\n                value: None,\n            }\n        }\n\n        fn value(&mut self, arg: u32) -> u32 {\n            match self.value {\n                Some(v) => v,\n                None => {\n                    let v = (self.calculation)(arg);\n                    self.value = Some(v);\n                    v\n                }\n            }\n        }\n    }\n\n    let mut cacher = Cacher::new(|x| x + 1);\n    assert_eq!(cacher.value(10), 11);\n    assert_eq!(cacher.value(15), 11);\n}\n\nfn example2() {\n    // 还可以使用 \\`where\\` 来约束 T\n    struct Cacher<T>\n    where\n        T: Fn(u32) -> u32,\n    {\n        calculation: T,\n        value: Option<u32>,\n    }\n\n    impl<T> Cacher<T>\n    where\n        T: Fn(u32) -> u32,\n    {\n        fn new(calculation: T) -> Cacher<T> {\n            Cacher {\n                calculation,\n                value: None,\n            }\n        }\n\n        fn value(&mut self, arg: u32) -> u32 {\n            match self.value {\n                Some(v) => v,\n                None => {\n                    let v = (self.calculation)(arg);\n                    self.value = Some(v);\n                    v\n                }\n            }\n        }\n    }\n\n    let mut cacher = Cacher::new(|x| x + 1);\n    assert_eq!(cacher.value(20), 21);\n    assert_eq!(cacher.value(25), 21);\n}\n\nfn main() {\n    example1();\n    example2();\n\n    println!(&quot;Success!&quot;)\n}`, `68922202943837970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">example1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// `T: Trait` 是最常使用的方式</span>\n    <span class="token comment">// `T: Fn(u32) -> u32` 说明 `T` 只能接收闭包类型的参数</span>\n    <span class="token keyword">struct</span> Cacher<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token operator">></span> <span class="token punctuation">{</span>\n        calculation<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n        value<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>u32<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token operator">></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n        <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>calculation<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n            Cacher <span class="token punctuation">{</span>\n                calculation<span class="token punctuation">,</span>\n                value<span class="token punctuation">:</span> None<span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> arg<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n            <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token punctuation">{</span>\n                <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> v<span class="token punctuation">,</span>\n                None <span class="token operator">=></span> <span class="token punctuation">{</span>\n                    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>calculation<span class="token punctuation">)</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    v\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> cacher <span class="token operator">=</span> Cacher<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">example2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 还可以使用 `where` 来约束 T</span>\n    <span class="token keyword">struct</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span>\n    <span class="token keyword">where</span>\n        T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n        calculation<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n        value<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>u32<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span>\n    <span class="token keyword">where</span>\n        T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32<span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>calculation<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">-></span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n            Cacher <span class="token punctuation">{</span>\n                calculation<span class="token punctuation">,</span>\n                value<span class="token punctuation">:</span> None<span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> arg<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n            <span class="token keyword">match</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token punctuation">{</span>\n                <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=></span> v<span class="token punctuation">,</span>\n                None <span class="token operator">=></span> <span class="token punctuation">{</span>\n                    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>calculation<span class="token punctuation">)</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                    v\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> cacher <span class="token operator">=</span> Cacher<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">example1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">example2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="特征对象"><a href="#%E7%89%B9%E5%BE%81%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>特征对象</h2>\n<p>在特征练习中，我们已经知道当函数返回多个类型时，impl Trait 是无法使用的</p>\n<p>对于数组而言，其中一个限制就是无法存储不同类型的元素，但是通过之前的学习，大家应该知道枚举可以在部分场景解决这种问题，但是这种方法局限性较大。此时就需要我们的主角登场了</p>\n<h3 id="问题一-20"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>Rust 编译器需要知道一个函数的返回类型占用多少内存空间。由于特征的不同实现类型可能会占用不同的内存，因此通过 impl Trait 返回多个类型是不被允许的，但是我们可以返回一个 dyn 特征对象来解决问题</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36163707402882683000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Bird {\n    fn quack(&self) -> String;\n}\n\nstruct Duck;\nimpl Duck {\n    fn swim(&self) {\n        println!(&quot;Look, the duck is swimming&quot;)\n    }\n}\nstruct Swan;\nimpl Swan {\n    fn fly(&self) {\n        println!(&quot;Look, the duck.. oh sorry, the swan is flying&quot;)\n    }\n}\n\nimpl Bird for Duck {\n    fn quack(&self) -> String{\n        &quot;duck duck&quot;.to_string()\n    }\n}\n\nimpl Bird for Swan {\n    fn quack(&self) -> String{\n        &quot;swan swan&quot;.to_string()\n    }\n}\n\nfn main() {\n    // 填空\n    let duck = __;\n    duck.swim();\n\n    let bird = hatch_a_bird(2);\n    // 变成鸟儿后，它忘记了如何游，因此以下代码会报错\n    // bird.swim();\n    // 但它依然可以叫唤\n    assert_eq!(bird.quack(), &quot;duck duck&quot;);\n\n    let bird = hatch_a_bird(1);\n    // 这只鸟儿忘了如何飞翔，因此以下代码会报错\n    // bird.fly();\n    // 但它也可以叫唤\n    assert_eq!(bird.quack(), &quot;swan swan&quot;);\n\n    println!(&quot;Success!&quot;)\n}\n\n// 实现以下函数\nfn hatch_a_bird...`, `36163707402882683000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Bird <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Duck<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">swim</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck is swimming"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Swan<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck.. oh sorry, the swan is flying"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">{</span>\n        <span class="token string">"duck duck"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">{</span>\n        <span class="token string">"swan swan"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> duck <span class="token operator">=</span> __<span class="token punctuation">;</span>\n    duck<span class="token punctuation">.</span><span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> bird <span class="token operator">=</span> <span class="token function">hatch_a_bird</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 变成鸟儿后，它忘记了如何游，因此以下代码会报错</span>\n    <span class="token comment">// bird.swim();</span>\n    <span class="token comment">// 但它依然可以叫唤</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>bird<span class="token punctuation">.</span><span class="token function">quack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"duck duck"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> bird <span class="token operator">=</span> <span class="token function">hatch_a_bird</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 这只鸟儿忘了如何飞翔，因此以下代码会报错</span>\n    <span class="token comment">// bird.fly();</span>\n    <span class="token comment">// 但它也可以叫唤</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>bird<span class="token punctuation">.</span><span class="token function">quack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"swan swan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 实现以下函数</span>\n<span class="token keyword">fn</span> hatch_a_bird<span class="token punctuation">...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-148"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-148" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27750153629833683000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Bird {\n    fn quack(&self) -> String;\n}\n\nstruct Duck;\nimpl Duck {\n    fn swim(&self) {\n        println!(&quot;Look, the duck is swimming&quot;)\n    }\n}\nstruct Swan;\nimpl Swan {\n    fn fly(&self) {\n        println!(&quot;Look, the duck.. oh sorry, the swan is flying&quot;)\n    }\n}\n\nimpl Bird for Duck {\n    fn quack(&self) -> String{\n        &quot;duck duck&quot;.to_string()\n    }\n}\n\nimpl Bird for Swan {\n    fn quack(&self) -> String{\n        &quot;swan swan&quot;.to_string()\n    }\n}\n\nfn main() {\n    // 填空\n    let duck = Duck{};\n    duck.swim();\n\n    let bird = hatch_a_bird(2);\n    // 变成鸟儿后，它忘记了如何游，因此以下代码会报错\n    // bird.swim();\n    // 但它依然可以叫唤\n    assert_eq!(bird.quack(), &quot;duck duck&quot;);\n\n    let bird = hatch_a_bird(1);\n    // 这只鸟儿忘了如何飞翔，因此以下代码会报错\n    // bird.fly();\n    // 但它也可以叫唤\n    assert_eq!(bird.quack(), &quot;swan swan&quot;);\n\n    println!(&quot;Success!&quot;)\n}\n\n// 实现以下函数\nfn hatch_a_bird(bird: u8) -> Box<dyn Bird> {\n    match bird {\n        1 => Box::new(Swan{}),\n        _ => Box::new(Duck{}),\n    }\n}`, `27750153629833683000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Bird <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Duck<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">swim</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck is swimming"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Swan<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck.. oh sorry, the swan is flying"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">{</span>\n        <span class="token string">"duck duck"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">{</span>\n        <span class="token string">"swan swan"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> duck <span class="token operator">=</span> Duck<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    duck<span class="token punctuation">.</span><span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> bird <span class="token operator">=</span> <span class="token function">hatch_a_bird</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 变成鸟儿后，它忘记了如何游，因此以下代码会报错</span>\n    <span class="token comment">// bird.swim();</span>\n    <span class="token comment">// 但它依然可以叫唤</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>bird<span class="token punctuation">.</span><span class="token function">quack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"duck duck"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> bird <span class="token operator">=</span> <span class="token function">hatch_a_bird</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 这只鸟儿忘了如何飞翔，因此以下代码会报错</span>\n    <span class="token comment">// bird.fly();</span>\n    <span class="token comment">// 但它也可以叫唤</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>bird<span class="token punctuation">.</span><span class="token function">quack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"swan swan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 实现以下函数</span>\n<span class="token keyword">fn</span> <span class="token function">hatch_a_bird</span><span class="token punctuation">(</span>bird<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> Bird<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> bird <span class="token punctuation">{</span>\n        <span class="token number">1</span> <span class="token operator">=></span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>Swan<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>Duck<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-20"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>在数组中使用特征对象</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90063571571358960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Bird {\n    fn quack(&self);\n}\n\nstruct Duck;\nimpl Duck {\n    fn fly(&self) {\n        println!(&quot;Look, the duck is flying&quot;)\n    }\n}\nstruct Swan;\nimpl Swan {\n    fn fly(&self) {\n        println!(&quot;Look, the duck.. oh sorry, the swan is flying&quot;)\n    }\n}\n\nimpl Bird for Duck {\n    fn quack(&self) {\n        println!(&quot;{}&quot;, &quot;duck duck&quot;);\n    }\n}\n\nimpl Bird for Swan {\n    fn quack(&self) {\n        println!(&quot;{}&quot;, &quot;swan swan&quot;);\n    }\n}\n\nfn main() {\n    // 填空\n    let birds __;\n\n    for bird in birds {\n        bird.quack();\n        // 当 duck 和 swan 变成 bird 后，它们都忘了如何翱翔于天际，只记得该怎么叫唤了。。\n        // 因此，以下代码会报错\n        // bird.fly();\n    }\n}`, `90063571571358960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Bird <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Duck<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck is flying"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Swan<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck.. oh sorry, the swan is flying"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token string">"duck duck"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token string">"swan swan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> birds __<span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> bird <span class="token keyword">in</span> birds <span class="token punctuation">{</span>\n        bird<span class="token punctuation">.</span><span class="token function">quack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 当 duck 和 swan 变成 bird 后，它们都忘了如何翱翔于天际，只记得该怎么叫唤了。。</span>\n        <span class="token comment">// 因此，以下代码会报错</span>\n        <span class="token comment">// bird.fly();</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-149"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-149" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10614222234614190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops::BitXor;\n\ntrait Bird {\n    fn quack(&self);\n}\n\nstruct Duck;\nimpl Duck {\n    fn fly(&self) {\n        println!(&quot;Look, the duck is flying&quot;)\n    }\n}\nstruct Swan;\nimpl Swan {\n    fn fly(&self) {\n        println!(&quot;Look, the duck.. oh sorry, the swan is flying&quot;)\n    }\n}\n\nimpl Bird for Duck {\n    fn quack(&self) {\n        println!(&quot;{}&quot;, &quot;duck duck&quot;);\n    }\n}\n\nimpl Bird for Swan {\n    fn quack(&self) {\n        println!(&quot;{}&quot;, &quot;swan swan&quot;);\n    }\n}\n\nfn main() {\n    // 填空\n    let birds: [Box<dyn Bird>; 2] = [Box::new(Duck {}), Box::new(Swan {})];\n\n    for bird in birds {\n        bird.quack();\n        // 当 duck 和 swan 变成 bird 后，它们都忘了如何翱翔于天际，只记得该怎么叫唤了。。\n        // 因此，以下代码会报错\n        // bird.fly();\n    }\n}`, `10614222234614190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>BitXor<span class="token punctuation">;</span>\n\n<span class="token keyword">trait</span> Bird <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Duck<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck is flying"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> Swan<span class="token punctuation">;</span>\n<span class="token keyword">impl</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Look, the duck.. oh sorry, the swan is flying"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Duck <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token string">"duck duck"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Bird <span class="token keyword">for</span> Swan <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">quack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token string">"swan swan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> birds<span class="token punctuation">:</span> <span class="token punctuation">[</span>Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> Bird<span class="token operator">></span><span class="token punctuation">;</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>Duck <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>Swan <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> bird <span class="token keyword">in</span> birds <span class="token punctuation">{</span>\n        bird<span class="token punctuation">.</span><span class="token function">quack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 当 duck 和 swan 变成 bird 后，它们都忘了如何翱翔于天际，只记得该怎么叫唤了。。</span>\n        <span class="token comment">// 因此，以下代码会报错</span>\n        <span class="token comment">// bird.fly();</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-20"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p><code class="language-text">&amp;dyn and Box&lt;dyn&gt;</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23721801383069030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\ntrait Draw {\n    fn draw(&self) -> String;\n}\n\nimpl Draw for u8 {\n    fn draw(&self) -> String {\n        format!(&quot;u8: {}&quot;, *self)\n    }\n}\n\nimpl Draw for f64 {\n    fn draw(&self) -> String {\n        format!(&quot;f64: {}&quot;, *self)\n    }\n}\n\nfn main() {\n    let x = 1.1f64;\n    let y = 8u8;\n\n    // draw x\n    draw_with_box(__);\n\n    // draw y\n    draw_with_ref(&y);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn draw_with_box(x: Box<dyn Draw>) {\n    x.draw();\n}\n\nfn draw_with_ref(x: __) {\n    x.draw();\n}`, `23721801383069030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">trait</span> Draw <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Draw <span class="token keyword">for</span> u8 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"u8: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Draw <span class="token keyword">for</span> f64 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"f64: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1.1f64</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">8u8</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// draw x</span>\n    <span class="token function">draw_with_box</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// draw y</span>\n    <span class="token function">draw_with_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">draw_with_box</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> Draw<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">draw_with_ref</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> __<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-150"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-150" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99104924351513230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\ntrait Draw {\n    fn draw(&self) -> String;\n}\n\nimpl Draw for u8 {\n    fn draw(&self) -> String {\n        format!(&quot;u8: {}&quot;, *self)\n    }\n}\n\nimpl Draw for f64 {\n    fn draw(&self) -> String {\n        format!(&quot;f64: {}&quot;, *self)\n    }\n}\n\nfn main() {\n    let x = 1.1f64;\n    let y = 8u8;\n\n    // draw x\n    draw_with_box(Box::new(x));\n\n    // draw y\n    draw_with_ref(&y);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn draw_with_box(x: Box<dyn Draw>) {\n    x.draw();\n}\n\nfn draw_with_ref(x: &dyn Draw) {\n    x.draw();\n}`, `99104924351513230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">trait</span> Draw <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Draw <span class="token keyword">for</span> u8 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"u8: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Draw <span class="token keyword">for</span> f64 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"f64: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1.1f64</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">8u8</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// draw x</span>\n    <span class="token function">draw_with_box</span><span class="token punctuation">(</span>Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// draw y</span>\n    <span class="token function">draw_with_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">draw_with_box</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> Draw<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">draw_with_ref</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> Draw<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-19"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>静态分发和动态分发 <a href="https://course.rs/basic/trait/trait-object.html#%E7%89%B9%E5%BE%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8A%A8%E6%80%81%E5%88%86%E5%8F%91" target="_blank" rel="nofollow noreferrer noopener">Static and Dynamic dispatch</a></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31494158019783836000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Foo {\n    fn method(&self) -> String;\n}\n\nimpl Foo for u8 {\n    fn method(&self) -> String { format!(&quot;u8: {}&quot;, *self) }\n}\n\nimpl Foo for String {\n    fn method(&self) -> String { format!(&quot;string: {}&quot;, *self) }\n}\n\n// 通过泛型实现以下函数\nfn static_dispatch...\n\n// 通过特征对象实现以下函数\nfn dynamic_dispatch...\n\nfn main() {\n    let x = 5u8;\n    let y = &quot;Hello&quot;.to_string();\n\n    static_dispatch(x);\n    dynamic_dispatch(&y);\n\n    println!(&quot;Success!&quot;)\n}`, `31494158019783836000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Foo <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Foo <span class="token keyword">for</span> u8 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span> <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"u8: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Foo <span class="token keyword">for</span> String <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span> <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"string: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 通过泛型实现以下函数</span>\n<span class="token keyword">fn</span> static_dispatch<span class="token punctuation">...</span>\n\n<span class="token comment">// 通过特征对象实现以下函数</span>\n<span class="token keyword">fn</span> dynamic_dispatch<span class="token punctuation">...</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5u8</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">static_dispatch</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">dynamic_dispatch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-151"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-151" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50486841512626610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Foo {\n    fn method(&self) -> String;\n}\n\nimpl Foo for u8 {\n    fn method(&self) -> String { format!(&quot;u8: {}&quot;, *self) }\n}\n\nimpl Foo for String {\n    fn method(&self) -> String { format!(&quot;string: {}&quot;, *self) }\n}\n\n// 通过泛型实现以下函数\nfn static_dispatch<T: Foo>(a: T) {\n    a.method();\n}\n\n// 通过特征对象实现以下函数\nfn dynamic_dispatch(a: &dyn Foo) {\n    a.method();\n}\n\nfn main() {\n    let x = 5u8;\n    let y = &quot;Hello&quot;.to_string();\n\n    static_dispatch(x);\n    dynamic_dispatch(&y);\n\n    println!(&quot;Success!&quot;)\n}`, `50486841512626610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Foo <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Foo <span class="token keyword">for</span> u8 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span> <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"u8: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Foo <span class="token keyword">for</span> String <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span> <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"string: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 通过泛型实现以下函数</span>\n<span class="token keyword">fn</span> static_dispatch<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Foo<span class="token operator">></span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    a<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 通过特征对象实现以下函数</span>\n<span class="token keyword">fn</span> <span class="token function">dynamic_dispatch</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> Foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    a<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5u8</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">static_dispatch</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">dynamic_dispatch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-19"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>一个特征能变成特征对象，首先该特征必须是对象安全的，即该特征的所有方法都必须拥有以下特点：</p>\n<ul>\n<li>返回类型不能是 Self</li>\n<li>不能使用泛型参数</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42470821910363490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用至少两种方法让代码工作\n// 不要添加/删除任何代码行\ntrait MyTrait {\n    fn f(&self) -> Self;\n}\n\nimpl MyTrait for u32 {\n    fn f(&self) -> Self { 42 }\n}\n\nimpl MyTrait for String {\n    fn f(&self) -> Self { self.clone() }\n}\n\nfn my_function(x: Box<dyn MyTrait>)  {\n    x.f()\n}\n\nfn main() {\n    my_function(Box::new(13_u32));\n    my_function(Box::new(String::from(&quot;abc&quot;)));\n\n    println!(&quot;Success!&quot;)\n}`, `42470821910363490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用至少两种方法让代码工作</span>\n<span class="token comment">// 不要添加/删除任何代码行</span>\n<span class="token keyword">trait</span> MyTrait <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> MyTrait <span class="token keyword">for</span> u32 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span> <span class="token number">42</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> MyTrait <span class="token keyword">for</span> String <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">my_function</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> MyTrait<span class="token operator">></span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>\n    x<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">my_function</span><span class="token punctuation">(</span>Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">13_u32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">my_function</span><span class="token punctuation">(</span>Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-152"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-152" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30097029794006100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用至少两种方法让代码工作\n// 不要添加/删除任何代码行\ntrait MyTrait {\n    fn f(&self) -> Box<dyn MyTrait>;\n}\n\nimpl MyTrait for u32 {\n    fn f(&self) -> Box<dyn MyTrait> {\n        Box::new(42)\n    }\n}\n\nimpl MyTrait for String {\n    fn f(&self) -> Box<dyn MyTrait> {\n        Box::new(self.clone())\n    }\n}\n\nfn my_function(x: Box<dyn MyTrait>) -> Box<dyn MyTrait> {\n    x.f()\n}\n\nfn main() {\n    my_function(Box::new(13_u32));\n    my_function(Box::new(String::from(&quot;abc&quot;)));\n\n    println!(&quot;Success!&quot;)\n}`, `30097029794006100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用至少两种方法让代码工作</span>\n<span class="token comment">// 不要添加/删除任何代码行</span>\n<span class="token keyword">trait</span> MyTrait <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> MyTrait<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> MyTrait <span class="token keyword">for</span> u32 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> MyTrait<span class="token operator">></span> <span class="token punctuation">{</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> MyTrait <span class="token keyword">for</span> String <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> MyTrait<span class="token operator">></span> <span class="token punctuation">{</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">my_function</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> MyTrait<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> MyTrait<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">my_function</span><span class="token punctuation">(</span>Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">13_u32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">my_function</span><span class="token punctuation">(</span>Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="进一步深入特征"><a href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%B7%B1%E5%85%A5%E7%89%B9%E5%BE%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进一步深入特征</h2>\n<h3 id="问题一-21"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>关联类型主要用于提升代码的可读性，例如以下代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21607116420500660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(unused)]\nfn main() {\n    pub trait CacheableItem: Clone + Default + fmt::Debug + Decodable + Encodable {\n        type Address: AsRef<[u8]> + Clone + fmt::Debug + Eq + Hash;\n        fn is_null(&self) -> bool;\n    }\n}`, `21607116420500660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(unused)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">trait</span> CacheableItem<span class="token punctuation">:</span> Clone <span class="token operator">+</span> Default <span class="token operator">+</span> fmt<span class="token punctuation">::</span>Debug <span class="token operator">+</span> Decodable <span class="token operator">+</span> Encodable <span class="token punctuation">{</span>\n        <span class="token keyword">type</span> Address<span class="token punctuation">:</span> AsRef<span class="token operator">&lt;</span><span class="token punctuation">[</span>u8<span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">+</span> Clone <span class="token operator">+</span> fmt<span class="token punctuation">::</span>Debug <span class="token operator">+</span> Eq <span class="token operator">+</span> Hash<span class="token punctuation">;</span>\n        <span class="token keyword">fn</span> <span class="token function">is_null</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> bool<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相比 <code class="language-text">AsRef&lt;[u8]&gt; + Clone + fmt::Debug + Eq + Hash</code>，Address 的使用可以极大的减少其它类型在实现该特征时所需的模版代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63078394785926940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Container(i32, i32);\n\n// 使用关联类型实现重新实现以下特征\n// trait Contains {\n//    type A;\n//    type B;\n\ntrait Contains<A, B> {\n    fn contains(&self, _: &A, _: &B) -> bool;\n    fn first(&self) -> i32;\n    fn last(&self) -> i32;\n}\n\nimpl Contains<i32, i32> for Container {\n    fn contains(&self, number_1: &i32, number_2: &i32) -> bool {\n        (&self.0 == number_1) && (&self.1 == number_2)\n    }\n    // Grab the first number.\n    fn first(&self) -> i32 { self.0 }\n\n    // Grab the last number.\n    fn last(&self) -> i32 { self.1 }\n}\n\nfn difference<A, B, C: Contains<A, B>>(container: &C) -> i32 {\n    container.last() - container.first()\n}\n\nfn main() {\n    let number_1 = 3;\n    let number_2 = 10;\n\n    let container = Container(number_1, number_2);\n\n    println!(&quot;Does container contain {} and {}: {}&quot;,\n        &number_1, &number_2,\n        container.contains(&number_1, &number_2));\n    println!(&quot;First number: {}&quot;, container.first());\n    println!(&quot;Last number: {}&quot;, container.last());\n\n    println!(&quot;The difference is: {}&quot;, difference(&container));\n}`, `63078394785926940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> <span class="token function">Container</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 使用关联类型实现重新实现以下特征</span>\n<span class="token comment">// trait Contains {</span>\n<span class="token comment">//    type A;</span>\n<span class="token comment">//    type B;</span>\n\n<span class="token keyword">trait</span> Contains<span class="token operator">&lt;</span>A<span class="token punctuation">,</span> B<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> _<span class="token punctuation">:</span> <span class="token operator">&amp;</span>A<span class="token punctuation">,</span> _<span class="token punctuation">:</span> <span class="token operator">&amp;</span>B<span class="token punctuation">)</span> <span class="token punctuation">-></span> bool<span class="token punctuation">;</span>\n    <span class="token keyword">fn</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32<span class="token punctuation">;</span>\n    <span class="token keyword">fn</span> <span class="token function">last</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Contains<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> i32<span class="token operator">></span> <span class="token keyword">for</span> Container <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> number_1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">,</span> number_2<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> bool <span class="token punctuation">{</span>\n        <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">==</span> number_1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token operator">==</span> number_2<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// Grab the first number.</span>\n    <span class="token keyword">fn</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token punctuation">}</span>\n\n    <span class="token comment">// Grab the last number.</span>\n    <span class="token keyword">fn</span> <span class="token function">last</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> difference<span class="token operator">&lt;</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> C<span class="token punctuation">:</span> Contains<span class="token operator">&lt;</span>A<span class="token punctuation">,</span> B<span class="token operator">>></span><span class="token punctuation">(</span>container<span class="token punctuation">:</span> <span class="token operator">&amp;</span>C<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    container<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> container<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> number_1 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> number_2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> container <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>number_1<span class="token punctuation">,</span> number_2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Does container contain {} and {}: {}"</span><span class="token punctuation">,</span>\n        <span class="token operator">&amp;</span>number_1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>number_2<span class="token punctuation">,</span>\n        container<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>number_1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>number_2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"First number: {}"</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Last number: {}"</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The difference is: {}"</span><span class="token punctuation">,</span> <span class="token function">difference</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-153"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-153" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54093302613953530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Container(i32, i32);\n\n// 使用关联类型实现重新实现以下特征\ntrait Contains {\n    type A;\n    type B;\n    fn contains(&self, _: &Self::A, _: &Self::B) -> bool;\n    fn first(&self) -> i32;\n    fn last(&self) -> i32;\n}\n\n// trait Contains<A, B> {\n//     fn contains(&self, _: &A, _: &B) -> bool;\n//     fn first(&self) -> i32;\n//     fn last(&self) -> i32;\n// }\n\nimpl Contains for Container {\n    type A = i32;\n\n    type B = i32;\n\n    fn contains(&self, number_1: &i32, number_2: &i32) -> bool {\n        (&self.0 == number_1) && (&self.1 == number_2)\n    }\n\n    // Grab the first number.\n    fn first(&self) -> i32 {\n        self.0\n    }\n\n    // Grab the last number.\n    fn last(&self) -> i32 {\n        self.1\n    }\n}\n\nfn difference<C: Contains>(container: &C) -> i32 {\n    container.last() - container.first()\n}\n\nfn main() {\n    let number_1 = 3;\n    let number_2 = 10;\n\n    let container = Container(number_1, number_2);\n\n    println!(\n        &quot;Does container contain {} and {}: {}&quot;,\n        number_1,\n        number_2,\n        container.contains(&number_1, &number_2)\n    );\n    println!(&quot;First number: {}&quot;, container.first());\n    println!(&quot;Last number: {}&quot;, container.last());\n\n    println!(&quot;The difference is: {}&quot;, difference(&container));\n}`, `54093302613953530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> <span class="token function">Container</span><span class="token punctuation">(</span>i32<span class="token punctuation">,</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 使用关联类型实现重新实现以下特征</span>\n<span class="token keyword">trait</span> Contains <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> A<span class="token punctuation">;</span>\n    <span class="token keyword">type</span> B<span class="token punctuation">;</span>\n    <span class="token keyword">fn</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> _<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span>A<span class="token punctuation">,</span> _<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">::</span>B<span class="token punctuation">)</span> <span class="token punctuation">-></span> bool<span class="token punctuation">;</span>\n    <span class="token keyword">fn</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32<span class="token punctuation">;</span>\n    <span class="token keyword">fn</span> <span class="token function">last</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// trait Contains&lt;A, B> {</span>\n<span class="token comment">//     fn contains(&amp;self, _: &amp;A, _: &amp;B) -> bool;</span>\n<span class="token comment">//     fn first(&amp;self) -> i32;</span>\n<span class="token comment">//     fn last(&amp;self) -> i32;</span>\n<span class="token comment">// }</span>\n\n<span class="token keyword">impl</span> Contains <span class="token keyword">for</span> Container <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> A <span class="token operator">=</span> i32<span class="token punctuation">;</span>\n\n    <span class="token keyword">type</span> B <span class="token operator">=</span> i32<span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> number_1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">,</span> number_2<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> bool <span class="token punctuation">{</span>\n        <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">==</span> number_1<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token operator">==</span> number_2<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// Grab the first number.</span>\n    <span class="token keyword">fn</span> <span class="token function">first</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// Grab the last number.</span>\n    <span class="token keyword">fn</span> <span class="token function">last</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">1</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> difference<span class="token operator">&lt;</span>C<span class="token punctuation">:</span> Contains<span class="token operator">></span><span class="token punctuation">(</span>container<span class="token punctuation">:</span> <span class="token operator">&amp;</span>C<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    container<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> container<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> number_1 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> number_2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> container <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>number_1<span class="token punctuation">,</span> number_2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span>\n        <span class="token string">"Does container contain {} and {}: {}"</span><span class="token punctuation">,</span>\n        number_1<span class="token punctuation">,</span>\n        number_2<span class="token punctuation">,</span>\n        container<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>number_1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>number_2<span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"First number: {}"</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Last number: {}"</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The difference is: {}"</span><span class="token punctuation">,</span> <span class="token function">difference</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>container<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-21"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>当我们使用泛型类型参数时，可以为该泛型参数指定一个具体的默认类型，这样当实现该特征时，如果该默认类型可以使用，那用户再无需手动指定具体的类型。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22953257741739377000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops::Sub;\n\n#[derive(Debug, PartialEq)]\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\n// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用\nimpl __ {\n    type Output = Self;\n\n    fn sub(self, other: Self) -> Self::Output {\n        Point {\n            x: self.x - other.x,\n            y: self.y - other.y,\n        }\n    }\n}\n\nfn main() {\n    assert_eq!(Point { x: 2, y: 3 } - Point { x: 1, y: 0 },\n        Point { x: 1, y: 3 });\n\n    println!(&quot;Success!&quot;)\n}`, `22953257741739377000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>Sub<span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用</span>\n<span class="token keyword">impl</span> __ <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span>Output <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span>\n            x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span>\n            y<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token operator">-</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-154"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-154" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3724481645334454300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops::Sub;\n\n#[derive(Debug, PartialEq)]\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\n// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用\nimpl <T: Sub<Output = T>> Sub<Point<T>> for Point<T> {\n    type Output = Self;\n\n    fn sub(self, other: Self) -> Self::Output {\n        Point {\n            x: self.x - other.x,\n            y: self.y - other.y,\n        }\n    }\n}\n\nfn main() {\n    assert_eq!(Point { x: 2, y: 3 } - Point { x: 1, y: 0 },\n        Point { x: 1, y: 3 });\n\n    println!(&quot;Success!&quot;)\n}`, `3724481645334454300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>Sub<span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用</span>\n<span class="token keyword">impl</span> <span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Sub<span class="token operator">&lt;</span>Output <span class="token operator">=</span> T<span class="token operator">>></span> Sub<span class="token operator">&lt;</span>Point<span class="token operator">&lt;</span>T<span class="token operator">>></span> <span class="token keyword">for</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span>Output <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span>\n            x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span>\n            y<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token operator">-</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2511331043389653000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops::Sub;\n\n#[derive(Debug, PartialEq)]\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\n// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用\nimpl <T: Sub<Output = T>> Sub<Self> for Point<T> {\n    type Output = Self;\n\n    fn sub(self, other: Self) -> Self::Output {\n        Point {\n            x: self.x - other.x,\n            y: self.y - other.y,\n        }\n    }\n}\n\nfn main() {\n    assert_eq!(Point { x: 2, y: 3 } - Point { x: 1, y: 0 },\n        Point { x: 1, y: 3 });\n\n    println!(&quot;Success!&quot;)\n}`, `2511331043389653000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>Sub<span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用</span>\n<span class="token keyword">impl</span> <span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Sub<span class="token operator">&lt;</span>Output <span class="token operator">=</span> T<span class="token operator">>></span> Sub<span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token operator">></span> <span class="token keyword">for</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span>Output <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span>\n            x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span>\n            y<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token operator">-</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93088222261334520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::ops::Sub;\n\n#[derive(Debug, PartialEq)]\nstruct Point<T> {\n    x: T,\n    y: T,\n}\n\n// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用\nimpl <T: Sub<Output = T>> Sub for Point<T> {\n    type Output = Self;\n\n    fn sub(self, other: Self) -> Self::Output {\n        Point {\n            x: self.x - other.x,\n            y: self.y - other.y,\n        }\n    }\n}\n\nfn main() {\n    assert_eq!(Point { x: 2, y: 3 } - Point { x: 1, y: 0 },\n        Point { x: 1, y: 3 });\n\n    println!(&quot;Success!&quot;)\n}`, `93088222261334520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>ops<span class="token punctuation">::</span>Sub<span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>\n<span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 用三种方法填空: 其中两种使用默认的泛型参数，另外一种不使用</span>\n<span class="token keyword">impl</span> <span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Sub<span class="token operator">&lt;</span>Output <span class="token operator">=</span> T<span class="token operator">>></span> Sub <span class="token keyword">for</span> Point<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">type</span> Output <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span><span class="token punctuation">::</span>Output <span class="token punctuation">{</span>\n        Point <span class="token punctuation">{</span>\n            x<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">-</span> other<span class="token punctuation">.</span>x<span class="token punctuation">,</span>\n            y<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">-</span> other<span class="token punctuation">.</span>y<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token operator">-</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-21"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>在 Rust 中，两个不同特征的方法完全可以同名，且你可以为同一个类型同时实现这两个特征。这种情况下，就出现了一个问题：该如何调用这两个特征上定义的同名方法。为了解决这个问题，我们需要使用完全限定语法(Fully Qualified Syntax)。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87165653431943020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait UsernameWidget {\n    fn get(&self) -> String;\n}\n\ntrait AgeWidget {\n    fn get(&self) -> u8;\n}\n\nstruct Form {\n    username: String,\n    age: u8,\n}\n\nimpl UsernameWidget for Form {\n    fn get(&self) -> String {\n        self.username.clone()\n    }\n}\n\nimpl AgeWidget for Form {\n    fn get(&self) -> u8 {\n        self.age\n    }\n}\n\nfn main() {\n    let form = Form{\n        username: &quot;rustacean&quot;.to_owned(),\n        age: 28,\n    };\n\n    // 如果你反注释下面一行代码，将看到一个错误: Fully Qualified Syntax\n    // 毕竟，这里有好几个同名的 \\`get\\` 方法\n    //\n    // println!(&quot;{}&quot;, form.get());\n\n    let username = UsernameWidget::get(&form);\n    assert_eq!(&quot;rustacean&quot;.to_owned(), username);\n    let age = AgeWidget::get(&form); // 你还可以使用以下语法 \\`<Form as AgeWidget>::get\\`\n    assert_eq!(28, age);\n\n    println!(&quot;Success!&quot;)\n}`, `87165653431943020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> UsernameWidget <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> AgeWidget <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u8<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Form <span class="token punctuation">{</span>\n    username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> UsernameWidget <span class="token keyword">for</span> Form <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>username<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> AgeWidget <span class="token keyword">for</span> Form <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u8 <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>age\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> form <span class="token operator">=</span> Form<span class="token punctuation">{</span>\n        username<span class="token punctuation">:</span> <span class="token string">"rustacean"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        age<span class="token punctuation">:</span> <span class="token number">28</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 如果你反注释下面一行代码，将看到一个错误: Fully Qualified Syntax</span>\n    <span class="token comment">// 毕竟，这里有好几个同名的 `get` 方法</span>\n    <span class="token comment">//</span>\n    <span class="token comment">// println!("{}", form.get());</span>\n\n    <span class="token keyword">let</span> username <span class="token operator">=</span> UsernameWidget<span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"rustacean"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> age <span class="token operator">=</span> AgeWidget<span class="token punctuation">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 你还可以使用以下语法 `&lt;Form as AgeWidget>::get`</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83767925297986370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Pilot {\n    fn fly(&self) -> String;\n}\n\ntrait Wizard {\n    fn fly(&self) -> String;\n}\n\nstruct Human;\n\nimpl Pilot for Human {\n    fn fly(&self) -> String {\n        String::from(&quot;This is your captain speaking.&quot;)\n    }\n}\n\nimpl Wizard for Human {\n    fn fly(&self) -> String {\n        String::from(&quot;Up!&quot;)\n    }\n}\n\nimpl Human {\n    fn fly(&self) -> String {\n        String::from(&quot;*waving arms furiously*&quot;)\n    }\n}\n\nfn main() {\n    let person = Human;\n\n    assert_eq!(__, &quot;This is your captain speaking.&quot;);\n    assert_eq!(__, &quot;Up!&quot;);\n\n    assert_eq!(__, &quot;*waving arms furiously*&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `83767925297986370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Pilot <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> Wizard <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Human<span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> Pilot <span class="token keyword">for</span> Human <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"This is your captain speaking."</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Wizard <span class="token keyword">for</span> Human <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Up!"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Human <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"*waving arms furiously*"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> person <span class="token operator">=</span> Human<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> <span class="token string">"This is your captain speaking."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> <span class="token string">"Up!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> <span class="token string">"*waving arms furiously*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-155"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-155" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79396834265457480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Pilot {\n    fn fly(&self) -> String;\n}\n\ntrait Wizard {\n    fn fly(&self) -> String;\n}\n\nstruct Human;\n\nimpl Pilot for Human {\n    fn fly(&self) -> String {\n        String::from(&quot;This is your captain speaking.&quot;)\n    }\n}\n\nimpl Wizard for Human {\n    fn fly(&self) -> String {\n        String::from(&quot;Up!&quot;)\n    }\n}\n\nimpl Human {\n    fn fly(&self) -> String {\n        String::from(&quot;*waving arms furiously*&quot;)\n    }\n}\n\nfn main() {\n    let person = Human;\n\n    assert_eq!(Pilot::fly(&person), &quot;This is your captain speaking.&quot;);\n    assert_eq!(Wizard::fly(&person), &quot;Up!&quot;);\n\n    assert_eq!(person.fly(), &quot;*waving arms furiously*&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `79396834265457480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Pilot <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> Wizard <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Human<span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> Pilot <span class="token keyword">for</span> Human <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"This is your captain speaking."</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Wizard <span class="token keyword">for</span> Human <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Up!"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Human <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"*waving arms furiously*"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> person <span class="token operator">=</span> Human<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Pilot<span class="token punctuation">::</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>person<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"This is your captain speaking."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>Wizard<span class="token punctuation">::</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>person<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Up!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">fly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"*waving arms furiously*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-20"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>有些时候我们希望在特征上实现类似继承的特性，例如让一个特征 A 使用另一个特征 B 的功能。这种情况下，一个类型要实现特征 A 首先要实现特征 B， 特征 B 就被称为 supertrait</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68872782628232420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Person {\n    fn name(&self) -> String;\n}\n\n// Person 是 Student 的 supertrait .\n// 实现 Student 需要同时实现 Person.\ntrait Student: Person {\n    fn university(&self) -> String;\n}\n\ntrait Programmer {\n    fn fav_language(&self) -> String;\n}\n\n// CompSciStudent (computer science student) 是 Programmer\n// 和 Student 的 subtrait. 实现 CompSciStudent 需要先实现这两个 supertraits.\ntrait CompSciStudent: Programmer + Student {\n    fn git_username(&self) -> String;\n}\n\nfn comp_sci_student_greeting(student: &dyn CompSciStudent) -> String {\n    format!(\n        &quot;My name is {} and I attend {}. My favorite language is {}. My Git username is {}&quot;,\n        student.name(),\n        student.university(),\n        student.fav_language(),\n        student.git_username()\n    )\n}\n\nstruct CSStudent {\n    name: String,\n    university: String,\n    fav_language: String,\n    git_username: String\n}\n\n// 为 CSStudent 实现所需的特征\nimpl ...\n\nfn main() {\n    let student = CSStudent {\n        name: &quot;Sunfei&quot;.to_string(),\n        university: &quot;XXX&quot;.to_string(),\n        fav_language: &quot;Rust&quot;.to_string(),\n        git_username: &quot;sunface&quot;.to_string()\n    };\n\n    // 填空\n    println!(&quot;{}&quot;, comp_sci_student_greeting(__));\n}`, `68872782628232420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Person <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Person 是 Student 的 supertrait .</span>\n<span class="token comment">// 实现 Student 需要同时实现 Person.</span>\n<span class="token keyword">trait</span> Student<span class="token punctuation">:</span> Person <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">university</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> Programmer <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fav_language</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// CompSciStudent (computer science student) 是 Programmer</span>\n<span class="token comment">// 和 Student 的 subtrait. 实现 CompSciStudent 需要先实现这两个 supertraits.</span>\n<span class="token keyword">trait</span> CompSciStudent<span class="token punctuation">:</span> Programmer <span class="token operator">+</span> Student <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">git_username</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">comp_sci_student_greeting</span><span class="token punctuation">(</span>student<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> CompSciStudent<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span>\n        <span class="token string">"My name is {} and I attend {}. My favorite language is {}. My Git username is {}"</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">university</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">fav_language</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">git_username</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> CSStudent <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    university<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    fav_language<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    git_username<span class="token punctuation">:</span> String\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 为 CSStudent 实现所需的特征</span>\n<span class="token keyword">impl</span> <span class="token punctuation">...</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> student <span class="token operator">=</span> CSStudent <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> <span class="token string">"Sunfei"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        university<span class="token punctuation">:</span> <span class="token string">"XXX"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        fav_language<span class="token punctuation">:</span> <span class="token string">"Rust"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        git_username<span class="token punctuation">:</span> <span class="token string">"sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">comp_sci_student_greeting</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-156"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-156" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89161622362230000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait Person {\n    fn name(&self) -> String;\n}\n\n// Person 是 Student 的 supertrait\n// 实现 Student 需要同时实现 Person\ntrait Student: Person {\n    fn university(&self) -> String;\n}\n\ntrait Programmer {\n    fn fav_language(&self) -> String;\n}\n\n// CompSciStudent (computer science student) 是 Programmer\n// 和 Student 的 subtrait 实现 CompSciStudent 需要先实现这两个 supertraits\ntrait CompSciStudent: Programmer + Student {\n    fn git_username(&self) -> String;\n}\n\nfn comp_sci_student_greeting(student: &dyn CompSciStudent) -> String {\n    format!(\n        &quot;My name is {} and I attend {}. My favorite language is {}. My Git username is {}&quot;,\n        student.name(),\n        student.university(),\n        student.fav_language(),\n        student.git_username()\n    )\n}\n\nstruct CSStudent {\n    name: String,\n    university: String,\n    fav_language: String,\n    git_username: String,\n}\n\nimpl Person for CSStudent {\n    fn name(&self) -> String {\n        self.name.clone()\n    }\n}\n\nimpl Student for CSStudent {\n    fn university(&self) -> String {\n        self.university.clone()\n    }\n}\n\nimpl Programmer for CSStudent {\n    fn fav_language(&self) -> String {\n        self.fav_language.clone()\n    }\n}\n\n// 为 CSStudent 实现所需的特征\nimpl CompSciStudent for CSStudent {\n    fn git_username(&self) -> String {\n        self.git_username.clone()\n    }\n}\n\nfn main() {\n    let student = CSStudent {\n        name: &quot;Sunfei&quot;.to_string(),\n        university: &quot;XXX&quot;.to_string(),\n        fav_language: &quot;Rust&quot;.to_string(),\n        git_username: &quot;sunface&quot;.to_string(),\n    };\n\n    // 填空\n    println!(&quot;{}&quot;, comp_sci_student_greeting(&student));\n}`, `89161622362230000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> Person <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Person 是 Student 的 supertrait</span>\n<span class="token comment">// 实现 Student 需要同时实现 Person</span>\n<span class="token keyword">trait</span> Student<span class="token punctuation">:</span> Person <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">university</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">trait</span> Programmer <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fav_language</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// CompSciStudent (computer science student) 是 Programmer</span>\n<span class="token comment">// 和 Student 的 subtrait 实现 CompSciStudent 需要先实现这两个 supertraits</span>\n<span class="token keyword">trait</span> CompSciStudent<span class="token punctuation">:</span> Programmer <span class="token operator">+</span> Student <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">git_username</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">comp_sci_student_greeting</span><span class="token punctuation">(</span>student<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> CompSciStudent<span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    <span class="token function">format!</span><span class="token punctuation">(</span>\n        <span class="token string">"My name is {} and I attend {}. My favorite language is {}. My Git username is {}"</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">university</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">fav_language</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        student<span class="token punctuation">.</span><span class="token function">git_username</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> CSStudent <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    university<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    fav_language<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    git_username<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Person <span class="token keyword">for</span> CSStudent <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Student <span class="token keyword">for</span> CSStudent <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">university</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>university<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Programmer <span class="token keyword">for</span> CSStudent <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fav_language</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>fav_language<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 为 CSStudent 实现所需的特征</span>\n<span class="token keyword">impl</span> CompSciStudent <span class="token keyword">for</span> CSStudent <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">git_username</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>git_username<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> student <span class="token operator">=</span> CSStudent <span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> <span class="token string">"Sunfei"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        university<span class="token punctuation">:</span> <span class="token string">"XXX"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        fav_language<span class="token punctuation">:</span> <span class="token string">"Rust"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        git_username<span class="token punctuation">:</span> <span class="token string">"sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 填空</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">comp_sci_student_greeting</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-20"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>关于孤儿原则的详细介绍请参见 <a href="https://course.rs/basic/trait/trait#%E7%89%B9%E5%BE%81%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%BD%8D%E7%BD%AE%E5%AD%A4%E5%84%BF%E8%A7%84%E5%88%99" target="_blank" rel="nofollow noreferrer noopener">特征定义与实现的位置孤儿规则</a> 和 <a href="https://course.rs/basic/trait/advance-trait.html#%E5%9C%A8%E5%A4%96%E9%83%A8%E7%B1%BB%E5%9E%8B%E4%B8%8A%E5%AE%9E%E7%8E%B0%E5%A4%96%E9%83%A8%E7%89%B9%E5%BE%81newtype" target="_blank" rel="nofollow noreferrer noopener">在外部类型上实现外部特征</a>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94783600919837280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fmt;\n\n// 定义一个 newtype \\`Pretty\\`\n\n\nimpl fmt::Display for Pretty {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        write!(f, &quot;\\&quot;{}\\&quot;&quot;, self.0.clone() + &quot;, world&quot;)\n    }\n}\n\nfn main() {\n    let w = Pretty(&quot;hello&quot;.to_string());\n    println!(&quot;w = {}&quot;, w);\n}`, `94783600919837280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">;</span>\n\n<span class="token comment">// 定义一个 newtype `Pretty`</span>\n\n\n<span class="token keyword">impl</span> fmt<span class="token punctuation">::</span>Display <span class="token keyword">for</span> Pretty <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fmt<span class="token punctuation">::</span>Formatter<span class="token punctuation">)</span> <span class="token punctuation">-></span> fmt<span class="token punctuation">::</span>Result <span class="token punctuation">{</span>\n        <span class="token function">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"\\"{}\\""</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", world"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token function">Pretty</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"w = {}"</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-157"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-157" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48755951969948910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fmt;\n\n// 定义一个 newtype \\`Pretty\\`\n\nstruct Pretty(String);\n\nimpl fmt::Display for Pretty {\n    fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {\n        write!(f, &quot;\\&quot;{}\\&quot;&quot;, self.0.clone() + &quot;, world&quot;)\n    }\n}\n\nfn main() {\n    let w = Pretty(&quot;hello&quot;.to_string());\n    println!(&quot;w = {}&quot;, w);\n}`, `48755951969948910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">;</span>\n\n<span class="token comment">// 定义一个 newtype `Pretty`</span>\n\n<span class="token keyword">struct</span> <span class="token function">Pretty</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> fmt<span class="token punctuation">::</span>Display <span class="token keyword">for</span> Pretty <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> fmt<span class="token punctuation">::</span>Formatter<span class="token punctuation">)</span> <span class="token punctuation">-></span> fmt<span class="token punctuation">::</span>Result <span class="token punctuation">{</span>\n        <span class="token function">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"\\"{}\\""</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", world"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> w <span class="token operator">=</span> <span class="token function">Pretty</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"w = {}"</span><span class="token punctuation">,</span> w<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="集合类型"><a href="#%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>集合类型</h1>\n<h2 id="动态字符串-string"><a href="#%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2-string" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动态字符串 String</h2>\n<h3 id="问题一-22"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>std::string::String 是 UTF-8 编码、可增长的动态字符串，它也是我们日常开发中最常用的字符串类型，同时对于它所拥有的内容拥有所有权</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45767677699976225000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\n// 1. 不要使用 \\`to_string()\\`\n// 2. 不要添加/删除任何代码行\nfn main() {\n    let mut s: String = &quot;hello, &quot;;\n    s.push_str(&quot;world&quot;.to_string());\n    s.push(__);\n\n    move_ownership(s);\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn move_ownership(s: String) {\n    println!(&quot;ownership of \\&quot;{}\\&quot; is moved here!&quot;, s)\n}`, `45767677699976225000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token comment">// 1. 不要使用 `to_string()`</span>\n<span class="token comment">// 2. 不要添加/删除任何代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s<span class="token punctuation">:</span> String <span class="token operator">=</span> <span class="token string">"hello, "</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">move_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">move_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"ownership of \\"{}\\" is moved here!"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-158"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-158" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3165983300657671000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\n// 1. 不要使用 \\`to_string()\\`\n// 2. 不要添加/删除任何代码行\nfn main() {\n    let mut s: String = String::from(&quot;hello, &quot;);\n    s.push_str(&&quot;world&quot;.to_string());\n    s.push(\'!\');\n\n    move_ownership(&s);\n\n    assert_eq!(s, &quot;hello, world!&quot;);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn move_ownership(s: &str) {\n    println!(&quot;ownership of \\&quot;{}\\&quot; is moved here!&quot;, s)\n}`, `3165983300657671000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token comment">// 1. 不要使用 `to_string()`</span>\n<span class="token comment">// 2. 不要添加/删除任何代码行</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s<span class="token punctuation">:</span> String <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">"world"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">move_ownership</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">move_ownership</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"ownership of \\"{}\\" is moved here!"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-22"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>虽然 String 的底层是 <code class="language-text">Vec&lt;u8&gt;</code> 也就是字节数组的形式存储的，但是它是基于 UTF-8 编码的字符序列。String 分配在堆上、可增长且不是以 null 结尾</p>\n<p>而 &#x26;str 是切片引用类型 <code class="language-text">&amp;[u8]</code>，指向一个合法的 UTF-8 字符序列，总之 &#x26;str 和 String 的关系类似于 <code class="language-text">&amp;[T]</code> 和 <code class="language-text">Vec&lt;T&gt;</code> 。</p>\n<p>参考：<a href="https://course.rs/difficulties/string.html" target="_blank" rel="nofollow noreferrer noopener">易混淆概念解析 - &#x26;str 和 String</a>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55242239797566700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n   let mut s = String::from(&quot;hello, world&quot;);\n\n   let slice1: &str = __; // 使用两种方法\n   assert_eq!(slice1, &quot;hello, world&quot;);\n\n   let slice2 = __;\n   assert_eq!(slice2, &quot;hello&quot;);\n\n   let slice3: __ = __;\n   slice3.push(\'!\');\n   assert_eq!(slice3, &quot;hello, world!&quot;);\n\n   println!(&quot;Success!&quot;)\n}`, `55242239797566700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> slice1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> __<span class="token punctuation">;</span> <span class="token comment">// 使用两种方法</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> <span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> slice2 <span class="token operator">=</span> __<span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice2<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> slice3<span class="token punctuation">:</span> __ <span class="token operator">=</span> __<span class="token punctuation">;</span>\n   slice3<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice3<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-159"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-159" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79679540201352300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut s = String::from(&quot;hello, world&quot;);\n\n    let slice1: &str = &s; // 使用两种方法\n    assert_eq!(slice1, &quot;hello, world&quot;);\n\n    let slice2 = &s[0..5];\n    assert_eq!(slice2, &quot;hello&quot;);\n\n    let mut slice3: String = s;\n    slice3.push(\'!\');\n    assert_eq!(slice3, &quot;hello, world!&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `79679540201352300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice1<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span> <span class="token comment">// 使用两种方法</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> <span class="token string">"hello, world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice2<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> slice3<span class="token punctuation">:</span> String <span class="token operator">=</span> s<span class="token punctuation">;</span>\n    slice3<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char string">\'!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice3<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-22"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61916928044971000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 问题:  我们的代码中发生了多少次堆内存分配？\n// 你的回答:\nfn main() {\n    // 基于 \\`&str\\` 类型创建一个 String,\n    // 字符串字面量的类型是 \\`&str\\`\n   let s: String = String::from(&quot;hello, world!&quot;);\n\n   // 创建一个切片引用指向 String \\`s\\`\n   let slice: &str = &s;\n\n   // 基于刚创建的切片来创建一个 String\n   let s: String = slice.to_string();\n\n   assert_eq!(s, &quot;hello, world!&quot;);\n\n   println!(&quot;Success!&quot;)\n}`, `61916928044971000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 问题:  我们的代码中发生了多少次堆内存分配？</span>\n<span class="token comment">// 你的回答:</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 基于 `&amp;str` 类型创建一个 String,</span>\n    <span class="token comment">// 字符串字面量的类型是 `&amp;str`</span>\n   <span class="token keyword">let</span> s<span class="token punctuation">:</span> String <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 创建一个切片引用指向 String `s`</span>\n   <span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n\n   <span class="token comment">// 基于刚创建的切片来创建一个 String</span>\n   <span class="token keyword">let</span> s<span class="token punctuation">:</span> String <span class="token operator">=</span> slice<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-160"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-160" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46346981770383340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 问题:  我们的代码中发生了多少次堆内存分配？\n// 你的回答: 2\nfn main() {\n    // 基于 \\`&str\\` 类型创建一个 String,\n    // 字符串字面量的类型是 \\`&str\\`\n   let s: String = String::from(&quot;hello, world!&quot;);\n\n   // 创建一个切片引用指向 String \\`s\\`\n   let slice: &str = &s;\n\n   // 基于刚创建的切片来创建一个 String\n   let s: String = slice.to_string();\n\n   assert_eq!(s, &quot;hello, world!&quot;);\n\n   println!(&quot;Success!&quot;)\n}`, `46346981770383340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 问题:  我们的代码中发生了多少次堆内存分配？</span>\n<span class="token comment">// 你的回答: 2</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 基于 `&amp;str` 类型创建一个 String,</span>\n    <span class="token comment">// 字符串字面量的类型是 `&amp;str`</span>\n   <span class="token keyword">let</span> s<span class="token punctuation">:</span> String <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 创建一个切片引用指向 String `s`</span>\n   <span class="token keyword">let</span> slice<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n\n   <span class="token comment">// 基于刚创建的切片来创建一个 String</span>\n   <span class="token keyword">let</span> s<span class="token punctuation">:</span> String <span class="token operator">=</span> slice<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"hello, world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-21"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>由于 String 都是 UTF-8 编码的，这会带来几个影响:</p>\n<ul>\n<li>如果你需要的是非 UTF-8 字符串，可以考虑 <a href="https://doc.rust-lang.org/stable/std/ffi/struct.OsString.html" target="_blank" rel="nofollow noreferrer noopener">OsString</a></li>\n<li>无法通过索引的方式访问一个 String</li>\n</ul>\n<p>具体请看 <a href="https://course.rs/basic/compound-type/string-slice.html#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B4%A2%E5%BC%95" target="_blank" rel="nofollow noreferrer noopener">字符串索引</a></p>\n<p>我们无法通过索引的方式访问字符串中的某个字符，但是可以通过切片的方式来获取字符串的某一部分 <code class="language-text">&amp;s1[start..end]</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36225021168904380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nfn main() {\n    let s = String::from(&quot;hello, 世界&quot;);\n    let slice1 = s[0]; //提示: \\`h\\` 在 UTF-8 编码中只占用 1 个字节\n    assert_eq!(slice1, &quot;h&quot;);\n\n    let slice2 = &s[3..5];// 提示: \\`中\\` 在 UTF-8 编码中占用 3 个字节\n    assert_eq!(slice2, &quot;世&quot;);\n\n    // 迭代 s 中的所有字符\n    for (i, c) in s.__ {\n        if i == 7 {\n            assert_eq!(c, \'世\')\n        }\n    }\n\n    println!(&quot;Success!&quot;)\n}`, `36225021168904380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, 世界"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//提示: `h` 在 UTF-8 编码中只占用 1 个字节</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> <span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 提示: `中` 在 UTF-8 编码中占用 3 个字节</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice2<span class="token punctuation">,</span> <span class="token string">"世"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 迭代 s 中的所有字符</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span>__ <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">7</span> <span class="token punctuation">{</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token char string">\'世\'</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-161"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-161" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50155879401214260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nfn main() {\n    let s = String::from(&quot;hello, 世界&quot;);\n    let slice1 = &s[0..1]; //提示: \\`h\\` 在 UTF-8 编码中只占用 1 个字节\n    assert_eq!(slice1, &quot;h&quot;);\n\n    let slice2 = &s[7..10]; // 提示: \\`中\\` 在 UTF-8 编码中占用 3 个字节\n    assert_eq!(slice2, &quot;世&quot;);\n\n    // 迭代 s 中的所有字符\n    for (i, c) in s.chars().enumerate() {\n        if i == 7 {\n            assert_eq!(c, \'世\')\n        }\n    }\n\n    println!(&quot;Success!&quot;)\n}`, `50155879401214260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello, 世界"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//提示: `h` 在 UTF-8 编码中只占用 1 个字节</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> <span class="token string">"h"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 提示: `中` 在 UTF-8 编码中占用 3 个字节</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice2<span class="token punctuation">,</span> <span class="token string">"世"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 迭代 s 中的所有字符</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> s<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">7</span> <span class="token punctuation">{</span>\n            <span class="token function">assert_eq!</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token char string">\'世\'</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-21"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>我们可以使用 <a href="https://docs.rs/utf8_slice/1.0.0/utf8_slice/fn.slice.html" target="_blank" rel="nofollow noreferrer noopener">utf8_slice</a> 来按照字符的自然索引方式对 UTF-8 字符串进行切片访问，与之前的切片方式相比，它索引的是字符，而之前的方式索引的是字节</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81868918980720280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use utf8_slice;\nfn main() {\n   let s = &quot;The 🚀 goes to the 🌑!&quot;;\n\n   let rocket = utf8_slice::slice(s, 4, 5);\n   // Will equal &quot;🚀&quot;\n}`, `81868918980720280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> utf8_slice<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"The 🚀 goes to the 🌑!"</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> rocket <span class="token operator">=</span> utf8_slice<span class="token punctuation">::</span><span class="token function">slice</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// Will equal "🚀"</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19773245174651400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 提示: 也许你需要使用 from_utf8 方法\n// 填空\nfn main() {\n    let mut s = String::new();\n    __;\n\n    let v = vec![104, 101, 108, 108, 111];\n\n    // 将字节数组转换成 String\n    let s1 = __;\n\n\n    assert_eq!(s, s1);\n\n    println!(&quot;Success!&quot;)\n}`, `19773245174651400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 提示: 也许你需要使用 from_utf8 方法</span>\n<span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    __<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 将字节数组转换成 String</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> __<span class="token punctuation">;</span>\n\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-162"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-162" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41699450297013920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 提示: 也许你需要使用 from_utf8 方法\n// 填空\nfn main() {\n    let mut s = String::new();\n    s.push_str(&quot;hello&quot;);\n\n    let v = vec![104, 101, 108, 108, 111];\n\n    // 将字节数组转换成 String\n    let s1 = String::from_utf8(v).unwrap();\n\n    assert_eq!(s, s1);\n\n    println!(&quot;Success!&quot;)\n}`, `41699450297013920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 提示: 也许你需要使用 from_utf8 方法</span>\n<span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">104</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 将字节数组转换成 String</span>\n    <span class="token keyword">let</span> s1 <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-18"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>事实上 String 是一个智能指针，它作为一个结构体存储在栈上，然后指向存储在堆上的字符串底层数据</p>\n<p>存储在栈上的智能指针结构体由三部分组成：一个指针只指向堆上的字节数组，已使用的长度以及已分配的容量 capacity (已使用的长度小于等于已分配的容量，当容量不够时，会重新分配内存空间)</p>\n<p>如果 String 的当前容量足够，那么添加字符将不会导致新的内存分配</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78190023306750460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改下面的代码以打印如下内容:\n// 25\n// 25\n// 25\n// 循环中不会发生任何内存分配\nfn main() {\n    let mut s = String::new();\n\n    println!(&quot;{}&quot;, s.capacity());\n\n    for _ in 0..2 {\n        s.push_str(&quot;hello&quot;);\n        println!(&quot;{}&quot;, s.capacity());\n    }\n\n    println!(&quot;Success!&quot;)\n}`, `78190023306750460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改下面的代码以打印如下内容:</span>\n<span class="token comment">// 25</span>\n<span class="token comment">// 25</span>\n<span class="token comment">// 25</span>\n<span class="token comment">// 循环中不会发生任何内存分配</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-163"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-163" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60591319165499450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修改下面的代码以打印如下内容:\n// 25\n// 25\n// 25\n// 循环中不会发生任何内存分配\nfn main() {\n    let mut s = String::with_capacity(25);\n\n    println!(&quot;{}&quot;, s.capacity());\n\n    for _ in 0..2 {\n        s.push_str(&quot;hello&quot;);\n        println!(&quot;{}&quot;, s.capacity());\n    }\n\n    println!(&quot;Success!&quot;)\n}`, `60591319165499450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修改下面的代码以打印如下内容:</span>\n<span class="token comment">// 25</span>\n<span class="token comment">// 25</span>\n<span class="token comment">// 25</span>\n<span class="token comment">// 循环中不会发生任何内存分配</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span> <span class="token punctuation">{</span>\n        s<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-10"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22264608555966348"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::mem;\n\nfn main() {\n    let story = String::from(&quot;Rust By Practice&quot;);\n\n    // 阻止 String 的数据被自动 drop\n    let mut story = mem::ManuallyDrop::new(story);\n\n    let ptr = story.__();\n    let len = story.__();\n    let capacity = story.__();\n\n    assert_eq!(16, len);\n\n    // 我们可以基于 ptr 指针、长度和容量来重新构建 String.\n    // 这种操作必须标记为 unsafe，因为我们需要自己来确保这里的操作是安全的\n    let s = unsafe { String::from_raw_parts(ptr, len, capacity) };\n\n    assert_eq!(*story, s);\n\n    println!(&quot;Success!&quot;)\n}`, `22264608555966348`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> story <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Rust By Practice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 阻止 String 的数据被自动 drop</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> story <span class="token operator">=</span> mem<span class="token punctuation">::</span>ManuallyDrop<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>story<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ptr <span class="token operator">=</span> story<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> len <span class="token operator">=</span> story<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> capacity <span class="token operator">=</span> story<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 我们可以基于 ptr 指针、长度和容量来重新构建 String.</span>\n    <span class="token comment">// 这种操作必须标记为 unsafe，因为我们需要自己来确保这里的操作是安全的</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> String<span class="token punctuation">::</span><span class="token function">from_raw_parts</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> len<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>story<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-164"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-164" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54876695122735430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::mem;\n\nfn main() {\n    let story = String::from(&quot;Rust By Practice&quot;);\n\n    // 阻止 String 的数据被自动 drop\n    let mut story = mem::ManuallyDrop::new(story);\n\n    let ptr = story.as_mut_ptr();\n    let len = story.len();\n    let capacity = story.capacity();\n\n    assert_eq!(16, len);\n\n    // 我们可以基于 ptr 指针、长度和容量来重新构建 String.\n    // 这种操作必须标记为 unsafe，因为我们需要自己来确保这里的操作是安全的\n    let s = unsafe { String::from_raw_parts(ptr, len, capacity) };\n\n    assert_eq!(*story, s);\n\n    println!(&quot;Success!&quot;)\n}`, `54876695122735430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>mem<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> story <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Rust By Practice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 阻止 String 的数据被自动 drop</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> story <span class="token operator">=</span> mem<span class="token punctuation">::</span>ManuallyDrop<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>story<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> ptr <span class="token operator">=</span> story<span class="token punctuation">.</span><span class="token function">as_mut_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> len <span class="token operator">=</span> story<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> capacity <span class="token operator">=</span> story<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 我们可以基于 ptr 指针、长度和容量来重新构建 String.</span>\n    <span class="token comment">// 这种操作必须标记为 unsafe，因为我们需要自己来确保这里的操作是安全的</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">{</span> String<span class="token punctuation">::</span><span class="token function">from_raw_parts</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> len<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>story<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="动态数组-vector"><a href="#%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84-vector" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动态数组 Vector</h2>\n<p>相比 <code class="language-text">[T; N]</code> 形式的数组，Vector 最大的特点就是可以动态调整长度</p>\n<h3 id="问题一-23"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83537265135214150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [u8; 3] = [1, 2, 3];\n\n    let v = Vec::from(arr);\n    is_vec(v);\n\n    let v = vec![1, 2, 3];\n    is_vec(v);\n\n    // vec!(..) 和 vec![..] 是同样的宏，宏可以使用 []、()、{}三种形式，因此...\n    let v = vec!(1, 2, 3);\n    is_vec(v);\n\n    // ...在下面的代码中, v 是 Vec<[u8; 3]> , 而不是 Vec<u8>\n    // 使用 Vec::new 和 \\`for\\` 来重写下面这段代码\n    let v1 = vec!(arr);\n    is_vec(v1);\n\n    assert_eq!(v, v1);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn is_vec(v: Vec<u8>) {}`, `83537265135214150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>u8<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// vec!(..) 和 vec![..] 是同样的宏，宏可以使用 []、()、{}三种形式，因此...</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...在下面的代码中, v 是 Vec&lt;[u8; 3]> , 而不是 Vec&lt;u8></span>\n    <span class="token comment">// 使用 Vec::new 和 `for` 来重写下面这段代码</span>\n    <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">is_vec</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-165"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-165" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90645654535576780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let arr: [u8; 3] = [1, 2, 3];\n\n    let v = Vec::from(arr);\n    is_vec(&v);\n\n    let v = vec![1, 2, 3];\n    is_vec(&v);\n\n    // vec!(..) 和 vec![..] 是同样的宏，宏可以使用 []、()、{}三种形式，因此...\n    let v = vec!(1, 2, 3);\n    is_vec(&v);\n\n    // vec!(..) 和 vec![..] 是同样的宏，宏可以使用 []、()、{}三种形式，因此...\n    let v = vec!{1, 2, 3};\n    is_vec(&v);\n\n    // ...在下面的代码中, v 是 Vec<[u8; 3]> , 而不是 Vec<u8>\n    // 使用 Vec::new 和 \\`for\\` 来重写下面这段代码\n    let mut v1 = Vec::new();\n    for i in &v {\n        v1.push(*i)\n    }\n    is_vec(&v1);\n\n    assert_eq!(v, v1);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn is_vec(v: &Vec<u8>) {}`, `90645654535576780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span>u8<span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// vec!(..) 和 vec![..] 是同样的宏，宏可以使用 []、()、{}三种形式，因此...</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// vec!(..) 和 vec![..] 是同样的宏，宏可以使用 []、()、{}三种形式，因此...</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro-rules function">vec!</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...在下面的代码中, v 是 Vec&lt;[u8; 3]> , 而不是 Vec&lt;u8></span>\n    <span class="token comment">// 使用 Vec::new 和 `for` 来重写下面这段代码</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v1 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">&amp;</span>v <span class="token punctuation">{</span>\n        v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">*</span>i<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">is_vec</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">is_vec</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-23"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>Vec 可以使用 extend 方法进行扩展</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17513455603921213000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut v1 = Vec::from([1, 2, 4]);\n    v1.pop();\n    v1.push(3);\n\n    let mut v2 = Vec::new();\n    v2.__;\n\n    assert_eq!(v1, v2);\n\n    println!(&quot;Success!&quot;)\n}`, `17513455603921213000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v1 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    v1<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v2 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    v2<span class="token punctuation">.</span>__<span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-166"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-166" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32977665234964926000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    let mut v1 = Vec::from([1, 2, 4]);\n    v1.pop();\n    v1.push(3);\n\n    let mut v2 = Vec::new();\n    v2.extend(&v1);\n\n    assert_eq!(v1, v2);\n\n    println!(&quot;Success!&quot;)\n}`, `32977665234964926000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v1 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    v1<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v2 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    v2<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-23"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>只要为 Vec 实现了 <code class="language-text">From&lt;T&gt;</code> 特征，那么 T 就可以被转换成 Vec。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14038741432214596000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n   // array -> Vec\n   // impl From<[T; N]> for Vec\n   let arr = [1, 2, 3];\n   let v1 = __(arr);\n   let v2: Vec<i32> = arr.__();\n\n   assert_eq!(v1, v2);\n\n\n   // String -> Vec\n   // impl From<String> for Vec\n   let s = &quot;hello&quot;.to_string();\n   let v1: Vec<u8> = s.__();\n\n   let s = &quot;hello&quot;.to_string();\n   let v2 = s.into_bytes();\n   assert_eq!(v1, v2);\n\n   // impl<\'_> From<&\'_ str> for Vec\n   let s = &quot;hello&quot;;\n   let v3 = Vec::__(s);\n   assert_eq!(v2, v3);\n\n   // 迭代器 Iterators 可以通过 collect 变成 Vec\n   let v4: Vec<i32> = [0; 10].into_iter().collect();\n   assert_eq!(v4, vec![0; 10]);\n\n   println!(&quot;Success!&quot;)\n}`, `14038741432214596000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// array -> Vec</span>\n   <span class="token comment">// impl From&lt;[T; N]> for Vec</span>\n   <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token function">__</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> v2<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n   <span class="token comment">// String -> Vec</span>\n   <span class="token comment">// impl From&lt;String> for Vec</span>\n   <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> v1<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> v2 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">into_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// impl&lt;\'_> From&lt;&amp;\'_ str> for Vec</span>\n   <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> v3 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">__</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 迭代器 Iterators 可以通过 collect 变成 Vec</span>\n   <span class="token keyword">let</span> v4<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v4<span class="token punctuation">,</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-167"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-167" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89216766610270140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn main() {\n    // array -> Vec\n    // impl From<[T; N]> for Vec\n    let arr = [1, 2, 3];\n    let v1 = Vec::from(arr);\n    let v2: Vec<i32> = arr.into();\n\n    assert_eq!(v1, v2);\n\n    // String -> Vec\n    // impl From<String> for Vec\n    let s = &quot;hello&quot;.to_string();\n    let v1: Vec<u8> = s.into();\n\n    let s = &quot;hello&quot;.to_string();\n    let v2 = s.into_bytes();\n    assert_eq!(v1, v2);\n\n    // impl<\'_> From<&\'_ str> for Vec\n    let s = &quot;hello&quot;;\n    let v3 = Vec::from(s);\n    assert_eq!(v2, v3);\n\n    // 迭代器 Iterators 可以通过 collect 变成 Vec\n    let v4: Vec<i32> = [0; 10].into_iter().collect();\n    assert_eq!(v4, vec![0; 10]);\n\n    println!(&quot;Success!&quot;)\n}`, `89216766610270140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// array -> Vec</span>\n    <span class="token comment">// impl From&lt;[T; N]> for Vec</span>\n    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v1 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v2<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// String -> Vec</span>\n    <span class="token comment">// impl From&lt;String> for Vec</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v1<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>u8<span class="token operator">></span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v2 <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">into_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// impl&lt;\'_> From&lt;&amp;\'_ str> for Vec</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> v3 <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 迭代器 Iterators 可以通过 collect 变成 Vec</span>\n    <span class="token keyword">let</span> v4<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v4<span class="token punctuation">,</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-22"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79175910438784650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误并实现缺失的代码\nfn main() {\n    let mut v = Vec::from([1, 2, 3]);\n    for i in 0..5 {\n        println!(&quot;{:?}&quot;, v[i])\n    }\n\n    for i in 0..5 {\n       // 实现这里的代码...\n    }\n\n    assert_eq!(v, vec![2, 3, 4, 5, 6]);\n\n    println!(&quot;Success!&quot;)\n}`, `79175910438784650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误并实现缺失的代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>\n       <span class="token comment">// 实现这里的代码...</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-168"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-168" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47829253366611304000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误并实现缺失的代码\nfn main() {\n    let mut v = Vec::from([1, 2, 3]);\n    for i in 0..5 {\n        println!(&quot;{:?}&quot;, v.get(i))\n    }\n\n    for i in 0..5 {\n        // match i {\n        //     0..=2 => v[i] += 1,\n        //     _ => v.push(i + 2)\n        // }\n\n        if let Some(x) = v.get(i) {\n            v[i] = x + 1\n        } else {\n            v.push(i + 2)\n        }\n        // 实现这里的代码...\n    }\n\n    assert_eq!(v, vec![2, 3, 4, 5, 6]);\n\n    println!(&quot;Success!&quot;)\n}`, `47829253366611304000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误并实现缺失的代码</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>\n        <span class="token comment">// match i {</span>\n        <span class="token comment">//     0..=2 => v[i] += 1,</span>\n        <span class="token comment">//     _ => v.push(i + 2)</span>\n        <span class="token comment">// }</span>\n\n        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token function">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            v<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        <span class="token comment">// 实现这里的代码...</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-22"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>与 String 的切片类似，Vec 也可以使用切片。如果说 Vec 是可变的，那它的切片就是不可变或者说只读的，我们可以通过 &#x26; 来获取切片</p>\n<p>在 Rust 中，将切片作为参数进行传递是更常见的使用方式，例如当一个函数只需要可读性时，那传递 Vec 或 String 的切片 <code class="language-text">&amp;[T]</code> / <code class="language-text">&amp;str</code> 会更加适合</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79950760194791640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut v = vec![1, 2, 3];\n\n    let slice1 = &v[..];\n    // 越界访问将导致 panic.\n    // 修改时必须使用 \\`v.len\\`\n    let slice2 = &v[0..4];\n\n    assert_eq!(slice1, slice2);\n\n    // 切片是只读的\n    // 注意：切片和 \\`&Vec\\` 是不同的类型，后者仅仅是 \\`Vec\\` 的引用，并可以通过解引用直接获取 \\`Vec\\`\n    let vec_ref: &mut Vec<i32> = &mut v;\n    (*vec_ref).push(4);\n    let slice3 = &mut v[0..3];\n    slice3.push(4);\n\n    assert_eq!(slice3, &[1, 2, 3, 4]);\n\n    println!(&quot;Success!&quot;)\n}`, `79950760194791640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>v<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 越界访问将导致 panic.</span>\n    <span class="token comment">// 修改时必须使用 `v.len`</span>\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 切片是只读的</span>\n    <span class="token comment">// 注意：切片和 `&amp;Vec` 是不同的类型，后者仅仅是 `Vec` 的引用，并可以通过解引用直接获取 `Vec`</span>\n    <span class="token keyword">let</span> vec_ref<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">;</span>\n    <span class="token punctuation">(</span><span class="token operator">*</span>vec_ref<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> slice3 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    slice3<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice3<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-169"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-169" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89976803154988340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut v = vec![1, 2, 3];\n\n    let slice1 = &v[..];\n    // 越界访问将导致 panic.\n    // 修改时必须使用 \\`v.len\\`\n    let slice2 = &v[0..v.len()];\n\n    assert_eq!(slice1, slice2);\n\n    // 切片是只读的\n    // 注意：切片和 \\`&Vec\\` 是不同的类型，后者仅仅是 \\`Vec\\` 的引用，并可以通过解引用直接获取 \\`Vec\\`\n    let vec_ref: &mut Vec<i32> = &mut v;\n    (*vec_ref).push(4);\n    let slice3 = &mut v[0..];\n    // slice3.push(4);\n\n    assert_eq!(slice3, &[1, 2, 3, 4]);\n\n    println!(&quot;Success!&quot;)\n}`, `89976803154988340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> slice1 <span class="token operator">=</span> <span class="token operator">&amp;</span>v<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 越界访问将导致 panic.</span>\n    <span class="token comment">// 修改时必须使用 `v.len`</span>\n    <span class="token keyword">let</span> slice2 <span class="token operator">=</span> <span class="token operator">&amp;</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span>v<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice1<span class="token punctuation">,</span> slice2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 切片是只读的</span>\n    <span class="token comment">// 注意：切片和 `&amp;Vec` 是不同的类型，后者仅仅是 `Vec` 的引用，并可以通过解引用直接获取 `Vec`</span>\n    <span class="token keyword">let</span> vec_ref<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> Vec<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">;</span>\n    <span class="token punctuation">(</span><span class="token operator">*</span>vec_ref<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> slice3 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// slice3.push(4);</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>slice3<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-19"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>容量 capacity 是已经分配好的内存空间，用于存储未来添加到 Vec 中的元素。而长度 len 则是当前 Vec 中已经存储的元素数量。如果要添加新元素时，长度将要超过已有的容量，那容量会自动进行增长：Rust 会重新分配一块更大的内存空间，然后将之前的 Vec 拷贝过去，因此，这里就会发生新的内存分配（目前 Rust 的容量调整策略是加倍，例如 2 -> 4 -> 8 ..）。</p>\n<p>若这段代码会频繁发生，那频繁的内存分配会大幅影响我们系统的性能，最好的办法就是提前分配好足够的容量，尽量减少内存分配。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24998879849502888000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut vec = Vec::with_capacity(10);\n\n    assert_eq!(vec.len(), __);\n    assert_eq!(vec.capacity(), 10);\n\n    // 由于提前设置了足够的容量，这里的循环不会造成任何内存分配...\n    for i in 0..10 {\n        vec.push(i);\n    }\n    assert_eq!(vec.len(), __);\n    assert_eq!(vec.capacity(), __);\n\n    // ...但是下面的代码会造成新的内存分配\n    vec.push(11);\n    assert_eq!(vec.len(), 11);\n    assert!(vec.capacity() >= 11);\n\n\n    // 填写一个合适的值，在 \\`for\\` 循环运行的过程中，不会造成任何内存分配\n    let mut vec = Vec::with_capacity(__);\n    for i in 0..100 {\n        vec.push(i);\n    }\n\n    assert_eq!(vec.len(), __);\n    assert_eq!(vec.capacity(), __);\n\n    println!(&quot;Success!&quot;)\n}`, `24998879849502888000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 由于提前设置了足够的容量，这里的循环不会造成任何内存分配...</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>\n        vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...但是下面的代码会造成新的内存分配</span>\n    vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n    <span class="token comment">// 填写一个合适的值，在 `for` 循环运行的过程中，不会造成任何内存分配</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">100</span> <span class="token punctuation">{</span>\n        vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-170"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-170" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60910323069666435000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\nfn main() {\n    let mut vec = Vec::with_capacity(10);\n\n    assert_eq!(vec.len(), 0);\n    assert_eq!(vec.capacity(), 10);\n\n    // 由于提前设置了足够的容量，这里的循环不会造成任何内存分配...\n    for i in 0..10 {\n        vec.push(i);\n    }\n    assert_eq!(vec.len(), 10);\n    assert_eq!(vec.capacity(), 10);\n\n    // ...但是下面的代码会造成新的内存分配\n    vec.push(11);\n    assert_eq!(vec.len(), 11);\n    assert!(vec.capacity() >= 11);\n\n\n    // 填写一个合适的值，在 \\`for\\` 循环运行的过程中，不会造成任何内存分配\n    let mut vec = Vec::with_capacity(100);\n    for i in 0..100 {\n        vec.push(i);\n    }\n\n    assert_eq!(vec.len(), 100);\n    assert_eq!(vec.capacity(), 100);\n\n    println!(&quot;Success!&quot;)\n}`, `60910323069666435000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 由于提前设置了足够的容量，这里的循环不会造成任何内存分配...</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>\n        vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ...但是下面的代码会造成新的内存分配</span>\n    vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n    <span class="token comment">// 填写一个合适的值，在 `for` 循环运行的过程中，不会造成任何内存分配</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> Vec<span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">100</span> <span class="token punctuation">{</span>\n        vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-11"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<p>Vec 中的元素必须是相同的类型，例如以下代码会发生错误:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1477773009739502600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let v = vec![1, 2.0, 3];\n}`, `1477773009739502600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>但是我们可以使用枚举或特征对象来存储不同的类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90278595484007120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nenum IpAddr {\n    V4(String),\n    V6(String),\n}\nfn main() {\n    // 填空\n    let v : Vec<IpAddr>= __;\n\n    // 枚举的比较需要派生 PartialEq 特征\n    assert_eq!(v[0], IpAddr::V4(&quot;127.0.0.1&quot;.to_string()));\n    assert_eq!(v[1], IpAddr::V6(&quot;::1&quot;.to_string()));\n\n    println!(&quot;Success!&quot;)\n}`, `90278595484007120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> IpAddr <span class="token punctuation">{</span>\n    <span class="token function">V4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">V6</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> v <span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>IpAddr<span class="token operator">>=</span> __<span class="token punctuation">;</span>\n\n    <span class="token comment">// 枚举的比较需要派生 PartialEq 特征</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> IpAddr<span class="token punctuation">::</span><span class="token function">V4</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> IpAddr<span class="token punctuation">::</span><span class="token function">V6</span><span class="token punctuation">(</span><span class="token string">"::1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-171"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-171" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72629808925817900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug, PartialEq)]\nenum IpAddr {\n    V4(String),\n    V6(String),\n}\nfn main() {\n    // 填空\n    let v: Vec<IpAddr> = vec![\n        IpAddr::V4(&quot;127.0.0.1&quot;.to_string()),\n        IpAddr::V6(&quot;::1&quot;.to_string()),\n    ];\n\n    // 枚举的比较需要派生 PartialEq 特征\n    assert_eq!(v[0], IpAddr::V4(&quot;127.0.0.1&quot;.to_string()));\n    assert_eq!(v[1], IpAddr::V6(&quot;::1&quot;.to_string()));\n\n    println!(&quot;Success!&quot;)\n}`, `72629808925817900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>\n<span class="token keyword">enum</span> IpAddr <span class="token punctuation">{</span>\n    <span class="token function">V4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">V6</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>IpAddr<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>\n        IpAddr<span class="token punctuation">::</span><span class="token function">V4</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        IpAddr<span class="token punctuation">::</span><span class="token function">V6</span><span class="token punctuation">(</span><span class="token string">"::1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 枚举的比较需要派生 PartialEq 特征</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> IpAddr<span class="token punctuation">::</span><span class="token function">V4</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> IpAddr<span class="token punctuation">::</span><span class="token function">V6</span><span class="token punctuation">(</span><span class="token string">"::1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-9"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42853171828682070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait IpAddr {\n    fn display(&self);\n}\n\nstruct V4(String);\nimpl IpAddr for V4 {\n    fn display(&self) {\n        println!(&quot;ipv4: {:?}&quot;,self.0)\n    }\n}\nstruct V6(String);\nimpl IpAddr for V6 {\n    fn display(&self) {\n        println!(&quot;ipv6: {:?}&quot;,self.0)\n    }\n}\n\nfn main() {\n    // 填空\n    let v: __= vec![\n        Box::new(V4(&quot;127.0.0.1&quot;.to_string())),\n        Box::new(V6(&quot;::1&quot;.to_string())),\n    ];\n\n    for ip in v {\n        ip.display();\n    }\n}`, `42853171828682070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> IpAddr <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> <span class="token function">V4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">impl</span> IpAddr <span class="token keyword">for</span> V4 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"ipv4: {:?}"</span><span class="token punctuation">,</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> <span class="token function">V6</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">impl</span> IpAddr <span class="token keyword">for</span> V6 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"ipv6: {:?}"</span><span class="token punctuation">,</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> __<span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">V4</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">V6</span><span class="token punctuation">(</span><span class="token string">"::1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> ip <span class="token keyword">in</span> v <span class="token punctuation">{</span>\n        ip<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-172"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-172" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83956553199618130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`trait IpAddr {\n    fn display(&self);\n}\n\nstruct V4(String);\nimpl IpAddr for V4 {\n    fn display(&self) {\n        println!(&quot;ipv4: {:?}&quot;, self.0)\n    }\n}\nstruct V6(String);\nimpl IpAddr for V6 {\n    fn display(&self) {\n        println!(&quot;ipv6: {:?}&quot;, self.0)\n    }\n}\n\nfn main() {\n    // 填空\n    let v: Vec<Box<dyn IpAddr>> = vec![\n        Box::new(V4(&quot;127.0.0.1&quot;.to_string())),\n        Box::new(V6(&quot;::1&quot;.to_string())),\n    ];\n\n    for ip in v {\n        ip.display();\n    }\n}`, `83956553199618130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">trait</span> IpAddr <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> <span class="token function">V4</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">impl</span> IpAddr <span class="token keyword">for</span> V4 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"ipv4: {:?}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">struct</span> <span class="token function">V6</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">impl</span> IpAddr <span class="token keyword">for</span> V6 <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"ipv6: {:?}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 填空</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> Vec<span class="token operator">&lt;</span>Box<span class="token operator">&lt;</span><span class="token keyword">dyn</span> IpAddr<span class="token operator">>></span> <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">V4</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token function">V6</span><span class="token punctuation">(</span><span class="token string">"::1"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> ip <span class="token keyword">in</span> v <span class="token punctuation">{</span>\n        ip<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="kv-存储-hashmap"><a href="#kv-%E5%AD%98%E5%82%A8-hashmap" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KV 存储 HashMap</h2>\n<p>HashMap 默认使用 <code class="language-text">SipHash 1-3</code> 哈希算法，该算法对于抵抗 HashDos 攻击非常有效。在性能方面，如果你的 key 是中型大小的，那该算法非常不错，但是如果是小型的 key（例如整数）亦或是大型的 key（例如字符串），那你需要采用社区提供的其它算法来提高性能</p>\n<p>哈希表的算法是基于 Google 的 <a href="https://abseil.io/blog/20180927-swisstables" target="_blank" rel="nofollow noreferrer noopener">SwissTable</a>，你可以在这里找到 C++ 的实现，同时在 <a href="https://www.youtube.com/watch?v=ncHmEUmJZf4" target="_blank" rel="nofollow noreferrer noopener">CppCon talk</a> 上也有关于算法如何工作的演讲</p>\n<h3 id="问题一-24"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84838419441177050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nuse std::collections::HashMap;\nfn main() {\n    let mut scores = HashMap::new();\n    scores.insert(&quot;Sunface&quot;, 98);\n    scores.insert(&quot;Daniel&quot;, 95);\n    scores.insert(&quot;Ashley&quot;, 69.0);\n    scores.insert(&quot;Katie&quot;, &quot;58&quot;);\n\n    // get 返回一个 Option<&V> 枚举值\n    let score = scores.get(&quot;Sunface&quot;);\n    assert_eq!(score, Some(98));\n\n    if scores.contains_key(&quot;Daniel&quot;) {\n        // 索引返回一个值 V\n        let score = scores[&quot;Daniel&quot;];\n        assert_eq!(score, __);\n        scores.remove(&quot;Daniel&quot;);\n    }\n\n    assert_eq!(scores.len(), __);\n\n    for (name, score) in scores {\n        println!(&quot;The score of {} is {}&quot;, name, score)\n    }\n}`, `84838419441177050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> scores <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Sunface"</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Daniel"</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Ashley"</span><span class="token punctuation">,</span> <span class="token number">69.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Katie"</span><span class="token punctuation">,</span> <span class="token string">"58"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// get 返回一个 Option&lt;&amp;V> 枚举值</span>\n    <span class="token keyword">let</span> score <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"Sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> scores<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token string">"Daniel"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 索引返回一个值 V</span>\n        <span class="token keyword">let</span> score <span class="token operator">=</span> scores<span class="token punctuation">[</span><span class="token string">"Daniel"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        scores<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"Daniel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>scores<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">in</span> scores <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The score of {} is {}"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-173"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-173" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76212832302693420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nuse std::collections::HashMap;\nfn main() {\n    let mut scores = HashMap::new();\n    scores.insert(&quot;Sunface&quot;, 98);\n    scores.insert(&quot;Daniel&quot;, 95);\n    scores.insert(&quot;Ashley&quot;, 69);\n    scores.insert(&quot;Katie&quot;, 58);\n\n    // get 返回一个 Option<&V> 枚举值\n    let score = scores.get(&quot;Sunface&quot;);\n    assert_eq!(score, Some(&98));\n\n    if scores.contains_key(&quot;Daniel&quot;) {\n        // 索引返回一个值 V\n        let score = scores[&quot;Daniel&quot;];\n        assert_eq!(score, 95);\n        scores.remove(&quot;Daniel&quot;);\n    }\n\n    assert_eq!(scores.len(), 3);\n\n    for (name, score) in scores {\n        println!(&quot;The score of {} is {}&quot;, name, score)\n    }\n}`, `76212832302693420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> scores <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Sunface"</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Daniel"</span><span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Ashley"</span><span class="token punctuation">,</span> <span class="token number">69</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"Katie"</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// get 返回一个 Option&lt;&amp;V> 枚举值</span>\n    <span class="token keyword">let</span> score <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"Sunface"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> scores<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token string">"Daniel"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 索引返回一个值 V</span>\n        <span class="token keyword">let</span> score <span class="token operator">=</span> scores<span class="token punctuation">[</span><span class="token string">"Daniel"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token function">assert_eq!</span><span class="token punctuation">(</span>score<span class="token punctuation">,</span> <span class="token number">95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        scores<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"Daniel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>scores<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">in</span> scores <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"The score of {} is {}"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> score<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-24"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71732443444654990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::collections::HashMap;\nfn main() {\n    let teams = [\n        (&quot;Chinese Team&quot;, 100),\n        (&quot;American Team&quot;, 10),\n        (&quot;France Team&quot;, 50),\n    ];\n\n    let mut teams_map1 = HashMap::new();\n    for team in &teams {\n        teams_map1.insert(team.0, team.1);\n    }\n\n    // 使用两种方法实现 team_map2\n    // 提示:其中一种方法是使用 \\`collect\\` 方法\n    let teams_map2...\n\n    assert_eq!(teams_map1, teams_map2);\n\n    println!(&quot;Success!&quot;)\n}`, `71732443444654990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> teams <span class="token operator">=</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">(</span><span class="token string">"Chinese Team"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span><span class="token string">"American Team"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span><span class="token string">"France Team"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> teams_map1 <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> team <span class="token keyword">in</span> <span class="token operator">&amp;</span>teams <span class="token punctuation">{</span>\n        teams_map1<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>team<span class="token number">.0</span><span class="token punctuation">,</span> team<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 使用两种方法实现 team_map2</span>\n    <span class="token comment">// 提示:其中一种方法是使用 `collect` 方法</span>\n    <span class="token keyword">let</span> teams_map2<span class="token punctuation">...</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>teams_map1<span class="token punctuation">,</span> teams_map2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-174"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-174" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42121283537485234000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::collections::HashMap;\nfn main() {\n    let teams = [\n        (&quot;Chinese Team&quot;, 100),\n        (&quot;American Team&quot;, 10),\n        (&quot;France Team&quot;, 50),\n    ];\n\n    let mut teams_map1 = HashMap::new();\n    for team in &teams {\n        teams_map1.insert(team.0, team.1);\n    }\n\n    // 使用两种方法实现 team_map2\n    // 提示:其中一种方法是使用 \\`collect\\` 方法\n    // let teams_map2 = teams.into_iter().collect();\n    let teams_map2 = HashMap::from(teams);\n\n    assert_eq!(teams_map1, teams_map2);\n\n    println!(&quot;Success!&quot;)\n}`, `42121283537485234000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> teams <span class="token operator">=</span> <span class="token punctuation">[</span>\n        <span class="token punctuation">(</span><span class="token string">"Chinese Team"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span><span class="token string">"American Team"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span><span class="token string">"France Team"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> teams_map1 <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> team <span class="token keyword">in</span> <span class="token operator">&amp;</span>teams <span class="token punctuation">{</span>\n        teams_map1<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>team<span class="token number">.0</span><span class="token punctuation">,</span> team<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 使用两种方法实现 team_map2</span>\n    <span class="token comment">// 提示:其中一种方法是使用 `collect` 方法</span>\n    <span class="token comment">// let teams_map2 = teams.into_iter().collect();</span>\n    <span class="token keyword">let</span> teams_map2 <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>teams<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>teams_map1<span class="token punctuation">,</span> teams_map2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-24"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="990352729903931600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::collections::HashMap;\nfn main() {\n    // 编译器可以根据后续的使用情况帮我自动推断出 HashMap 的类型，当然你也可以显式地标注类型：HashMap<&str, u8>\n    let mut player_stats = HashMap::new();\n\n    // 查询指定的 key, 若不存在时，则插入新的 kv 值\n    player_stats.entry(&quot;health&quot;).or_insert(100);\n\n    assert_eq!(player_stats[&quot;health&quot;], __);\n\n    // 通过函数来返回新的值\n    player_stats.entry(&quot;health&quot;).or_insert_with(random_stat_buff);\n    assert_eq!(player_stats[&quot;health&quot;], __);\n\n    let health = player_stats.entry(&quot;health&quot;).or_insert(50);\n    assert_eq!(health, __);\n    *health -= 50;\n    assert_eq!(*health, __);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn random_stat_buff() -> u8 {\n    // 为了简单，我们没有使用随机，而是返回一个固定的值\n    42\n}`, `990352729903931600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 编译器可以根据后续的使用情况帮我自动推断出 HashMap 的类型，当然你也可以显式地标注类型：HashMap&lt;&amp;str, u8></span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> player_stats <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 查询指定的 key, 若不存在时，则插入新的 kv 值</span>\n    player_stats<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"health"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>player_stats<span class="token punctuation">[</span><span class="token string">"health"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 通过函数来返回新的值</span>\n    player_stats<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"health"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert_with</span><span class="token punctuation">(</span>random_stat_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>player_stats<span class="token punctuation">[</span><span class="token string">"health"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> health <span class="token operator">=</span> player_stats<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"health"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>health<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token operator">*</span>health <span class="token operator">-=</span> <span class="token number">50</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>health<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">random_stat_buff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u8 <span class="token punctuation">{</span>\n    <span class="token comment">// 为了简单，我们没有使用随机，而是返回一个固定的值</span>\n    <span class="token number">42</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-175"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-175" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32538500220573450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nuse std::collections::HashMap;\nfn main() {\n    // 编译器可以根据后续的使用情况帮我自动推断出 HashMap 的类型，当然你也可以显式地标注类型：HashMap<&str, u8>\n    let mut player_stats = HashMap::new();\n\n    // 查询指定的 key, 若不存在时，则插入新的 kv 值\n    player_stats.entry(&quot;health&quot;).or_insert(100);\n\n    assert_eq!(player_stats[&quot;health&quot;], 100);\n\n    // 通过函数来返回新的值\n    player_stats.entry(&quot;health&quot;).or_insert_with(random_stat_buff);\n    assert_eq!(player_stats[&quot;health&quot;], 100);\n\n    let health = player_stats.entry(&quot;health&quot;).or_insert(50);\n    assert_eq!(health, &100);\n    *health -= 50;\n    assert_eq!(*health, 50);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn random_stat_buff() -> u8 {\n    // 为了简单，我们没有使用随机，而是返回一个固定的值\n    42\n}`, `32538500220573450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 编译器可以根据后续的使用情况帮我自动推断出 HashMap 的类型，当然你也可以显式地标注类型：HashMap&lt;&amp;str, u8></span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> player_stats <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 查询指定的 key, 若不存在时，则插入新的 kv 值</span>\n    player_stats<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"health"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>player_stats<span class="token punctuation">[</span><span class="token string">"health"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 通过函数来返回新的值</span>\n    player_stats<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"health"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert_with</span><span class="token punctuation">(</span>random_stat_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>player_stats<span class="token punctuation">[</span><span class="token string">"health"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> health <span class="token operator">=</span> player_stats<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">"health"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>health<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token operator">*</span>health <span class="token operator">-=</span> <span class="token number">50</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>health<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">random_stat_buff</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> u8 <span class="token punctuation">{</span>\n    <span class="token comment">// 为了简单，我们没有使用随机，而是返回一个固定的值</span>\n    <span class="token number">42</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-23"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>任何实现了 Eq 和 Hash 特征的类型都可以用于 HashMap 的 key，包括:</p>\n<ul>\n<li>bool（很少用到，因为它只能表达两种 key）</li>\n<li>int, uint 以及它们的变体，例如 u8、i32 等</li>\n<li>String 和 &#x26;str（提示: HashMap 的 key 是 String 类型时，你其实可以使用 &#x26;str 配合 get 方法进行查询）</li>\n</ul>\n<p>需要注意的是，f32 和 f64 并没有实现 Hash，原因是浮点数精度的问题会导致它们无法进行相等比较。</p>\n<p>如果一个集合类型的所有字段都实现了 Eq 和 Hash，那该集合类型会自动实现 Eq 和 Hash。例如 <code class="language-text">Vect&lt;T&gt;</code> 要实现 Hash，那么首先需要 T 实现 Hash</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33710718448139840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\n// 提示: \\`derive\\` 是实现一些常用特征的好办法\nuse std::collections::HashMap;\n\nstruct Viking {\n    name: String,\n    country: String,\n}\n\nimpl Viking {\n    fn new(name: &str, country: &str) -> Viking {\n        Viking {\n            name: name.to_string(),\n            country: country.to_string(),\n        }\n    }\n}\n\nfn main() {\n    // 使用 HashMap 来存储 viking 的生命值\n    let vikings = HashMap::from([\n        (Viking::new(&quot;Einar&quot;, &quot;Norway&quot;), 25),\n        (Viking::new(&quot;Olaf&quot;, &quot;Denmark&quot;), 24),\n        (Viking::new(&quot;Harald&quot;, &quot;Iceland&quot;), 12),\n    ]);\n\n    // 使用 derive 的方式来打印 viking 的当前状态\n    for (viking, health) in &vikings {\n        println!(&quot;{:?} has {} hp&quot;, viking, health);\n    }\n}`, `33710718448139840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token comment">// 提示: `derive` 是实现一些常用特征的好办法</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n\n<span class="token keyword">struct</span> Viking <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    country<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Viking <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> country<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Viking <span class="token punctuation">{</span>\n        Viking <span class="token punctuation">{</span>\n            name<span class="token punctuation">:</span> name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            country<span class="token punctuation">:</span> country<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用 HashMap 来存储 viking 的生命值</span>\n    <span class="token keyword">let</span> vikings <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n        <span class="token punctuation">(</span>Viking<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Einar"</span><span class="token punctuation">,</span> <span class="token string">"Norway"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span>Viking<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Olaf"</span><span class="token punctuation">,</span> <span class="token string">"Denmark"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span>Viking<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Harald"</span><span class="token punctuation">,</span> <span class="token string">"Iceland"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 derive 的方式来打印 viking 的当前状态</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>viking<span class="token punctuation">,</span> health<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>vikings <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?} has {} hp"</span><span class="token punctuation">,</span> viking<span class="token punctuation">,</span> health<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>关于容量，我们在之前的 Vector 中有详细的介绍，而 HashMap 也可以调整容量：你可以通过 <code class="language-text">HashMap::with_capacity(uint)</code> 使用指定的容量来初始化，或者使用 <code class="language-text">HashMap::new()</code>，后者会提供一个默认的初始化容量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56216354047179950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::collections::HashMap;\nfn main() {\n    let mut map: HashMap<i32, i32> = HashMap::with_capacity(100);\n    map.insert(1, 2);\n    map.insert(3, 4);\n    // 事实上，虽然我们使用了 100 容量来初始化，但是 map 的容量很可能会比 100 更多\n    assert!(map.capacity() >= 100);\n\n    // 对容量进行收缩，你提供的值仅仅是一个允许的最小值，实际上，Rust 会根据当前存储的数据量进行自动设置，当然，这个值会尽量靠近你提供的值，同时还可能会预留一些调整空间\n\n    map.shrink_to(50);\n    assert!(map.capacity() >= 50);\n\n    // 让 Rust 自行调整到一个合适的值，剩余策略同上\n    map.shrink_to_fit();\n    assert!(map.capacity() >= 2);\n    println!(&quot;Success!&quot;)\n}`, `56216354047179950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> map<span class="token punctuation">:</span> HashMap<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> i32<span class="token operator">></span> <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 事实上，虽然我们使用了 100 容量来初始化，但是 map 的容量很可能会比 100 更多</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 对容量进行收缩，你提供的值仅仅是一个允许的最小值，实际上，Rust 会根据当前存储的数据量进行自动设置，当然，这个值会尽量靠近你提供的值，同时还可能会预留一些调整空间</span>\n\n    map<span class="token punctuation">.</span><span class="token function">shrink_to</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 让 Rust 自行调整到一个合适的值，剩余策略同上</span>\n    map<span class="token punctuation">.</span><span class="token function">shrink_to_fit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-176"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-176" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64772876515232270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误\n// 提示: \\`derive\\` 是实现一些常用特征的好办法\nuse std::collections::HashMap;\n\n#[derive(Eq, Hash, PartialEq, Debug)]\nstruct Viking {\n    name: String,\n    country: String,\n}\n\nimpl Viking {\n    fn new(name: &str, country: &str) -> Viking {\n        Viking {\n            name: name.to_string(),\n            country: country.to_string(),\n        }\n    }\n}\n\nfn main() {\n    // 使用 HashMap 来存储 viking 的生命值\n    let vikings = HashMap::from([\n        (Viking::new(&quot;Einar&quot;, &quot;Norway&quot;), 25),\n        (Viking::new(&quot;Olaf&quot;, &quot;Denmark&quot;), 24),\n        (Viking::new(&quot;Harald&quot;, &quot;Iceland&quot;), 12),\n    ]);\n\n    // 使用 derive 的方式来打印 viking 的当前状态\n    for (viking, health) in &vikings {\n        println!(&quot;{:?} has {} hp&quot;, viking, health);\n    }\n}`, `64772876515232270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误</span>\n<span class="token comment">// 提示: `derive` 是实现一些常用特征的好办法</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n\n<span class="token attribute attr-name">#[derive(Eq, Hash, PartialEq, Debug)]</span>\n<span class="token keyword">struct</span> Viking <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    country<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Viking <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> country<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Viking <span class="token punctuation">{</span>\n        Viking <span class="token punctuation">{</span>\n            name<span class="token punctuation">:</span> name<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            country<span class="token punctuation">:</span> country<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用 HashMap 来存储 viking 的生命值</span>\n    <span class="token keyword">let</span> vikings <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n        <span class="token punctuation">(</span>Viking<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Einar"</span><span class="token punctuation">,</span> <span class="token string">"Norway"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span>Viking<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Olaf"</span><span class="token punctuation">,</span> <span class="token string">"Denmark"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">(</span>Viking<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Harald"</span><span class="token punctuation">,</span> <span class="token string">"Iceland"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 使用 derive 的方式来打印 viking 的当前状态</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>viking<span class="token punctuation">,</span> health<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>vikings <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?} has {} hp"</span><span class="token punctuation">,</span> viking<span class="token punctuation">,</span> health<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-23"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>对于实现了 Copy 特征的类型，例如 i32，那类型的值会被拷贝到 HashMap 中。而对于有所有权的类型，例如 String，它们的值的所有权将被转移到 HashMap 中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54427844133420320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，尽可能少的去修改代码\n// 不要移除任何代码行！\nuse std::collections::HashMap;\nfn main() {\n  let v1 = 10;\n  let mut m1 = HashMap::new();\n  m1.insert(v1, v1);\n  println!(&quot;v1 is still usable after inserting to hashmap : {}&quot;, v1);\n\n  let v2 = &quot;hello&quot;.to_string();\n  let mut m2 = HashMap::new();\n  // 所有权在这里发生了转移\n  m2.insert(v2, v1);\n\n  assert_eq!(v2, &quot;hello&quot;);\n\n   println!(&quot;Success!&quot;)\n}`, `54427844133420320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，尽可能少的去修改代码</span>\n<span class="token comment">// 不要移除任何代码行！</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> <span class="token keyword">mut</span> m1 <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  m1<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"v1 is still usable after inserting to hashmap : {}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> <span class="token keyword">mut</span> m2 <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 所有权在这里发生了转移</span>\n  m2<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在开头，我们提到过如果现有的 <code class="language-text">SipHash 1-3</code> 的性能无法满足你的需求，那么可以使用社区提供的替代算法。</p>\n<p>例如其中一个社区库的使用方式如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62912169055367030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(unused)]\nfn main() {\n   use std:#️⃣:BuildHasherDefault;\n   use std::collections::HashMap;\n   // 引入第三方的哈希函数\n   use twox_hash::XxHash64;\n\n   let mut hash: HashMap<_, _, BuildHasherDefault<XxHash64>> = Default::default();\n   hash.insert(42, &quot;the answer&quot;);\n   assert_eq!(hash.get(&42), Some(&&quot;the answer&quot;));\n}`, `62912169055367030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(unused)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">use</span> std<span class="token punctuation">:</span>#️⃣<span class="token punctuation">:</span>BuildHasherDefault<span class="token punctuation">;</span>\n   <span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n   <span class="token comment">// 引入第三方的哈希函数</span>\n   <span class="token keyword">use</span> twox_hash<span class="token punctuation">::</span>XxHash64<span class="token punctuation">;</span>\n\n   <span class="token keyword">let</span> <span class="token keyword">mut</span> hash<span class="token punctuation">:</span> HashMap<span class="token operator">&lt;</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> BuildHasherDefault<span class="token operator">&lt;</span>XxHash64<span class="token operator">>></span> <span class="token operator">=</span> Default<span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   hash<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">"the answer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">"the answer"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-177"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-177" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92444406077323740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复错误，尽可能少的去修改代码\n// 不要移除任何代码行！\nuse std::collections::HashMap;\nfn main() {\n  let v1 = 10;\n  let mut m1 = HashMap::new();\n  m1.insert(v1, v1);\n  println!(&quot;v1 is still usable after inserting to hashmap : {}&quot;, v1);\n\n  let v2 = &quot;hello&quot;.to_string();\n  let mut m2 = HashMap::new();\n  // 所有权在这里发生了转移\n  m2.insert(&v2, v1);\n\n  assert_eq!(v2, &quot;hello&quot;);\n\n   println!(&quot;Success!&quot;)\n}`, `92444406077323740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复错误，尽可能少的去修改代码</span>\n<span class="token comment">// 不要移除任何代码行！</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>HashMap<span class="token punctuation">;</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> v1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> <span class="token keyword">mut</span> m1 <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  m1<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"v1 is still usable after inserting to hashmap : {}"</span><span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> <span class="token keyword">mut</span> m2 <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 所有权在这里发生了转移</span>\n  m2<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v2<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">assert_eq!</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="生命周期"><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生命周期</h1>\n<h2 id="基础"><a href="#%E5%9F%BA%E7%A1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基础</h2>\n<h3 id="问题一-25"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>编译器通过生命周期来确保所有的借用都是合法的，典型的，一个变量在创建时生命周期随之开始，销毁时生命周期也随之结束。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2905145373006390300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 为 \\`i\\` 和 \\`borrow2\\` 标注合适的生命周期范围 */\n\n// \\`i\\` 拥有最长的生命周期，因为它的作用域完整的包含了 \\`borrow1\\` 和 \\`borrow2\\` 。\n// 而 \\`borrow1\\` 和 \\`borrow2\\` 的生命周期并无关联，因为它们的作用域没有重叠\nfn main() {\n    let i = 3;\n    {\n        let borrow1 = &i; // \\`borrow1\\` 生命周期开始. ──┐\n        //                                           │\n        println!(&quot;borrow1: {}&quot;, borrow1); //         │\n    }   // \\`borrow1\\` 生命周期结束. ────────────────────┘\n    {\n        let borrow2 = &i;\n\n        println!(&quot;borrow2: {}&quot;, borrow2);\n    }\n}`, `2905145373006390300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 为 `i` 和 `borrow2` 标注合适的生命周期范围 */</span>\n\n<span class="token comment">// `i` 拥有最长的生命周期，因为它的作用域完整的包含了 `borrow1` 和 `borrow2` 。</span>\n<span class="token comment">// 而 `borrow1` 和 `borrow2` 的生命周期并无关联，因为它们的作用域没有重叠</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> borrow1 <span class="token operator">=</span> <span class="token operator">&amp;</span>i<span class="token punctuation">;</span> <span class="token comment">// `borrow1` 生命周期开始. ──┐</span>\n        <span class="token comment">//                                           │</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"borrow1: {}"</span><span class="token punctuation">,</span> borrow1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//         │</span>\n    <span class="token punctuation">}</span>   <span class="token comment">// `borrow1` 生命周期结束. ────────────────────┘</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> borrow2 <span class="token operator">=</span> <span class="token operator">&amp;</span>i<span class="token punctuation">;</span>\n\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"borrow2: {}"</span><span class="token punctuation">,</span> borrow2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-178"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-178" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36892435408625280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 为 \\`i\\` 和 \\`borrow2\\` 标注合适的生命周期范围 */\n\n// \\`i\\` 拥有最长的生命周期，因为它的作用域完整的包含了 \\`borrow1\\` 和 \\`borrow2\\` 。\n// 而 \\`borrow1\\` 和 \\`borrow2\\` 的生命周期并无关联，因为它们的作用域没有重叠\nfn main() {\n    let i = 3;\n    {\n        let borrow1 = &i; // \\`borrow1\\` 生命周期开始. ──┐\n        //                                           │\n        println!(&quot;borrow1: {}&quot;, borrow1); //         │\n    }   // \\`borrow1\\` 生命周期结束. ────────────────────┘\n    {\n        let borrow2 = &i; // \\`borrow2\\` 生命周期开始. ──┐\n        //                                           │\n        println!(&quot;borrow2: {}&quot;, borrow2); //         │\n    }   // \\`borrow2\\` 生命周期结束. ────────────────────┘\n}`, `36892435408625280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 为 `i` 和 `borrow2` 标注合适的生命周期范围 */</span>\n\n<span class="token comment">// `i` 拥有最长的生命周期，因为它的作用域完整的包含了 `borrow1` 和 `borrow2` 。</span>\n<span class="token comment">// 而 `borrow1` 和 `borrow2` 的生命周期并无关联，因为它们的作用域没有重叠</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> borrow1 <span class="token operator">=</span> <span class="token operator">&amp;</span>i<span class="token punctuation">;</span> <span class="token comment">// `borrow1` 生命周期开始. ──┐</span>\n        <span class="token comment">//                                           │</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"borrow1: {}"</span><span class="token punctuation">,</span> borrow1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//         │</span>\n    <span class="token punctuation">}</span>   <span class="token comment">// `borrow1` 生命周期结束. ────────────────────┘</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> borrow2 <span class="token operator">=</span> <span class="token operator">&amp;</span>i<span class="token punctuation">;</span> <span class="token comment">// `borrow2` 生命周期开始. ──┐</span>\n        <span class="token comment">//                                           │</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"borrow2: {}"</span><span class="token punctuation">,</span> borrow2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//         │</span>\n    <span class="token punctuation">}</span>   <span class="token comment">// `borrow2` 生命周期结束. ────────────────────┘</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-25"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>示例</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14322506751518005000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(unused)]\nfn main() {\n    {\n        let x = 5;            // ----------+-- \'b\n                              //           |\n        let r = &x;           // --+-- \'a  |\n                              //   |       |\n        println!(&quot;r: {}&quot;, r); //   |       |\n                              // --+       |\n    }                         // ----------+\n}`, `14322506751518005000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(unused)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>            <span class="token comment">// ----------+-- \'b</span>\n                              <span class="token comment">//           |</span>\n        <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>           <span class="token comment">// --+-- \'a  |</span>\n                              <span class="token comment">//   |       |</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"r: {}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//   |       |</span>\n                              <span class="token comment">// --+       |</span>\n    <span class="token punctuation">}</span>                         <span class="token comment">// ----------+</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39009268643378950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 像上面的示例一样，为 \\`r\\` 和 \\`x\\` 标准生命周期，然后从生命周期的角度解释一下为什么编译错误 */\n\nfn main() {\n    {\n        let r;                // ---------+-- \'a\n                              //          |\n        {                     //          |\n            let x = 5;        // -+-- \'b  |\n            r = &x;           //  |       |\n        }                     // -+       |\n                              //          |\n        println!(&quot;r: {}&quot;, r); //          |\n    }                         // ---------+\n}`, `39009268643378950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 像上面的示例一样，为 `r` 和 `x` 标准生命周期，然后从生命周期的角度解释一下为什么编译错误 */</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> r<span class="token punctuation">;</span>                <span class="token comment">// ---------+-- \'a</span>\n                              <span class="token comment">//          |</span>\n        <span class="token punctuation">{</span>                     <span class="token comment">//          |</span>\n            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        <span class="token comment">// -+-- \'b  |</span>\n            r <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>           <span class="token comment">//  |       |</span>\n        <span class="token punctuation">}</span>                     <span class="token comment">// -+       |</span>\n                              <span class="token comment">//          |</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"r: {}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//          |</span>\n    <span class="token punctuation">}</span>                         <span class="token comment">// ---------+</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-179"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-179" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<p>r 变量被赋予了生命周期 ‘a，x 被赋予了生命周期 ‘b，从图示上可以明显看出生命周期 ‘b 比 ‘a 小很多</p>\n<p>在编译期，Rust 会比较两个变量的生命周期，结果发现 r 明明拥有生命周期 ‘a，但是却引用了一个小得多的生命周期 ‘b，在这种情况下，编译器会认为我们的程序存在风险，因此拒绝运行。</p>\n<p>如果想要编译通过，也很简单，只要 ‘b 比 ‘a 大就好。总之，x 变量只要比 r 活得久，那么 r 就能随意引用 x 且不会存在危险：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6436165496632595000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 像上面的示例一样，为 \\`r\\` 和 \\`x\\` 标准生命周期，然后从生命周期的角度解释一下为什么编译错误 */\n\nfn main() {\n    {\n        let r;                // ---------+-- \'a\n                              //          |\n        {                     //          |\n            let x = 5;        // -+-- \'b  |\n            r = &x;           //  |       |\n        }                     // -+       |\n                              //          |\n        println!(&quot;r: {}&quot;, r); //          |\n    }                         // ---------+\n}`, `6436165496632595000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 像上面的示例一样，为 `r` 和 `x` 标准生命周期，然后从生命周期的角度解释一下为什么编译错误 */</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> r<span class="token punctuation">;</span>                <span class="token comment">// ---------+-- \'a</span>\n                              <span class="token comment">//          |</span>\n        <span class="token punctuation">{</span>                     <span class="token comment">//          |</span>\n            <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>        <span class="token comment">// -+-- \'b  |</span>\n            r <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>           <span class="token comment">//  |       |</span>\n        <span class="token punctuation">}</span>                     <span class="token comment">// -+       |</span>\n                              <span class="token comment">//          |</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"r: {}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//          |</span>\n    <span class="token punctuation">}</span>                         <span class="token comment">// ---------+</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-25"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>Rust 的借用检查器使用显式的生命周期标注来确定一个引用的合法范围。但是对于用户来说，我们在大多数场景下，都无需手动去标注生命周期，原因是编译器会在某些情况下自动应用生命周期消除规则。</p>\n<p>在了解编译器使用哪些规则帮我们消除生命周期之前，首先还是需要知道该如何手动标记生命周期。</p>\n<p>大家先忽略生命周期消除规则，让我们看看，函数签名中的生命周期有哪些限制:</p>\n<ul>\n<li>需要为每个引用标注上合适的生命周期</li>\n<li>返回值中的引用，它的生命周期要么跟某个引用参数相同，要么是 <code class="language-text">&#39;static</code></li>\n</ul>\n<p>示例</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10282318938218670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 引用参数中的生命周期 \'a 至少要跟函数活得一样久\nfn print_one<\'a>(x: &\'a i32) {\n    println!(&quot;\\`print_one\\`: x is {}&quot;, x);\n}\n\n// 可变引用依然需要标准生命周期\nfn add_one<\'a>(x: &\'a mut i32) {\n    *x += 1;\n}\n\n// 下面代码中，每个参数都拥有自己独立的生命周期，事实上，这个例子足够简单，因此它们应该被标记上相同的生命周期 \\`\'a\\`，但是对于复杂的例子而言，独立的生命周期标注是可能存在的\nfn print_multi<\'a, \'b>(x: &\'a i32, y: &\'b i32) {\n    println!(&quot;\\`print_multi\\`: x is {}, y is {}&quot;, x, y);\n}\n\n// 返回一个通过参数传入的引用是很常见的，但是这种情况下需要标注上正确的生命周期\nfn pass_x<\'a, \'b>(x: &\'a i32, _: &\'b i32) -> &\'a i32 { x }\n\nfn main() {\n    let x = 7;\n    let y = 9;\n\n    print_one(&x);\n    print_multi(&x, &y);\n\n    let z = pass_x(&x, &y);\n    print_one(z);\n\n    let mut t = 3;\n    add_one(&mut t);\n    print_one(&t);\n}`, `10282318938218670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 引用参数中的生命周期 \'a 至少要跟函数活得一样久</span>\n<span class="token keyword">fn</span> print_one<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`print_one`: x is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 可变引用依然需要标准生命周期</span>\n<span class="token keyword">fn</span> add_one<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">mut</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token operator">*</span>x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 下面代码中，每个参数都拥有自己独立的生命周期，事实上，这个例子足够简单，因此它们应该被标记上相同的生命周期 `\'a`，但是对于复杂的例子而言，独立的生命周期标注是可能存在的</span>\n<span class="token keyword">fn</span> print_multi<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`print_multi`: x is {}, y is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 返回一个通过参数传入的引用是很常见的，但是这种情况下需要标注上正确的生命周期</span>\n<span class="token keyword">fn</span> pass_x<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span> _<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32 <span class="token punctuation">{</span> x <span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_one</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_multi</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token function">pass_x</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">,</span> <span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_one</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> t <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n    <span class="token function">add_one</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_one</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98001239518576400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加合适的生命周期标注，让下面的代码工作 */\nfn longest(x: &str, y: &str) -> &str {\n    if x.len() > y.len() {\n        x\n    } else {\n        y\n    }\n}\n\nfn main() {}`, `98001239518576400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加合适的生命周期标注，让下面的代码工作 */</span>\n<span class="token keyword">fn</span> <span class="token function">longest</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> x<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> y<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        x\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        y\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-180"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-180" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21581049217754587000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加合适的生命周期标注，让下面的代码工作 */\nfn longest<\'a>(x: &\'a str, y: &\'a str) -> &\'a str {\n    if x.len() > y.len() {\n        x\n    } else {\n        y\n    }\n}\n\nfn main() {}`, `21581049217754587000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加合适的生命周期标注，让下面的代码工作 */</span>\n<span class="token keyword">fn</span> longest<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> x<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> y<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        x\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        y\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-24"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21960281942217330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用三种方法修复下面的错误  */\nfn invalid_output<\'a>() -> &\'a String {\n    &String::from(&quot;foo&quot;)\n}\n\nfn main() {\n}`, `21960281942217330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使用三种方法修复下面的错误  */</span>\n<span class="token keyword">fn</span> invalid_output<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> String <span class="token punctuation">{</span>\n    <span class="token operator">&amp;</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-181"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-181" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62634663031276675000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用三种方法修复下面的错误  */\nfn invalid_output() -> String {\n    String::from(&quot;foo&quot;)\n}\n\nfn main() {\n}`, `62634663031276675000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使用三种方法修复下面的错误  */</span>\n<span class="token keyword">fn</span> <span class="token function">invalid_output</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-24"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93534448299834260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// \\`print_refs\\` 有两个引用参数，它们的生命周期 \\`\'a\\` 和 \\`\'b\\` 至少得跟函数活得一样久\nfn print_refs<\'a, \'b>(x: &\'a i32, y: &\'b i32) {\n    println!(&quot;x is {} and y is {}&quot;, x, y);\n}\n\n/* 让下面的代码工作 */\nfn failed_borrow<\'a>() {\n    let _x = 12;\n\n    // ERROR: \\`_x\\` 活得不够久does not live long enough\n    let y: &\'a i32 = &_x;\n\n    // 在函数内使用 \\`\'a\\` 将会报错，原因是 \\`&_x\\` 的生命周期显然比 \\`\'a\\` 要小\n    // 你不能将一个小的生命周期强转成大的\n}\n\nfn main() {\n    let (four, nine) = (4, 9);\n\n\n    print_refs(&four, &nine);\n    // 这里，four 和 nice 的生命周期必须要比函数 print_refs 长\n\n    failed_borrow();\n    // \\`failed_borrow\\`  没有传入任何引用去限制生命周期 \\`\'a\\`，因此，此时的 \\`\'a\\` 生命周期是没有任何限制的，它默认是 \\`\'static\\`\n}`, `93534448299834260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// `print_refs` 有两个引用参数，它们的生命周期 `\'a` 和 `\'b` 至少得跟函数活得一样久</span>\n<span class="token keyword">fn</span> print_refs<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is {} and y is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 让下面的代码工作 */</span>\n<span class="token keyword">fn</span> failed_borrow<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _x <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ERROR: `_x` 活得不够久does not live long enough</span>\n    <span class="token keyword">let</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32 <span class="token operator">=</span> <span class="token operator">&amp;</span>_x<span class="token punctuation">;</span>\n\n    <span class="token comment">// 在函数内使用 `\'a` 将会报错，原因是 `&amp;_x` 的生命周期显然比 `\'a` 要小</span>\n    <span class="token comment">// 你不能将一个小的生命周期强转成大的</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>four<span class="token punctuation">,</span> nine<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n    <span class="token function">print_refs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>four<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nine<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 这里，four 和 nice 的生命周期必须要比函数 print_refs 长</span>\n\n    <span class="token function">failed_borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// `failed_borrow`  没有传入任何引用去限制生命周期 `\'a`，因此，此时的 `\'a` 生命周期是没有任何限制的，它默认是 `\'static`</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-182"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-182" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57076892349546200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// \\`print_refs\\` 有两个引用参数，它们的生命周期 \\`\'a\\` 和 \\`\'b\\` 至少得跟函数活得一样久\nfn print_refs<\'a, \'b>(x: &\'a i32, y: &\'b i32) {\n    println!(&quot;x is {} and y is {}&quot;, x, y);\n}\n\n/* 让下面的代码工作 */\nfn failed_borrow() {\n    let _x = 12;\n\n    // ERROR: \\`_x\\` 活得不够久does not live long enough\n    let y = &_x;\n\n    // 在函数内使用 \\`\'a\\` 将会报错，原因是 \\`&_x\\` 的生命周期显然比 \\`\'a\\` 要小\n    // 你不能将一个小的生命周期强转成大的\n}\n\nfn main() {\n    let (four, nine) = (4, 9);\n\n    print_refs(&four, &nine);\n    // 这里，four 和 nice 的生命周期必须要比函数 print_refs 长\n\n    failed_borrow();\n    // \\`failed_borrow\\`  没有传入任何引用去限制生命周期 \\`\'a\\`，因此，此时的 \\`\'a\\` 生命周期是没有任何限制的，它默认是 \\`\'static\\`\n}`, `57076892349546200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// `print_refs` 有两个引用参数，它们的生命周期 `\'a` 和 `\'b` 至少得跟函数活得一样久</span>\n<span class="token keyword">fn</span> print_refs<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is {} and y is {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 让下面的代码工作 */</span>\n<span class="token keyword">fn</span> <span class="token function">failed_borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _x <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// ERROR: `_x` 活得不够久does not live long enough</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>_x<span class="token punctuation">;</span>\n\n    <span class="token comment">// 在函数内使用 `\'a` 将会报错，原因是 `&amp;_x` 的生命周期显然比 `\'a` 要小</span>\n    <span class="token comment">// 你不能将一个小的生命周期强转成大的</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>four<span class="token punctuation">,</span> nine<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_refs</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>four<span class="token punctuation">,</span> <span class="token operator">&amp;</span>nine<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 这里，four 和 nice 的生命周期必须要比函数 print_refs 长</span>\n\n    <span class="token function">failed_borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// `failed_borrow`  没有传入任何引用去限制生命周期 `\'a`，因此，此时的 `\'a` 生命周期是没有任何限制的，它默认是 `\'static`</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-20"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8785050109542647000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 增加合适的生命周期标准，让代码工作 */\n\n// \\`i32\\` 的引用必须比 \\`Borrowed\\` 活得更久\n#[derive(Debug)]\nstruct Borrowed(&i32);\n\n// 类似的，下面两个引用也必须比结构体 \\`NamedBorrowed\\` 活得更久\n#[derive(Debug)]\nstruct NamedBorrowed {\n    x: &i32,\n    y: &i32,\n}\n\n#[derive(Debug)]\nenum Either {\n    Num(i32),\n    Ref(&i32),\n}\n\nfn main() {\n    let x = 18;\n    let y = 15;\n\n    let single = Borrowed(&x);\n    let double = NamedBorrowed { x: &x, y: &y };\n    let reference = Either::Ref(&x);\n    let number    = Either::Num(y);\n\n    println!(&quot;x is borrowed in {:?}&quot;, single);\n    println!(&quot;x and y are borrowed in {:?}&quot;, double);\n    println!(&quot;x is borrowed in {:?}&quot;, reference);\n    println!(&quot;y is *not* borrowed in {:?}&quot;, number);\n}`, `8785050109542647000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 增加合适的生命周期标准，让代码工作 */</span>\n\n<span class="token comment">// `i32` 的引用必须比 `Borrowed` 活得更久</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> <span class="token function">Borrowed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 类似的，下面两个引用也必须比结构体 `NamedBorrowed` 活得更久</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> NamedBorrowed <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> Either <span class="token punctuation">{</span>\n    <span class="token function">Num</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">Ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> single <span class="token operator">=</span> <span class="token function">Borrowed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> double <span class="token operator">=</span> NamedBorrowed <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span>y <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> reference <span class="token operator">=</span> Either<span class="token punctuation">::</span><span class="token function">Ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> number    <span class="token operator">=</span> Either<span class="token punctuation">::</span><span class="token function">Num</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is borrowed in {:?}"</span><span class="token punctuation">,</span> single<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x and y are borrowed in {:?}"</span><span class="token punctuation">,</span> double<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is borrowed in {:?}"</span><span class="token punctuation">,</span> reference<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"y is *not* borrowed in {:?}"</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-183"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-183" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71399226199581655000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 增加合适的生命周期标准，让代码工作 */\n\n// \\`i32\\` 的引用必须比 \\`Borrowed\\` 活得更久\n#[derive(Debug)]\nstruct Borrowed<\'a>(&\'a i32);\n\n// 类似的，下面两个引用也必须比结构体 \\`NamedBorrowed\\` 活得更久\n#[derive(Debug)]\nstruct NamedBorrowed<\'a, \'b> {\n    x: &\'a i32,\n    y: &\'b i32,\n}\n\n#[derive(Debug)]\nenum Either<\'a> {\n    Num(i32),\n    Ref(&\'a i32),\n}\n\nfn main() {\n    let x = 18;\n    let y = 15;\n\n    let single = Borrowed(&x);\n    let double = NamedBorrowed { x: &x, y: &y };\n    let reference = Either::Ref(&x);\n    let number    = Either::Num(y);\n\n    println!(&quot;x is borrowed in {:?}&quot;, single);\n    println!(&quot;x and y are borrowed in {:?}&quot;, double);\n    println!(&quot;x is borrowed in {:?}&quot;, reference);\n    println!(&quot;y is *not* borrowed in {:?}&quot;, number);\n}`, `71399226199581655000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 增加合适的生命周期标准，让代码工作 */</span>\n\n<span class="token comment">// `i32` 的引用必须比 `Borrowed` 活得更久</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Borrowed<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 类似的，下面两个引用也必须比结构体 `NamedBorrowed` 活得更久</span>\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> NamedBorrowed<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">enum</span> Either<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">Num</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">Ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> single <span class="token operator">=</span> <span class="token function">Borrowed</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> double <span class="token operator">=</span> NamedBorrowed <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span>y <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> reference <span class="token operator">=</span> Either<span class="token punctuation">::</span><span class="token function">Ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> number    <span class="token operator">=</span> Either<span class="token punctuation">::</span><span class="token function">Num</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is borrowed in {:?}"</span><span class="token punctuation">,</span> single<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x and y are borrowed in {:?}"</span><span class="token punctuation">,</span> double<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"x is borrowed in {:?}"</span><span class="token punctuation">,</span> reference<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"y is *not* borrowed in {:?}"</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题七-12"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93045384393610310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 让代码工作 */\n\n#[derive(Debug)]\nstruct NoCopyType {}\n\n#[derive(Debug)]\nstruct Example<\'a, \'b> {\n    a: &\'a u32,\n    b: &\'b NoCopyType\n}\n\nfn main()\n{\n  let var_a = 35;\n  let example: Example;\n\n  {\n    let var_b = NoCopyType {};\n\n    /* 修复错误 */\n    example = Example { a: &var_a, b: &var_b };\n  }\n\n  println!(&quot;(Success!) {:?}&quot;, example);\n}`, `93045384393610310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 让代码工作 */</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Example<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> u32<span class="token punctuation">,</span>\n    b<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> NoCopyType\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">let</span> var_a <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> example<span class="token punctuation">:</span> Example<span class="token punctuation">;</span>\n\n  <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> var_b <span class="token operator">=</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">/* 修复错误 */</span>\n    example <span class="token operator">=</span> Example <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token operator">&amp;</span>var_a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token operator">&amp;</span>var_b <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"(Success!) {:?}"</span><span class="token punctuation">,</span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-184"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-184" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33510325788659245000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 让代码工作 */\n\n#[derive(Debug)]\nstruct NoCopyType {}\n\n#[derive(Debug)]\nstruct Example<\'a, \'b> {\n    a: &\'a u32,\n    b: &\'b NoCopyType,\n}\n\nfn main() {\n    let var_a = 35;\n    let example: Example;\n\n    let var_b = NoCopyType {};\n\n    /* 修复错误 */\n    example = Example {\n        a: &var_a,\n        b: &var_b,\n    };\n\n    println!(&quot;(Success!) {:?}&quot;, example);\n}`, `33510325788659245000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 让代码工作 */</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Example<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> u32<span class="token punctuation">,</span>\n    b<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> NoCopyType<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> var_a <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> example<span class="token punctuation">:</span> Example<span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> var_b <span class="token operator">=</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token comment">/* 修复错误 */</span>\n    example <span class="token operator">=</span> Example <span class="token punctuation">{</span>\n        a<span class="token punctuation">:</span> <span class="token operator">&amp;</span>var_a<span class="token punctuation">,</span>\n        b<span class="token punctuation">:</span> <span class="token operator">&amp;</span>var_b<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"(Success!) {:?}"</span><span class="token punctuation">,</span> example<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题八-10"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37527633867580530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct NoCopyType {}\n\n#[derive(Debug)]\n#[allow(dead_code)]\nstruct Example<\'a, \'b> {\n    a: &\'a u32,\n    b: &\'b NoCopyType\n}\n\n/* 修复函数的签名 */\nfn fix_me(foo: &Example) -> &NoCopyType\n{ foo.b }\n\nfn main()\n{\n    let no_copy = NoCopyType {};\n    let example = Example { a: &1, b: &no_copy };\n    fix_me(&example);\n    println!(&quot;Success!&quot;)\n}`, `37527633867580530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token attribute attr-name">#[allow(dead_code)]</span>\n<span class="token keyword">struct</span> Example<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> u32<span class="token punctuation">,</span>\n    b<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> NoCopyType\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 修复函数的签名 */</span>\n<span class="token keyword">fn</span> <span class="token function">fix_me</span><span class="token punctuation">(</span>foo<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Example<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>NoCopyType\n<span class="token punctuation">{</span> foo<span class="token punctuation">.</span>b <span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">let</span> no_copy <span class="token operator">=</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> example <span class="token operator">=</span> Example <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token operator">&amp;</span>no_copy <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">fix_me</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-185"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-185" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58387842144452580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct NoCopyType {}\n\n#[derive(Debug)]\n#[allow(dead_code)]\nstruct Example<\'a, \'b> {\n    a: &\'a u32,\n    b: &\'b NoCopyType,\n}\n\n/* 修复函数的签名 */\nfn fix_me<\'a>(foo: &\'a Example) -> &\'a NoCopyType {\n    foo.b\n}\n\nfn main() {\n    let no_copy = NoCopyType {};\n    let example = Example { a: &1, b: &no_copy };\n    fix_me(&example);\n    println!(&quot;Success!&quot;)\n}`, `58387842144452580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token attribute attr-name">#[allow(dead_code)]</span>\n<span class="token keyword">struct</span> Example<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> u32<span class="token punctuation">,</span>\n    b<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> NoCopyType<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 修复函数的签名 */</span>\n<span class="token keyword">fn</span> fix_me<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>foo<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> Example<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> NoCopyType <span class="token punctuation">{</span>\n    foo<span class="token punctuation">.</span>b\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> no_copy <span class="token operator">=</span> NoCopyType <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> example <span class="token operator">=</span> Example <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token operator">&amp;</span>no_copy <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">fix_me</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>example<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题九-9"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h3>\n<p>方法的生命周期标注跟函数类似</p>\n<p>示例</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61619620762627820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct Owner(i32);\n\nimpl Owner {\n    fn add_one<\'a>(&\'a mut self) { self.0 += 1; }\n    fn print<\'a>(&\'a self) {\n        println!(&quot;\\`print\\`: {}&quot;, self.0);\n    }\n}\n\nfn main() {\n    let mut owner = Owner(18);\n\n    owner.add_one();\n    owner.print();\n}`, `61619620762627820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">struct</span> <span class="token function">Owner</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> Owner <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> add_one<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token keyword">fn</span> print<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`print`: {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> owner <span class="token operator">=</span> <span class="token function">Owner</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    owner<span class="token punctuation">.</span><span class="token function">add_one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    owner<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6026315614842615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 显式添加生命周期 */\n\nstruct ImportantExcerpt<\'a> {\n    part: &\'a str,\n}\n\nimpl<\'a> ImportantExcerpt<\'a> {\n    fn announce_and_return_part(&self, announcement: &str) -> &str {\n        println!(&quot;Attention please: {}&quot;, announcement);\n        self.part\n    }\n}\n\nfn main() {}`, `6026315614842615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 显式添加生命周期 */</span>\n\n<span class="token keyword">struct</span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">announce_and_return_part</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>str <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Attention please: {}"</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>part\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-186"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-186" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56005619742589640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 显式添加生命周期 */\n\nstruct ImportantExcerpt<\'a> {\n    part: &\'a str,\n}\n\nimpl<\'a> ImportantExcerpt<\'a> {\n    fn announce_and_return_part<\'b>(&\'a self, announcement: &\'b str) -> &\'a str {\n        println!(&quot;Attention please: {}&quot;, announcement);\n        self.part\n    }\n}\n\nfn main() {}`, `56005619742589640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 显式添加生命周期 */</span>\n\n<span class="token keyword">struct</span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> announce_and_return_part<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Attention please: {}"</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>part\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50951313974533366000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 显式添加生命周期 */\n\nstruct ImportantExcerpt<\'a> {\n    part: &\'a str,\n}\n\nimpl<\'a: \'b, \'b> ImportantExcerpt<\'a> {\n    fn announce_and_return_part(&\'a self, announcement: &\'b str) -> &\'b str {\n        println!(&quot;Attention please: {}&quot;, announcement);\n        self.part\n    }\n}\n\nfn main() {}`, `50951313974533366000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 显式添加生命周期 */</span>\n\n<span class="token keyword">struct</span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a:</span> <span class="token lifetime-annotation symbol">\'b,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">announce_and_return_part</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Attention please: {}"</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>part\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2119063115155306200"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 显式添加生命周期 */\n\nstruct ImportantExcerpt<\'a> {\n    part: &\'a str,\n}\n\nimpl<\'a> ImportantExcerpt<\'a> {\n    fn announce_and_return_part<\'b>(&\'a self, announcement: &\'b str) -> &\'b str\n    where\n        \'a: \'b,\n    {\n        println!(&quot;Attention please: {}&quot;, announcement);\n        self.part\n    }\n}\n\nfn main() {}`, `2119063115155306200`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 显式添加生命周期 */</span>\n\n<span class="token keyword">struct</span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> announce_and_return_part<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str\n    <span class="token keyword">where</span>\n        <span class="token lifetime-annotation symbol">\'a:</span> <span class="token lifetime-annotation symbol">\'b,</span>\n    <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Attention please: {}"</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>part\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题十-5"><a href="#%E9%97%AE%E9%A2%98%E5%8D%81-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题十</h3>\n<p>有一些生命周期的标注方式很常见，因此编译器提供了一些规则，可以让我们在一些场景下无需去标注生命周期，既节省了敲击键盘的繁琐，又能提升可读性。</p>\n<p>这种规则被称为生命周期消除规则（Elision），该规则之所以存在，仅仅是因为这些场景太通用了，为了方便用户而已。事实上对于借用检查器而言，该有的生命周期一个都不能少，只不过对于用户而言，可以省去一些。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29492880801212396000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 移除所有可以消除的生命周期标注 */\n\nfn nput<\'a>(x: &\'a i32) {\n    println!(&quot;\\`annotated_input\\`: {}&quot;, x);\n}\n\nfn pass<\'a>(x: &\'a i32) -> &\'a i32 { x }\n\nfn longest<\'a, \'b>(x: &\'a str, y: &\'b str) -> &\'a str {\n    x\n}\n\nstruct Owner(i32);\n\nimpl Owner {\n    fn add_one<\'a>(&\'a mut self) { self.0 += 1; }\n    fn print<\'a>(&\'a self) {\n        println!(&quot;\\`print\\`: {}&quot;, self.0);\n    }\n}\n\nstruct Person<\'a> {\n    age: u8,\n    name: &\'a str,\n}\n\nenum Either<\'a> {\n    Num(i32),\n    Ref(&\'a i32),\n}\n\nfn main() {}`, `29492880801212396000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 移除所有可以消除的生命周期标注 */</span>\n\n<span class="token keyword">fn</span> nput<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`annotated_input`: {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> pass<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32 <span class="token punctuation">{</span> x <span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> longest<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str <span class="token punctuation">{</span>\n    x\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> <span class="token function">Owner</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> Owner <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> add_one<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token keyword">fn</span> print<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`print`: {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Person<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n    name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Either<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">Num</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">Ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-187"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-187" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15763170884337986000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 移除所有可以消除的生命周期标注 */\n\nfn nput(x: &i32) {\n    println!(&quot;\\`annotated_input\\`: {}&quot;, x);\n}\n\nfn pass(x: &i32) -> &i32 {\n    x\n}\n\nfn longest<\'a, \'b>(x: &\'a str, y: &\'b str) -> &\'a str {\n    x\n}\n\nstruct Owner(i32);\n\nimpl Owner {\n    fn add_one(&mut self) {\n        self.0 += 1;\n    }\n    fn prin(&self) {\n        println!(&quot;\\`print\\`: {}&quot;, self.0);\n    }\n}\n\nstruct Person<\'a> {\n    age: u8,\n    name: &\'a str,\n}\n\nenum Either<\'a> {\n    Num(i32),\n    Ref(&\'a i32),\n}\n\nfn main() {}`, `15763170884337986000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 移除所有可以消除的生命周期标注 */</span>\n\n<span class="token keyword">fn</span> <span class="token function">nput</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`annotated_input`: {}"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">pass</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span>i32 <span class="token punctuation">{</span>\n    x\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> longest<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str <span class="token punctuation">{</span>\n    x\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> <span class="token function">Owner</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">impl</span> Owner <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">add_one</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">fn</span> <span class="token function">prin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`print`: {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Person<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    age<span class="token punctuation">:</span> u8<span class="token punctuation">,</span>\n    name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> Either<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">Num</span><span class="token punctuation">(</span>i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token function">Ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="static-and-t-static"><a href="#static-and-t-static" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>&#x26;‘static and T: ‘static</h2>\n<h3 id="问题一-26"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>‘static 是一个 Rust 保留的生命周期名称，在之前我们可能已经见过好几次了:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50273503740594405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(unused)]\nfn main() {\n   // 引用的生命周期是 \'static :\n   let s: &\'static str = &quot;hello world&quot;;\n\n   // \'static 也可以用于特征约束中:\n   fn generic<T>(x: T) where T: \'static {}\n}`, `50273503740594405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(unused)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 引用的生命周期是 \'static :</span>\n   <span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> str <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// \'static 也可以用于特征约束中:</span>\n   <span class="token keyword">fn</span> generic<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token keyword">where</span> T<span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">\'static</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>虽然它们都是 ‘static，但是也稍有不同。</p>\n<p>作为一个引用生命周期，&#x26;‘static 说明该引用指向的数据可以跟程序活得一样久，但是该引用的生命周期依然有可能被强转为一个更短的生命周期。</p>\n<p>有好几种方法可以将一个变量标记为 ‘static 生命周期，其中两种都是和保存在二进制文件中相关（例如字符串字面量就是保存在二进制文件中，它的生命周期是 ‘static）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="845162457835124600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用两种方法填空 */\nfn main() {\n    __;\n    need_static(v);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn need_static(r : &\'static str) {\n    assert_eq!(r, &quot;hello&quot;);\n}`, `845162457835124600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使用两种方法填空 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    __<span class="token punctuation">;</span>\n    <span class="token function">need_static</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">need_static</span><span class="token punctuation">(</span>r <span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-188"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-188" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2010017918233297700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用两种方法填空 */\nfn main() {\n    let v: &\'static str = &quot;hello&quot;;\n    need_static(v);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn need_static(r : &\'static str) {\n    assert_eq!(r, &quot;hello&quot;);\n}`, `2010017918233297700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使用两种方法填空 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> str <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n    <span class="token function">need_static</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">need_static</span><span class="token punctuation">(</span>r <span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83598413519258850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用两种方法填空 */\nfn main() {\n    let v = &quot;hello&quot;;\n    need_static(v);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn need_static(r : &\'static str) {\n    assert_eq!(r, &quot;hello&quot;);\n}`, `83598413519258850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使用两种方法填空 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>\n    <span class="token function">need_static</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">need_static</span><span class="token punctuation">(</span>r <span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-26"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>使用 Box::leak 也可以产生 ‘static 生命周期</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69901089384933740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct Config {\n    a: String,\n    b: String,\n}\nstatic mut config: Option<&mut Config> = None;\n\n/* 让代码工作，但不要修改函数的签名 */\nfn init() -> Option<&\'static mut Config> {\n    Some(&mut Config {\n        a: &quot;A&quot;.to_string(),\n        b: &quot;B&quot;.to_string(),\n    })\n}\n\nfn main() {\n    unsafe {\n        config = init();\n\n        println!(&quot;{:?}&quot;,config)\n    }\n}`, `69901089384933740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Config <span class="token punctuation">{</span>\n    a<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    b<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">static</span> <span class="token keyword">mut</span> config<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> Config<span class="token operator">></span> <span class="token operator">=</span> None<span class="token punctuation">;</span>\n\n<span class="token comment">/* 让代码工作，但不要修改函数的签名 */</span>\n<span class="token keyword">fn</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> <span class="token keyword">mut</span> Config<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> Config <span class="token punctuation">{</span>\n        a<span class="token punctuation">:</span> <span class="token string">"A"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        b<span class="token punctuation">:</span> <span class="token string">"B"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>\n        config <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span>config<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-189"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-189" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93082038396561570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct Config {\n    a: String,\n    b: String,\n}\nstatic mut config: Option<&mut Config> = None;\n\n/* 让代码工作，但不要修改函数的签名 */\nfn init() -> Option<&\'static mut Config> {\n    Some(Box::leak(Box::new(Config {\n        a: &quot;A&quot;.to_string(),\n        b: &quot;B&quot;.to_string(),\n    })))\n}\n\nfn main() {\n    unsafe {\n        config = init();\n\n        println!(&quot;{:?}&quot;, config)\n    }\n}`, `93082038396561570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Config <span class="token punctuation">{</span>\n    a<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n    b<span class="token punctuation">:</span> String<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">static</span> <span class="token keyword">mut</span> config<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> Config<span class="token operator">></span> <span class="token operator">=</span> None<span class="token punctuation">;</span>\n\n<span class="token comment">/* 让代码工作，但不要修改函数的签名 */</span>\n<span class="token keyword">fn</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> <span class="token keyword">mut</span> Config<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">Some</span><span class="token punctuation">(</span>Box<span class="token punctuation">::</span><span class="token function">leak</span><span class="token punctuation">(</span>Box<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>Config <span class="token punctuation">{</span>\n        a<span class="token punctuation">:</span> <span class="token string">"A"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        b<span class="token punctuation">:</span> <span class="token string">"B"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>\n        config <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-26"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>&#x26;‘static 只能说明引用指向的数据是能一直存活的，但是引用本身依然受限于它的作用域</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31700251564558512000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    {\n        // 字符串字面量能跟程序活得一样久，因此 \\`static_string\\` 的生命周期是 \\`\'static\\`\n        let static_string = &quot;I\'m in read-only memory&quot;;\n        println!(&quot;static_string: {}&quot;, static_string);\n\n        // 当 \\`static_string\\` 超出作用域时，该引用就无法再被使用，但是引用指向的数据（字符串字面量）依然保存在二进制 binary 所占用的内存中\n    }\n\n    println!(&quot;static_string reference remains alive: {}&quot;, static_string);\n}`, `31700251564558512000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n        <span class="token comment">// 字符串字面量能跟程序活得一样久，因此 `static_string` 的生命周期是 `\'static`</span>\n        <span class="token keyword">let</span> static_string <span class="token operator">=</span> <span class="token string">"I\'m in read-only memory"</span><span class="token punctuation">;</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"static_string: {}"</span><span class="token punctuation">,</span> static_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 当 `static_string` 超出作用域时，该引用就无法再被使用，但是引用指向的数据（字符串字面量）依然保存在二进制 binary 所占用的内存中</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"static_string reference remains alive: {}"</span><span class="token punctuation">,</span> static_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-190"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-190" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75873778772214370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 字符串字面量能跟程序活得一样久，因此 \\`static_string\\` 的生命周期是 \\`\'static\\`\n    let static_string = &quot;I\'m in read-only memory&quot;;\n    println!(&quot;static_string: {}&quot;, static_string);\n\n    // 当 \\`static_string\\` 超出作用域时，该引用就无法再被使用，但是引用指向的数据（字符串字面量）依然保存在二进制 binary 所占用的内存中\n\n    println!(&quot;static_string reference remains alive: {}&quot;, static_string);\n}`, `75873778772214370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 字符串字面量能跟程序活得一样久，因此 `static_string` 的生命周期是 `\'static`</span>\n    <span class="token keyword">let</span> static_string <span class="token operator">=</span> <span class="token string">"I\'m in read-only memory"</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"static_string: {}"</span><span class="token punctuation">,</span> static_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 当 `static_string` 超出作用域时，该引用就无法再被使用，但是引用指向的数据（字符串字面量）依然保存在二进制 binary 所占用的内存中</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"static_string reference remains alive: {}"</span><span class="token punctuation">,</span> static_string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-25"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>&#x26;‘static 可以被强转成一个较短的生命周期</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93105154927737400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 声明一个 static 常量，它拥有 \\`\'static\\` 生命周期.\nstatic NUM: i32 = 18;\n\n// 返回常量 \\`Num\\` 的引用，注意，这里的生命周期从 \\`\'static\\` 强转为 \\`\'a\\`\nfn coerce_static<\'a>(_: &\'a i32) -> &\'a i32 {\n    &NUM\n}\n\nfn main() {\n    {\n        let lifetime_num = 9;\n\n        let coerced_static = coerce_static(&lifetime_num);\n\n        println!(&quot;coerced_static: {}&quot;, coerced_static);\n    }\n\n    println!(&quot;NUM: {} stays accessible!&quot;, NUM);\n}`, `93105154927737400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 声明一个 static 常量，它拥有 `\'static` 生命周期.</span>\n<span class="token keyword">static</span> NUM<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 返回常量 `Num` 的引用，注意，这里的生命周期从 `\'static` 强转为 `\'a`</span>\n<span class="token keyword">fn</span> coerce_static<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32 <span class="token punctuation">{</span>\n    <span class="token operator">&amp;</span>NUM\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> lifetime_num <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">let</span> coerced_static <span class="token operator">=</span> <span class="token function">coerce_static</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lifetime_num<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"coerced_static: {}"</span><span class="token punctuation">,</span> coerced_static<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"NUM: {} stays accessible!"</span><span class="token punctuation">,</span> NUM<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-25"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>关于 ‘static 的特征约束详细解释，请参见 <a href="https://course.rs/advance/lifetime/static.html#t-static" target="_blank" rel="nofollow noreferrer noopener">Rust 语言圣经</a>，这里就不再赘述。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79518325307357700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 让代码工作 */\nuse std::fmt::Debug;\n\nfn print_it<T: Debug + \'static>(input: T) {\n    println!(&quot;\'static value passed in is: {:?}&quot;, input);\n}\n\nfn print_it1(input: impl Debug + \'static) {\n    println!(&quot;\'static value passed in is: {:?}&quot;, input);\n}\n\nfn print_it2<T: Debug + \'static>(input: &T) {\n    println!(&quot;\'static value passed in is: {:?}&quot;, input);\n}\n\nfn main() {\n    // i 是有所有权的数据，并没有包含任何引用，因此它是 \'static\n    let i = 5;\n    print_it(i);\n\n    // 但是 &i 是一个引用，生命周期受限于作用域，因此它不是 \'static\n    print_it(&i);\n\n    print_it1(&i);\n\n    // 但是下面的代码可以正常运行 !\n    print_it2(&i);\n}`, `79518325307357700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 让代码工作 */</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Debug<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> print_it<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Debug <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static</span><span class="token operator">></span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"\'static value passed in is: {:?}"</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_it1</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token keyword">impl</span> Debug <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"\'static value passed in is: {:?}"</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_it2<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Debug <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static</span><span class="token operator">></span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"\'static value passed in is: {:?}"</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// i 是有所有权的数据，并没有包含任何引用，因此它是 \'static</span>\n    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token function">print_it</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 但是 &amp;i 是一个引用，生命周期受限于作用域，因此它不是 \'static</span>\n    <span class="token function">print_it</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_it1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 但是下面的代码可以正常运行 !</span>\n    <span class="token function">print_it2</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-191"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-191" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85188174230435450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 让代码工作 */\nuse std::fmt::Debug;\n\nfn print_it<T: Debug + \'static>(input: T) {\n    println!(&quot;\'static value passed in is: {:?}&quot;, input);\n}\n\nfn print_it1(input: impl Debug + \'static) {\n    println!(&quot;\'static value passed in is: {:?}&quot;, input);\n}\n\nfn print_it2<T: Debug + \'static>(input: &T) {\n    println!(&quot;\'static value passed in is: {:?}&quot;, input);\n}\n\nfn main() {\n    // i 是有所有权的数据，并没有包含任何引用，因此它是 \'static\n    // static i: i32 = 5;\n    const i: i32 = 5;\n    print_it(i);\n\n    // 但是 &i 是一个引用，生命周期受限于 main 作用域，因此它不是 \'static\n    print_it(&i);\n\n    print_it1(&i);\n\n    // 但是下面的代码可以正常运行 !\n    print_it2(&i);\n}`, `85188174230435450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 让代码工作 */</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Debug<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> print_it<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Debug <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static</span><span class="token operator">></span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"\'static value passed in is: {:?}"</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_it1</span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token keyword">impl</span> Debug <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"\'static value passed in is: {:?}"</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_it2<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Debug <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static</span><span class="token operator">></span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"\'static value passed in is: {:?}"</span><span class="token punctuation">,</span> input<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// i 是有所有权的数据，并没有包含任何引用，因此它是 \'static</span>\n    <span class="token comment">// static i: i32 = 5;</span>\n    <span class="token keyword">const</span> i<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n    <span class="token function">print_it</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 但是 &amp;i 是一个引用，生命周期受限于 main 作用域，因此它不是 \'static</span>\n    <span class="token function">print_it</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_it1</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 但是下面的代码可以正常运行 !</span>\n    <span class="token function">print_it2</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-21"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-21" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97746566734781840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fmt::Display;\n\nfn main() {\n  let mut string = &quot;First&quot;.to_owned();\n\n  string.push_str(string.to_uppercase().as_str());\n  print_a(&string);\n  print_b(&string);\n  print_c(&string); // Compilation error\n  print_d(&string); // Compilation error\n  print_e(&string);\n  print_f(&string);\n  print_g(&string); // Compilation error\n}\n\nfn print_a<T: Display + \'static>(t: &T) {\n  println!(&quot;{}&quot;, t);\n}\n\nfn print_b<T>(t: &T)\nwhere\n  T: Display + \'static,\n{\n  println!(&quot;{}&quot;, t);\n}\n\nfn print_c(t: &\'static dyn Display) {\n  println!(&quot;{}&quot;, t)\n}\n\nfn print_d(t: &\'static impl Display) {\n  println!(&quot;{}&quot;, t)\n}\n\nfn print_e(t: &(dyn Display + \'static)) {\n  println!(&quot;{}&quot;, t)\n}\n\nfn print_f(t: &(impl Display + \'static)) {\n  println!(&quot;{}&quot;, t)\n}\n\nfn print_g(t: &\'static String) {\n  println!(&quot;{}&quot;, t);\n}`, `97746566734781840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Display<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> <span class="token keyword">mut</span> string <span class="token operator">=</span> <span class="token string">"First"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  string<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">print_a</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">print_b</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">print_c</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Compilation error</span>\n  <span class="token function">print_d</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Compilation error</span>\n  <span class="token function">print_e</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">print_f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">print_g</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Compilation error</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_a<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_b<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span>\n<span class="token keyword">where</span>\n  T<span class="token punctuation">:</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static,</span>\n<span class="token punctuation">{</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_c</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> <span class="token keyword">dyn</span> Display<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_d</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> <span class="token keyword">impl</span> Display<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_e</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">dyn</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static))</span> <span class="token punctuation">{</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_f</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">impl</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static))</span> <span class="token punctuation">{</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_g</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'static</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-192"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-192" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40302201711413100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fmt::Display;\n\nfn main() {\n    let mut string = &quot;First&quot;.to_owned();\n\n    string.push_str(string.to_uppercase().as_str());\n    print_a(&string);\n    print_b(&string);\n    print_c(&string); // Compilation error\n    print_d(&string); // Compilation error\n    print_e(&string);\n    print_f(&string);\n    print_g(&string); // Compilation error\n}\n\nfn print_a<T: Display + \'static>(t: &T) {\n    println!(&quot;{}&quot;, t);\n}\n\nfn print_b<T>(t: &T)\nwhere\n    T: Display + \'static,\n{\n    println!(&quot;{}&quot;, t);\n}\n\nfn print_c<\'a>(t: &\'a dyn Display) {\n    println!(&quot;{}&quot;, t)\n}\n\nfn print_d<\'a>(t: &\'a impl Display) {\n    println!(&quot;{}&quot;, t)\n}\n\nfn print_e(t: &(dyn Display + \'static)) {\n    println!(&quot;{}&quot;, t)\n}\n\nfn print_f(t: &(impl Display + \'static)) {\n    println!(&quot;{}&quot;, t)\n}\n\nfn print_g<\'a>(t: &\'a String) {\n    println!(&quot;{}&quot;, t);\n}`, `40302201711413100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Display<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> string <span class="token operator">=</span> <span class="token string">"First"</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    string<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_a</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_b</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_c</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Compilation error</span>\n    <span class="token function">print_d</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Compilation error</span>\n    <span class="token function">print_e</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print_g</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Compilation error</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_a<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_b<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">)</span>\n<span class="token keyword">where</span>\n    T<span class="token punctuation">:</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static,</span>\n<span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_c<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">dyn</span> Display<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_d<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">impl</span> Display<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_e</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">dyn</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static))</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print_f</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">impl</span> Display <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'static))</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> print_g<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="深入"><a href="#%E6%B7%B1%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入</h2>\n<h3 id="问题一-27"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>就像泛型类型可以有约束一样，生命周期也可以有约束，如下所示：</p>\n<ul>\n<li><code class="language-text">T: &#39;a</code>，所有引用在 T 必须超过生命周期 ‘a</li>\n<li><code class="language-text">T: Trait + &#39;a</code>: T 必须实现特征 Trait 并且所有引用在 T 必须超过生命周期 ‘a</li>\n</ul>\n<p>示例</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65326014409315180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fmt::Debug; // 特征约束使用\n\n#[derive(Debug)]\nstruct Ref<\'a, T: \'a>(&\'a T);\n// \\`Ref\\` 包含对泛型类型 \\`T\\` 的引用，该泛型类型具有\n// 未知的生命周期 \\`\'a\\`. \\`T\\` 是约定任何\n// 引用在 \\`T\\` 必须大于 \\`\'a\\` 。此外，在生命周期\n// 里 \\`Ref\\` 不能超过 \\`\'a\\`。\n\n// 使用 \\`Debug\\` 特征打印的通用函数。\nfn print<T>(t: T) where\n    T: Debug {\n    println!(&quot;\\`print\\`: t is {:?}&quot;, t);\n}\n\n// 这里引用 \\`T\\` 使用 where \\`T\\` 实现\n// \\`Debug\\` 和所有引用 \\`T\\` 都要比 \\`\'a\\` 长\n// 此外，\\`\'a\\`必须要比函数声明周期长\nfn print_ref<\'a, T>(t: &\'a T) where\n    T: Debug + \'a {\n    println!(&quot;\\`print_ref\\`: t is {:?}&quot;, t);\n}\n\nfn main() {\n    let x = 7;\n    let ref_x = Ref(&x);\n\n    print_ref(&ref_x);\n    print(ref_x);\n}`, `65326014409315180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Debug<span class="token punctuation">;</span> <span class="token comment">// 特征约束使用</span>\n\n<span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Ref<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> T<span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> T<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// `Ref` 包含对泛型类型 `T` 的引用，该泛型类型具有</span>\n<span class="token comment">// 未知的生命周期 `\'a`. `T` 是约定任何</span>\n<span class="token comment">// 引用在 `T` 必须大于 `\'a` 。此外，在生命周期</span>\n<span class="token comment">// 里 `Ref` 不能超过 `\'a`。</span>\n\n<span class="token comment">// 使用 `Debug` 特征打印的通用函数。</span>\n<span class="token keyword">fn</span> print<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token keyword">where</span>\n    T<span class="token punctuation">:</span> Debug <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`print`: t is {:?}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 这里引用 `T` 使用 where `T` 实现</span>\n<span class="token comment">// `Debug` 和所有引用 `T` 都要比 `\'a` 长</span>\n<span class="token comment">// 此外，`\'a`必须要比函数声明周期长</span>\n<span class="token keyword">fn</span> print_ref<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> T<span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> T<span class="token punctuation">)</span> <span class="token keyword">where</span>\n    T<span class="token punctuation">:</span> Debug <span class="token operator">+</span> <span class="token lifetime-annotation symbol">\'a</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"`print_ref`: t is {:?}"</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ref_x <span class="token operator">=</span> <span class="token function">Ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">print_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ref_x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>ref_x<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82256276646976630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用生命周期注释结构体\n1. \\`r\\` 和 \\`s\\` 必须是不同生命周期\n2. \\`s\\` 的生命周期需要大于 \'r\'\n*/\nstruct DoubleRef<T> {\n    r: &T,\n    s: &T\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `82256276646976630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使用生命周期注释结构体\n1. `r` 和 `s` 必须是不同生命周期\n2. `s` 的生命周期需要大于 \'r\'\n*/</span>\n<span class="token keyword">struct</span> DoubleRef<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token punctuation">{</span>\n    r<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T<span class="token punctuation">,</span>\n    s<span class="token punctuation">:</span> <span class="token operator">&amp;</span>T\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-193"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-193" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38487377374796310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用生命周期注释结构体\n1. \\`r\\` 和 \\`s\\` 必须是不同生命周期\n2. \\`s\\` 的生命周期需要大于 \'r\'\n*/\nstruct DoubleRef<\'a, \'b: \'a, T> {\n    r: &\'a T,\n    s: &\'b T,\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `38487377374796310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使用生命周期注释结构体\n1. `r` 和 `s` 必须是不同生命周期\n2. `s` 的生命周期需要大于 \'r\'\n*/</span>\n<span class="token keyword">struct</span> DoubleRef<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b:</span> <span class="token lifetime-annotation symbol">\'a,</span> T<span class="token operator">></span> <span class="token punctuation">{</span>\n    r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> T<span class="token punctuation">,</span>\n    s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> T<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-27"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14113335077579880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加类型约束使下面代码正常运行 */\nstruct ImportantExcerpt<\'a> {\n    part: &\'a str,\n}\n\nimpl<\'a, \'b> ImportantExcerpt<\'a> {\n    fn announce_and_return_part(&\'a self, announcement: &\'b str) -> &\'b str {\n        println!(&quot;Attention please: {}&quot;, announcement);\n        self.part\n    }\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `14113335077579880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加类型约束使下面代码正常运行 */</span>\n<span class="token keyword">struct</span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">announce_and_return_part</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Attention please: {}"</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>part\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-194"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-194" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77979895825595070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加类型约束使下面代码正常运行 */\nstruct ImportantExcerpt<\'a> {\n    part: &\'a str,\n}\n\nimpl<\'a: \'b, \'b> ImportantExcerpt<\'a> {\n    fn announce_and_return_part(&\'a self, announcement: &\'b str) -> &\'b str {\n        println!(&quot;Attention please: {}&quot;, announcement);\n        self.part\n    }\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `77979895825595070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加类型约束使下面代码正常运行 */</span>\n<span class="token keyword">struct</span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a:</span> <span class="token lifetime-annotation symbol">\'b,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> ImportantExcerpt<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">announce_and_return_part</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str<span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> str <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Attention please: {}"</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>part\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-27"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60915565019268915000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加类型约束使下面代码正常运行 */\nfn f<\'a, \'b>(x: &\'a i32, mut y: &\'b i32) {\n    y = x;\n    let r: &\'b &\'a i32 = &&0;\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `60915565019268915000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加类型约束使下面代码正常运行 */</span>\n<span class="token keyword">fn</span> f<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32 <span class="token operator">=</span> <span class="token operator">&amp;&amp;</span><span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-195"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-195" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45831687822725505000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加类型约束使下面代码正常运行 */\nfn f<\'a: \'b, \'b>(x: &\'a i32, mut y: &\'b i32) {\n    y = x;\n    let r: &\'b &\'a i32 = &&0;\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `45831687822725505000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加类型约束使下面代码正常运行 */</span>\n<span class="token keyword">fn</span> f<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a:</span> <span class="token lifetime-annotation symbol">\'b,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32 <span class="token operator">=</span> <span class="token operator">&amp;&amp;</span><span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68031238257750704000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加类型约束使下面代码正常运行 */\nfn f<\'a, \'b>(x: &\'a i32, mut y: &\'b i32)\nwhere\n    \'a: \'b,\n{\n    y = x;\n    let r: &\'b &\'a i32 = &&0;\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `68031238257750704000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加类型约束使下面代码正常运行 */</span>\n<span class="token keyword">fn</span> f<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">,</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span>\n<span class="token keyword">where</span>\n    <span class="token lifetime-annotation symbol">\'a:</span> <span class="token lifetime-annotation symbol">\'b,</span>\n<span class="token punctuation">{</span>\n    y <span class="token operator">=</span> x<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32 <span class="token operator">=</span> <span class="token operator">&amp;&amp;</span><span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-26"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>类型约束可能在生命周期中排名更高。这些约束指定了一个约束对于所有生命周期都为真。例如，诸如此类的约束 <code class="language-text">for&lt;&#39;a&gt; &amp;&#39;a T: PartialEq&lt;i32&gt;</code> 需要如下实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51549325431752190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`impl<\'a> PartialEq<i32> for &\'a T {\n   // ...\n}`, `51549325431752190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> PartialEq<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token keyword">for</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> T <span class="token punctuation">{</span>\n   <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后可以用于将一个 <code class="language-text">&amp;&#39;a T</code> 与任何生命周期进行比较 i32。</p>\n<p>这里只能使用更高级别的约束，因为引用的生命周期比函数上任何可能的生命周期参数都短。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37847012842745496000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加 HRTB 使下面代码正常运行！ */\nfn call_on_ref_zero<\'a, F>(f: F) where F: Fn(&\'a i32) {\n    let zero = 0;\n    f(&zero);\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `37847012842745496000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加 HRTB 使下面代码正常运行！ */</span>\n<span class="token keyword">fn</span> call_on_ref_zero<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> F<span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> F<span class="token punctuation">)</span> <span class="token keyword">where</span> F<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>zero<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-196"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-196" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91620253905189850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 添加 HRTB 使下面代码正常运行！ */\nfn call_on_ref_zero<\'a, F>(f: F)\nwhere\n    for<\'b> F: Fn(&\'b i32),\n{\n    let zero = 0;\n    f(&zero);\n}\n\nfn main() {\n    println!(&quot;Success!&quot;)\n}`, `91620253905189850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 添加 HRTB 使下面代码正常运行！ */</span>\n<span class="token keyword">fn</span> call_on_ref_zero<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> F<span class="token operator">></span><span class="token punctuation">(</span>f<span class="token punctuation">:</span> F<span class="token punctuation">)</span>\n<span class="token keyword">where</span>\n    <span class="token keyword">for</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> F<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> i32<span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">let</span> zero <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>zero<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-26"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-26" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>在解释 NLL 之前，我们先看一段代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60218178417984630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   let mut s = String::from(&quot;hello&quot;);\n\n    let r1 = &s;\n    let r2 = &s;\n    println!(&quot;{} and {}&quot;, r1, r2);\n\n    let r3 = &mut s;\n    println!(&quot;{}&quot;, r3);\n}`, `60218178417984630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span>s<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{} and {}"</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> r3 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> r3<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>根据我们目前的知识，这段代码会因为违反 Rust 中的借用规则而导致错误。</p>\n<p>但是，如果您执行 cargo run，那么一切都没问题，那么这里发生了什么？</p>\n<p>编译器在作用域结束之前判断不再使用引用的能力称为非词法生命周期（简称 NLL）。</p>\n<p>有了这种能力，编译器就知道最后一次使用引用是什么时候，并根据这些知识优化借用规则。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95827004554694570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`let mut u = 0i32;\nlet mut v = 1i32;\nlet mut w = 2i32;\n\n// lifetime of \\`a\\` = α ∪ β ∪ γ\nlet mut a = &mut u;     // --+ α. lifetime of \\`&mut u\\`  --+ lexical &quot;lifetime&quot; of \\`&mut u\\`,\\`&mut u\\`, \\`&mut w\\` and \\`a\\`\nuse(a);                 //   |                            |\n*a = 3; // <-----------------+                            |\n...                     //                                |\na = &mut v;             // --+ β. lifetime of \\`&mut v\\`    |\nuse(a);                 //   |                            |\n*a = 4; // <-----------------+                            |\n...                     //                                |\na = &mut w;             // --+ γ. lifetime of \\`&mut w\\`    |\nuse(a);                 //   |                            |\n*a = 5; // <-----------------+ <--------------------------+`, `95827004554694570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">let</span> <span class="token keyword">mut</span> u <span class="token operator">=</span> <span class="token number">0i32</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> <span class="token number">1i32</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> <span class="token keyword">mut</span> w <span class="token operator">=</span> <span class="token number">2i32</span><span class="token punctuation">;</span>\n\n<span class="token comment">// lifetime of `a` = α ∪ β ∪ γ</span>\n<span class="token keyword">let</span> <span class="token keyword">mut</span> a <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> u<span class="token punctuation">;</span>     <span class="token comment">// --+ α. lifetime of `&amp;mut u`  --+ lexical "lifetime" of `&amp;mut u`,`&amp;mut u`, `&amp;mut w` and `a`</span>\n<span class="token keyword">use</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">//   |                            |</span>\n<span class="token operator">*</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-----------------+                            |</span>\n<span class="token punctuation">...</span>                     <span class="token comment">//                                |</span>\na <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> v<span class="token punctuation">;</span>             <span class="token comment">// --+ β. lifetime of `&amp;mut v`    |</span>\n<span class="token keyword">use</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">//   |                            |</span>\n<span class="token operator">*</span>a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-----------------+                            |</span>\n<span class="token punctuation">...</span>                     <span class="token comment">//                                |</span>\na <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> w<span class="token punctuation">;</span>             <span class="token comment">// --+ γ. lifetime of `&amp;mut w`    |</span>\n<span class="token keyword">use</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">//   |                            |</span>\n<span class="token operator">*</span>a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-----------------+ &lt;--------------------------+</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>学习了 NLL 之后，我们现在可以很容易地理解再借用了。</p>\n<p>示例</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8578416268092526000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[derive(Debug)]\nstruct Point {\n    x: i32,\n    y: i32,\n}\n\nimpl Point {\n    fn move_to(&mut self, x: i32, y: i32) {\n        self.x = x;\n        self.y = y;\n    }\n}\n\nfn main() {\n    let mut p = Point { x: 0, y: 0 };\n    let r = &mut p;\n    // 这里是再借用\n    let rr: &Point = &*r;\n\n    println!(&quot;{:?}&quot;, rr); // 这里结束再借用\n\n    // 再借用结束，现在我们可以继续使用 \\`r\\`\n    r.move_to(10, 10);\n    println!(&quot;{:?}&quot;, r);\n}`, `8578416268092526000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[derive(Debug)]</span>\n<span class="token keyword">struct</span> Point <span class="token punctuation">{</span>\n    x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n    y<span class="token punctuation">:</span> i32<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span> Point <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">move_to</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>\n        <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> p <span class="token operator">=</span> Point <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> p<span class="token punctuation">;</span>\n    <span class="token comment">// 这里是再借用</span>\n    <span class="token keyword">let</span> rr<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Point <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">*</span>r<span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> rr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里结束再借用</span>\n\n    <span class="token comment">// 再借用结束，现在我们可以继续使用 `r`</span>\n    r<span class="token punctuation">.</span><span class="token function">move_to</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45723651660312070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 通过重新排序一些代码使下面代码正常运行 */\nfn main() {\n    let mut data = 10;\n    let ref1 = &mut data;\n    let ref2 = &mut *ref1;\n\n    *ref1 += 1;\n    *ref2 += 2;\n\n    println!(&quot;{}&quot;, data);\n}`, `45723651660312070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 通过重新排序一些代码使下面代码正常运行 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> data <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ref1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> data<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ref2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">*</span>ref1<span class="token punctuation">;</span>\n\n    <span class="token operator">*</span>ref1 <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token operator">*</span>ref2 <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-197"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-197" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56620589003901610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 通过重新排序一些代码使下面代码正常运行 */\nfn main() {\n    let mut data = 10;\n    let ref1 = &mut data;\n    let ref2 = &mut *ref1;\n\n    *ref2 += 2;\n    *ref1 += 1;\n\n    println!(&quot;{}&quot;, data);\n}`, `56620589003901610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 通过重新排序一些代码使下面代码正常运行 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> data <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ref1 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> data<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ref2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token operator">*</span>ref1<span class="token punctuation">;</span>\n\n    <span class="token operator">*</span>ref2 <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n    <span class="token operator">*</span>ref1 <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-22"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-22" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>未约束的生命周期：在 <a href="https://doc.rust-lang.org/nomicon/unbounded-lifetimes.html" target="_blank" rel="nofollow noreferrer noopener">Nomicon - Unbounded Lifetimes</a> 中查看更多信息。</p>\n<p>更多省略规则</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22266281808512754000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`impl<\'a> Reader for BufReader<\'a> {\n    // \'a 在以下方法中不使用\n}\n\n// 可以写为：\nimpl Reader for BufReader<\'_> {\n\n}`, `22266281808512754000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> Reader <span class="token keyword">for</span> BufReader<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// \'a 在以下方法中不使用</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 可以写为：</span>\n<span class="token keyword">impl</span> Reader <span class="token keyword">for</span> BufReader<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'_</span><span class="token operator">></span> <span class="token punctuation">{</span>\n\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44324136315820910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Rust 2015\nstruct Ref<\'a, T: \'a> {\n    field: &\'a T\n}\n\n// Rust 2018\nstruct Ref<\'a, T> {\n    field: &\'a T\n}`, `44324136315820910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// Rust 2015</span>\n<span class="token keyword">struct</span> Ref<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> T<span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    field<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> T\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Rust 2018</span>\n<span class="token keyword">struct</span> Ref<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> T<span class="token operator">></span> <span class="token punctuation">{</span>\n    field<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> T\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44023355528578654000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使下面代码正常运行 */\nstruct Interface<\'a> {\n    manager: &\'a mut Manager<\'a>\n}\n\nimpl<\'a> Interface<\'a> {\n    pub fn noop(self) {\n        println!(&quot;interface consumed&quot;);\n    }\n}\n\nstruct Manager<\'a> {\n    text: &\'a str\n}\n\nstruct List<\'a> {\n    manager: Manager<\'a>,\n}\n\nimpl<\'a> List<\'a> {\n    pub fn get_interface(&\'a mut self) -> Interface {\n        Interface {\n            manager: &mut self.manager\n        }\n    }\n}\n\nfn main() {\n    let mut list = List {\n        manager: Manager {\n            text: &quot;hello&quot;\n        }\n    };\n\n    list.get_interface().noop();\n\n    println!(&quot;Interface should be dropped here and the borrow released&quot;);\n\n    use_list(&list);\n}\n\nfn use_list(list: &List) {\n    println!(&quot;{}&quot;, list.manager.text);\n}`, `44023355528578654000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使下面代码正常运行 */</span>\n<span class="token keyword">struct</span> Interface<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    manager<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">mut</span> Manager<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> Interface<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">noop</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"interface consumed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Manager<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    text<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> List<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    manager<span class="token punctuation">:</span> Manager<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> List<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">get_interface</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> <span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Interface <span class="token punctuation">{</span>\n        Interface <span class="token punctuation">{</span>\n            manager<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>manager\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> list <span class="token operator">=</span> List <span class="token punctuation">{</span>\n        manager<span class="token punctuation">:</span> Manager <span class="token punctuation">{</span>\n            text<span class="token punctuation">:</span> <span class="token string">"hello"</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    list<span class="token punctuation">.</span><span class="token function">get_interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Interface should be dropped here and the borrow released"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">use_list</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">use_list</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> <span class="token operator">&amp;</span>List<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span>manager<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-198"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-198" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45290892991597520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使下面代码正常运行 */\nstruct Interface<\'a, \'b> {\n    manager: &\'b mut Manager<\'a>,\n}\n\nimpl<\'a, \'b> Interface<\'a, \'b> {\n    pub fn noop(self) {\n        println!(&quot;interface consumed&quot;);\n    }\n}\n\nstruct Manager<\'a> {\n    text: &\'a str,\n}\n\nstruct List<\'a> {\n    manager: Manager<\'a>,\n}\n\nimpl<\'a> List<\'a> {\n    pub fn get_interface<\'b>(&\'b mut self) -> Interface<\'a, \'b> {\n        Interface {\n            manager: &mut self.manager,\n        }\n    }\n}\n\nfn main() {\n    let mut list = List {\n        manager: Manager { text: &quot;hello&quot; },\n    };\n\n    list.get_interface().noop();\n\n    println!(&quot;Interface should be dropped here and the borrow released&quot;);\n\n    use_list(&list);\n}\n\nfn use_list(list: &List) {\n    println!(&quot;{}&quot;, list.manager.text);\n}`, `45290892991597520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 使下面代码正常运行 */</span>\n<span class="token keyword">struct</span> Interface<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    manager<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> <span class="token keyword">mut</span> Manager<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> Interface<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">noop</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"interface consumed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> Manager<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    text<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'a</span> str<span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> List<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    manager<span class="token punctuation">:</span> Manager<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> List<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a</span><span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> get_interface<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">\'b</span> <span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Interface<span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">\'a,</span> <span class="token lifetime-annotation symbol">\'b</span><span class="token operator">></span> <span class="token punctuation">{</span>\n        Interface <span class="token punctuation">{</span>\n            manager<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">.</span>manager<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> list <span class="token operator">=</span> List <span class="token punctuation">{</span>\n        manager<span class="token punctuation">:</span> Manager <span class="token punctuation">{</span> text<span class="token punctuation">:</span> <span class="token string">"hello"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    list<span class="token punctuation">.</span><span class="token function">get_interface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Interface should be dropped here and the borrow released"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">use_list</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">use_list</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> <span class="token operator">&amp;</span>List<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> list<span class="token punctuation">.</span>manager<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="返回值和错误处理"><a href="#%E8%BF%94%E5%9B%9E%E5%80%BC%E5%92%8C%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>返回值和错误处理</h1>\n<h2 id="panic-深入剖析"><a href="#panic-%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>panic! 深入剖析</h2>\n<h3 id="问题一-28"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>Rust 中最简单的错误处理方式就是使用 panic。它会打印出一条错误信息并打印出栈调用情况，最终结束当前线程:</p>\n<ul>\n<li>若 panic 发生在 main 线程，那程序会随之退出</li>\n<li>如果是在生成的（spawn）子线程中发生 panic，那么当前的线程会结束，但是程序依然会继续运行</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75828328523763350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn drink(beverage: &str) {\n    if beverage == &quot;lemonade&quot; {\n        println!(&quot;Success!&quot;);\n        // 实现下面的代码\n        __\n     }\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}\n\nfn main() {\n    drink(__);\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}`, `75828328523763350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">drink</span><span class="token punctuation">(</span>beverage<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> beverage <span class="token operator">==</span> <span class="token string">"lemonade"</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 实现下面的代码</span>\n        __\n     <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">drink</span><span class="token punctuation">(</span>__<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-199"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-199" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25718283948521116000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\nfn drink(beverage: &str) {\n    if beverage == &quot;lemonade&quot; {\n        println!(&quot;Success!&quot;);\n        // 实现下面的代码\n        panic!(&quot;32&quot;)\n    }\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}\n\nfn main() {\n    drink(&quot;lemonade&quot;);\n\n    println!(&quot;Exercise Failed if printing out this line!&quot;);\n}`, `25718283948521116000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token keyword">fn</span> <span class="token function">drink</span><span class="token punctuation">(</span>beverage<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> beverage <span class="token operator">==</span> <span class="token string">"lemonade"</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 实现下面的代码</span>\n        <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"32"</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">drink</span><span class="token punctuation">(</span><span class="token string">"lemonade"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Exercise Failed if printing out this line!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-28"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13772092408180337000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有的 panic，让代码工作\nfn main() {\n    assert_eq!(&quot;abc&quot;.as_bytes(), [96, 97, 98]);\n\n    let v = vec![1, 2, 3];\n    let ele = v[3];\n    let ele = v.get(3).unwrap();\n\n    // 大部分时候编译器是可以帮我们提前发现溢出错误，并阻止编译通过。但是也有一些时候，这种溢出问题直到运行期才会出现\n    let v = production_rate_per_hour(2);\n\n    divide(15, 0);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn divide(x:u8, y:u8) {\n    println!(&quot;{}&quot;, x / y)\n}\n\nfn production_rate_per_hour(speed: u8) -> f64 {\n    let cph: u8 = 221;\n    match speed {\n        1..=4 => (speed * cph) as f64,\n        5..=8 => (speed * cph) as f64 * 0.9,\n        9..=10 => (speed * cph) as f64 * 0.77,\n        _ => 0 as f64,\n    }\n}\n\npub fn working_items_per_minute(speed: u8) -> u32 {\n    (production_rate_per_hour(speed) / 60 as f64) as u32\n}`, `13772092408180337000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有的 panic，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 大部分时候编译器是可以帮我们提前发现溢出错误，并阻止编译通过。但是也有一些时候，这种溢出问题直到运行期才会出现</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">divide</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span>u8<span class="token punctuation">,</span> y<span class="token punctuation">:</span>u8<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x <span class="token operator">/</span> y<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">(</span>speed<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> f64 <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> cph<span class="token punctuation">:</span> u8 <span class="token operator">=</span> <span class="token number">221</span><span class="token punctuation">;</span>\n    <span class="token keyword">match</span> speed <span class="token punctuation">{</span>\n        <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">4</span> <span class="token operator">=></span> <span class="token punctuation">(</span>speed <span class="token operator">*</span> cph<span class="token punctuation">)</span> <span class="token keyword">as</span> f64<span class="token punctuation">,</span>\n        <span class="token number">5</span><span class="token punctuation">..=</span><span class="token number">8</span> <span class="token operator">=></span> <span class="token punctuation">(</span>speed <span class="token operator">*</span> cph<span class="token punctuation">)</span> <span class="token keyword">as</span> f64 <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">,</span>\n        <span class="token number">9</span><span class="token punctuation">..=</span><span class="token number">10</span> <span class="token operator">=></span> <span class="token punctuation">(</span>speed <span class="token operator">*</span> cph<span class="token punctuation">)</span> <span class="token keyword">as</span> f64 <span class="token operator">*</span> <span class="token number">0.77</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token number">0</span> <span class="token keyword">as</span> f64<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">working_items_per_minute</span><span class="token punctuation">(</span>speed<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n    <span class="token punctuation">(</span><span class="token function">production_rate_per_hour</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token keyword">as</span> f64<span class="token punctuation">)</span> <span class="token keyword">as</span> u32\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-200"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-200" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83899865373824430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 修复所有的 panic，让代码工作\nfn main() {\n    assert_eq!(&quot;abc&quot;.as_bytes(), [97, 98, 99]);\n\n    let v = vec![1, 2, 3];\n    let ele = v[2];\n    let ele = v.get(3);\n\n    // 大部分时候编译器是可以帮我们提前发现溢出错误，并阻止编译通过。但是也有一些时候，这种溢出问题直到运行期才会出现\n    let v = production_rate_per_hour(2);\n\n    divide(15, 1);\n\n    println!(&quot;Success!&quot;)\n}\n\nfn divide(x: u8, y: u8) {\n    println!(&quot;{}&quot;, x / y)\n}\n\nfn production_rate_per_hour(speed: u8) -> f64 {\n    let cph: u8 = 21;\n    match speed {\n        1..=4 => (speed * cph) as f64,\n        5..=8 => (speed * cph) as f64 * 0.9,\n        9..=10 => (speed * cph) as f64 * 0.77,\n        _ => 0 as f64,\n    }\n}\n\npub fn working_items_per_minute(speed: u8) -> u32 {\n    (production_rate_per_hour(speed) / 60 as f64) as u32\n}`, `83899865373824430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 修复所有的 panic，让代码工作</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> ele <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 大部分时候编译器是可以帮我们提前发现溢出错误，并阻止编译通过。但是也有一些时候，这种溢出问题直到运行期才会出现</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">divide</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">divide</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> u8<span class="token punctuation">,</span> y<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> x <span class="token operator">/</span> y<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">production_rate_per_hour</span><span class="token punctuation">(</span>speed<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> f64 <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> cph<span class="token punctuation">:</span> u8 <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span>\n    <span class="token keyword">match</span> speed <span class="token punctuation">{</span>\n        <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">4</span> <span class="token operator">=></span> <span class="token punctuation">(</span>speed <span class="token operator">*</span> cph<span class="token punctuation">)</span> <span class="token keyword">as</span> f64<span class="token punctuation">,</span>\n        <span class="token number">5</span><span class="token punctuation">..=</span><span class="token number">8</span> <span class="token operator">=></span> <span class="token punctuation">(</span>speed <span class="token operator">*</span> cph<span class="token punctuation">)</span> <span class="token keyword">as</span> f64 <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">,</span>\n        <span class="token number">9</span><span class="token punctuation">..=</span><span class="token number">10</span> <span class="token operator">=></span> <span class="token punctuation">(</span>speed <span class="token operator">*</span> cph<span class="token punctuation">)</span> <span class="token keyword">as</span> f64 <span class="token operator">*</span> <span class="token number">0.77</span><span class="token punctuation">,</span>\n        _ <span class="token operator">=></span> <span class="token number">0</span> <span class="token keyword">as</span> f64<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">working_items_per_minute</span><span class="token punctuation">(</span>speed<span class="token punctuation">:</span> u8<span class="token punctuation">)</span> <span class="token punctuation">-></span> u32 <span class="token punctuation">{</span>\n    <span class="token punctuation">(</span><span class="token function">production_rate_per_hour</span><span class="token punctuation">(</span>speed<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">60</span> <span class="token keyword">as</span> f64<span class="token punctuation">)</span> <span class="token keyword">as</span> u32\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-28"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>默认情况下，栈调用只会展示最基本的信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84815662011441350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`thread \'main\' panicked at \'index out of bounds: the len is 3 but the index is 99\', src/main.rs:4:5\nnote: run with \\`RUST_BACKTRACE=1\\` environment variable to display a backtrace`, `84815662011441350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">thread <span class="token string">\'main\'</span> panicked at <span class="token string">\'index out of bounds: the len is 3 but the index is 99\'</span>, src/main.rs:4:5\nnote: run with <span class="token variable"><span class="token variable">`</span><span class="token assign-left variable">RUST_BACKTRACE</span><span class="token operator">=</span><span class="token number">1</span><span class="token variable">`</span></span> environment variable to display a backtrace</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是有时候，我们还希望获取更详细的信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74599918498680730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`## 填空以打印全部的调用栈\n## 提示: 你可以在之前的默认 panic 信息中找到相关线索\n\\$ __ cargo run\nthread \'main\' panicked at \'assertion failed: \\`(left == right)\\`\n  left: \\`[97, 98, 99]\\`,\n right: \\`[96, 97, 98]\\`\', src/main.rs:3:5\nstack backtrace:\n   0: rust_begin_unwind\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/std/src/panicking.rs:498:5\n   1: core::panicking::panic_fmt\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/core/src/panicking.rs:116:14\n   2: core::panicking::assert_failed_inner\n   3: core::panicking::assert_failed\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/core/src/panicking.rs:154:5\n   4: study_cargo::main\n             at ./src/main.rs:3:5\n   5: core::ops::function::FnOnce::call_once\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/core/src/ops/function.rs:227:5\nnote: Some details are omitted, run with \\`RUST_BACKTRACE=full\\` for a verbose backtrace.`, `74599918498680730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment">## 填空以打印全部的调用栈</span>\n<span class="token comment">## 提示: 你可以在之前的默认 panic 信息中找到相关线索</span>\n$ __ cargo run\nthread <span class="token string">\'main\'</span> panicked at <span class="token string">\'assertion failed: <span class="token variable"><span class="token variable">`</span><span class="token punctuation">(</span>left <span class="token operator">==</span> right<span class="token punctuation">)</span><span class="token variable">`</span></span>\n  left: <span class="token variable"><span class="token variable">`</span><span class="token punctuation">[</span><span class="token number">97</span>, <span class="token number">98</span>, <span class="token number">99</span><span class="token punctuation">]</span><span class="token variable">`</span></span>,\n right: <span class="token variable"><span class="token variable">`</span><span class="token punctuation">[</span><span class="token number">96</span>, <span class="token number">97</span>, <span class="token number">98</span><span class="token punctuation">]</span><span class="token variable">`</span></span>\'</span>, src/main.rs:3:5\nstack backtrace:\n   <span class="token number">0</span>: rust_begin_unwind\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/std/src/panicking.rs:498:5\n   <span class="token number">1</span>: core::panicking::panic_fmt\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/core/src/panicking.rs:116:14\n   <span class="token number">2</span>: core::panicking::assert_failed_inner\n   <span class="token number">3</span>: core::panicking::assert_failed\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/core/src/panicking.rs:154:5\n   <span class="token number">4</span>: study_cargo::main\n             at ./src/main.rs:3:5\n   <span class="token number">5</span>: core::ops::function::FnOnce::call_once\n             at /rustc/9d1b2106e23b1abd32fce1f17267604a5102f57a/library/core/src/ops/function.rs:227:5\nnote: Some details are omitted, run with <span class="token variable"><span class="token variable">`</span><span class="token assign-left variable">RUST_BACKTRACE</span><span class="token operator">=</span>full<span class="token variable">`</span></span> <span class="token keyword">for</span> a verbose backtrace.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-201"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-201" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65753635484562235000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ RUST_BACKTRACE=full cargo run`, `65753635484562235000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token assign-left variable">RUST_BACKTRACE</span><span class="token operator">=</span>full cargo run</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="返回值-result-和-"><a href="#%E8%BF%94%E5%9B%9E%E5%80%BC-result-%E5%92%8C-" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>返回值 Result 和 ?</h2>\n<h3 id="问题一-29"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p><code class="language-text">Result&lt;T&gt;</code> 是一个枚举类型用于描述返回的结果或错误，它包含两个成员（变体 variants）:</p>\n<ul>\n<li>Ok(T): 返回一个结果值 T</li>\n<li>Err(e): 返回一个错误，e 是具体的错误值</li>\n</ul>\n<p>简而言之，如果期待一个正确的结果，就返回 Ok，反之则是 Err。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5194382420258803000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nuse std::num::ParseIntError;\n\nfn multiply(n1_str: &str, n2_str: &str) -> __ {\n    let n1 = n1_str.parse::<i32>();\n    let n2 = n2_str.parse::<i32>();\n    Ok(n1.unwrap() * n2.unwrap())\n}\n\nfn main() {\n    let result = multiply(&quot;10&quot;, &quot;2&quot;);\n    assert_eq!(result, __);\n\n    let result = multiply(&quot;t&quot;, &quot;2&quot;);\n    assert_eq!(result.__, 8);\n\n    println!(&quot;Success!&quot;)\n}`, `5194382420258803000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> __ <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n1 <span class="token operator">=</span> n1_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> n2 <span class="token operator">=</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">Ok</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> n2<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>__<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-202"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-202" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49246777893613806000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空并修复错误\nuse std::num::ParseIntError;\n\nfn multiply(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    let n1 = n1_str.parse::<i32>();\n    let n2 = n2_str.parse::<i32>();\n    Ok(n1.unwrap() * n2.unwrap())\n}\n\nfn main() {\n    let result = multiply(&quot;10&quot;, &quot;2&quot;);\n    assert_eq!(result, Ok(20));\n\n    let result = multiply(&quot;4&quot;, &quot;2&quot;);\n    assert_eq!(result.unwrap(), 8);\n\n    println!(&quot;Success!&quot;)\n}`, `49246777893613806000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n1 <span class="token operator">=</span> n1_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> n2 <span class="token operator">=</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">Ok</span><span class="token punctuation">(</span>n1<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> n2<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-29"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>? 跟 unwrap 非常像，但是 ? 会返回一个错误，而不是直接 panic</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17807343604005110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用 ? 来实现 multiply\n// 不要使用 unwrap !\nfn multiply(n1_str: &str, n2_str: &str) -> __ {\n}\n\nfn main() {\n    assert_eq!(multiply(&quot;3&quot;, &quot;4&quot;).unwrap(), 12);\n    println!(&quot;Success!&quot;)\n}`, `17807343604005110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用 ? 来实现 multiply</span>\n<span class="token comment">// 不要使用 unwrap !</span>\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> __ <span class="token punctuation">{</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-203"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-203" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7346645848352895000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用 ? 来实现 multiply\n// 不要使用 unwrap !\nfn multiply(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    let n1 = n1_str.parse::<i32>()?;\n    let n2 = n2_str.parse::<i32>()?;\n    Ok(n1 * n2)\n}\n\nfn main() {\n    assert_eq!(multiply(&quot;3&quot;, &quot;4&quot;).unwrap(), 12);\n    println!(&quot;Success!&quot;)\n}`, `7346645848352895000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用 ? 来实现 multiply</span>\n<span class="token comment">// 不要使用 unwrap !</span>\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> n1 <span class="token operator">=</span> n1_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> n2 <span class="token operator">=</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n    <span class="token function">Ok</span><span class="token punctuation">(</span>n1 <span class="token operator">*</span> n2<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-29"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42283457651322110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fs::File;\nuse std::io::{self, Read};\n\nfn read_file1() -> Result<String, io::Error> {\n    let f = File::open(&quot;hello.txt&quot;);\n    let mut f = match f {\n        Ok(file) => file,\n        Err(e) => return Err(e),\n    };\n\n    let mut s = String::new();\n    match f.read_to_string(&mut s) {\n        Ok(_) => Ok(s),\n        Err(e) => Err(e),\n    }\n}\n\n// 填空\n// 不要修改其它代码\nfn read_file2() -> Result<String, io::Error> {\n    let mut s = String::new();\n\n    __;\n\n    Ok(s)\n}\n\nfn main() {\n    assert_eq!(read_file1().unwrap_err().to_string(), read_file2().unwrap_err().to_string());\n    println!(&quot;Success!&quot;)\n}`, `42283457651322110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span>File<span class="token punctuation">;</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">::</span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> Read<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">read_file1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> io<span class="token punctuation">::</span>Error<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> File<span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> f <span class="token operator">=</span> <span class="token keyword">match</span> f <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">return</span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">match</span> f<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 填空</span>\n<span class="token comment">// 不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">read_file2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> io<span class="token punctuation">::</span>Error<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    __<span class="token punctuation">;</span>\n\n    <span class="token function">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">read_file1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">read_file2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-204"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-204" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86697929617106390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fs::File;\nuse std::io::{self, Read};\n\nfn read_file1() -> Result<String, io::Error> {\n    let f = File::open(&quot;hello.txt&quot;);\n    let mut f = match f {\n        Ok(file) => file,\n        Err(e) => return Err(e),\n    };\n\n    let mut s = String::new();\n    match f.read_to_string(&mut s) {\n        Ok(_) => Ok(s),\n        Err(e) => Err(e),\n    }\n}\n\n// 填空\n// 不要修改其它代码\nfn read_file2() -> Result<String, io::Error> {\n    let mut s = String::new();\n\n    File::open(&quot;hello.txt&quot;)?.read_to_string(&mut s)?;\n\n    Ok(s)\n}\n\nfn main() {\n    assert_eq!(\n        read_file1().unwrap_err().to_string(),\n        read_file2().unwrap_err().to_string()\n    );\n    println!(&quot;Success!&quot;)\n}`, `86697929617106390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span>File<span class="token punctuation">;</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">::</span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> Read<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">read_file1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> io<span class="token punctuation">::</span>Error<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> f <span class="token operator">=</span> File<span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> f <span class="token operator">=</span> <span class="token keyword">match</span> f <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=></span> file<span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">return</span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">match</span> f<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 填空</span>\n<span class="token comment">// 不要修改其它代码</span>\n<span class="token keyword">fn</span> <span class="token function">read_file2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> io<span class="token punctuation">::</span>Error<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> String<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    File<span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"hello.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n\n    <span class="token function">Ok</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>\n        <span class="token function">read_file1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">read_file2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-27"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>map 和 and_then 是两个常用的组合器（combinator），可以用于 <code class="language-text">Result&lt;T, E&gt;</code> (也可用于 <code class="language-text">Option&lt;T&gt;</code>)</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85383276295057010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用两种方式填空: map, and then\nfn add_two(n_str: &str) -> Result<i32, ParseIntError> {\n   n_str.parse::<i32>().__\n}\n\nfn main() {\n    assert_eq!(add_two(&quot;4&quot;).unwrap(), 6);\n\n    println!(&quot;Success!&quot;)\n}`, `85383276295057010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用两种方式填空: map, and then</span>\n<span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>n_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n   n_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">add_two</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-205"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-205" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86538945186202650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用两种方式填空: map, and then\nfn add_two(n_str: &str) -> Result<i32, ParseIntError> {\n    n_str.parse::<i32>().map(|x| x + 2)\n}\n\nfn main() {\n    assert_eq!(add_two(&quot;4&quot;).unwrap(), 6);\n\n    println!(&quot;Success!&quot;)\n}`, `86538945186202650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用两种方式填空: map, and then</span>\n<span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>n_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    n_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">add_two</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14793808613859793000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用两种方式填空: map, and then\nfn add_two(n_str: &str) -> Result<i32, ParseIntError> {\n    n_str.parse::<i32>().and_then(|x| Ok(x + 2))\n}\n\nfn main() {\n    assert_eq!(add_two(&quot;4&quot;).unwrap(), 6);\n\n    println!(&quot;Success!&quot;)\n}`, `14793808613859793000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用两种方式填空: map, and then</span>\n<span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>n_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    n_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> <span class="token function">Ok</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">add_two</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-27"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-27" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7734843614610609000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用 Result 重写后，我们使用模式匹配的方式来处理，而无需使用 \\`unwrap\\`\n// 但是这种写法实在过于啰嗦..\nfn multiply(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    match n1_str.parse::<i32>() {\n        Ok(n1)  => {\n            match n2_str.parse::<i32>() {\n                Ok(n2)  => {\n                    Ok(n1 * n2)\n                },\n                Err(e) => Err(e),\n            }\n        },\n        Err(e) => Err(e),\n    }\n}\n\n// 重写上面的 \\`multiply\\` ，让它尽量简洁\n// 提示：使用 \\`and_then\\` 和 \\`map\\`\nfn multiply1(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    // 实现...\n}\n\nfn print(result: Result<i32, ParseIntError>) {\n    match result {\n        Ok(n)  => println!(&quot;n is {}&quot;, n),\n        Err(e) => println!(&quot;Error: {}&quot;, e),\n    }\n}\n\nfn main() {\n    let twenty = multiply1(&quot;10&quot;, &quot;2&quot;);\n    print(twenty);\n\n    // 下面的调用会提供更有帮助的错误信息\n    let tt = multiply(&quot;t&quot;, &quot;2&quot;);\n    print(tt);\n\n    println!(&quot;Success!&quot;)\n}`, `7734843614610609000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用 Result 重写后，我们使用模式匹配的方式来处理，而无需使用 `unwrap`</span>\n<span class="token comment">// 但是这种写法实在过于啰嗦..</span>\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> n1_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span>  <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">match</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token function">Ok</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span>  <span class="token operator">=></span> <span class="token punctuation">{</span>\n                    <span class="token function">Ok</span><span class="token punctuation">(</span>n1 <span class="token operator">*</span> n2<span class="token punctuation">)</span>\n                <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 重写上面的 `multiply` ，让它尽量简洁</span>\n<span class="token comment">// 提示：使用 `and_then` 和 `map`</span>\n<span class="token keyword">fn</span> <span class="token function">multiply1</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 实现...</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">:</span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> result <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n is {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Error: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> twenty <span class="token operator">=</span> <span class="token function">multiply1</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>twenty<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 下面的调用会提供更有帮助的错误信息</span>\n    <span class="token keyword">let</span> tt <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-206"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-206" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60724822675226210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用 Result 重写后，我们使用模式匹配的方式来处理，而无需使用 \\`unwrap\\`\n// 但是这种写法实在过于啰嗦..\nfn multiply(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    match n1_str.parse::<i32>() {\n        Ok(n1) => match n2_str.parse::<i32>() {\n            Ok(n2) => Ok(n1 * n2),\n            Err(e) => Err(e),\n        },\n        Err(e) => Err(e),\n    }\n}\n\n// 重写上面的 \\`multiply\\` ，让它尽量简洁\n// 提示：使用 \\`and_then\\` 和 \\`map\\`\nfn multiply1(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    // 实现...\n    let a = n1_str.parse::<i32>()?;\n    let b = n2_str.parse::<i32>()?;\n    Ok(a + b)\n}\n\nfn print(result: Result<i32, ParseIntError>) {\n    match result {\n        Ok(n) => println!(&quot;n is {}&quot;, n),\n        Err(e) => println!(&quot;Error: {}&quot;, e),\n    }\n}\n\nfn main() {\n    let twenty = multiply1(&quot;10&quot;, &quot;2&quot;);\n    print(twenty);\n\n    // 下面的调用会提供更有帮助的错误信息\n    let tt = multiply(&quot;4&quot;, &quot;2&quot;);\n    print(tt);\n\n    println!(&quot;Success!&quot;)\n}`, `60724822675226210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用 Result 重写后，我们使用模式匹配的方式来处理，而无需使用 `unwrap`</span>\n<span class="token comment">// 但是这种写法实在过于啰嗦..</span>\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> n1_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">Ok</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Ok</span><span class="token punctuation">(</span>n1 <span class="token operator">*</span> n2<span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 重写上面的 `multiply` ，让它尽量简洁</span>\n<span class="token comment">// 提示：使用 `and_then` 和 `map`</span>\n<span class="token keyword">fn</span> <span class="token function">multiply1</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 实现...</span>\n    <span class="token keyword">let</span> a <span class="token operator">=</span> n1_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> b <span class="token operator">=</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>\n    <span class="token function">Ok</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">:</span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> result <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n is {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Error: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> twenty <span class="token operator">=</span> <span class="token function">multiply1</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>twenty<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 下面的调用会提供更有帮助的错误信息</span>\n    <span class="token keyword">let</span> tt <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24377029125337235000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 使用 Result 重写后，我们使用模式匹配的方式来处理，而无需使用 \\`unwrap\\`\n// 但是这种写法实在过于啰嗦..\nfn multiply(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    match n1_str.parse::<i32>() {\n        Ok(n1) => match n2_str.parse::<i32>() {\n            Ok(n2) => Ok(n1 * n2),\n            Err(e) => Err(e),\n        },\n        Err(e) => Err(e),\n    }\n}\n\n// 重写上面的 \\`multiply\\` ，让它尽量简洁\n// 提示：使用 \\`and_then\\` 和 \\`map\\`\nfn multiply1(n1_str: &str, n2_str: &str) -> Result<i32, ParseIntError> {\n    // 实现...\n    n1_str\n        .parse::<i32>()\n        .and_then(|x| n2_str.parse::<i32>().map(|y| x * y))\n}\n\nfn print(result: Result<i32, ParseIntError>) {\n    match result {\n        Ok(n) => println!(&quot;n is {}&quot;, n),\n        Err(e) => println!(&quot;Error: {}&quot;, e),\n    }\n}\n\nfn main() {\n    let twenty = multiply1(&quot;10&quot;, &quot;2&quot;);\n    print(twenty);\n\n    // 下面的调用会提供更有帮助的错误信息\n    let tt = multiply(&quot;t&quot;, &quot;2&quot;);\n    print(tt);\n\n    println!(&quot;Success!&quot;)\n}`, `24377029125337235000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用 Result 重写后，我们使用模式匹配的方式来处理，而无需使用 `unwrap`</span>\n<span class="token comment">// 但是这种写法实在过于啰嗦..</span>\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> n1_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">Ok</span><span class="token punctuation">(</span>n2<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Ok</span><span class="token punctuation">(</span>n1 <span class="token operator">*</span> n2<span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 重写上面的 `multiply` ，让它尽量简洁</span>\n<span class="token comment">// 提示：使用 `and_then` 和 `map`</span>\n<span class="token keyword">fn</span> <span class="token function">multiply1</span><span class="token punctuation">(</span>n1_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> n2_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 实现...</span>\n    n1_str\n        <span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token operator">|</span>x<span class="token operator">|</span> n2_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>y<span class="token operator">|</span> x <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">:</span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> result <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n is {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Error: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> twenty <span class="token operator">=</span> <span class="token function">multiply1</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>twenty<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 下面的调用会提供更有帮助的错误信息</span>\n    <span class="token keyword">let</span> tt <span class="token operator">=</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span>tt<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-23"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-23" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>如果我们要在代码中到处使用 <code class="language-text">std::result::Result&lt;T, ParseIntError&gt;</code>，那毫无疑问，代码将变得特别冗长和啰嗦，对于这种情况，可以使用类型别名来解决。</p>\n<p>例如在标准库中，就在大量使用这种方式来简化代码: io::Result</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60612940424836410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 填空\ntype __;\n\n// 使用上面的别名来引用原来的 \\`Result\\` 类型\nfn multiply(first_number_str: &str, second_number_str: &str) -> Res<i32> {\n    first_number_str.parse::<i32>().and_then(|first_number| {\n        second_number_str.parse::<i32>().map(|second_number| first_number * second_number)\n    })\n}\n\n// 同样, 这里也使用了类型别名来简化代码\nfn print(result: Res<i32>) {\n    match result {\n        Ok(n)  => println!(&quot;n is {}&quot;, n),\n        Err(e) => println!(&quot;Error: {}&quot;, e),\n    }\n}\n\nfn main() {\n    print(multiply(&quot;10&quot;, &quot;2&quot;));\n    print(multiply(&quot;t&quot;, &quot;2&quot;));\n\n    println!(&quot;Success!&quot;)\n}`, `60612940424836410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 填空</span>\n<span class="token keyword">type</span> __<span class="token punctuation">;</span>\n\n<span class="token comment">// 使用上面的别名来引用原来的 `Result` 类型</span>\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>first_number_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> second_number_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Res<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    first_number_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation">|</span>first_number<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>\n        second_number_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>second_number<span class="token operator">|</span> first_number <span class="token operator">*</span> second_number<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 同样, 这里也使用了类型别名来简化代码</span>\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">:</span> Res<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> result <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n is {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Error: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 fn main 中使用 Result，一个典型的 main 函数长这样:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25326003337174098000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    println!(&quot;Hello World!&quot;);\n}`, `25326003337174098000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>事实上 main 函数还可以返回一个 Result 类型：如果 main 函数内部发生了错误，那该错误会被返回并且打印出一条错误的 debug 信息</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9887094086147207000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\nfn main() -> Result<(), ParseIntError> {\n    let number_str = &quot;10&quot;;\n    let number = match number_str.parse::<i32>() {\n        Ok(number)  => number,\n        Err(e) => return Err(e),\n    };\n    println!(&quot;{}&quot;, number);\n    Ok(())\n}`, `9887094086147207000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ParseIntError<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> number_str <span class="token operator">=</span> <span class="token string">"10"</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> number <span class="token operator">=</span> <span class="token keyword">match</span> number_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>  <span class="token operator">=></span> number<span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">return</span> <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-207"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-207" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84711193974262820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::num::ParseIntError;\n\n// 填空\ntype Res<T> = Result<T, ParseIntError>;\n\n// 使用上面的别名来引用原来的 \\`Result\\` 类型\nfn multiply(first_number_str: &str, second_number_str: &str) -> Res<i32> {\n    first_number_str.parse::<i32>().and_then(|first_number| {\n        second_number_str\n            .parse::<i32>()\n            .map(|second_number| first_number * second_number)\n    })\n}\n\n// 同样, 这里也使用了类型别名来简化代码\nfn print(result: Res<i32>) {\n    match result {\n        Ok(n) => println!(&quot;n is {}&quot;, n),\n        Err(e) => println!(&quot;Error: {}&quot;, e),\n    }\n}\n\nfn main() {\n    print(multiply(&quot;10&quot;, &quot;2&quot;));\n    print(multiply(&quot;t&quot;, &quot;2&quot;));\n\n    println!(&quot;Success!&quot;)\n}`, `84711193974262820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>num<span class="token punctuation">::</span>ParseIntError<span class="token punctuation">;</span>\n\n<span class="token comment">// 填空</span>\n<span class="token keyword">type</span> Res<span class="token operator">&lt;</span>T<span class="token operator">></span> <span class="token operator">=</span> Result<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> ParseIntError<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 使用上面的别名来引用原来的 `Result` 类型</span>\n<span class="token keyword">fn</span> <span class="token function">multiply</span><span class="token punctuation">(</span>first_number_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> second_number_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span>str<span class="token punctuation">)</span> <span class="token punctuation">-></span> Res<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    first_number_str<span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation">|</span>first_number<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>\n        second_number_str\n            <span class="token punctuation">.</span>parse<span class="token punctuation">::</span><span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">|</span>second_number<span class="token operator">|</span> first_number <span class="token operator">*</span> second_number<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 同样, 这里也使用了类型别名来简化代码</span>\n<span class="token keyword">fn</span> <span class="token function">print</span><span class="token punctuation">(</span>result<span class="token punctuation">:</span> Res<span class="token operator">&lt;</span>i32<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">match</span> result <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"n is {}"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Error: {}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">print</span><span class="token punctuation">(</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token string">"t"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="包和模块"><a href="#%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>包和模块</h1>\n<h2 id="包-crate"><a href="#%E5%8C%85-crate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>包 Crate</h2>\n<h3 id="问题一-30"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>package 是你通过 Cargo 创建的工程或项目，因此在 package 的根目录下会有一个 Cargo.toml 文件。</p>\n<p>创建一个 package，拥有以下目录结构:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41870239789287430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── Cargo.toml\n└── src\n    └── main.rs\n\n1 directory, 2 files`, `41870239789287430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.\n├── Cargo.toml\n└── src\n    └── main.rs\n\n1 directory, 2 files</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66898856565190850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# in Cargo.toml\n[package]\nname = &quot;hello-package&quot;\nversion = &quot;0.1.0&quot;\nedition = &quot;2021&quot;`, `66898856565190850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="toml"\n              >\n                <span class="gatsby-code-button-language">toml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="toml"><pre style="counter-reset: linenumber NaN" class="language-toml line-numbers"><code class="language-toml"><span class="token comment"># in Cargo.toml</span>\n<span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>\n<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"hello-package"</span>\n<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span>\n<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2021"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-208"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-208" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35825542628280414000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cargo new hello-package`, `35825542628280414000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">cargo new hello-package</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="问题二-30"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>创建一个 package，拥有以下目录结构</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27269288174157480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── Cargo.toml\n└── src\n    └── lib.rs\n\n1 directory, 2 files`, `27269288174157480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.\n├── Cargo.toml\n└── src\n    └── lib.rs\n\n1 directory, 2 files</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85932303065454280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# in Cargo.toml\n[package]\nname = &quot;hello-package1&quot;\nversion = &quot;0.1.0&quot;\nedition = &quot;2021&quot;`, `85932303065454280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="toml"\n              >\n                <span class="gatsby-code-button-language">toml</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="toml"><pre style="counter-reset: linenumber NaN" class="language-toml line-numbers"><code class="language-toml"><span class="token comment"># in Cargo.toml</span>\n<span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span>\n<span class="token key property">name</span> <span class="token punctuation">=</span> <span class="token string">"hello-package1"</span>\n<span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span>\n<span class="token key property">edition</span> <span class="token punctuation">=</span> <span class="token string">"2021"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-209"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-209" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91663221101540030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cargo new --lib hello-package1`, `91663221101540030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">cargo new --lib hello-package1</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="问题三-30"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84830543832807500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 使用你的答案填空 */\n\n// Q: package 1# 和 2# 的区别是什么 ?\n// A: __`, `84830543832807500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">/* 使用你的答案填空 */\n\n// Q: package 1# 和 2# 的区别是什么 ?\n// A: __</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-210"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-210" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<h3 id="问题四-28"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>一个包可以是二进制也可以一个依赖库。每一个包都有一个包根，例如二进制包的包根是 src/main.rs，库包的包根是 src/lib.rs。包根是编译器开始处理源代码文件的地方，同时也是包模块树的根部</p>\n<p>在 package hello-package 中，有一个二进制包，该包与 package 同名: hello-package, 其中 src/main.rs 是该二进制包的包根</p>\n<p>与 hello-package 类似，hello-package1 同样包含一个包，但是与之前的二进制包不同，该 package 包含的是库包，其中 src/lib.rs 是其包根</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60382478504568906000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 填空 */\n\n// Q: package \\`hello-package1\\` 中的库包名称是?\n// A: __`, `60382478504568906000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">/* 填空 */\n\n// Q: package `hello-package1` 中的库包名称是?\n// A: __</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-211"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-211" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<p>hello-package1</p>\n<h3 id="问题五-28"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-28" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>为 hello-package 添加一个库包，并且完成以下目录结构的填空:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11799834202291960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 填空\n.\n├── Cargo.lock\n├── Cargo.toml\n├── src\n│   ├── __\n│   └── __`, `11799834202291960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text"># 填空\n.\n├── Cargo.lock\n├── Cargo.toml\n├── src\n│   ├── __\n│   └── __</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在上一个步骤后，我们的 hello-package 中已经存在两个包：一个二进制包和一个库包，两个包的名称都与 package 相同：hello-package。</p>\n<h4 id="我的解答-212"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-212" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="483661802336632400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# FILL in the blanks\n.\n├── Cargo.lock\n├── Cargo.toml\n├── src\n│   ├── main.rs\n│   └── lib.rs`, `483661802336632400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text"># FILL in the blanks\n.\n├── Cargo.lock\n├── Cargo.toml\n├── src\n│   ├── main.rs\n│   └── lib.rs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题六-24"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-24" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h3>\n<p>一个 package 最多只能包含一个库包，但是却可以包含多个二进制包：通过将二进制文件放入到 src/bin 目录下实现: 该目录下的每个文件都是一个独立的二进制包，包名与文件名相同，不再与 package 的名称相同</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8292029062876583000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 创建一个 package 包含以下包：\n# 1. 三个二进制包: \\`hello-package\\`, \\`main1\\` and \\`main2\\`\n# 2. 一个库包\n# 并完成以下目录结构的填空\n.\n├── Cargo.toml\n├── Cargo.lock\n├── src\n│   ├── __\n│   ├── __\n│   └── __\n│       └── __\n│       └── __\n├── tests # 存放集成测试文件的目录\n│   └── some_integration_tests.rs\n├── benches # 存放 benchmark 文件的目录 dir for benchmark files\n│   └── simple_bench.rs\n└── examples # 存放示例文件的目录\n    └── simple_example.rs`, `8292029062876583000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text"># 创建一个 package 包含以下包：\n# 1. 三个二进制包: `hello-package`, `main1` and `main2`\n# 2. 一个库包\n# 并完成以下目录结构的填空\n.\n├── Cargo.toml\n├── Cargo.lock\n├── src\n│   ├── __\n│   ├── __\n│   └── __\n│       └── __\n│       └── __\n├── tests # 存放集成测试文件的目录\n│   └── some_integration_tests.rs\n├── benches # 存放 benchmark 文件的目录 dir for benchmark files\n│   └── simple_bench.rs\n└── examples # 存放示例文件的目录\n    └── simple_example.rs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，上面的 package 结构非常标准，你可以在很多 Rust 项目中看到该结构的身影</p>\n<h4 id="我的解答-213"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-213" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62247974056779330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# Create a package which contains\n# 1. three binary crates: \\`hello-package\\`, \\`main1\\` and \\`main2\\`\n# 2. one library crate\n# describe the directory tree below\n.\n├── Cargo.toml\n├── Cargo.lock\n├── src\n│   ├── main.rs\n│   ├── lib.rs\n│   └── bin\n│       └── main1.rs\n│       └── main2.rs\n├── tests # directory for integrated tests files\n│   └── some_integration_tests.rs\n├── benches # dir for benchmark files\n│   └── simple_bench.rs\n└── examples # dir for example files\n    └── simple_example.rs`, `62247974056779330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text"># Create a package which contains\n# 1. three binary crates: `hello-package`, `main1` and `main2`\n# 2. one library crate\n# describe the directory tree below\n.\n├── Cargo.toml\n├── Cargo.lock\n├── src\n│   ├── main.rs\n│   ├── lib.rs\n│   └── bin\n│       └── main1.rs\n│       └── main2.rs\n├── tests # directory for integrated tests files\n│   └── some_integration_tests.rs\n├── benches # dir for benchmark files\n│   └── simple_bench.rs\n└── examples # dir for example files\n    └── simple_example.rs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模块-module"><a href="#%E6%A8%A1%E5%9D%97-module" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块 Module</h2>\n<h3 id="问题一-31"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>之前我们创建了一个 package hello-package，它的目录结构在经过多次修改后，变成了以下模样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93395025618824270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── Cargo.toml\n├── src\n│   ├── lib.rs\n│   └── main.rs`, `93395025618824270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.\n├── Cargo.toml\n├── src\n│   ├── lib.rs\n│   └── main.rs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面，我们来为其中的库包创建一些模块，然后在二进制包中使用这些模块</p>\n<p>根据以下的模块树描述实现模块 <code class="language-text">front_of_house</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36996520166760030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`库包的根(src/lib.rs)\n └── front_of_house\n     ├── hosting\n     │   ├── add_to_waitlist\n     │   └── seat_at_table\n     └── serving\n         ├── take_order\n         ├── serve_order\n         ├── take_payment\n         └── complain`, `36996520166760030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">库包的根(src/lib.rs)\n └── front_of_house\n     ├── hosting\n     │   ├── add_to_waitlist\n     │   └── seat_at_table\n     └── serving\n         ├── take_order\n         ├── serve_order\n         ├── take_payment\n         └── complain</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8331174655891549000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 填空\n// in __.rs\n\nmod front_of_house {\n    // 实现此模块\n}`, `8331174655891549000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 填空</span>\n<span class="token comment">// in __.rs</span>\n\n<span class="token keyword">mod</span> front_of_house <span class="token punctuation">{</span>\n    <span class="token comment">// 实现此模块</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-214"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-214" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39829780659381035000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\nmod front_of_house {\n    mod hosting {\n        fn add_to_waitlist() {}\n\n        fn seat_at_table() {}\n    }\n\n    mod serving {\n        fn take_order() {}\n\n        fn serve_order() {}\n\n        fn take_payment() {}\n\n        fn complain() {}\n    }\n}`, `39829780659381035000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n<span class="token keyword">mod</span> front_of_house <span class="token punctuation">{</span>\n    <span class="token keyword">mod</span> hosting <span class="token punctuation">{</span>\n        <span class="token keyword">fn</span> <span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">seat_at_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">mod</span> serving <span class="token punctuation">{</span>\n        <span class="token keyword">fn</span> <span class="token function">take_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">take_payment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token keyword">fn</span> <span class="token function">complain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-31"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>让我们在库包的根中定义一个函数 <code class="language-text">eat_at_restaurant</code>, 然后在该函数中调用之前创建的函数 <code class="language-text">eat_at_restaurant</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11258407583564910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\n\n// 填空并修复错误\n\n// 提示：你需要通过 \\`pub\\` 将一些项标记为公有的，这样模块 \\`front_of_house\\` 中的项才能被模块外的项访问\nmod front_of_house {\n   /* ...snip... */\n}\n\npub fn eat_at_restaurant() {\n   // 使用绝对路径调用\n   __.add_to_waitlist();\n\n   // 使用相对路径调用\n   __.add_to_waitlist();\n}`, `11258407583564910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n\n<span class="token comment">// 填空并修复错误</span>\n\n<span class="token comment">// 提示：你需要通过 `pub` 将一些项标记为公有的，这样模块 `front_of_house` 中的项才能被模块外的项访问</span>\n<span class="token keyword">mod</span> front_of_house <span class="token punctuation">{</span>\n   <span class="token comment">/* ...snip... */</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">eat_at_restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 使用绝对路径调用</span>\n   __<span class="token punctuation">.</span><span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 使用相对路径调用</span>\n   __<span class="token punctuation">.</span><span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-215"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-215" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43319911024620960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\npub mod front_of_house {\n    pub mod hosting {\n        pub fn add_to_waitlist() {}\n\n        pub fn seat_at_table() {}\n    }\n\n    pub mod serving {\n        pub fn take_order() {}\n\n        pub fn serve_order() {}\n\n        pub fn take_payment() {}\n\n        // Maybe you don\'t want the guest hearing the your complaining about them\n        // So just make it private\n        fn complain() {}\n    }\n}\n\npub fn eat_at_restaurant() {\n    // 绝对路径\n    crate::front_of_house::hosting::add_to_waitlist();\n\n    // 相对路径\n    front_of_house::hosting::add_to_waitlist();\n}`, `43319911024620960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n<span class="token keyword">pub</span> <span class="token keyword">mod</span> front_of_house <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">mod</span> hosting <span class="token punctuation">{</span>\n        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">seat_at_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">pub</span> <span class="token keyword">mod</span> serving <span class="token punctuation">{</span>\n        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">take_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">take_payment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n        <span class="token comment">// Maybe you don\'t want the guest hearing the your complaining about them</span>\n        <span class="token comment">// So just make it private</span>\n        <span class="token keyword">fn</span> <span class="token function">complain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">eat_at_restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 绝对路径</span>\n    <span class="token keyword">crate</span><span class="token punctuation">::</span>front_of_house<span class="token punctuation">::</span>hosting<span class="token punctuation">::</span><span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 相对路径</span>\n    front_of_house<span class="token punctuation">::</span>hosting<span class="token punctuation">::</span><span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-31"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>我们还可以使用 super 来导入父模块中的项</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13358531061883160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\n\nmod back_of_house {\n    fn fix_incorrect_order() {\n        cook_order();\n        // 使用三种方式填空\n        // 1. 使用关键字 \\`super\\`\n        // 2. 使用绝对路径\n        __.serve_order();\n    }\n\n    fn cook_order() {}\n}`, `13358531061883160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n\n<span class="token keyword">mod</span> back_of_house <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fix_incorrect_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 使用三种方式填空</span>\n        <span class="token comment">// 1. 使用关键字 `super`</span>\n        <span class="token comment">// 2. 使用绝对路径</span>\n        __<span class="token punctuation">.</span><span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-216"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-216" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30296273789296624000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mod back_of_house {\n    fn fix_incorrect_order() {\n        cook_order();\n        super::front_of_house::serving::serve_order();\n    }\n\n    fn cook_order() {}\n}`, `30296273789296624000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">mod</span> back_of_house <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fix_incorrect_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">super</span><span class="token punctuation">::</span>front_of_house<span class="token punctuation">::</span>serving<span class="token punctuation">::</span><span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90753181954447160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mod back_of_house {\n    fn fix_incorrect_order() {\n        cook_order();\n        crate::front_of_house::serving::serve_order();\n    }\n\n    fn cook_order() {}\n}`, `90753181954447160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">mod</span> back_of_house <span class="token punctuation">{</span>\n    <span class="token keyword">fn</span> <span class="token function">fix_incorrect_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">crate</span><span class="token punctuation">::</span>front_of_house<span class="token punctuation">::</span>serving<span class="token punctuation">::</span><span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">fn</span> <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-29"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>将模块分离并放入独立的文件中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32422467989992776000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\npub mod front_of_house {\n   pub mod hosting {\n      pub fn add_to_waitlist() {}\n\n      pub fn seat_at_table() -> String {\n            String::from(&quot;sit down please&quot;)\n      }\n   }\n\n   pub mod serving {\n      pub fn take_order() {}\n\n      pub fn serve_order() {}\n\n      pub fn take_payment() {}\n\n      // 我猜你不希望顾客听到你在抱怨他们，因此让这个函数私有化吧\n      fn complain() {}\n   }\n}\n\npub fn eat_at_restaurant() -> String {\n   front_of_house::hosting::add_to_waitlist();\n\n   back_of_house::cook_order();\n\n   String::from(&quot;yummy yummy!&quot;)\n}\n\npub mod back_of_house {\n   pub fn fix_incorrect_order() {\n      cook_order();\n      crate::front_of_house::serving::serve_order();\n   }\n\n   pub fn cook_order() {}\n}`, `32422467989992776000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n<span class="token keyword">pub</span> <span class="token keyword">mod</span> front_of_house <span class="token punctuation">{</span>\n   <span class="token keyword">pub</span> <span class="token keyword">mod</span> hosting <span class="token punctuation">{</span>\n      <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n      <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">seat_at_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n            String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sit down please"</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">pub</span> <span class="token keyword">mod</span> serving <span class="token punctuation">{</span>\n      <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">take_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n      <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n      <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">take_payment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n      <span class="token comment">// 我猜你不希望顾客听到你在抱怨他们，因此让这个函数私有化吧</span>\n      <span class="token keyword">fn</span> <span class="token function">complain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">eat_at_restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n   front_of_house<span class="token punctuation">::</span>hosting<span class="token punctuation">::</span><span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   back_of_house<span class="token punctuation">::</span><span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"yummy yummy!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">mod</span> back_of_house <span class="token punctuation">{</span>\n   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">fix_incorrect_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">crate</span><span class="token punctuation">::</span>front_of_house<span class="token punctuation">::</span>serving<span class="token punctuation">::</span><span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请将上面的模块和代码分离到以下目录文件中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71631599204641310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── Cargo.toml\n├── src\n│   ├── back_of_house.rs\n│   ├── front_of_house\n│   │   ├── hosting.rs\n│   │   ├── mod.rs\n│   │   └── serving.rs\n│   ├── lib.rs\n│   └── main.rs`, `71631599204641310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.\n├── Cargo.toml\n├── src\n│   ├── back_of_house.rs\n│   ├── front_of_house\n│   │   ├── hosting.rs\n│   │   ├── mod.rs\n│   │   └── serving.rs\n│   ├── lib.rs\n│   └── main.rs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94733363526869320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/lib.rs\n\n// IMPLEMENT...`, `94733363526869320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/lib.rs</span>\n\n<span class="token comment">// IMPLEMENT...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76817495634252400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/back_of_house.rs\n\n// IMPLEMENT...`, `76817495634252400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/back_of_house.rs</span>\n\n<span class="token comment">// IMPLEMENT...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15601481710828003000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/front_of_house/mod.rs\n\n// IMPLEMENT...`, `15601481710828003000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/front_of_house/mod.rs</span>\n\n<span class="token comment">// IMPLEMENT...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69881895938845570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/front_of_house/hosting.rs\n\n// IMPLEMENT...`, `69881895938845570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/front_of_house/hosting.rs</span>\n\n<span class="token comment">// IMPLEMENT...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20391562994198598000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/front_of_house/serving.rs\n\n// IMPLEMENT...`, `20391562994198598000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/front_of_house/serving.rs</span>\n\n<span class="token comment">// IMPLEMENT...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-217"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-217" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40591460693417680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/lib.rs\n\nmod front_of_house;\nmod back_of_house;\npub fn eat_at_restaurant() -> String {\n    front_of_house::hosting::add_to_waitlist();\n\n    back_of_house::cook_order();\n\n    String::from(&quot;yummy yummy!&quot;)\n}`, `40591460693417680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/lib.rs</span>\n\n<span class="token keyword">mod</span> front_of_house<span class="token punctuation">;</span>\n<span class="token keyword">mod</span> back_of_house<span class="token punctuation">;</span>\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">eat_at_restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    front_of_house<span class="token punctuation">::</span>hosting<span class="token punctuation">::</span><span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    back_of_house<span class="token punctuation">::</span><span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"yummy yummy!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42741826192682030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/back_of_house.rs\n\nuse crate::front_of_house;\npub fn fix_incorrect_order() {\n    cook_order();\n    front_of_house::serving::serve_order();\n}\n\npub fn cook_order() {}`, `42741826192682030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/back_of_house.rs</span>\n\n<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>front_of_house<span class="token punctuation">;</span>\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">fix_incorrect_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    front_of_house<span class="token punctuation">::</span>serving<span class="token punctuation">::</span><span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">cook_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71619232792073990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/front_of_house/mod.rs\n\npub mod hosting;\npub mod serving;`, `71619232792073990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/front_of_house/mod.rs</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">mod</span> hosting<span class="token punctuation">;</span>\n<span class="token keyword">pub</span> <span class="token keyword">mod</span> serving<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69352673212414670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/front_of_house/hosting.rs\n\npub fn add_to_waitlist() {}\n\npub fn seat_at_table() -> String {\n    String::from(&quot;sit down please&quot;)\n}`, `69352673212414670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/front_of_house/hosting.rs</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_to_waitlist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">seat_at_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sit down please"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90688853619661370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/front_of_house/serving.rs\n\npub fn take_order() {}\n\npub fn serve_order() {}\n\npub fn take_payment() {}\n\n// Maybe you don\'t want the guest hearing the your complaining about them\n// So just make it private\nfn complain() {}`, `90688853619661370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/front_of_house/serving.rs</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">take_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">serve_order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">take_payment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token comment">// Maybe you don\'t want the guest hearing the your complaining about them</span>\n<span class="token comment">// So just make it private</span>\n<span class="token keyword">fn</span> <span class="token function">complain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题五-29"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-29" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h3>\n<p>从二进制包中访问库包的代码，此时你的项目结构应该如下所示</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80163762572733680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── Cargo.toml\n├── src\n│   ├── back_of_house.rs\n│   ├── front_of_house\n│   │   ├── hosting.rs\n│   │   ├── mod.rs\n│   │   └── serving.rs\n│   ├── lib.rs\n│   └── main.rs`, `80163762572733680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.\n├── Cargo.toml\n├── src\n│   ├── back_of_house.rs\n│   ├── front_of_house\n│   │   ├── hosting.rs\n│   │   ├── mod.rs\n│   │   └── serving.rs\n│   ├── lib.rs\n│   └── main.rs</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们可以从二进制包中发起函数调用了</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84444029812734150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/main.rs\n\n// 填空并修复错误\nfn main() {\n    assert_eq!(__, &quot;sit down please&quot;);\n    assert_eq!(__,&quot;yummy yummy!&quot;);\n}`, `84444029812734150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/main.rs</span>\n\n<span class="token comment">// 填空并修复错误</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> <span class="token string">"sit down please"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span><span class="token string">"yummy yummy!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-218"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-218" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18273348939346002000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mod front_of_house;\n\nfn main() {\n    assert_eq!(front_of_house::hosting::seat_at_table(), &quot;sit down please&quot;);\n    assert_eq!(hello_package::eat_at_restaurant(),&quot;yummy yummy!&quot;);\n}`, `18273348939346002000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">mod</span> front_of_house<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>front_of_house<span class="token punctuation">::</span>hosting<span class="token punctuation">::</span><span class="token function">seat_at_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"sit down please"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span>hello_package<span class="token punctuation">::</span><span class="token function">eat_at_restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"yummy yummy!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="使用-use-引入模块及受限可见性"><a href="#%E4%BD%BF%E7%94%A8-use-%E5%BC%95%E5%85%A5%E6%A8%A1%E5%9D%97%E5%8F%8A%E5%8F%97%E9%99%90%E5%8F%AF%E8%A7%81%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 use 引入模块及受限可见性</h2>\n<h3 id="问题一-32"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-32" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h3>\n<p>使用 use 可以将两个同名类型引入到当前作用域中，但是别忘了 as 关键字</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64658848157236880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fmt::Result;\nuse std::io::Result;\n\nfn main() {}`, `64658848157236880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Result<span class="token punctuation">;</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">::</span>Result<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-219"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-219" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9297998217799330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::fmt::Result;\nuse std::io::Result as IoResult;\n\nfn main() {}`, `9297998217799330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span>Result<span class="token punctuation">;</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>io<span class="token punctuation">::</span>Result <span class="token keyword">as</span> IoResult<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题二-32"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-32" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h3>\n<p>如果我们在使用来自同一个包或模块中的多个不同项，那么可以通过简单的方式将它们一次性引入进来</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65529670589615780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用两种方式填空\n// 不要添加新的代码行\nuse std::collections::__;\n\nfn main() {\n    let _c1:HashMap<&str, i32> = HashMap::new();\n    let mut c2 = BTreeMap::new();\n    c2.insert(1, &quot;a&quot;);\n    let _c3: HashSet<i32> = HashSet::new();\n}`, `65529670589615780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 使用两种方式填空</span>\n<span class="token comment">// 不要添加新的代码行</span>\n<span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>__<span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _c1<span class="token punctuation">:</span>HashMap<span class="token operator">&lt;</span><span class="token operator">&amp;</span>str<span class="token punctuation">,</span> i32<span class="token operator">></span> <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> c2 <span class="token operator">=</span> BTreeMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    c2<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _c3<span class="token punctuation">:</span> HashSet<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> HashSet<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-220"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-220" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7897883863355193000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::collections::*;\n\nfn main() {\n    let _c1:HashMap<&str, i32> = HashMap::new();\n    let mut c2 = BTreeMap::new();\n    c2.insert(1, &quot;a&quot;);\n    let _c3: HashSet<i32> = HashSet::new();\n}`, `7897883863355193000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _c1<span class="token punctuation">:</span>HashMap<span class="token operator">&lt;</span><span class="token operator">&amp;</span>str<span class="token punctuation">,</span> i32<span class="token operator">></span> <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> c2 <span class="token operator">=</span> BTreeMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    c2<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _c3<span class="token punctuation">:</span> HashSet<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> HashSet<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52719234226200550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`use std::collections::{HashMap, BTreeMap, HashSet};\n\nfn main() {\n    let _c1:HashMap<&str, i32> = HashMap::new();\n    let mut c2 = BTreeMap::new();\n    c2.insert(1, &quot;a&quot;);\n    let _c3: HashSet<i32> = HashSet::new();\n}`, `52719234226200550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">use</span> std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span><span class="token punctuation">{</span>HashMap<span class="token punctuation">,</span> BTreeMap<span class="token punctuation">,</span> HashSet<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> _c1<span class="token punctuation">:</span>HashMap<span class="token operator">&lt;</span><span class="token operator">&amp;</span>str<span class="token punctuation">,</span> i32<span class="token operator">></span> <span class="token operator">=</span> HashMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> <span class="token keyword">mut</span> c2 <span class="token operator">=</span> BTreeMap<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    c2<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> _c3<span class="token punctuation">:</span> HashSet<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token operator">=</span> HashSet<span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题三-32"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-32" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h3>\n<p>使用 pub use 进行再导出</p>\n<p>在之前创建的 hello-package 的库包中，添加一些代码让下面的代码能够正常工作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39589621799749410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n   assert_eq!(hello_package::hosting::seat_at_table(), &quot;sit down please&quot;);\n   assert_eq!(hello_package::eat_at_restaurant(),&quot;yummy yummy!&quot;);\n}`, `39589621799749410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>hello_package<span class="token punctuation">::</span>hosting<span class="token punctuation">::</span><span class="token function">seat_at_table</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"sit down please"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert_eq!</span><span class="token punctuation">(</span>hello_package<span class="token punctuation">::</span><span class="token function">eat_at_restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"yummy yummy!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="我的解答-221"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-221" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58548858045397870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\n\n// Add this line\npub use crate::front_of_house::hosting;`, `58548858045397870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n\n<span class="token comment">// Add this line</span>\n<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>front_of_house<span class="token punctuation">::</span>hosting<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="问题四-30"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h3>\n<p>pub(in Crate)</p>\n<p>有时我们希望某一个项只对特定的包可见，那么就可以使用 pub(in Crate) 语法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86085636041021870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pub mod a {\n    pub const I: i32 = 3;\n\n    fn semisecret(x: i32) -> i32 {\n        use self:🅱:c::J;\n        x + J\n    }\n\n    pub fn bar(z: i32) -> i32 {\n        semisecret(I) * z\n    }\n    pub fn foo(y: i32) -> i32 {\n        semisecret(I) + y\n    }\n\n    mod b {\n        pub(in crate::a) mod c {\n            pub(in crate::a) const J: i32 = 4;\n        }\n    }\n}`, `86085636041021870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">pub</span> <span class="token keyword">mod</span> a <span class="token punctuation">{</span>\n    <span class="token keyword">pub</span> <span class="token keyword">const</span> I<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">fn</span> <span class="token function">semisecret</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n        <span class="token keyword">use</span> <span class="token keyword">self</span><span class="token punctuation">:</span>🅱<span class="token punctuation">:</span>c<span class="token punctuation">::</span>J<span class="token punctuation">;</span>\n        x <span class="token operator">+</span> J\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">bar</span><span class="token punctuation">(</span>z<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n        <span class="token function">semisecret</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">*</span> z\n    <span class="token punctuation">}</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">foo</span><span class="token punctuation">(</span>y<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n        <span class="token function">semisecret</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">+</span> y\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">mod</span> b <span class="token punctuation">{</span>\n        <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">in</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>a<span class="token punctuation">)</span> <span class="token keyword">mod</span> c <span class="token punctuation">{</span>\n            <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">in</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>a<span class="token punctuation">)</span> <span class="token keyword">const</span> J<span class="token punctuation">:</span> i32 <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27546763371081994000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 一个名为 \\`my_mod\\` 的模块\nmod my_mod {\n    // 模块中的项默认具有私有的可见性\n    fn private_function() {\n        println!(&quot;called \\`my_mod::private_function()\\`&quot;);\n    }\n\n    // 使用 \\`pub\\` 修饰语来改变默认可见性。\n    pub fn function() {\n        println!(&quot;called \\`my_mod::function()\\`&quot;);\n    }\n\n    // 在同一模块中，项可以访问其它项，即使它是私有的。\n    pub fn indirect_access() {\n        print!(&quot;called \\`my_mod::indirect_access()\\`, that\\n> &quot;);\n        private_function();\n    }\n\n    // 模块也可以嵌套\n    pub mod nested {\n        pub fn function() {\n            println!(&quot;called \\`my_mod::nested::function()\\`&quot;);\n        }\n\n        #[allow(dead_code)]\n        fn private_function() {\n            println!(&quot;called \\`my_mod::nested::private_function()\\`&quot;);\n        }\n\n        // 使用 \\`pub(in path)\\` 语法定义的函数只在给定的路径中可见。\n        // \\`path\\` 必须是父模块（parent module）或祖先模块（ancestor module）\n        pub(in crate::my_mod) fn public_function_in_my_mod() {\n            print!(&quot;called \\`my_mod::nested::public_function_in_my_mod()\\`, that\\n > &quot;);\n            public_function_in_nested()\n        }\n\n        // 使用 \\`pub(self)\\` 语法定义的函数则只在当前模块中可见。\n        pub(self) fn public_function_in_nested() {\n            println!(&quot;called \\`my_mod::nested::public_function_in_nested&quot;);\n        }\n\n        // 使用 \\`pub(super)\\` 语法定义的函数只在父模块中可见。\n        pub(super) fn public_function_in_super_mod() {\n            println!(&quot;called my_mod::nested::public_function_in_super_mod&quot;);\n        }\n    }\n\n    pub fn call_public_function_in_my_mod() {\n        print!(&quot;called \\`my_mod::call_public_funcion_in_my_mod()\\`, that\\n> &quot;);\n        nested::public_function_in_my_mod();\n        print!(&quot;> &quot;);\n        nested::public_function_in_super_mod();\n    }\n\n    // \\`pub(crate)\\` 使得函数只在当前包中可见\n    pub(crate) fn public_function_in_crate() {\n        println!(&quot;called \\`my_mod::public_function_in_crate()&quot;);\n    }\n\n    // 嵌套模块的可见性遵循相同的规则\n    mod private_nested {\n        #[allow(dead_code)]\n        pub fn function() {\n            println!(&quot;called \\`my_mod::private_nested::function()\\`&quot;);\n        }\n    }\n}\n\nfn function() {\n    println!(&quot;called \\`function()\\`&quot;);\n}\n\nfn main() {\n    // 模块机制消除了相同名字的项之间的歧义。\n    function();\n    my_mod::function();\n\n    // 公有项，包括嵌套模块内的，都可以在父模块外部访问。\n    my_mod::indirect_access();\n    my_mod::nested::function();\n    my_mod::call_public_function_in_my_mod();\n\n    // pub(crate) 项可以在同一个 crate 中的任何地方访问\n    my_mod::public_function_in_crate();\n\n    // pub(in path) 项只能在指定的模块中访问\n    // 报错！函数 \\`public_function_in_my_mod\\` 是私有的\n    //my_mod::nested::public_function_in_my_mod();\n    // 试一试 ^ 取消该行的注释\n\n    // 模块的私有项不能直接访问，即便它是嵌套在公有模块内部的\n\n    // 报错！\\`private_function\\` 是私有的\n    //my_mod::private_function();\n    // 试一试 ^ 取消此行注释\n\n    // 报错！\\`private_function\\` 是私有的\n    //my_mod::nested::private_function();\n    // 试一试 ^ 取消此行的注释\n\n    // 报错！ \\`private_nested\\` 是私有的\n    //my_mod::private_nested::function();\n    // 试一试 ^ 取消此行的注释\n}`, `27546763371081994000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// 一个名为 `my_mod` 的模块</span>\n<span class="token keyword">mod</span> my_mod <span class="token punctuation">{</span>\n    <span class="token comment">// 模块中的项默认具有私有的可见性</span>\n    <span class="token keyword">fn</span> <span class="token function">private_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::private_function()`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 使用 `pub` 修饰语来改变默认可见性。</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::function()`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 在同一模块中，项可以访问其它项，即使它是私有的。</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">indirect_access</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">print!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::indirect_access()`, that\\n> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">private_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 模块也可以嵌套</span>\n    <span class="token keyword">pub</span> <span class="token keyword">mod</span> nested <span class="token punctuation">{</span>\n        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::nested::function()`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token attribute attr-name">#[allow(dead_code)]</span>\n        <span class="token keyword">fn</span> <span class="token function">private_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::nested::private_function()`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// 使用 `pub(in path)` 语法定义的函数只在给定的路径中可见。</span>\n        <span class="token comment">// `path` 必须是父模块（parent module）或祖先模块（ancestor module）</span>\n        <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">in</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>my_mod<span class="token punctuation">)</span> <span class="token keyword">fn</span> <span class="token function">public_function_in_my_mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">print!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::nested::public_function_in_my_mod()`, that\\n > "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token function">public_function_in_nested</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// 使用 `pub(self)` 语法定义的函数则只在当前模块中可见。</span>\n        <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token keyword">fn</span> <span class="token function">public_function_in_nested</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::nested::public_function_in_nested"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// 使用 `pub(super)` 语法定义的函数只在父模块中可见。</span>\n        <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">)</span> <span class="token keyword">fn</span> <span class="token function">public_function_in_super_mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called my_mod::nested::public_function_in_super_mod"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">call_public_function_in_my_mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">print!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::call_public_funcion_in_my_mod()`, that\\n> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        nested<span class="token punctuation">::</span><span class="token function">public_function_in_my_mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">print!</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        nested<span class="token punctuation">::</span><span class="token function">public_function_in_super_mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// `pub(crate)` 使得函数只在当前包中可见</span>\n    <span class="token keyword">pub</span><span class="token punctuation">(</span><span class="token keyword">crate</span><span class="token punctuation">)</span> <span class="token keyword">fn</span> <span class="token function">public_function_in_crate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::public_function_in_crate()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 嵌套模块的可见性遵循相同的规则</span>\n    <span class="token keyword">mod</span> private_nested <span class="token punctuation">{</span>\n        <span class="token attribute attr-name">#[allow(dead_code)]</span>\n        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `my_mod::private_nested::function()`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"called `function()`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 模块机制消除了相同名字的项之间的歧义。</span>\n    <span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    my_mod<span class="token punctuation">::</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 公有项，包括嵌套模块内的，都可以在父模块外部访问。</span>\n    my_mod<span class="token punctuation">::</span><span class="token function">indirect_access</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    my_mod<span class="token punctuation">::</span>nested<span class="token punctuation">::</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    my_mod<span class="token punctuation">::</span><span class="token function">call_public_function_in_my_mod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// pub(crate) 项可以在同一个 crate 中的任何地方访问</span>\n    my_mod<span class="token punctuation">::</span><span class="token function">public_function_in_crate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// pub(in path) 项只能在指定的模块中访问</span>\n    <span class="token comment">// 报错！函数 `public_function_in_my_mod` 是私有的</span>\n    <span class="token comment">//my_mod::nested::public_function_in_my_mod();</span>\n    <span class="token comment">// 试一试 ^ 取消该行的注释</span>\n\n    <span class="token comment">// 模块的私有项不能直接访问，即便它是嵌套在公有模块内部的</span>\n\n    <span class="token comment">// 报错！`private_function` 是私有的</span>\n    <span class="token comment">//my_mod::private_function();</span>\n    <span class="token comment">// 试一试 ^ 取消此行注释</span>\n\n    <span class="token comment">// 报错！`private_function` 是私有的</span>\n    <span class="token comment">//my_mod::nested::private_function();</span>\n    <span class="token comment">// 试一试 ^ 取消此行的注释</span>\n\n    <span class="token comment">// 报错！ `private_nested` 是私有的</span>\n    <span class="token comment">//my_mod::private_nested::function();</span>\n    <span class="token comment">// 试一试 ^ 取消此行的注释</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="注释和文档"><a href="#%E6%B3%A8%E9%87%8A%E5%92%8C%E6%96%87%E6%A1%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>注释和文档</h1>\n<h2 id="问题一-33"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-33" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93144570759604220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 只使用注释让下面代码工作! */\nfn main() {\n    todo!();\n    unimplemented!();\n\n    assert_eq!(6, 5 + 3 + 2 + 1 )\n}`, `93144570759604220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 只使用注释让下面代码工作! */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">unimplemented!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>文档注释会被解析为 HTML 文件，并支持 Markdown 语法。</p>\n<p>在开始之前，我们需要创建一个新的项目用于后面的练习：<code class="language-text">cargo new --lib doc-comments</code></p>\n<p>行文档注释 ///</p>\n<p>为 add_one 函数添加文档</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70290518759505250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(unused)]\nfn main() {\n   // in lib.rs\n\n   /// Add one to the given value and return the value\n   ///\n   /// # Examples\n   ///\n   /// \\`\\`\\`\n   /// let arg = 5;\n   /// let answer = my_crate::add_one(arg);\n   ///\n   /// assert_eq!(6, answer);\n   /// \\`\\`\\`\n   pub fn add_one(x: i32) -> i32 {\n      x + 1\n   }\n}`, `70290518759505250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(unused)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// in lib.rs</span>\n\n   <span class="token comment">/// Add one to the given value and return the value</span>\n   <span class="token comment">///</span>\n   <span class="token comment">/// # Examples</span>\n   <span class="token comment">///</span>\n   <span class="token comment">/// ```</span>\n   <span class="token comment">/// let arg = 5;</span>\n   <span class="token comment">/// let answer = my_crate::add_one(arg);</span>\n   <span class="token comment">///</span>\n   <span class="token comment">/// assert_eq!(6, answer);</span>\n   <span class="token comment">/// ```</span>\n   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n      x <span class="token operator">+</span> <span class="token number">1</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以使用 <code class="language-text">cargo doc --open</code> 来生成 HTML 文件，并自动在浏览器中打开网页。</p>\n<p>块文档注释 <code class="language-text">/** ... */</code>，为函数 <code class="language-text">add_two</code> 添加文档:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58718463124464610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#![allow(unused)]\nfn main() {\n   /** Add two to the given value and return a new value\n\n   Examples\n\n   let arg = 5;\n   let answer = my_crate::add_two(arg);\n\n   assert_eq!(7, answer);\n\n   */\n   pub fn add_two(x: i32) -> i32 {\n      x + 2\n   }\n}`, `58718463124464610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#![allow(unused)]</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">/** Add two to the given value and return a new value\n\n   Examples\n\n   let arg = 5;\n   let answer = my_crate::add_two(arg);\n\n   assert_eq!(7, answer);\n\n   */</span>\n   <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n      x <span class="token operator">+</span> <span class="token number">2</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-222"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-222" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19681125262577880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `19681125262577880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题二-33"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-33" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h2>\n<p>为包和模块创建文档注释</p>\n<p>我们还可以创建包和模块的注释，用于描述它们的功能。</p>\n<p>首先，来为我们的库包添加一些文档注释:</p>\n<blockquote>\n<p>注意: 必须要将包、模块注释放置在包根或模块文件的最顶部</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63481117567034800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//! # 文档注释\n//!\n//! 该库用于文档注释的教学\n\n// in lib.rs\npub mod compute;`, `63481117567034800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//! # 文档注释</span>\n<span class="token comment">//!</span>\n<span class="token comment">//! 该库用于文档注释的教学</span>\n\n<span class="token comment">// in lib.rs</span>\n<span class="token keyword">pub</span> <span class="token keyword">mod</span> compute<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样的，我们还可以使用块注释来达成目的:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10490988004627177000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*! # 文档注释\n\n 该库用于文档注释的教学 */`, `10490988004627177000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/*! # 文档注释\n\n 该库用于文档注释的教学 */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>下一步，创建一个新的模块文件 src/compute.rs，然后在其中添加以下注释:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26059255453054366000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//! 本模块用于处理一些复杂计算\n\n// in compute.rs`, `26059255453054366000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">//! 本模块用于处理一些复杂计算</span>\n\n<span class="token comment">// in compute.rs</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后运行 cargo doc —open 查看下结果。</p>\n<p>文档测试</p>\n<p>之前的 <code class="language-text">add_one</code> 和 <code class="language-text">add_two</code> 的文档注释中，包含了两个示例代码块</p>\n<p>以上示例不仅仅是作为文档用于演示你的函数该如何使用，它的另一个作用就是用于文档测试 cargo test。</p>\n<p>但是在这两个函数的示例中，存在错误，请修复它们并使用 cargo test 获取以下输出结果:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="443412652418984060"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`running 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n   Doc-tests doc-comments\n\nrunning 2 tests\ntest src/lib.rs - add_one (line 11) ... ok\ntest src/lib.rs - add_two (line 26) ... ok\n\ntest result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.55s`, `443412652418984060`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">running <span class="token number">0</span> tests\n\n<span class="token builtin class-name">test</span> result: ok. <span class="token number">0</span> passed<span class="token punctuation">;</span> <span class="token number">0</span> failed<span class="token punctuation">;</span> <span class="token number">0</span> ignored<span class="token punctuation">;</span> <span class="token number">0</span> measured<span class="token punctuation">;</span> <span class="token number">0</span> filtered out<span class="token punctuation">;</span> finished <span class="token keyword">in</span> <span class="token number">0</span>.00s\n\n   Doc-tests doc-comments\n\nrunning <span class="token number">2</span> tests\n<span class="token builtin class-name">test</span> src/lib.rs - add_one <span class="token punctuation">(</span>line <span class="token number">11</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok\n<span class="token builtin class-name">test</span> src/lib.rs - add_two <span class="token punctuation">(</span>line <span class="token number">26</span><span class="token punctuation">)</span> <span class="token punctuation">..</span>. ok\n\n<span class="token builtin class-name">test</span> result: ok. <span class="token number">2</span> passed<span class="token punctuation">;</span> <span class="token number">0</span> failed<span class="token punctuation">;</span> <span class="token number">0</span> ignored<span class="token punctuation">;</span> <span class="token number">0</span> measured<span class="token punctuation">;</span> <span class="token number">0</span> filtered out<span class="token punctuation">;</span> finished <span class="token keyword">in</span> <span class="token number">0</span>.55s</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-223"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-223" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19503671619627717000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\n\n/// Add one to the given value and return the value\n///\n/// # Examples\n///\n/// \\`\\`\\`\n/// let arg = 5;\n/// let answer = world_hello::add_one(arg);\n///\n/// assert_eq!(6, answer);\n/// \\`\\`\\`\npub fn add_one(x: i32) -> i32 {\n    x + 1\n}\n\n/** Add two to the given value and return a new value\n\n// 这里本来有 \\`\\`\\`，但和 md 语法冲突，省略不写\nlet arg = 5;\nlet answer = world_hello::add_two(arg);\n\nassert_eq!(7, answer);\n// 这里本来有 \\`\\`\\`，但和 md 语法冲突，省略不写\n\n*/\npub fn add_two(x: i32) -> i32 {\n    x + 2\n}`, `19503671619627717000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n\n<span class="token comment">/// Add one to the given value and return the value</span>\n<span class="token comment">///</span>\n<span class="token comment">/// # Examples</span>\n<span class="token comment">///</span>\n<span class="token comment">/// ```</span>\n<span class="token comment">/// let arg = 5;</span>\n<span class="token comment">/// let answer = world_hello::add_one(arg);</span>\n<span class="token comment">///</span>\n<span class="token comment">/// assert_eq!(6, answer);</span>\n<span class="token comment">/// ```</span>\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> <span class="token number">1</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/** Add two to the given value and return a new value\n\n// 这里本来有 ```，但和 md 语法冲突，省略不写\nlet arg = 5;\nlet answer = world_hello::add_two(arg);\n\nassert_eq!(7, answer);\n// 这里本来有 ```，但和 md 语法冲突，省略不写\n\n*/</span>\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_two</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n    x <span class="token operator">+</span> <span class="token number">2</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="问题三-33"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-33" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h2>\n<p>有时我们会期望示例的结果是一个 panic。将以下代码添加到 src/compute.rs，并且让 cargo test 成功运行</p>\n<blockquote>\n<p>你只能修改注释，不要修改 fn div</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18191528293540383000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/compute.rs\n\n/// # Panics\n///\n/// The function panics if the second argument is zero.\n///\n/// \\`\\`\\`rust,should_panic\n/// // panics on division by zero\n/// doc_comments::compute::div(10, 0);\n/// \\`\\`\\`\npub fn div(a: i32, b: i32) -> i32 {\n   if b == 0 {\n      panic!(&quot;Divide-by-zero error&quot;);\n   }\n\n   a / b\n}`, `18191528293540383000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/compute.rs</span>\n\n<span class="token comment">/// # Panics</span>\n<span class="token comment">///</span>\n<span class="token comment">/// The function panics if the second argument is zero.</span>\n<span class="token comment">///</span>\n<span class="token comment">/// ```rust,should_panic</span>\n<span class="token comment">/// // panics on division by zero</span>\n<span class="token comment">/// doc_comments::compute::div(10, 0);</span>\n<span class="token comment">/// ```</span>\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">div</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> b<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> i32 <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n      <span class="token function">panic!</span><span class="token punctuation">(</span><span class="token string">"Divide-by-zero error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   a <span class="token operator">/</span> b\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-224"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-224" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52274356209995964000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `52274356209995964000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题四-31"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h2>\n<p>有时我们会想要隐藏文档，但是保留文档测试</p>\n<p>将以下代码添加到 src/compute.rs</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35654985754450563000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in src/compute.rs\n\n/// \\`\\`\\`\n/// # fn try_main() -> Result<(), String> {\n/// let res = doc_comments::compute::try_div(10, 0)?;\n/// # Ok(()) // returning from try_main\n/// # }\n/// # fn main() {\n/// #    try_main().unwrap();\n/// #\n/// # }\n/// \\`\\`\\`\npub fn try_div(a: i32, b: i32) -> Result<i32, String> {\n    if b == 0 {\n        Err(String::from(&quot;Divide-by-zero&quot;))\n    } else {\n        Ok(a / b)\n    }\n}`, `35654985754450563000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in src/compute.rs</span>\n\n<span class="token comment">/// ```</span>\n<span class="token comment">/// # fn try_main() -> Result&lt;(), String> {</span>\n<span class="token comment">/// let res = doc_comments::compute::try_div(10, 0)?;</span>\n<span class="token comment">/// # Ok(()) // returning from try_main</span>\n<span class="token comment">/// # }</span>\n<span class="token comment">/// # fn main() {</span>\n<span class="token comment">/// #    try_main().unwrap();</span>\n<span class="token comment">/// #</span>\n<span class="token comment">/// # }</span>\n<span class="token comment">/// ```</span>\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">try_div</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> i32<span class="token punctuation">,</span> b<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> Result<span class="token operator">&lt;</span>i32<span class="token punctuation">,</span> String<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>\n        <span class="token function">Err</span><span class="token punctuation">(</span>String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Divide-by-zero"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">Ok</span><span class="token punctuation">(</span>a <span class="token operator">/</span> b<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后修改以上代码已实现两个目标:</p>\n<ul>\n<li>文档注释不能出现在 cargo doc —open 生成的网页中</li>\n<li>运行测试，并成功看到以下结果:</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20792083571983122000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`running 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n   Doc-tests doc-comments\n\nrunning 4 tests\ntest src/compute.rs - compute::div (line 7) ... ok\ntest src/lib.rs - add_two (line 27) ... ok\ntest src/lib.rs - add_one (line 11) ... ok\ntest src/compute.rs - compute::try_div (line 20) ... ok\n\ntest result: ok. 4 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.51s`, `20792083571983122000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">running 0 tests\n\ntest result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s\n\n   Doc-tests doc-comments\n\nrunning 4 tests\ntest src/compute.rs - compute::div (line 7) ... ok\ntest src/lib.rs - add_two (line 27) ... ok\ntest src/lib.rs - add_one (line 11) ... ok\ntest src/compute.rs - compute::try_div (line 20) ... ok\n\ntest result: ok. 4 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.51s</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-225"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-225" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51108750339040570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `51108750339040570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题五-30"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-30" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h2>\n<p>代码跳转</p>\n<p>Rust 为我们提供一个非常强大的特性：可以在文档注释中实现代码跳转。</p>\n<p>将以下代码添加到 src/lib.rs:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1555958480799168800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\n\n/// Add one to the given value and return a [\\`Option\\`] type\npub fn add_three(x: i32) -> Option<i32> {\n    Some(x + 3)\n}`, `1555958480799168800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n\n<span class="token comment">/// Add one to the given value and return a [`Option`] type</span>\n<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_three</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token function">Some</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>除了跳转到标准库中，我们还能跳转到项目中的其它模块。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12420566011759915000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// in lib.rs\n\nmod a {\n    /// Add four to the given value and return a [\\`Option\\`] type\n    /// [\\`crate::MySpecialFormatter\\`]\n    pub fn add_four(x: i32) -> Option<i32> {\n        Some(x + 4)\n    }\n}\n\nstruct MySpecialFormatter;`, `12420566011759915000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// in lib.rs</span>\n\n<span class="token keyword">mod</span> a <span class="token punctuation">{</span>\n    <span class="token comment">/// Add four to the given value and return a [`Option`] type</span>\n    <span class="token comment">/// [`crate::MySpecialFormatter`]</span>\n    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">add_four</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-></span> Option<span class="token operator">&lt;</span>i32<span class="token operator">></span> <span class="token punctuation">{</span>\n        <span class="token function">Some</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">struct</span> MySpecialFormatter<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>文档属性</p>\n<p>下面是很常用的 <code class="language-text">#[doc]</code> 属性，该属性可以被 rustdoc 所使用。</p>\n<p>inline</p>\n<p>可以用于内联文档, 而不是链接到一个单独的页面。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97471945093988160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#[doc(inline)]\npub use bar::Bar;\n\n/// bar docs\nmod bar {\n    /// the docs for Bar\n    pub struct Bar;\n}`, `97471945093988160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token attribute attr-name">#[doc(inline)]</span>\n<span class="token keyword">pub</span> <span class="token keyword">use</span> bar<span class="token punctuation">::</span>Bar<span class="token punctuation">;</span>\n\n<span class="token comment">/// bar docs</span>\n<span class="token keyword">mod</span> bar <span class="token punctuation">{</span>\n    <span class="token comment">/// the docs for Bar</span>\n    <span class="token keyword">pub</span> <span class="token keyword">struct</span> Bar<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>no_inline</p>\n<p>用于防止链接到单独的页面或其它地方。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88373482736485100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Example from libcore/prelude\n#[doc(no_inline)]\npub use crate::mem::drop;`, `88373482736485100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// Example from libcore/prelude</span>\n<span class="token attribute attr-name">#[doc(no_inline)]</span>\n<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span>mem<span class="token punctuation">::</span>drop<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>hidden</p>\n<p>通过这个属性让 rustdoc 不要将下面的项包含在文档中:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85478780260465260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Example from the futures-rs library\n#[doc(hidden)]\npub use self::async_await::*;`, `85478780260465260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">// Example from the futures-rs library</span>\n<span class="token attribute attr-name">#[doc(hidden)]</span>\n<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token keyword">self</span><span class="token punctuation">::</span>async_await<span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>对文档来说，rustdoc 被社区广泛采用，大家所看到的标准库文档也是基于此生成的。</p>\n<h1 id="格式化输出"><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>格式化输出</h1>\n<h2 id="问题一-34"><a href="#%E9%97%AE%E9%A2%98%E4%B8%80-34" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题一</h2>\n<p>位置参数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94326147897583900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 填空 */\nfn main() {\n    println!(&quot;{0}, this is {1}. {1}, this is {0}&quot;, &quot;Alice&quot;, &quot;Bob&quot;);// => Alice, this is Bob. Bob, this is Alice\n    assert_eq!(format!(&quot;{1}{0}&quot;, 1, 2), __);\n    assert_eq!(format!(__, 1, 2), &quot;2112&quot;);\n    println!(&quot;Success!&quot;);\n}`, `94326147897583900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 填空 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{0}, this is {1}. {1}, this is {0}"</span><span class="token punctuation">,</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// => Alice, this is Bob. Bob, this is Alice</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{1}{0}"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"2112"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-226"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-226" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60849755711162750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `60849755711162750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题二-34"><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C-34" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题二</h2>\n<p>具名参数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52734567202629214000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    println!(&quot;{argument}&quot;, argument = &quot;test&quot;); // => &quot;test&quot;\n\n    /* 填空 */\n    assert_eq!(format!(&quot;{name}{}&quot;, 1, __), &quot;21&quot;);\n    assert_eq!(format!(__,a = &quot;a&quot;, b = \'b\', c = 3 ), &quot;a 3 b&quot;);\n\n    /* 修复错误 */\n    // 具名参数必须放在其它参数后面\n    println!(&quot;{abc} {1}&quot;, abc = &quot;def&quot;, 2);\n\n    println!(&quot;Success!&quot;)\n}`, `52734567202629214000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{argument}"</span><span class="token punctuation">,</span> argument <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => "test"</span>\n\n    <span class="token comment">/* 填空 */</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{name}{}"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"21"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span>__<span class="token punctuation">,</span>a <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token char string">\'b\'</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"a 3 b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">/* 修复错误 */</span>\n    <span class="token comment">// 具名参数必须放在其它参数后面</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{abc} {1}"</span><span class="token punctuation">,</span> abc <span class="token operator">=</span> <span class="token string">"def"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-227"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-227" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12644789516582255000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `12644789516582255000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题三-34"><a href="#%E9%97%AE%E9%A2%98%E4%B8%89-34" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题三</h2>\n<p>字符串对齐</p>\n<p>默认情况下，通过空格来填充字符串</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13866001086582647000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 下面两个都是通过 5 个空格来填充\n    println!(&quot;Hello {:5}!&quot;, &quot;x&quot;); // =>  &quot;Hello x    !&quot;\n    println!(&quot;Hello {:1\\$}!&quot;, &quot;x&quot;, 5); // =>  &quot;Hello x    !&quot;\n\n    /* 填空 */\n    assert_eq!(format!(&quot;Hello __!&quot;, 5, &quot;x&quot;), &quot;Hello x    !&quot;);\n    assert_eq!(format!(&quot;Hello __!&quot;, &quot;x&quot;, width = 5), &quot;Hello x    !&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `13866001086582647000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 下面两个都是通过 5 个空格来填充</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {:5}!"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =>  "Hello x    !"</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {:1$}!"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =>  "Hello x    !"</span>\n\n    <span class="token comment">/* 填空 */</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Hello __!"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Hello x    !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Hello __!"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">,</span> width <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Hello x    !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-228"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-228" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40860376779376150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `40860376779376150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题四-32"><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B-32" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题四</h2>\n<p>左对齐，右对齐，使用指定的字符填充</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37551249122644935000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 左对齐\n    println!(&quot;Hello {:<5}!&quot;, &quot;x&quot;); // => Hello x    !\n    // 右对齐\n    assert_eq!(format!(&quot;Hello __!&quot;, &quot;x&quot;), &quot;Hello     x!&quot;);\n    // 居中对齐\n    assert_eq!(format!(&quot;Hello __!&quot;, &quot;x&quot;), &quot;Hello   x  !&quot;);\n\n    // 左对齐，并使用 \\`&\\` 填充\n    assert_eq!(format!(&quot;Hello {:&<5}!&quot;, &quot;x&quot;), __);\n\n    println!(&quot;Success!&quot;)\n}`, `37551249122644935000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 左对齐</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {:&lt;5}!"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => Hello x    !</span>\n    <span class="token comment">// 右对齐</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Hello __!"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Hello     x!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 居中对齐</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Hello __!"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Hello   x  !"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 左对齐，并使用 `&amp;` 填充</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Hello {:&amp;&lt;5}!"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-229"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-229" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28074174190952104000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `28074174190952104000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题五-31"><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-31" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题五</h2>\n<p>我们还能使用 0 来填充数字</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79008744507457850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    println!(&quot;Hello {:5}!&quot;, 5); // => Hello     5!\n    println!(&quot;Hello {:+}!&quot;, 5); // =>  Hello +5!\n    println!(&quot;Hello {:05}!&quot;, 5); // => Hello 00005!\n    println!(&quot;Hello {:05}!&quot;, -5); // => Hello -0005!\n\n    /* 填空 */\n    assert!(format!(&quot;{number:0>width\\$}&quot;, number=1, width=6) == __);\n\n    println!(&quot;Success!&quot;)\n}`, `79008744507457850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {:5}!"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => Hello     5!</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {:+}!"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =>  Hello +5!</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {:05}!"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => Hello 00005!</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {:05}!"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => Hello -0005!</span>\n\n    <span class="token comment">/* 填空 */</span>\n    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"{number:0>width$}"</span><span class="token punctuation">,</span> number<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">==</span> __<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-230"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-230" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26584717472135578000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `26584717472135578000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题六-25"><a href="#%E9%97%AE%E9%A2%98%E5%85%AD-25" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题六</h2>\n<p>浮点数精度</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6847028828544000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 填空 */\nfn main() {\n    let v = 3.1415926;\n\n    println!(&quot;{:.1\\$}&quot;, v, 4); // same as {:.4} => 3.1416\n\n    assert_eq!(format!(&quot;__&quot;, v), &quot;3.14&quot;);\n    assert_eq!(format!(&quot;__&quot;, v), &quot;+3.14&quot;);\n    assert_eq!(format!(&quot;__&quot;, v), &quot;3&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `6847028828544000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token comment">/* 填空 */</span>\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token number">3.1415926</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:.1$}"</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// same as {:.4} => 3.1416</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"3.14"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"+3.14"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-231"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-231" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77746725767513550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `77746725767513550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题七-13"><a href="#%E9%97%AE%E9%A2%98%E4%B8%83-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题七</h2>\n<p>字符串长度</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45854875600224076000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    let s = &quot;Hello, world!&quot;;\n\n    println!(&quot;{0:.5}&quot;, s); // => Hello\n\n    assert_eq!(format!(&quot;Hello __!&quot;, 3, &quot;abcdefg&quot;), &quot;Hello abc!&quot;);\n\n    println!(&quot;Success!&quot;)\n}`, `45854875600224076000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token string">"Hello, world!"</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{0:.5}"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => Hello</span>\n\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"Hello __!"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"abcdefg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Hello abc!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-232"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-232" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93588718859596680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `93588718859596680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题八-11"><a href="#%E9%97%AE%E9%A2%98%E5%85%AB-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题八</h2>\n<p>二进制，八进制，十六进制</p>\n<ul>\n<li>format!(”{}”, foo) -> “3735928559”</li>\n<li>format!(“0x{:X}”, foo) -> “0xDEADBEEF”</li>\n<li>format!(“0o{:o}”, foo) -> “0o33653337357”</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38690927213010354000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    assert_eq!(format!(&quot;__&quot;, 27), &quot;0b11011&quot;);\n    assert_eq!(format!(&quot;__&quot;, 27), &quot;0o33&quot;);\n    assert_eq!(format!(&quot;__&quot;, 27), &quot;0x1b&quot;);\n    assert_eq!(format!(&quot;__&quot;, 27), &quot;0x1B&quot;);\n\n    println!(&quot;{:x}!&quot;, 27); // 没有前缀的十六进制 => 1b\n\n    println!(&quot;{:#010b}&quot;, 27); // 使用 0 来填充二进制，宽度为 10 => 0b00011011\n\n    println!(&quot;Success!&quot;)\n}`, `38690927213010354000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0b11011"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0o33"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0x1b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">assert_eq!</span><span class="token punctuation">(</span><span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">"__"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0x1B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:x}!"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 没有前缀的十六进制 => 1b</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:#010b}"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 0 来填充二进制，宽度为 10 => 0b00011011</span>\n\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Success!"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-233"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-233" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27597741874185310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `27597741874185310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>\n<h2 id="问题九-10"><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>问题九</h2>\n<p>捕获环境中的值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42008155952234684000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn get_person() -> String {\n    String::from(&quot;sunface&quot;)\n}\n\nfn get_format() -> (usize, usize) {\n    (4, 1)\n}\n\nfn main() {\n    let person = get_person();\n    println!(&quot;Hello, {person}!&quot;);\n\n    let (width, precision) = get_format();\n    let scores = [(&quot;sunface&quot;, 99.12), (&quot;jack&quot;, 60.34)];\n    /* 让下面的代码输出:\n    sunface:   99.1\n    jack:   60.3\n    */\n    for (name, score) in scores {\n        println!(&quot;{name}: __&quot;);\n    }\n}`, `42008155952234684000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">get_person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> String <span class="token punctuation">{</span>\n    String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">get_format</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token punctuation">(</span>usize<span class="token punctuation">,</span> usize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token function">get_person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello, {person}!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">let</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> precision<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">get_format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"sunface"</span><span class="token punctuation">,</span> <span class="token number">99.12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"jack"</span><span class="token punctuation">,</span> <span class="token number">60.34</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">/* 让下面的代码输出:\n    sunface:   99.1\n    jack:   60.3\n    */</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token keyword">in</span> scores <span class="token punctuation">{</span>\n        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{name}: __"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31820526581867490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fn main() {\n    // 指数\n    println!(&quot;{:2e}&quot;, 1000000000); // => 1e9\n    println!(&quot;{:2E}&quot;, 1000000000); // => 1E9\n\n    // 指针地址\n    let v= vec![1, 2, 3];\n    println!(&quot;{:p}&quot;, v.as_ptr()); // => 0x600002324050\n\n    // 转义\n    println!(&quot;Hello {{}}&quot;); // => Hello {}\n}`, `31820526581867490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 指数</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:2e}"</span><span class="token punctuation">,</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => 1e9</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:2E}"</span><span class="token punctuation">,</span> <span class="token number">1000000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => 1E9</span>\n\n    <span class="token comment">// 指针地址</span>\n    <span class="token keyword">let</span> v<span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"{:p}"</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => 0x600002324050</span>\n\n    <span class="token comment">// 转义</span>\n    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">"Hello {{}}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// => Hello {}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="我的解答-234"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-234" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50093392949279015000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(``, `50093392949279015000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="rust"\n              >\n                <span class="gatsby-code-button-language">rust</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="rust"><pre style="counter-reset: linenumber NaN" class="language-rust line-numbers"><code class="language-rust"></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Rust练手测试/index.md absPath of file >>> MarkdownRemark",timeToRead:177,frontmatter:{date:"2023-03-17 23:05:48",path:"/rust-practice-test/",tags:"后端, Rust, 练手测试",title:"Rust练手测试",draft:null}},{excerpt:"需求背景 在高德地图上展示路线的成功或失败情况，数据量较大，且需要全部展示，核心在于保证渲染路线的性能 技术难点 渲染可见点 分批异步渲染 利用 Simplify.js 简化轨迹 渲染可见点 根据传入的经纬度以及地图边界来确定是否渲染 监听各种事件来重新渲染 分批异步渲染 核心渲染策略：模仿 react17 的  Scheduler  调度，切成小批量渲染任务，尽可能的防止页面卡顿，这里针对不同组件分为几种情况 PathSimplifier…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>在高德地图上展示路线的成功或失败情况，数据量较大，且需要全部展示，核心在于保证渲染路线的性能</p>\n<h1 id="技术难点"><a href="#%E6%8A%80%E6%9C%AF%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术难点</h1>\n<ol>\n<li>渲染可见点</li>\n<li>分批异步渲染</li>\n<li>利用 Simplify.js 简化轨迹</li>\n</ol>\n<h1 id="渲染可见点"><a href="#%E6%B8%B2%E6%9F%93%E5%8F%AF%E8%A7%81%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染可见点</h1>\n<ol>\n<li>根据传入的经纬度以及地图边界来确定是否渲染</li>\n<li>监听各种事件来重新渲染</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15542026888087900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const isPointInView = (map, lonLat) => {\n   const bounds = map.getBounds();\n   const NorthEast = bounds.getNorthEast();\n   const SouthWest = bounds.getSouthWest();\n   const SouthEast = [NorthEast.lng, SouthWest.lat];\n   const NorthWest = [SouthWest.lng, NorthEast.lat];\n   const path = [[NorthEast.lng, NorthEast.lat], SouthEast, [SouthWest.lng, SouthWest.lat], NorthWest];\n\n   const isInView = window.AMap.GeometryUtil.isPointInRing(lonLat, path);\n   return isInView;\n};\n\nconst END_EVENTS = [\'zoomend\', \'moveend\', \'resize\'];\n\nuseAsyncEffect(async () => {\n   if (!map) {\n      return;\n   }\n\n   const handleEndEvents = debounce((...param) => {\n      console.log(\'event\', param);\n      renderLines(map, dataRef.current);\n   }, 1000);\n   END_EVENTS.forEach((event) => {\n      console.log(\'add event\', event);\n      map.on(event, handleEndEvents);\n   });\n\n   return () => {\n      END_EVENTS.forEach((event) => {\n         console.log(\'remove event\', event);\n         map.clearEvents(event);\n      });\n   };\n}, [map]);`, `15542026888087900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">isPointInView</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> lonLat</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> bounds <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> NorthEast <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">getNorthEast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> SouthWest <span class="token operator">=</span> bounds<span class="token punctuation">.</span><span class="token function">getSouthWest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> SouthEast <span class="token operator">=</span> <span class="token punctuation">[</span>NorthEast<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> SouthWest<span class="token punctuation">.</span>lat<span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> NorthWest <span class="token operator">=</span> <span class="token punctuation">[</span>SouthWest<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> NorthEast<span class="token punctuation">.</span>lat<span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>NorthEast<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> NorthEast<span class="token punctuation">.</span>lat<span class="token punctuation">]</span><span class="token punctuation">,</span> SouthEast<span class="token punctuation">,</span> <span class="token punctuation">[</span>SouthWest<span class="token punctuation">.</span>lng<span class="token punctuation">,</span> SouthWest<span class="token punctuation">.</span>lat<span class="token punctuation">]</span><span class="token punctuation">,</span> NorthWest<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> isInView <span class="token operator">=</span> window<span class="token punctuation">.</span>AMap<span class="token punctuation">.</span>GeometryUtil<span class="token punctuation">.</span><span class="token function">isPointInRing</span><span class="token punctuation">(</span>lonLat<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> isInView<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">END_EVENTS</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'zoomend\'</span><span class="token punctuation">,</span> <span class="token string">\'moveend\'</span><span class="token punctuation">,</span> <span class="token string">\'resize\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token function">useAsyncEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">const</span> handleEndEvents <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>param</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'event\'</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">renderLines</span><span class="token punctuation">(</span>map<span class="token punctuation">,</span> dataRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token constant">END_EVENTS</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'add event\'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> handleEndEvents<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token constant">END_EVENTS</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'remove event\'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         map<span class="token punctuation">.</span><span class="token function">clearEvents</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>map<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="分批异步渲染"><a href="#%E5%88%86%E6%89%B9%E5%BC%82%E6%AD%A5%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分批异步渲染</h1>\n<p>核心渲染策略：模仿 react17 的 <a href="https://github.com/facebook/react/blob/12adaffef7105e2714f82651ea51936c563fe15c/packages/scheduler/src/forks/SchedulerHostConfig.default.js#L224" target="_blank" rel="nofollow noreferrer noopener">Scheduler</a> 调度，切成小批量渲染任务，尽可能的防止页面卡顿，这里针对不同组件分为几种情况</p>\n<h2 id="pathsimplifier"><a href="#pathsimplifier" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PathSimplifier</h2>\n<ol>\n<li>采用分批异步渲染虽然加快了首次渲染速度，但卡顿还是存在，因为这里的 setData 是全量更新，没有增量更新的方法（尝试继承实现但难度较大）</li>\n<li>分析 <a href="https://webapi.amap.com/ui/1.1/ui/misc/PathSimplifier.js" target="_blank" rel="nofollow noreferrer noopener">setData 函数源码</a> 发现调用了 <code class="language-text">renderLater(10)</code>，也就是 10 毫秒后才会渲染，为此实现自定义方法然后调用 <code class="language-text">render()</code></li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49777919394403860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { requestHostCallback, cancelHostCallback, shouldYieldToHost } from \'@/utils/SchedulerHostConfig\';\n\nconst batchRender = (pathSimplifierIns, lines) => {\n   const size = 100;\n   const totalPage = Math.ceil(lines.length / size);\n   // 取消之前主线程的任务\n   cancelHostCallback();\n\n   const render = () => {\n      let page = 0;\n      return () => {\n         // 是否需要让出主线程\n         if (shouldYieldToHost() || page >= totalPage) {\n            return;\n         }\n         const splitLines = lines.slice(0, page * size + size);\n         console.log(\'draw splitLines length\', splitLines.length);\n         // pathSimplifierIns.setDataImmediate(splitLines)\n         pathSimplifierIns.setData(splitLines);\n         page++;\n         return page < totalPage;\n      };\n   };\n\n   requestHostCallback(render());\n};\n\nconst loadMyPathSimplifier = () => {\n   return new Promise((resolve) => {\n      window.AMapUI.load([\'lib/utils\'], function(utils) {\n         // 新的类\n         function MyPathSimplifier(opts) {\n            // 调用父级的构造方法\n            MyPathSimplifier.__super__.constructor.call(this, opts);\n            // ..额外的初始化逻辑..\n         }\n\n         // 继承功能\n         utils.inherit(MyPathSimplifier, window.AMapUI.PathSimplifier);\n\n         // 增加或者覆盖接口\n         utils.extend(MyPathSimplifier.prototype, {\n            // ..新的接口\n            setDataImmediate(data) {\n               this._buildData(data);\n               this.render();\n            }\n         });\n\n         resolve({\n            MyPathSimplifier\n         });\n      });\n   });\n};`, `49777919394403860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{19}"\n              >\n                <span class="gatsby-code-button-language">js{19}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> requestHostCallback<span class="token punctuation">,</span> cancelHostCallback<span class="token punctuation">,</span> shouldYieldToHost <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils/SchedulerHostConfig\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">batchRender</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pathSimplifierIns<span class="token punctuation">,</span> lines</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> totalPage <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>lines<span class="token punctuation">.</span>length <span class="token operator">/</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// 取消之前主线程的任务</span>\n   <span class="token function">cancelHostCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token comment">// 是否需要让出主线程</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldYieldToHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> page <span class="token operator">>=</span> totalPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token keyword">const</span> splitLines <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> page <span class="token operator">*</span> size <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'draw splitLines length\'</span><span class="token punctuation">,</span> splitLines<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token comment">// pathSimplifierIns.setDataImmediate(splitLines)</span>\n<span class="gatsby-highlight-code-line">         pathSimplifierIns<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>splitLines<span class="token punctuation">)</span><span class="token punctuation">;</span></span>         page<span class="token operator">++</span><span class="token punctuation">;</span>\n         <span class="token keyword">return</span> page <span class="token operator">&lt;</span> totalPage<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token function">requestHostCallback</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">loadMyPathSimplifier</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      window<span class="token punctuation">.</span>AMapUI<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'lib/utils\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">utils</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// 新的类</span>\n         <span class="token keyword">function</span> <span class="token function">MyPathSimplifier</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 调用父级的构造方法</span>\n            MyPathSimplifier<span class="token punctuation">.</span><span class="token class-name">__super__</span><span class="token punctuation">.</span><span class="token function">constructor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token comment">// ..额外的初始化逻辑..</span>\n         <span class="token punctuation">}</span>\n\n         <span class="token comment">// 继承功能</span>\n         utils<span class="token punctuation">.</span><span class="token function">inherit</span><span class="token punctuation">(</span>MyPathSimplifier<span class="token punctuation">,</span> window<span class="token punctuation">.</span>AMapUI<span class="token punctuation">.</span>PathSimplifier<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// 增加或者覆盖接口</span>\n         utils<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token class-name">MyPathSimplifier</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            <span class="token comment">// ..新的接口</span>\n            <span class="token function">setDataImmediate</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_buildData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n               <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n         <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            MyPathSimplifier\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="性能测试"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>性能测试</h3>\n<p>以下测试都是在浏览器隐私模式下监控性能数据，所需操作如下</p>\n<ol>\n<li>地图上从小数据一直加载到大数据</li>\n<li>加载到大量数据时对地图进行缩放、拖拽</li>\n</ol>\n<p>左侧为 <code class="language-text">setDataImmediate()</code>, 右侧为 <code class="language-text">setData()</code>，性能差异不大</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-b7e20.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.175849941383355%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB50lEQVQozyWQV3PUQBCE9f//B++ATTA4YFwF3J0c7sTpbGXtKq6kVdqkXQVkM/VV11RPv/RocZxEMMpzhDGOExTFWYqqOM0xrlCJQRDGEOZZhqsqTvIoTtK8TJIUVwVuGg0nADn3KNijwFi1DPcIGFlwQKGR2k/otC2sTenppf9QeHrlr8lDbum5vY39R60lQkjFpKRCMqGElIQrIhQVquk63PZCKT5IOkj2iurY2LJVZd0SrScSJOQNClIaxgTAJgyqEDRZTspmgEjCXMCMQzSAmLz5LMpEhoXmPZ+2N183K7cXr/z8trm7+P3jy5/bi4O+OW7u7i/P9csz/ep8d/Vx9/395vrT4dft3dk7/eaDVvRZwu2Q2T63AXnFJc9ub/rMDGvfK57D3nC6g02OTrN36r3THtfMA/x8AteaAUodRmboub75UJ6eStPODCty3DD1qnwXwm0UGYFjeX93hXFfHa30YEeW6XoBhtoLqMy1oQ3KlxeztIPebwu/hknvdoRJC1Z2TJMANbbr4MBtgzr3apjWLh/VqC3LtI4ap2Fa5KCUnIdx5koO07A+mQsq5ThMs1iWUS6zWuQ4y3ni8zDPk0aoYIxxzoTgPSOEUUpbQrqekJ52dbsuq0MYo/8hpGWcdOuRsX8K0Bv9T2JVpQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 03 05 00 40 30" title="" data-src="/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-fee1c.png" data-srcset="/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-a67b7.png 200w,\n/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-0b187.png 400w,\n/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-fee1c.png 800w,\n/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-b1a91.png 1200w,\n/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-95179.png 1600w,\n/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-5d5ba.png 2400w,\n/static/2023-03-05-00-40-30-568de3772d4a8ffb0ba5f2b3a403c397-b7e20.png 2559w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h3>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/25ydwf?codemirror=1&amp;hidenavigation=1&amp;module=%2Fsrc%2Fcomponents%2FReactAmap%2Fhooks%2FuseDrawLines.js&amp;runonclick=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="polyline"><a href="#polyline" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Polyline</h2>\n<ol>\n<li>Polyline 有增量更新的方法，但同时需要考虑增量删除的方法，否则全量删除同样会造成页面卡顿</li>\n<li>v1.4 和 v2.0 在实现相同功能的情况下有性能差异，截止 2023-3-4 22:40:07 为止 v1.4 性能表现更好</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18562330460676747000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const SIZE = 100;\n\nconst batchRender = (map, lines) => {\n   const size = SIZE;\n   const totalPage = Math.ceil(lines.length / size);\n\n   const render = () => {\n      let page = 0;\n      return () => {\n         if (shouldYieldToHost() || page >= totalPage) {\n            console.log(\'shouldYieldToHost\', page);\n            return;\n         }\n         const splitLines = lines.slice(page * size, page * size + size);\n         if (page + 1 >= totalPage) {\n            console.log(\'draw polylines length\', lines.length);\n         }\n         map.add(splitLines);\n         page++;\n         return page < totalPage;\n      };\n   };\n\n   requestHostCallback(render());\n};\n\n// 注意这里需要用闭包实现\nconst handleClearLines = (map, clearLines) => {\n   (function(clearLines) {\n      if (clearLines && clearLines.length > 0) {\n         const size = SIZE;\n         const totalPage = Math.ceil(clearLines.length / size);\n         const clearFunc = (page) => {\n            if (page >= totalPage) {\n               return;\n            }\n            const splitLines = clearLines.slice(page * size, page * size + size);\n            if (page + 1 >= totalPage) {\n               console.log(\'remove polylines length\', clearLines.length);\n            }\n            map.remove(splitLines);\n            requestHostTimeout(() => clearFunc(page + 1), 0);\n         };\n\n         clearFunc(0);\n      }\n   })(clearLines);\n};`, `18562330460676747000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{18,41}"\n              >\n                <span class="gatsby-code-button-language">js{18,41}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">SIZE</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">batchRender</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> lines</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token constant">SIZE</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> totalPage <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>lines<span class="token punctuation">.</span>length <span class="token operator">/</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">shouldYieldToHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> page <span class="token operator">>=</span> totalPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'shouldYieldToHost\'</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token keyword">const</span> splitLines <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>page <span class="token operator">*</span> size<span class="token punctuation">,</span> page <span class="token operator">*</span> size <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">>=</span> totalPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'draw polylines length\'</span><span class="token punctuation">,</span> lines<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n<span class="gatsby-highlight-code-line">         map<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>splitLines<span class="token punctuation">)</span><span class="token punctuation">;</span></span>         page<span class="token operator">++</span><span class="token punctuation">;</span>\n         <span class="token keyword">return</span> page <span class="token operator">&lt;</span> totalPage<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token function">requestHostCallback</span><span class="token punctuation">(</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 注意这里需要用闭包实现</span>\n<span class="token keyword">const</span> <span class="token function-variable function">handleClearLines</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">map<span class="token punctuation">,</span> clearLines</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">clearLines</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>clearLines <span class="token operator">&amp;&amp;</span> clearLines<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token constant">SIZE</span><span class="token punctuation">;</span>\n         <span class="token keyword">const</span> totalPage <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>clearLines<span class="token punctuation">.</span>length <span class="token operator">/</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">const</span> <span class="token function-variable function">clearFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">page</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">>=</span> totalPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">const</span> splitLines <span class="token operator">=</span> clearLines<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>page <span class="token operator">*</span> size<span class="token punctuation">,</span> page <span class="token operator">*</span> size <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>page <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">>=</span> totalPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'remove polylines length\'</span><span class="token punctuation">,</span> clearLines<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n<span class="gatsby-highlight-code-line">            map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>splitLines<span class="token punctuation">)</span><span class="token punctuation">;</span></span>            <span class="token function">requestHostTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearFunc</span><span class="token punctuation">(</span>page <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n         <span class="token function">clearFunc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>clearLines<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="性能测试-1"><a href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>性能测试</h3>\n<p>左侧为 v2.0，右侧为 v1.4，可以看到 v1.4 有以下优点</p>\n<ol>\n<li>渲染速度快</li>\n<li>js 堆内存占用少</li>\n<li>最大长任务 1.72s 少于 v2.0 的 2.16s</li>\n</ol>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-b7e20.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 49.706916764361075%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB7ElEQVQozy1QS2+bQBjk/5977iWpem0vbSqlapOmNhiME9sxGBvD8lgM7IPHsjwNXVsdjUajb2YunxQGfuiB5BxRlIYwCsLwHKcwiihOE4Rdx4WeF0NIEBKJ6EYxCsIzJTgIoYTdFTKe8WGGbRnbM+ooFCyIpxGgxqdlbGnIeEH7GToo+KgIpWCJwYb6K2hrUs7qsu7LZmBX9lXdU9bhoiVFG6McpoRWLSlrXNaUNVdTcFJwsYriREJ565POg5kbFU7aeKipu8t0Qz8MrG7GaRqEv+nVjFM3jKLBOJcMw92qO1N932uGoRvWq1n6oM/SASc8hubamj+qyq+l+qQrv5fKsy7/0eWnlfzypi3W0hkssP45Ue/P2qdUuYsXd65yb2ofLfmDu/xyMjWw+nFa/TzoD476YC++G8tvrqEcNl83q0dpcYSKab9vX8FW1gNl7cueM99t5sZmDRNfOZGZz9+cdLe3Z7H7F7mb0HECeLBzKyKSHWbmqfD3kB7AEQUeCfIY5CGp/JaxCsDCCsrjESbWEVAQlEGe+sgPyKnEiEqs667PGf8/SeBy5ThMXde3Ba/4rdCPF94OfT81l7G/tOM08rqSUkJoLkiLPKs4E6eKl7wq66YqKhYnaZVnJRU5yctMHGsRMdbVjRj9A90jG2YO8RKUAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 03 05 00 15 17" title="" data-src="/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-fee1c.png" data-srcset="/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-a67b7.png 200w,\n/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-0b187.png 400w,\n/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-fee1c.png 800w,\n/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-b1a91.png 1200w,\n/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-95179.png 1600w,\n/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-5d5ba.png 2400w,\n/static/2023-03-05-00-15-17-1e9ad8bac183d183f89affc3f89fd586-b7e20.png 2559w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="实现效果-1"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h3>\n<h4 id="v20"><a href="#v20" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>v2.0</h4>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/n4tfz5?codemirror=1&amp;hidenavigation=1&amp;module=%2Fsrc%2Fcomponents%2FReactAmap%2Fhooks%2FuseDrawLines.js&amp;runonclick=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="v14"><a href="#v14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>v1.4</h4>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/lrlknj?codemirror=1&amp;hidenavigation=1&amp;module=%2Fsrc%2Fcomponents%2FReactAmap%2Fhooks%2FuseDrawLines.js&amp;runonclick=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="未来优化点"><a href="#%E6%9C%AA%E6%9D%A5%E4%BC%98%E5%8C%96%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未来优化点</h1>\n<p>参考资料：<a href="https://www.infoq.cn/article/ByHjSpUD0KrhKSulyYED" target="_blank" rel="nofollow noreferrer noopener">16 毫秒的挑战：图表库渲染优化</a></p>\n<ol>\n<li>增量复用已有节点</li>\n<li>大数据内存占用优化</li>\n<li>根据分片运行时间自动调整分片大小</li>\n<li>换 3d 渲染（3d 的缩放拖拽是通过摄像头视角改变来实现的，理论上比 2d 的渲染要快）</li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/高德地图海量数据组件优化/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2023-03-03 16:54:13",path:"/amap-big-data-component-optimize/",tags:"前端, 地图, 预研",title:"高德地图海量数据组件优化",draft:null}},{excerpt:"需求背景 接上文  CRA 项目构建速度优化 由下图可以看出此项目的  ，  耗时较长，需要优化 方案 目前是全量更新，需要改成增量更新 实现 原始版本 版本一 固定使用一个目录为缓存目录，拉取代码和构建代码都在这个缓存目录上 利用 git 和 rsync…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>接上文 <a href="/cra-project-build-speed-optimize/">CRA 项目构建速度优化</a></p>\n<p>由下图可以看出此项目的 <code class="language-text">Clone Repo</code>，<code class="language-text">Scp to build_node</code> 耗时较长，需要优化</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-0f56a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.19047619047619%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABL0lEQVQY01WQDW+DIBCG/f8/b9lWPwoCWhCpiijyUYq7dsmSXd5c7oG7lxzFsmrCqJDD88ygfObzPN/F+dYL8xt/z/8yRHH+j8MdYhAhBrNtZjMhRvB13i96meYpPqK6333wq1lHpQowSTkba7Ux23FMi/4uy1nrbbfbvgOWdb0sWipF+ttuj55zva6DHFtKCzfNinUSozshd0pvtMHXT0Yq3iPRXVtcoearpxUldd1UrK2vzQfFF94h0aMCXpjmZRA8BJ9TYpZfthYdHUuSpqF1fWkwIBSt67Drq71FtiNRkMiLydhhXvWqQ3rAx3RuLHeKHWdZsafCTjRHjz3HXiDIjteWoeMGV6AiPhNsK5X0McD+nZcXS6AbhmkeceCVpShwGGjcy6UEdDeSRpLkD4t/hoHkVqdHAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 12 16 19 28 35" title="" data-src="/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-fee1c.png" data-srcset="/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-a67b7.png 200w,\n/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-0b187.png 400w,\n/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-fee1c.png 800w,\n/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-0f56a.png 1050w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="方案"><a href="#%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h1>\n<p>目前是全量更新，需要改成增量更新</p>\n<h1 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h1>\n<h2 id="原始版本"><a href="#%E5%8E%9F%E5%A7%8B%E7%89%88%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原始版本</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77014050561913060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gitlab_repo = &quot;\\${params.gitlab_repo}&quot;\ndef split = gitlab_repo.split(&quot;/&quot;)\ndef repo_name = split[1]\nbranch_name = &quot;\\${params.branch_name}&quot;\ndef split2 = branch_name.split(&quot;/&quot;)\ndef branch_last_name = split2[split2.length-1]\ndockerhub_repo = &quot;\\${params.dockerhub_repo}&quot;\nparameter = &quot;\\${params.parameter}&quot;\nrepo_url = &quot;仓库地址&quot;\nuse_cache = &quot;\\${params.use_cache}&quot;\ncache_version =&quot;\\${params.cache_version}&quot;\n\ndef cache_arg = &quot;&quot;\n\nif (use_cache == \'false\') {\n    cache_arg = &quot;--no-cache&quot;\n}\n\nbuild_node = &quot;\\${params.build_node}&quot;\nbuild_node_ip = \'build机器地址\'\nclone_node = \'部署机器标签\'\n\nimport java.text.SimpleDateFormat;\ndef createVersion() {\n    def dateUnix = ((new Date().time + 22800000) / 1000).intValue()\n    Date dateObj =  new Date( ((long)dateUnix) * 1000 )\n    String ymd = new SimpleDateFormat(&quot;yyMMddHHmmss&quot;).format(dateObj)\n    return &quot;\\${ymd}&quot;\n}\nymd = createVersion()\nimage_version = &quot;1.0.9.\\${ymd}&quot;\n\nwork_dir = &quot;项目名称_\\${ymd}&quot;\n\nprintln(&quot;gitlab_repo branch=\\${gitlab_repo} \\${branch_name}&quot;)\nprintln(&quot;repo_name=\\${repo_name}, image_version=\\${image_version}&quot;)\nprintln(&quot;dockerhub_repo=\\${dockerhub_repo}&quot;)\nprintln(&quot;cache_arg=\\${cache_arg}&quot;)\nprintln(&quot;cache_version=\\${cache_version}&quot;)\n\nbuild_user=&quot;&quot;\nnode{\n    wrap([\\$class: \'BuildUser\']) {\n        build_user = env.BUILD_USER\n    }\n}\nprintln(&quot;build_user=\\${build_user}&quot;)\n\ndefault_description = &quot;@\\${build_user} \\${gitlab_repo} \\${branch_name}:\\${image_version}&quot;\ncurrentBuild.description = &quot;\\${default_description}&quot;\n\npipeline {\n    agent {\n        node {\n            label &quot;\\${build_node}&quot;\n        }\n    }\n\n    environment {\n        repo_name1 = &quot;\\${repo_name}&quot;\n        branch_last_name1 = &quot;\\${branch_last_name}&quot;\n    }\n\n    stages {\n        stage(\'Clean workspace\') {\n        agent {\n            node {\n                label &quot;\\${build_node}&quot;\n            }\n        }\n         steps {\n            sh &quot;&quot;&quot;\n                rm -fr /home/jenkins/workspace/apps/项目名称/\\${work_dir} || true\n            &quot;&quot;&quot;\n        }\n      }\n\n      stage(&quot;Clone Repo&quot;){\n          agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            sh &quot;&quot;&quot;\n            cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n            bash clone.sh \\${gitlab_repo} \\${branch_name} \\${work_dir}\n            ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py \\${work_dir} 机器人webhook\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(&quot;Scp to build_node&quot;) {\n         agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            echo &quot;Scp to \\${build_node}/\\${build_node_ip}&quot;\n            sh &quot;&quot;&quot;\n                pwd\n                rsync -Lrav --relative \\${work_dir}/前端目录名称/ jenkins@\\${build_node_ip}:/home/jenkins/workspace/apps/项目名称/\n                if [ \\\\$? -ne 0 ]\n                then\n                    echo &quot;Found some error when copy the repo&quot;\n                fi\n                rm -fr \\${work_dir} || true\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(\'Build docker images\') {\n         agent {\n             node {\n                 label &quot;\\${build_node}&quot;\n             }\n         }\n         steps {\n             sh &quot;&quot;&quot;\n                if [ ! -f /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/Dockerfile-client-buildkit ]\n                then\n                    echo &quot;No available 前端目录名称/Dockerfile-client-buildkit in workspace&quot;\n                    exit 1\n                fi\n\n                cd /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/\n                # docker info\n                docker -v\n                DOCKER_BUILDKIT=1 docker build \\${cache_arg} --build-arg=BUILDKIT_CACHE_MOUNT_NS=\\${cache_version} -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/\\${dockerhub_repo}:\\${image_version}\n                pwd\n                ls\n                rm -fr /home/jenkins/workspace/apps/项目名称/\\${work_dir} || true\n            &quot;&quot;&quot;\n        }\n      }\n\n      stage(\'Set tag\') {\n         agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n             dir(&quot;\\${repo_name1}_\\${branch_name}&quot;){\n                sh &quot;&quot;&quot;\n                echo \'escape git tag\'\n                    #git tag -m &quot;Build docker image \\${image_version} for \\${branch_name}/\\${image_version}&quot; \\${branch_name}/\\${image_version}\n                    #git describe\n                    #git push origin \\${branch_name}/\\${image_version}\n                rm -fr \\${work_dir}\n                &quot;&quot;&quot;\n             }\n         }\n      }\n\n    }\n    post {\n        always {\n            echo \'I have finished\'\n        }\n        success {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n        failure {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n    }\n}`, `77014050561913060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="groovy"\n              >\n                <span class="gatsby-code-button-language">groovy</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="groovy"><pre style="counter-reset: linenumber NaN" class="language-groovy line-numbers"><code class="language-groovy">gitlab_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>gitlab_repo<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split <span class="token operator">=</span> gitlab_repo<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> repo_name <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\nbranch_name <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>branch_name<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split2 <span class="token operator">=</span> branch_name<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> branch_last_name <span class="token operator">=</span> split2<span class="token punctuation">[</span>split2<span class="token operator">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\ndockerhub_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span>\nparameter <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>parameter<span class="token punctuation">}</span></span>"</span>\nrepo_url <span class="token operator">=</span> <span class="token string gstring">"仓库地址"</span>\nuse_cache <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>use_cache<span class="token punctuation">}</span></span>"</span>\ncache_version <span class="token operator">=</span><span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>cache_version<span class="token punctuation">}</span></span>"</span>\n\n<span class="token keyword">def</span> cache_arg <span class="token operator">=</span> <span class="token string gstring">""</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>use_cache <span class="token operator">==</span> <span class="token string">\'false\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    cache_arg <span class="token operator">=</span> <span class="token string gstring">"--no-cache"</span>\n<span class="token punctuation">}</span>\n\nbuild_node <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>build_node<span class="token punctuation">}</span></span>"</span>\nbuild_node_ip <span class="token operator">=</span> <span class="token string">\'build机器地址\'</span>\nclone_node <span class="token operator">=</span> <span class="token string">\'部署机器标签\'</span>\n\n<span class="token keyword">import</span> java<span class="token operator">.</span>text<span class="token operator">.</span>SimpleDateFormat<span class="token punctuation">;</span>\n<span class="token keyword">def</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">def</span> dateUnix <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span>time <span class="token operator">+</span> <span class="token number">22800000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    Date dateObj <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>dateUnix<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>\n    String ymd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string gstring">"yyMMddHHmmss"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">format</span><span class="token punctuation">(</span>dateObj<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n<span class="token punctuation">}</span>\nymd <span class="token operator">=</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nimage_version <span class="token operator">=</span> <span class="token string gstring">"1.0.9.<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n\nwork_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称_<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"gitlab_repo branch=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"repo_name=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>, image_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"dockerhub_repo=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_arg=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\nbuild_user<span class="token operator">=</span><span class="token string gstring">""</span>\nnode<span class="token punctuation">{</span>\n    <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">\'BuildUser\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        build_user <span class="token operator">=</span> env<span class="token operator">.</span>BUILD_USER\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"build_user=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\ndefault_description <span class="token operator">=</span> <span class="token string gstring">"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span>\ncurrentBuild<span class="token operator">.</span>description <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>default_description<span class="token punctuation">}</span></span>"</span>\n\npipeline <span class="token punctuation">{</span>\n    agent <span class="token punctuation">{</span>\n        node <span class="token punctuation">{</span>\n            label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    environment <span class="token punctuation">{</span>\n        repo_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>"</span>\n        branch_last_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_last_name<span class="token punctuation">}</span></span>"</span>\n    <span class="token punctuation">}</span>\n\n    stages <span class="token punctuation">{</span>\n        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Clean workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n                rm -fr /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true\n            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Clone Repo"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n          agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n            cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n            bash clone.sh <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n            ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> 机器人webhook\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Scp to build_node"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"Scp to <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>"</span>\n            sh <span class="token string gstring">"""\n                pwd\n                rsync -Lrav --relative <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/ jenkins@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>:/home/jenkins/workspace/apps/项目名称/\n                if [ \\$? -ne 0 ]\n                then\n                    echo "Found some error when copy the repo"\n                fi\n                rm -fr <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Build docker images\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n             sh <span class="token string gstring">"""\n                if [ ! -f /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/Dockerfile-client-buildkit ]\n                then\n                    echo "No available 前端目录名称/Dockerfile-client-buildkit in workspace"\n                    exit 1\n                fi\n\n                cd /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/\n                # docker info\n                docker -v\n                DOCKER_BUILDKIT=1 docker build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span> --build-arg=BUILDKIT_CACHE_MOUNT_NS=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span> -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>\n                pwd\n                ls\n                rm -fr /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true\n            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Set tag\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n             <span class="token function">dir</span><span class="token punctuation">(</span><span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name1<span class="token punctuation">}</span></span>_<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n                sh <span class="token string gstring">"""\n                echo \'escape git tag\'\n                    #git tag -m "Build docker image <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> for <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>" <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>\n                    #git describe\n                    #git push origin <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>\n                rm -fr <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                """</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n    <span class="token punctuation">}</span>\n    post <span class="token punctuation">{</span>\n        always <span class="token punctuation">{</span>\n            echo <span class="token string">\'I have finished\'</span>\n        <span class="token punctuation">}</span>\n        success <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n        failure <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="版本一"><a href="#%E7%89%88%E6%9C%AC%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本一</h2>\n<ol>\n<li>固定使用一个目录为缓存目录，拉取代码和构建代码都在这个缓存目录上</li>\n<li>利用 git 和 rsync 的增量更新</li>\n<li>不使用缓存时删除固定目录的缓存</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20281262896539220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gitlab_repo = &quot;\\${params.gitlab_repo}&quot;\ndef split = gitlab_repo.split(&quot;/&quot;)\ndef repo_name = split[1]\nbranch_name = &quot;\\${params.branch_name}&quot;\ndef split2 = branch_name.split(&quot;/&quot;)\ndef branch_last_name = split2[split2.length-1]\ndockerhub_repo = &quot;\\${params.dockerhub_repo}&quot;\nparameter = &quot;\\${params.parameter}&quot;\nrepo_url = &quot;仓库地址&quot;\nuse_cache = &quot;\\${params.use_cache}&quot;\ncache_version =&quot;\\${params.cache_version}&quot;\nis_cache_project = &quot;\\${params.is_cache_project}&quot;\n\ndef cache_arg = &quot;&quot;\n\nif (use_cache == \'false\') {\n    cache_arg = &quot;--no-cache&quot;\n}\n\nbuild_node = &quot;\\${params.build_node}&quot;\nbuild_node_ip = \'build机器地址\'\nclone_node = \'部署机器标签\'\n\nimport java.text.SimpleDateFormat;\ndef createVersion() {\n    def dateUnix = ((new Date().time + 22800000) / 1000).intValue()\n    Date dateObj =  new Date( ((long)dateUnix) * 1000 )\n    String ymd = new SimpleDateFormat(&quot;yyMMddHHmmss&quot;).format(dateObj)\n    return &quot;\\${ymd}&quot;\n}\nymd = createVersion()\nimage_version = &quot;1.0.9.\\${ymd}&quot;\n\nwork_dir = &quot;项目名称&quot;\n\nprintln(&quot;gitlab_repo branch=\\${gitlab_repo} \\${branch_name}&quot;)\nprintln(&quot;repo_name=\\${repo_name}, image_version=\\${image_version}&quot;)\nprintln(&quot;dockerhub_repo=\\${dockerhub_repo}&quot;)\nprintln(&quot;cache_arg=\\${cache_arg}&quot;)\nprintln(&quot;cache_version=\\${cache_version}&quot;)\n\nbuild_user=&quot;&quot;\nnode{\n    wrap([\\$class: \'BuildUser\']) {\n        build_user = env.BUILD_USER\n    }\n}\nprintln(&quot;build_user=\\${build_user}&quot;)\n\ndefault_description = &quot;@\\${build_user} \\${gitlab_repo} \\${branch_name}:\\${image_version}&quot;\ncurrentBuild.description = &quot;\\${default_description}&quot;\n\npipeline {\n    agent {\n        node {\n            label &quot;\\${build_node}&quot;\n        }\n    }\n\n    environment {\n        repo_name1 = &quot;\\${repo_name}&quot;\n        branch_last_name1 = &quot;\\${branch_last_name}&quot;\n    }\n\n    stages {\n      stage(\'Clean workspace\') {\n        agent {\n            node {\n                label &quot;\\${build_node}&quot;\n            }\n        }\n         steps {\n            sh &quot;&quot;&quot;\n            if [ \\${is_cache_project} = \'false\' ]\n            then\n               rm -fr /home/jenkins/workspace/apps/项目名称/\\${work_dir} || true\n            fi\n            &quot;&quot;&quot;\n        }\n      }\n      stage(&quot;Clone Repo&quot;){\n          agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            sh &quot;&quot;&quot;\n            # ls -la\n            if [ \\${is_cache_project} = \'false\' ]\n            then\n               rm -rf \\${work_dir} || true\n            fi\n            if [ ! -d \\${work_dir} ]\n            then\n               cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n               bash clone.sh \\${gitlab_repo} \\${branch_name} \\${work_dir}\n            else\n               cd \\${work_dir}\n               # 1、为了让脚本检测，2、master 拉取最新\n               git checkout master\n               git pull origin master\n\n               if [ \\${branch_name} != \'master\' ]\n               then\n                  git checkout \\${branch_name}\n                  # 强制拉取远程代码到本地\n                  git pull --force origin \\${branch_name}:\\${branch_name}\n               fi\n               cd ..\n            fi\n            # ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py \\${work_dir} 机器人webhook\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(&quot;Scp to build_node&quot;) {\n         agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            echo &quot;Scp to \\${build_node}/\\${build_node_ip}&quot;\n            sh &quot;&quot;&quot;\n                # pwd\n                rsync -Lazv -R \\${work_dir}/前端目录名称/ jenkins@\\${build_node_ip}:/home/jenkins/workspace/apps/项目名称/\n                if [ \\\\$? -ne 0 ]\n                then\n                    echo &quot;Found some error when copy the repo&quot;\n                fi\n                # rm -fr \\${work_dir} || true\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(\'Build docker images\') {\n         agent {\n             node {\n                 label &quot;\\${build_node}&quot;\n             }\n         }\n         steps {\n             sh &quot;&quot;&quot;\n                if [ ! -f /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/Dockerfile-client-buildkit ]\n                then\n                  echo &quot;No available 前端目录名称/Dockerfile-client-buildkit in workspace&quot;\n                  exit 1\n                fi\n\n                cd /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build \\${cache_arg} --build-arg=BUILDKIT_CACHE_MOUNT_NS=\\${cache_version} -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/\\${dockerhub_repo}:\\${image_version}\n                # pwd\n                # ls\n                # rm -fr /home/jenkins/workspace/apps/项目名称/\\${work_dir} || true\n            &quot;&quot;&quot;\n        }\n      }\n   }\n\n    post {\n        always {\n            echo \'I have finished\'\n        }\n        success {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n        failure {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n    }\n}`, `20281262896539220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="groovy{12,34,74-77,89-112,128-129,134,159-161}"\n              >\n                <span class="gatsby-code-button-language">groovy{12,34,74-77,89-112,128-129,134,159-161}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="groovy"><pre style="counter-reset: linenumber NaN" class="language-groovy line-numbers"><code class="language-groovy">gitlab_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>gitlab_repo<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split <span class="token operator">=</span> gitlab_repo<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> repo_name <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\nbranch_name <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>branch_name<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split2 <span class="token operator">=</span> branch_name<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> branch_last_name <span class="token operator">=</span> split2<span class="token punctuation">[</span>split2<span class="token operator">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\ndockerhub_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span>\nparameter <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>parameter<span class="token punctuation">}</span></span>"</span>\nrepo_url <span class="token operator">=</span> <span class="token string gstring">"仓库地址"</span>\nuse_cache <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>use_cache<span class="token punctuation">}</span></span>"</span>\ncache_version <span class="token operator">=</span><span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>cache_version<span class="token punctuation">}</span></span>"</span>\n<span class="gatsby-highlight-code-line">is_cache_project <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>is_cache_project<span class="token punctuation">}</span></span>"</span></span>\n<span class="token keyword">def</span> cache_arg <span class="token operator">=</span> <span class="token string gstring">""</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>use_cache <span class="token operator">==</span> <span class="token string">\'false\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    cache_arg <span class="token operator">=</span> <span class="token string gstring">"--no-cache"</span>\n<span class="token punctuation">}</span>\n\nbuild_node <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>build_node<span class="token punctuation">}</span></span>"</span>\nbuild_node_ip <span class="token operator">=</span> <span class="token string">\'build机器地址\'</span>\nclone_node <span class="token operator">=</span> <span class="token string">\'部署机器标签\'</span>\n\n<span class="token keyword">import</span> java<span class="token operator">.</span>text<span class="token operator">.</span>SimpleDateFormat<span class="token punctuation">;</span>\n<span class="token keyword">def</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">def</span> dateUnix <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span>time <span class="token operator">+</span> <span class="token number">22800000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    Date dateObj <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>dateUnix<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>\n    String ymd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string gstring">"yyMMddHHmmss"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">format</span><span class="token punctuation">(</span>dateObj<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n<span class="token punctuation">}</span>\nymd <span class="token operator">=</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nimage_version <span class="token operator">=</span> <span class="token string gstring">"1.0.9.<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n\n<span class="gatsby-highlight-code-line">work_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称"</span></span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"gitlab_repo branch=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"repo_name=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>, image_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"dockerhub_repo=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_arg=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\nbuild_user<span class="token operator">=</span><span class="token string gstring">""</span>\nnode<span class="token punctuation">{</span>\n    <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">\'BuildUser\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        build_user <span class="token operator">=</span> env<span class="token operator">.</span>BUILD_USER\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"build_user=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\ndefault_description <span class="token operator">=</span> <span class="token string gstring">"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span>\ncurrentBuild<span class="token operator">.</span>description <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>default_description<span class="token punctuation">}</span></span>"</span>\n\npipeline <span class="token punctuation">{</span>\n    agent <span class="token punctuation">{</span>\n        node <span class="token punctuation">{</span>\n            label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    environment <span class="token punctuation">{</span>\n        repo_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>"</span>\n        branch_last_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_last_name<span class="token punctuation">}</span></span>"</span>\n    <span class="token punctuation">}</span>\n\n    stages <span class="token punctuation">{</span>\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Clean workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">            if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'false\' ]</span><span class="gatsby-highlight-code-line">            then</span><span class="gatsby-highlight-code-line">               rm -fr /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true</span><span class="gatsby-highlight-code-line">            fi</span>            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Clone Repo"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n          agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">            # ls -la</span><span class="gatsby-highlight-code-line">            if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'false\' ]</span><span class="gatsby-highlight-code-line">            then</span><span class="gatsby-highlight-code-line">               rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true</span><span class="gatsby-highlight-code-line">            fi</span><span class="gatsby-highlight-code-line">            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> ]</span><span class="gatsby-highlight-code-line">            then</span><span class="gatsby-highlight-code-line">               cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .</span><span class="gatsby-highlight-code-line">               bash clone.sh <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">            else</span><span class="gatsby-highlight-code-line">               cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">               # 1、为了让脚本检测，2、master 拉取最新</span><span class="gatsby-highlight-code-line">               git checkout master</span><span class="gatsby-highlight-code-line">               git pull origin master</span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">               if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> != \'master\' ]</span><span class="gatsby-highlight-code-line">               then</span><span class="gatsby-highlight-code-line">                  git checkout <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                  # 强制拉取远程代码到本地</span><span class="gatsby-highlight-code-line">                  git pull --force origin <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">               fi</span><span class="gatsby-highlight-code-line">               cd ..</span><span class="gatsby-highlight-code-line">            fi</span><span class="gatsby-highlight-code-line">            # ls -la</span>            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> 机器人webhook\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Scp to build_node"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"Scp to <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>"</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                # pwd</span><span class="gatsby-highlight-code-line">                rsync -Lazv -R <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/ jenkins@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>:/home/jenkins/workspace/apps/项目名称/</span>                if [ \\$? -ne 0 ]\n                then\n                    echo "Found some error when copy the repo"\n                fi\n<span class="gatsby-highlight-code-line">                # rm -fr <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true</span>            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Build docker images\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n             sh <span class="token string gstring">"""\n                if [ ! -f /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/Dockerfile-client-buildkit ]\n                then\n                  echo "No available 前端目录名称/Dockerfile-client-buildkit in workspace"\n                  exit 1\n                fi\n\n                cd /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span> --build-arg=BUILDKIT_CACHE_MOUNT_NS=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span> -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>\n<span class="gatsby-highlight-code-line">                # pwd</span><span class="gatsby-highlight-code-line">                # ls</span><span class="gatsby-highlight-code-line">                # rm -fr /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true</span>            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n\n    post <span class="token punctuation">{</span>\n        always <span class="token punctuation">{</span>\n            echo <span class="token string">\'I have finished\'</span>\n        <span class="token punctuation">}</span>\n        success <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n        failure <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="版本二"><a href="#%E7%89%88%E6%9C%AC%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本二</h2>\n<ol>\n<li>固定使用一个目录为缓存目录，拷贝到带有新后缀的目录（拉取代码和构建代码的目录），和之前逻辑一样，解决并行执行问题</li>\n<li>不使用缓存时不拷贝到对应目录</li>\n<li>独立出缓存步骤，减少并行执行时带来的文件互操作问题</li>\n<li>修复非 master 分支时拉取代码的错误逻辑，强制更新远程代码到本地代码</li>\n<li>rsync 添加 <code class="language-text">-cr</code> 选项，去掉 <code class="language-text">-a</code> 选项，即更新时只比较所有文件的校验和，不再通过文件的更新时间比较（即不需要通过 <code class="language-text">-a</code> 传递所有的文件信息）</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84908851427687090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gitlab_repo = &quot;\\${params.gitlab_repo}&quot;\ndef split = gitlab_repo.split(&quot;/&quot;)\ndef repo_name = split[1]\nbranch_name = &quot;\\${params.branch_name}&quot;\ndef split2 = branch_name.split(&quot;/&quot;)\ndef branch_last_name = split2[split2.length-1]\ndockerhub_repo = &quot;\\${params.dockerhub_repo}&quot;\nparameter = &quot;\\${params.parameter}&quot;\nrepo_url = &quot;仓库地址&quot;\nuse_cache = &quot;\\${params.use_cache}&quot;\ncache_version =&quot;\\${params.cache_version}&quot;\nis_cache_project = &quot;\\${params.is_cache_project}&quot;\n\ndef cache_arg = &quot;&quot;\n\nif (use_cache == \'false\') {\n    cache_arg = &quot;--no-cache&quot;\n}\n\nbuild_node = &quot;\\${params.build_node}&quot;\nbuild_node_ip = \'build机器地址\'\nclone_node = \'部署机器标签\'\n\nimport java.text.SimpleDateFormat;\ndef createVersion() {\n    def dateUnix = ((new Date().time + 22800000) / 1000).intValue()\n    Date dateObj =  new Date( ((long)dateUnix) * 1000 )\n    String ymd = new SimpleDateFormat(&quot;yyMMddHHmmss&quot;).format(dateObj)\n    return &quot;\\${ymd}&quot;\n}\nymd = createVersion()\nimage_version = &quot;1.0.9.\\${ymd}&quot;\n\nwork_dir = &quot;项目名称_\\${ymd}&quot;\nwork_cache_dir = &quot;项目名称_cache&quot;\n\nprintln(&quot;gitlab_repo branch=\\${gitlab_repo} \\${branch_name}&quot;)\nprintln(&quot;repo_name=\\${repo_name}, image_version=\\${image_version}&quot;)\nprintln(&quot;dockerhub_repo=\\${dockerhub_repo}&quot;)\nprintln(&quot;cache_arg=\\${cache_arg}&quot;)\nprintln(&quot;cache_version=\\${cache_version}&quot;)\n\nbuild_user=&quot;&quot;\nnode{\n    wrap([\\$class: \'BuildUser\']) {\n        build_user = env.BUILD_USER\n    }\n}\nprintln(&quot;build_user=\\${build_user}&quot;)\n\ndefault_description = &quot;@\\${build_user} \\${gitlab_repo} \\${branch_name}:\\${image_version}&quot;\ncurrentBuild.description = &quot;\\${default_description}&quot;\n\npipeline {\n    agent {\n        node {\n            label &quot;\\${build_node}&quot;\n        }\n    }\n\n    environment {\n        repo_name1 = &quot;\\${repo_name}&quot;\n        branch_last_name1 = &quot;\\${branch_last_name}&quot;\n    }\n\n    stages {\n      stage(\'Cache Workspace\') {\n        agent {\n            node {\n                label &quot;\\${build_node}&quot;\n            }\n        }\n         steps {\n            sh &quot;&quot;&quot;\n                cd /home/jenkins/workspace/apps/项目名称/\n                # rm -rf \\${work_cache_dir}\n                if [ \\${is_cache_project} = \'true\' ]\n                then\n                    if [ ! -d \\${work_cache_dir} ]\n                    then\n                        echo &quot;Cache Workspace not found&quot;\n                    else\n                        cp -r \\${work_cache_dir} \\${work_dir}\n                        cd \\${work_dir} && ls\n                        echo &quot;Cache Workspace restore successful&quot;\n                    fi\n                fi\n            &quot;&quot;&quot;\n        }\n      }\n\n      stage(\'Cache Repo\') {\n        agent {\n            node {\n                label &quot;\\${clone_node}&quot;\n            }\n        }\n         steps {\n            sh &quot;&quot;&quot;\n                # vi clone.sh\n                # rm -rf \\${work_cache_dir}\n                if [ \\${is_cache_project} = \'true\' ]\n                then\n                    if [ ! -d \\${work_cache_dir} ]\n                    then\n                        echo &quot;Cache Repo not found&quot;\n                    else\n                        cp -r \\${work_cache_dir} \\${work_dir}\n                        cd \\${work_dir} && ls\n                        echo &quot;Cache Repo restore successful&quot;\n                    fi\n                fi\n            &quot;&quot;&quot;\n        }\n      }\n\n      stage(&quot;Clone Repo&quot;){\n          agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            sh &quot;&quot;&quot;\n            # ls -la\n            if [ ! -d \\${work_dir} ]\n            then\n                cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n                bash clone.sh \\${gitlab_repo} \\${branch_name} \\${work_dir}\n            else\n                cd \\${work_dir}\n                # 1、为了让脚本检测，2、master 拉取最新\n                git checkout master\n                git pull origin master\n\n                if [ \\${branch_name} != \'master\' ]\n                then\n                    # 强制拉取远程代码到本地\n                    git fetch --force origin \\${branch_name}:\\${branch_name}\n                    git checkout origin/\\${branch_name}\n                fi\n                cd ..\n            fi\n            # ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py \\${work_dir} 机器人webhook\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(&quot;Scp to build_node&quot;) {\n         agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            echo &quot;Scp to \\${build_node}/\\${build_node_ip}&quot;\n            sh &quot;&quot;&quot;\n                # pwd\n                # 这里的 -c 选项比较重要，比较校验和\n                rsync -Lrzvc -R \\${work_dir}/前端目录名称/ jenkins@\\${build_node_ip}:/home/jenkins/workspace/apps/项目名称/\n                if [ \\\\$? -ne 0 ]\n                then\n                    echo &quot;Found some error when copy the repo&quot;\n                fi\n                # rm -fr \\${work_dir} || true\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(\'Build docker images\') {\n         agent {\n             node {\n                 label &quot;\\${build_node}&quot;\n             }\n         }\n         steps {\n             sh &quot;&quot;&quot;\n                if [ ! -f /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/Dockerfile-client-buildkit ]\n                then\n                    echo &quot;No available 前端目录名称/Dockerfile-client-buildkit in workspace&quot;\n                    exit 1\n                fi\n\n                cd /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build \\${cache_arg} --build-arg=BUILDKIT_CACHE_MOUNT_NS=\\${cache_version} -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/\\${dockerhub_repo}:\\${image_version}\n                # pwd\n                # ls\n            &quot;&quot;&quot;\n        }\n      }\n\n      stage(\'Post Cache Workspace\') {\n        agent {\n            node {\n                label &quot;\\${build_node}&quot;\n            }\n        }\n         steps {\n            sh &quot;&quot;&quot;\n                cd /home/jenkins/workspace/apps/项目名称/\n                if [ \\${is_cache_project} = \'true\' ]\n                then\n                    rm -rf \\${work_cache_dir}\n                    mv \\${work_dir} \\${work_cache_dir}\n                    echo \'Post Cache Workspace\'\n                else\n                    rm -rf \\${work_dir}\n                fi\n            &quot;&quot;&quot;\n        }\n      }\n\n      stage(\'Post Cache Repo\') {\n        agent {\n            node {\n                label &quot;\\${clone_node}&quot;\n            }\n        }\n         steps {\n            sh &quot;&quot;&quot;\n                if [ \\${is_cache_project} = \'true\' ]\n                then\n                    rm -rf \\${work_cache_dir}\n                    mv \\${work_dir} \\${work_cache_dir}\n                    echo \'Post Cache Repo successful\'\n                else\n                    rm -rf \\${work_dir}\n                fi\n            &quot;&quot;&quot;\n        }\n      }\n    }\n\n    post {\n        always {\n            echo \'I have finished\'\n        }\n        success {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n        failure {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n    }\n}`, `84908851427687090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="groovy{34-35,75-87,100-112,138-140,161-162,206-214,227-234}"\n              >\n                <span class="gatsby-code-button-language">groovy{34-35,75-87,100-112,138-140,161-162,206-214,227-234}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="groovy"><pre style="counter-reset: linenumber NaN" class="language-groovy line-numbers"><code class="language-groovy">gitlab_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>gitlab_repo<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split <span class="token operator">=</span> gitlab_repo<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> repo_name <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\nbranch_name <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>branch_name<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split2 <span class="token operator">=</span> branch_name<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> branch_last_name <span class="token operator">=</span> split2<span class="token punctuation">[</span>split2<span class="token operator">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\ndockerhub_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span>\nparameter <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>parameter<span class="token punctuation">}</span></span>"</span>\nrepo_url <span class="token operator">=</span> <span class="token string gstring">"仓库地址"</span>\nuse_cache <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>use_cache<span class="token punctuation">}</span></span>"</span>\ncache_version <span class="token operator">=</span><span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>cache_version<span class="token punctuation">}</span></span>"</span>\nis_cache_project <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>is_cache_project<span class="token punctuation">}</span></span>"</span>\n\n<span class="token keyword">def</span> cache_arg <span class="token operator">=</span> <span class="token string gstring">""</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>use_cache <span class="token operator">==</span> <span class="token string">\'false\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    cache_arg <span class="token operator">=</span> <span class="token string gstring">"--no-cache"</span>\n<span class="token punctuation">}</span>\n\nbuild_node <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>build_node<span class="token punctuation">}</span></span>"</span>\nbuild_node_ip <span class="token operator">=</span> <span class="token string">\'build机器地址\'</span>\nclone_node <span class="token operator">=</span> <span class="token string">\'部署机器标签\'</span>\n\n<span class="token keyword">import</span> java<span class="token operator">.</span>text<span class="token operator">.</span>SimpleDateFormat<span class="token punctuation">;</span>\n<span class="token keyword">def</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">def</span> dateUnix <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span>time <span class="token operator">+</span> <span class="token number">22800000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    Date dateObj <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>dateUnix<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>\n    String ymd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string gstring">"yyMMddHHmmss"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">format</span><span class="token punctuation">(</span>dateObj<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n<span class="token punctuation">}</span>\nymd <span class="token operator">=</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nimage_version <span class="token operator">=</span> <span class="token string gstring">"1.0.9.<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n\n<span class="gatsby-highlight-code-line">work_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称_<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span></span><span class="gatsby-highlight-code-line">work_cache_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称_cache"</span></span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"gitlab_repo branch=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"repo_name=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>, image_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"dockerhub_repo=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_arg=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\nbuild_user<span class="token operator">=</span><span class="token string gstring">""</span>\nnode<span class="token punctuation">{</span>\n    <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">\'BuildUser\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        build_user <span class="token operator">=</span> env<span class="token operator">.</span>BUILD_USER\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"build_user=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\ndefault_description <span class="token operator">=</span> <span class="token string gstring">"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span>\ncurrentBuild<span class="token operator">.</span>description <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>default_description<span class="token punctuation">}</span></span>"</span>\n\npipeline <span class="token punctuation">{</span>\n    agent <span class="token punctuation">{</span>\n        node <span class="token punctuation">{</span>\n            label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    environment <span class="token punctuation">{</span>\n        repo_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>"</span>\n        branch_last_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_last_name<span class="token punctuation">}</span></span>"</span>\n    <span class="token punctuation">}</span>\n\n    stages <span class="token punctuation">{</span>\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Cache Workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                cd /home/jenkins/workspace/apps/项目名称/</span><span class="gatsby-highlight-code-line">                # rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                then</span><span class="gatsby-highlight-code-line">                    if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> ]</span><span class="gatsby-highlight-code-line">                    then</span><span class="gatsby-highlight-code-line">                        echo "Cache Workspace not found"</span><span class="gatsby-highlight-code-line">                    else</span><span class="gatsby-highlight-code-line">                        cp -r <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                        cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> &amp;&amp; ls</span><span class="gatsby-highlight-code-line">                        echo "Cache Workspace restore successful"</span><span class="gatsby-highlight-code-line">                    fi</span><span class="gatsby-highlight-code-line">                fi</span>            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Cache Repo\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                # vi clone.sh</span><span class="gatsby-highlight-code-line">                # rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                then</span><span class="gatsby-highlight-code-line">                    if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> ]</span><span class="gatsby-highlight-code-line">                    then</span><span class="gatsby-highlight-code-line">                        echo "Cache Repo not found"</span><span class="gatsby-highlight-code-line">                    else</span><span class="gatsby-highlight-code-line">                        cp -r <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                        cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> &amp;&amp; ls</span><span class="gatsby-highlight-code-line">                        echo "Cache Repo restore successful"</span><span class="gatsby-highlight-code-line">                    fi</span><span class="gatsby-highlight-code-line">                fi</span>            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Clone Repo"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n          agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n            # ls -la\n            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> ]\n            then\n                cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n                bash clone.sh <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n            else\n                cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                # 1、为了让脚本检测，2、master 拉取最新\n                git checkout master\n                git pull origin master\n\n                if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> != \'master\' ]\n                then\n<span class="gatsby-highlight-code-line">                    # 强制拉取远程代码到本地</span><span class="gatsby-highlight-code-line">                    git fetch --force origin <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                    git checkout origin/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span></span>                fi\n                cd ..\n            fi\n            # ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> 机器人webhook\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Scp to build_node"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"Scp to <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>"</span>\n            sh <span class="token string gstring">"""\n                # pwd\n<span class="gatsby-highlight-code-line">                # 这里的 -c 选项比较重要，比较校验和</span><span class="gatsby-highlight-code-line">                rsync -Lrzvc -R <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/ jenkins@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>:/home/jenkins/workspace/apps/项目名称/</span>                if [ \\$? -ne 0 ]\n                then\n                    echo "Found some error when copy the repo"\n                fi\n                # rm -fr <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Build docker images\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n             sh <span class="token string gstring">"""\n                if [ ! -f /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/Dockerfile-client-buildkit ]\n                then\n                    echo "No available 前端目录名称/Dockerfile-client-buildkit in workspace"\n                    exit 1\n                fi\n\n                cd /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span> --build-arg=BUILDKIT_CACHE_MOUNT_NS=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span> -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>\n                # pwd\n                # ls\n            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Post Cache Workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                cd /home/jenkins/workspace/apps/项目名称/</span><span class="gatsby-highlight-code-line">                if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                then</span><span class="gatsby-highlight-code-line">                    rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                    mv <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                    echo \'Post Cache Workspace\'</span><span class="gatsby-highlight-code-line">                else</span><span class="gatsby-highlight-code-line">                    rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                fi</span>            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Post Cache Repo\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                then</span><span class="gatsby-highlight-code-line">                    rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                    mv <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                    echo \'Post Cache Repo successful\'</span><span class="gatsby-highlight-code-line">                else</span><span class="gatsby-highlight-code-line">                    rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                fi</span>            """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    post <span class="token punctuation">{</span>\n        always <span class="token punctuation">{</span>\n            echo <span class="token string">\'I have finished\'</span>\n        <span class="token punctuation">}</span>\n        success <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n        failure <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="版本三"><a href="#%E7%89%88%E6%9C%AC%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本三</h2>\n<ol>\n<li>缓存步骤并行执行</li>\n<li>对同一机器上的缓存操作时加锁，防止缓存失效</li>\n<li>因为运维那边对应的机器在同一时间执行时会在新的目录里面操作（会生成 <code class="language-text">@2</code>，<code class="language-text">＠3</code> 这样的目录），所以为了防止读不到缓存，需要在连接到机器时强制在同一目录里面操作</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67900896341673730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gitlab_repo = &quot;\\${params.gitlab_repo}&quot;\ndef split = gitlab_repo.split(&quot;/&quot;)\ndef repo_name = split[1]\nbranch_name = &quot;\\${params.branch_name}&quot;\ndef split2 = branch_name.split(&quot;/&quot;)\ndef branch_last_name = split2[split2.length-1]\ndockerhub_repo = &quot;\\${params.dockerhub_repo}&quot;\nparameter = &quot;\\${params.parameter}&quot;\nrepo_url = &quot;仓库地址&quot;\nuse_cache = &quot;\\${params.use_cache}&quot;\ncache_version =&quot;\\${params.cache_version}&quot;\nis_cache_project = &quot;\\${params.is_cache_project}&quot;\n\ndef cache_arg = &quot;&quot;\n\nif (use_cache == \'false\') {\n    cache_arg = &quot;--no-cache&quot;\n}\n\nbuild_node = &quot;\\${params.build_node}&quot;\nbuild_node_ip = \'build机器地址\'\nclone_node = \'部署机器标签\'\n\nimport java.text.SimpleDateFormat;\ndef createVersion() {\n    def dateUnix = ((new Date().time + 22800000) / 1000).intValue()\n    Date dateObj =  new Date( ((long)dateUnix) * 1000 )\n    String ymd = new SimpleDateFormat(&quot;yyMMddHHmmss&quot;).format(dateObj)\n    return &quot;\\${ymd}&quot;\n}\nymd = createVersion()\nimage_version = &quot;1.0.9.\\${ymd}&quot;\n\nwork_dir = &quot;项目名称_\\${ymd}&quot;\nwork_cache_dir = &quot;项目名称_cache&quot;\n\nprintln(&quot;gitlab_repo branch=\\${gitlab_repo} \\${branch_name}&quot;)\nprintln(&quot;repo_name=\\${repo_name}, image_version=\\${image_version}&quot;)\nprintln(&quot;dockerhub_repo=\\${dockerhub_repo}&quot;)\nprintln(&quot;cache_arg=\\${cache_arg}&quot;)\nprintln(&quot;cache_version=\\${cache_version}&quot;)\n\nbuild_user=&quot;&quot;\nnode{\n    wrap([\\$class: \'BuildUser\']) {\n        build_user = env.BUILD_USER\n    }\n}\nprintln(&quot;build_user=\\${build_user}&quot;)\n\ndefault_description = &quot;@\\${build_user} \\${gitlab_repo} \\${branch_name}:\\${image_version}&quot;\ncurrentBuild.description = &quot;\\${default_description}&quot;\n\npipeline {\n    agent {\n        node {\n            label &quot;\\${build_node}&quot;\n        }\n    }\n\n    environment {\n        repo_name1 = &quot;\\${repo_name}&quot;\n        branch_last_name1 = &quot;\\${branch_last_name}&quot;\n    }\n\n    stages {\n      stage (\'Cache\') {\n         failFast true\n         parallel {\n            stage(\'Cache Workspace\') {\n                agent {\n                    node {\n                        label &quot;\\${build_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-workspace&quot;) {\n                    sh &quot;&quot;&quot;\n                        cd /home/jenkins/workspace/apps/项目名称/\n                        # rm -rf \\${work_cache_dir}\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            if [ ! -d \\${work_cache_dir} ]\n                            then\n                                echo &quot;Cache Workspace not found&quot;\n                            else\n                                cp -r \\${work_cache_dir} \\${work_dir}\n                                cd \\${work_dir} && ls\n                                echo &quot;Cache Workspace restore successful&quot;\n                            fi\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n\n            stage(\'Cache Repo\') {\n                agent {\n                    node {\n                        label &quot;\\${clone_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-repo&quot;) {\n                    sh &quot;&quot;&quot;\n                        # vi clone.sh\n                        # 这里每次都要 cd 到具体路径，否则同一时间内执行默认会跑到别的目录下，比如 项目名称@2、项目名称@3 这种目录\n                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                        # rm -rf \\${work_cache_dir}\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            if [ ! -d \\${work_cache_dir} ]\n                            then\n                                echo &quot;Cache Repo not found&quot;\n                            else\n                                cp -r \\${work_cache_dir} \\${work_dir}\n                                cd \\${work_dir} && ls\n                                echo &quot;Cache Repo restore successful&quot;\n                            fi\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n         }\n      }\n\n      stage(&quot;Clone Repo&quot;){\n         agent {\n            node {\n                label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n            }\n         }\n         steps {\n            sh &quot;&quot;&quot;\n            # ls -la\n            cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n            if [ ! -d \\${work_dir} ]\n            then\n                cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n                bash clone.sh \\${gitlab_repo} \\${branch_name} \\${work_dir}\n            else\n                cd \\${work_dir}\n                # 1、为了让脚本检测，2、master 拉取最新\n                git checkout master\n                git pull origin master\n\n                if [ \\${branch_name} != \'master\' ]\n                then\n                    # 强制拉取远程代码到本地\n                    git fetch --force origin \\${branch_name}:\\${branch_name}\n                    git checkout origin/\\${branch_name}\n                fi\n                cd ..\n            fi\n            # ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py \\${work_dir} 机器人webhook\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(&quot;Scp to build_node&quot;) {\n         agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            echo &quot;Scp to \\${build_node}/\\${build_node_ip}&quot;\n            sh &quot;&quot;&quot;\n                cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                # pwd\n                # 这里的 -c 选项比较重要，比较校验和\n                rsync -Lrzvc -R \\${work_dir}/前端目录名称/ jenkins@\\${build_node_ip}:/home/jenkins/workspace/apps/项目名称/\n                if [ \\\\$? -ne 0 ]\n                then\n                    echo &quot;Found some error when copy the repo&quot;\n                fi\n                # rm -fr \\${work_dir} || true\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(\'Build docker images\') {\n         agent {\n             node {\n                 label &quot;\\${build_node}&quot;\n             }\n         }\n         steps {\n            sh &quot;&quot;&quot;\n                cd /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/\n                if [ ! -f Dockerfile-client-buildkit ]\n                then\n                    echo &quot;No available 前端目录名称/Dockerfile-client-buildkit in workspace&quot;\n                    exit 1\n                fi\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build \\${cache_arg} --build-arg=BUILDKIT_CACHE_MOUNT_NS=\\${cache_version} -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/\\${dockerhub_repo}:\\${image_version}\n                # pwd\n                # ls\n             &quot;&quot;&quot;\n        }\n      }\n\n      stage (\'Post Cache\') {\n         failFast true\n         parallel {\n            stage(\'Post Cache Workspace\') {\n                agent {\n                    node {\n                        label &quot;\\${build_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-workspace&quot;) {\n                    sh &quot;&quot;&quot;\n                        cd /home/jenkins/workspace/apps/项目名称/\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            rm -rf \\${work_cache_dir}\n                            mv \\${work_dir} \\${work_cache_dir}\n                            echo \'Post Cache Workspace\'\n                        else\n                            rm -rf \\${work_dir}\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n\n            stage(\'Post Cache Repo\') {\n                agent {\n                    node {\n                        label &quot;\\${clone_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-repo&quot;) {\n                    sh &quot;&quot;&quot;\n                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            # 加锁的原因: 1.否则 cp 读缓存时没有缓存\n                            rm -rf \\${work_cache_dir}\n                            # 这里存在竞争，后编译成功的重命名才有效，即使后编译的缓存也不太影响具体的增量更新逻辑\n                            # 加锁的原因: 2.同时如果有另一个 job 在 mv 时，这里会移动到 work_cache_dir 目录下，而不是重命名\n                            mv \\${work_dir} \\${work_cache_dir}\n                            echo \'Post Cache Repo successful\'\n                        else\n                            rm -rf \\${work_dir}\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n         }\n      }\n    }\n\n    post {\n        always {\n            echo \'I have finished\'\n        }\n        success {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n        failure {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n    }\n}`, `67900896341673730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="groovy{67-77,79-91,97-104,106-120,137,172,193-194,222-230,245-256}"\n              >\n                <span class="gatsby-code-button-language">groovy{67-77,79-91,97-104,106-120,137,172,193-194,222-230,245-256}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="groovy"><pre style="counter-reset: linenumber NaN" class="language-groovy line-numbers"><code class="language-groovy">gitlab_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>gitlab_repo<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split <span class="token operator">=</span> gitlab_repo<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> repo_name <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\nbranch_name <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>branch_name<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split2 <span class="token operator">=</span> branch_name<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> branch_last_name <span class="token operator">=</span> split2<span class="token punctuation">[</span>split2<span class="token operator">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\ndockerhub_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span>\nparameter <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>parameter<span class="token punctuation">}</span></span>"</span>\nrepo_url <span class="token operator">=</span> <span class="token string gstring">"仓库地址"</span>\nuse_cache <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>use_cache<span class="token punctuation">}</span></span>"</span>\ncache_version <span class="token operator">=</span><span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>cache_version<span class="token punctuation">}</span></span>"</span>\nis_cache_project <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>is_cache_project<span class="token punctuation">}</span></span>"</span>\n\n<span class="token keyword">def</span> cache_arg <span class="token operator">=</span> <span class="token string gstring">""</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>use_cache <span class="token operator">==</span> <span class="token string">\'false\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    cache_arg <span class="token operator">=</span> <span class="token string gstring">"--no-cache"</span>\n<span class="token punctuation">}</span>\n\nbuild_node <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>build_node<span class="token punctuation">}</span></span>"</span>\nbuild_node_ip <span class="token operator">=</span> <span class="token string">\'build机器地址\'</span>\nclone_node <span class="token operator">=</span> <span class="token string">\'部署机器标签\'</span>\n\n<span class="token keyword">import</span> java<span class="token operator">.</span>text<span class="token operator">.</span>SimpleDateFormat<span class="token punctuation">;</span>\n<span class="token keyword">def</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">def</span> dateUnix <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span>time <span class="token operator">+</span> <span class="token number">22800000</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    Date dateObj <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>dateUnix<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token punctuation">)</span>\n    String ymd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string gstring">"yyMMddHHmmss"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">format</span><span class="token punctuation">(</span>dateObj<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n<span class="token punctuation">}</span>\nymd <span class="token operator">=</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nimage_version <span class="token operator">=</span> <span class="token string gstring">"1.0.9.<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n\nwork_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称_<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\nwork_cache_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称_cache"</span>\n\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"gitlab_repo branch=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"repo_name=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>, image_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"dockerhub_repo=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_arg=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\nbuild_user<span class="token operator">=</span><span class="token string gstring">""</span>\nnode<span class="token punctuation">{</span>\n    <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">\'BuildUser\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        build_user <span class="token operator">=</span> env<span class="token operator">.</span>BUILD_USER\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"build_user=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\ndefault_description <span class="token operator">=</span> <span class="token string gstring">"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span>\ncurrentBuild<span class="token operator">.</span>description <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>default_description<span class="token punctuation">}</span></span>"</span>\n\npipeline <span class="token punctuation">{</span>\n    agent <span class="token punctuation">{</span>\n        node <span class="token punctuation">{</span>\n            label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    environment <span class="token punctuation">{</span>\n        repo_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>"</span>\n        branch_last_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_last_name<span class="token punctuation">}</span></span>"</span>\n    <span class="token punctuation">}</span>\n\n    stages <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">      stage <span class="token punctuation">(</span><span class="token string">\'Cache\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">         failFast <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">         parallel <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Cache Workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                agent <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                    node <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span></span><span class="gatsby-highlight-code-line">                    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">                <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">                steps <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-workspace"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>                    sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                        cd /home/jenkins/workspace/apps/项目名称/</span><span class="gatsby-highlight-code-line">                        # rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                        then</span><span class="gatsby-highlight-code-line">                            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> ]</span><span class="gatsby-highlight-code-line">                            then</span><span class="gatsby-highlight-code-line">                                echo "Cache Workspace not found"</span><span class="gatsby-highlight-code-line">                            else</span><span class="gatsby-highlight-code-line">                                cp -r <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                                cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> &amp;&amp; ls</span><span class="gatsby-highlight-code-line">                                echo "Cache Workspace restore successful"</span><span class="gatsby-highlight-code-line">                            fi</span><span class="gatsby-highlight-code-line">                        fi</span>                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n\n<span class="gatsby-highlight-code-line">            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Cache Repo\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                agent <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                    node <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span></span><span class="gatsby-highlight-code-line">                    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">                <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">                steps <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-repo"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>                    sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                        # vi clone.sh</span><span class="gatsby-highlight-code-line">                        # 这里每次都要 cd 到具体路径，否则同一时间内执行默认会跑到别的目录下，比如 项目名称@2、项目名称@3 这种目录</span><span class="gatsby-highlight-code-line">                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称</span><span class="gatsby-highlight-code-line">                        # rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                        then</span><span class="gatsby-highlight-code-line">                            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> ]</span><span class="gatsby-highlight-code-line">                            then</span><span class="gatsby-highlight-code-line">                                echo "Cache Repo not found"</span><span class="gatsby-highlight-code-line">                            else</span><span class="gatsby-highlight-code-line">                                cp -r <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                                cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> &amp;&amp; ls</span><span class="gatsby-highlight-code-line">                                echo "Cache Repo restore successful"</span><span class="gatsby-highlight-code-line">                            fi</span><span class="gatsby-highlight-code-line">                        fi</span>                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Clone Repo"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n            # ls -la\n<span class="gatsby-highlight-code-line">            cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称</span>            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> ]\n            then\n                cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n                bash clone.sh <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n            else\n                cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                # 1、为了让脚本检测，2、master 拉取最新\n                git checkout master\n                git pull origin master\n\n                if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> != \'master\' ]\n                then\n                    # 强制拉取远程代码到本地\n                    git fetch --force origin <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>\n                    git checkout origin/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>\n                fi\n                cd ..\n            fi\n            # ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> 机器人webhook\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Scp to build_node"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"Scp to <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>"</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称</span>                # pwd\n                # 这里的 -c 选项比较重要，比较校验和\n                rsync -Lrzvc -R <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/ jenkins@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>:/home/jenkins/workspace/apps/项目名称/\n                if [ \\$? -ne 0 ]\n                then\n                    echo "Found some error when copy the repo"\n                fi\n                # rm -fr <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Build docker images\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                cd /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/</span><span class="gatsby-highlight-code-line">                if [ ! -f Dockerfile-client-buildkit ]</span>                then\n                    echo "No available 前端目录名称/Dockerfile-client-buildkit in workspace"\n                    exit 1\n                fi\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span> --build-arg=BUILDKIT_CACHE_MOUNT_NS=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span> -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>\n                # pwd\n                # ls\n             """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      stage <span class="token punctuation">(</span><span class="token string">\'Post Cache\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         failFast <span class="token boolean">true</span>\n         parallel <span class="token punctuation">{</span>\n            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Post Cache Workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                agent <span class="token punctuation">{</span>\n                    node <span class="token punctuation">{</span>\n                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n                steps <span class="token punctuation">{</span>\n                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-workspace"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                        cd /home/jenkins/workspace/apps/项目名称/</span><span class="gatsby-highlight-code-line">                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                        then</span><span class="gatsby-highlight-code-line">                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                            mv <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                            echo \'Post Cache Workspace\'</span><span class="gatsby-highlight-code-line">                        else</span><span class="gatsby-highlight-code-line">                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                        fi</span>                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Post Cache Repo\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                agent <span class="token punctuation">{</span>\n                    node <span class="token punctuation">{</span>\n                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n                steps <span class="token punctuation">{</span>\n                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-repo"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    sh <span class="token string gstring">"""\n<span class="gatsby-highlight-code-line">                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称</span><span class="gatsby-highlight-code-line">                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]</span><span class="gatsby-highlight-code-line">                        then</span><span class="gatsby-highlight-code-line">                            # 加锁的原因: 1.否则 cp 读缓存时没有缓存</span><span class="gatsby-highlight-code-line">                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                            # 这里存在竞争，后编译成功的重命名才有效，即使后编译的缓存也不太影响具体的增量更新逻辑</span><span class="gatsby-highlight-code-line">                            # 加锁的原因: 2.同时如果有另一个 job 在 mv 时，这里会移动到 work_cache_dir 目录下，而不是重命名</span><span class="gatsby-highlight-code-line">                            mv <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                            echo \'Post Cache Repo successful\'</span><span class="gatsby-highlight-code-line">                        else</span><span class="gatsby-highlight-code-line">                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">                        fi</span>                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    post <span class="token punctuation">{</span>\n        always <span class="token punctuation">{</span>\n            echo <span class="token string">\'I have finished\'</span>\n        <span class="token punctuation">}</span>\n        success <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n        failure <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="版本四"><a href="#%E7%89%88%E6%9C%AC%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本四</h2>\n<ol>\n<li>生成时间戳优化：因为现有的时间戳是精确到秒的，还是有产生冲突的概率，改成毫秒（更好的方式是生成唯一性的 id）</li>\n<li>修复增量缓存同步策略：由于增量缓存（对远程端的文件不做删除）的问题，比如在同一目录下有 test.js，<code class="language-text">test/index.js</code> 文件，此时引入代码为 <code class="language-text">import &#39;./test&#39;</code>，由于 webpack 有类似 <a href="https://juejin.cn/post/7221551421833314360" target="_blank" rel="nofollow noreferrer noopener">nodejs 路径解析优先级</a> 的问题，此时实际引入的代码为 test.js，但实际上是想用 <code class="language-text">test/index.js</code> 文件，需要修改 rsync 的同步策略</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17701392195702170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gitlab_repo = &quot;\\${params.gitlab_repo}&quot;\ndef split = gitlab_repo.split(&quot;/&quot;)\ndef repo_name = split[1]\nbranch_name = &quot;\\${params.branch_name}&quot;\ndef split2 = branch_name.split(&quot;/&quot;)\ndef branch_last_name = split2[split2.length-1]\ndockerhub_repo = &quot;\\${params.dockerhub_repo}&quot;\nparameter = &quot;\\${params.parameter}&quot;\nrepo_url = &quot;仓库地址&quot;\nuse_cache = &quot;\\${params.use_cache}&quot;\ncache_version =&quot;\\${params.cache_version}&quot;\nis_cache_project = &quot;\\${params.is_cache_project}&quot;\n\ndef cache_arg = &quot;&quot;\n\nif (use_cache == \'false\') {\n    cache_arg = &quot;--no-cache&quot;\n}\n\nbuild_node = &quot;\\${params.build_node}&quot;\nbuild_node_ip = \'build机器地址\'\nclone_node = \'部署机器标签\'\n\ndef createVersion() {\n   long ymd = System.currentTimeMillis()\n   return &quot;\\${ymd}&quot;\n}\nymd = createVersion()\nimage_version = &quot;1.0.9.\\${ymd}&quot;\n\nwork_dir = &quot;项目名称_\\${ymd}&quot;\nwork_cache_dir = &quot;项目名称_cache&quot;\n\nprintln(&quot;gitlab_repo branch=\\${gitlab_repo} \\${branch_name}&quot;)\nprintln(&quot;repo_name=\\${repo_name}, image_version=\\${image_version}&quot;)\nprintln(&quot;dockerhub_repo=\\${dockerhub_repo}&quot;)\nprintln(&quot;cache_arg=\\${cache_arg}&quot;)\nprintln(&quot;cache_version=\\${cache_version}&quot;)\n\nbuild_user=&quot;&quot;\nnode{\n    wrap([\\$class: \'BuildUser\']) {\n        build_user = env.BUILD_USER\n    }\n}\nprintln(&quot;build_user=\\${build_user}&quot;)\n\ndefault_description = &quot;@\\${build_user} \\${gitlab_repo} \\${branch_name}:\\${image_version}&quot;\ncurrentBuild.description = &quot;\\${default_description}&quot;\n\npipeline {\n    agent {\n        node {\n            label &quot;\\${build_node}&quot;\n        }\n    }\n\n    environment {\n        repo_name1 = &quot;\\${repo_name}&quot;\n        branch_last_name1 = &quot;\\${branch_last_name}&quot;\n    }\n\n    stages {\n      stage (\'Cache\') {\n         failFast true\n         parallel {\n            stage(\'Cache Workspace\') {\n                agent {\n                    node {\n                        label &quot;\\${build_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-workspace&quot;) {\n                    sh &quot;&quot;&quot;\n                        cd /home/jenkins/workspace/apps/项目名称/\n                        # rm -rf \\${work_cache_dir}\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            if [ ! -d \\${work_cache_dir} ]\n                            then\n                                echo &quot;Cache Workspace not found&quot;\n                            else\n                                cp -r \\${work_cache_dir} \\${work_dir}\n                                cd \\${work_dir} && ls\n                                echo &quot;Cache Workspace restore successful&quot;\n                            fi\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n\n            stage(\'Cache Repo\') {\n                agent {\n                    node {\n                        label &quot;\\${clone_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-repo&quot;) {\n                    sh &quot;&quot;&quot;\n                        # vi clone.sh\n                        # 这里每次都要 cd 到具体路径，否则同一时间内执行默认会跑到别的目录下，比如 项目名称@2、项目名称@3 这种目录\n                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                        # rm -rf \\${work_cache_dir}\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            if [ ! -d \\${work_cache_dir} ]\n                            then\n                                echo &quot;Cache Repo not found&quot;\n                            else\n                                cp -r \\${work_cache_dir} \\${work_dir}\n                                cd \\${work_dir} && ls\n                                echo &quot;Cache Repo restore successful&quot;\n                            fi\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n         }\n      }\n\n      stage(&quot;Clone Repo&quot;){\n         agent {\n            node {\n                label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n            }\n         }\n         steps {\n            sh &quot;&quot;&quot;\n            # ls -la\n            cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n            if [ ! -d \\${work_dir} ]\n            then\n                cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n                bash clone.sh \\${gitlab_repo} \\${branch_name} \\${work_dir}\n            else\n                cd \\${work_dir}\n                # 1、为了让脚本检测，2、master 拉取最新\n                git checkout master\n                git pull origin master\n\n                if [ \\${branch_name} != \'master\' ]\n                then\n                    # 强制拉取远程代码到本地\n                    git fetch --force origin \\${branch_name}:\\${branch_name}\n                    git checkout origin/\\${branch_name}\n                fi\n                cd ..\n            fi\n            # ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py \\${work_dir} 机器人webhook\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(&quot;Scp to build_node&quot;) {\n         agent {\n             node {\n                 label &quot;\\${clone_node}&quot; //\'部署机器标签\'\n             }\n         }\n         steps {\n            echo &quot;Scp to \\${build_node}/\\${build_node_ip}&quot;\n            sh &quot;&quot;&quot;\n                cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                # pwd\n                # 这里的 -c 选项比较重要，比较校验和\n                rsync -Lrzvc --delete -R \\${work_dir}/前端目录名称/ jenkins@\\${build_node_ip}:/home/jenkins/workspace/apps/项目名称/\n                if [ \\\\$? -ne 0 ]\n                then\n                    echo &quot;Found some error when copy the repo&quot;\n                fi\n                # rm -fr \\${work_dir} || true\n            &quot;&quot;&quot;\n         }\n      }\n\n      stage(\'Build docker images\') {\n         agent {\n             node {\n                 label &quot;\\${build_node}&quot;\n             }\n         }\n         steps {\n            sh &quot;&quot;&quot;\n                cd /home/jenkins/workspace/apps/项目名称/\\${work_dir}/前端目录名称/\n                if [ ! -f Dockerfile-client-buildkit ]\n                then\n                    echo &quot;No available 前端目录名称/Dockerfile-client-buildkit in workspace&quot;\n                    exit 1\n                fi\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build \\${cache_arg} --build-arg=BUILDKIT_CACHE_MOUNT_NS=\\${cache_version} -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/\\${dockerhub_repo}:\\${image_version} -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/\\${dockerhub_repo}:\\${image_version}\n                # pwd\n                # ls\n             &quot;&quot;&quot;\n        }\n      }\n\n      stage (\'Post Cache\') {\n         failFast true\n         parallel {\n            stage(\'Post Cache Workspace\') {\n                agent {\n                    node {\n                        label &quot;\\${build_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-workspace&quot;) {\n                    sh &quot;&quot;&quot;\n                        cd /home/jenkins/workspace/apps/项目名称/\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            rm -rf \\${work_cache_dir}\n                            mv \\${work_dir} \\${work_cache_dir}\n                            echo \'Post Cache Workspace\'\n                        else\n                            rm -rf \\${work_dir}\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n\n            stage(\'Post Cache Repo\') {\n                agent {\n                    node {\n                        label &quot;\\${clone_node}&quot;\n                    }\n                }\n                steps {\n                    lock(&quot;lock-cache-repo&quot;) {\n                    sh &quot;&quot;&quot;\n                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                        if [ \\${is_cache_project} = \'true\' ]\n                        then\n                            # 加锁的原因: 1.否则 cp 读缓存时没有缓存\n                            rm -rf \\${work_cache_dir}\n                            # 这里存在竞争，后编译成功的重命名才有效，即使后编译的缓存也不太影响具体的增量更新逻辑\n                            # 加锁的原因: 2.同时如果有另一个 job 在 mv 时，这里会移动到 work_cache_dir 目录下，而不是重命名\n                            mv \\${work_dir} \\${work_cache_dir}\n                            echo \'Post Cache Repo successful\'\n                        else\n                            rm -rf \\${work_dir}\n                        fi\n                    &quot;&quot;&quot;\n                    }\n                }\n            }\n         }\n      }\n    }\n\n    post {\n        always {\n            echo \'I have finished\'\n        }\n        success {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, succeed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n        failure {\n            echo &quot;build \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;\n            sh &quot;&quot;&quot;\n            curl -X POST -H &quot;Content-Type: application/json&quot; -d \'{&quot;msg_type&quot;:&quot;text&quot;,&quot;content&quot;:{&quot;text&quot;:&quot;@\\${build_user} 项目名称 notify: \\${gitlab_repo} \\${branch_name}:\\${image_version}, failed!&quot;}}\' 机器人webhook\n            &quot;&quot;&quot;\n        }\n    }\n}`, `17701392195702170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="groovy{25-26,172}"\n              >\n                <span class="gatsby-code-button-language">groovy{25-26,172}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="groovy"><pre style="counter-reset: linenumber NaN" class="language-groovy line-numbers"><code class="language-groovy">gitlab_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>gitlab_repo<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split <span class="token operator">=</span> gitlab_repo<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> repo_name <span class="token operator">=</span> split<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>\nbranch_name <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>branch_name<span class="token punctuation">}</span></span>"</span>\n<span class="token keyword">def</span> split2 <span class="token operator">=</span> branch_name<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">"/"</span><span class="token punctuation">)</span>\n<span class="token keyword">def</span> branch_last_name <span class="token operator">=</span> split2<span class="token punctuation">[</span>split2<span class="token operator">.</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>\ndockerhub_repo <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span>\nparameter <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>parameter<span class="token punctuation">}</span></span>"</span>\nrepo_url <span class="token operator">=</span> <span class="token string gstring">"仓库地址"</span>\nuse_cache <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>use_cache<span class="token punctuation">}</span></span>"</span>\ncache_version <span class="token operator">=</span><span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>cache_version<span class="token punctuation">}</span></span>"</span>\nis_cache_project <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>is_cache_project<span class="token punctuation">}</span></span>"</span>\n\n<span class="token keyword">def</span> cache_arg <span class="token operator">=</span> <span class="token string gstring">""</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>use_cache <span class="token operator">==</span> <span class="token string">\'false\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    cache_arg <span class="token operator">=</span> <span class="token string gstring">"--no-cache"</span>\n<span class="token punctuation">}</span>\n\nbuild_node <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>params<span class="token operator">.</span>build_node<span class="token punctuation">}</span></span>"</span>\nbuild_node_ip <span class="token operator">=</span> <span class="token string">\'build机器地址\'</span>\nclone_node <span class="token operator">=</span> <span class="token string">\'部署机器标签\'</span>\n\n<span class="token keyword">def</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">   <span class="token keyword">long</span> ymd <span class="token operator">=</span> System<span class="token operator">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">   <span class="token keyword">return</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span></span><span class="token punctuation">}</span>\nymd <span class="token operator">=</span> <span class="token function">createVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\nimage_version <span class="token operator">=</span> <span class="token string gstring">"1.0.9.<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\n\nwork_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称_<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ymd<span class="token punctuation">}</span></span>"</span>\nwork_cache_dir <span class="token operator">=</span> <span class="token string gstring">"项目名称_cache"</span>\n\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"gitlab_repo branch=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"repo_name=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>, image_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"dockerhub_repo=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_arg=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"cache_version=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\nbuild_user<span class="token operator">=</span><span class="token string gstring">""</span>\nnode<span class="token punctuation">{</span>\n    <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">\'BuildUser\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        build_user <span class="token operator">=</span> env<span class="token operator">.</span>BUILD_USER\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">println</span><span class="token punctuation">(</span><span class="token string gstring">"build_user=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span>"</span><span class="token punctuation">)</span>\n\ndefault_description <span class="token operator">=</span> <span class="token string gstring">"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>"</span>\ncurrentBuild<span class="token operator">.</span>description <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>default_description<span class="token punctuation">}</span></span>"</span>\n\npipeline <span class="token punctuation">{</span>\n    agent <span class="token punctuation">{</span>\n        node <span class="token punctuation">{</span>\n            label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    environment <span class="token punctuation">{</span>\n        repo_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>repo_name<span class="token punctuation">}</span></span>"</span>\n        branch_last_name1 <span class="token operator">=</span> <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_last_name<span class="token punctuation">}</span></span>"</span>\n    <span class="token punctuation">}</span>\n\n    stages <span class="token punctuation">{</span>\n      stage <span class="token punctuation">(</span><span class="token string">\'Cache\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         failFast <span class="token boolean">true</span>\n         parallel <span class="token punctuation">{</span>\n            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Cache Workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                agent <span class="token punctuation">{</span>\n                    node <span class="token punctuation">{</span>\n                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n                steps <span class="token punctuation">{</span>\n                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-workspace"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    sh <span class="token string gstring">"""\n                        cd /home/jenkins/workspace/apps/项目名称/\n                        # rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span>\n                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]\n                        then\n                            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> ]\n                            then\n                                echo "Cache Workspace not found"\n                            else\n                                cp -r <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                                cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> &amp;&amp; ls\n                                echo "Cache Workspace restore successful"\n                            fi\n                        fi\n                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Cache Repo\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                agent <span class="token punctuation">{</span>\n                    node <span class="token punctuation">{</span>\n                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n                steps <span class="token punctuation">{</span>\n                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-repo"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    sh <span class="token string gstring">"""\n                        # vi clone.sh\n                        # 这里每次都要 cd 到具体路径，否则同一时间内执行默认会跑到别的目录下，比如 项目名称@2、项目名称@3 这种目录\n                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                        # rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span>\n                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]\n                        then\n                            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> ]\n                            then\n                                echo "Cache Repo not found"\n                            else\n                                cp -r <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                                cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> &amp;&amp; ls\n                                echo "Cache Repo restore successful"\n                            fi\n                        fi\n                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Clone Repo"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n            node <span class="token punctuation">{</span>\n                label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n            # ls -la\n            cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n            if [ ! -d <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> ]\n            then\n                cp /data/xmotors_ai_shared/sre/saved_repo/clone.sh .\n                bash clone.sh <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n            else\n                cd <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                # 1、为了让脚本检测，2、master 拉取最新\n                git checkout master\n                git pull origin master\n\n                if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span> != \'master\' ]\n                then\n                    # 强制拉取远程代码到本地\n                    git fetch --force origin <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>\n                    git checkout origin/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>\n                fi\n                cd ..\n            fi\n            # ls -la\n            cp /data/xmotors_ai_shared/sre/saved_repo/judge_has_master_commit.py ./\n            /usr/bin/python3 judge_has_master_commit.py <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> 机器人webhook\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">"Scp to build_node"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span> <span class="token comment">//\'部署机器标签\'</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"Scp to <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>"</span>\n            sh <span class="token string gstring">"""\n                cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                # pwd\n                # 这里的 -c 选项比较重要，比较校验和\n<span class="gatsby-highlight-code-line">                rsync -Lrzvc --delete -R <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/ jenkins@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node_ip<span class="token punctuation">}</span></span>:/home/jenkins/workspace/apps/项目名称/</span>                if [ \\$? -ne 0 ]\n                then\n                    echo "Found some error when copy the repo"\n                fi\n                # rm -fr <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> || true\n            """</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Build docker images\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         agent <span class="token punctuation">{</span>\n             node <span class="token punctuation">{</span>\n                 label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n             <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n         steps <span class="token punctuation">{</span>\n            sh <span class="token string gstring">"""\n                cd /home/jenkins/workspace/apps/项目名称/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>/前端目录名称/\n                if [ ! -f Dockerfile-client-buildkit ]\n                then\n                    echo "No available 前端目录名称/Dockerfile-client-buildkit in workspace"\n                    exit 1\n                fi\n                # docker info\n                # docker -v\n                DOCKER_BUILDKIT=1 docker build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_arg<span class="token punctuation">}</span></span> --build-arg=BUILDKIT_CACHE_MOUNT_NS=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>cache_version<span class="token punctuation">}</span></span> -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                # docker build -t docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span> -f ./Dockerfile-client-buildkit .\n                docker push docker远程仓库地址/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>dockerhub_repo<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>\n                # pwd\n                # ls\n             """</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      stage <span class="token punctuation">(</span><span class="token string">\'Post Cache\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         failFast <span class="token boolean">true</span>\n         parallel <span class="token punctuation">{</span>\n            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Post Cache Workspace\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                agent <span class="token punctuation">{</span>\n                    node <span class="token punctuation">{</span>\n                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_node<span class="token punctuation">}</span></span>"</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n                steps <span class="token punctuation">{</span>\n                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-workspace"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    sh <span class="token string gstring">"""\n                        cd /home/jenkins/workspace/apps/项目名称/\n                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]\n                        then\n                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span>\n                            mv <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span>\n                            echo \'Post Cache Workspace\'\n                        else\n                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                        fi\n                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">\'Post Cache Repo\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                agent <span class="token punctuation">{</span>\n                    node <span class="token punctuation">{</span>\n                        label <span class="token string gstring">"<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>clone_node<span class="token punctuation">}</span></span>"</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n                steps <span class="token punctuation">{</span>\n                    <span class="token function">lock</span><span class="token punctuation">(</span><span class="token string gstring">"lock-cache-repo"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    sh <span class="token string gstring">"""\n                        cd /data/xmotors_ai_shared/sre/sre-workspace/workspace/项目名称\n                        if [ <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>is_cache_project<span class="token punctuation">}</span></span> = \'true\' ]\n                        then\n                            # 加锁的原因: 1.否则 cp 读缓存时没有缓存\n                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span>\n                            # 这里存在竞争，后编译成功的重命名才有效，即使后编译的缓存也不太影响具体的增量更新逻辑\n                            # 加锁的原因: 2.同时如果有另一个 job 在 mv 时，这里会移动到 work_cache_dir 目录下，而不是重命名\n                            mv <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_cache_dir<span class="token punctuation">}</span></span>\n                            echo \'Post Cache Repo successful\'\n                        else\n                            rm -rf <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>work_dir<span class="token punctuation">}</span></span>\n                        fi\n                    """</span>\n                    <span class="token punctuation">}</span>\n                <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    post <span class="token punctuation">{</span>\n        always <span class="token punctuation">{</span>\n            echo <span class="token string">\'I have finished\'</span>\n        <span class="token punctuation">}</span>\n        success <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, succeed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n        failure <span class="token punctuation">{</span>\n            echo <span class="token string gstring">"build <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"</span>\n            sh <span class="token string gstring">"""\n            curl -X POST -H "Content-Type: application/json" -d \'{"msg_type":"text","content":{"text":"@<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>build_user<span class="token punctuation">}</span></span> 项目名称 notify: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>gitlab_repo<span class="token punctuation">}</span></span> <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>branch_name<span class="token punctuation">}</span></span>:<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>image_version<span class="token punctuation">}</span></span>, failed!"}}\' 机器人webhook\n            """</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="优化效果"><a href="#%E4%BC%98%E5%8C%96%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化效果</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-02-10-12-22-15-7ac385ba83d6c0aba9a041dbf457d491-a9fd5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 32.10937499999999%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABT0lEQVQY0y2QS2+kMBCE+f8/J6e9r7Ta256SzM7wNBAG/MDYxsBgXGlQDqXurk9dajsZuDycs8e+7yDFEAJpx7ZtsJOFMxZGG+oN/OyhhIIeJ0yk09ejhlYao1TkaSTaOBjr4JyLflmgKUBwgUEJFEOFVneoeI1KNviaelSiRsEbZD0jzog/URJnssWX7pEIpf4UTf+PArGua+RKx9UvcIdH6hnY3iGdGfK1QXMMVy2WBvmPqtfJq8tvD46kl/y3kuKvtYae+YpPLqOi84VTeJd3PEyJd3HHp0qROYbPMaU+u+ZT9+mHjxlyVyMZpPjFOX+b5znuIaAbRDz/QnmND1pOXYUPWrzpHIVvcJtyZHTx6d90hoclLh/4T37pWyR5XW5lUSzGmBiOA8q4GPYAFzzyuUa9PZFZdoW1Ybhqsw+oXz2KuQHbuouXS4suCHwDg7DBGXPoU5EAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 02 10 12 22 15" title="" data-src="/static/2023-02-10-12-22-15-7ac385ba83d6c0aba9a041dbf457d491-fee1c.png" data-srcset="/static/2023-02-10-12-22-15-7ac385ba83d6c0aba9a041dbf457d491-a67b7.png 200w,\n/static/2023-02-10-12-22-15-7ac385ba83d6c0aba9a041dbf457d491-0b187.png 400w,\n/static/2023-02-10-12-22-15-7ac385ba83d6c0aba9a041dbf457d491-fee1c.png 800w,\n/static/2023-02-10-12-22-15-7ac385ba83d6c0aba9a041dbf457d491-b1a91.png 1200w,\n/static/2023-02-10-12-22-15-7ac385ba83d6c0aba9a041dbf457d491-a9fd5.png 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="后期展望"><a href="#%E5%90%8E%E6%9C%9F%E5%B1%95%E6%9C%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后期展望</h1>\n<ol>\n<li>后端 jenkins 增量构建优化</li>\n<li>gitlab 发布评论触发 jenkins 等环境的一键部署</li>\n<li><a href="https://github.com/towavephone/webpack-lazy-build-demo" target="_blank" rel="nofollow noreferrer noopener">webpack 懒编译</a>，模仿 webpack5 与 vite 的懒编译思路</li>\n<li><a href="https://github.com/i5ting/learn-rust-for-fe" target="_blank" rel="nofollow noreferrer noopener">rust 相关前端工具链</a>，例如 Bun，Next.js，swc，Turbopack</li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/jenkins 编译速度优化/index.md absPath of file >>> MarkdownRemark",timeToRead:16,frontmatter:{date:"2023-02-10 12:06:31",path:"/jenkins-build-speed-optimize/",tags:"运维, jenkins, 预研",title:"jenkins 编译速度优化",draft:null}},{excerpt:"需求背景 由于公司老项目采用 cra 来构建前端项目，在 jenkins 上的平均打包时长在 10 分钟以上，需要优化线上的打包时间，同时优化本地的开发体验 一期优化 主要针对 cra + webpack3/4 进行的优化 具体功能 cra 配置优化 核心：thread-loader 加快首次编译速度，hard-source-webpack-plugin 加快二次编译速度 config-overrides.js Dockerfile 配置缓存优化 需求背景 为了充分利用缓存，采用 docker…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于公司老项目采用 cra 来构建前端项目，在 jenkins 上的平均打包时长在 10 分钟以上，需要优化线上的打包时间，同时优化本地的开发体验</p>\n<h1 id="一期优化"><a href="#%E4%B8%80%E6%9C%9F%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一期优化</h1>\n<p>主要针对 cra + webpack3/4 进行的优化</p>\n<h2 id="具体功能"><a href="#%E5%85%B7%E4%BD%93%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体功能</h2>\n<h3 id="cra-配置优化"><a href="#cra-%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cra 配置优化</h3>\n<p>核心：thread-loader 加快首次编译速度，hard-source-webpack-plugin 加快二次编译速度</p>\n<p>config-overrides.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25751930907349620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const {\n   override,\n   addBabelPlugins,\n   fixBabelImports,\n   addLessLoader,\n   removeModuleScopePlugin,\n   addWebpackModuleRule,\n   setWebpackOptimizationSplitChunks,\n   addWebpackPlugin,\n   addWebpackAlias\n} = require(\'customize-cra\');\nconst fs = require(\'fs\');\nconst PreloadWebpackPlugin = require(\'preload-webpack-plugin\');\nconst path = require(\'path\');\nconst MonacoWebpackPlugin = require(\'monaco-editor-webpack-plugin\');\nconst WebpackBarPlugin = require(\'webpackbar\');\nconst { get, pick } = require(\'lodash\');\nconst threadLoader = require(\'thread-loader\');\nconst HardSourceWebpackPlugin = require(\'hard-source-webpack-plugin\');\n\nconst packageJson = require(\'./package.json\');\nconst FixHardSourceWebpackPlugin = require(\'./plugins/FixHardSourceWebpackPlugin\');\n// const SpeedMeasurePlugin = require(\'speed-measure-webpack-plugin\')\n// const smp = new SpeedMeasurePlugin()\n\n// 默认开启 hard-source-webpack-plugin 插件，可以传入这个环境变量来主动关闭\nconst { DISABLE_HARD_SOURCE_PLUGIN } = process.env;\n\nthreadLoader.warmup(\n   {\n      // pool options, like passed to loader options\n      // must match loader options to boot the correct pool\n   },\n   [\n      // modules to load\n      // can be any module, i. e.\n      \'babel-loader\'\n   ]\n);\n\n// 打印 webpack 的相关配置，便于调试\nconst craDir = path.join(process.cwd() + \'/.cra\');\n\nif (!fs.existsSync(craDir)) {\n   fs.mkdirSync(craDir);\n}\n\n// 分析打印出的 webpack 相关配置的规律，可以写出此钩子函数，函数签名参考 craco 里面的函数\nconst addBeforeLoaders = (webpackConfig, matchLoader, newLoader = []) => {\n   const matchLoaders = get(webpackConfig, \'module.rules.1.oneOf\', []).filter((item) =>\n      get(item, \'loader\', \'\').includes(matchLoader)\n   );\n   if (matchLoaders.length > 0) {\n      matchLoaders.forEach((item) => {\n         const props = [\'loader\', \'options\'];\n         item.use = [...newLoader, pick(item, props)];\n         props.forEach((item2) => {\n            delete item[item2];\n         });\n      });\n   }\n};\n\n// 这里不能单纯的使用 JSON.stringify，需要特殊处理，否则不能序列化出函数部分\nconst formatConfig = (config) =>\n   JSON.stringify(\n      config,\n      (key, value) => {\n         if (typeof value === \'function\') {\n            return value.toString();\n         }\n         return value;\n      },\n      2\n   );\n\nconst getHardSourceWebpackPlugins = (env) =>\n   !DISABLE_HARD_SOURCE_PLUGIN\n      ? [\n           addWebpackPlugin(\n              new HardSourceWebpackPlugin({\n                 // Either an absolute path or relative to webpack\'s options.context.\n                 cacheDirectory: path.resolve(process.cwd(), \\`node_modules/.cache/hard-source/\\${env}/[confighash]\\`),\n                 // Either a string of object hash function given a webpack config.\n                 configHash: (webpackConfig) => {\n                    // node-object-hash on npm can be used to build this.\n                    // 这里根据 package.json 里面的 dependencies 以及 webpack 配置来决定是否复用缓存\n                    return require(\'node-object-hash\')({ sort: false }).hash({\n                       webpackConfig,\n                       dependencies: packageJson.dependencies\n                    });\n                 },\n                 // Either false, a string, an object, or a project hashing function.\n                 environmentHash: {\n                    root: process.cwd(),\n                    directories: [],\n                    files: []\n                 },\n                 // An object.\n                 info: {\n                    // \'none\' or \'test\'.\n                    mode: \'none\',\n                    // \'debug\', \'log\', \'info\', \'warn\', or \'error\'.\n                    level: \'debug\'\n                 },\n                 // Clean up large, old caches automatically.\n                 cachePrune: {\n                    // Caches younger than \\`maxAge\\` are not considered for deletion. They must\n                    // be at least this (default: 2 days) old in milliseconds.\n                    maxAge: 2 * 24 * 60 * 60 * 1000,\n                    // All caches together must be larger than \\`sizeThreshold\\` before any\n                    // caches will be deleted. Together they must be at least this\n                    // (default: 50 MB) big in bytes.\n                    sizeThreshold: 50 * 1024 * 1024\n                 }\n              })\n           ),\n           env === \'production\' &&\n              // 修复 hard-source-webpack-plugin 插件的各种异常，后面详细说明\n              addWebpackPlugin(\n                 new FixHardSourceWebpackPlugin({\n                    cacheDirectory: path.resolve(process.cwd(), \\`node_modules/.cache/hard-source/\\${env}\\`)\n                 })\n              )\n        ]\n      : [];\n\nmodule.exports = {\n   webpack: (config, env) => {\n      const isProd = env === \'production\';\n\n      const localConfig = override(\n         addBabelPlugins(\n            [\'@babel/plugin-proposal-nullish-coalescing-operator\'],\n            [\'@babel/plugin-syntax-optional-chaining\']\n         ),\n         fixBabelImports(\'import\', {\n            libraryName: \'antd\',\n            libraryDirectory: \'es\',\n            style: true\n         }),\n         addLessLoader({\n            javascriptEnabled: true\n            // modifyVars: { \'@primary-color\': \'#1DA570\' }\n         }),\n         addWebpackAlias({\n            \'@\': path.resolve(__dirname, \'src\')\n         }),\n         removeModuleScopePlugin(),\n         addWebpackModuleRule({\n            // test: /StreamDataWorker\\.js/,\n            test: /(StreamDataWorker|MapDataWorker|FrameProcessWorker)\\.js/,\n            use: { loader: \'worker-loader\', options: { filename: \'worker.[hash].js\' } }\n         }),\n         // TODO 这里不能用 worker.js 后缀，猜测是 oneOf 导致\n         // addWebpackModuleRule({\n         //   test: /\\.worker\\.js\\$/,\n         //   use: { loader: \'worker-loader\' }\n         // }),\n         isProd &&\n            setWebpackOptimizationSplitChunks({\n               cacheGroups: {\n                  vendors: {\n                     minChunks: 2,\n                     test: /[\\\\/]node_modules[\\\\/](?!google-protobuf|@antv|highcharts|mathjs|two\\.js|konva|victory-core)/,\n                     priority: -10,\n                     reuseExistingChunk: true,\n                     name: \'vendors\'\n                  },\n                  default: {\n                     minChunks: 2,\n                     priority: -20,\n                     reuseExistingChunk: true\n                  }\n               }\n            }),\n         // TODO 以下分包策略不是最优解\n         // isProd &&\n         //   setWebpackOptimizationSplitChunks({\n         //     chunks: \'all\',\n         //     maxInitialRequests: 10,\n         //     minSize: 0,\n         //     cacheGroups: {\n         //       vendor: {\n         //         test: module => {\n         //           // 遇到 echarts 相关库时，不要抽出来，以免 echarts 抽出的包很大\n         //           if (/[\\\\/]node_modules[\\\\/](echarts|zrender)/.test(module.context)) {\n         //             return false\n         //           }\n         //           return /[\\\\/]node_modules[\\\\/]/.test(module.context)\n         //         },\n         //         name: module => {\n         //           const packageName = module.context.match(/[\\\\/]node_modules[\\\\/](.*?)([\\\\/]|\\$)/)[1]\n         //           return \\`npm.\\${packageName.replace(\'@\', \'\')}\\`\n         //         }\n         //       }\n         //     }\n         //   }),\n         isProd &&\n            addWebpackPlugin(\n               new PreloadWebpackPlugin({\n                  rel: \'prefetch\',\n                  as: \'script\',\n                  fileBlacklist: [\n                     /\\d{1,2}\\.(\\d?[a-z]?)+\\.chunk\\.js\\$/,\n                     /main\\..+\\.js\\$/,\n                     /\\.css\\$/,\n                     /\\.txt\\$/,\n                     /\\.png\\$/,\n                     /.jpeg\\$/\n                  ],\n                  include: \'allAssets\'\n               })\n            ),\n         addWebpackPlugin(\n            new MonacoWebpackPlugin({\n               languages: [\'json\']\n            })\n         ),\n         // 显示编译进度\n         addWebpackPlugin(new WebpackBarPlugin()),\n         ...getHardSourceWebpackPlugins(env)\n      )(config);\n\n      // 注入 thread-loader\n      addBeforeLoaders(localConfig, \'babel-loader\', [\'thread-loader\']);\n\n      // 限制编译范围\n      localConfig.resolve.extensions = [\'.js\'];\n      localConfig.resolve.mainFields = [\'jsnext:main\', \'main\'];\n      localConfig.resolve.modules = [\'node_modules\'];\n\n      // 本地开发采用更轻量级的 cheap-module-eval-source-map\n      if (!isProd) {\n         localConfig.devtool = \'cheap-module-eval-source-map\';\n      }\n\n      // if (isProd) {\n      //   localConfig.optimization = {\n      //     ...localConfig.optimization,\n      //     nodeEnv: \'production\',\n      //     sideEffects: true,\n      //     concatenateModules: true,\n      //     runtimeChunk: \'single\'\n      //   }\n      // }\n\n      fs.writeFileSync(path.join(craDir, \\`webpack.\\${env}.json\\`), formatConfig(localConfig));\n\n      return localConfig;\n   },\n   devServer: (configFunction) => (proxy, allowedHost) => {\n      const config = configFunction(proxy, allowedHost);\n\n      config.quiet = false;\n\n      // 显示构建耗时\n      config.stats = {\n         errors: true,\n         children: false,\n         warnings: false,\n         colors: true,\n         assets: false,\n         modules: false,\n         entrypoints: false\n      };\n\n      // 关闭 host 检测，以免非 localhost 域名访问时热更新不生效\n      config.disableHostCheck = true;\n\n      fs.writeFileSync(path.join(craDir, \'webpack-dev-server.json\'), formatConfig(config));\n\n      return config;\n   }\n};`, `25751930907349620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>\n   override<span class="token punctuation">,</span>\n   addBabelPlugins<span class="token punctuation">,</span>\n   fixBabelImports<span class="token punctuation">,</span>\n   addLessLoader<span class="token punctuation">,</span>\n   removeModuleScopePlugin<span class="token punctuation">,</span>\n   addWebpackModuleRule<span class="token punctuation">,</span>\n   setWebpackOptimizationSplitChunks<span class="token punctuation">,</span>\n   addWebpackPlugin<span class="token punctuation">,</span>\n   addWebpackAlias\n<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'customize-cra\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> PreloadWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'preload-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> MonacoWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'monaco-editor-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> WebpackBarPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpackbar\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">,</span> pick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> threadLoader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'thread-loader\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> HardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'hard-source-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> FixHardSourceWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./plugins/FixHardSourceWebpackPlugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// const SpeedMeasurePlugin = require(\'speed-measure-webpack-plugin\')</span>\n<span class="token comment">// const smp = new SpeedMeasurePlugin()</span>\n\n<span class="token comment">// 默认开启 hard-source-webpack-plugin 插件，可以传入这个环境变量来主动关闭</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">DISABLE_HARD_SOURCE_PLUGIN</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>\n\nthreadLoader<span class="token punctuation">.</span><span class="token function">warmup</span><span class="token punctuation">(</span>\n   <span class="token punctuation">{</span>\n      <span class="token comment">// pool options, like passed to loader options</span>\n      <span class="token comment">// must match loader options to boot the correct pool</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">[</span>\n      <span class="token comment">// modules to load</span>\n      <span class="token comment">// can be any module, i. e.</span>\n      <span class="token string">\'babel-loader\'</span>\n   <span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 打印 webpack 的相关配置，便于调试</span>\n<span class="token keyword">const</span> craDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'/.cra\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>craDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>craDir<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 分析打印出的 webpack 相关配置的规律，可以写出此钩子函数，函数签名参考 craco 里面的函数</span>\n<span class="token keyword">const</span> <span class="token function-variable function">addBeforeLoaders</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig<span class="token punctuation">,</span> matchLoader<span class="token punctuation">,</span> newLoader <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token string">\'module.rules.1.oneOf\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n      <span class="token keyword">get</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">\'loader\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>matchLoader<span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>matchLoaders<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      matchLoaders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'loader\'</span><span class="token punctuation">,</span> <span class="token string">\'options\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n         item<span class="token punctuation">.</span>use <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>newLoader<span class="token punctuation">,</span> <span class="token function">pick</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n         props<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">delete</span> item<span class="token punctuation">[</span>item2<span class="token punctuation">]</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 这里不能单纯的使用 JSON.stringify，需要特殊处理，否则不能序列化出函数部分</span>\n<span class="token keyword">const</span> <span class="token function-variable function">formatConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>\n      config<span class="token punctuation">,</span>\n      <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token keyword">return</span> value<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token number">2</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getHardSourceWebpackPlugins</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token operator">!</span><span class="token constant">DISABLE_HARD_SOURCE_PLUGIN</span>\n      <span class="token operator">?</span> <span class="token punctuation">[</span>\n           <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n              <span class="token keyword">new</span> <span class="token class-name">HardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                 <span class="token comment">// Either an absolute path or relative to webpack\'s options.context.</span>\n                 cacheDirectory<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">node_modules/.cache/hard-source/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/[confighash]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                 <span class="token comment">// Either a string of object hash function given a webpack config.</span>\n                 <span class="token function-variable function">configHash</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                    <span class="token comment">// node-object-hash on npm can be used to build this.</span>\n                    <span class="token comment">// 这里根据 package.json 里面的 dependencies 以及 webpack 配置来决定是否复用缓存</span>\n                    <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'node-object-hash\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sort<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                       webpackConfig<span class="token punctuation">,</span>\n                       dependencies<span class="token punctuation">:</span> packageJson<span class="token punctuation">.</span>dependencies\n                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                 <span class="token comment">// Either false, a string, an object, or a project hashing function.</span>\n                 environmentHash<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                    root<span class="token punctuation">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                    directories<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n                    files<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n                 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                 <span class="token comment">// An object.</span>\n                 info<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                    <span class="token comment">// \'none\' or \'test\'.</span>\n                    mode<span class="token punctuation">:</span> <span class="token string">\'none\'</span><span class="token punctuation">,</span>\n                    <span class="token comment">// \'debug\', \'log\', \'info\', \'warn\', or \'error\'.</span>\n                    level<span class="token punctuation">:</span> <span class="token string">\'debug\'</span>\n                 <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                 <span class="token comment">// Clean up large, old caches automatically.</span>\n                 cachePrune<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                    <span class="token comment">// Caches younger than `maxAge` are not considered for deletion. They must</span>\n                    <span class="token comment">// be at least this (default: 2 days) old in milliseconds.</span>\n                    maxAge<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span>\n                    <span class="token comment">// All caches together must be larger than `sizeThreshold` before any</span>\n                    <span class="token comment">// caches will be deleted. Together they must be at least this</span>\n                    <span class="token comment">// (default: 50 MB) big in bytes.</span>\n                    sizeThreshold<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>\n                 <span class="token punctuation">}</span>\n              <span class="token punctuation">}</span><span class="token punctuation">)</span>\n           <span class="token punctuation">)</span><span class="token punctuation">,</span>\n           env <span class="token operator">===</span> <span class="token string">\'production\'</span> <span class="token operator">&amp;&amp;</span>\n              <span class="token comment">// 修复 hard-source-webpack-plugin 插件的各种异常，后面详细说明</span>\n              <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n                 <span class="token keyword">new</span> <span class="token class-name">FixHardSourceWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                    cacheDirectory<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">node_modules/.cache/hard-source/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n                 <span class="token punctuation">}</span><span class="token punctuation">)</span>\n              <span class="token punctuation">)</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token function-variable function">webpack</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> isProd <span class="token operator">=</span> env <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">const</span> localConfig <span class="token operator">=</span> <span class="token function">override</span><span class="token punctuation">(</span>\n         <span class="token function">addBabelPlugins</span><span class="token punctuation">(</span>\n            <span class="token punctuation">[</span><span class="token string">\'@babel/plugin-proposal-nullish-coalescing-operator\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token string">\'@babel/plugin-syntax-optional-chaining\'</span><span class="token punctuation">]</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">\'import\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            libraryName<span class="token punctuation">:</span> <span class="token string">\'antd\'</span><span class="token punctuation">,</span>\n            libraryDirectory<span class="token punctuation">:</span> <span class="token string">\'es\'</span><span class="token punctuation">,</span>\n            style<span class="token punctuation">:</span> <span class="token boolean">true</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addLessLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span>\n            <span class="token comment">// modifyVars: { \'@primary-color\': \'#1DA570\' }</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackAlias</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            <span class="token string">\'@\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'src\'</span><span class="token punctuation">)</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">removeModuleScopePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackModuleRule</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            <span class="token comment">// test: /StreamDataWorker\\.js/,</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/(StreamDataWorker|MapDataWorker|FrameProcessWorker)\\.js/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">{</span> loader<span class="token punctuation">:</span> <span class="token string">\'worker-loader\'</span><span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token punctuation">{</span> filename<span class="token punctuation">:</span> <span class="token string">\'worker.[hash].js\'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token comment">// TODO 这里不能用 worker.js 后缀，猜测是 oneOf 导致</span>\n         <span class="token comment">// addWebpackModuleRule({</span>\n         <span class="token comment">//   test: /\\.worker\\.js$/,</span>\n         <span class="token comment">//   use: { loader: \'worker-loader\' }</span>\n         <span class="token comment">// }),</span>\n         isProd <span class="token operator">&amp;&amp;</span>\n            <span class="token function">setWebpackOptimizationSplitChunks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                  vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n                     test<span class="token punctuation">:</span> <span class="token regex">/[\\\\/]node_modules[\\\\/](?!google-protobuf|@antv|highcharts|mathjs|two\\.js|konva|victory-core)/</span><span class="token punctuation">,</span>\n                     priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>\n                     reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n                     name<span class="token punctuation">:</span> <span class="token string">\'vendors\'</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                  <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n                     priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>\n                     reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token comment">// TODO 以下分包策略不是最优解</span>\n         <span class="token comment">// isProd &amp;&amp;</span>\n         <span class="token comment">//   setWebpackOptimizationSplitChunks({</span>\n         <span class="token comment">//     chunks: \'all\',</span>\n         <span class="token comment">//     maxInitialRequests: 10,</span>\n         <span class="token comment">//     minSize: 0,</span>\n         <span class="token comment">//     cacheGroups: {</span>\n         <span class="token comment">//       vendor: {</span>\n         <span class="token comment">//         test: module => {</span>\n         <span class="token comment">//           // 遇到 echarts 相关库时，不要抽出来，以免 echarts 抽出的包很大</span>\n         <span class="token comment">//           if (/[\\\\/]node_modules[\\\\/](echarts|zrender)/.test(module.context)) {</span>\n         <span class="token comment">//             return false</span>\n         <span class="token comment">//           }</span>\n         <span class="token comment">//           return /[\\\\/]node_modules[\\\\/]/.test(module.context)</span>\n         <span class="token comment">//         },</span>\n         <span class="token comment">//         name: module => {</span>\n         <span class="token comment">//           const packageName = module.context.match(/[\\\\/]node_modules[\\\\/](.*?)([\\\\/]|$)/)[1]</span>\n         <span class="token comment">//           return `npm.${packageName.replace(\'@\', \'\')}`</span>\n         <span class="token comment">//         }</span>\n         <span class="token comment">//       }</span>\n         <span class="token comment">//     }</span>\n         <span class="token comment">//   }),</span>\n         isProd <span class="token operator">&amp;&amp;</span>\n            <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n               <span class="token keyword">new</span> <span class="token class-name">PreloadWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                  rel<span class="token punctuation">:</span> <span class="token string">\'prefetch\'</span><span class="token punctuation">,</span>\n                  <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">\'script\'</span><span class="token punctuation">,</span>\n                  fileBlacklist<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n                     <span class="token regex">/\\d{1,2}\\.(\\d?[a-z]?)+\\.chunk\\.js$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/main\\..+\\.js$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/\\.css$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/\\.txt$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/\\.png$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/.jpeg$/</span>\n                  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n                  include<span class="token punctuation">:</span> <span class="token string">\'allAssets\'</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n            <span class="token keyword">new</span> <span class="token class-name">MonacoWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               languages<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'json\'</span><span class="token punctuation">]</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token comment">// 显示编译进度</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebpackBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token operator">...</span><span class="token function">getHardSourceWebpackPlugins</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 注入 thread-loader</span>\n      <span class="token function">addBeforeLoaders</span><span class="token punctuation">(</span>localConfig<span class="token punctuation">,</span> <span class="token string">\'babel-loader\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'thread-loader\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 限制编译范围</span>\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'.js\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>mainFields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'jsnext:main\'</span><span class="token punctuation">,</span> <span class="token string">\'main\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'node_modules\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 本地开发采用更轻量级的 cheap-module-eval-source-map</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>devtool <span class="token operator">=</span> <span class="token string">\'cheap-module-eval-source-map\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// if (isProd) {</span>\n      <span class="token comment">//   localConfig.optimization = {</span>\n      <span class="token comment">//     ...localConfig.optimization,</span>\n      <span class="token comment">//     nodeEnv: \'production\',</span>\n      <span class="token comment">//     sideEffects: true,</span>\n      <span class="token comment">//     concatenateModules: true,</span>\n      <span class="token comment">//     runtimeChunk: \'single\'</span>\n      <span class="token comment">//   }</span>\n      <span class="token comment">// }</span>\n\n      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>craDir<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">formatConfig</span><span class="token punctuation">(</span>localConfig<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> localConfig<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">devServer</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">configFunction</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">proxy<span class="token punctuation">,</span> allowedHost</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">configFunction</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> allowedHost<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      config<span class="token punctuation">.</span>quiet <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 显示构建耗时</span>\n      config<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span>\n         errors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n         children<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n         warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n         colors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n         assets<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n         modules<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n         entrypoints<span class="token punctuation">:</span> <span class="token boolean">false</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 关闭 host 检测，以免非 localhost 域名访问时热更新不生效</span>\n      config<span class="token punctuation">.</span>disableHostCheck <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n\n      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>craDir<span class="token punctuation">,</span> <span class="token string">\'webpack-dev-server.json\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">formatConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> config<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="dockerfile-配置缓存优化"><a href="#dockerfile-%E9%85%8D%E7%BD%AE%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerfile 配置缓存优化</h3>\n<h4 id="需求背景-1"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>为了充分利用缓存，采用 docker 的缓存策略</p>\n<h4 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h4>\n<p><a href="/docker-introduce-learning/">Docker 入门学习</a></p>\n<h4 id="第一版"><a href="#%E7%AC%AC%E4%B8%80%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第一版</h4>\n<p>这里的主要问题在于一旦改了源码需要编译的时候，缓存失效了</p>\n<p>原因是标红行部分复制了文件，再进行构建的时候，因为已经是新的文件了，所以这里 build 的时候不能使用缓存</p>\n<p>Dockerfile-client</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28313985688854503000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`FROM node:14-alpine as builder\n\n# 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像\nRUN npm config set registry https://registry.npmmirror.com\n\nWORKDIR /home/\n\n# 缓存 package.json pnpm-lock.yaml，只有变更的时候才会重新 install\nCOPY package.json package-lock.json ./\n# 安装依赖\nRUN npm i\n\n# 复制剩余文件\nCOPY . .\n\nRUN ls && npm run build && ls\n\nFROM nginx:alpine\nCOPY --from=builder /home/build /usr/share/nginx/html/\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\n\nEXPOSE 3000`, `28313985688854503000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile{14}"\n              >\n                <span class="gatsby-code-button-language">dockerfile{14}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>14<span class="token punctuation">-</span>alpine as builder\n\n<span class="token comment"># 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像</span>\n<span class="token keyword">RUN</span> npm config set registry https<span class="token punctuation">:</span>//registry.npmmirror.com\n\n<span class="token keyword">WORKDIR</span> /home/\n\n<span class="token comment"># 缓存 package.json pnpm-lock.yaml，只有变更的时候才会重新 install</span>\n<span class="token keyword">COPY</span> package.json package<span class="token punctuation">-</span>lock.json ./\n<span class="token comment"># 安装依赖</span>\n<span class="token keyword">RUN</span> npm i\n\n<span class="token comment"># 复制剩余文件</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">COPY</span> . .</span>\n<span class="token keyword">RUN</span> ls &amp;&amp; npm run build &amp;&amp; ls\n\n<span class="token keyword">FROM</span> nginx<span class="token punctuation">:</span>alpine\n<span class="token keyword">COPY</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>from=builder /home/build /usr/share/nginx/html/\n<span class="token keyword">COPY</span> nginx.conf /etc/nginx/conf.d/default.conf\n\n<span class="token keyword">EXPOSE</span> 3000</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="第二版"><a href="#%E7%AC%AC%E4%BA%8C%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第二版</h4>\n<p>由于第一版的问题，所以需要想办法在 build 过程中也要尽可能的使用缓存</p>\n<p>这里由于缓存容易损坏（由上面提到的 hard-source-webpack-plugin 造成），需要给缓存一个版本的概念，同时也要控制是否使用缓存</p>\n<p>Dockerfile-client-buildkit</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47653324276773315000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\n\nFROM node:14-alpine as builder\n\nARG registry=https://registry.npmmirror.com\n\n# 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像\nRUN npm config set registry \\${registry} -g && npm i -g pnpm\n\nWORKDIR /home/\n\n# 缓存 pnpm-lock.yaml\nCOPY pnpm-lock.yaml ./\n\n# 下载依赖到全局位置\nRUN pnpm fetch --prod\n\n# 复制剩余文件\nCOPY . .\n\n# 安装依赖同时读写缓存\nRUN --mount=type=cache,target=node_modules,id=frontend_node_modules,sharing=locked \\\n    --mount=type=cache,target=/root/.npm,id=npm_cache \\\n    pnpm i --ignore-scripts=true --prod --offline --registry=\\$registry\n\n# build 并读写缓存\nRUN --mount=type=cache,target=node_modules,id=frontend_node_modules,sharing=locked \\\n    pnpm build\n\n# 以下是二阶段\nFROM nginx:alpine\n\nRUN --mount=type=bind,target=/tmp/build,from=builder,source=/home/build \\\n    cp -r /tmp/build/* /usr/share/nginx/html/\n\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\n\nEXPOSE 3000`, `47653324276773315000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n\n<span class="token keyword">FROM</span> node<span class="token punctuation">:</span>14<span class="token punctuation">-</span>alpine as builder\n\n<span class="token keyword">ARG</span> registry=https<span class="token punctuation">:</span>//registry.npmmirror.com\n\n<span class="token comment"># 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像</span>\n<span class="token keyword">RUN</span> npm config set registry $<span class="token punctuation">{</span>registry<span class="token punctuation">}</span> <span class="token punctuation">-</span>g &amp;&amp; npm i <span class="token punctuation">-</span>g pnpm\n\n<span class="token keyword">WORKDIR</span> /home/\n\n<span class="token comment"># 缓存 pnpm-lock.yaml</span>\n<span class="token keyword">COPY</span> pnpm<span class="token punctuation">-</span>lock.yaml ./\n\n<span class="token comment"># 下载依赖到全局位置</span>\n<span class="token keyword">RUN</span> pnpm fetch <span class="token punctuation">-</span><span class="token punctuation">-</span>prod\n\n<span class="token comment"># 复制剩余文件</span>\n<span class="token keyword">COPY</span> . .\n\n<span class="token comment"># 安装依赖同时读写缓存</span>\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=node_modules<span class="token punctuation">,</span>id=frontend_node_modules<span class="token punctuation">,</span>sharing=locked \\\n    <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/root/.npm<span class="token punctuation">,</span>id=npm_cache \\\n    pnpm i <span class="token punctuation">-</span><span class="token punctuation">-</span>ignore<span class="token punctuation">-</span>scripts=true <span class="token punctuation">-</span><span class="token punctuation">-</span>prod <span class="token punctuation">-</span><span class="token punctuation">-</span>offline <span class="token punctuation">-</span><span class="token punctuation">-</span>registry=$registry\n\n<span class="token comment"># build 并读写缓存</span>\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=node_modules<span class="token punctuation">,</span>id=frontend_node_modules<span class="token punctuation">,</span>sharing=locked \\\n    pnpm build\n\n<span class="token comment"># 以下是二阶段</span>\n<span class="token keyword">FROM</span> nginx<span class="token punctuation">:</span>alpine\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=bind<span class="token punctuation">,</span>target=/tmp/build<span class="token punctuation">,</span>from=builder<span class="token punctuation">,</span>source=/home/build \\\n    cp <span class="token punctuation">-</span>r /tmp/build/* /usr/share/nginx/html/\n\n<span class="token keyword">COPY</span> nginx.conf /etc/nginx/conf.d/default.conf\n\n<span class="token keyword">EXPOSE</span> 3000</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最终采用第二版，同时为了减少构建上下文，需要添加如下的文件</p>\n<p>.dockerignore</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3573755855336058400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`*\n# 静态文件\n!public\n# 为了兼容老版本的 jenkins 不报错，实际上不该加\n!build\n\n# 源码\n!src\n\n# 构建相关\n!.env.production\n!config-overrides.js\n!plugins\n!scripts\n\n# 依赖库\n!package.json\n!pnpm-lock.yaml\n\n# nginx\n!nginx.conf`, `3573755855336058400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile"\n              >\n                <span class="gatsby-code-button-language">dockerfile</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile">*\n<span class="token comment"># 静态文件</span>\n!public\n<span class="token comment"># 为了兼容老版本的 jenkins 不报错，实际上不该加</span>\n!build\n\n<span class="token comment"># 源码</span>\n!src\n\n<span class="token comment"># 构建相关</span>\n!.env.production\n!config<span class="token punctuation">-</span>overrides.js\n!plugins\n!scripts\n\n<span class="token comment"># 依赖库</span>\n!package.json\n!pnpm<span class="token punctuation">-</span>lock.yaml\n\n<span class="token comment"># nginx</span>\n!nginx.conf</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="调用"><a href="#%E8%B0%83%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用</h4>\n<ol>\n<li><code class="language-text">BUILDKIT_CACHE_MOUNT_NS</code> 就类似于缓存版本的概念</li>\n<li>可以传入 <code class="language-text">--no-cache</code> 来控制不使用缓存，默认使用（这里的 docker 18 版本的 <code class="language-text">--no-cache</code> 不对 <code class="language-text">type=cache</code> 生效，20 版本的反而生效）</li>\n<li>以上 2 个参数可以配合 jenkins 来控制</li>\n</ol>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31353524430622028000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;scripts&quot;: {\n      &quot;build&quot;: &quot;node scripts/build.js&quot;,\n      &quot;docker:build&quot;: &quot;DOCKER_BUILDKIT=1 docker build --build-arg=BUILDKIT_CACHE_MOUNT_NS=tbtu --network=host -t frontend -f ./Dockerfile-client-buildkit .&quot;,\n      &quot;docker:run&quot;: &quot;docker run -it -p 3000:3000 --rm frontend&quot;,\n      &quot;docker:start&quot;: &quot;npm run docker:build && npm run docker:run&quot;\n   }\n}`, `31353524430622028000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node scripts/build.js"</span><span class="token punctuation">,</span>\n      <span class="token property">"docker:build"</span><span class="token operator">:</span> <span class="token string">"DOCKER_BUILDKIT=1 docker build --build-arg=BUILDKIT_CACHE_MOUNT_NS=tbtu --network=host -t frontend -f ./Dockerfile-client-buildkit ."</span><span class="token punctuation">,</span>\n      <span class="token property">"docker:run"</span><span class="token operator">:</span> <span class="token string">"docker run -it -p 3000:3000 --rm frontend"</span><span class="token punctuation">,</span>\n      <span class="token property">"docker:start"</span><span class="token operator">:</span> <span class="token string">"npm run docker:build &amp;&amp; npm run docker:run"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="npm-切换到-pnpm"><a href="#npm-%E5%88%87%E6%8D%A2%E5%88%B0-pnpm" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>npm 切换到 pnpm</h3>\n<h4 id="需求背景-2"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>在公司的 jenkins 平台上打包时发现 npm install 的过程特别慢，主要是老项目的依赖库太多，故考虑转向安装速度更快的 pnpm</p>\n<h4 id="实现方式"><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现方式</h4>\n<ol>\n<li>因为老项目里面已有 package-lock.json，所以通过 <code class="language-text">pnpm import</code> 可以实现一键迁移，当然有些三方库使用错误导致白屏，这些库需要特殊处理</li>\n<li>配合上面的 dockerfile 可实现深度缓存</li>\n<li>由于上面提到的是否使用缓存一部分是由 package.json 里面的 dependencies 决定，所以需要规范 dependencies 的用法</li>\n</ol>\n<h3 id="npm-install-校验命令"><a href="#npm-install-%E6%A0%A1%E9%AA%8C%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>npm install 校验命令</h3>\n<h4 id="需求背景-3"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>为了统一库的安装工具，防止团队成员使用别的库安装工具</p>\n<h4 id="实现方式-1"><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现方式</h4>\n<ol>\n<li>通过 volta 限制只能使用 pnpm（截止 2022-11-21 11:21:42 <a href="https://github.com/volta-cli/volta/issues/737" target="_blank" rel="nofollow noreferrer noopener">不支持 pnpm</a>）</li>\n<li>手动写 hook 脚本</li>\n</ol>\n<p>最终 2 种方式都采用</p>\n<h4 id="volta"><a href="#volta" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>volta</h4>\n<p>安装过程见 <a href="/frontend-devlopment-environment-setting/#volta">volta</a></p>\n<p>同时在 package.json 加如下几行，这样切入项目目录就会自动切换构建工具</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36337134966096230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;volta&quot;: {\n      &quot;node&quot;: &quot;14.20.0&quot;,\n      &quot;pnpm&quot;: &quot;7.14.1&quot;\n   }\n}`, `36337134966096230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"volta"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">"14.20.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"pnpm"</span><span class="token operator">:</span> <span class="token string">"7.14.1"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="hook-脚本"><a href="#hook-%E8%84%9A%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>hook 脚本</h4>\n<p>scripts/node-check-version.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2821052042912231000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const { exec } = require(\'child_process\');\nexec(\'node -v\', (err, stdout) => {\n   if (err) throw err;\n   if (parseInt(stdout.slice(1)) !== 14) {\n      // NOTE: This can happen if you have a dependency which lists an old version of npm in its own dependencies.\n      throw new Error(\\`[ERROR] You need node version @=14 but you have \\${stdout}\\`);\n   }\n});`, `2821052042912231000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> exec <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'child_process\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">\'node -v\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stdout</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>stdout<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// NOTE: This can happen if you have a dependency which lists an old version of npm in its own dependencies.</span>\n      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[ERROR] You need node version @=14 but you have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>stdout<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>scripts/only-allow.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43411234011431320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const pmFromUserAgent = (userAgent) => {\n   const pmSpec = userAgent.split(\' \')[0];\n   const separatorPos = pmSpec.lastIndexOf(\'/\');\n   return {\n      name: pmSpec.substr(0, separatorPos),\n      version: pmSpec.substr(separatorPos + 1)\n   };\n};\n\nif (!process.env.npm_config_user_agent) {\n   throw new Error(\'[ERROR] Please check your npm!\');\n}\n\nconst [name, version] = process.argv.slice(2);\n\nconst pm = pmFromUserAgent(process.env.npm_config_user_agent);\n\nif (name !== pm.name) {\n   const errors = [\\`[ERROR] You need \\${name}\\`];\n\n   const urlMap = {\n      pnpm: \'https://pnpm.js.org/\',\n      yarn: \'https://yarnpkg.com/\'\n   };\n\n   if (urlMap[name]) {\n      errors.push(\\`Please go to \\${urlMap[name]}\\`);\n   }\n\n   throw new Error(errors.join(\', \'));\n}\n\nif (parseFloat(pm.version) < version) {\n   throw new Error(\\`[ERROR] You need \\${name} version @>=\\${version} but you have \\${pm.version}\\`);\n}`, `43411234011431320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">pmFromUserAgent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userAgent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> pmSpec <span class="token operator">=</span> userAgent<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> separatorPos <span class="token operator">=</span> pmSpec<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> pmSpec<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> separatorPos<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      version<span class="token punctuation">:</span> pmSpec<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>separatorPos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_user_agent<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'[ERROR] Please check your npm!\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> version<span class="token punctuation">]</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> pm <span class="token operator">=</span> <span class="token function">pmFromUserAgent</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_user_agent<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!==</span> pm<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[ERROR] You need </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> urlMap <span class="token operator">=</span> <span class="token punctuation">{</span>\n      pnpm<span class="token punctuation">:</span> <span class="token string">\'https://pnpm.js.org/\'</span><span class="token punctuation">,</span>\n      yarn<span class="token punctuation">:</span> <span class="token string">\'https://yarnpkg.com/\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>urlMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Please go to </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>urlMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\', \'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span>pm<span class="token punctuation">.</span>version<span class="token punctuation">)</span> <span class="token operator">&lt;</span> version<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[ERROR] You need </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> version @>=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> but you have </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pm<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75714071722269930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;scripts&quot;: {\n      &quot;preinstall&quot;: &quot;npm run verify-version&quot;,\n      &quot;node-check-version&quot;: &quot;node scripts/node-check-version.js&quot;,\n      &quot;only-allow&quot;: &quot;node scripts/only-allow.js pnpm 7&quot;,\n      &quot;pnpm:devPreinstall&quot;: &quot;npm run verify-version&quot;,\n      &quot;verify-version&quot;: &quot;npm run node-check-version && npm run only-allow&quot;\n   }\n}`, `75714071722269930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"preinstall"</span><span class="token operator">:</span> <span class="token string">"npm run verify-version"</span><span class="token punctuation">,</span>\n      <span class="token property">"node-check-version"</span><span class="token operator">:</span> <span class="token string">"node scripts/node-check-version.js"</span><span class="token punctuation">,</span>\n      <span class="token property">"only-allow"</span><span class="token operator">:</span> <span class="token string">"node scripts/only-allow.js pnpm 7"</span><span class="token punctuation">,</span>\n      <span class="token property">"pnpm:devPreinstall"</span><span class="token operator">:</span> <span class="token string">"npm run verify-version"</span><span class="token punctuation">,</span>\n      <span class="token property">"verify-version"</span><span class="token operator">:</span> <span class="token string">"npm run node-check-version &amp;&amp; npm run only-allow"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里要注意，由于 pnpm 下的 preinstall 是 install 后才执行的，所以增加了 <code class="language-text">pnpm:devPreinstall</code>，同时生产环境通过添加 <code class="language-text">--ignore-scripts=true</code> 参数不运行此钩子</p>\n<p>以上就可以限制只能通过 pnpm 来进行 install（以上脚本还限制了版本）</p>\n<h3 id="hard-source-webpack-plugin-的线上修复"><a href="#hard-source-webpack-plugin-%E7%9A%84%E7%BA%BF%E4%B8%8A%E4%BF%AE%E5%A4%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>hard-source-webpack-plugin 的线上修复</h3>\n<h4 id="需求背景-4"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>在使用了 hard-source-webpack-plugin 作缓存加速时，有以下比较明显的问题</p>\n<ol>\n<li>二次编译有时不能正常停止</li>\n<li>二次编译会出现各种编译报错，清空缓存后重新编译却正常</li>\n</ol>\n<h4 id="实现方式-2"><a href="#%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现方式</h4>\n<p>针对以上问题，有以下解决方式</p>\n<ol>\n<li>二次编译时识别到 done 即编译完成，此时调用 <code class="language-text">process.exit(0)</code> 手动结束</li>\n<li>二次编译时一旦编译报错则认为是缓存损坏，此时清空缓存，重启 build 命令</li>\n</ol>\n<p>scripts/const.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16862900599883979000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const CACHE_ERROR_CODE = 10;\n\nmodule.exports = {\n   CACHE_ERROR_CODE\n};`, `16862900599883979000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">CACHE_ERROR_CODE</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token constant">CACHE_ERROR_CODE</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>scripts/build.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9336401171700960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const child_process = require(\'child_process\');\n\nconst { CACHE_ERROR_CODE } = require(\'./const\');\n\nfunction spawn(mainModule) {\n   const worker = child_process.spawn(\'react-app-rewired\', mainModule, {\n      stdio: \'inherit\'\n   });\n\n   worker.on(\'exit\', function(code) {\n      // 接受到缓存损坏信号，重启命令\n      if (code === CACHE_ERROR_CODE) {\n         spawn(mainModule);\n         // 除了正常停止的 0 外，其他错误码均认为异常\n      } else if (code !== 0) {\n         process.exit(1);\n      }\n   });\n}\n\nspawn([\'--max-old-space-size=4096\', \'build\']);`, `9336401171700960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'child_process\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">CACHE_ERROR_CODE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./const\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token parameter">mainModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> worker <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">\'react-app-rewired\'</span><span class="token punctuation">,</span> mainModule<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   worker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'exit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 接受到缓存损坏信号，重启命令</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token constant">CACHE_ERROR_CODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token function">spawn</span><span class="token punctuation">(</span>mainModule<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token comment">// 除了正常停止的 0 外，其他错误码均认为异常</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'--max-old-space-size=4096\'</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>plugins/FixHardSourceWebpackPlugin.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20260701042001130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const rimraf = require(\'rimraf\');\nconst { get } = require(\'lodash\');\nconst { CACHE_ERROR_CODE } = require(\'../scripts/const\');\n\nclass FixHardSourceWebpackPlugin {\n   constructor(options) {\n      this.options = options || {};\n      // 是否读取了上次的缓存\n      this.cacheRead = false;\n   }\n\n   apply(compiler) {\n      compiler.hooks.hardSourceLog.tap(\'hardSourceLog\', (message) => {\n         // eslint-disable-next-line no-useless-call\n         // console[message.level].call(console, message)\n\n         const id = get(message, \'data.id\');\n\n         if (id === \'confighash--reused\') {\n            this.cacheRead = true;\n         }\n      });\n\n      const handleClearCache = () => {\n         // 第一次生成缓存的时候，如果编译失败则判定缓存无效，清空缓存，退出命令\n         // 第二次读缓存的情况下，如果编译失败则判定缓存无效，清空缓存，重启命令\n         const { cacheDirectory } = this.options;\n         console.log(\'[FixHardSourceWebpackPlugin] Clearing Cache\', cacheDirectory);\n         rimraf.sync(cacheDirectory);\n         console.log(\'[FixHardSourceWebpackPlugin] Cache Cleared\');\n         if (this.cacheRead) {\n            console.log(\'[FixHardSourceWebpackPlugin] Restarting...\');\n            process.exit(CACHE_ERROR_CODE);\n         }\n      };\n\n      // 找不到具体的模块时会调用，比如随便导入一个不存在的模块\n      // import Atmp from \'./fake\'，且代码里面用到 Atmp 组件（这里的 fake 根本不存在）\n      compiler.hooks.failed.tap(\'FixHardSourceWebpack Cache Error\', () => {\n         console.log(\'[FixHardSourceWebpackPlugin] Invoke Failed\');\n         handleClearCache();\n      });\n\n      // 导出一个不存在的模块并使用时会调用\n      // import { Atmp } from \'./fake\' 且代码里面用到 Atmp 组件（实际上 Atmp 是不存在的组件）\n      compiler.hooks.done.tap(\'FixHardSourceWebpack Cache Error\', (stats) => {\n         const hasErrors = stats.hasErrors();\n         if (!hasErrors) {\n            return;\n         }\n         console.log(\'[FixHardSourceWebpackPlugin] Invoke Done\');\n         handleClearCache();\n      });\n\n      compiler.hooks.done.tap(\'FixHardSourceWebpackPlugin Force Stop\', (stats) => {\n         if (!this.cacheRead) {\n            return;\n         }\n\n         // 编译完成强制结束\n         // HACK 生产模式下因为 hard-source-webpack-plugin 插件的原因不会完全停止，暂未找到原因\n         setTimeout(() => {\n            console.log(\'[FixHardSourceWebpackPlugin] Force Stop\');\n            process.exit(0);\n         });\n      });\n   }\n}\n\nmodule.exports = FixHardSourceWebpackPlugin;`, `20260701042001130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> rimraf <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'rimraf\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">CACHE_ERROR_CODE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../scripts/const\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">FixHardSourceWebpackPlugin</span> <span class="token punctuation">{</span>\n   <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token comment">// 是否读取了上次的缓存</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheRead <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>hardSourceLog<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'hardSourceLog\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token comment">// eslint-disable-next-line no-useless-call</span>\n         <span class="token comment">// console[message.level].call(console, message)</span>\n\n         <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token string">\'data.id\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">\'confighash--reused\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>cacheRead <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">const</span> <span class="token function-variable function">handleClearCache</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token comment">// 第一次生成缓存的时候，如果编译失败则判定缓存无效，清空缓存，退出命令</span>\n         <span class="token comment">// 第二次读缓存的情况下，如果编译失败则判定缓存无效，清空缓存，重启命令</span>\n         <span class="token keyword">const</span> <span class="token punctuation">{</span> cacheDirectory <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">;</span>\n         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'[FixHardSourceWebpackPlugin] Clearing Cache\'</span><span class="token punctuation">,</span> cacheDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         rimraf<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>cacheDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'[FixHardSourceWebpackPlugin] Cache Cleared\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheRead<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'[FixHardSourceWebpackPlugin] Restarting...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token constant">CACHE_ERROR_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 找不到具体的模块时会调用，比如随便导入一个不存在的模块</span>\n      <span class="token comment">// import Atmp from \'./fake\'，且代码里面用到 Atmp 组件（这里的 fake 根本不存在）</span>\n      compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>failed<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'FixHardSourceWebpack Cache Error\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'[FixHardSourceWebpackPlugin] Invoke Failed\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token function">handleClearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 导出一个不存在的模块并使用时会调用</span>\n      <span class="token comment">// import { Atmp } from \'./fake\' 且代码里面用到 Atmp 组件（实际上 Atmp 是不存在的组件）</span>\n      compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'FixHardSourceWebpack Cache Error\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> hasErrors <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasErrors<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'[FixHardSourceWebpackPlugin] Invoke Done\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token function">handleClearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">\'FixHardSourceWebpackPlugin Force Stop\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheRead<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n\n         <span class="token comment">// 编译完成强制结束</span>\n         <span class="token comment">// HACK 生产模式下因为 hard-source-webpack-plugin 插件的原因不会完全停止，暂未找到原因</span>\n         <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'[FixHardSourceWebpackPlugin] Force Stop\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> FixHardSourceWebpackPlugin<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="后续问题"><a href="#%E5%90%8E%E7%BB%AD%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后续问题</h4>\n<p>在代码变动之后，如果通过缓存生成，查看编译后的代码还是之前的老代码，需要暂时关闭缓存待以后解决</p>\n<h3 id="preload-webpack-plugin-失效处理"><a href="#preload-webpack-plugin-%E5%A4%B1%E6%95%88%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>preload-webpack-plugin 失效处理</h3>\n<h4 id="需求背景-5"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>此插件在 pnpm 下不生效，在 npm 下反而生效</p>\n<h4 id="原因"><a href="#%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原因</h4>\n<p>require 指向的 html-webpack-plugin 不是同一个，导致 hook 不能被调用，具体见 <a href="https://github.com/jantimon/html-webpack-plugin/issues/1091#issuecomment-434708455" target="_blank" rel="nofollow noreferrer noopener">issue</a></p>\n<h4 id="解决方案"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h4>\n<p>升级到 3.0.0-beta.4 即可，对比可知源码做了以上处理</p>\n<p>3.0.0-beta.3 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16643202918559408000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (!hook) {\n   const HtmlWebpackPlugin = require(\'html-webpack-plugin\');\n   hook = HtmlWebpackPlugin.getHooks(compilation).beforeEmit;\n}`, `16643202918559408000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hook<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   hook <span class="token operator">=</span> HtmlWebpackPlugin<span class="token punctuation">.</span><span class="token function">getHooks</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">.</span>beforeEmit<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>3.0.0-beta.4 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60628552684918110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (!hook) {\n   const [HtmlWebpackPlugin] = compiler.options.plugins.filter(\n      (plugin) => plugin.constructor.name === \'HtmlWebpackPlugin\'\n   );\n   assert(HtmlWebpackPlugin, \'Unable to find an instance of \' + \'HtmlWebpackPlugin in the current compilation.\');\n   hook = HtmlWebpackPlugin.constructor.getHooks(compilation).beforeEmit;\n}`, `60628552684918110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hook<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>HtmlWebpackPlugin<span class="token punctuation">]</span> <span class="token operator">=</span> compiler<span class="token punctuation">.</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>\n      <span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token operator">=></span> plugin<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'HtmlWebpackPlugin\'</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">assert</span><span class="token punctuation">(</span>HtmlWebpackPlugin<span class="token punctuation">,</span> <span class="token string">\'Unable to find an instance of \'</span> <span class="token operator">+</span> <span class="token string">\'HtmlWebpackPlugin in the current compilation.\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   hook <span class="token operator">=</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span><span class="token function">getHooks</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">.</span>beforeEmit<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="分包失效问题"><a href="#%E5%88%86%E5%8C%85%E5%A4%B1%E6%95%88%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分包失效问题</h3>\n<h4 id="需求背景-6"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>发现分包结果和原来的不一致，比原来大很多，比如看下面的三方库</p>\n<p>原来的</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-02-10-11-51-16-bb2ff91472970fe8fa0d538f99cab0e3-a9fd5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.109375%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACzElEQVQozyWS3U/TYBjF+9fpFcEbidyYkHihRi4wYQZkJopOiLoZxAuixjgBIcBwDANMPgZzMka3dd3Wteu6dt9rN9rStesnq+8kOTl5b05+53meF2rz7TIRrjWqgiRdyp2OIvcM/VpXmgbU0zTbttuRUGnGWV1w456X9W+fClMOdOIxxPIXxXoTeNc0ZENTDV1XFE2WdUXWgcsKcMu2iz9Xo7dv4I4H2OQoPfs8eutm4s4gRDfbZJ1jOyona62u0ZZ1QVR4QRZFRRT6EgS5Y9jMr03k3hA17Ug7xxq+FXp1kV72QpVGJZsnUtkMXiA5gQdkQ1X1rnLNt0BzVe3ZNrfrz43eLbyawB33xd2tWjhUOdiDeJHNEjkYSWbwXDKDFhma51i2Vm2Uy1y9ZqndnmH0Z0aR4rKX8W9UAv7GD+/v4UH44Qh00a7ieRzNZnIE0eBYSZKuDMPS+3wTrMo0LQuMbGcZYWmPDEQqgaRIhs9pj4tZmIOENotl0vD5eSqZJAmiWqmUaJoiSapQkESxZ1m60Q9vR+qjc1nPWml2tYzGClzkqHh8CKlCmSKwDILkMQyNxxmKUjuS1pEMcDNd72mqrvVrb582nO6zue/E2y0+thaMPhpBpsYhvlnEM2g6kcihKN9sSjwvtDgTjKpplqqCbZmGCcJp+mIjiO3+YfaxS+rwGH06RrpdEM82MTQVPzsDWBLDSBwvUQVd7lyHLU29svpkisf9+fW9UuCQDZYYWIxFm7G/kCQIoDACw9lUCkujaDJBkyQg26ZxLfNKB+Gj1sFYevQ1/uJdzRMNf8WmnbBrEpBLmRRydnqKJOLJOExTxVq5fMnzWv/O4HspiqpYVi/UDD3LTs0T772tlZOtuZ2hgdXhAcgfRtb2Y0s7kZXgKZAvFPefJH1H8MZ/gcd6CN48SX0Ibo/755/4Ps7sry0sLn558eazy/0P0amGPG/S4poAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 02 10 11 51 16" title="" data-src="/static/2023-02-10-11-51-16-bb2ff91472970fe8fa0d538f99cab0e3-fee1c.png" data-srcset="/static/2023-02-10-11-51-16-bb2ff91472970fe8fa0d538f99cab0e3-a67b7.png 200w,\n/static/2023-02-10-11-51-16-bb2ff91472970fe8fa0d538f99cab0e3-0b187.png 400w,\n/static/2023-02-10-11-51-16-bb2ff91472970fe8fa0d538f99cab0e3-fee1c.png 800w,\n/static/2023-02-10-11-51-16-bb2ff91472970fe8fa0d538f99cab0e3-b1a91.png 1200w,\n/static/2023-02-10-11-51-16-bb2ff91472970fe8fa0d538f99cab0e3-a9fd5.png 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>新的</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-02-10-11-52-53-077e555bd435b9e484d8fbd5fffbda67-a9fd5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 85.9375%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsSAAALEgHS3X78AAAC/klEQVQ4y02SW4+bVhDH+ez5AH1oVGkbrZRKURsp6UMeojbVpvJmk+zaqzX3A4eDuWPAcLituRiMoYOdh0o/Hc+5zMx//oYpn6uALAtf7o+ncRimcQTG0+n/nIYBgNu+7/ZV1QbbVsetbTBFvrdW73z+43a7y2nynOdFlrZVNZ1fj8fjD6B23499P01T8fiwe/+2+HbLFEkSRzQMdnkSd01zqCqga+pT2w59d2zqY9sMh3Y4HGbgcBzpzd/+1c/xh3cMjXeOsQlcp2vaoeuPhw7ogfbQd31X11Bxji807XE4pYub4LdX8fvfGdeLdMP3gyxJ63BXxrRKs4ZeKA4J3dO0umzhPKZ1UXXZ7U30+tf04ZZ5LosoCJM4oQmID9umuRg2OzednRtO02kERmCAaKp0rV4tvYwwZRYRrEiiJAoCwdh1nK3vA67r+J7ruS7EnufpOnFs27Es23HqwJuI+d3/xHT73CRYU1SiKERVkSBgRQFknscISTyvyjLwuFwiUZQ4FhOS3H3Orq8X5E/mUHiegU19Y+m6Z9uB60bbLRA4TggSbDv03NDzbMOAK9+yYkqTxT/JLy/vzY9MHnmKwCGBlzhOV9Ut5HgepPlQaF4tyAGgNFxB8jYI6ZfPyasr2bpj2n1pEg0EAzqG6aVLDCJBPBTVkAz6n1YrVZIQTIG14u7f9M31XpaYag/mwQNZQUjDWFUUnRAAAk3TYCXwo2F2vcZQEcmw2RlWpHt0dc+UaWRuCLwALMNIkyTPsiLLMkrzecnSLAfCaEdpGidpllJWyz7JvbP4yjRlBm7PVivKRpv1G4QA85YQpGqqpqtYX7MCnMhINU3jw13w4o1tIpupy4IgBBMqMCTIOv9DWJYlnoNZWE7kRQR8u18KggQlVKwuHsOf3loE+3OycW4IVkNn7dwfOmsI6RqREYa2wNOaRyqRkLrZ6It1cvUX3Sx5pioLTZkbwveAJElkWfgkQIXIcZIorqGzIHOC9PX7A8/y6zUHnt6y8R9fMvdJ+A+6oH9QRieClwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 02 10 11 52 53" title="" data-src="/static/2023-02-10-11-52-53-077e555bd435b9e484d8fbd5fffbda67-fee1c.png" data-srcset="/static/2023-02-10-11-52-53-077e555bd435b9e484d8fbd5fffbda67-a67b7.png 200w,\n/static/2023-02-10-11-52-53-077e555bd435b9e484d8fbd5fffbda67-0b187.png 400w,\n/static/2023-02-10-11-52-53-077e555bd435b9e484d8fbd5fffbda67-fee1c.png 800w,\n/static/2023-02-10-11-52-53-077e555bd435b9e484d8fbd5fffbda67-b1a91.png 1200w,\n/static/2023-02-10-11-52-53-077e555bd435b9e484d8fbd5fffbda67-a9fd5.png 1280w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="原因-1"><a href="#%E5%8E%9F%E5%9B%A0-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原因</h4>\n<p>经分析 treeShaking 失效，说明 main 没有识别到 es6 的语法</p>\n<h4 id="解决方案-1"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h4>\n<p>需要注释掉 mainFields 这一行，默认 cra 已做了 es6 语法的处理</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44331348080909200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// localConfig.resolve.mainFields = [\'jsnext:main\', \'main\'];`, `44331348080909200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// localConfig.resolve.mainFields = [\'jsnext:main\', \'main\'];</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="修复-fastrefresh-在-worker-报错"><a href="#%E4%BF%AE%E5%A4%8D-fastrefresh-%E5%9C%A8-worker-%E6%8A%A5%E9%94%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复 fastRefresh 在 worker 报错</h3>\n<h4 id="需求背景-7"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>如果一个文件导出函数时被前端代码和 worker 同时使用时报错</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-02-10-11-58-09-c4c17a2f8efeac97e2a34ecaa69c3245-a36d1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 604px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 26.986754966887418%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA9klEQVQY0yWNyXKEIBQA/f/fSg6zqUQYXHgEcMFlxBGUaGUuMUlVV9+6OrCrX8xkWNmgvA2pjNLwQuIL+TghGmVpAvhGgUBXaj/OfrKLmVczu8d0ENhlneZF905gzqOUJsAwpAmjcabKBy5qlCoKTSF0IdvDVfeUjRntPrrvv9h5Y7eBQndFFcnziBBEUYjjECdJxnjFpGZC87IDqZt+1oPtzDJMa+CO2PrBeJ2L4hxnMaWn+H4j17fz7f1KUIrvgCi/F4qyimSCq6HsnqIZK21+z7Pzzm1TP+aF4KA4V/BZ5iBB1VzWqmrduttlP3zgt9f69fr3D+qQCTlnM4VyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 02 10 11 58 09" title="" data-src="/static/2023-02-10-11-58-09-c4c17a2f8efeac97e2a34ecaa69c3245-a36d1.png" data-srcset="/static/2023-02-10-11-58-09-c4c17a2f8efeac97e2a34ecaa69c3245-765e7.png 200w,\n/static/2023-02-10-11-58-09-c4c17a2f8efeac97e2a34ecaa69c3245-c9f48.png 400w,\n/static/2023-02-10-11-58-09-c4c17a2f8efeac97e2a34ecaa69c3245-a36d1.png 604w" data-sizes="(max-width: 604px) 100vw, 604px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="原因-2"><a href="#%E5%8E%9F%E5%9B%A0-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原因</h4>\n<p>在 development 模式下，如果一个文件里面的 function 同时被 worker 和前端文件使用（即被前端的 <code class="language-text">babel-loader/react-refresh</code> 处理过，此时就有了 fastRefresh 的插件代码），而 fastRefresh 里面没有针对 worker 运行环境的处理，此时会报错</p>\n<h4 id="方案"><a href="#%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p>需要对 <code class="language-text">$RefreshReg$</code> 做兼容处理，即确保只在开发环境的 worker 添加以下代码（注意这里的代码必须写成单独的文件并使用 import 放在 worker 的第一行，否则会因为执行时机的问题不起作用）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25889071427121533000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`global.\\$RefreshReg\\$ = () => {};\nglobal.\\$RefreshSig\\$ = () => {};`, `25889071427121533000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">global<span class="token punctuation">.</span><span class="token function-variable function">$RefreshReg$</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\nglobal<span class="token punctuation">.</span><span class="token function-variable function">$RefreshSig$</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<ol>\n<li>不对 worker 文件做 babel 处理（此方案改动较大，不现实）</li>\n<li>\n<p>在 worker-loader 前插入新的 loader，此 loader 插入以上代码，注意只在 development 环境插入一行代码</p>\n<ol>\n<li>找现成的插入代码的 loader</li>\n<li>自己写 loader</li>\n</ol>\n</li>\n</ol>\n<h3 id="懒编译"><a href="#%E6%87%92%E7%BC%96%E8%AF%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>懒编译</h3>\n<h4 id="需求背景-8"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>目前老项目在开发模式下全量编译过慢，而有时只需要开发少数几个页面</p>\n<h4 id="选型过程"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h4>\n<p>因老项目使用的是 webpack4，历史代码太多不好升级，所以需要通过模仿 webpack5 的懒编译实现，有以下几个选型</p>\n<ol>\n<li><a href="https://github.com/bahmutov/web-packing" target="_blank" rel="nofollow noreferrer noopener">web-packing</a> 实现了网络请求来打包对应组件，实现思路类似懒编译，但和理想中的相差较远</li>\n<li><a href="https://github.com/sysgears/webpack-virtual-modules" target="_blank" rel="nofollow noreferrer noopener">webpack-virtual-modules</a> 实现了在内存中动态创建文件，但需要重新开始写懒编译效果</li>\n<li><a href="https://github.com/lisiyizu/vue-dynamic-module-example" target="_blank" rel="nofollow noreferrer noopener">vue-dynamic-module-example</a> 实现了在 vue 中懒编译文件，但只能在命令行中指定要编译哪些模块，不能从网络请求来决定编译哪些模块</li>\n<li><a href="https://github.com/liximomo/lazy-compile-webpack-plugin" target="_blank" rel="nofollow noreferrer noopener">lazy-compile-webpack-plugin</a> 基本实现了根据请求来编译对应页面的效果，但请求一个页面会触发多次编译，且二次请求这个页面还会触发编译</li>\n<li><a href="https://github.com/devtreehouse/lazy-build-webpack-plugin" target="_blank" rel="nofollow noreferrer noopener">lazy-build-webpack-plugin</a> 修复以上问题，但在老项目里面运行会出现循环依赖的报错</li>\n<li><a href="https://github.com/towavephone/lazy-build-webpack-plugin" target="_blank" rel="nofollow noreferrer noopener">towavephone/lazy-build-webpack-plugin</a> 修复循环依赖问题</li>\n</ol>\n<h4 id="具体实现"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h4>\n<p>config-overrides.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86625509433467880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const LazyBuildWebpackPlugin = require(\'@towavephone/lazy-build-webpack-plugin\');\n\nconst { LAZY_BUILD } = process.env;\n\n// 默认不开启懒编译\nLAZY_BUILD &&\n   addWebpackPlugin(\n      // 以下三个和热更新有关的三方库会导致页面不停刷新，造成此原因的链接如下\n      // https://github.com/towavephone/lazy-build-webpack-plugin/blob/2a2654f8ea22b015caaef7d5bc961b851f92033d/lib/loaders/entry-loader.js#L15\n      new LazyBuildWebpackPlugin({\n         ignores: [/\\b(react-dev-utils|dev-server|react-refresh-webpack-plugin)\\b/]\n      })\n   );`, `86625509433467880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> LazyBuildWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'@towavephone/lazy-build-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">LAZY_BUILD</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>\n\n<span class="token comment">// 默认不开启懒编译</span>\n<span class="token constant">LAZY_BUILD</span> <span class="token operator">&amp;&amp;</span>\n   <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n      <span class="token comment">// 以下三个和热更新有关的三方库会导致页面不停刷新，造成此原因的链接如下</span>\n      <span class="token comment">// https://github.com/towavephone/lazy-build-webpack-plugin/blob/2a2654f8ea22b015caaef7d5bc961b851f92033d/lib/loaders/entry-loader.js#L15</span>\n      <span class="token keyword">new</span> <span class="token class-name">LazyBuildWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n         ignores<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/\\b(react-dev-utils|dev-server|react-refresh-webpack-plugin)\\b/</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3870791904737203000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 主入口需要加这几行代码，否则懒编译完成后页面不刷新\nif (module.hot) {\n   module.hot.accept();\n}`, `3870791904737203000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 主入口需要加这几行代码，否则懒编译完成后页面不刷新</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="编译效果"><a href="#%E7%BC%96%E8%AF%91%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编译效果</h4>\n<ol>\n<li>懒编译开启前，即全量编译．时长在 3 分钟左右</li>\n<li>懒编译开启后，即单页面编译，随机挑选一个页面，时长在 20 秒左右</li>\n</ol>\n<h4 id="源码解析"><a href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>源码解析</h4>\n<p><a href="https://github.com/towavephone/lazy-build-webpack-plugin" target="_blank" rel="nofollow noreferrer noopener">lazy-build-webpack-plugin</a></p>\n<h3 id="jenkins-编译速度优化"><a href="#jenkins-%E7%BC%96%E8%AF%91%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>jenkins 编译速度优化</h3>\n<p><a href="/jenkins-build-speed-optimize/">原文链接</a></p>\n<h2 id="效果展示"><a href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>效果展示</h2>\n<h3 id="生产环境"><a href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生产环境</h3>\n<p>只算前端编译过程，原来的正在用的前端编译时间 9 分钟</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-12-16-19-27-36-de2a8fcc302e0ca8073efd93a1263a1f-602dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 39.15426781519186%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABaUlEQVQY0yVPi46kIBD0/z9tk03ubnacUQEBFQHxMTx8g8vMdTqVTndXqiqZ9Ktmzbws13Wd3h/+PEOIwxn8fzwi+nM79njyn+V+HnEOV0iuT/lYwb+0rupq3VZtjHWWUGKtNePorC0JMdZEjdgYY9nJyEq0c/00SdWpvmeSFwRyJeWoatHmGLUEYQgZArShbSdaxUXfIYobwXxUZmogjE+vad8P6vjTEry2le/QwrK5Qip/2oigMAQuDB+i3Nos/jjmQ0j0sslhdLOLNtiqno7SQ9aXwhsvlhoPAFiKewgcLTdOTkl2kc8VWXiI5MnOUbnv1bZtWDe3ERS2givLNLmNsBCPwhIgsvsAMkPjHs7NzwSBrt7Ko3GkYVxwbXSmym9+vw/wafC/Lv9qbj/V33RCaX3/w9NbDx4apyP6FumjhyFcyeRWwtrIDNdVLzLSouF3tvWduezyfESlzHNL0MqIf9v+ZG6j7V9Mj7qUsT0QQQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 12 16 19 27 36" title="" data-src="/static/2022-12-16-19-27-36-de2a8fcc302e0ca8073efd93a1263a1f-fee1c.png" data-srcset="/static/2022-12-16-19-27-36-de2a8fcc302e0ca8073efd93a1263a1f-a67b7.png 200w,\n/static/2022-12-16-19-27-36-de2a8fcc302e0ca8073efd93a1263a1f-0b187.png 400w,\n/static/2022-12-16-19-27-36-de2a8fcc302e0ca8073efd93a1263a1f-fee1c.png 800w,\n/static/2022-12-16-19-27-36-de2a8fcc302e0ca8073efd93a1263a1f-b1a91.png 1200w,\n/static/2022-12-16-19-27-36-de2a8fcc302e0ca8073efd93a1263a1f-602dc.png 1277w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>优化缓存过后，分 2 种情况，初次编译完全无缓存的情况下编译时间 8 分钟，第二次有缓存的情况下 3 分钟</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-0f56a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.19047619047619%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABL0lEQVQY01WQDW+DIBCG/f8/b9lWPwoCWhCpiijyUYq7dsmSXd5c7oG7lxzFsmrCqJDD88ygfObzPN/F+dYL8xt/z/8yRHH+j8MdYhAhBrNtZjMhRvB13i96meYpPqK6333wq1lHpQowSTkba7Ux23FMi/4uy1nrbbfbvgOWdb0sWipF+ttuj55zva6DHFtKCzfNinUSozshd0pvtMHXT0Yq3iPRXVtcoearpxUldd1UrK2vzQfFF94h0aMCXpjmZRA8BJ9TYpZfthYdHUuSpqF1fWkwIBSt67Drq71FtiNRkMiLydhhXvWqQ3rAx3RuLHeKHWdZsafCTjRHjz3HXiDIjteWoeMGV6AiPhNsK5X0McD+nZcXS6AbhmkeceCVpShwGGjcy6UEdDeSRpLkD4t/hoHkVqdHAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 12 16 19 28 35" title="" data-src="/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-fee1c.png" data-srcset="/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-a67b7.png 200w,\n/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-0b187.png 400w,\n/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-fee1c.png 800w,\n/static/2022-12-16-19-28-35-ac103b5f8619d4f07254b7bba39ea5e1-0f56a.png 1050w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="开发环境"><a href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>开发环境</h3>\n<p>看自己电脑配置来定，目前本人电脑上前端初次编译 5 分钟，二次编译 2 分钟（不过不建议开启缓存插件，会影响热更新速度且时间长会报错，可通过上面提到的 <code class="language-text">DISABLE_HARD_SOURCE_PLUGIN</code> 关闭）</p>\n<h2 id="后期优化"><a href="#%E5%90%8E%E6%9C%9F%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后期优化</h2>\n<p>后期优化偏向页面加载性能方面，有以下几点可以考虑：</p>\n<ol>\n<li>页面分包优化</li>\n<li>worker.js loader 优化</li>\n<li>不必要的三方库优化</li>\n</ol>\n<h1 id="二期优化"><a href="#%E4%BA%8C%E6%9C%9F%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>二期优化</h1>\n<p>主要升级 cra + webpack5 以及对其他编译工具的调研</p>\n<h2 id="具体功能-1"><a href="#%E5%85%B7%E4%BD%93%E5%8A%9F%E8%83%BD-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体功能</h2>\n<h3 id="cra--webpack5"><a href="#cra--webpack5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cra + webpack5</h3>\n<h4 id="环境变量"><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>环境变量</h4>\n<p>.env</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53072838963219910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`DISABLE_ESLINT_PLUGIN=true\nGENERATE_SOURCEMAP=false\nPORT=3000\nBROWSER=none\n\n# LAZY_BUILD=true\n# DISABLE_CACHE=true\n# DEBUG_CACHE=true`, `53072838963219910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">DISABLE_ESLINT_PLUGIN</span><span class="token operator">=</span>true\n<span class="token assign-left variable">GENERATE_SOURCEMAP</span><span class="token operator">=</span>false\n<span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">3000</span>\n<span class="token assign-left variable">BROWSER</span><span class="token operator">=</span>none\n\n<span class="token comment"># LAZY_BUILD=true</span>\n<span class="token comment"># DISABLE_CACHE=true</span>\n<span class="token comment"># DEBUG_CACHE=true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.env.production</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74655643474197090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`DISABLE_ESLINT_PLUGIN=true\nGENERATE_SOURCEMAP=false\n\n# DISABLE_CACHE=true\nDEBUG_CACHE=true\n# BUNDLE_ANALYZER=true`, `74655643474197090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token assign-left variable">DISABLE_ESLINT_PLUGIN</span><span class="token operator">=</span>true\n<span class="token assign-left variable">GENERATE_SOURCEMAP</span><span class="token operator">=</span>false\n\n<span class="token comment"># DISABLE_CACHE=true</span>\n<span class="token assign-left variable">DEBUG_CACHE</span><span class="token operator">=</span>true\n<span class="token comment"># BUNDLE_ANALYZER=true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="核心配置"><a href="#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心配置</h4>\n<p>config-overrides.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94238004187818200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const {\n   override,\n   addBabelPlugins,\n   fixBabelImports,\n   addLessLoader,\n   removeModuleScopePlugin,\n   setWebpackOptimizationSplitChunks,\n   addWebpackPlugin,\n   addWebpackAlias,\n   adjustStyleLoaders\n} = require(\'customize-cra\');\nconst fs = require(\'fs\');\nconst webpack = require(\'webpack\');\nconst PreloadWebpackPlugin = require(\'preload-webpack-plugin\');\nconst path = require(\'path\');\nconst MonacoWebpackPlugin = require(\'monaco-editor-webpack-plugin\');\nconst WebpackBarPlugin = require(\'webpackbar\');\nconst { get, pick } = require(\'lodash\');\nconst threadLoader = require(\'thread-loader\');\nconst BundleAnalyzerPlugin = require(\'webpack-bundle-analyzer\').BundleAnalyzerPlugin;\n\nconst { LAZY_BUILD, DISABLE_CACHE, DEBUG_CACHE, BUNDLE_ANALYZER } = process.env;\n\nthreadLoader.warmup(\n   {\n      // pool options, like passed to loader options\n      // must match loader options to boot the correct pool\n   },\n   [\n      // modules to load\n      // can be any module, i. e.\n      \'babel-loader\'\n   ]\n);\n\nconst craDir = path.join(process.cwd() + \'/.cra\');\n\nif (!fs.existsSync(craDir)) {\n   fs.mkdirSync(craDir);\n}\n\nconst addBeforeLoaders = (webpackConfig, matchLoader, newLoader = []) => {\n   const matchLoaders = get(webpackConfig, \'module.rules.0.oneOf\', []).filter((item) =>\n      get(item, \'loader\', \'\').includes(matchLoader)\n   );\n   if (matchLoaders.length > 0) {\n      matchLoaders.forEach((item) => {\n         const props = [\'loader\', \'options\'];\n         item.use = [...newLoader, pick(item, props)];\n         props.forEach((item2) => {\n            delete item[item2];\n         });\n      });\n   }\n};\n\nconst formatConfig = (config) =>\n   JSON.stringify(\n      config,\n      (key, value) => {\n         if (typeof value === \'function\') {\n            return value.toString();\n         }\n         return value;\n      },\n      2\n   );\n\nmodule.exports = {\n   webpack: (config, env) => {\n      const isProd = env === \'production\';\n\n      const localConfig = override(\n         addBabelPlugins(\n            [\'@babel/plugin-proposal-nullish-coalescing-operator\'],\n            [\'@babel/plugin-syntax-optional-chaining\']\n         ),\n         fixBabelImports(\'import\', {\n            libraryName: \'antd\',\n            libraryDirectory: \'es\',\n            style: true\n         }),\n         addLessLoader({\n            lessOptions: { javascriptEnabled: true }\n         }),\n         // 适配 cra 下 less-loader 的兼容性问题\n         adjustStyleLoaders(({ use: [, , postcss] }) => {\n            const postcssOptions = postcss.options;\n            postcss.options = { postcssOptions };\n         }),\n         addWebpackAlias({\n            \'@\': path.resolve(__dirname, \'src\')\n         }),\n         removeModuleScopePlugin(),\n         isProd &&\n            setWebpackOptimizationSplitChunks({\n               cacheGroups: {\n                  vendors: {\n                     minChunks: 2,\n                     test: /[\\\\/]node_modules[\\\\/]\\.pnpm[\\\\/](?!google-protobuf|@antv|highcharts|mathjs|two\\.js|konva|victory-core)/,\n                     priority: -10,\n                     reuseExistingChunk: true,\n                     name: \'vendors\'\n                  },\n                  default: {\n                     minChunks: 2,\n                     priority: -20,\n                     reuseExistingChunk: true\n                  }\n               }\n            }),\n         isProd &&\n            addWebpackPlugin(\n               new PreloadWebpackPlugin({\n                  rel: \'prefetch\',\n                  as: \'script\',\n                  fileBlacklist: [\n                     /\\d{1,2}\\.(\\d?[a-z]?)+\\.chunk\\.js\\$/,\n                     /main\\..+\\.js\\$/,\n                     /\\.css\\$/,\n                     /\\.txt\\$/,\n                     /\\.png\\$/,\n                     /.jpeg\\$/,\n                     /.cjs\\$/,\n                     /.svg\\$/,\n                     /.ttf\\$/\n                  ],\n                  include: \'allAssets\'\n               })\n            ),\n         addWebpackPlugin(\n            new MonacoWebpackPlugin({\n               languages: [\'json\']\n            })\n         ),\n         addWebpackPlugin(\n            new webpack.DefinePlugin({\n               \'process.env.BUILD_TOOL\': &quot;\'webpack\'&quot;\n            })\n         ),\n         // 处理 buffer 缺失问题，因为 webpack5 现在默认不导入 nodejs 相关库，需要自行导入\n         addWebpackPlugin(\n            new webpack.ProvidePlugin({\n               Buffer: [\'buffer\', \'Buffer\']\n            })\n         ),\n         BUNDLE_ANALYZER &&\n            addWebpackPlugin(\n               new BundleAnalyzerPlugin({\n                  analyzerPort: 8080,\n                  generateStatsFile: true\n               })\n            ),\n         addWebpackPlugin(new WebpackBarPlugin())\n      )(config);\n\n      addBeforeLoaders(localConfig, \'babel-loader\', [\'thread-loader\']);\n\n      localConfig.resolve.extensions = [\'.js\'];\n      localConfig.resolve.modules = [\'node_modules\'];\n      // 兼容处理\n      localConfig.resolve.fallback = {\n         buffer: require.resolve(\'buffer\')\n      };\n\n      // 懒编译功能，默认关闭\n      if (LAZY_BUILD) {\n         localConfig.experiments = {\n            lazyCompilation: {\n               // disable lazy compilation for dynamic imports\n               imports: true,\n\n               // disable lazy compilation for entries\n               entries: false\n\n               // do not lazily compile moduleB\n               // test: module => !/moduleB/.test(module.nameForCondition())\n            }\n         };\n      } // 开启缓存调试日志，默认关闭，配合环境变量使用\n\n      if (DEBUG_CACHE) {\n         localConfig.infrastructureLogging = {\n            debug: /webpack\\.cache/\n         };\n      } // 是否关闭缓存，默认开启\n\n      if (DISABLE_CACHE) {\n         localConfig.cache = false;\n      }\n\n      if (!isProd) {\n         localConfig.stats = {\n            errors: true,\n            children: false,\n            warnings: false,\n            colors: true,\n            assets: false,\n            modules: false,\n            entrypoints: false,\n            timings: true,\n            builtAt: true,\n            hash: true\n         };\n      } else {\n         const instanceOfMiniCssExtractPlugin = localConfig.plugins.find(\n            (plugin) => plugin.constructor.name === \'MiniCssExtractPlugin\'\n         );\n\n         // 忽略样式导入顺序报错\n         // https://github.com/facebook/create-react-app/issues/5372\n         if (instanceOfMiniCssExtractPlugin) {\n            instanceOfMiniCssExtractPlugin.options.ignoreOrder = true;\n         }\n      }\n\n      fs.writeFileSync(path.join(craDir, \\`webpack.\\${env}.json\\`), formatConfig(localConfig));\n\n      return localConfig;\n   },\n   devServer: (configFunction) => (proxy, allowedHost) => {\n      const config = configFunction(proxy, allowedHost);\n\n      config.allowedHosts = \'all\';\n\n      fs.writeFileSync(path.join(craDir, \'webpack-dev-server.json\'), formatConfig(config));\n\n      return config;\n   }\n};`, `94238004187818200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>\n   override<span class="token punctuation">,</span>\n   addBabelPlugins<span class="token punctuation">,</span>\n   fixBabelImports<span class="token punctuation">,</span>\n   addLessLoader<span class="token punctuation">,</span>\n   removeModuleScopePlugin<span class="token punctuation">,</span>\n   setWebpackOptimizationSplitChunks<span class="token punctuation">,</span>\n   addWebpackPlugin<span class="token punctuation">,</span>\n   addWebpackAlias<span class="token punctuation">,</span>\n   adjustStyleLoaders\n<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'customize-cra\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> PreloadWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'preload-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> MonacoWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'monaco-editor-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> WebpackBarPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpackbar\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">,</span> pick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> threadLoader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'thread-loader\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack-bundle-analyzer\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">LAZY_BUILD</span><span class="token punctuation">,</span> <span class="token constant">DISABLE_CACHE</span><span class="token punctuation">,</span> <span class="token constant">DEBUG_CACHE</span><span class="token punctuation">,</span> <span class="token constant">BUNDLE_ANALYZER</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>\n\nthreadLoader<span class="token punctuation">.</span><span class="token function">warmup</span><span class="token punctuation">(</span>\n   <span class="token punctuation">{</span>\n      <span class="token comment">// pool options, like passed to loader options</span>\n      <span class="token comment">// must match loader options to boot the correct pool</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">[</span>\n      <span class="token comment">// modules to load</span>\n      <span class="token comment">// can be any module, i. e.</span>\n      <span class="token string">\'babel-loader\'</span>\n   <span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> craDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'/.cra\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>craDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>craDir<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">addBeforeLoaders</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig<span class="token punctuation">,</span> matchLoader<span class="token punctuation">,</span> newLoader <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token string">\'module.rules.0.oneOf\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n      <span class="token keyword">get</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">\'loader\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>matchLoader<span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>matchLoaders<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      matchLoaders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'loader\'</span><span class="token punctuation">,</span> <span class="token string">\'options\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n         item<span class="token punctuation">.</span>use <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>newLoader<span class="token punctuation">,</span> <span class="token function">pick</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n         props<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">delete</span> item<span class="token punctuation">[</span>item2<span class="token punctuation">]</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">formatConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>\n      config<span class="token punctuation">,</span>\n      <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token keyword">return</span> value<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token number">2</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token function-variable function">webpack</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> isProd <span class="token operator">=</span> env <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">const</span> localConfig <span class="token operator">=</span> <span class="token function">override</span><span class="token punctuation">(</span>\n         <span class="token function">addBabelPlugins</span><span class="token punctuation">(</span>\n            <span class="token punctuation">[</span><span class="token string">\'@babel/plugin-proposal-nullish-coalescing-operator\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token string">\'@babel/plugin-syntax-optional-chaining\'</span><span class="token punctuation">]</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">\'import\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            libraryName<span class="token punctuation">:</span> <span class="token string">\'antd\'</span><span class="token punctuation">,</span>\n            libraryDirectory<span class="token punctuation">:</span> <span class="token string">\'es\'</span><span class="token punctuation">,</span>\n            style<span class="token punctuation">:</span> <span class="token boolean">true</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addLessLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token comment">// 适配 cra 下 less-loader 的兼容性问题</span>\n         <span class="token function">adjustStyleLoaders</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> postcss<span class="token punctuation">]</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> postcssOptions <span class="token operator">=</span> postcss<span class="token punctuation">.</span>options<span class="token punctuation">;</span>\n            postcss<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> postcssOptions <span class="token punctuation">}</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackAlias</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            <span class="token string">\'@\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'src\'</span><span class="token punctuation">)</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">removeModuleScopePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         isProd <span class="token operator">&amp;&amp;</span>\n            <span class="token function">setWebpackOptimizationSplitChunks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                  vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n                     test<span class="token punctuation">:</span> <span class="token regex">/[\\\\/]node_modules[\\\\/]\\.pnpm[\\\\/](?!google-protobuf|@antv|highcharts|mathjs|two\\.js|konva|victory-core)/</span><span class="token punctuation">,</span>\n                     priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>\n                     reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n                     name<span class="token punctuation">:</span> <span class="token string">\'vendors\'</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                  <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n                     priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>\n                     reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         isProd <span class="token operator">&amp;&amp;</span>\n            <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n               <span class="token keyword">new</span> <span class="token class-name">PreloadWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                  rel<span class="token punctuation">:</span> <span class="token string">\'prefetch\'</span><span class="token punctuation">,</span>\n                  <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token string">\'script\'</span><span class="token punctuation">,</span>\n                  fileBlacklist<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n                     <span class="token regex">/\\d{1,2}\\.(\\d?[a-z]?)+\\.chunk\\.js$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/main\\..+\\.js$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/\\.css$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/\\.txt$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/\\.png$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/.jpeg$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/.cjs$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/.svg$/</span><span class="token punctuation">,</span>\n                     <span class="token regex">/.ttf$/</span>\n                  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n                  include<span class="token punctuation">:</span> <span class="token string">\'allAssets\'</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n            <span class="token keyword">new</span> <span class="token class-name">MonacoWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               languages<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'json\'</span><span class="token punctuation">]</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n            <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               <span class="token string">\'process.env.BUILD_TOOL\'</span><span class="token punctuation">:</span> <span class="token string">"\'webpack\'"</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token comment">// 处理 buffer 缺失问题，因为 webpack5 现在默认不导入 nodejs 相关库，需要自行导入</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n            <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               Buffer<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'buffer\'</span><span class="token punctuation">,</span> <span class="token string">\'Buffer\'</span><span class="token punctuation">]</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token constant">BUNDLE_ANALYZER</span> <span class="token operator">&amp;&amp;</span>\n            <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n               <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                  analyzerPort<span class="token punctuation">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>\n                  generateStatsFile<span class="token punctuation">:</span> <span class="token boolean">true</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebpackBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token function">addBeforeLoaders</span><span class="token punctuation">(</span>localConfig<span class="token punctuation">,</span> <span class="token string">\'babel-loader\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'thread-loader\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'.js\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'node_modules\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token comment">// 兼容处理</span>\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>fallback <span class="token operator">=</span> <span class="token punctuation">{</span>\n         buffer<span class="token punctuation">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'buffer\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 懒编译功能，默认关闭</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LAZY_BUILD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>experiments <span class="token operator">=</span> <span class="token punctuation">{</span>\n            lazyCompilation<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n               <span class="token comment">// disable lazy compilation for dynamic imports</span>\n               imports<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n\n               <span class="token comment">// disable lazy compilation for entries</span>\n               entries<span class="token punctuation">:</span> <span class="token boolean">false</span>\n\n               <span class="token comment">// do not lazily compile moduleB</span>\n               <span class="token comment">// test: module => !/moduleB/.test(module.nameForCondition())</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token comment">// 开启缓存调试日志，默认关闭，配合环境变量使用</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG_CACHE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>infrastructureLogging <span class="token operator">=</span> <span class="token punctuation">{</span>\n            debug<span class="token punctuation">:</span> <span class="token regex">/webpack\\.cache/</span>\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token comment">// 是否关闭缓存，默认开启</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DISABLE_CACHE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span>\n            errors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            children<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            colors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            assets<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            modules<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            entrypoints<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            timings<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            builtAt<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            hash<span class="token punctuation">:</span> <span class="token boolean">true</span>\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> instanceOfMiniCssExtractPlugin <span class="token operator">=</span> localConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>\n            <span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token operator">=></span> plugin<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'MiniCssExtractPlugin\'</span>\n         <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// 忽略样式导入顺序报错</span>\n         <span class="token comment">// https://github.com/facebook/create-react-app/issues/5372</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceOfMiniCssExtractPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            instanceOfMiniCssExtractPlugin<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ignoreOrder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>craDir<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">formatConfig</span><span class="token punctuation">(</span>localConfig<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> localConfig<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">devServer</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">configFunction</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">proxy<span class="token punctuation">,</span> allowedHost</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">configFunction</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> allowedHost<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      config<span class="token punctuation">.</span>allowedHosts <span class="token operator">=</span> <span class="token string">\'all\'</span><span class="token punctuation">;</span>\n\n      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>craDir<span class="token punctuation">,</span> <span class="token string">\'webpack-dev-server.json\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">formatConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> config<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>package.json 只显示增加部分</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25691092865928500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;dependencies&quot;: {\n      &quot;html-webpack-plugin&quot;: &quot;^5.5.0&quot;,\n      &quot;less-loader&quot;: &quot;^11.1.0&quot;,\n      &quot;react-scripts&quot;: &quot;npm:@towavephone/react-scripts@^5.0.3&quot;,\n      &quot;webpack&quot;: &quot;5.78.0&quot;,\n      &quot;webpack-bundle-analyzer&quot;: &quot;^4.7.0&quot;,\n      &quot;webpack-dev-server&quot;: &quot;4.13.2&quot;,\n      &quot;buffer&quot;: &quot;^6.0.3&quot;\n   }\n}`, `25691092865928500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"html-webpack-plugin"</span><span class="token operator">:</span> <span class="token string">"^5.5.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"less-loader"</span><span class="token operator">:</span> <span class="token string">"^11.1.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"react-scripts"</span><span class="token operator">:</span> <span class="token string">"npm:@towavephone/react-scripts@^5.0.3"</span><span class="token punctuation">,</span>\n      <span class="token property">"webpack"</span><span class="token operator">:</span> <span class="token string">"5.78.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"webpack-bundle-analyzer"</span><span class="token operator">:</span> <span class="token string">"^4.7.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"webpack-dev-server"</span><span class="token operator">:</span> <span class="token string">"4.13.2"</span><span class="token punctuation">,</span>\n      <span class="token property">"buffer"</span><span class="token operator">:</span> <span class="token string">"^6.0.3"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="worker-loader-的兼容处理"><a href="#worker-loader-%E7%9A%84%E5%85%BC%E5%AE%B9%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>worker-loader 的兼容处理</h4>\n<p>去掉 worker-loader，使用 <code class="language-text">new Worker(new URL(&#39;worker文件路径&#39;, import.meta.url))</code> 代替</p>\n<h4 id="修复-react-scripts-生产环境缓存"><a href="#%E4%BF%AE%E5%A4%8D-react-scripts-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复 react-scripts 生产环境缓存</h4>\n<p><a href="https://github.com/yicheny/create-react-app/compare/main...towavephone:create-react-app:main" target="_blank" rel="nofollow noreferrer noopener">仓库地址</a></p>\n<p>生产环境下 cra 不能正常生成文件缓存，原因是没有调用 webpack5 的 <code class="language-text">compiler.close</code>，同时需要注意 close 之后需要正常终止</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24385864157778637000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`compiler.close((err) => {\n   if (err && err.message) {\n      console.log(err.message);\n      process.exit(1);\n   }\n\n   process.exit(0);\n});`, `24385864157778637000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">compiler<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>err <span class="token operator">&amp;&amp;</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="运行模板"><a href="#%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%9D%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行模板</h4>\n<p><a href="https://github.com/towavephone/GatsbyBlog/tree/master/template/cra-js-template" target="_blank" rel="nofollow noreferrer noopener">仓库地址</a></p>\n<h4 id="优缺点"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h4>\n<p>相比于一期优化的本地和生产模式编译时间都为 2~3 分钟，优缺点如下</p>\n<ul>\n<li>优点：二次编译速度快，开发模式在 18 秒左右，生产模式在 40 秒左右</li>\n<li>缺点：首次编译速度慢，需要 3~4 分钟</li>\n</ul>\n<h3 id="rspack"><a href="#rspack" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rspack</h3>\n<h4 id="核心配置-1"><a href="#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心配置</h4>\n<p>rspack.config.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6831489852762141000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const path = require(\'path\');\nconst { defineConfig } = require(\'@rspack/cli\');\nconst fs = require(\'fs\');\n// const MonacoWebpackPlugin = require(\'monaco-editor-webpack-plugin\')\n// const NodePolyfill = require(\'@rspack/plugin-node-polyfill\')\n\nconst appDirectory = fs.realpathSync(process.cwd());\nconst resolveApp = (relativePath) => path.resolve(appDirectory, relativePath);\n\nconst dotenv = resolveApp(\'.env\');\n\nconst NODE_ENV = process.env.NODE_ENV;\n// https://github.com/bkeepers/dotenv#what-other-env-files-can-i-use\nconst dotenvFiles = [\n   \\`\\${dotenv}.\\${NODE_ENV}.local\\`,\n   // Don\'t include \\`.env.local\\` for \\`test\\` environment\n   // since normally you expect tests to produce the same\n   // results for everyone\n   NODE_ENV !== \'test\' && \\`\\${dotenv}.local\\`,\n   \\`\\${dotenv}.\\${NODE_ENV}\\`,\n   dotenv\n].filter(Boolean);\n\n// Load environment variables from .env* files. Suppress warnings using silent\n// if this file is missing. dotenv will never modify any environment variables\n// that have already been set.  Variable expansion is supported in .env files.\n// https://github.com/motdotla/dotenv\n// https://github.com/motdotla/dotenv-expand\ndotenvFiles.forEach((dotenvFile) => {\n   if (fs.existsSync(dotenvFile)) {\n      require(\'dotenv-expand\')(\n         require(\'dotenv\').config({\n            path: dotenvFile\n         })\n      );\n   }\n});\n\nconst { DISABLE_OVERLAY } = process.env;\n\nmodule.exports = defineConfig({\n   mode: \'development\',\n   entry: {\n      main: \'./src/index.js\'\n   },\n   builtins: {\n      html: [\n         {\n            template: \'./public/index.html\'\n         }\n      ],\n      pluginImport: [\n         {\n            libraryName: \'antd\',\n            libraryDirectory: \'es\',\n            style: true\n         }\n      ],\n      define: {\n         // \'process.env.NODE_ENV\': &quot;\'development\'&quot;,\n         \'import.meta.env\': &quot;\'development\'&quot;,\n         \'import.meta.env.MODE\': &quot;\'development\'&quot;,\n         \'process.env.NODE_DEBUG\': false,\n         \'process.env.BUILD_TOOL\': &quot;\'rspack\'&quot;\n      }\n   },\n   module: {\n      rules: [\n         {\n            test: /\\.js\\$/,\n            include: /src/,\n            type: \'jsx\'\n         },\n         {\n            test: /\\.less\\$/,\n            exclude: /node_modules/,\n            use: [\n               {\n                  loader: \'less-loader\',\n                  options: {\n                     lessOptions: { javascriptEnabled: true }\n                  }\n               }\n            ],\n            type: \'css/module\'\n         },\n         {\n            test: /\\.less\\$/,\n            include: /node_modules/,\n            use: [\n               {\n                  loader: \'less-loader\',\n                  options: {\n                     lessOptions: { javascriptEnabled: true }\n                  }\n               }\n            ],\n            type: \'css\'\n         },\n         // {\n         //   test: /\\.css\\$/,\n         //   type: \'css\'\n         // },\n         {\n            test: /\\.(png|svg|jpg|jpeg|ttf)\\$/,\n            type: \'asset\'\n         }\n      ]\n   },\n   resolve: {\n      alias: {\n         \'@\': path.resolve(__dirname, \'./src\'),\n         \'antd/es/theme\': false // 修复因 @ant-design/pro-components 导致的编译报错问题\n      },\n      extensions: [\'.js\'],\n      mainFields: [\'main\', \'browser\', \'module\']\n   },\n   // plugins: [\n   //   new MonacoWebpackPlugin({\n   //     languages: [\'json\']\n   //   })\n   //   // new NodePolyfill()\n   // ],\n   devServer: {\n      port: 3000,\n      allowedHosts: \'all\',\n      client: {\n         overlay: !DISABLE_OVERLAY\n      }\n   },\n   devtool: \'source-map\',\n   snapshot: {\n      resolve: {\n         hash: true,\n         timestamp: false\n      },\n      module: {\n         hash: true,\n         timestamp: false\n      }\n   },\n   stats: {\n      preset: \'errors-only\',\n      reasons: true,\n      hash: true,\n      builtAt: true,\n      timings: true\n   },\n   experiments: {\n      incrementalRebuild: true\n   }\n});`, `6831489852762141000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'@rspack/cli\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// const MonacoWebpackPlugin = require(\'monaco-editor-webpack-plugin\')</span>\n<span class="token comment">// const NodePolyfill = require(\'@rspack/plugin-node-polyfill\')</span>\n\n<span class="token keyword">const</span> appDirectory <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">realpathSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token function-variable function">resolveApp</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">relativePath</span><span class="token punctuation">)</span> <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>appDirectory<span class="token punctuation">,</span> relativePath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> dotenv <span class="token operator">=</span> <span class="token function">resolveApp</span><span class="token punctuation">(</span><span class="token string">\'.env\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">NODE_ENV</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">;</span>\n<span class="token comment">// https://github.com/bkeepers/dotenv#what-other-env-files-can-i-use</span>\n<span class="token keyword">const</span> dotenvFiles <span class="token operator">=</span> <span class="token punctuation">[</span>\n   <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dotenv<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">NODE_ENV</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.local</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n   <span class="token comment">// Don\'t include `.env.local` for `test` environment</span>\n   <span class="token comment">// since normally you expect tests to produce the same</span>\n   <span class="token comment">// results for everyone</span>\n   <span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">\'test\'</span> <span class="token operator">&amp;&amp;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dotenv<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.local</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n   <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dotenv<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">NODE_ENV</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n   dotenv\n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Load environment variables from .env* files. Suppress warnings using silent</span>\n<span class="token comment">// if this file is missing. dotenv will never modify any environment variables</span>\n<span class="token comment">// that have already been set.  Variable expansion is supported in .env files.</span>\n<span class="token comment">// https://github.com/motdotla/dotenv</span>\n<span class="token comment">// https://github.com/motdotla/dotenv-expand</span>\ndotenvFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dotenvFile</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>dotenvFile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'dotenv-expand\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>\n         <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'dotenv\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            path<span class="token punctuation">:</span> dotenvFile\n         <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">DISABLE_OVERLAY</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   mode<span class="token punctuation">:</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n   entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      main<span class="token punctuation">:</span> <span class="token string">\'./src/index.js\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   builtins<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      html<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            template<span class="token punctuation">:</span> <span class="token string">\'./public/index.html\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      pluginImport<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            libraryName<span class="token punctuation">:</span> <span class="token string">\'antd\'</span><span class="token punctuation">,</span>\n            libraryDirectory<span class="token punctuation">:</span> <span class="token string">\'es\'</span><span class="token punctuation">,</span>\n            style<span class="token punctuation">:</span> <span class="token boolean">true</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      define<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         <span class="token comment">// \'process.env.NODE_ENV\': "\'development\'",</span>\n         <span class="token string">\'import.meta.env\'</span><span class="token punctuation">:</span> <span class="token string">"\'development\'"</span><span class="token punctuation">,</span>\n         <span class="token string">\'import.meta.env.MODE\'</span><span class="token punctuation">:</span> <span class="token string">"\'development\'"</span><span class="token punctuation">,</span>\n         <span class="token string">\'process.env.NODE_DEBUG\'</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n         <span class="token string">\'process.env.BUILD_TOOL\'</span><span class="token punctuation">:</span> <span class="token string">"\'rspack\'"</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.js$/</span><span class="token punctuation">,</span>\n            include<span class="token punctuation">:</span> <span class="token regex">/src/</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'jsx\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.less$/</span><span class="token punctuation">,</span>\n            exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n               <span class="token punctuation">{</span>\n                  loader<span class="token punctuation">:</span> <span class="token string">\'less-loader\'</span><span class="token punctuation">,</span>\n                  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css/module\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.less$/</span><span class="token punctuation">,</span>\n            include<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n            use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n               <span class="token punctuation">{</span>\n                  loader<span class="token punctuation">:</span> <span class="token string">\'less-loader\'</span><span class="token punctuation">,</span>\n                  options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                     lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">]</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'css\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token comment">// {</span>\n         <span class="token comment">//   test: /\\.css$/,</span>\n         <span class="token comment">//   type: \'css\'</span>\n         <span class="token comment">// },</span>\n         <span class="token punctuation">{</span>\n            test<span class="token punctuation">:</span> <span class="token regex">/\\.(png|svg|jpg|jpeg|ttf)$/</span><span class="token punctuation">,</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'asset\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         <span class="token string">\'@\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'./src\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token string">\'antd/es/theme\'</span><span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// 修复因 @ant-design/pro-components 导致的编译报错问题</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'.js\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'main\'</span><span class="token punctuation">,</span> <span class="token string">\'browser\'</span><span class="token punctuation">,</span> <span class="token string">\'module\'</span><span class="token punctuation">]</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token comment">// plugins: [</span>\n   <span class="token comment">//   new MonacoWebpackPlugin({</span>\n   <span class="token comment">//     languages: [\'json\']</span>\n   <span class="token comment">//   })</span>\n   <span class="token comment">//   // new NodePolyfill()</span>\n   <span class="token comment">// ],</span>\n   devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      port<span class="token punctuation">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>\n      allowedHosts<span class="token punctuation">:</span> <span class="token string">\'all\'</span><span class="token punctuation">,</span>\n      client<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         overlay<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token constant">DISABLE_OVERLAY</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   devtool<span class="token punctuation">:</span> <span class="token string">\'source-map\'</span><span class="token punctuation">,</span>\n   snapshot<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         hash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n         timestamp<span class="token punctuation">:</span> <span class="token boolean">false</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         hash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n         timestamp<span class="token punctuation">:</span> <span class="token boolean">false</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   stats<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      preset<span class="token punctuation">:</span> <span class="token string">\'errors-only\'</span><span class="token punctuation">,</span>\n      reasons<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      hash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      builtAt<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      timings<span class="token punctuation">:</span> <span class="token boolean">true</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   experiments<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      incrementalRebuild<span class="token punctuation">:</span> <span class="token boolean">true</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="运行模板-1"><a href="#%E8%BF%90%E8%A1%8C%E6%A8%A1%E6%9D%BF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行模板</h4>\n<p><a href="https://github.com/towavephone/GatsbyBlog/tree/master/template/rspack-js-template" target="_blank" rel="nofollow noreferrer noopener">仓库地址</a></p>\n<h4 id="优缺点-1"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h4>\n<ul>\n<li>优点：首次编译，hmr 速度快</li>\n<li>缺点：目前只适用于开发环境，主要是还不支持 <code class="language-text">worker-loader</code> 的用法</li>\n</ul>\n<p>由于以上原因，暂时只在开发模式下使用</p>\n<h3 id="vite"><a href="#vite" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vite</h3>\n<h4 id="核心配置-2"><a href="#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心配置</h4>\n<ol>\n<li>index.html 下的 script 脚本需要改成 module 类型</li>\n<li>worker-loader 替换为 <code class="language-text">import Worker from &#39;文件路径?worker&#39;</code></li>\n<li>所有使用 require 的地方替换为 import</li>\n</ol>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37218407713581050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;devDependencies&quot;: {\n      &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,\n      &quot;vite&quot;: &quot;^4.3.1&quot;,\n      &quot;vite-plugin-imp&quot;: &quot;^2.3.1&quot;\n   }\n}`, `37218407713581050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"@vitejs/plugin-react"</span><span class="token operator">:</span> <span class="token string">"^3.1.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"vite"</span><span class="token operator">:</span> <span class="token string">"^4.3.1"</span><span class="token punctuation">,</span>\n      <span class="token property">"vite-plugin-imp"</span><span class="token operator">:</span> <span class="token string">"^2.3.1"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>vite.config.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45044411570774860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { defineConfig } from \'vite\';\nimport react from \'@vitejs/plugin-react\';\nimport fs from \'fs/promises\';\nimport path from \'path\';\nimport vitePluginImp from \'vite-plugin-imp\';\n\nexport default defineConfig({\n   plugins: [react(), vitePluginImp()],\n   css: {\n      preprocessorOptions: {\n         less: {\n            javascriptEnabled: true\n         }\n      }\n   },\n   esbuild: {\n      loader: \'jsx\',\n      include: /src\\/.*\\.js?\\$/,\n      exclude: []\n   },\n   resolve: {\n      alias: [\n         {\n            // 处理 @import \'~antd/es/style/themes/default.less\' 报错\n            find: /^~/,\n            replacement: \'\'\n         },\n         {\n            find: \'@\',\n            replacement: path.resolve(__dirname, \'./src\')\n         }\n      ]\n   },\n   define: {\n      \'import.meta.env\': &quot;\'development\'&quot;,\n      \'process.env.NODE_DEBUG\': false,\n      \'module.hot\': false\n   },\n   server: {\n      port: 3000\n   },\n   optimizeDeps: {\n      esbuildOptions: {\n         plugins: [\n            {\n               name: \'load-js-files-as-jsx\',\n               // 把 js 文件当成 jsx 处理\n               setup(build) {\n                  build.onLoad({ filter: /src\\/.*\\.js\\$/ }, async (args) => ({\n                     loader: \'jsx\',\n                     contents: await fs.readFile(args.path, \'utf8\')\n                  }));\n               }\n            }\n         ]\n      }\n   }\n});`, `45044411570774860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'vite\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">\'@vitejs/plugin-react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">\'fs/promises\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">\'path\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> vitePluginImp <span class="token keyword">from</span> <span class="token string">\'vite-plugin-imp\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">vitePluginImp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n   css<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      preprocessorOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         less<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   esbuild<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      loader<span class="token punctuation">:</span> <span class="token string">\'jsx\'</span><span class="token punctuation">,</span>\n      include<span class="token punctuation">:</span> <span class="token regex">/src\\/.*\\.js?$/</span><span class="token punctuation">,</span>\n      exclude<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      alias<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            <span class="token comment">// 处理 @import \'~antd/es/style/themes/default.less\' 报错</span>\n            find<span class="token punctuation">:</span> <span class="token regex">/^~/</span><span class="token punctuation">,</span>\n            replacement<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            find<span class="token punctuation">:</span> <span class="token string">\'@\'</span><span class="token punctuation">,</span>\n            replacement<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'./src\'</span><span class="token punctuation">)</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   define<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token string">\'import.meta.env\'</span><span class="token punctuation">:</span> <span class="token string">"\'development\'"</span><span class="token punctuation">,</span>\n      <span class="token string">\'process.env.NODE_DEBUG\'</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      <span class="token string">\'module.hot\'</span><span class="token punctuation">:</span> <span class="token boolean">false</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   server<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      port<span class="token punctuation">:</span> <span class="token number">3000</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   optimizeDeps<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      esbuildOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n            <span class="token punctuation">{</span>\n               name<span class="token punctuation">:</span> <span class="token string">\'load-js-files-as-jsx\'</span><span class="token punctuation">,</span>\n               <span class="token comment">// 把 js 文件当成 jsx 处理</span>\n               <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">build</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                  build<span class="token punctuation">.</span><span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token punctuation">{</span> filter<span class="token punctuation">:</span> <span class="token regex">/src\\/.*\\.js$/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n                     loader<span class="token punctuation">:</span> <span class="token string">\'jsx\'</span><span class="token punctuation">,</span>\n                     contents<span class="token punctuation">:</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token string">\'utf8\'</span><span class="token punctuation">)</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="优缺点-2"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h4>\n<ul>\n<li>优点：首次编译速度快</li>\n<li>缺点：此方案初次页面跳转编译速度较慢，而且编译问题较多，同时不太适合生产环境使用</li>\n</ul>\n<p>由于以上原因，不采用此方案</p>\n<h3 id="dockerfile-pnpm-缓存不生效"><a href="#dockerfile-pnpm-%E7%BC%93%E5%AD%98%E4%B8%8D%E7%94%9F%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dockerfile pnpm 缓存不生效</h3>\n<h4 id="需求背景-9"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h4>\n<p>在 jenkins 下运行 docker，缓存不能被使用，因为是跨磁盘（home 目录与 root 目录不在一个磁盘上）的，即 pnpm 不支持硬连接操作，同时 pnpm@7.14.1 也没有对这种情况进行处理，详见 <a href="https://github.com/pnpm/pnpm/releases/tag/v7.14.2" target="_blank" rel="nofollow noreferrer noopener">资料</a></p>\n<h4 id="解决方案-2"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h4>\n<ol>\n<li>升级到 pnpm@7 下的最新版本</li>\n<li>设置缓存路径</li>\n</ol>\n<p>Dockerfile-client-buildkit</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47457059426107890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\n\nFROM node:14-alpine as builder\n\nARG registry=https://registry.npmmirror.com\n\n# 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像\nRUN npm config set registry \\${registry} -g && npm i -g pnpm@7.32.1\n\nWORKDIR /home/\n\n# 缓存 pnpm-lock.yaml\nCOPY pnpm-lock.yaml ./\n\n# 下载依赖到全局位置\nRUN --mount=type=cache,target=/root/.local/share/pnpm/store/v3,id=pnpm_cache \\\n    pnpm fetch --prod\n\n# 复制剩余文件\nCOPY . .\n\n# 安装依赖\nRUN --mount=type=cache,target=node_modules,id=frontend_node_modules,sharing=locked \\\n    --mount=type=cache,target=/root/.local/share/pnpm/store/v3,id=pnpm_cache \\\n    pnpm i --ignore-scripts=true --prod --offline --registry=\\$registry\n\nRUN --mount=type=cache,target=node_modules,id=frontend_node_modules,sharing=locked \\\n    pnpm build\n\nFROM nginx:alpine\n\nRUN --mount=type=bind,target=/tmp/build,from=builder,source=/home/build \\\n    cp -r /tmp/build/* /usr/share/nginx/html/\n\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\n\nEXPOSE 3000`, `47457059426107890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile{8,16,24}"\n              >\n                <span class="gatsby-code-button-language">dockerfile{8,16,24}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n\n<span class="token keyword">FROM</span> node<span class="token punctuation">:</span>14<span class="token punctuation">-</span>alpine as builder\n\n<span class="token keyword">ARG</span> registry=https<span class="token punctuation">:</span>//registry.npmmirror.com\n\n<span class="token comment"># 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">RUN</span> npm config set registry $<span class="token punctuation">{</span>registry<span class="token punctuation">}</span> <span class="token punctuation">-</span>g &amp;&amp; npm i <span class="token punctuation">-</span>g pnpm@7.32.1</span>\n<span class="token keyword">WORKDIR</span> /home/\n\n<span class="token comment"># 缓存 pnpm-lock.yaml</span>\n<span class="token keyword">COPY</span> pnpm<span class="token punctuation">-</span>lock.yaml ./\n\n<span class="token comment"># 下载依赖到全局位置</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/root/.local/share/pnpm/store/v3<span class="token punctuation">,</span>id=pnpm_cache \\</span>    pnpm fetch <span class="token punctuation">-</span><span class="token punctuation">-</span>prod\n\n<span class="token comment"># 复制剩余文件</span>\n<span class="token keyword">COPY</span> . .\n\n<span class="token comment"># 安装依赖</span>\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=node_modules<span class="token punctuation">,</span>id=frontend_node_modules<span class="token punctuation">,</span>sharing=locked \\\n<span class="gatsby-highlight-code-line">    <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/root/.local/share/pnpm/store/v3<span class="token punctuation">,</span>id=pnpm_cache \\</span>    pnpm i <span class="token punctuation">-</span><span class="token punctuation">-</span>ignore<span class="token punctuation">-</span>scripts=true <span class="token punctuation">-</span><span class="token punctuation">-</span>prod <span class="token punctuation">-</span><span class="token punctuation">-</span>offline <span class="token punctuation">-</span><span class="token punctuation">-</span>registry=$registry\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=node_modules<span class="token punctuation">,</span>id=frontend_node_modules<span class="token punctuation">,</span>sharing=locked \\\n    pnpm build\n\n<span class="token keyword">FROM</span> nginx<span class="token punctuation">:</span>alpine\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=bind<span class="token punctuation">,</span>target=/tmp/build<span class="token punctuation">,</span>from=builder<span class="token punctuation">,</span>source=/home/build \\\n    cp <span class="token punctuation">-</span>r /tmp/build/* /usr/share/nginx/html/\n\n<span class="token keyword">COPY</span> nginx.conf /etc/nginx/conf.d/default.conf\n\n<span class="token keyword">EXPOSE</span> 3000</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="效果展示-1"><a href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>效果展示</h2>\n<p>以下都是在二次缓存下的展示，首次编译性能并没有一期优化的性能好</p>\n<h3 id="本地环境"><a href="#%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>本地环境</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79720631230280100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Compiled successfully!\n\nYou can now view in the browser.\n\n  Local:            http://localhost:3000\n  On Your Network:  http://ip:3000\n\nNote that the development build is not optimized.\nTo create a production build, use npm run build.\n\n2023-04-25 16:54:30: webpack 5.78.0 compiled successfully in 18559 ms (c2255578550bc936f958)`, `79720631230280100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">Compiled successfully<span class="token operator">!</span>\n\nYou can now view <span class="token keyword">in</span> the browser.\n\n  Local:            http://localhost:3000\n  On Your Network:  http://ip:3000\n\nNote that the development build is not optimized.\nTo create a production build, use <span class="token function">npm</span> run build.\n\n<span class="token number">2023</span>-04-25 <span class="token number">16</span>:54:30: webpack <span class="token number">5.78</span>.0 compiled successfully <span class="token keyword">in</span> <span class="token number">18559</span> ms <span class="token punctuation">(</span>c2255578550bc936f958<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="生产环境-1"><a href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生产环境</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-04-25-16-58-25-6846f4ecf5de0d69ad7fc8ace49a11a1-a2427.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.995807127882596%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA60lEQVQY0zWO23KEIBBE/f+/y+ayXiIgjMKAchGExN2KIQ+Z6odTNdPT3VzX9fM315GOFJP3IcborMvHUXLRqEMI1rm47xXWdQ0+IGI9MNo0MWVjjHNOagkScNNqRb4ItRltNZeg1DwTImYu/rfTzCtIoxquNmdtjYaMY+bTKUmGLhD+UOKpxgwsTlx3NNCxwPS90AKtJ/xU4sQGN1/71PJzwfEQ09dCD+g8EQ+EZ30HU+LgRrYzUoCVmWZoHRGngmoWyigpU0rDRl+3rt9Z6z5v2PaRVb3ZoTVdL14+dPtuhz7QGnvDe4UhsF8fsxH36JCIMQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 04 25 16 58 25" title="" data-src="/static/2023-04-25-16-58-25-6846f4ecf5de0d69ad7fc8ace49a11a1-fee1c.png" data-srcset="/static/2023-04-25-16-58-25-6846f4ecf5de0d69ad7fc8ace49a11a1-a67b7.png 200w,\n/static/2023-04-25-16-58-25-6846f4ecf5de0d69ad7fc8ace49a11a1-0b187.png 400w,\n/static/2023-04-25-16-58-25-6846f4ecf5de0d69ad7fc8ace49a11a1-fee1c.png 800w,\n/static/2023-04-25-16-58-25-6846f4ecf5de0d69ad7fc8ace49a11a1-b1a91.png 1200w,\n/static/2023-04-25-16-58-25-6846f4ecf5de0d69ad7fc8ace49a11a1-a2427.png 1431w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="后期优化-1"><a href="#%E5%90%8E%E6%9C%9F%E4%BC%98%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后期优化</h2>\n<p>待 rspack 生产环境可用且性能较好的时候考虑迁移</p>\n<h1 id="三期优化"><a href="#%E4%B8%89%E6%9C%9F%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>三期优化</h1>\n<h2 id="具体功能-2"><a href="#%E5%85%B7%E4%BD%93%E5%8A%9F%E8%83%BD-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体功能</h2>\n<h3 id="格式化"><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>格式化</h3>\n<p>需要对老项目的 js 代码格式化，分为 eslint/prettier</p>\n<p>如下可实现 git commit 前只对暂存到 git 的代码进行格式化修复及校验</p>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8926896546259666000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;scripts&quot;: {\n   &quot;eslint&quot;: &quot;npm run eslint:files -- src&quot;,\n   &quot;eslint:files&quot;: &quot;eslint --cache --cache-location node_modules/.cache/.eslintcache --cache-strategy content --ext .js --max-warnings 0&quot;,\n   &quot;fix&quot;: &quot;npm run fix:js&quot;,\n   &quot;fix:js&quot;: &quot;npm run prettier -- --write&quot;,\n   &quot;fl&quot;: &quot;npm run fix && npm run lint&quot;,\n   &quot;lint&quot;: &quot;npm run lint:js&quot;,\n   &quot;lint:js&quot;: &quot;npm run prettier -- --check && npm run eslint&quot;,\n   &quot;lint:js:log2file&quot;: &quot;npm run prettier -- --check && npm run eslint -- -o .cra/eslint-error.log --no-color&quot;,\n   &quot;lint:log2file&quot;: &quot;npm run lint:js:log2file&quot;,\n   &quot;prettier&quot;: &quot;npm run prettier:files -- \'src/**/*.js\'&quot;,\n   &quot;prettier:files&quot;: &quot;prettier --cache --cache-strategy content&quot;\n},\n&quot;husky&quot;: {\n   &quot;hooks&quot;: {\n      &quot;pre-commit&quot;: &quot;node scripts/pre-commit.js&quot;\n   }\n},\n&quot;dependencies&quot;: {\n   &quot;eslint-config-prettier&quot;: &quot;^8.8.0&quot;,\n   &quot;eslint-plugin-eslint-comments&quot;: &quot;^3.2.0&quot;,\n   &quot;prettier&quot;: &quot;^2.8.8&quot;,\n   &quot;confusing-browser-globals&quot;: &quot;^1.0.11&quot;\n},\n&quot;devDependencies&quot;: {\n   &quot;husky&quot;: &quot;^1.0.0-rc.2&quot;,\n   &quot;lint-staged&quot;: &quot;^13.2.2&quot;\n}`, `8926896546259666000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n   <span class="token property">"eslint"</span><span class="token operator">:</span> <span class="token string">"npm run eslint:files -- src"</span><span class="token punctuation">,</span>\n   <span class="token property">"eslint:files"</span><span class="token operator">:</span> <span class="token string">"eslint --cache --cache-location node_modules/.cache/.eslintcache --cache-strategy content --ext .js --max-warnings 0"</span><span class="token punctuation">,</span>\n   <span class="token property">"fix"</span><span class="token operator">:</span> <span class="token string">"npm run fix:js"</span><span class="token punctuation">,</span>\n   <span class="token property">"fix:js"</span><span class="token operator">:</span> <span class="token string">"npm run prettier -- --write"</span><span class="token punctuation">,</span>\n   <span class="token property">"fl"</span><span class="token operator">:</span> <span class="token string">"npm run fix &amp;&amp; npm run lint"</span><span class="token punctuation">,</span>\n   <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"npm run lint:js"</span><span class="token punctuation">,</span>\n   <span class="token property">"lint:js"</span><span class="token operator">:</span> <span class="token string">"npm run prettier -- --check &amp;&amp; npm run eslint"</span><span class="token punctuation">,</span>\n   <span class="token property">"lint:js:log2file"</span><span class="token operator">:</span> <span class="token string">"npm run prettier -- --check &amp;&amp; npm run eslint -- -o .cra/eslint-error.log --no-color"</span><span class="token punctuation">,</span>\n   <span class="token property">"lint:log2file"</span><span class="token operator">:</span> <span class="token string">"npm run lint:js:log2file"</span><span class="token punctuation">,</span>\n   <span class="token property">"prettier"</span><span class="token operator">:</span> <span class="token string">"npm run prettier:files -- \'src/**/*.js\'"</span><span class="token punctuation">,</span>\n   <span class="token property">"prettier:files"</span><span class="token operator">:</span> <span class="token string">"prettier --cache --cache-strategy content"</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token property">"husky"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n   <span class="token property">"hooks"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"pre-commit"</span><span class="token operator">:</span> <span class="token string">"node scripts/pre-commit.js"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n   <span class="token property">"eslint-config-prettier"</span><span class="token operator">:</span> <span class="token string">"^8.8.0"</span><span class="token punctuation">,</span>\n   <span class="token property">"eslint-plugin-eslint-comments"</span><span class="token operator">:</span> <span class="token string">"^3.2.0"</span><span class="token punctuation">,</span>\n   <span class="token property">"prettier"</span><span class="token operator">:</span> <span class="token string">"^2.8.8"</span><span class="token punctuation">,</span>\n   <span class="token property">"confusing-browser-globals"</span><span class="token operator">:</span> <span class="token string">"^1.0.11"</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n   <span class="token property">"husky"</span><span class="token operator">:</span> <span class="token string">"^1.0.0-rc.2"</span><span class="token punctuation">,</span>\n   <span class="token property">"lint-staged"</span><span class="token operator">:</span> <span class="token string">"^13.2.2"</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>scripts/pre-commit.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20100854743534514000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const child_process = require(\'child_process\');\n\nfunction spawn(mainModule) {\n   const worker = child_process.spawn(\'lint-staged\', mainModule, {\n      stdio: \'inherit\'\n   });\n\n   worker.on(\'exit\', function(code) {\n      if (code !== 0) {\n         process.exit(1);\n      }\n   });\n}\n\nspawn([\'--no-stash\']);`, `20100854743534514000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'child_process\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token parameter">mainModule</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> worker <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">\'lint-staged\'</span><span class="token punctuation">,</span> mainModule<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   worker<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'exit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">spawn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'--no-stash\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.eslintrc.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52288239896500355000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const restrictedGlobals = require(\'confusing-browser-globals\');\n\nconst excludeRestrictedGlobals = restrictedGlobals.filter((item) => ![\'self\'].includes(item));\n\n// console.log(\'excludeRestrictedGlobals\', excludeRestrictedGlobals)\n\nmodule.exports = {\n   extends: [\'react-app\', \'prettier\', \'plugin:eslint-comments/recommended\'],\n   // plugins: [\'prettier\'],\n   rules: {\n      // \'prettier/prettier\': 2,\n      \'no-unused-vars\': 2,\n      \'no-restricted-globals\': [\'error\'].concat(excludeRestrictedGlobals),\n      \'no-debugger\': 2,\n      \'eslint-comments/no-use\': [\'error\', { allow: [\'eslint-disable-next-line\'] }]\n   }\n};`, `52288239896500355000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> restrictedGlobals <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'confusing-browser-globals\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> excludeRestrictedGlobals <span class="token operator">=</span> restrictedGlobals<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token string">\'self\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// console.log(\'excludeRestrictedGlobals\', excludeRestrictedGlobals)</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token keyword">extends</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'react-app\'</span><span class="token punctuation">,</span> <span class="token string">\'prettier\'</span><span class="token punctuation">,</span> <span class="token string">\'plugin:eslint-comments/recommended\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token comment">// plugins: [\'prettier\'],</span>\n   rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// \'prettier/prettier\': 2,</span>\n      <span class="token string">\'no-unused-vars\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n      <span class="token string">\'no-restricted-globals\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'error\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>excludeRestrictedGlobals<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token string">\'no-debugger\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n      <span class="token string">\'eslint-comments/no-use\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'error\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> allow<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'eslint-disable-next-line\'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.prettierrc.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57810983170272110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n   arrowParens: \'avoid\',\n   bracketSpacing: true,\n   printWidth: 200,\n   semi: false,\n   singleQuote: true,\n   tabWidth: 2,\n   trailingComma: \'none\',\n   useTabs: false\n};`, `57810983170272110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   arrowParens<span class="token punctuation">:</span> <span class="token string">\'avoid\'</span><span class="token punctuation">,</span>\n   bracketSpacing<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   printWidth<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>\n   semi<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n   singleQuote<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   tabWidth<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n   trailingComma<span class="token punctuation">:</span> <span class="token string">\'none\'</span><span class="token punctuation">,</span>\n   useTabs<span class="token punctuation">:</span> <span class="token boolean">false</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>.lintstagedrc.mjs</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52003889776732200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { ESLint } from \'eslint\';\n\nconst removeIgnoredFiles = async (files) => {\n   const eslint = new ESLint();\n   const isIgnored = await Promise.all(\n      files.map((file) => {\n         return eslint.isPathIgnored(file);\n      })\n   );\n   const filteredFiles = files.filter((_, i) => !isIgnored[i]);\n   return filteredFiles;\n};\n\nexport default {\n   \'src/**/*.js\': async (files) => {\n      let filteredFiles = await removeIgnoredFiles(files);\n\n      if (filteredFiles.length === 0) {\n         return [];\n      }\n\n      // 提交文件超过 20 个的强制检测全部文件\n      if (filteredFiles.length > 20) {\n         filteredFiles = [\'src/**/*.js\'];\n      }\n\n      // console.log(\'filteredFiles\', filteredFiles)\n\n      const filesToLint = filteredFiles.join(\' \');\n      const cmds = [\n         \\`npm run prettier:files -- --write \\${filesToLint}\\`,\n         \\`npm run prettier:files -- --check \\${filesToLint}\\`,\n         \\`npm run eslint:files -- \\${filesToLint}\\`\n      ];\n      // console.log(\'cmds\', cmds)\n      return cmds;\n   }\n};`, `52003889776732200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> ESLint <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'eslint\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">removeIgnoredFiles</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> eslint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ESLint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> isIgnored <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>\n      files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span> eslint<span class="token punctuation">.</span><span class="token function">isPathIgnored</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> filteredFiles <span class="token operator">=</span> files<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span>isIgnored<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> filteredFiles<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n   <span class="token string">\'src/**/*.js\'</span><span class="token punctuation">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> filteredFiles <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">removeIgnoredFiles</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>filteredFiles<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// 提交文件超过 20 个的强制检测全部文件</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>filteredFiles<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         filteredFiles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'src/**/*.js\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// console.log(\'filteredFiles\', filteredFiles)</span>\n\n      <span class="token keyword">const</span> filesToLint <span class="token operator">=</span> filteredFiles<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> cmds <span class="token operator">=</span> <span class="token punctuation">[</span>\n         <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm run prettier:files -- --write </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filesToLint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n         <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm run prettier:files -- --check </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filesToLint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n         <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm run eslint:files -- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filesToLint<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token comment">// console.log(\'cmds\', cmds)</span>\n      <span class="token keyword">return</span> cmds<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="分包策略"><a href="#%E5%88%86%E5%8C%85%E7%AD%96%E7%95%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分包策略</h3>\n<p>config-overrides.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50587576227985880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const {\n   override,\n   addBabelPlugins,\n   fixBabelImports,\n   addLessLoader,\n   removeModuleScopePlugin,\n   setWebpackOptimizationSplitChunks,\n   addWebpackPlugin,\n   addWebpackAlias,\n   adjustStyleLoaders\n} = require(\'customize-cra\');\nconst fs = require(\'fs\');\nconst webpack = require(\'webpack\');\nconst path = require(\'path\');\nconst MonacoWebpackPlugin = require(\'monaco-editor-webpack-plugin\');\nconst WebpackBarPlugin = require(\'webpackbar\');\nconst { get, pick } = require(\'lodash\');\nconst threadLoader = require(\'thread-loader\');\nconst BundleAnalyzerPlugin = require(\'webpack-bundle-analyzer\').BundleAnalyzerPlugin;\n\nconst { LAZY_BUILD, DISABLE_CACHE, DEBUG_CACHE, BUNDLE_ANALYZER, DISABLE_OVERLAY } = process.env;\n\nthreadLoader.warmup(\n   {\n      // pool options, like passed to loader options\n      // must match loader options to boot the correct pool\n   },\n   [\n      // modules to load\n      // can be any module, i. e.\n      \'babel-loader\'\n   ]\n);\n\nconst craDir = path.join(process.cwd() + \'/.cra\');\n\nif (!fs.existsSync(craDir)) {\n   fs.mkdirSync(craDir);\n}\n\nconst getLoaders = (webpackConfig, matcher) => {\n   const matchLoaders = get(webpackConfig, \'module.rules.0.oneOf\', []).filter((item) =>\n      get(item, \'loader\', \'\').includes(matcher)\n   );\n   return matchLoaders;\n};\n\nconst getAssetModules = (webpackConfig, matcher) => {\n   const matchLoaders = get(webpackConfig, \'module.rules.0.oneOf\', []).filter((item) =>\n      get(item, \'type\', \'\').includes(matcher)\n   );\n   return matchLoaders;\n};\n\nconst addBeforeLoaders = (webpackConfig, matcher, newLoader = []) => {\n   const matchLoaders = getLoaders(webpackConfig, matcher);\n   if (matchLoaders.length === 0) {\n      return;\n   }\n\n   matchLoaders.forEach((item) => {\n      const props = [\'loader\', \'options\'];\n      item.use = [...newLoader, pick(item, props)];\n      props.forEach((item2) => {\n         delete item[item2];\n      });\n   });\n};\n\nconst removeAssetDataUrlCondition = (webpackConfig) => {\n   const matchLoaders = getAssetModules(webpackConfig, \'asset\');\n   if (matchLoaders.length === 0) {\n      return;\n   }\n\n   matchLoaders.forEach((item) => {\n      if (!item.parser) {\n         return;\n      }\n      delete item.parser;\n   });\n};\n\nconst formatConfig = (config) =>\n   JSON.stringify(\n      config,\n      (key, value) => {\n         if (typeof value === \'function\') {\n            return value.toString();\n         }\n         return value;\n      },\n      2\n   );\n\nmodule.exports = {\n   webpack: (config, env) => {\n      const isProd = env === \'production\';\n\n      const localConfig = override(\n         addBabelPlugins(\n            [\'@babel/plugin-proposal-nullish-coalescing-operator\'],\n            [\'@babel/plugin-syntax-optional-chaining\']\n         ),\n         fixBabelImports(\'import\', {\n            libraryName: \'antd\',\n            libraryDirectory: \'es\',\n            style: true\n         }),\n         addLessLoader({\n            lessOptions: { javascriptEnabled: true }\n         }),\n         adjustStyleLoaders(({ use: [, , postcss] }) => {\n            const postcssOptions = postcss.options;\n            postcss.options = { postcssOptions };\n         }),\n         addWebpackAlias({\n            \'@\': path.resolve(__dirname, \'src\')\n         }),\n         removeModuleScopePlugin(),\n         isProd &&\n            // 分包原则：首先提取 node_modules 下的所有三方库，然后提取出 src 目录下引用超过 2 次的 chunk，对所有同步、异步包都生效\n            setWebpackOptimizationSplitChunks({\n               chunks: \'all\',\n               maxInitialRequests: 10,\n               minSize: 0,\n               cacheGroups: {\n                  defaultVendors: {\n                     // 抽取三方库\n                     test: (module) => {\n                        return /[\\\\/]node_modules[\\\\/]/.test(module.context);\n                     },\n                     name: (module) => {\n                        // 从后往前匹配 node_modules 后的包名\n                        //\n                        // /frontend/node_modules/.pnpm/@antv+g2plot@2.4.20/node_modules/@antv/g2plot/esm/plots/tiny-column/\n                        // 结果为 @antv\n                        //\n                        // /frontend/node_modules/@antv+g2plot@2.4.20/323\n                        // 结果为 @antv+g2plot@2.4.20\n                        //\n                        // /frontend/node_modules/@antv+g2plot@2.4.20\n                        // 结果为 @antv+g2plot@2.4.20\n                        const matchResult = module.context.match(/(?<=[\\\\/]node_modules[\\\\/])(.*?)(?=([\\\\/]|\\$))/g);\n                        const packageName = matchResult[matchResult.length - 1];\n                        // console.log(\\`packageName: \\${packageName}\\`, module.context)\n                        return \\`pnpm.\\${packageName.replace(/@|\\./g, \'\')}\\`;\n                     },\n                     priority: -10,\n                     reuseExistingChunk: true\n                  },\n                  default: {\n                     // 抽取页面的公共部分\n                     test: (module) => {\n                        // console.log(\'test module.context---------- \', module.context)\n                        return new RegExp(\\`\\${process.cwd()}[\\\\/](src|public)[\\\\/]\\`).test(module.context);\n                     },\n                     name: (module) => {\n                        // console.log(\'name module.context---------- \', module.resourceResolveData.relativePath)\n                        const relativePath = module.resourceResolveData.relativePath\n                           .split(\'/\')\n                           .slice(1)\n                           .join(\'~\');\n                        return relativePath;\n                     },\n                     minChunks: 2,\n                     priority: -20,\n                     reuseExistingChunk: true\n                  }\n               }\n            }),\n         addWebpackPlugin(\n            new MonacoWebpackPlugin({\n               languages: [\'json\']\n            })\n         ),\n         addWebpackPlugin(\n            new webpack.DefinePlugin({\n               \'process.env.BUILD_TOOL\': &quot;\'webpack\'&quot;\n            })\n         ),\n         addWebpackPlugin(\n            new webpack.ProvidePlugin({\n               Buffer: [\'buffer\', \'Buffer\']\n            })\n         ),\n         BUNDLE_ANALYZER &&\n            addWebpackPlugin(\n               new BundleAnalyzerPlugin({\n                  analyzerPort: 8080,\n                  generateStatsFile: true\n               })\n            ),\n         addWebpackPlugin(new WebpackBarPlugin())\n      )(config);\n\n      addBeforeLoaders(localConfig, \'babel-loader\', [\'thread-loader\']);\n      removeAssetDataUrlCondition(localConfig);\n\n      localConfig.resolve.extensions = [\'.js\'];\n      localConfig.resolve.modules = [\'node_modules\'];\n      localConfig.resolve.fallback = {\n         buffer: require.resolve(\'buffer\')\n      };\n\n      if (LAZY_BUILD) {\n         localConfig.experiments = {\n            lazyCompilation: {\n               // disable lazy compilation for dynamic imports\n               imports: true,\n\n               // disable lazy compilation for entries\n               entries: false\n\n               // do not lazily compile moduleB\n               // test: module => !/moduleB/.test(module.nameForCondition())\n            }\n         };\n      }\n\n      if (DEBUG_CACHE) {\n         localConfig.infrastructureLogging = {\n            debug: /webpack\\.cache/\n         };\n      }\n\n      if (DISABLE_CACHE) {\n         localConfig.cache = false;\n      }\n\n      if (!isProd) {\n         localConfig.stats = {\n            errors: true,\n            children: false,\n            warnings: false,\n            colors: true,\n            assets: false,\n            modules: false,\n            entrypoints: false,\n            timings: true,\n            builtAt: true,\n            hash: true\n         };\n      } else {\n         const instanceOfMiniCssExtractPlugin = localConfig.plugins.find(\n            (plugin) => plugin.constructor.name === \'MiniCssExtractPlugin\'\n         );\n\n         // 忽略样式导入顺序报错\n         // https://github.com/facebook/create-react-app/issues/5372\n         if (instanceOfMiniCssExtractPlugin) {\n            instanceOfMiniCssExtractPlugin.options.ignoreOrder = true;\n         }\n\n         localConfig.optimization = {\n            ...localConfig.optimization,\n            nodeEnv: \'production\',\n            sideEffects: true,\n            concatenateModules: true,\n            runtimeChunk: \'single\'\n         };\n      }\n\n      fs.writeFileSync(path.join(craDir, \\`webpack.\\${env}.json\\`), formatConfig(localConfig));\n\n      return localConfig;\n   },\n   devServer: (configFunction) => (proxy, allowedHost) => {\n      const config = configFunction(proxy, allowedHost);\n\n      config.allowedHosts = \'all\';\n\n      if (DISABLE_OVERLAY) {\n         config.client.overlay = false;\n      }\n\n      fs.writeFileSync(path.join(craDir, \'webpack-dev-server.json\'), formatConfig(config));\n\n      return config;\n   }\n};`, `50587576227985880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{121-171,255-261}"\n              >\n                <span class="gatsby-code-button-language">js{121-171,255-261}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span>\n   override<span class="token punctuation">,</span>\n   addBabelPlugins<span class="token punctuation">,</span>\n   fixBabelImports<span class="token punctuation">,</span>\n   addLessLoader<span class="token punctuation">,</span>\n   removeModuleScopePlugin<span class="token punctuation">,</span>\n   setWebpackOptimizationSplitChunks<span class="token punctuation">,</span>\n   addWebpackPlugin<span class="token punctuation">,</span>\n   addWebpackAlias<span class="token punctuation">,</span>\n   adjustStyleLoaders\n<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'customize-cra\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> MonacoWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'monaco-editor-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> WebpackBarPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpackbar\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">,</span> pick <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> threadLoader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'thread-loader\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack-bundle-analyzer\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">LAZY_BUILD</span><span class="token punctuation">,</span> <span class="token constant">DISABLE_CACHE</span><span class="token punctuation">,</span> <span class="token constant">DEBUG_CACHE</span><span class="token punctuation">,</span> <span class="token constant">BUNDLE_ANALYZER</span><span class="token punctuation">,</span> <span class="token constant">DISABLE_OVERLAY</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>\n\nthreadLoader<span class="token punctuation">.</span><span class="token function">warmup</span><span class="token punctuation">(</span>\n   <span class="token punctuation">{</span>\n      <span class="token comment">// pool options, like passed to loader options</span>\n      <span class="token comment">// must match loader options to boot the correct pool</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">[</span>\n      <span class="token comment">// modules to load</span>\n      <span class="token comment">// can be any module, i. e.</span>\n      <span class="token string">\'babel-loader\'</span>\n   <span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> craDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'/.cra\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>craDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>craDir<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getLoaders</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig<span class="token punctuation">,</span> matcher</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token string">\'module.rules.0.oneOf\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n      <span class="token keyword">get</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">\'loader\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>matcher<span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> matchLoaders<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getAssetModules</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig<span class="token punctuation">,</span> matcher</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token string">\'module.rules.0.oneOf\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n      <span class="token keyword">get</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">\'type\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>matcher<span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> matchLoaders<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">addBeforeLoaders</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig<span class="token punctuation">,</span> matcher<span class="token punctuation">,</span> newLoader <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token function">getLoaders</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> matcher<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>matchLoaders<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   matchLoaders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'loader\'</span><span class="token punctuation">,</span> <span class="token string">\'options\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      item<span class="token punctuation">.</span>use <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>newLoader<span class="token punctuation">,</span> <span class="token function">pick</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> props<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      props<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">delete</span> item<span class="token punctuation">[</span>item2<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">removeAssetDataUrlCondition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> matchLoaders <span class="token operator">=</span> <span class="token function">getAssetModules</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token string">\'asset\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>matchLoaders<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   matchLoaders<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">.</span>parser<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">delete</span> item<span class="token punctuation">.</span>parser<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">formatConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>\n      config<span class="token punctuation">,</span>\n      <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token keyword">return</span> value<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token number">2</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token function-variable function">webpack</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> isProd <span class="token operator">=</span> env <span class="token operator">===</span> <span class="token string">\'production\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">const</span> localConfig <span class="token operator">=</span> <span class="token function">override</span><span class="token punctuation">(</span>\n         <span class="token function">addBabelPlugins</span><span class="token punctuation">(</span>\n            <span class="token punctuation">[</span><span class="token string">\'@babel/plugin-proposal-nullish-coalescing-operator\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            <span class="token punctuation">[</span><span class="token string">\'@babel/plugin-syntax-optional-chaining\'</span><span class="token punctuation">]</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">fixBabelImports</span><span class="token punctuation">(</span><span class="token string">\'import\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            libraryName<span class="token punctuation">:</span> <span class="token string">\'antd\'</span><span class="token punctuation">,</span>\n            libraryDirectory<span class="token punctuation">:</span> <span class="token string">\'es\'</span><span class="token punctuation">,</span>\n            style<span class="token punctuation">:</span> <span class="token boolean">true</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addLessLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            lessOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> javascriptEnabled<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">adjustStyleLoaders</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> postcss<span class="token punctuation">]</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> postcssOptions <span class="token operator">=</span> postcss<span class="token punctuation">.</span>options<span class="token punctuation">;</span>\n            postcss<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token punctuation">{</span> postcssOptions <span class="token punctuation">}</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackAlias</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            <span class="token string">\'@\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'src\'</span><span class="token punctuation">)</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">removeModuleScopePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="gatsby-highlight-code-line">         isProd <span class="token operator">&amp;&amp;</span></span><span class="gatsby-highlight-code-line">            <span class="token comment">// 分包原则：首先提取 node_modules 下的所有三方库，然后提取出 src 目录下引用超过 2 次的 chunk，对所有同步、异步包都生效</span></span><span class="gatsby-highlight-code-line">            <span class="token function">setWebpackOptimizationSplitChunks</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">               chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">               maxInitialRequests<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">               minSize<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">               cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                  defaultVendors<span class="token punctuation">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                     <span class="token comment">// 抽取三方库</span></span><span class="gatsby-highlight-code-line">                     <span class="token function-variable function">test</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                        <span class="token keyword">return</span> <span class="token operator">/</span><span class="token punctuation">[</span>\\\\<span class="token regex">/]node_modules[\\\\/]/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">                     <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                     <span class="token function-variable function">name</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// 从后往前匹配 node_modules 后的包名</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">//</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// /frontend/node_modules/.pnpm/@antv+g2plot@2.4.20/node_modules/@antv/g2plot/esm/plots/tiny-column/</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// 结果为 @antv</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">//</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// /frontend/node_modules/@antv+g2plot@2.4.20/323</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// 结果为 @antv+g2plot@2.4.20</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">//</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// /frontend/node_modules/@antv+g2plot@2.4.20</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// 结果为 @antv+g2plot@2.4.20</span></span><span class="gatsby-highlight-code-line">                        <span class="token keyword">const</span> matchResult <span class="token operator">=</span> module<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/(?&lt;=[\\\\/]node_modules[\\\\/])(.*?)(?=([\\\\/]|$))/g</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">                        <span class="token keyword">const</span> packageName <span class="token operator">=</span> matchResult<span class="token punctuation">[</span>matchResult<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// console.log(`packageName: ${packageName}`, module.context)</span></span><span class="gatsby-highlight-code-line">                        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">pnpm.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/@|\\./g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">                     <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                     priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                     reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">                  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                  <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                     <span class="token comment">// 抽取页面的公共部分</span></span><span class="gatsby-highlight-code-line">                     <span class="token function-variable function">test</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// console.log(\'test module.context---------- \', module.context)</span></span><span class="gatsby-highlight-code-line">                        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">[\\\\/](src|public)[\\\\/]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">                     <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                     <span class="token function-variable function">name</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">                        <span class="token comment">// console.log(\'name module.context---------- \', module.resourceResolveData.relativePath)</span></span><span class="gatsby-highlight-code-line">                        <span class="token keyword">const</span> relativePath <span class="token operator">=</span> module<span class="token punctuation">.</span>resourceResolveData<span class="token punctuation">.</span>relativePath</span><span class="gatsby-highlight-code-line">                           <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">                           <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">                           <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'~\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">                        <span class="token keyword">return</span> relativePath<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">                     <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                     minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                     priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">                     reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span></span><span class="gatsby-highlight-code-line">                  <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">               <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n            <span class="token keyword">new</span> <span class="token class-name">MonacoWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               languages<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'json\'</span><span class="token punctuation">]</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n            <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               <span class="token string">\'process.env.BUILD_TOOL\'</span><span class="token punctuation">:</span> <span class="token string">"\'webpack\'"</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n            <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               Buffer<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'buffer\'</span><span class="token punctuation">,</span> <span class="token string">\'Buffer\'</span><span class="token punctuation">]</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span>\n         <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token constant">BUNDLE_ANALYZER</span> <span class="token operator">&amp;&amp;</span>\n            <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span>\n               <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                  analyzerPort<span class="token punctuation">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>\n                  generateStatsFile<span class="token punctuation">:</span> <span class="token boolean">true</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">)</span><span class="token punctuation">,</span>\n         <span class="token function">addWebpackPlugin</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebpackBarPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token function">addBeforeLoaders</span><span class="token punctuation">(</span>localConfig<span class="token punctuation">,</span> <span class="token string">\'babel-loader\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'thread-loader\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">removeAssetDataUrlCondition</span><span class="token punctuation">(</span>localConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'.js\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'node_modules\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      localConfig<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>fallback <span class="token operator">=</span> <span class="token punctuation">{</span>\n         buffer<span class="token punctuation">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'buffer\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LAZY_BUILD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>experiments <span class="token operator">=</span> <span class="token punctuation">{</span>\n            lazyCompilation<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n               <span class="token comment">// disable lazy compilation for dynamic imports</span>\n               imports<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n\n               <span class="token comment">// disable lazy compilation for entries</span>\n               entries<span class="token punctuation">:</span> <span class="token boolean">false</span>\n\n               <span class="token comment">// do not lazily compile moduleB</span>\n               <span class="token comment">// test: module => !/moduleB/.test(module.nameForCondition())</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DEBUG_CACHE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>infrastructureLogging <span class="token operator">=</span> <span class="token punctuation">{</span>\n            debug<span class="token punctuation">:</span> <span class="token regex">/webpack\\.cache/</span>\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DISABLE_CACHE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isProd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         localConfig<span class="token punctuation">.</span>stats <span class="token operator">=</span> <span class="token punctuation">{</span>\n            errors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            children<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            colors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            assets<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            modules<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            entrypoints<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            timings<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            builtAt<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            hash<span class="token punctuation">:</span> <span class="token boolean">true</span>\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> instanceOfMiniCssExtractPlugin <span class="token operator">=</span> localConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>\n            <span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token operator">=></span> plugin<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'MiniCssExtractPlugin\'</span>\n         <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// 忽略样式导入顺序报错</span>\n         <span class="token comment">// https://github.com/facebook/create-react-app/issues/5372</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>instanceOfMiniCssExtractPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            instanceOfMiniCssExtractPlugin<span class="token punctuation">.</span>options<span class="token punctuation">.</span>ignoreOrder <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n\n<span class="gatsby-highlight-code-line">         localConfig<span class="token punctuation">.</span>optimization <span class="token operator">=</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">            <span class="token operator">...</span>localConfig<span class="token punctuation">.</span>optimization<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">            nodeEnv<span class="token punctuation">:</span> <span class="token string">\'production\'</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">            sideEffects<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">            concatenateModules<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">            runtimeChunk<span class="token punctuation">:</span> <span class="token string">\'single\'</span></span><span class="gatsby-highlight-code-line">         <span class="token punctuation">}</span><span class="token punctuation">;</span></span>      <span class="token punctuation">}</span>\n\n      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>craDir<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">webpack.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>env<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">formatConfig</span><span class="token punctuation">(</span>localConfig<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> localConfig<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">devServer</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">configFunction</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">proxy<span class="token punctuation">,</span> allowedHost</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">configFunction</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> allowedHost<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      config<span class="token punctuation">.</span>allowedHosts <span class="token operator">=</span> <span class="token string">\'all\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">DISABLE_OVERLAY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         config<span class="token punctuation">.</span>client<span class="token punctuation">.</span>overlay <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>craDir<span class="token punctuation">,</span> <span class="token string">\'webpack-dev-server.json\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">formatConfig</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> config<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="快速脚本启动"><a href="#%E5%BF%AB%E9%80%9F%E8%84%9A%E6%9C%AC%E5%90%AF%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>快速脚本启动</h3>\n<p>由于前端项目在子目录下面，所以需要在根目录执行命令，方便快速启动本地开发，使用举例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28402980924878963000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pnpm r # 等价于 pnpm r start:rspack 或 cd 前端项目文件夹 && pnpm start:rspack，这里默认使用 rspack，推荐使用，相比 webpack 它的热更新速度很快\npnpm r start # 等价于 cd 前端项目文件夹 && pnpm start\npnpm r i # 等价于 cd 前端项目文件夹 && pnpm i`, `28402980924878963000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">pnpm</span> r <span class="token comment"># 等价于 pnpm r start:rspack 或 cd 前端项目文件夹 &amp;&amp; pnpm start:rspack，这里默认使用 rspack，推荐使用，相比 webpack 它的热更新速度很快</span>\n<span class="token function">pnpm</span> r start <span class="token comment"># 等价于 cd 前端项目文件夹 &amp;&amp; pnpm start</span>\n<span class="token function">pnpm</span> r i <span class="token comment"># 等价于 cd 前端项目文件夹 &amp;&amp; pnpm i</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>相关改动如下：</p>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1465752182330804000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;scripts&quot;: {\n      &quot;r&quot;: &quot;node sim_ui/scripts/run.js&quot;\n   }\n}`, `1465752182330804000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"r"</span><span class="token operator">:</span> <span class="token string">"node sim_ui/scripts/run.js"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>sim_ui/scripts/run.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42604557257215080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shelljs = require(\'shelljs\');\nconst child_process = require(\'child_process\');\nconst argv = require(\'yargs\').argv;\nconst SCRIPT = argv[\'_\'].length > 0 ? argv[\'_\'] : [\'start:rspack\'];\n\nshelljs.cd(\'sim_ui\');\n\nconst worker = child_process.spawn(\'pnpm\', SCRIPT, {\n   stdio: \'inherit\'\n});\n\n// 当接收到终止信号时，终止子进程\nprocess.on(\'SIGINT\', () => {\n   worker.kill(\'SIGINT\');\n});`, `42604557257215080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shelljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> child_process <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'child_process\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'yargs\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>argv<span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token constant">SCRIPT</span> <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token string">\'_\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> argv<span class="token punctuation">[</span><span class="token string">\'_\'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'start:rspack\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\nshelljs<span class="token punctuation">.</span><span class="token function">cd</span><span class="token punctuation">(</span><span class="token string">\'sim_ui\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> worker <span class="token operator">=</span> child_process<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">\'pnpm\'</span><span class="token punctuation">,</span> <span class="token constant">SCRIPT</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n   stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 当接收到终止信号时，终止子进程</span>\nprocess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'SIGINT\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   worker<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token string">\'SIGINT\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="效果展示-2"><a href="#%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>效果展示</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-07-04-15-05-15-1aae8175e7c6797e5518e6b224256e89-0424d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 42.67657992565056%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABIElEQVQoz42RW3OCMBCFea2XqiCItTqd1orKPZEQEGzr//9Pp9nVcXyp5eHMEib5ds9Z6/yuoacRKi/GcZ6hmiWo/RRHP+NaeQny/ifSpw9kvfWt/iWrWQgDjFFMdijdCGoasrQb85kkn4N/QTfgaXlA7SYM/VoVOL1K8D8zHYEJSM06A1sCGBGU7JFtmq72UhxGW8hRADHcMLCLbas0+R1nGRo/NxADNTACErx0IpayQ+SDTbcMz28aPyvFUFK7kLwQaqSvIqgYBt2A7YvA97JgiHJCnkYaq2nPPOyvWfd2H4nuWIW957zIrjLflJcwW6XNyvGW4fd2H4knVJO9yS1BM8+5kqgBbV07EdfSvtTqKnpTjHccRe2mfE8MLov7BTNQ/81VMpNzAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 07 04 15 05 15" title="" data-src="/static/2023-07-04-15-05-15-1aae8175e7c6797e5518e6b224256e89-fee1c.png" data-srcset="/static/2023-07-04-15-05-15-1aae8175e7c6797e5518e6b224256e89-a67b7.png 200w,\n/static/2023-07-04-15-05-15-1aae8175e7c6797e5518e6b224256e89-0b187.png 400w,\n/static/2023-07-04-15-05-15-1aae8175e7c6797e5518e6b224256e89-fee1c.png 800w,\n/static/2023-07-04-15-05-15-1aae8175e7c6797e5518e6b224256e89-b1a91.png 1200w,\n/static/2023-07-04-15-05-15-1aae8175e7c6797e5518e6b224256e89-0424d.png 1345w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-07-04-15-08-47-cc14aa594a380d489615e7dd7ec656b9-1f825.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 552px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABk0lEQVQoz1WP227aUBBFeWlL2qQEmhBR7ldxMcY2xgZjJwYMpIBNmgDq7an//w+rU6dC6sPWnjlztGZ2wiwbjCstRtkmS3H3rs0orWKmOqIuVlqJayvdw8ooGFdt1GRd1DhrcNFAe1+PPeG3Hoh6Jn6hx2NzyKpu8KQ6BFWdtfS7js2saMi7xaZtE1T6mB+rjFK1WONMDfOqfoYmFNk4TuWZfCphXxexUkXG6bx8LkpfiKVdlDEuSwIq4dyUsdN/QdVYbvYVfgZqWU02z1i3fLnCwy+NmVecWKGyJKi5jK67cVT9Q4vem9p/cdVk8x/sVQk9N+BgfCFSFhLZ46u2FndZ16cS2eVFZquaE8+2HZ/7zwZaUqDv5KrYq3Hdf1uhL3XCbrn8Dn9w8vf8XB44zfZ8Xzxzuo/4Nn/i+BCyGwYcvS3P7oZfqwPb4YxpYcAo02Wa07BvFLy8iXPbF2DZJdTmbPozQn3JcRqyN1fMGxMiPWCnLYiGSyIjYNWe4haHeGWTSU7FEpCbN3DuVCa3KrYs+AMFgtdNtYO+3wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 07 04 15 08 47" title="" data-src="/static/2023-07-04-15-08-47-cc14aa594a380d489615e7dd7ec656b9-1f825.png" data-srcset="/static/2023-07-04-15-08-47-cc14aa594a380d489615e7dd7ec656b9-632a9.png 200w,\n/static/2023-07-04-15-08-47-cc14aa594a380d489615e7dd7ec656b9-cac39.png 400w,\n/static/2023-07-04-15-08-47-cc14aa594a380d489615e7dd7ec656b9-1f825.png 552w" data-sizes="(max-width: 552px) 100vw, 552px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2023-07-04-15-09-21-bad87ebfe810ab507ef7d63a77d61f3e-eb534.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 113.67061356297093%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAADsUlEQVQ4y11Va3PbNhDkv27s2I3k/MB+60zbWJYovknw/Ral7S4gOZlo5uYo3OGwt3sgvf3bDrvdN7y+vmC/3+H79zfs6L++vOCPpye8/vlqY8/PT85/fcYL/SN//7bHN8W+fLExr0lSDP2AcZzQ0OdlhbPpEaQG57xGnBsUVW3Xy6ZD3fVoh5G5IzruscZ90zQjbyd4Bz/EOYwQxgkiFv/nxwGHU4B/3w/47/CB9+MJfhjjGKU4BcyNEsRZjpC5AffIksLwsBZF3cD766PA6XS0mwyRVAzI6razvunouxF/B0TOgipQMdb0PWPO6s7lVm0LLylKJLnMIExzRLQgyYjgYfnns43FKc60KM1c3m/5XmwaBFmJuKhQtMPdxru5Z0OfNwO9WzP3NT2X3c81ea8U4VmGjrB7tjGOI+Zpsv8v64qavFwuFzRNg2VZ7PpAUZT3WKuqCuu6MLeGV1QtttsVNwDX6w2XbcO2Xa3/1a63G/qBSCUAQVwuG37/3ZjjReEZMfmQckleoL6LIuUlkmLyUruRSCS+pSibPXiz6K/Xq0XcsUNvqEL4vg9Tlpjn2bbp2qix0tdsayIFURSz1QEZD9bMCs1yzxVatZ1wlLy+ijgOAQpTWk60WUk6QF6IdHp4L6iDtP7rb2VhcZtRC68vA/jnABnbzfLcFlCCCorolom6BcppGVPhiuQ/OJPxyR5SFAW8zgT4OB4RE64hSqEQSpEvCoRaqp5IS88rpuFWTPw9ipbLZvclSQJvrOPPlmWGd1aFNC62FRKt/1EUoZtWFJMm4fqJ7kZBNpoKFsY4hP75bFvOCbng6RoPoRVSka1ktayXQEOFR65L3XmhKBe2u90wrxtK0mQRRrHjRbwNFEDtPAZaIzKTn4h3WPyGHKeAaEMZr+B7WOAj4Tugm1DzcIvQtWwsOhVUi0KoG6ODhFCFpLZQT9NoQUgkcV+wu2WebNzNIdtRuyVPeMxWSS7lncoTAhbUf/Eq00SoQEYQVVljEwUEYsfmePKRcmCFcr0XFEJb8M6ZDtWGRzxJU4s85tvGmIr0rK5gV4YciTNywlZRoRQiFXdj01oaVPAx9PIxOXUFM1LlZlbr3kBRRLDlUMreUYg7edsy1zTQ7pq51lLeCvvaZ7GqaqyQituWJYoS7P1dHXR79TSPGmwiDDjQQiAk8zwiVctct98c2rLMTpQs5feCLZ/Ykk/idQsKCqLvi55Fuobd1w0xNd/Usgo/TglMxjj3lRSl14eLn4P/ATquv1jYwePvAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2023 07 04 15 09 21" title="" data-src="/static/2023-07-04-15-09-21-bad87ebfe810ab507ef7d63a77d61f3e-fee1c.png" data-srcset="/static/2023-07-04-15-09-21-bad87ebfe810ab507ef7d63a77d61f3e-a67b7.png 200w,\n/static/2023-07-04-15-09-21-bad87ebfe810ab507ef7d63a77d61f3e-0b187.png 400w,\n/static/2023-07-04-15-09-21-bad87ebfe810ab507ef7d63a77d61f3e-fee1c.png 800w,\n/static/2023-07-04-15-09-21-bad87ebfe810ab507ef7d63a77d61f3e-eb534.png 929w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="四期优化"><a href="#%E5%9B%9B%E6%9C%9F%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>四期优化</h1>\n<h2 id="解决镜像源不能访问"><a href="#%E8%A7%A3%E5%86%B3%E9%95%9C%E5%83%8F%E6%BA%90%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决镜像源不能访问</h2>\n<p>由于国外 docker 源被屏蔽，上面的 dockerfile 在构建镜像过程中会 404，需要修改为国内镜像源，修改如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53688107477552260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# syntax = docker/dockerfile:experimental\n\n# 必须都指定\nARG docker_registry=m.daocloud.io/docker.io\n\nFROM \\${docker_registry}/node:14-alpine as builder\n\nARG npm_registry=https://registry.npmmirror.com\n\n# 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像\nRUN npm config set registry \\${npm_registry} -g && npm i -g pnpm@7.32.1\n\nWORKDIR /home/\n\n# 缓存 pnpm-lock.yaml\nCOPY pnpm-lock.yaml ./\n\n# 下载依赖到全局位置\nRUN --mount=type=cache,target=/root/.local/share/pnpm/store/v3,id=pnpm_cache \\\n    pnpm fetch --prod\n\n# 缓存依赖\nCOPY package.json ./\n\n# 安装依赖\nRUN --mount=type=cache,target=node_modules,id=frontend_node_modules,sharing=locked \\\n    --mount=type=cache,target=/root/.local/share/pnpm/store/v3,id=pnpm_cache \\\n    pnpm i --ignore-scripts=true --prod --offline --registry=\\$npm_registry\n\n# 复制剩余文件\nCOPY . .\n\nRUN --mount=type=cache,target=node_modules,id=frontend_node_modules,sharing=locked \\\n    pnpm lint && pnpm build\n\n# 必须都指定\nARG docker_registry=https://docker.m.daocloud.io\n\nFROM \\${docker_registry}/nginx:alpine\n\nRUN --mount=type=bind,target=/tmp/build,from=builder,source=/home/build \\\n    cp -r /tmp/build/* /usr/share/nginx/html/\n\nCOPY nginx.conf /etc/nginx/conf.d/default.conf\n\nEXPOSE 3000`, `53688107477552260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="dockerfile{4-6,37-39}"\n              >\n                <span class="gatsby-code-button-language">dockerfile{4-6,37-39}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="dockerfile"><pre style="counter-reset: linenumber NaN" class="language-dockerfile line-numbers"><code class="language-dockerfile"><span class="token comment"># syntax = docker/dockerfile:experimental</span>\n\n<span class="token comment"># 必须都指定</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">ARG</span> docker_registry=m.daocloud.io/docker.io</span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"><span class="token keyword">FROM</span> $<span class="token punctuation">{</span>docker_registry<span class="token punctuation">}</span>/node<span class="token punctuation">:</span>14<span class="token punctuation">-</span>alpine as builder</span>\n<span class="token keyword">ARG</span> npm_registry=https<span class="token punctuation">:</span>//registry.npmmirror.com\n\n<span class="token comment"># 全局安装依赖，尽量写在一行防止加了新库之后还是使用原来的镜像</span>\n<span class="token keyword">RUN</span> npm config set registry $<span class="token punctuation">{</span>npm_registry<span class="token punctuation">}</span> <span class="token punctuation">-</span>g &amp;&amp; npm i <span class="token punctuation">-</span>g pnpm@7.32.1\n\n<span class="token keyword">WORKDIR</span> /home/\n\n<span class="token comment"># 缓存 pnpm-lock.yaml</span>\n<span class="token keyword">COPY</span> pnpm<span class="token punctuation">-</span>lock.yaml ./\n\n<span class="token comment"># 下载依赖到全局位置</span>\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/root/.local/share/pnpm/store/v3<span class="token punctuation">,</span>id=pnpm_cache \\\n    pnpm fetch <span class="token punctuation">-</span><span class="token punctuation">-</span>prod\n\n<span class="token comment"># 缓存依赖</span>\n<span class="token keyword">COPY</span> package.json ./\n\n<span class="token comment"># 安装依赖</span>\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=node_modules<span class="token punctuation">,</span>id=frontend_node_modules<span class="token punctuation">,</span>sharing=locked \\\n    <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=/root/.local/share/pnpm/store/v3<span class="token punctuation">,</span>id=pnpm_cache \\\n    pnpm i <span class="token punctuation">-</span><span class="token punctuation">-</span>ignore<span class="token punctuation">-</span>scripts=true <span class="token punctuation">-</span><span class="token punctuation">-</span>prod <span class="token punctuation">-</span><span class="token punctuation">-</span>offline <span class="token punctuation">-</span><span class="token punctuation">-</span>registry=$npm_registry\n\n<span class="token comment"># 复制剩余文件</span>\n<span class="token keyword">COPY</span> . .\n\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=cache<span class="token punctuation">,</span>target=node_modules<span class="token punctuation">,</span>id=frontend_node_modules<span class="token punctuation">,</span>sharing=locked \\\n    pnpm lint &amp;&amp; pnpm build\n\n<span class="token comment"># 必须都指定</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">ARG</span> docker_registry=https<span class="token punctuation">:</span>//docker.m.daocloud.io</span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"><span class="token keyword">FROM</span> $<span class="token punctuation">{</span>docker_registry<span class="token punctuation">}</span>/nginx<span class="token punctuation">:</span>alpine</span>\n<span class="token keyword">RUN</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>mount=type=bind<span class="token punctuation">,</span>target=/tmp/build<span class="token punctuation">,</span>from=builder<span class="token punctuation">,</span>source=/home/build \\\n    cp <span class="token punctuation">-</span>r /tmp/build/* /usr/share/nginx/html/\n\n<span class="token keyword">COPY</span> nginx.conf /etc/nginx/conf.d/default.conf\n\n<span class="token keyword">EXPOSE</span> 3000</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CRA 项目构建速度优化/index.md absPath of file >>> MarkdownRemark",timeToRead:34,frontmatter:{date:"2022-12-16 17:34:33",path:"/cra-project-build-speed-optimize/",tags:"前端, webpack, Docker, 预研, rspack, 前端构建工具",title:"CRA 项目构建速度优化",draft:null}},{excerpt:"需求背景 完成官网 1.0 的上线，实现动效、国际化、多平台适配等功能 动效 逐行显示 需求背景 实现功能如下： x 旋转 -> 不同文字由下而上透明度从 0 到 1 实现要点如下： 进入视口执行一次 离开视口重置动画 实现如下所示动效： 选型过程 选型 优点 缺点 react-spring 使用方便，基于弹簧物理的动画库 改变 state 会导致多次执行 不能自由控制播放进度 animate.css 原生方法体积小，提供回退兼容性好 使用较为繁琐，需要同时写 css、js gsap…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>完成官网 1.0 的上线，实现动效、国际化、多平台适配等功能</p>\n<h1 id="动效"><a href="#%E5%8A%A8%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>动效</h1>\n<h2 id="逐行显示"><a href="#%E9%80%90%E8%A1%8C%E6%98%BE%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>逐行显示</h2>\n<h3 id="需求背景-1"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>实现功能如下：</p>\n<p>x 旋转 -> 不同文字由下而上透明度从 0 到 1</p>\n<p>实现要点如下：</p>\n<ol>\n<li>进入视口执行一次</li>\n<li>离开视口重置动画</li>\n</ol>\n<p>实现如下所示动效：</p>\n<p><html><head></head><body><video data-src="/examples/international-official-website-technical-difficulties/line-by-line-display.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></video></p>\n<h3 id="选型过程"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h3>\n<table>\n<thead>\n<tr>\n<th align="left">选型</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><a href="https://github.com/pmndrs/react-spring" target="_blank" rel="nofollow noreferrer noopener">react-spring</a></td>\n<td align="left">使用方便，基于弹簧物理的动画库</td>\n<td align="left"><ol>\n<li>\n改变 state 会导致多次执行\n</li>\n<li>\n不能自由控制播放进度\n</li>\n</ol></td>\n</tr>\n<tr>\n<td align="left"><a href="https://animate.style/" target="_blank" rel="nofollow noreferrer noopener">animate.css</a></td>\n<td align="left">原生方法体积小，提供回退兼容性好</td>\n<td align="left">使用较为繁琐，需要同时写 css、js</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/greensock/GSAP" target="_blank" rel="nofollow noreferrer noopener">gsap</a></td>\n<td align="left"><ol>\n<li>\n可控制播放进度或自动播放，可配合之后提到的 react-scrollmagic 实现动效进度控制\n</li>\n<li>\n示例丰富，可实现很多动效\n</li>\n</ol></td>\n<td align="left">api 过于原始，需要封装</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/bitworking/react-gsap" target="_blank" rel="nofollow noreferrer noopener">react-gsap</a></td>\n<td align="left">除了以上优点，可直接在 react 中使用</td>\n<td align="left">有些 gsap 动效不能直接在 react-gsap 中使用，比如说和 react-scrollmagic 相同的效果</td>\n</tr>\n</tbody>\n</table>\n<h3 id="核心代码"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<h4 id="react-spring"><a href="#react-spring" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-spring</h4>\n<p>最初采用 react-spring 版本，主要实现了如下功能</p>\n<ol>\n<li>react-spring 时间序列化（react-spring ref delay）</li>\n<li>useContext 全局控制，实现 react-spring 的反向动画</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16907787208010007000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { CSSProperties, ReactNode, Children, useRef, useEffect, useContext } from \'react\';\nimport classnames from \'classnames\';\nimport { a, useTransition, useSpringRef, useSpring } from \'@react-spring/web\';\nimport { useInViewport } from \'ahooks\';\n\nimport XIcon from \'@/components/xIcon\';\nimport ConfigContext from \'@/components/layout/configContext\';\n\nimport { delayFunc } from \'@/utils\';\n\nimport PageStyles from \'./index.module.less\';\n\nexport interface AnimationTitleProps {\n   className?: string;\n   title?: ReactNode;\n   subTitle?: ReactNode;\n   closeIcon?: ReactNode;\n   delay?: number;\n   style?: CSSProperties;\n   animation?: boolean;\n   isOnce?: boolean;\n}\n\ntype TransitionProps = Parameters<typeof useTransition>[1];\n\nconst AnimationTitle = ({\n   className,\n   title,\n   subTitle,\n   closeIcon = <XIcon name=\'title-x\' />,\n   delay = 300,\n   style,\n   animation = true,\n   isOnce = false\n}: AnimationTitleProps) => {\n   const { isRunMultiTime } = useContext(ConfigContext);\n\n   const closeIconRef = useSpringRef();\n   const closeIconStyle = useSpring({\n      ref: closeIconRef,\n      from: {\n         opacity: 0,\n         rotate: -100\n      },\n      to: {\n         rotate: 0,\n         opacity: 1\n      }\n   });\n\n   const titleRef = useSpringRef();\n   const titleStyle = useSpring({\n      ref: titleRef,\n      from: {\n         scale: 0,\n         opacity: 0\n      },\n      to: {\n         scale: 1,\n         opacity: 1\n      },\n      config: {\n         tension: 100,\n         friction: 14\n      }\n   });\n\n   const renderSubTitle: ReactNode[] = Children.map(Children.toArray(subTitle), (child, index) => {\n      if (typeof child === \'string\') {\n         return <div key={index}>{child}</div>;\n      }\n      return child;\n   });\n\n   const subTitleRef = useSpringRef();\n   const transitionProps: TransitionProps = {\n      from: {\n         opacity: 0,\n         y: 50\n      },\n      enter: (msg, i) => ({\n         delay: () => {\n            return i * 400;\n         },\n         to: {\n            opacity: 1,\n            y: 0\n         }\n      }),\n      ref: subTitleRef\n   };\n\n   if (!isRunMultiTime || isOnce) {\n      transitionProps.keys = (item: { key: any }) => item.key;\n   }\n\n   const transitions = useTransition(renderSubTitle, transitionProps);\n\n   const domRef = useRef<HTMLDivElement>(null);\n   const [inViewPort] = useInViewport(domRef);\n   useEffect(() => {\n      const startAnimation = async () => {\n         await delayFunc(delay);\n         if (closeIcon) {\n            closeIconRef.start();\n         }\n         if (title) {\n            await Promise.all(titleRef.start());\n         }\n         if (subTitle) {\n            await Promise.all(subTitleRef.start());\n         }\n      };\n\n      const reverseAnimation = () => {\n         [closeIconRef, titleRef, subTitleRef].forEach((item) => {\n            item.start({\n               reverse: true\n            });\n         });\n      };\n\n      if (inViewPort) {\n         startAnimation();\n      } else if (isRunMultiTime && !isOnce) {\n         reverseAnimation();\n      }\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, [inViewPort, isOnce, title, subTitle]);\n\n   const getStyle = (style: any) => (animation ? style : undefined);\n\n   return (\n      <div ref={domRef} className={classnames(PageStyles.textDisplay, \'text-display\', className)} style={style}>\n         {closeIcon && (\n            <a.div style={getStyle(closeIconStyle)} className={classnames(PageStyles.closeIcon, \'close-icon\')}>\n               {closeIcon}\n            </a.div>\n         )}\n         {title && (\n            <a.div style={getStyle(titleStyle)} className={classnames(PageStyles.title, \'text-display-title\')}>\n               {title}\n            </a.div>\n         )}\n         {subTitle && (\n            <div className={classnames(PageStyles.subTitleContainer, \'text-display-sub-title-container\')}>\n               {transitions((style, item: any) => {\n                  return (\n                     <a.div\n                        style={getStyle(style)}\n                        className={classnames(PageStyles.subTitle, \'text-display-sub-title\')}\n                     >\n                        {item}\n                     </a.div>\n                  );\n               })}\n            </div>\n         )}\n      </div>\n   );\n};\n\nexport default AnimationTitle;`, `16907787208010007000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> CSSProperties<span class="token punctuation">,</span> ReactNode<span class="token punctuation">,</span> Children<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> classnames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> useTransition<span class="token punctuation">,</span> useSpringRef<span class="token punctuation">,</span> useSpring <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@react-spring/web\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useInViewport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> XIcon <span class="token keyword">from</span> <span class="token string">\'@/components/xIcon\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> ConfigContext <span class="token keyword">from</span> <span class="token string">\'@/components/layout/configContext\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> delayFunc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> PageStyles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AnimationTitleProps</span> <span class="token punctuation">{</span>\n   className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   title<span class="token operator">?</span><span class="token punctuation">:</span> ReactNode<span class="token punctuation">;</span>\n   subTitle<span class="token operator">?</span><span class="token punctuation">:</span> ReactNode<span class="token punctuation">;</span>\n   closeIcon<span class="token operator">?</span><span class="token punctuation">:</span> ReactNode<span class="token punctuation">;</span>\n   delay<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   style<span class="token operator">?</span><span class="token punctuation">:</span> CSSProperties<span class="token punctuation">;</span>\n   animation<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   isOnce<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> TransitionProps <span class="token operator">=</span> Parameters<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeof</span> <span class="token attr-name">useTransition</span><span class="token punctuation">></span></span><span class="token plain-text">[1];\n\nconst AnimationTitle = (</span><span class="token punctuation">{</span>\n   className<span class="token punctuation">,</span>\n   title<span class="token punctuation">,</span>\n   subTitle<span class="token punctuation">,</span>\n   closeIcon <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XIcon</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>title-x<span class="token punctuation">\'</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>\n   delay <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span>\n   style<span class="token punctuation">,</span>\n   animation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   isOnce <span class="token operator">=</span> <span class="token boolean">false</span>\n<span class="token punctuation">}</span><span class="token plain-text">: AnimationTitleProps) => </span><span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> isRunMultiTime <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ConfigContext<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> closeIconRef <span class="token operator">=</span> <span class="token function">useSpringRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> closeIconStyle <span class="token operator">=</span> <span class="token function">useSpring</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      ref<span class="token punctuation">:</span> closeIconRef<span class="token punctuation">,</span>\n      <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         opacity<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n         rotate<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">100</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      to<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         rotate<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n         opacity<span class="token punctuation">:</span> <span class="token number">1</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> titleRef <span class="token operator">=</span> <span class="token function">useSpringRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> titleStyle <span class="token operator">=</span> <span class="token function">useSpring</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      ref<span class="token punctuation">:</span> titleRef<span class="token punctuation">,</span>\n      <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         scale<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n         opacity<span class="token punctuation">:</span> <span class="token number">0</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      to<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         scale<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n         opacity<span class="token punctuation">:</span> <span class="token number">1</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      config<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         tension<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>\n         friction<span class="token punctuation">:</span> <span class="token number">14</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> renderSubTitle<span class="token punctuation">:</span> ReactNode<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Children<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>subTitle<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">child<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> child <span class="token operator">===</span> <span class="token string">\'string\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>child<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> child<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> subTitleRef <span class="token operator">=</span> <span class="token function">useSpringRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> transitionProps<span class="token punctuation">:</span> TransitionProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         opacity<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n         y<span class="token punctuation">:</span> <span class="token number">50</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">enter</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n         <span class="token function-variable function">delay</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> i <span class="token operator">*</span> <span class="token number">400</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         to<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            opacity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n            y<span class="token punctuation">:</span> <span class="token number">0</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      ref<span class="token punctuation">:</span> subTitleRef\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRunMultiTime <span class="token operator">||</span> isOnce<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      transitionProps<span class="token punctuation">.</span><span class="token function-variable function">keys</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">:</span> <span class="token punctuation">{</span> key<span class="token punctuation">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>key<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">const</span> transitions <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span>renderSubTitle<span class="token punctuation">,</span> transitionProps<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> domRef <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLDivElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">(null);\n   const [inViewPort] = useInViewport(domRef);\n   useEffect(() => </span><span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token function-variable function">startAnimation</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">await</span> <span class="token function">delayFunc</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>closeIcon<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            closeIconRef<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>titleRef<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>subTitle<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>subTitleRef<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">const</span> <span class="token function-variable function">reverseAnimation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token punctuation">[</span>closeIconRef<span class="token punctuation">,</span> titleRef<span class="token punctuation">,</span> subTitleRef<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            item<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n               reverse<span class="token punctuation">:</span> <span class="token boolean">true</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>inViewPort<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token function">startAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isRunMultiTime <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isOnce<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token function">reverseAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n   <span class="token punctuation">}</span><span class="token plain-text">, [inViewPort, isOnce, title, subTitle]);\n\n   const getStyle = (style: any) => (animation ? style : undefined);\n\n   return (\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>domRef<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>textDisplay<span class="token punctuation">,</span> <span class="token string">\'text-display\'</span><span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token punctuation">{</span>closeIcon <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a.div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getStyle</span><span class="token punctuation">(</span>closeIconStyle<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>closeIcon<span class="token punctuation">,</span> <span class="token string">\'close-icon\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n               </span><span class="token punctuation">{</span>closeIcon<span class="token punctuation">}</span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a.div</span><span class="token punctuation">></span></span>\n         <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n         </span><span class="token punctuation">{</span>title <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a.div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getStyle</span><span class="token punctuation">(</span>titleStyle<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token string">\'text-display-title\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n               </span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a.div</span><span class="token punctuation">></span></span>\n         <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n         </span><span class="token punctuation">{</span>subTitle <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>\n            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>subTitleContainer<span class="token punctuation">,</span> <span class="token string">\'text-display-sub-title-container\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n               </span><span class="token punctuation">{</span><span class="token function">transitions</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">style<span class="token punctuation">,</span> item<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a.div</span>\n                        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getStyle</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                        <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>subTitle<span class="token punctuation">,</span> <span class="token string">\'text-display-sub-title\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                     <span class="token punctuation">></span></span><span class="token plain-text">\n                        </span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token plain-text">\n                     </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a.div</span><span class="token punctuation">></span></span>\n                  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n         <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n   );\n};\n\nexport default AnimationTitle;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="react-gsap"><a href="#react-gsap" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-gsap</h4>\n<p>为了解决渲染多次组件带来的多次执行动效的问题，之后采用 react-gsap 实现</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50704743209658606000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, {\n  CSSProperties,\n  ReactNode,\n  Children,\n  useContext,\n  useRef,\n  useEffect\n} from \'react\'\nimport classnames from \'classnames\'\nimport { Tween, PlayState } from \'react-gsap\'\nimport { useInViewport } from \'ahooks\'\n\nimport XIcon from \'@/components/xIcon\'\nimport ConfigContext from \'@/components/layout/configContext\'\n\nimport useStoreContext, { CLIENT_TYPE } from \'@/hooks/useStoreContext\'\n\nimport { delayFunc } from \'@/utils\'\n\nimport PageStyles from \'./index.module.less\'\n\nexport interface AnimationTitleProps {\n  className?: string\n  title?: ReactNode\n  subTitle?: ReactNode\n  closeIcon?: ReactNode\n  delay?: number\n  style?: CSSProperties\n  animation?: boolean\n  isOnce?: boolean\n  titleStyle?: CSSProperties\n  closeIconStyle?: CSSProperties\n  reverseAnimationRef?: any\n  startAnimationRef?: any\n}\n\nexport const defaultCloseIcon = (<XIcon\n  name=\'title-x\'\n/>)\n\nconst AnimationTitle = (props: AnimationTitleProps) => {\n  const {\n    className,\n    title,\n    subTitle,\n    closeIcon = defaultCloseIcon,\n    delay = 300,\n    style,\n    animation = true,\n    isOnce = false,\n    closeIconStyle,\n    titleStyle,\n    reverseAnimationRef = null,\n    startAnimationRef = null\n  } = props\n\n  const { isRunMultiTime } = useContext(ConfigContext)\n  const closeIconRef = useRef(null)\n  const titleRef = useRef(null)\n  const subTitleRef = useRef(null)\n\n  const domRef = useRef<HTMLDivElement>(null)\n  const [inViewPort] = useInViewport(domRef)\n\n  const { state } = useStoreContext()\n\n  useEffect(() => {\n    if (!animation || state?.clientType === CLIENT_TYPE.H5) {\n      return\n    }\n    const startAnimation = async () => {\n      await delayFunc(delay)\n      if (closeIcon) {\n        closeIconRef.current?.getGSAP().play()\n      }\n      await delayFunc(200)\n      if (title) {\n        titleRef.current?.getGSAP().play()\n      }\n      // 等 title 动画的一半就开始运行\n      await delayFunc(500)\n      if (subTitle) {\n        await subTitleRef.current?.getGSAP().play()\n      }\n    }\n\n    const reverseAnimation = () => {\n      [closeIconRef, titleRef, subTitleRef].forEach((item) => {\n        item.current?.getGSAP().reverse()\n      })\n    }\n\n    if (reverseAnimationRef) {\n      reverseAnimationRef.current = reverseAnimation\n    }\n\n    if (startAnimationRef) {\n      startAnimationRef.current = startAnimation\n    }\n\n    if (inViewPort) {\n      startAnimation()\n    } else if (isRunMultiTime && !isOnce) {\n      reverseAnimation()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inViewPort, isOnce])\n\n  let playState = animation ? PlayState.stop : PlayState.stopEnd\n\n  // animation 未定义且是 h5 的情况下，去掉动效\n  if (state?.clientType === CLIENT_TYPE.H5) {\n    playState = PlayState.stopEnd\n  }\n\n  return (\n    <div\n      className={classnames(\n        PageStyles.textDisplay,\n        \'text-display\',\n        className\n      )}\n      style={style}\n      ref={domRef}\n    >\n      {\n        closeIcon && <Tween\n          ref={closeIconRef}\n          from={{\n            opacity: 0,\n            rotate: -100\n          }}\n          to={{\n            opacity: 1,\n            rotate: 0\n          }}\n          playState={playState}\n        >\n          <div\n            className={classnames(PageStyles.closeIcon, \'close-icon\')}\n            style={closeIconStyle}\n          >\n            {closeIcon}\n          </div>\n        </Tween>\n      }\n      {\n        title && <Tween\n          ref={titleRef}\n          from={{\n            scale: 0,\n            opacity: 0\n          }}\n          to={{\n            opacity: 1,\n            scale: 1\n          }}\n          playState={playState}\n        >\n          <div\n            className={classnames(\n              PageStyles.title,\n              \'text-display-title\'\n            )}\n            style={titleStyle}\n          >\n            {title}\n          </div>\n        </Tween>\n      }\n      {\n        subTitle && <div\n          className={classnames(\n            PageStyles.subTitleContainer,\n            \'text-display-sub-title-container\'\n          )}\n        >\n          <Tween\n            ref={subTitleRef}\n            from={{\n              opacity: 0,\n              y: 50\n            }}\n            to={{\n              opacity: 1,\n              y: 0\n            }}\n            stagger={0.6}\n            duration={Children.toArray(subTitle).length * 0.4}\n            playState={playState}\n          >\n            {\n              Children.toArray(subTitle).map((item: any, index: number) => {\n                return (\n                  <div\n                    className={classnames(\n                      PageStyles.subTitle,\n                      \'text-display-sub-title\'\n                    )}\n                    key={index}\n                  >\n                    {item}\n                  </div>\n                )\n              })\n            }\n          </Tween>\n        </div>\n      }\n    </div>\n  )\n}\n\nexport default AnimationTitle`, `50704743209658606000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  CSSProperties<span class="token punctuation">,</span>\n  ReactNode<span class="token punctuation">,</span>\n  Children<span class="token punctuation">,</span>\n  useContext<span class="token punctuation">,</span>\n  useRef<span class="token punctuation">,</span>\n  useEffect\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> classnames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Tween<span class="token punctuation">,</span> PlayState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-gsap\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useInViewport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span>\n\n<span class="token keyword">import</span> XIcon <span class="token keyword">from</span> <span class="token string">\'@/components/xIcon\'</span>\n<span class="token keyword">import</span> ConfigContext <span class="token keyword">from</span> <span class="token string">\'@/components/layout/configContext\'</span>\n\n<span class="token keyword">import</span> useStoreContext<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">CLIENT_TYPE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/hooks/useStoreContext\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> delayFunc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span>\n\n<span class="token keyword">import</span> PageStyles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span>\n\n<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">AnimationTitleProps</span> <span class="token punctuation">{</span>\n  className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span>\n  title<span class="token operator">?</span><span class="token punctuation">:</span> ReactNode\n  subTitle<span class="token operator">?</span><span class="token punctuation">:</span> ReactNode\n  closeIcon<span class="token operator">?</span><span class="token punctuation">:</span> ReactNode\n  delay<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span>\n  style<span class="token operator">?</span><span class="token punctuation">:</span> CSSProperties\n  animation<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span>\n  isOnce<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span>\n  titleStyle<span class="token operator">?</span><span class="token punctuation">:</span> CSSProperties\n  closeIconStyle<span class="token operator">?</span><span class="token punctuation">:</span> CSSProperties\n  reverseAnimationRef<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">any</span>\n  startAnimationRef<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">any</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> defaultCloseIcon <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XIcon</span></span>\n  <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>title-x<span class="token punctuation">\'</span></span>\n<span class="token punctuation">/></span></span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">AnimationTitle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">:</span> AnimationTitleProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span>\n    className<span class="token punctuation">,</span>\n    title<span class="token punctuation">,</span>\n    subTitle<span class="token punctuation">,</span>\n    closeIcon <span class="token operator">=</span> defaultCloseIcon<span class="token punctuation">,</span>\n    delay <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span>\n    style<span class="token punctuation">,</span>\n    animation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    isOnce <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    closeIconStyle<span class="token punctuation">,</span>\n    titleStyle<span class="token punctuation">,</span>\n    reverseAnimationRef <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n    startAnimationRef <span class="token operator">=</span> <span class="token keyword">null</span>\n  <span class="token punctuation">}</span> <span class="token operator">=</span> props\n\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> isRunMultiTime <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ConfigContext<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> closeIconRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> titleRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> subTitleRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> domRef <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLDivElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">(null)\n  const [inViewPort] = useInViewport(domRef)\n\n  const </span><span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token plain-text"> = useStoreContext()\n\n  useEffect(() => </span><span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>animation <span class="token operator">||</span> state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">H5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">const</span> <span class="token function-variable function">startAnimation</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">await</span> <span class="token function">delayFunc</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>closeIcon<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        closeIconRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getGSAP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">await</span> <span class="token function">delayFunc</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        titleRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getGSAP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// 等 title 动画的一半就开始运行</span>\n      <span class="token keyword">await</span> <span class="token function">delayFunc</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>subTitle<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">await</span> subTitleRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getGSAP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">const</span> <span class="token function-variable function">reverseAnimation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token punctuation">[</span>closeIconRef<span class="token punctuation">,</span> titleRef<span class="token punctuation">,</span> subTitleRef<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        item<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getGSAP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>reverseAnimationRef<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      reverseAnimationRef<span class="token punctuation">.</span>current <span class="token operator">=</span> reverseAnimation\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>startAnimationRef<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      startAnimationRef<span class="token punctuation">.</span>current <span class="token operator">=</span> startAnimation\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>inViewPort<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">startAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>isRunMultiTime <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isOnce<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">reverseAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n  <span class="token punctuation">}</span><span class="token plain-text">, [inViewPort, isOnce])\n\n  let playState = animation ? PlayState.stop : PlayState.stopEnd\n\n  // animation 未定义且是 h5 的情况下，去掉动效\n  if (state?.clientType === CLIENT_TYPE.H5) </span><span class="token punctuation">{</span>\n    playState <span class="token operator">=</span> PlayState<span class="token punctuation">.</span>stopEnd\n  <span class="token punctuation">}</span><span class="token plain-text">\n\n  return (\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n      <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>\n        PageStyles<span class="token punctuation">.</span>textDisplay<span class="token punctuation">,</span>\n        <span class="token string">\'text-display\'</span><span class="token punctuation">,</span>\n        className\n      <span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n      <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span>\n      <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>domRef<span class="token punctuation">}</span></span>\n    <span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>\n        closeIcon <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tween</span></span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>closeIconRef<span class="token punctuation">}</span></span>\n          <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n            opacity<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n            rotate<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">100</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n            opacity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n            rotate<span class="token punctuation">:</span> <span class="token number">0</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">playState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>playState<span class="token punctuation">}</span></span>\n        <span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n            <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>closeIcon<span class="token punctuation">,</span> <span class="token string">\'close-icon\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>closeIconStyle<span class="token punctuation">}</span></span>\n          <span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span>closeIcon<span class="token punctuation">}</span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Tween</span></span><span class="token punctuation">></span></span>\n      <span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>\n        title <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tween</span></span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>titleRef<span class="token punctuation">}</span></span>\n          <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n            scale<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n            opacity<span class="token punctuation">:</span> <span class="token number">0</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n            opacity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n            scale<span class="token punctuation">:</span> <span class="token number">1</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">playState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>playState<span class="token punctuation">}</span></span>\n        <span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n            <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>\n              PageStyles<span class="token punctuation">.</span>title<span class="token punctuation">,</span>\n              <span class="token string">\'text-display-title\'</span>\n            <span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>titleStyle<span class="token punctuation">}</span></span>\n          <span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Tween</span></span><span class="token punctuation">></span></span>\n      <span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>\n        subTitle <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n          <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>\n            PageStyles<span class="token punctuation">.</span>subTitleContainer<span class="token punctuation">,</span>\n            <span class="token string">\'text-display-sub-title-container\'</span>\n          <span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tween</span></span>\n            <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>subTitleRef<span class="token punctuation">}</span></span>\n            <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n              opacity<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n              y<span class="token punctuation">:</span> <span class="token number">50</span>\n            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n              opacity<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n              y<span class="token punctuation">:</span> <span class="token number">0</span>\n            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">stagger</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">0.6</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">duration</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Children<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>subTitle<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">0.4</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">playState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>playState<span class="token punctuation">}</span></span>\n          <span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span>\n              Children<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>subTitle<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token keyword">return</span> <span class="token punctuation">(</span>\n                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n                    <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>\n                      PageStyles<span class="token punctuation">.</span>subTitle<span class="token punctuation">,</span>\n                      <span class="token string">\'text-display-sub-title\'</span>\n                    <span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                    <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span>\n                  <span class="token punctuation">></span></span><span class="token plain-text">\n                    </span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token plain-text">\n                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n                <span class="token punctuation">)</span>\n              <span class="token punctuation">}</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Tween</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token punctuation">}</span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n  )\n}\n\nexport default AnimationTitle</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<h4 id="react-spring-1"><a href="#react-spring-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-spring</h4>\n<!-- <iframe data-src="https://codesandbox.io/embed/b03lty?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/49vcpg?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="react-gsap-1"><a href="#react-gsap-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-gsap</h4>\n<!-- <iframe data-src="https://codesandbox.io/embed/yibidu?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/69fcy2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="数字滚动展示"><a href="#%E6%95%B0%E5%AD%97%E6%BB%9A%E5%8A%A8%E5%B1%95%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数字滚动展示</h2>\n<h3 id="需求背景-2"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>实现功能如下：</p>\n<ol>\n<li>数字有滚动效果</li>\n<li>整体有位移、透明度变化效果</li>\n</ol>\n<p>实现要点如下：</p>\n<ol>\n<li>进入视口执行一次</li>\n<li>离开视口重置动画</li>\n</ol>\n<p>实现如下所示动效：</p>\n<p><html><head></head><body><video data-src="/examples/international-official-website-technical-difficulties/number-change-display.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></video></p>\n<h3 id="选型过程-1"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h3>\n<p>同 <code class="language-text">逐行显示</code> 的选型过程，这里使用的是 react-spring</p>\n<h3 id="核心代码-1"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21067498527411278000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { ReactNode, useRef, useEffect } from \'react\';\nimport classnames from \'classnames\';\nimport { a, useTrail, useSprings, useSpringRef } from \'@react-spring/web\';\nimport { useInViewport } from \'ahooks\';\n\nimport { delayFunc } from \'@/utils\';\n\nimport PageStyles from \'./index.module.less\';\n\ninterface TitleContent {\n   title: string;\n}\n\ninterface NumberContent {\n   number: string;\n   unit: string;\n   precision?: number;\n   render?: (value: number) => string;\n}\n\ninterface CommonDataItem {\n   hint: string;\n}\n\ntype DataItem = CommonDataItem & (TitleContent | NumberContent);\n\ninterface Props {\n   data: DataItem[];\n   className?: string;\n   delay?: number;\n}\n\nconst CarConfiguration = ({ data, className, delay = 300 }: Props) => {\n   const [trails, trailsApi] = useTrail(data.length, () => ({\n      opacity: 0,\n      y: 40\n   }));\n\n   const springsRef = useSpringRef();\n   const springs = useSprings(\n      data.length,\n      data.map((item) => ({\n         ref: springsRef,\n         from: {\n            number: 0\n         },\n         to: {\n            number: Number((item as NumberContent).number)\n         }\n      }))\n   );\n\n   const domRef = useRef();\n   const [inViewPort] = useInViewport(domRef);\n   useEffect(() => {\n      const startAnimation = async () => {\n         await delayFunc(delay);\n         trailsApi.start({\n            y: 0,\n            opacity: 1\n         });\n         await delayFunc(1200);\n         springsRef.start();\n      };\n\n      const reverseAnimation = () => {\n         trailsApi.start({\n            y: 40,\n            opacity: 0\n         });\n         [springsRef].forEach((item) => {\n            item &&\n               item.start({\n                  reverse: true\n               });\n         });\n      };\n\n      if (inViewPort) {\n         startAnimation();\n      } else {\n         reverseAnimation();\n      }\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, [inViewPort]);\n\n   return (\n      <div ref={domRef} className={classnames(PageStyles.configuration, className, \'car-configuration\')}>\n         {trails.map((style, index) => {\n            const item = data[index];\n            let title: ReactNode = (item as TitleContent).title;\n            const titleComponent = (\n               <>\n                  <span\n                     className={PageStyles.configurationTitle}\n                     key={Math.random()}\n                     dangerouslySetInnerHTML={{ __html: (item as TitleContent).title }}\n                  />\n                  <span\n                     className={PageStyles.unit}\n                     key={Math.random()}\n                     dangerouslySetInnerHTML={{ __html: (item as any).unit }}\n                  />\n               </>\n            );\n            const numberItem = item as NumberContent;\n            if (!title && numberItem.number) {\n               const renderFunc = numberItem.render\n                  ? numberItem.render\n                  : (value: number) => value.toFixed(numberItem.precision || 0);\n               title = (\n                  <>\n                     <a.span>{springs[index].number.to(renderFunc)}</a.span>\n                     <span\n                        className={PageStyles.unit}\n                        key={Math.random()}\n                        dangerouslySetInnerHTML={{ __html: numberItem.unit }}\n                     />\n                  </>\n               );\n            }\n            return (\n               <>\n                  <a.div\n                     key={index}\n                     className={classnames(PageStyles.configurationItem, \'car-configuration-item\')}\n                     style={style}\n                  >\n                     {typeof title === \'string\' ? (\n                        titleComponent\n                     ) : (\n                        <div className={PageStyles.configurationTitle}>{title} </div>\n                     )}\n                     <div className={PageStyles.configurationHint}>{item.hint}</div>\n                  </a.div>\n                  {index < trails.length - 1 && <a.div key={index} className={PageStyles.divider} style={style} />}\n               </>\n            );\n         })}\n      </div>\n   );\n};\n\nexport default CarConfiguration;`, `21067498527411278000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> ReactNode<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> classnames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> useTrail<span class="token punctuation">,</span> useSprings<span class="token punctuation">,</span> useSpringRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@react-spring/web\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useInViewport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> delayFunc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> PageStyles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">TitleContent</span> <span class="token punctuation">{</span>\n   title<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">NumberContent</span> <span class="token punctuation">{</span>\n   <span class="token builtin">number</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   unit<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   precision<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   render<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">CommonDataItem</span> <span class="token punctuation">{</span>\n   hint<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> DataItem <span class="token operator">=</span> CommonDataItem <span class="token operator">&amp;</span> <span class="token punctuation">(</span>TitleContent <span class="token operator">|</span> NumberContent<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> DataItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   delay<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">CarConfiguration</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data<span class="token punctuation">,</span> className<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">300</span> <span class="token punctuation">}</span><span class="token punctuation">:</span> Props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>trails<span class="token punctuation">,</span> trailsApi<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTrail</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n      opacity<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      y<span class="token punctuation">:</span> <span class="token number">40</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> springsRef <span class="token operator">=</span> <span class="token function">useSpringRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> springs <span class="token operator">=</span> <span class="token function">useSprings</span><span class="token punctuation">(</span>\n      data<span class="token punctuation">.</span>length<span class="token punctuation">,</span>\n      data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n         ref<span class="token punctuation">:</span> springsRef<span class="token punctuation">,</span>\n         <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token builtin">number</span><span class="token punctuation">:</span> <span class="token number">0</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         to<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token builtin">number</span><span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item <span class="token keyword">as</span> NumberContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> domRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>inViewPort<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useInViewport</span><span class="token punctuation">(</span>domRef<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token function-variable function">startAnimation</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">await</span> <span class="token function">delayFunc</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         trailsApi<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n            opacity<span class="token punctuation">:</span> <span class="token number">1</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">await</span> <span class="token function">delayFunc</span><span class="token punctuation">(</span><span class="token number">1200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         springsRef<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">const</span> <span class="token function-variable function">reverseAnimation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         trailsApi<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            y<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>\n            opacity<span class="token punctuation">:</span> <span class="token number">0</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">[</span>springsRef<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            item <span class="token operator">&amp;&amp;</span>\n               item<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                  reverse<span class="token punctuation">:</span> <span class="token boolean">true</span>\n               <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>inViewPort<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token function">startAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n         <span class="token function">reverseAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>inViewPort<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>domRef<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>configuration<span class="token punctuation">,</span> className<span class="token punctuation">,</span> <span class="token string">\'car-configuration\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token punctuation">{</span>trails<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">style<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> item <span class="token operator">=</span> data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n            <span class="token keyword">let</span> title<span class="token punctuation">:</span> ReactNode <span class="token operator">=</span> <span class="token punctuation">(</span>item <span class="token keyword">as</span> TitleContent<span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">;</span>\n            <span class="token keyword">const</span> titleComponent <span class="token operator">=</span> <span class="token punctuation">(</span>\n               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>\n                     <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>PageStyles<span class="token punctuation">.</span>configurationTitle<span class="token punctuation">}</span></span>\n                     <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                     <span class="token attr-name">dangerouslySetInnerHTML</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> <span class="token punctuation">(</span>item <span class="token keyword">as</span> TitleContent<span class="token punctuation">)</span><span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n                  <span class="token punctuation">/></span></span><span class="token plain-text">\n                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>\n                     <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>PageStyles<span class="token punctuation">.</span>unit<span class="token punctuation">}</span></span>\n                     <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                     <span class="token attr-name">dangerouslySetInnerHTML</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> <span class="token punctuation">(</span>item <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">.</span>unit <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n                  <span class="token punctuation">/></span></span><span class="token plain-text">\n               </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">const</span> numberItem <span class="token operator">=</span> item <span class="token keyword">as</span> NumberContent<span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title <span class="token operator">&amp;&amp;</span> numberItem<span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">const</span> renderFunc <span class="token operator">=</span> numberItem<span class="token punctuation">.</span>render\n                  <span class="token operator">?</span> numberItem<span class="token punctuation">.</span><span class="token function-variable function">render</span>\n                  <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> value<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span>numberItem<span class="token punctuation">.</span>precision <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n               title <span class="token operator">=</span> <span class="token punctuation">(</span>\n                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n                     </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a.span</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>springs<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">number</span><span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>renderFunc<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a.span</span><span class="token punctuation">></span></span><span class="token plain-text">\n                     </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>\n                        <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>PageStyles<span class="token punctuation">.</span>unit<span class="token punctuation">}</span></span>\n                        <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                        <span class="token attr-name">dangerouslySetInnerHTML</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> numberItem<span class="token punctuation">.</span>unit <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n                     <span class="token punctuation">/></span></span><span class="token plain-text">\n                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>\n               <span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">return</span> <span class="token punctuation">(</span>\n               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a.div</span>\n                     <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span>\n                     <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>PageStyles<span class="token punctuation">.</span>configurationItem<span class="token punctuation">,</span> <span class="token string">\'car-configuration-item\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                     <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span>\n                  <span class="token punctuation">></span></span><span class="token plain-text">\n                     </span><span class="token punctuation">{</span><span class="token keyword">typeof</span> title <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> <span class="token punctuation">(</span>\n                        titleComponent\n                     <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>\n                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>PageStyles<span class="token punctuation">.</span>configurationTitle<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token plain-text"> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n                     <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n                     </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>PageStyles<span class="token punctuation">.</span>configurationHint<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>hint<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a.div</span><span class="token punctuation">></span></span><span class="token plain-text">\n                  </span><span class="token punctuation">{</span>index <span class="token operator">&lt;</span> trails<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a.div</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>PageStyles<span class="token punctuation">.</span>divider<span class="token punctuation">}</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>style<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span><span class="token plain-text">\n               </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> CarConfiguration<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-1"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<!-- <iframe data-src="https://codesandbox.io/embed/ocnfxs?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/r72tf2?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="固定页面滚动控制"><a href="#%E5%9B%BA%E5%AE%9A%E9%A1%B5%E9%9D%A2%E6%BB%9A%E5%8A%A8%E6%8E%A7%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>固定页面滚动控制</h2>\n<h3 id="需求背景-3"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>实现要点：</p>\n<ol>\n<li>随着鼠标滚轮滚动而触发的动效（跟随鼠标滚动，鼠标停顿时，动效也会停顿）</li>\n<li>需要固定页面</li>\n</ol>\n<p>实现如下所示的动效：</p>\n<p><html><head></head><body><video data-src="/examples/international-official-website-technical-difficulties/fix-page-scroll-display.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></video></p>\n<h3 id="选型过程-2"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h3>\n<table>\n<thead>\n<tr>\n<th align="left">选型</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><a href="https://github.com/janpaepke/ScrollMagic" target="_blank" rel="nofollow noreferrer noopener">ScrollMagic</a></td>\n<td align="left">官网例子满足需求</td>\n<td align="left">需要封装成 react</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/bitworking/react-scrollmagic" target="_blank" rel="nofollow noreferrer noopener">react-scrollmagic</a></td>\n<td align="left"><ol>\n<li>\n可在 react 中直接使用\n</li>\n<li>\n提供固定页面的百分比可完美用于 react-gsap 动效\n</li>\n</ol></td>\n<td align="left"><ol>\n<li>\n滑动过快会出现“抖动”\n</li>\n<li>\n不能实现切屏 + 固定页面同时存在的效果\n</li>\n</ol></td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/bitworking/react-gsap" target="_blank" rel="nofollow noreferrer noopener">react-gsap</a>\n + scrollTrigger</td>\n<td align="left">解决了“抖动”问题</td>\n<td align="left">react-gsap 暴露的 api 不够底层，实现切屏 + 固定页面较困难</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/greensock/GSAP" target="_blank" rel="nofollow noreferrer noopener">gsap</a>\n + scrollTrigger</td>\n<td align="left">解决了以上的所有缺点</td>\n<td align="left">代码量过多，react 下需要考虑情况较多</td>\n</tr>\n</tbody>\n</table>\n<h3 id="核心代码-2"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<h4 id="react-scrollmagic"><a href="#react-scrollmagic" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-scrollmagic</h4>\n<p>web/components/reactScrollMagic/index.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46368755893692785000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { Children, cloneElement, ReactElement } from \'react\'\nimport { Controller as XPController, Scene, SceneProps as XPSceneProps } from \'xp-react-scrollmagic\'\n\nimport useStoreContext, { CLIENT_TYPE } from \'@/hooks/useStoreContext\'\n\nimport { getWindowHeight } from \'@/utils\'\n\nconst defaultControllerProps = {\n  // container: getDocument()?.querySelector(\'h\')\n}\n\nconst defaultSceneProps = {\n  indicators: false,\n  triggerHook: 0,\n  duration: getWindowHeight()\n}\n\ninterface ProgressEventsParams {\n  progress: number\n  event: {\n    state: string\n    type: string\n  }\n}\n\nexport interface SceneProps {\n  sceneProps?: (Partial<XPSceneProps> & { enableParams: boolean }) | null\n  sceneParams?: ProgressEventsParams\n}\n\ninterface ControllerProps {\n  children: Array<ReactElement<SceneProps>> | ReactElement<SceneProps>\n}\n\nconst ReactScrollMagic = ({\n  children\n}: ControllerProps) => {\n  const { state } = useStoreContext()\n\n  const renderChildren = Children.map(children, (item, index) => {\n    const sceneProps = {\n      ...defaultSceneProps,\n      pin: state?.clientType === CLIENT_TYPE.PC,\n      ...item.props.sceneProps\n    }\n    if (sceneProps.enableParams) {\n      const {\n        enableParams,\n        ...rest\n      } = sceneProps\n      return (\n        <Scene\n          {...rest}\n        >\n          {\n            (progress: number, event: { state: string }) => {\n              return <div>\n                {\n                  cloneElement(item, {\n                    ...item.props,\n                    sceneParams: {\n                      progress,\n                      event\n                    }\n                  })\n                }\n              </div>\n            }\n          }\n        </Scene>\n      )\n    }\n    return (\n      <Scene\n        {...sceneProps}\n      >\n        <div>\n          {item}\n        </div>\n      </Scene>\n    )\n  })\n\n  return (\n    <XPController {...defaultControllerProps}>\n      <div>\n        {renderChildren}\n      </div>\n    </XPController>\n  )\n}\n\nexport default ReactScrollMagic`, `46368755893692785000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Children<span class="token punctuation">,</span> cloneElement<span class="token punctuation">,</span> ReactElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Controller <span class="token keyword">as</span> XPController<span class="token punctuation">,</span> Scene<span class="token punctuation">,</span> SceneProps <span class="token keyword">as</span> XPSceneProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'xp-react-scrollmagic\'</span>\n\n<span class="token keyword">import</span> useStoreContext<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">CLIENT_TYPE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/hooks/useStoreContext\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> getWindowHeight <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span>\n\n<span class="token keyword">const</span> defaultControllerProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// container: getDocument()?.querySelector(\'h\')</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> defaultSceneProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n  indicators<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  triggerHook<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n  duration<span class="token punctuation">:</span> <span class="token function">getWindowHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">ProgressEventsParams</span> <span class="token punctuation">{</span>\n  progress<span class="token punctuation">:</span> <span class="token builtin">number</span>\n  event<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    state<span class="token punctuation">:</span> <span class="token builtin">string</span>\n    <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">SceneProps</span> <span class="token punctuation">{</span>\n  sceneProps<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>Partial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XPSceneProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> &amp; </span><span class="token punctuation">{</span> enableParams<span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span><span class="token plain-text">) | null\n  sceneParams?: ProgressEventsParams\n}\n\ninterface ControllerProps </span><span class="token punctuation">{</span>\n  children<span class="token punctuation">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>ReactElement<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SceneProps</span></span><span class="token punctuation">></span></span><span class="token plain-text">> | ReactElement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SceneProps</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n}\n\nconst ReactScrollMagic = ({\n  children\n}: ControllerProps) => </span><span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useStoreContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> renderChildren <span class="token operator">=</span> Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> sceneProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token operator">...</span>defaultSceneProps<span class="token punctuation">,</span>\n      pin<span class="token punctuation">:</span> state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">PC</span><span class="token punctuation">,</span>\n      <span class="token operator">...</span>item<span class="token punctuation">.</span>props<span class="token punctuation">.</span>sceneProps\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>sceneProps<span class="token punctuation">.</span>enableParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span>\n        enableParams<span class="token punctuation">,</span>\n        <span class="token operator">...</span>rest\n      <span class="token punctuation">}</span> <span class="token operator">=</span> sceneProps\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Scene</span></span>\n          <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">rest</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token punctuation">{</span>\n            <span class="token punctuation">(</span><span class="token parameter">progress<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> event<span class="token punctuation">:</span> <span class="token punctuation">{</span> state<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n                </span><span class="token punctuation">{</span>\n                  <span class="token function">cloneElement</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n                    <span class="token operator">...</span>item<span class="token punctuation">.</span>props<span class="token punctuation">,</span>\n                    sceneParams<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n                      progress<span class="token punctuation">,</span>\n                      event\n                    <span class="token punctuation">}</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n                <span class="token punctuation">}</span><span class="token plain-text">\n              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Scene</span></span><span class="token punctuation">></span></span>\n      <span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Scene</span></span>\n        <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">sceneProps</span><span class="token punctuation">}</span></span>\n      <span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token punctuation">{</span>item<span class="token punctuation">}</span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Scene</span></span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XPController</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">defaultControllerProps</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token punctuation">{</span>renderChildren<span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XPController</span></span><span class="token punctuation">></span></span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token plain-text">\n\nexport default ReactScrollMagic</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用时：</p>\n<p>web/pages/p7/render.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43005023150186710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import ReactScrollMagic from \'@/components/reactScrollMagic\';\nimport { getWindowHeight } from \'@/utils\';\n\n<ReactScrollMagic>\n   <Sepa\n      sceneProps={{\n         enableParams: true,\n         duration: getWindowHeight() * 2 // 总共停 2 屏高度\n      }}\n   />\n</ReactScrollMagic>;`, `43005023150186710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> ReactScrollMagic <span class="token keyword">from</span> <span class="token string">\'@/components/reactScrollMagic\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> getWindowHeight <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span><span class="token punctuation">;</span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ReactScrollMagic</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n   </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Sepa</span></span>\n      <span class="token attr-name">sceneProps</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n         enableParams<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n         duration<span class="token punctuation">:</span> <span class="token function">getWindowHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token comment">// 总共停 2 屏高度</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n   <span class="token punctuation">/></span></span><span class="token plain-text">\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ReactScrollMagic</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>web/pages/p7/components/sepa/index.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1071418499841092500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\'\nimport { useTranslation } from \'react-i18next\'\nimport classNames from \'classnames\'\nimport { Tween, PlayState } from \'react-gsap\'\n\nimport { l } from \'@/components/lazyLoader\'\nimport ModelLeftText from \'@/components/modelLeftText\'\nimport { SceneProps } from \'@/components/reactScrollMagic\'\nimport AnimationBg from \'@/components/animationBg\'\n\nimport useTmpComponent from \'@/hooks/useTmpComponent\'\n\nimport { getAnimateProgresses } from \'@/utils/animate\'\n\nimport styles from \'./index.module.less\'\n\nconst Index = ({\n  sceneParams\n}: SceneProps) => {\n  const {\n    progress = 0\n  } = sceneParams || {}\n  const { t } = useTranslation()\n  const getValue = (param: string) => t(\\`p7.sepa.\\${param}\\`)\n\n  const { api, Slot } = useTmpComponent()\n\n  const [animationTextProgress] = getAnimateProgresses(progress, [\n    {\n      start: 1 / 2, // 滚动到一半的时候才开始动效\n      duration: 1 / 2 // 动效的持续百分比\n    }\n  ])\n\n  return (\n    <l.div\n      src=&quot;/public/p7/sepa/p7-p4-1.jpg&quot;\n      minSrcSet=&quot;/public/p7/sepa/p7-p4-1@mini.jpg&quot;\n      srcSet=&quot;/public/p7/sepa/p7-p4-1@2x.jpg&quot;\n      className={classNames(\'global-full-page-with-top-menu\', styles.container)}\n    >\n      <Slot\n        modelType=\'P7\'\n        pageType=\'SEPA\'\n        buttonType=\'Arrow\'\n        itemList={[{\n          imgList: [{\n            src: \'/public/p7/d3/P7-d3-1.png\',\n            srcSet: \'/public/p7/d3/P7-d3-1@2x.jpg\'\n          }],\n          background: \'linear-gradient(133deg, #343538 0%, #000102 100%)\',\n          textData: {\n            topSubTitle: t(\'p7.d3.topSubTitle1\'),\n            title: t(\'p7.d3.title1\'),\n            subTitle: t(\'p7.d3.subTitle1\')\n          }\n        }, {\n          imgList: [{\n            src: \'/public/p7/d3/P7-d3-2.jpg\',\n            srcSet: \'/public/p7/d3/P7-d3-2@2x.jpg\'\n          }],\n          background: \'linear-gradient(133deg, #343538 0%, #000102 100%)\',\n          textData: {\n            topSubTitle: t(\'p7.d3.topSubTitle2\'),\n            title: t(\'p7.d3.title2\'),\n            subTitle: t(\'p7.d3.subTitle2\')\n          }\n        }]}\n      />\n      <div ref={trackRef} className={classNames(\'body\', styles.body)}>\n        <ModelLeftText\n          topSubTitle={getValue(\'topSubTitle\')}\n          title={getValue(\'title\')}\n          subTitle={getValue(\'subTitle\')}\n          shortDesc={getValue(\'shortDesc\')}\n          buttonProps={{\n            onClick: () => {\n              api.current?.open()\n            },\n            type: \'ghost\'\n          }}\n        />\n      </div>\n      {\n        animationTextProgress > 0 && <AnimationBg type={2} className={styles.animationBg}>\n          <Tween\n            from={{\n              scale: 40\n            }}\n            totalProgress={animationTextProgress}\n            playState={PlayState.pause}\n          >\n            <div className={styles.animationText}>\n              {/* 这里所有国家都是这个，不需要国际化 */}\n              XPILOT\n            </div>\n          </Tween>\n        </AnimationBg>\n      }\n    </l.div>\n  )\n}\n\nexport default Index`, `1071418499841092500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useTranslation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-i18next\'</span>\n<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Tween<span class="token punctuation">,</span> PlayState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-gsap\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> l <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/lazyLoader\'</span>\n<span class="token keyword">import</span> ModelLeftText <span class="token keyword">from</span> <span class="token string">\'@/components/modelLeftText\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> SceneProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/reactScrollMagic\'</span>\n<span class="token keyword">import</span> AnimationBg <span class="token keyword">from</span> <span class="token string">\'@/components/animationBg\'</span>\n\n<span class="token keyword">import</span> useTmpComponent <span class="token keyword">from</span> <span class="token string">\'@/hooks/useTmpComponent\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> getAnimateProgresses <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils/animate\'</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Index</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>\n  sceneParams\n<span class="token punctuation">}</span><span class="token punctuation">:</span> SceneProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span>\n    progress <span class="token operator">=</span> <span class="token number">0</span>\n  <span class="token punctuation">}</span> <span class="token operator">=</span> sceneParams <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTranslation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">param<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">p7.sepa.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>param<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> api<span class="token punctuation">,</span> Slot <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTmpComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>animationTextProgress<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getAnimateProgresses</span><span class="token punctuation">(</span>progress<span class="token punctuation">,</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      start<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 滚动到一半的时候才开始动效</span>\n      duration<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token comment">// 动效的持续百分比</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>l.div</span>\n      <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p7/sepa/p7-p4-1.jpg<span class="token punctuation">"</span></span>\n      <span class="token attr-name">minSrcSet</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p7/sepa/p7-p4-1@mini.jpg<span class="token punctuation">"</span></span>\n      <span class="token attr-name">srcSet</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p7/sepa/p7-p4-1@2x.jpg<span class="token punctuation">"</span></span>\n      <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">\'global-full-page-with-top-menu\'</span><span class="token punctuation">,</span> styles<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n    <span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Slot</span></span>\n        <span class="token attr-name">modelType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>P7<span class="token punctuation">\'</span></span>\n        <span class="token attr-name">pageType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>SEPA<span class="token punctuation">\'</span></span>\n        <span class="token attr-name">buttonType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>Arrow<span class="token punctuation">\'</span></span>\n        <span class="token attr-name">itemList</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span>\n          imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d3/P7-d3-1.png\'</span><span class="token punctuation">,</span>\n            srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d3/P7-d3-1@2x.jpg\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n          background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(133deg, #343538 0%, #000102 100%)\'</span><span class="token punctuation">,</span>\n          textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d3.topSubTitle1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d3.title1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d3.subTitle1\'</span><span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n          imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d3/P7-d3-2.jpg\'</span><span class="token punctuation">,</span>\n            srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d3/P7-d3-2@2x.jpg\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n          background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(133deg, #343538 0%, #000102 100%)\'</span><span class="token punctuation">,</span>\n          textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d3.topSubTitle2\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d3.title2\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d3.subTitle2\'</span><span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>\n      <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>trackRef<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">,</span> styles<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ModelLeftText</span></span>\n          <span class="token attr-name">topSubTitle</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'topSubTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">title</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'title\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">subTitle</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'subTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">shortDesc</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'shortDesc\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">buttonProps</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n            <span class="token function-variable function">onClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              api<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'ghost\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>\n        animationTextProgress <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AnimationBg</span></span> <span class="token attr-name">type</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>animationBg<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tween</span></span>\n            <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n              scale<span class="token punctuation">:</span> <span class="token number">40</span>\n            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">totalProgress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>animationTextProgress<span class="token punctuation">}</span></span>\n            <span class="token attr-name">playState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>PlayState<span class="token punctuation">.</span>pause<span class="token punctuation">}</span></span>\n          <span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>animationText<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n              </span><span class="token punctuation">{</span><span class="token comment">/* 这里所有国家都是这个，不需要国际化 */</span><span class="token punctuation">}</span><span class="token plain-text">\n              XPILOT\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Tween</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AnimationBg</span></span><span class="token punctuation">></span></span>\n      <span class="token punctuation">}</span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>l.div</span><span class="token punctuation">></span></span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> Index</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="react-gsap-2"><a href="#react-gsap-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-gsap</h4>\n<p>后期需要实现 <code class="language-text">切屏 + 固定页面</code> 的效果，暂未实现</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29072526676195287000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { Children, cloneElement, useRef, useEffect, useState } from \'react\';\nimport { gsap } from \'gsap\';\nimport produce from \'immer\';\n\nimport { getDocument } from \'@/utils\';\n\nif (getDocument()) {\n   import(\'gsap/ScrollTrigger\').then((component) => {\n      const ScrollTrigger = component.default;\n      gsap.registerPlugin(ScrollTrigger);\n   });\n}\nconst ReactScrollMagic = ({ children }) => {\n   const revealRefs = useRef([]);\n   const [updateParams, setUpdateParams] = useState([]);\n   revealRefs.current = [];\n\n   useEffect(() => {\n      revealRefs.current.forEach((el, index) => {\n         gsap.from(el, {\n            scrollTrigger: {\n               trigger: el,\n               pin: true,\n               start: \'top top\',\n               end: \'+=300%\',\n               markers: true,\n               anticipatePin: 2, // 滑动过快时的“防抖”参数\n               onUpdate: (self) => {\n                  console.log(\n                     self,\n                     \'progress:\',\n                     self.isActive,\n                     self.progress.toFixed(3),\n                     \'direction:\',\n                     self.direction,\n                     \'velocity\',\n                     self.getVelocity()\n                  );\n                  const { progress, isActive } = self;\n                  setUpdateParams(\n                     produce((draftState) => {\n                        draftState[index] = {\n                           progress,\n                           isActive\n                        };\n                     })\n                  );\n               }\n            }\n         });\n      });\n   }, []);\n\n   const addToRefs = (el, index) => {\n      if (el && !revealRefs.current.includes(el)) {\n         revealRefs.current[index] = el;\n      }\n      console.log(revealRefs.current);\n   };\n\n   return Children.map(children, (item, index) => {\n      // const sceneProps = {\n      //   ...defaultSceneProps,\n      //   ...item.props.sceneProps\n      // }\n      return (\n         <div ref={(el) => addToRefs(el, index)}>\n            {cloneElement(item, {\n               ...item.props,\n               sceneParams: updateParams[index] || {}\n            })}\n         </div>\n      );\n   });\n};\n\nexport default ReactScrollMagic;`, `29072526676195287000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> Children<span class="token punctuation">,</span> cloneElement<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> gsap <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'gsap\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> produce <span class="token keyword">from</span> <span class="token string">\'immer\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> getDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'gsap/ScrollTrigger\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">component</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> ScrollTrigger <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">;</span>\n      gsap<span class="token punctuation">.</span><span class="token function">registerPlugin</span><span class="token punctuation">(</span>ScrollTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">const</span> <span class="token function-variable function">ReactScrollMagic</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> revealRefs <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>updateParams<span class="token punctuation">,</span> setUpdateParams<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   revealRefs<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      revealRefs<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         gsap<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            scrollTrigger<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n               trigger<span class="token punctuation">:</span> el<span class="token punctuation">,</span>\n               pin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               start<span class="token punctuation">:</span> <span class="token string">\'top top\'</span><span class="token punctuation">,</span>\n               end<span class="token punctuation">:</span> <span class="token string">\'+=300%\'</span><span class="token punctuation">,</span>\n               markers<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n               anticipatePin<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 滑动过快时的“防抖”参数</span>\n               <span class="token function-variable function">onUpdate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">self</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>\n                     self<span class="token punctuation">,</span>\n                     <span class="token string">\'progress:\'</span><span class="token punctuation">,</span>\n                     self<span class="token punctuation">.</span>isActive<span class="token punctuation">,</span>\n                     self<span class="token punctuation">.</span>progress<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                     <span class="token string">\'direction:\'</span><span class="token punctuation">,</span>\n                     self<span class="token punctuation">.</span>direction<span class="token punctuation">,</span>\n                     <span class="token string">\'velocity\'</span><span class="token punctuation">,</span>\n                     self<span class="token punctuation">.</span><span class="token function">getVelocity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n                  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n                  <span class="token keyword">const</span> <span class="token punctuation">{</span> progress<span class="token punctuation">,</span> isActive <span class="token punctuation">}</span> <span class="token operator">=</span> self<span class="token punctuation">;</span>\n                  <span class="token function">setUpdateParams</span><span class="token punctuation">(</span>\n                     <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">draftState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                        draftState<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n                           progress<span class="token punctuation">,</span>\n                           isActive\n                        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n                     <span class="token punctuation">}</span><span class="token punctuation">)</span>\n                  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n               <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> <span class="token function-variable function">addToRefs</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>el <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>revealRefs<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         revealRefs<span class="token punctuation">.</span>current<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> el<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>revealRefs<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> Children<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// const sceneProps = {</span>\n      <span class="token comment">//   ...defaultSceneProps,</span>\n      <span class="token comment">//   ...item.props.sceneProps</span>\n      <span class="token comment">// }</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>\n         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">addToRefs</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span><span class="token function">cloneElement</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n               <span class="token operator">...</span>item<span class="token punctuation">.</span>props<span class="token punctuation">,</span>\n               sceneParams<span class="token punctuation">:</span> updateParams<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> ReactScrollMagic<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-2"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<h4 id="react-scrollmagic-1"><a href="#react-scrollmagic-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-scrollmagic</h4>\n<!-- <iframe data-src="https://codesandbox.io/embed/6t81il?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nxqttn?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="react-gsap-3"><a href="#react-gsap-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>react-gsap</h4>\n<!-- <iframe data-src="https://codesandbox.io/embed/jhqw77?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/wjdr88?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="视频进度同步--缩放动效"><a href="#%E8%A7%86%E9%A2%91%E8%BF%9B%E5%BA%A6%E5%90%8C%E6%AD%A5--%E7%BC%A9%E6%94%BE%E5%8A%A8%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视频进度同步 / 缩放动效</h2>\n<h3 id="需求背景-4"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>实现功能如下：</p>\n<ol>\n<li>页面往下完全滚动到第二屏时，视频开始播放，鼠标的滚动一段距离后，触发视频缩小到右下角视频的动效</li>\n<li>文字、图片有缩放效果</li>\n</ol>\n<p>实现要点如下：</p>\n<ol>\n<li>视频在视口范围内只会播放一次，完全离开视口重置播放进度，完全进入视口播放视频</li>\n<li>由 2 个视频拼接而成，触发缩放的瞬间进度需要同步（在视频未播放完成的情况下需要同步）</li>\n<li>过渡时需要使用 visibility 来控制显隐</li>\n</ol>\n<p>实现如下所示的动效：</p>\n<p><html><head></head><body><video data-src="/examples/international-official-website-technical-difficulties/video-sync-scale-play.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></video></p>\n<h3 id="选型过程-3"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h3>\n<p>同 <code class="language-text">逐行显示</code>、<code class="language-text">固定页面滚动控制</code> 的选型过程</p>\n<h3 id="核心代码-3"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<p>web/pages/p7/components/learnMore/index.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5718073810710811000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { useState, useRef, useEffect } from \'react\'\nimport { useTranslation } from \'react-i18next\'\nimport classNames from \'classnames\'\nimport { useInViewport } from \'ahooks\'\nimport { isNumber } from \'lodash\'\n\nimport { SceneProps } from \'@/components/reactScrollMagic\'\nimport { l, VideoRef } from \'@/components/lazyLoader\'\n\nimport { getAnimateProgresses } from \'@/utils/animate\'\n\nimport useStoreContext, { CLIENT_TYPE } from \'@/hooks/useStoreContext\'\n\nimport ModelLearnMore from \'../modelLearnMore\'\n\nimport styles from \'./index.module.less\'\n\nexport type VisibleComponent = \'JsmpegPlayer\' | \'ModelLearnMore\'\n\nconst MAX_THRESHOLD = 0.99\nconst MIN_THRESHOLD = 0.01\nconst THRESHOLD = [MIN_THRESHOLD, MAX_THRESHOLD]\n\nconst Index = ({\n  sceneParams\n}: SceneProps) => {\n  const { t } = useTranslation()\n  const getValue = (param: string) => t(\\`p7.learnMore.\\${param}\\`)\n\n  const {\n    progress = 0\n  } = sceneParams || {}\n\n  const [modelLearnMoreProgress] = getAnimateProgresses(progress, [\n    {\n      start: 1 / 2,\n      duration: 1 / 2\n    }\n  ])\n\n  // 设置哪个组件可见\n  const [visibleComponent, setVisibleComponent] = useState<VisibleComponent>(\'JsmpegPlayer\')\n\n  const { state } = useStoreContext()\n\n  const videoRef = useRef<VideoRef>(null)\n  const miniVideoRef = useRef<VideoRef>(null)\n\n  const containerRef = useRef(null)\n  const [_, ratio] = useInViewport(containerRef, {\n    threshold: THRESHOLD\n  })\n\n  const [isPlayed, setIsPlayed] = useState(false)\n\n  useEffect(() => {\n    if (state?.clientType === CLIENT_TYPE.H5) {\n      return\n    }\n\n    const videoDom = videoRef.current?.getVideoElement()\n    const miniVideoDom = miniVideoRef.current?.getVideoElement()\n    if (!isNumber(ratio) || !videoDom || !miniVideoDom) {\n      return\n    }\n\n    if (ratio > MAX_THRESHOLD && !isPlayed && visibleComponent === \'JsmpegPlayer\') {\n      videoDom.play()\n      setIsPlayed(true)\n    }\n\n    if (ratio > MAX_THRESHOLD && !isPlayed && visibleComponent === \'ModelLearnMore\') {\n      miniVideoDom.play()\n      setIsPlayed(true)\n    }\n\n    if (ratio < MIN_THRESHOLD) {\n      videoDom.currentTime = 0\n      videoDom.pause()\n\n      miniVideoDom.currentTime = 0\n      miniVideoDom.pause()\n      setIsPlayed(false)\n    }\n  }, [ratio, visibleComponent, isPlayed])\n\n  useEffect(() => {\n    if (state?.clientType === CLIENT_TYPE.H5) {\n      return\n    }\n\n    const videoDom = videoRef.current?.getVideoElement()\n    const miniVideoDom = miniVideoRef.current?.getVideoElement()\n    if (!videoDom || !miniVideoDom) {\n      return\n    }\n\n    if (visibleComponent === \'ModelLearnMore\') {\n      miniVideoDom.currentTime = videoDom.currentTime\n      if (miniVideoDom.currentTime < miniVideoDom.duration) {\n        miniVideoDom.play()\n      }\n    } else {\n      videoDom.currentTime = miniVideoDom.currentTime\n      if (videoDom.currentTime < videoDom.duration) {\n        videoDom.play()\n      }\n    }\n  }, [visibleComponent])\n\n  let miniVideoProps = {\n    type: \'video\',\n    srcPoster: \'/public/p7/learn-more/p7-wing@mini.jpg\',\n    src: \'/public/p7/learn-more/p7-wing-origin-fast.mp4\'\n  }\n\n  if (state?.clientType === CLIENT_TYPE.PC) {\n    miniVideoProps = {\n      ...miniVideoProps,\n      loop: false,\n      autoPlay: false,\n      ref: miniVideoRef,\n      isNeedScale: true\n    }\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className={styles.container}\n    >\n      {\n        state?.clientType === CLIENT_TYPE.PC && <l.video\n          ref={videoRef}\n          loop={false}\n          autoPlay={false}\n          src=&quot;/public/p7/learn-more/p7-wing-origin-fast.mp4&quot;\n          className={classNames(styles.player, visibleComponent !== \'JsmpegPlayer\' ? styles.hidden : \'\')}\n        />\n      }\n      <ModelLearnMore\n        className={state?.clientType === CLIENT_TYPE.PC && visibleComponent !== \'ModelLearnMore\' ? styles.hidden : \'\'}\n        progress={state?.clientType === CLIENT_TYPE.PC ? modelLearnMoreProgress : 100}\n        modelCenterTextProps={{\n          topSubTitle: getValue(\'topSubTitle\'),\n          title: getValue(\'title\'),\n          subTitle: getValue(\'subTitle\'),\n          shortDesc: getValue(\'shortDesc\'),\n          buttonText: getValue(\'button\'),\n          animation: state?.clientType === CLIENT_TYPE.H5\n        }}\n        onSetVisibleComponent={setVisibleComponent}\n        displayersProps={[\n          {\n            src: \'/public/p7/learn-more/p7-p2-1.jpg\',\n            srcSet: \'/public/p7/learn-more/p7-p2-1@2x.jpg\'\n          },\n          {\n            src: \'/public/p7/learn-more/p7-p2-2.jpg\',\n            srcSet: \'/public/p7/learn-more/p7-p2-2@2x.jpg\',\n            minSrcSet: \'/public/p7/learn-more/p7-p2-2@mini.jpg\'\n          },\n          miniVideoProps\n        ]}\n        itemList={[\n          {\n            imgList: [{\n              src: \'/public/p7/d1/P7-d1-1-3.jpg\',\n              srcSet: \'/public/p7/d1/P7-d1-1-3@2x.jpg\'\n            }, {\n              src: \'/public/p7/d1/P7-d1-1-1.jpg\',\n              srcSet: \'/public/p7/d1/P7-d1-1-1@2x.jpg\'\n            }, {\n              src: \'/public/p7/d1/P7-d1-1-2.jpg\',\n              srcSet: \'/public/p7/d1/P7-d1-1-2@2x.jpg\'\n            }],\n            background: \'linear-gradient(133deg, #343538 0%, #000102 100%)\',\n            textData: {\n              topSubTitle: t(\'p7.d1.topSubTitle1\'),\n              title: t(\'p7.d1.title1\'),\n              subTitle: t(\'p7.d1.subTitle1\')\n            }\n          },\n          {\n            imgList: [{\n              src: \'/public/p7/d1/P7-d1-2-3.jpg\',\n              srcSet: \'/public/p7/d1/P7-d1-2-3@2x.jpg\'\n            }, {\n              src: \'/public/p7/d1/P7-d1-2-1.jpg\',\n              srcSet: \'/public/p7/d1/P7-d1-2-1@2x.jpg\'\n            }, {\n              src: \'/public/p7/d1/P7-d1-2-2.jpg\',\n              srcSet: \'/public/p7/d1/P7-d1-2-2@2x.jpg\'\n            }],\n            background: \'linear-gradient(133deg, #B6CBDA 0%, #7A97AF 100%)\',\n            textData: {\n              topSubTitle: t(\'p7.d1.topSubTitle2\'),\n              title: t(\'p7.d1.title2\'),\n              subTitle: t(\'p7.d1.subTitle2\')\n            }\n          },\n          {\n            imgList: [{\n              src: \'/public/p7/d1/P7-d1-3-1.mp4\'\n            }, {\n              src: \'/public/p7/d1/P7-d1-3-2.jpg\',\n              srcSet: \'/public/p7/d1/P7-d1-3-2@2x.jpg\'\n            }],\n            background: \'linear-gradient(133deg, #343538 0%, #000102 100%)\',\n            textData: {\n              topSubTitle: t(\'p7.d1.topSubTitle3\'),\n              title: t(\'p7.d1.title3\'),\n              subTitle: t(\'p7.d1.subTitle3\')\n            }\n          }\n        ]}\n      />\n    </div>\n  )\n}\n\nexport default Index`, `5718073810710811000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useTranslation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-i18next\'</span>\n<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useInViewport <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> isNumber <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'lodash\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> SceneProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/reactScrollMagic\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> l<span class="token punctuation">,</span> VideoRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/lazyLoader\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> getAnimateProgresses <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils/animate\'</span>\n\n<span class="token keyword">import</span> useStoreContext<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">CLIENT_TYPE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/hooks/useStoreContext\'</span>\n\n<span class="token keyword">import</span> ModelLearnMore <span class="token keyword">from</span> <span class="token string">\'../modelLearnMore\'</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> VisibleComponent <span class="token operator">=</span> <span class="token string">\'JsmpegPlayer\'</span> <span class="token operator">|</span> <span class="token string">\'ModelLearnMore\'</span>\n\n<span class="token keyword">const</span> <span class="token constant">MAX_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">0.99</span>\n<span class="token keyword">const</span> <span class="token constant">MIN_THRESHOLD</span> <span class="token operator">=</span> <span class="token number">0.01</span>\n<span class="token keyword">const</span> <span class="token constant">THRESHOLD</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">MIN_THRESHOLD</span><span class="token punctuation">,</span> <span class="token constant">MAX_THRESHOLD</span><span class="token punctuation">]</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Index</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>\n  sceneParams\n<span class="token punctuation">}</span><span class="token punctuation">:</span> SceneProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTranslation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">param<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">p7.learnMore.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>param<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">{</span>\n    progress <span class="token operator">=</span> <span class="token number">0</span>\n  <span class="token punctuation">}</span> <span class="token operator">=</span> sceneParams <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>modelLearnMoreProgress<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getAnimateProgresses</span><span class="token punctuation">(</span>progress<span class="token punctuation">,</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      start<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>\n      duration<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token comment">// 设置哪个组件可见</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>visibleComponent<span class="token punctuation">,</span> setVisibleComponent<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">VisibleComponent</span></span><span class="token punctuation">></span></span><span class="token plain-text">(\'JsmpegPlayer\')\n\n  const </span><span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token plain-text"> = useStoreContext()\n\n  const videoRef = useRef</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">VideoRef</span></span><span class="token punctuation">></span></span><span class="token plain-text">(null)\n  const miniVideoRef = useRef</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">VideoRef</span></span><span class="token punctuation">></span></span><span class="token plain-text">(null)\n\n  const containerRef = useRef(null)\n  const [_, ratio] = useInViewport(containerRef, </span><span class="token punctuation">{</span>\n    threshold<span class="token punctuation">:</span> <span class="token constant">THRESHOLD</span>\n  <span class="token punctuation">}</span><span class="token plain-text">)\n\n  const [isPlayed, setIsPlayed] = useState(false)\n\n  useEffect(() => </span><span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">H5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">const</span> videoDom <span class="token operator">=</span> videoRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getVideoElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> miniVideoDom <span class="token operator">=</span> miniVideoRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getVideoElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNumber</span><span class="token punctuation">(</span>ratio<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>videoDom <span class="token operator">||</span> <span class="token operator">!</span>miniVideoDom<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>ratio <span class="token operator">></span> <span class="token constant">MAX_THRESHOLD</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isPlayed <span class="token operator">&amp;&amp;</span> visibleComponent <span class="token operator">===</span> <span class="token string">\'JsmpegPlayer\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      videoDom<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token function">setIsPlayed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>ratio <span class="token operator">></span> <span class="token constant">MAX_THRESHOLD</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isPlayed <span class="token operator">&amp;&amp;</span> visibleComponent <span class="token operator">===</span> <span class="token string">\'ModelLearnMore\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      miniVideoDom<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token function">setIsPlayed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>ratio <span class="token operator">&lt;</span> <span class="token constant">MIN_THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      videoDom<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0</span>\n      videoDom<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n      miniVideoDom<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0</span>\n      miniVideoDom<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token function">setIsPlayed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token plain-text">, [ratio, visibleComponent, isPlayed])\n\n  useEffect(() => </span><span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">H5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">const</span> videoDom <span class="token operator">=</span> videoRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getVideoElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> miniVideoDom <span class="token operator">=</span> miniVideoRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">getVideoElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>videoDom <span class="token operator">||</span> <span class="token operator">!</span>miniVideoDom<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>visibleComponent <span class="token operator">===</span> <span class="token string">\'ModelLearnMore\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      miniVideoDom<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> videoDom<span class="token punctuation">.</span>currentTime\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>miniVideoDom<span class="token punctuation">.</span>currentTime <span class="token operator">&lt;</span> miniVideoDom<span class="token punctuation">.</span>duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        miniVideoDom<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      videoDom<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> miniVideoDom<span class="token punctuation">.</span>currentTime\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>videoDom<span class="token punctuation">.</span>currentTime <span class="token operator">&lt;</span> videoDom<span class="token punctuation">.</span>duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        videoDom<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token plain-text">, [visibleComponent])\n\n  let miniVideoProps = </span><span class="token punctuation">{</span>\n    <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'video\'</span><span class="token punctuation">,</span>\n    srcPoster<span class="token punctuation">:</span> <span class="token string">\'/public/p7/learn-more/p7-wing@mini.jpg\'</span><span class="token punctuation">,</span>\n    src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/learn-more/p7-wing-origin-fast.mp4\'</span>\n  <span class="token punctuation">}</span><span class="token plain-text">\n\n  if (state?.clientType === CLIENT_TYPE.PC) </span><span class="token punctuation">{</span>\n    miniVideoProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token operator">...</span>miniVideoProps<span class="token punctuation">,</span>\n      loop<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      autoPlay<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      ref<span class="token punctuation">:</span> miniVideoRef<span class="token punctuation">,</span>\n      isNeedScale<span class="token punctuation">:</span> <span class="token boolean">true</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token plain-text">\n\n  return (\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n      <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>containerRef<span class="token punctuation">}</span></span>\n      <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span></span>\n    <span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>\n        state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>l.video</span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>videoRef<span class="token punctuation">}</span></span>\n          <span class="token attr-name">loop</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">autoPlay</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p7/learn-more/p7-wing-origin-fast.mp4<span class="token punctuation">"</span></span>\n          <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span>styles<span class="token punctuation">.</span>player<span class="token punctuation">,</span> visibleComponent <span class="token operator">!==</span> <span class="token string">\'JsmpegPlayer\'</span> <span class="token operator">?</span> styles<span class="token punctuation">.</span>hidden <span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span>\n      <span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ModelLearnMore</span></span>\n        <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">&amp;&amp;</span> visibleComponent <span class="token operator">!==</span> <span class="token string">\'ModelLearnMore\'</span> <span class="token operator">?</span> styles<span class="token punctuation">.</span>hidden <span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">}</span></span>\n        <span class="token attr-name">progress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">?</span> modelLearnMoreProgress <span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span></span>\n        <span class="token attr-name">modelCenterTextProps</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n          topSubTitle<span class="token punctuation">:</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'topSubTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          title<span class="token punctuation">:</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'title\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          subTitle<span class="token punctuation">:</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'subTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          shortDesc<span class="token punctuation">:</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'shortDesc\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          buttonText<span class="token punctuation">:</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          animation<span class="token punctuation">:</span> state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">H5</span>\n        <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n        <span class="token attr-name">onSetVisibleComponent</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>setVisibleComponent<span class="token punctuation">}</span></span>\n        <span class="token attr-name">displayersProps</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/learn-more/p7-p2-1.jpg\'</span><span class="token punctuation">,</span>\n            srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/learn-more/p7-p2-1@2x.jpg\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/learn-more/p7-p2-2.jpg\'</span><span class="token punctuation">,</span>\n            srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/learn-more/p7-p2-2@2x.jpg\'</span><span class="token punctuation">,</span>\n            minSrcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/learn-more/p7-p2-2@mini.jpg\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          miniVideoProps\n        <span class="token punctuation">]</span><span class="token punctuation">}</span></span>\n        <span class="token attr-name">itemList</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-1-3.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-1-3@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-1-1.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-1-1@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-1-2.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-1-2@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(133deg, #343538 0%, #000102 100%)\'</span><span class="token punctuation">,</span>\n            textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.topSubTitle1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.title1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.subTitle1\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-2-3.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-2-3@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-2-1.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-2-1@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-2-2.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-2-2@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(133deg, #B6CBDA 0%, #7A97AF 100%)\'</span><span class="token punctuation">,</span>\n            textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.topSubTitle2\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.title2\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.subTitle2\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-3-1.mp4\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-3-2.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p7/d1/P7-d1-3-2@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(133deg, #343538 0%, #000102 100%)\'</span><span class="token punctuation">,</span>\n            textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.topSubTitle3\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.title3\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p7.d1.subTitle3\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span><span class="token punctuation">}</span></span>\n      <span class="token punctuation">/></span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n  )\n}\n\nexport default Index</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>web/pages/p7/components/modelLearnMore/index.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73413563154175480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { useEffect, useState, Dispatch, SetStateAction, useRef } from \'react\'\nimport classNames from \'classnames\'\nimport { Tween, PlayState, Timeline } from \'react-gsap\'\nimport { useSize } from \'ahooks\'\n\nimport { l, ImgProps, VideoProps } from \'@/components/lazyLoader\'\nimport XButton from \'@/components/xButton\'\nimport ModelCenterText, { ModelCenterTextProps } from \'@/components/modelCenterText\'\nimport AnimationBg from \'@/components/animationBg\'\n\nimport useTmpComponent, { ImgAndTextSwiperProps } from \'@/hooks/useTmpComponent\'\n\nimport { evaluateCalc, getDocument } from \'@/utils\'\n\nimport { VisibleComponent } from \'../../components/learnMore\'\n\nimport styles from \'./index.module.less\'\n\ntype Repeat<T, C extends number, U extends any[] = []> =\n  U[\'length\'] extends C ? U : Repeat<T, C, [...U, T]>\n\ntype DisplayerProps = ((ImgProps & { type?: \'img\'}) | (VideoProps & { type?: \'video\' })) & {\n  isNeedScale?: boolean\n}\n\ninterface ModelLearnMoreProps {\n  modelCenterTextProps: ModelCenterTextProps\n  displayersProps: Repeat<DisplayerProps, 3>\n  progress?: number\n  className?: string\n  onSetVisibleComponent?: Dispatch<SetStateAction<VisibleComponent>>\n}\n\nconst ModelLearnMore = ({\n  modelCenterTextProps,\n  displayersProps,\n  itemList = [],\n  progress = 0,\n  className,\n  onSetVisibleComponent\n}: ModelLearnMoreProps & ImgAndTextSwiperProps) => {\n  const { api, Slot } = useTmpComponent()\n\n  const getFromProps = () => {\n    const startBottom = \'calc((100vh - var(--top-menu-height) - 35.72916667rem) / 2 / 2)\'\n    const startRight = \'calc((100vw - 71.875rem - 0.520833rem) / 2 / 2)\'\n\n    return {\n      // 满屏高度减去顶部菜单减去外部容器高度，然后除以 2，得到下边距高度，最后还要由于外层放大，还要除以 2\n      // bottom: \'calc(0px - (100vh - var(--top-menu-height) - 35.72916667rem) / 2 / 2)\',\n      // right: \'calc(0px - (100vw - 71.875rem) / 2 / 2)\',\n      bottom: \\`-\\${evaluateCalc(startBottom)}px\\`,\n      right: \\`-\\${evaluateCalc(startRight)}px\\`,\n      width: \'calc(100vw - 0.520833rem)\',\n      height: \'100vh\',\n      scale: 0.5\n    }\n  }\n\n  const tweenRef = useRef(null)\n  const size = useSize(getDocument()?.documentElement)\n  useEffect(() => {\n    if (!tweenRef.current) {\n      return\n    }\n\n    tweenRef.current.getGSAP().vars = {\n      ...tweenRef.current.getGSAP().vars,\n      startAt: getFromProps()\n    }\n  }, [size])\n\n  const timerRef = useRef<NodeJS.Timeout>()\n  // 触发型动画，需要延迟控制组件的可见性，否则动画播放不全\n  useEffect(() => {\n    if (progress >= 0) {\n      onSetVisibleComponent && onSetVisibleComponent(\'ModelLearnMore\')\n    } else {\n      timerRef.current = setTimeout(() => {\n        onSetVisibleComponent && onSetVisibleComponent(\'JsmpegPlayer\')\n      }, 800)\n    }\n    return () => {\n      timerRef.current && clearTimeout(timerRef.current)\n    }\n  }, [progress])\n\n  const { buttonText, ...rest } = modelCenterTextProps\n  return (\n    <AnimationBg type={1} className={className}>\n      <Slot\n        itemList={itemList}\n        pageType = \'P7Wing\'\n        modelType=\'P7\'\n        buttonType=\'LearnMore\'\n      />\n      <div ref={ref} className={classNames(\'full-page-with-top-menu\', styles.container)}>\n        <Tween\n          from={{\n            scale: 2\n          }}\n          duration={0.8}\n          playState={progress > 0 ? PlayState.play : PlayState.reverse}\n        >\n          <div className={classNames(\'body\', styles.body)}>\n            <ModelCenterText\n              className={styles.titleContainer}\n              {...rest}\n            />\n            <div className={styles.displayerContainer}>\n              {\n                displayersProps.map((item, index) => {\n                  const {\n                    type = \'img\',\n                    isNeedScale,\n                    ...rest\n                  } = item\n                  const Component = l[type]\n                  if (isNeedScale) {\n                    return (\n                      <Timeline\n                        playState={progress > 0 ? PlayState.play : PlayState.reverse}\n                        target={\n                          <>\n                            <div className={styles[\\`displayerContainer\\${index + 1}\\`]}>\n                              <Component\n                                className={styles.displayer}\n                                {...rest}\n                              />\n                            </div>\n                          </>\n                        }\n                      >\n                        <Tween\n                          ref={tweenRef}\n                          from={getFromProps()}\n                          to={{\n                            width: \'23.65rem\',\n                            height: \'13.33rem\',\n                            bottom: 0,\n                            right: 0,\n                            scale: 1\n                          }}\n                          target={0}\n                        />\n                      </Timeline>\n                    )\n                  }\n                  return (<div className={styles[\\`displayerContainer\\${index + 1}\\`]}>\n                    <Component\n                      className={styles.displayer}\n                      {...rest}\n                    />\n                  </div>)\n                })\n              }\n            </div>\n            <XButton\n              type=&quot;primary&quot;\n              className={styles.button}\n              onClick={() => {\n                api.current?.open()\n              }\n              }\n            >\n              {buttonText}\n            </XButton>\n          </div>\n        </Tween>\n      </div>\n    </AnimationBg>\n  )\n}\n\nexport default ModelLearnMore`, `73413563154175480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> Dispatch<span class="token punctuation">,</span> SetStateAction<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Tween<span class="token punctuation">,</span> PlayState<span class="token punctuation">,</span> Timeline <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-gsap\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useSize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> l<span class="token punctuation">,</span> ImgProps<span class="token punctuation">,</span> VideoProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/lazyLoader\'</span>\n<span class="token keyword">import</span> XButton <span class="token keyword">from</span> <span class="token string">\'@/components/xButton\'</span>\n<span class="token keyword">import</span> ModelCenterText<span class="token punctuation">,</span> <span class="token punctuation">{</span> ModelCenterTextProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/modelCenterText\'</span>\n<span class="token keyword">import</span> AnimationBg <span class="token keyword">from</span> <span class="token string">\'@/components/animationBg\'</span>\n\n<span class="token keyword">import</span> useTmpComponent<span class="token punctuation">,</span> <span class="token punctuation">{</span> ImgAndTextSwiperProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/hooks/useTmpComponent\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> evaluateCalc<span class="token punctuation">,</span> getDocument <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> VisibleComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'../../components/learnMore\'</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span>\n\n<span class="token keyword">type</span> Repeat<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">C</span> <span class="token keyword">extends</span> <span class="token class-name">number</span><span class="token punctuation">,</span> <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token operator">=</span>\n  <span class="token constant">U</span><span class="token punctuation">[</span><span class="token string">\'length\'</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">C</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token punctuation">:</span> Repeat<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">></span>\n\n<span class="token keyword">type</span> DisplayerProps <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ImgProps <span class="token operator">&amp;</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">\'img\'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>VideoProps <span class="token operator">&amp;</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">\'video\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span>\n  isNeedScale<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">ModelLearnMoreProps</span> <span class="token punctuation">{</span>\n  modelCenterTextProps<span class="token punctuation">:</span> ModelCenterTextProps\n  displayersProps<span class="token punctuation">:</span> Repeat<span class="token operator">&lt;</span>DisplayerProps<span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">></span>\n  progress<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span>\n  className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span>\n  onSetVisibleComponent<span class="token operator">?</span><span class="token punctuation">:</span> Dispatch<span class="token operator">&lt;</span>SetStateAction<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">VisibleComponent</span></span><span class="token punctuation">></span></span><span class="token plain-text">>\n}\n\nconst ModelLearnMore = ({\n  modelCenterTextProps,\n  displayersProps,\n  itemList = [],\n  progress = 0,\n  className,\n  onSetVisibleComponent\n}: ModelLearnMoreProps &amp; ImgAndTextSwiperProps) => </span><span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> api<span class="token punctuation">,</span> Slot <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTmpComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">getFromProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> startBottom <span class="token operator">=</span> <span class="token string">\'calc((100vh - var(--top-menu-height) - 35.72916667rem) / 2 / 2)\'</span>\n    <span class="token keyword">const</span> startRight <span class="token operator">=</span> <span class="token string">\'calc((100vw - 71.875rem - 0.520833rem) / 2 / 2)\'</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 满屏高度减去顶部菜单减去外部容器高度，然后除以 2，得到下边距高度，最后还要由于外层放大，还要除以 2</span>\n      <span class="token comment">// bottom: \'calc(0px - (100vh - var(--top-menu-height) - 35.72916667rem) / 2 / 2)\',</span>\n      <span class="token comment">// right: \'calc(0px - (100vw - 71.875rem) / 2 / 2)\',</span>\n      bottom<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">evaluateCalc</span><span class="token punctuation">(</span>startBottom<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n      right<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">evaluateCalc</span><span class="token punctuation">(</span>startRight<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n      width<span class="token punctuation">:</span> <span class="token string">\'calc(100vw - 0.520833rem)\'</span><span class="token punctuation">,</span>\n      height<span class="token punctuation">:</span> <span class="token string">\'100vh\'</span><span class="token punctuation">,</span>\n      scale<span class="token punctuation">:</span> <span class="token number">0.5</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> tweenRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token function">useSize</span><span class="token punctuation">(</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span>\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tweenRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n\n    tweenRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getGSAP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>vars <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token operator">...</span>tweenRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getGSAP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>vars<span class="token punctuation">,</span>\n      startAt<span class="token punctuation">:</span> <span class="token function">getFromProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> timerRef <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NodeJS.Timeout</span></span><span class="token punctuation">></span></span><span class="token plain-text">()\n  // 触发型动画，需要延迟控制组件的可见性，否则动画播放不全\n  useEffect(() => </span><span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      onSetVisibleComponent <span class="token operator">&amp;&amp;</span> <span class="token function">onSetVisibleComponent</span><span class="token punctuation">(</span><span class="token string">\'ModelLearnMore\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      timerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        onSetVisibleComponent <span class="token operator">&amp;&amp;</span> <span class="token function">onSetVisibleComponent</span><span class="token punctuation">(</span><span class="token string">\'JsmpegPlayer\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      timerRef<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timerRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token plain-text">, [progress])\n\n  const </span><span class="token punctuation">{</span> buttonText<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span><span class="token plain-text"> = modelCenterTextProps\n  return (\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AnimationBg</span></span> <span class="token attr-name">type</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      &lt;Slot\n        itemList=</span><span class="token punctuation">{</span>itemList<span class="token punctuation">}</span><span class="token plain-text">\n        pageType = \'P7Wing\'\n        modelType=\'P7\'\n        buttonType=\'LearnMore\'\n      />\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">\'full-page-with-top-menu\'</span><span class="token punctuation">,</span> styles<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tween</span></span>\n          <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n            scale<span class="token punctuation">:</span> <span class="token number">2</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">duration</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">0.8</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">playState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>progress <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> PlayState<span class="token punctuation">.</span>play <span class="token punctuation">:</span> PlayState<span class="token punctuation">.</span>reverse<span class="token punctuation">}</span></span>\n        <span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">,</span> styles<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ModelCenterText</span></span>\n              <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>titleContainer<span class="token punctuation">}</span></span>\n              <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">rest</span><span class="token punctuation">}</span></span>\n            <span class="token punctuation">/></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>displayerContainer<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n              </span><span class="token punctuation">{</span>\n                displayersProps<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  <span class="token keyword">const</span> <span class="token punctuation">{</span>\n                    <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">\'img\'</span><span class="token punctuation">,</span>\n                    isNeedScale<span class="token punctuation">,</span>\n                    <span class="token operator">...</span>rest\n                  <span class="token punctuation">}</span> <span class="token operator">=</span> item\n                  <span class="token keyword">const</span> Component <span class="token operator">=</span> l<span class="token punctuation">[</span><span class="token keyword">type</span><span class="token punctuation">]</span>\n                  <span class="token keyword">if</span> <span class="token punctuation">(</span>isNeedScale<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n                      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Timeline</span></span>\n                        <span class="token attr-name">playState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>progress <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> PlayState<span class="token punctuation">.</span>play <span class="token punctuation">:</span> PlayState<span class="token punctuation">.</span>reverse<span class="token punctuation">}</span></span>\n                        <span class="token attr-name">target</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>\n                          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n                            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">displayerContainer</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n                              </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span>\n                                <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>displayer<span class="token punctuation">}</span></span>\n                                <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">rest</span><span class="token punctuation">}</span></span>\n                              <span class="token punctuation">/></span></span><span class="token plain-text">\n                            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n                          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>\n                        <span class="token punctuation">}</span></span>\n                      <span class="token punctuation">></span></span><span class="token plain-text">\n                        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Tween</span></span>\n                          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>tweenRef<span class="token punctuation">}</span></span>\n                          <span class="token attr-name">from</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getFromProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n                          <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n                            width<span class="token punctuation">:</span> <span class="token string">\'23.65rem\'</span><span class="token punctuation">,</span>\n                            height<span class="token punctuation">:</span> <span class="token string">\'13.33rem\'</span><span class="token punctuation">,</span>\n                            bottom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n                            right<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n                            scale<span class="token punctuation">:</span> <span class="token number">1</span>\n                          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n                          <span class="token attr-name">target</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span></span>\n                        <span class="token punctuation">/></span></span><span class="token plain-text">\n                      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Timeline</span></span><span class="token punctuation">></span></span>\n                    <span class="token punctuation">)</span>\n                  <span class="token punctuation">}</span>\n                  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">displayerContainer</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n                    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span>\n                      <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>displayer<span class="token punctuation">}</span></span>\n                      <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">rest</span><span class="token punctuation">}</span></span>\n                    <span class="token punctuation">/></span></span><span class="token plain-text">\n                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>\n                <span class="token punctuation">}</span><span class="token punctuation">)</span>\n              <span class="token punctuation">}</span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XButton</span></span>\n              <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span>\n              <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>button<span class="token punctuation">}</span></span>\n              <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                api<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n              <span class="token punctuation">}</span>\n              <span class="token punctuation">}</span></span>\n            <span class="token punctuation">></span></span><span class="token plain-text">\n              </span><span class="token punctuation">{</span>buttonText<span class="token punctuation">}</span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XButton</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Tween</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AnimationBg</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n  )\n}\n\nexport default ModelLearnMore</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="优化"><a href="#%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h3>\n<h4 id="计算-calc-的实际-px-值"><a href="#%E8%AE%A1%E7%AE%97-calc-%E7%9A%84%E5%AE%9E%E9%99%85-px-%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>计算 calc 的实际 px 值</h4>\n<p>web/utils/index.ts</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95890834291499530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 只支持计算值为正值\nexport const evaluateCalc = (expression: string, container = getDocument()?.body) => {\n  // 不能加以下代码，影响动效\n  // if (!container || !Object.keys(container).length) {\n  //   return 0\n  // }\n  if (!__isBrowser__) {\n    return 0\n  }\n  const el = document.createElement(\'div\')\n  el.style.position = \'absolute\'\n  el.style.visibility = \'hidden\'\n  el.innerHTML = \\`<div style=&quot;width: \\${expression}&quot;></div>\\`\n  container.insertBefore(el, container.firstChild)\n  const calcPx = el.clientWidth\n  container.removeChild(el)\n  return calcPx\n}`, `95890834291499530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 只支持计算值为正值</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">evaluateCalc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">expression<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> container <span class="token operator">=</span> <span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>body</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// 不能加以下代码，影响动效</span>\n  <span class="token comment">// if (!container || !Object.keys(container).length) {</span>\n  <span class="token comment">//   return 0</span>\n  <span class="token comment">// }</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>__isBrowser__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token number">0</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span>\n  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">\'absolute\'</span>\n  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">\'hidden\'</span>\n  el<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div style="width: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expression<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/div></span><span class="token template-punctuation string">`</span></span>\n  container<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> container<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> calcPx <span class="token operator">=</span> el<span class="token punctuation">.</span>clientWidth\n  container<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>\n  <span class="token keyword">return</span> calcPx\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="p7-resize-后动画定位不准的-bug"><a href="#p7-resize-%E5%90%8E%E5%8A%A8%E7%94%BB%E5%AE%9A%E4%BD%8D%E4%B8%8D%E5%87%86%E7%9A%84-bug" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>p7 resize 后动画定位不准的 bug</h4>\n<p>需要全部使用 rem 单位，否则 resize 后定位不准</p>\n<h3 id="运行效果-3"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<!-- <iframe data-src="https://codesandbox.io/embed/2h37rw?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/66xh38?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="序列帧滚动控制"><a href="#%E5%BA%8F%E5%88%97%E5%B8%A7%E6%BB%9A%E5%8A%A8%E6%8E%A7%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>序列帧滚动控制</h2>\n<h3 id="需求背景-5"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>实现如下所示动效，随着鼠标滚轮滚动播放视频或图片</p>\n<p><html><head></head><body><video data-src="/examples/international-official-website-technical-difficulties/video-frame-scroll-control.mp4" loop="" muted="" autoplay="" width="100%" class="lazy"></video></body></html></video></p>\n<h3 id="选型过程-4"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h3>\n<h4 id="视频方向"><a href="#%E8%A7%86%E9%A2%91%E6%96%B9%E5%90%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视频方向</h4>\n<ol>\n<li>\n<p>video + av01、vp9、h264 编码的 mp4 视频（av01、vp9、h264 编码一一尝试，随着文件体积的增加，解码性能逐渐增加，但以 UI 给的视频素材测试 h264 在某些电脑比如苹果电脑上还是卡顿；在此过程中一旦使用 ffmpeg 压缩 UI 给的视频素材会导致卡顿，暂时未知是解码性能的原因还是使用了 currentTime 无法跳转到指定帧，只能跳转到关键帧，而关键帧之间并不是连续的流畅画面，fps 不平均的原因）</p>\n</li>\n<li>\n<p>ogv.js + vp9 编码的 webm 视频（解码速度较慢导致卡顿、随机跳转会报错且视频会卡住）</p>\n</li>\n<li>\n<p>提前将 video 的每一帧预渲染，可能效率较低，导致浏览器卡住，相关库：<a href="https://github.com/rnicholus/frame-grab.js" target="_blank" rel="nofollow noreferrer noopener">frame-grab</a>、<a href="https://github.com/wch1n/video-frame-previewer" target="_blank" rel="nofollow noreferrer noopener">video-frame-previewer</a>、<a href="https://github.com/feross/capture-frame" target="_blank" rel="nofollow noreferrer noopener">capture-frame</a></p>\n</li>\n<li>\n<p>jsmpeg + mpeg1 编码的 mpeg 视频（最新版本得不到总帧数、无法实现帧寻址、采用 ts 流导致不能立马跳转成功、实际使用 currentTime 无法跳成功等等缺点，故使用 v0.2 实现。缺点：同等画质下体积较大；颜色范围有限制 16~235，即不能纯白纯黑。优点：解码速度满足要求）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5539467434266587000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# ts 压缩\nffmpeg -i demo.mp4 -f mpegts -codec:v mpeg1video -b:v 1024k -bf 0 -r 20 -an demo@1024.ts\n\nffmpeg -i demo.mp4 -f mpeg1video -codec:v mpeg1video -b:v 1200k -bf 0 -r 20 -an demo.mpeg\n\n# mpeg 压缩\nffmpeg -i demo.mp4 -f mpeg1video -codec:v mpeg1video -b:v 2048k -bf 0 -r 30 -an demo@2048.mpeg\n\nffmpeg -i demo.mp4 -f mpeg1video -codec:v mpeg1video -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 30 -an demo@2048.mpeg\n\n# mp4 压缩\nffmpeg -i p7-p3-1.mp4 -b:v 2048k -bf 0 -r 25 -an p7-p3-1@2048.mp4\n\nffmpeg -i p7-p3-1.mp4 -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 25 -an p7-p3-1@2048.mp4\n\nffmpeg -i p7-p3-1.mp4 -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 25 -an -movflags faststart p7-p3-1@2048.mp4\n\n# 批量压缩\n#!/bin/bash\nfor i in *.mp4\ndo\n  echo &quot;File \\$i selected&quot;\n  # ffmpeg -i &quot;\\$i&quot; &quot;\\$i.mp3&quot;\n  ffmpeg -i &quot;\\$i&quot; -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 25 -an -movflags faststart &quot;\\$i.mp4&quot;\ndone`, `5539467434266587000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># ts 压缩</span>\nffmpeg -i demo.mp4 -f mpegts -codec:v mpeg1video -b:v 1024k -bf <span class="token number">0</span> -r <span class="token number">20</span> -an demo@1024.ts\n\nffmpeg -i demo.mp4 -f mpeg1video -codec:v mpeg1video -b:v 1200k -bf <span class="token number">0</span> -r <span class="token number">20</span> -an demo.mpeg\n\n<span class="token comment"># mpeg 压缩</span>\nffmpeg -i demo.mp4 -f mpeg1video -codec:v mpeg1video -b:v 2048k -bf <span class="token number">0</span> -r <span class="token number">30</span> -an demo@2048.mpeg\n\nffmpeg -i demo.mp4 -f mpeg1video -codec:v mpeg1video -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r <span class="token number">30</span> -an demo@2048.mpeg\n\n<span class="token comment"># mp4 压缩</span>\nffmpeg -i p7-p3-1.mp4 -b:v 2048k -bf <span class="token number">0</span> -r <span class="token number">25</span> -an p7-p3-1@2048.mp4\n\nffmpeg -i p7-p3-1.mp4 -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r <span class="token number">25</span> -an p7-p3-1@2048.mp4\n\nffmpeg -i p7-p3-1.mp4 -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r <span class="token number">25</span> -an -movflags faststart p7-p3-1@2048.mp4\n\n<span class="token comment"># 批量压缩</span>\n<span class="token comment">#!/bin/bash</span>\n<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> *.mp4\n<span class="token keyword">do</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"File <span class="token variable">$i</span> selected"</span>\n  <span class="token comment"># ffmpeg -i "$i" "$i.mp3"</span>\n  ffmpeg -i <span class="token string">"<span class="token variable">$i</span>"</span> -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r <span class="token number">25</span> -an -movflags faststart <span class="token string">"<span class="token variable">$i</span>.mp4"</span>\n<span class="token keyword">done</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h4 id="图片方向"><a href="#%E5%9B%BE%E7%89%87%E6%96%B9%E5%90%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图片方向</h4>\n<ol>\n<li>预加载所有图片 + 图片序列帧（参考张博客，体积较大）</li>\n<li>pixi-apngAndGif，使用 apng 控制播放进度（体积太大）</li>\n<li>针对方案 1，使用 avif + avif.js，暂时未知解码性能如何，猜测同样都是 av1 解码，可能解码性能不行；</li>\n<li>针对方案 1，使用 webp，解码性能同样可能不行</li>\n<li>针对方案 1，使用 jpg</li>\n</ol>\n<h3 id="核心代码-4"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<h4 id="pixi-apngandgif"><a href="#pixi-apngandgif" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pixi-apngAndGif</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68033712090898964000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { useEffect, useRef, useState } from \'react\'\nimport { InputNumber } from \'antd\'\n\nimport XButton from \'@/components/xButton\'\n\nconst Index = () => {\n  const domRef = useRef(null)\n  const [apngApi, setApngApi] = useState()\n  const [value, setValue] = useState(0)\n\n  useEffect(() => {\n    import(\'@/lib/pixi-apng\').then((pixiApng) => {\n      const PixiApng = pixiApng.default\n      const { PIXI } = pixiApng\n      const app = new PIXI.Application({\n        width: domRef.current?.width,\n        height: domRef.current?.height,\n        view: domRef.current,\n        transparent: true,\n        antialias: true\n      })\n      const loader = PIXI.Loader.shared\n      const loadOption = {\n        loadType: PIXI.LoaderResource.LOAD_TYPE.XHR,\n        xhrType: PIXI.LoaderResource.XHR_RESPONSE_TYPE.BUFFER,\n        crossOrigin: \'\'\n      }\n      const imgs = {\n        apng: \'/public/demo/demo.png\'\n      }\n      loader.add(imgs.apng, loadOption)\n\n      loader.load((progress, resources) => {\n        const apngApi = new PixiApng(imgs.apng, resources)\n        setApngApi(apngApi)\n        const apngSprite = apngApi.sprite\n\n        apngSprite.x = 0\n        apngSprite.y = 0\n\n        apngSprite.width = 1000\n        apngSprite.height = 500\n\n        app.stage.addChild(apngSprite)\n      })\n    })\n  }, [])\n\n  return (\n    <div style={{ marginTop: 100, width: 1920, height: 1080 }}>\n      <XButton onClick={() => {\n        apngApi.play()\n      }}>\n        开始\n      </XButton>\n      <XButton onClick={() => {\n        apngApi.pause()\n      }}>\n        停止\n      </XButton>\n      <XButton onClick={() => {\n        apngApi.stop()\n      }}>\n        终止\n      </XButton>\n      <InputNumber value={value} onChange={setValue} precision={0} />\n      <XButton onClick={() => {\n        apngApi.jumpToFrame(value)\n      }}>\n        停到第几帧\n      </XButton>\n      <XButton onClick={() => {\n        window.alert(apngApi.getDuration())\n      }}>\n        时长\n      </XButton>\n      <XButton onClick={() => {\n        window.alert(apngApi.getFramesLength())\n      }}>\n        帧数\n      </XButton>\n      <canvas ref={domRef} width=&quot;1920&quot; height=&quot;1080&quot;></canvas>\n    </div>\n  )\n}\n\nexport default Index`, `68033712090898964000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> InputNumber <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'antd\'</span>\n\n<span class="token keyword">import</span> XButton <span class="token keyword">from</span> <span class="token string">\'@/components/xButton\'</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Index</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> domRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>apngApi<span class="token punctuation">,</span> setApngApi<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>\n\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'@/lib/pixi-apng\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pixiApng</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> PixiApng <span class="token operator">=</span> pixiApng<span class="token punctuation">.</span><span class="token keyword">default</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">PIXI</span> <span class="token punctuation">}</span> <span class="token operator">=</span> pixiApng\n      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PIXI<span class="token punctuation">.</span>Application</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        width<span class="token punctuation">:</span> domRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>\n        height<span class="token punctuation">:</span> domRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span>\n        view<span class="token punctuation">:</span> domRef<span class="token punctuation">.</span>current<span class="token punctuation">,</span>\n        transparent<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        antialias<span class="token punctuation">:</span> <span class="token boolean">true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token keyword">const</span> loader <span class="token operator">=</span> <span class="token constant">PIXI</span><span class="token punctuation">.</span>Loader<span class="token punctuation">.</span>shared\n      <span class="token keyword">const</span> loadOption <span class="token operator">=</span> <span class="token punctuation">{</span>\n        loadType<span class="token punctuation">:</span> <span class="token constant">PIXI</span><span class="token punctuation">.</span>LoaderResource<span class="token punctuation">.</span><span class="token constant">LOAD_TYPE</span><span class="token punctuation">.</span><span class="token constant">XHR</span><span class="token punctuation">,</span>\n        xhrType<span class="token punctuation">:</span> <span class="token constant">PIXI</span><span class="token punctuation">.</span>LoaderResource<span class="token punctuation">.</span><span class="token constant">XHR_RESPONSE_TYPE</span><span class="token punctuation">.</span><span class="token constant">BUFFER</span><span class="token punctuation">,</span>\n        crossOrigin<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">const</span> imgs <span class="token operator">=</span> <span class="token punctuation">{</span>\n        apng<span class="token punctuation">:</span> <span class="token string">\'/public/demo/demo.png\'</span>\n      <span class="token punctuation">}</span>\n      loader<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>imgs<span class="token punctuation">.</span>apng<span class="token punctuation">,</span> loadOption<span class="token punctuation">)</span>\n\n      loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">progress<span class="token punctuation">,</span> resources</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> apngApi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PixiApng</span><span class="token punctuation">(</span>imgs<span class="token punctuation">.</span>apng<span class="token punctuation">,</span> resources<span class="token punctuation">)</span>\n        <span class="token function">setApngApi</span><span class="token punctuation">(</span>apngApi<span class="token punctuation">)</span>\n        <span class="token keyword">const</span> apngSprite <span class="token operator">=</span> apngApi<span class="token punctuation">.</span>sprite\n\n        apngSprite<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span>\n        apngSprite<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span>\n\n        apngSprite<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1000</span>\n        apngSprite<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">500</span>\n\n        app<span class="token punctuation">.</span>stage<span class="token punctuation">.</span><span class="token function">addChild</span><span class="token punctuation">(</span>apngSprite<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> marginTop<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XButton</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        apngApi<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        开始\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XButton</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XButton</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        apngApi<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        停止\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XButton</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XButton</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        apngApi<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        终止\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XButton</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">InputNumber</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>setValue<span class="token punctuation">}</span></span> <span class="token attr-name">precision</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XButton</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        apngApi<span class="token punctuation">.</span><span class="token function">jumpToFrame</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        停到第几帧\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XButton</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XButton</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>apngApi<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        时长\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XButton</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XButton</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span>apngApi<span class="token punctuation">.</span><span class="token function">getFramesLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        帧数\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">XButton</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>domRef<span class="token punctuation">}</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1920<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1080<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> Index</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="ogvjs"><a href="#ogvjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ogv.js</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33550432816205156000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { useRef, useEffect, useState } from \'react\';\nimport classNames from \'classnames\';\nimport { useInViewport, useAsyncEffect } from \'ahooks\';\n\nimport { loadScript } from \'@/utils\';\n\nimport styles from \'./index.module.less\';\n\ninterface JsmpegPlayerProps {\n   src: string;\n   progress?: number; // 播放进度，0~1\n   className?: string;\n   autoplay?: boolean;\n   loop?: boolean;\n   seekable?: boolean;\n   preserveDrawingBuffer?: boolean;\n}\n\n// https://github.com/phoboslab/jsmpeg/tree/v0.2\nconst JsmpegPlayer = ({ src, progress, className, ...rest }: JsmpegPlayerProps) => {\n   const [isLoad, setIsLoad] = useState(true);\n   const [isLoadJsmpeg, setIsLoadJsmpeg] = useState(true);\n   const playerRef = useRef();\n   const domRef = useRef(null);\n\n   useAsyncEffect(async () => {\n      await loadScript(\'/public/lib/ogvjs-1.8.6/ogv.js\');\n      setIsLoadJsmpeg(false);\n   }, []);\n\n   const [inViewPort] = useInViewport(domRef);\n   useEffect(() => {\n      if (!inViewPort || isLoadJsmpeg || !isLoad) {\n         return;\n      }\n      // eslint-disable-next-line new-cap\n      playerRef.current = new window.OGVPlayer({\n         wasm: true, // force,\n         simd: true // experimental\n         // threading: true\n      });\n      domRef.current.appendChild(playerRef.current);\n      playerRef.current.muted = true;\n      playerRef.current.src = src;\n      playerRef.current.addEventListener(\'loadedmetadata\', () => {\n         setIsLoad(false);\n      });\n   }, [inViewPort, isLoadJsmpeg]);\n\n   useEffect(() => {\n      if (isLoad || typeof progress !== \'number\') {\n         return;\n      }\n      const calcProgress = progress < 0 ? 0 : progress > 1 ? 1 : progress;\n      console.log(\'calcProgress\', calcProgress);\n      playerRef.current.currentTime = calcProgress * playerRef.current.duration;\n   }, [progress, isLoad]);\n\n   return <div ref={domRef}></div>;\n};\n\nexport default JsmpegPlayer;`, `33550432816205156000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useInViewport<span class="token punctuation">,</span> useAsyncEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> loadScript <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">JsmpegPlayerProps</span> <span class="token punctuation">{</span>\n   src<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   progress<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> <span class="token comment">// 播放进度，0~1</span>\n   className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   autoplay<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   loop<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   seekable<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   preserveDrawingBuffer<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// https://github.com/phoboslab/jsmpeg/tree/v0.2</span>\n<span class="token keyword">const</span> <span class="token function-variable function">JsmpegPlayer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> src<span class="token punctuation">,</span> progress<span class="token punctuation">,</span> className<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span><span class="token punctuation">:</span> JsmpegPlayerProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoad<span class="token punctuation">,</span> setIsLoad<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoadJsmpeg<span class="token punctuation">,</span> setIsLoadJsmpeg<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> playerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> domRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">useAsyncEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">await</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">\'/public/lib/ogvjs-1.8.6/ogv.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setIsLoadJsmpeg</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>inViewPort<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useInViewport</span><span class="token punctuation">(</span>domRef<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inViewPort <span class="token operator">||</span> isLoadJsmpeg <span class="token operator">||</span> <span class="token operator">!</span>isLoad<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// eslint-disable-next-line new-cap</span>\n      playerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>OGVPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n         wasm<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// force,</span>\n         simd<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// experimental</span>\n         <span class="token comment">// threading: true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      domRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>playerRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      playerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>muted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      playerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>\n      playerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'loadedmetadata\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token function">setIsLoad</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>inViewPort<span class="token punctuation">,</span> isLoadJsmpeg<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>isLoad <span class="token operator">||</span> <span class="token keyword">typeof</span> progress <span class="token operator">!==</span> <span class="token string">\'number\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">const</span> calcProgress <span class="token operator">=</span> progress <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> progress <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> progress<span class="token punctuation">;</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'calcProgress\'</span><span class="token punctuation">,</span> calcProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      playerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> calcProgress <span class="token operator">*</span> playerRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>duration<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>progress<span class="token punctuation">,</span> isLoad<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>domRef<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> JsmpegPlayer<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="video"><a href="#video" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>video</h4>\n<p>web/components/lazyLoader/components/video/components/core/hooks/useProgressControl.ts</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4306419717620091400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { useEffect, useState } from \'react\';\n\nimport { CommonProps } from \'../index\';\n\nexport interface UseProgressControlProps {\n   progress?: number;\n   playStrategy?: \'progressControl\';\n}\n\nconst useProgressControl = ({\n   progress,\n   playStrategy,\n   onSetVideoProps,\n   domRef\n}: UseProgressControlProps & CommonProps) => {\n   const [isLoad, setIsLoad] = useState(true);\n   const [duration, setDuration] = useState(0);\n\n   const handleLoadedMetadata = () => {\n      const { duration } = domRef.current;\n      setDuration(duration);\n      setIsLoad(false);\n   };\n\n   useEffect(() => {\n      if (isLoad || typeof progress !== \'number\' || playStrategy !== \'progressControl\') {\n         return;\n      }\n\n      const calcProgress = progress < 0 ? 0 : progress > 1 ? 1 : progress;\n      domRef.current.currentTime = calcProgress * duration;\n   }, [progress, isLoad]);\n\n   useEffect(() => {\n      if (playStrategy === \'progressControl\') {\n         onSetVideoProps({\n            muted: true,\n            playsInline: true,\n            preload: \'metadata\'\n         });\n      }\n   }, [playStrategy]);\n\n   return {\n      handleLoadedMetadata\n   };\n};\n\nexport default useProgressControl;`, `4306419717620091400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> CommonProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'../index\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">UseProgressControlProps</span> <span class="token punctuation">{</span>\n   progress<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   playStrategy<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">\'progressControl\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useProgressControl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>\n   progress<span class="token punctuation">,</span>\n   playStrategy<span class="token punctuation">,</span>\n   onSetVideoProps<span class="token punctuation">,</span>\n   domRef\n<span class="token punctuation">}</span><span class="token punctuation">:</span> UseProgressControlProps <span class="token operator">&amp;</span> CommonProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoad<span class="token punctuation">,</span> setIsLoad<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>duration<span class="token punctuation">,</span> setDuration<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> <span class="token function-variable function">handleLoadedMetadata</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> duration <span class="token punctuation">}</span> <span class="token operator">=</span> domRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>\n      <span class="token function">setDuration</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">setIsLoad</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>isLoad <span class="token operator">||</span> <span class="token keyword">typeof</span> progress <span class="token operator">!==</span> <span class="token string">\'number\'</span> <span class="token operator">||</span> playStrategy <span class="token operator">!==</span> <span class="token string">\'progressControl\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">const</span> calcProgress <span class="token operator">=</span> progress <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> progress <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> progress<span class="token punctuation">;</span>\n      domRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> calcProgress <span class="token operator">*</span> duration<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>progress<span class="token punctuation">,</span> isLoad<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>playStrategy <span class="token operator">===</span> <span class="token string">\'progressControl\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token function">onSetVideoProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            muted<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            playsInline<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            preload<span class="token punctuation">:</span> <span class="token string">\'metadata\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>playStrategy<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      handleLoadedMetadata\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useProgressControl<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="jsmpeg"><a href="#jsmpeg" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>jsmpeg</h4>\n<p>现阶段采用的技术选型</p>\n<p>web/components/jsmpegPlayer/index.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59931413920463970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { useRef, useEffect, useState } from \'react\'\nimport classNames from \'classnames\'\nimport { useInViewport, useAsyncEffect } from \'ahooks\'\n\nimport { l } from \'@/components/lazyLoader\'\n\nimport { loadScript } from \'@/utils\'\n\nimport styles from \'./index.module.less\'\n\ninterface JsmpegPlayerProps {\n  src: string\n  progress?: number // 播放进度，0~1\n  className?: string\n  poster?: string\n}\n\n// https://github.com/phoboslab/jsmpeg/tree/v0.2\nconst JsmpegPlayer = ({\n  src,\n  progress,\n  className,\n  poster,\n  ...rest\n}: JsmpegPlayerProps) => {\n  const [isLoad, setIsLoad] = useState(true)\n  const [isLoadJsmpeg, setIsLoadJsmpeg] = useState(true)\n  const playerRef = useRef()\n  const domRef = useRef(null)\n\n  useAsyncEffect(async () => {\n    await loadScript(\'/public/lib/jsmpeg.min.js\')\n    setIsLoadJsmpeg(false)\n  }, [])\n\n  const [inViewPort] = useInViewport(domRef)\n  useEffect(() => {\n    if (!inViewPort || isLoadJsmpeg || !isLoad) {\n      return\n    }\n    // eslint-disable-next-line new-cap\n    playerRef.current = new window.jsmpeg(src, {\n      ...rest,\n      canvas: domRef.current?.querySelector(\'canvas\'),\n      seekable: true,\n      onload: () => {\n        setIsLoad(false)\n        // console.log(playerRef.current?.duration, playerRef.current?.frameCount)\n      }\n    })\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inViewPort, isLoadJsmpeg])\n\n  useEffect(() => {\n    if (isLoad || typeof progress !== \'number\') {\n      return\n    }\n    const calcProgress = progress < 0 ? 0 : progress > 1 ? 1 : progress\n    const frameCount = playerRef.current?.frameCount - 1 // 最大帧需减一\n    playerRef.current?.seekToFrame(calcProgress * frameCount, true)\n  }, [progress, isLoad])\n\n  const isShowPoster = (isLoad || isLoadJsmpeg) && poster\n  return <div\n    ref={domRef}\n    className={classNames(styles.container, className)}\n  >\n    <div className={styles.body}>\n      <canvas\n        className={styles.video}\n      />\n      {\n        isShowPoster && <l.img\n          src={poster}\n          className={styles.poster}\n        />\n      }\n    </div>\n  </div>\n}\n\nexport default JsmpegPlayer`, `59931413920463970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useRef<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useInViewport<span class="token punctuation">,</span> useAsyncEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> l <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/lazyLoader\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> loadScript <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils\'</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">JsmpegPlayerProps</span> <span class="token punctuation">{</span>\n  src<span class="token punctuation">:</span> <span class="token builtin">string</span>\n  progress<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token comment">// 播放进度，0~1</span>\n  className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span>\n  poster<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// https://github.com/phoboslab/jsmpeg/tree/v0.2</span>\n<span class="token keyword">const</span> <span class="token function-variable function">JsmpegPlayer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>\n  src<span class="token punctuation">,</span>\n  progress<span class="token punctuation">,</span>\n  className<span class="token punctuation">,</span>\n  poster<span class="token punctuation">,</span>\n  <span class="token operator">...</span>rest\n<span class="token punctuation">}</span><span class="token punctuation">:</span> JsmpegPlayerProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoad<span class="token punctuation">,</span> setIsLoad<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>isLoadJsmpeg<span class="token punctuation">,</span> setIsLoadJsmpeg<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> playerRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> domRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>\n\n  <span class="token function">useAsyncEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">await</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token string">\'/public/lib/jsmpeg.min.js\'</span><span class="token punctuation">)</span>\n    <span class="token function">setIsLoadJsmpeg</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>inViewPort<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useInViewport</span><span class="token punctuation">(</span>domRef<span class="token punctuation">)</span>\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inViewPort <span class="token operator">||</span> isLoadJsmpeg <span class="token operator">||</span> <span class="token operator">!</span>isLoad<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// eslint-disable-next-line new-cap</span>\n    playerRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>jsmpeg</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      <span class="token operator">...</span>rest<span class="token punctuation">,</span>\n      canvas<span class="token punctuation">:</span> domRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      seekable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">onload</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token function">setIsLoad</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>\n        <span class="token comment">// console.log(playerRef.current?.duration, playerRef.current?.frameCount)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>inViewPort<span class="token punctuation">,</span> isLoadJsmpeg<span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>isLoad <span class="token operator">||</span> <span class="token keyword">typeof</span> progress <span class="token operator">!==</span> <span class="token string">\'number\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">const</span> calcProgress <span class="token operator">=</span> progress <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> progress <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> progress\n    <span class="token keyword">const</span> frameCount <span class="token operator">=</span> playerRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span>frameCount <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// 最大帧需减一</span>\n    playerRef<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">seekToFrame</span><span class="token punctuation">(</span>calcProgress <span class="token operator">*</span> frameCount<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>progress<span class="token punctuation">,</span> isLoad<span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> isShowPoster <span class="token operator">=</span> <span class="token punctuation">(</span>isLoad <span class="token operator">||</span> isLoadJsmpeg<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> poster\n  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n    <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>domRef<span class="token punctuation">}</span></span>\n    <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n  <span class="token punctuation">></span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>body<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span>\n        <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>video<span class="token punctuation">}</span></span>\n      <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>\n        isShowPoster <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>l.img</span>\n          <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>poster<span class="token punctuation">}</span></span>\n          <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>poster<span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span>\n      <span class="token punctuation">}</span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> JsmpegPlayer</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>web/pages/p5/components/smartSpaceInternal/index.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10165079694593792000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\'\nimport { useTranslation } from \'react-i18next\'\nimport classNames from \'classnames\'\n\nimport ModelCenterText from \'@/components/modelCenterText\'\nimport ModelLeftText from \'@/components/modelLeftText\'\nimport { SceneProps } from \'@/components/reactScrollMagic\'\nimport JsmpegPlayer from \'@/components/jsmpegPlayer\'\nimport { l } from \'@/components/lazyLoader\'\n\nimport useTmpComponent from \'@/hooks/useTmpComponent\'\nimport useStoreContext, { CLIENT_TYPE, DATA_ANALYSIS_TYPES } from \'@/hooks/useStoreContext\'\n\nimport { getAnimateProgresses } from \'@/utils/animate\'\n\nimport styles from \'./index.module.less\'\nimport { dataAnalysisClickTrack } from \'@/utils/dataAnalysis\'\nimport XTracker from \'@/components/xTracker\'\nimport { setDataLayer } from \'@/hooks/useSetDataLayer\'\n\nconst Index = ({\n  sceneParams\n}: SceneProps) => {\n  const {\n    progress = 0\n  } = sceneParams || {}\n  const { t } = useTranslation()\n  const trackRef = XTracker.useExposureNode({\n    type: \'P5\',\n    event: \'IntelligentSpace_Show\'\n  })\n  const getValue = (param: string) => t(\\`p5.smartSpaceInternal.\\${param}\\`)\n\n  const { api, Slot } = useTmpComponent()\n\n  const { state } = useStoreContext()\n\n  const [playerProgress] = getAnimateProgresses(progress, [\n    {\n      start: 0,\n      duration: 2 / 3\n    }\n  ])\n\n  const isShowAnimationText = playerProgress > 0.47 // 窗帘收起时文字出现\n\n  return (\n    <>\n      {\n        state?.clientType === CLIENT_TYPE.PC && <JsmpegPlayer\n          className={styles.player}\n          src=&quot;/public/p5/smart-space-internal/p5-inside.mpeg&quot;\n          poster=&quot;/public/p5/smart-space-internal/p5-inside-first-frame.jpg&quot;\n          progress={playerProgress}\n        />\n      }\n      <div\n        className={classNames(\'global-full-page-with-top-menu\', styles.container)}\n      >\n        {\n          state?.clientType === CLIENT_TYPE.H5 && <l.video\n            className={styles.player}\n            src=&quot;/public/p5/smart-space-internal/p5-inside-origin.mp4&quot;\n            srcPoster=&quot;/public/p5/smart-space-internal/p5-inside@mini.jpg&quot;\n            playIconPosition=&quot;bottom&quot;\n          />\n        }\n        <Slot\n          modelType=\'P5\'\n          pageType=\'IntelligentSpace\'\n          buttonType=\'LearnMore\'\n          itemList={[{\n            imgList: [{\n              src: \'/public/p5/d3/p5-d3-1.jpg\',\n              srcSet: \'/public/p5/d3/p5-d3-1@2x.jpg\'\n            }],\n            background: \'linear-gradient(132deg, #94A1C6 0%, #7C8DB6 100%)\',\n            textData: {\n              topSubTitle: t(\'p5.d3.topSubTitle1\'),\n              title: t(\'p5.d3.title1\'),\n              subTitle: t(\'p5.d3.subTitle1\')\n            }\n          }, {\n            imgList: [{\n              src: \'/public/p5/d3/p5-d3-2.mp4\'\n            }],\n            background: \'linear-gradient(136deg, #5F729E 0%, #3B4B76 100%)\',\n            textData: {\n              topSubTitle: t(\'p5.d3.topSubTitle2\'),\n              title: t(\'p5.d3.title2\'),\n              subTitle: t(\'p5.d3.subTitle2\')\n            }\n          }, {\n            imgList: [{\n              src: \'/public/p5/d3/p5-d3-3.jpg\',\n              srcSet: \'/public/p5/d3/p5-d3-3@2x.jpg\'\n            }],\n            background: \'linear-gradient(133deg, #B6CBDA 0%, #7A97AF 100%)\',\n            textData: {\n              topSubTitle: t(\'p5.d3.topSubTitle3\'),\n              title: t(\'p5.d3.title3\'),\n              subTitle: t(\'p5.d3.subTitle3\')\n            }\n          }]}\n        />\n        <div ref={trackRef} className={classNames(\'body\', styles.body)}>\n          {\n            isShowAnimationText && state?.clientType === CLIENT_TYPE.PC && <ModelCenterText\n              topSubTitle={getValue(\'topSubTitle\')}\n              title={getValue(\'title\')}\n              subTitle={getValue(\'subTitle\')}\n              shortDesc={getValue(\'shortDesc\')}\n              buttonText={getValue(\'button\')}\n              buttonProps={{\n                onClick: () => {\n                  dataAnalysisClickTrack(\\`\\${DATA_ANALYSIS_TYPES.P5}_IntelligentSpace_LearnMoreBtn\\`)\n                  api?.current?.open()\n                  setDataLayer({\n                    event_category: \'click_button\',\n                    car_model: \'p5\',\n                    button_group: \'learn more\',\n                    click_text: getValue(\'button\')\n                  })\n                },\n                type: \'ghost\',\n                dark: true,\n                plain: true\n              }}\n              closeIcon={null}\n            />\n          }\n          {\n            state?.clientType === CLIENT_TYPE.H5 && <ModelLeftText\n              topSubTitle={getValue(\'topSubTitle\')}\n              title={getValue(\'title\')}\n              subTitle={getValue(\'subTitle\')}\n              shortDesc={getValue(\'shortDesc\')}\n              buttonProps={{\n                onClick: () => {\n                  api?.current?.open()\n                },\n                type: \'ghost\'\n              }}\n              closeIcon={null}\n            />\n          }\n        </div>\n      </div>\n    </>\n\n  )\n}\n\nexport default Index`, `10165079694593792000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> useTranslation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-i18next\'</span>\n<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span>\n\n<span class="token keyword">import</span> ModelCenterText <span class="token keyword">from</span> <span class="token string">\'@/components/modelCenterText\'</span>\n<span class="token keyword">import</span> ModelLeftText <span class="token keyword">from</span> <span class="token string">\'@/components/modelLeftText\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> SceneProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/reactScrollMagic\'</span>\n<span class="token keyword">import</span> JsmpegPlayer <span class="token keyword">from</span> <span class="token string">\'@/components/jsmpegPlayer\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> l <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/components/lazyLoader\'</span>\n\n<span class="token keyword">import</span> useTmpComponent <span class="token keyword">from</span> <span class="token string">\'@/hooks/useTmpComponent\'</span>\n<span class="token keyword">import</span> useStoreContext<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">,</span> <span class="token constant">DATA_ANALYSIS_TYPES</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/hooks/useStoreContext\'</span>\n\n<span class="token keyword">import</span> <span class="token punctuation">{</span> getAnimateProgresses <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils/animate\'</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> dataAnalysisClickTrack <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/utils/dataAnalysis\'</span>\n<span class="token keyword">import</span> XTracker <span class="token keyword">from</span> <span class="token string">\'@/components/xTracker\'</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> setDataLayer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/hooks/useSetDataLayer\'</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Index</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>\n  sceneParams\n<span class="token punctuation">}</span><span class="token punctuation">:</span> SceneProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span>\n    progress <span class="token operator">=</span> <span class="token number">0</span>\n  <span class="token punctuation">}</span> <span class="token operator">=</span> sceneParams <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTranslation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> trackRef <span class="token operator">=</span> XTracker<span class="token punctuation">.</span><span class="token function">useExposureNode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'P5\'</span><span class="token punctuation">,</span>\n    event<span class="token punctuation">:</span> <span class="token string">\'IntelligentSpace_Show\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">param<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">p5.smartSpaceInternal.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>param<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> api<span class="token punctuation">,</span> Slot <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTmpComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useStoreContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>playerProgress<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getAnimateProgresses</span><span class="token punctuation">(</span>progress<span class="token punctuation">,</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      start<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      duration<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">3</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> isShowAnimationText <span class="token operator">=</span> playerProgress <span class="token operator">></span> <span class="token number">0.47</span> <span class="token comment">// 窗帘收起时文字出现</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>\n        state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">JsmpegPlayer</span></span>\n          <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>player<span class="token punctuation">}</span></span>\n          <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p5/smart-space-internal/p5-inside.mpeg<span class="token punctuation">"</span></span>\n          <span class="token attr-name">poster</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p5/smart-space-internal/p5-inside-first-frame.jpg<span class="token punctuation">"</span></span>\n          <span class="token attr-name">progress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>playerProgress<span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span>\n      <span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n        <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">\'global-full-page-with-top-menu\'</span><span class="token punctuation">,</span> styles<span class="token punctuation">.</span>container<span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n      <span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token punctuation">{</span>\n          state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">H5</span> <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>l.video</span>\n            <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>player<span class="token punctuation">}</span></span>\n            <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p5/smart-space-internal/p5-inside-origin.mp4<span class="token punctuation">"</span></span>\n            <span class="token attr-name">srcPoster</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/public/p5/smart-space-internal/p5-inside@mini.jpg<span class="token punctuation">"</span></span>\n            <span class="token attr-name">playIconPosition</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bottom<span class="token punctuation">"</span></span>\n          <span class="token punctuation">/></span></span>\n        <span class="token punctuation">}</span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Slot</span></span>\n          <span class="token attr-name">modelType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>P5<span class="token punctuation">\'</span></span>\n          <span class="token attr-name">pageType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>IntelligentSpace<span class="token punctuation">\'</span></span>\n          <span class="token attr-name">buttonType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>LearnMore<span class="token punctuation">\'</span></span>\n          <span class="token attr-name">itemList</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token punctuation">{</span>\n            imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p5/d3/p5-d3-1.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p5/d3/p5-d3-1@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(132deg, #94A1C6 0%, #7C8DB6 100%)\'</span><span class="token punctuation">,</span>\n            textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.topSubTitle1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.title1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.subTitle1\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p5/d3/p5-d3-2.mp4\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(136deg, #5F729E 0%, #3B4B76 100%)\'</span><span class="token punctuation">,</span>\n            textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.topSubTitle2\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.title2\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.subTitle2\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            imgList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n              src<span class="token punctuation">:</span> <span class="token string">\'/public/p5/d3/p5-d3-3.jpg\'</span><span class="token punctuation">,</span>\n              srcSet<span class="token punctuation">:</span> <span class="token string">\'/public/p5/d3/p5-d3-3@2x.jpg\'</span>\n            <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'linear-gradient(133deg, #B6CBDA 0%, #7A97AF 100%)\'</span><span class="token punctuation">,</span>\n            textData<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              topSubTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.topSubTitle3\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              title<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.title3\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n              subTitle<span class="token punctuation">:</span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token string">\'p5.d3.subTitle3\'</span><span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>trackRef<span class="token punctuation">}</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">,</span> styles<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token punctuation">{</span>\n            isShowAnimationText <span class="token operator">&amp;&amp;</span> state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>ModelCenterText\n              topSubTitle<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'topSubTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n              title<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'title\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n              subTitle<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'subTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n              shortDesc<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'shortDesc\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n              buttonText<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>\n              buttonProps<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n                <span class="token function-variable function">onClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  <span class="token function">dataAnalysisClickTrack</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">DATA_ANALYSIS_TYPES</span><span class="token punctuation">.</span><span class="token constant">P5</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_IntelligentSpace_LearnMoreBtn</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n                  api<span class="token operator">?</span><span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n                  <span class="token function">setDataLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n                    event_category<span class="token punctuation">:</span> <span class="token string">\'click_button\'</span><span class="token punctuation">,</span>\n                    car_model<span class="token punctuation">:</span> <span class="token string">\'p5\'</span><span class="token punctuation">,</span>\n                    button_group<span class="token punctuation">:</span> <span class="token string">\'learn more\'</span><span class="token punctuation">,</span>\n                    click_text<span class="token punctuation">:</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span>\n                  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n                <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'ghost\'</span><span class="token punctuation">,</span>\n                dark<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n                plain<span class="token punctuation">:</span> <span class="token boolean">true</span>\n              <span class="token punctuation">}</span><span class="token punctuation">}</span>\n              closeIcon<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">null</span><span class="token punctuation">}</span>\n            <span class="token operator">/</span><span class="token operator">></span>\n          <span class="token punctuation">}</span><span class="token plain-text">\n          </span><span class="token punctuation">{</span>\n            state<span class="token operator">?</span><span class="token punctuation">.</span>clientType <span class="token operator">===</span> <span class="token constant">CLIENT_TYPE</span><span class="token punctuation">.</span><span class="token constant">H5</span> <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ModelLeftText</span></span>\n              <span class="token attr-name">topSubTitle</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'topSubTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">title</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'title\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">subTitle</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'subTitle\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">shortDesc</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">\'shortDesc\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">buttonProps</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>\n                <span class="token function-variable function">onClick</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  api<span class="token operator">?</span><span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n                <span class="token punctuation">}</span><span class="token punctuation">,</span>\n                <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'ghost\'</span>\n              <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">closeIcon</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">null</span><span class="token punctuation">}</span></span>\n            <span class="token punctuation">/></span></span>\n          <span class="token punctuation">}</span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>\n\n  <span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> Index</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-4"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<h4 id="pixi-apngandgif-1"><a href="#pixi-apngandgif-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pixi-apngAndGif</h4>\n<!-- <iframe data-src="https://codesandbox.io/embed/fzmi7s?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/jtgkm7?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="ogvjs-1"><a href="#ogvjs-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ogv.js</h4>\n<!-- <iframe data-src="https://codesandbox.io/embed/dv2njm?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/xz72w3?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="video-1"><a href="#video-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>video</h4>\n<p>利用 <code class="language-text">懒加载</code> 功能写出的进度控制如下：</p>\n<!-- <iframe data-src="https://codesandbox.io/embed/16i1lw?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/kwrcjq?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h4 id="jsmpeg-1"><a href="#jsmpeg-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>jsmpeg</h4>\n<!-- <iframe data-src="https://codesandbox.io/embed/0ywivn?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/cgtjwk?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="优化-1"><a href="#%E4%BC%98%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h3>\n<h4 id="视频压缩"><a href="#%E8%A7%86%E9%A2%91%E5%8E%8B%E7%BC%A9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视频压缩</h4>\n<p>视频批量压缩脚本、支持单个压缩（有声音、转 mpeg 单独压缩）</p>\n<p>scripts/compress.mjs</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69149396373556530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env zx\nconst { get } = require(\'lodash\');\n\nconst compressConfig = require(\'../compress.config\');\nconst concurrentRun = require(\'./concurrentRun\');\n\n// 关闭日志输出\n\\$.verbose = false;\n\nconst FILE_SUFFIX = \'mp4\';\nconst TMP_FILE_SUFFIX = \'.bak.mp4\';\n\nconst delFiles = await globby(\\`public/**/*\\${TMP_FILE_SUFFIX}\\`);\n\nawait \\$\\`rm -rf \\${delFiles}\\`;\n\nlet files = [];\n\nconst params = argv._.slice(1);\nif (params.length > 0) {\n   files = params.filter((item) => /mp4\\$/.test(item));\n} else {\n   files = await globby(\\`public/**/*.\\${FILE_SUFFIX}\\`);\n}\n\nconsole.log(\\`开始压缩 \\${FILE_SUFFIX}\\`);\n\n// https://github.com/google/zx/issues/126\n\\$.noquote = async (...args) => {\n   const q = \\$.quote;\n   \\$.quote = (v) => v;\n   const p = \\$(...args);\n   await p;\n   \\$.quote = q;\n   return p;\n};\n\nconst transformToMpeg = async (bashFunc, file) => {\n   await \\$.noquote\\`\\${bashFunc(file, file.replace(/mp4\\$/, \'mpeg\'))}\\`;\n   // await \\$\\`rm -rf \\${file}\\`\n};\n\nconst transformToMp4 = async (bashFunc, file) => {\n   await \\$.noquote\\`\\${bashFunc(file, file + TMP_FILE_SUFFIX)}\\`;\n   await \\$\\`rm -rf \\${file}\\`;\n   await \\$\\`mv \\${file}\\${TMP_FILE_SUFFIX} \\${file}\\`;\n   await \\$\\`rm -rf \\${file}\\${TMP_FILE_SUFFIX}\\`;\n};\n\nconst funcArray = [\n   {\n      path: \'mpeg.4\',\n      func: transformToMpeg\n   },\n   {\n      path: \'mp4.hasAudio\',\n      func: transformToMp4\n   },\n   {\n      path: \'mp4\',\n      func: transformToMp4\n   }\n];\n\nawait concurrentRun(\n   files.map((file) => async () => {\n      for (let i = 0; i < funcArray.length; i++) {\n         const item = funcArray[i];\n         const { bashFunc, files } = get(compressConfig.mp4, item.path);\n         // files 未定义或者包含 file\n         if (!files || files.includes(file)) {\n            await item.func(bashFunc, file);\n            return Promise.resolve();\n         }\n      }\n      return Promise.resolve();\n   })\n);\n\nconsole.log(\\`共 \\${files.length} 个 \\${FILE_SUFFIX} 压缩完成\\`);`, `69149396373556530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env zx\n<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> compressConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../compress.config\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> concurrentRun <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./concurrentRun\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 关闭日志输出</span>\n$<span class="token punctuation">.</span>verbose <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">FILE_SUFFIX</span> <span class="token operator">=</span> <span class="token string">\'mp4\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token constant">TMP_FILE_SUFFIX</span> <span class="token operator">=</span> <span class="token string">\'.bak.mp4\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> delFiles <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">globby</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">public/**/*</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">TMP_FILE_SUFFIX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rm -rf </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>delFiles<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> params <span class="token operator">=</span> argv<span class="token punctuation">.</span>_<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   files <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token regex">/mp4$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n   files <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">globby</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">public/**/*.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">FILE_SUFFIX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">开始压缩 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">FILE_SUFFIX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// https://github.com/google/zx/issues/126</span>\n$<span class="token punctuation">.</span><span class="token function-variable function">noquote</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> q <span class="token operator">=</span> $<span class="token punctuation">.</span>quote<span class="token punctuation">;</span>\n   $<span class="token punctuation">.</span><span class="token function-variable function">quote</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> v<span class="token punctuation">;</span>\n   <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">await</span> p<span class="token punctuation">;</span>\n   $<span class="token punctuation">.</span>quote <span class="token operator">=</span> q<span class="token punctuation">;</span>\n   <span class="token keyword">return</span> p<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">transformToMpeg</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">bashFunc<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">await</span> $<span class="token punctuation">.</span>noquote<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">bashFunc</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/mp4$/</span><span class="token punctuation">,</span> <span class="token string">\'mpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n   <span class="token comment">// await $`rm -rf ${file}`</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">transformToMp4</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">bashFunc<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">await</span> $<span class="token punctuation">.</span>noquote<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">bashFunc</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> file <span class="token operator">+</span> <span class="token constant">TMP_FILE_SUFFIX</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n   <span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rm -rf </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n   <span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mv </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">TMP_FILE_SUFFIX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n   <span class="token keyword">await</span> $<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rm -rf </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">TMP_FILE_SUFFIX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> funcArray <span class="token operator">=</span> <span class="token punctuation">[</span>\n   <span class="token punctuation">{</span>\n      path<span class="token punctuation">:</span> <span class="token string">\'mpeg.4\'</span><span class="token punctuation">,</span>\n      func<span class="token punctuation">:</span> transformToMpeg\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span>\n      path<span class="token punctuation">:</span> <span class="token string">\'mp4.hasAudio\'</span><span class="token punctuation">,</span>\n      func<span class="token punctuation">:</span> transformToMp4\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span>\n      path<span class="token punctuation">:</span> <span class="token string">\'mp4\'</span><span class="token punctuation">,</span>\n      func<span class="token punctuation">:</span> transformToMp4\n   <span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">await</span> <span class="token function">concurrentRun</span><span class="token punctuation">(</span>\n   files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> funcArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> item <span class="token operator">=</span> funcArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>\n         <span class="token keyword">const</span> <span class="token punctuation">{</span> bashFunc<span class="token punctuation">,</span> files <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">get</span><span class="token punctuation">(</span>compressConfig<span class="token punctuation">.</span>mp4<span class="token punctuation">,</span> item<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token comment">// files 未定义或者包含 file</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>files <span class="token operator">||</span> files<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">await</span> item<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span>bashFunc<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">共 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>files<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 个 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">FILE_SUFFIX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 压缩完成</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>scripts/concurrentRun.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45140917789626655000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const ProgressBar = require(\'progress\');\nconst os = require(\'os\');\nconst cpus = os.cpus();\n\n/**\n * 执行多个异步任务\n * @param {*} fnList 任务列表\n * @param {*} max 最大并发数限制，默认执行的是 CPU 密集性任务，线程数等于 CPU 核心数 + 1\n * @param {*} taskName 任务名称\n */\nmodule.exports = async function concurrentRun(fnList = [], max = cpus.length + 1, taskName = \'未命名\') {\n   if (!fnList.length) return;\n\n   console.log(\\`开始执行多个异步任务，最大并发数： \\${max}\\`);\n   const bar = new ProgressBar(\'执行中 [:bar] :rate/bps :percent :etas 第 :current 个 总共 :total 个\', {\n      total: fnList.length\n   });\n\n   const replyList = []; // 收集任务执行结果\n   // const count = fnList.length // 总任务数量\n   const startTime = new Date().getTime(); // 记录任务执行开始时间\n\n   // let current = 0\n   // 任务执行程序\n   const schedule = async (index) => {\n      // eslint-disable-next-line no-async-promise-executor\n      return new Promise(async (resolve) => {\n         try {\n            const fn = fnList[index];\n            if (!fn) return resolve();\n\n            // 执行当前异步任务\n            const reply = await fn();\n            replyList[index] = reply;\n         } catch (e) {\n            console.log(e);\n            // 报错了不管继续下一个\n            resolve();\n         }\n\n         bar.tick();\n         // current++\n         // console.log(\n         //   \\`\\${taskName} 事务进度，第 \\${current} 个，共 \\${count} 个，进度为 \\${((current / count) * 100).toFixed(2)}% \\`\n         // )\n\n         // 执行完当前任务后，继续执行任务池的剩余任务\n         await schedule(index + max);\n         resolve();\n      });\n   };\n\n   // 任务池执行程序\n   const scheduleList = new Array(max).fill(0).map((_, index) => schedule(index));\n   // 使用 Promise.all 批量执行\n   await Promise.all(scheduleList);\n\n   const cost = (new Date().getTime() - startTime) / 1000;\n   if (bar.complete) {\n      console.log(\\`执行完成，最大并发数： \\${max}，耗时：\\${cost}s\\`);\n   }\n   return replyList;\n};`, `45140917789626655000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> ProgressBar <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'progress\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'os\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> cpus <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * 执行多个异步任务\n * @param {*} fnList 任务列表\n * @param {*} max 最大并发数限制，默认执行的是 CPU 密集性任务，线程数等于 CPU 核心数 + 1\n * @param {*} taskName 任务名称\n */</span>\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">concurrentRun</span><span class="token punctuation">(</span>fnList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max <span class="token operator">=</span> cpus<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> taskName <span class="token operator">=</span> <span class="token string">\'未命名\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fnList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">开始执行多个异步任务，最大并发数： </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>max<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgressBar</span><span class="token punctuation">(</span><span class="token string">\'执行中 [:bar] :rate/bps :percent :etas 第 :current 个 总共 :total 个\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      total<span class="token punctuation">:</span> fnList<span class="token punctuation">.</span>length\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> replyList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 收集任务执行结果</span>\n   <span class="token comment">// const count = fnList.length // 总任务数量</span>\n   <span class="token keyword">const</span> startTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 记录任务执行开始时间</span>\n\n   <span class="token comment">// let current = 0</span>\n   <span class="token comment">// 任务执行程序</span>\n   <span class="token keyword">const</span> <span class="token function-variable function">schedule</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-next-line no-async-promise-executor</span>\n      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">try</span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> fn <span class="token operator">=</span> fnList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n            <span class="token comment">// 执行当前异步任务</span>\n            <span class="token keyword">const</span> reply <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            replyList<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> reply<span class="token punctuation">;</span>\n         <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token comment">// 报错了不管继续下一个</span>\n            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n\n         bar<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token comment">// current++</span>\n         <span class="token comment">// console.log(</span>\n         <span class="token comment">//   `${taskName} 事务进度，第 ${current} 个，共 ${count} 个，进度为 ${((current / count) * 100).toFixed(2)}% `</span>\n         <span class="token comment">// )</span>\n\n         <span class="token comment">// 执行完当前任务后，继续执行任务池的剩余任务</span>\n         <span class="token keyword">await</span> <span class="token function">schedule</span><span class="token punctuation">(</span>index <span class="token operator">+</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 任务池执行程序</span>\n   <span class="token keyword">const</span> scheduleList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">schedule</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// 使用 Promise.all 批量执行</span>\n   <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>scheduleList<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> cost <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>bar<span class="token punctuation">.</span>complete<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">执行完成，最大并发数： </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>max<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，耗时：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cost<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">s</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">return</span> replyList<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>compress.config.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97401842779992880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n   mp4: {\n      mp4: {\n         bashFunc: (input, output) =>\n            \\`ffmpeg -y -i \\${input} -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 25 -an -movflags faststart -v fatal \\${output}\\`,\n         hasAudio: {\n            bashFunc: (input, output) =>\n               \\`ffmpeg -y -i \\${input} -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 25 -movflags faststart -v fatal \\${output}\\`,\n            files: [\'public/p7/xmart-os/p7-p6-1.mp4\', \'public/no/p7/build-yours/p7-p1-1@long.mp4\']\n         }\n      },\n      mpeg: {\n         4: {\n            bashFunc: (input, output) =>\n               \\`ffmpeg -y -i \\${input} -f mpeg1video -codec:v mpeg1video -q 4 -bf 0 -r 25 -an -movflags faststart -v fatal \\${output}\\`,\n            files: [\n               \'public/p5/smart-space-internal/p5-inside.mp4\',\n               \'public/p7/extra-performance/p7-chassis.mp4\',\n               \'public/p7/learn-more/p7-wing.mp4\',\n               \'public/g3i/xmart-os/g3i-inside.mp4\'\n            ]\n         }\n      }\n   }\n};`, `97401842779992880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   mp4<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      mp4<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         <span class="token function-variable function">bashFunc</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ffmpeg -y -i </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>input<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 25 -an -movflags faststart -v fatal </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>output<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n         hasAudio<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token function-variable function">bashFunc</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n               <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ffmpeg -y -i </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>input<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -b:v 2048k -maxrate:v 2048k -minrate:v 2048k -r 25 -movflags faststart -v fatal </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>output<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n            files<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'public/p7/xmart-os/p7-p6-1.mp4\'</span><span class="token punctuation">,</span> <span class="token string">\'public/no/p7/build-yours/p7-p1-1@long.mp4\'</span><span class="token punctuation">]</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      mpeg<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         <span class="token number">4</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token function-variable function">bashFunc</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n               <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ffmpeg -y -i </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>input<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> -f mpeg1video -codec:v mpeg1video -q 4 -bf 0 -r 25 -an -movflags faststart -v fatal </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>output<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n            files<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n               <span class="token string">\'public/p5/smart-space-internal/p5-inside.mp4\'</span><span class="token punctuation">,</span>\n               <span class="token string">\'public/p7/extra-performance/p7-chassis.mp4\'</span><span class="token punctuation">,</span>\n               <span class="token string">\'public/p7/learn-more/p7-wing.mp4\'</span><span class="token punctuation">,</span>\n               <span class="token string">\'public/g3i/xmart-os/g3i-inside.mp4\'</span>\n            <span class="token punctuation">]</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="国际化"><a href="#%E5%9B%BD%E9%99%85%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>国际化</h1>\n<h2 id="语言动态加载"><a href="#%E8%AF%AD%E8%A8%80%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语言动态加载</h2>\n<p>利用 <code class="language-text">require.context</code> 动态读取目录下的文件内容，实现动态加载语言配置、自定义前缀功能</p>\n<h3 id="目录结构"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52203440915742650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── i18n.ts\n└── lang\n    ├── da-DK\n    ├── en-US\n    ├── nb-NO\n    ├── nl-NL\n    └── sv-SE`, `52203440915742650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.\n├── i18n.ts\n└── lang\n    ├── da-DK\n    ├── en-US\n    ├── nb-NO\n    ├── nl-NL\n    └── sv-SE</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="核心代码-5"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90726299235081440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import i18n, { Resource } from \'i18next\';\nimport { initReactI18next } from \'react-i18next\';\nimport { DEFAULT_LANGUAGE } from \'@/constants\';\nimport path from \'path\';\nimport { camelCase } from \'lodash\';\n\nconst moduleFiles = require.context(\'./lang\', true, /\\.ts\\$/);\n\nconst resources: Resource = {};\n\nmoduleFiles.keys().forEach((item: string) => {\n   const dirname = path.dirname(item);\n   // 取路径里面的第一个目录\n   const keys = dirname.split(\'/\').filter((item) => item && item !== \'.\');\n   const [key, ...restKey] = keys;\n   if (key) {\n      let value = moduleFiles(item).default || moduleFiles(item);\n      const pathPrefix = [];\n      // 是否携带路径前缀\n      if (value.withPathPrefix) {\n         pathPrefix.push(...restKey);\n      }\n      // 是否携带文件前缀\n      if (value.withFilePrefix) {\n         const basename = path.basename(item, \'.ts\');\n         pathPrefix.push(basename);\n      }\n\n      if (pathPrefix.length > 0) {\n         const newValue: { [key: string]: any } = {};\n         const newPathPrefix = pathPrefix.map(camelCase).join(\'.\');\n         Object.keys(value).forEach((key2) => {\n            newValue[\\`\\${newPathPrefix}.\\${key2}\\`] = value[key2];\n         });\n         value = newValue;\n      }\n\n      if (resources[key]) {\n         resources[key].translation = {\n            ...(resources[key].translation as {}),\n            ...value\n         };\n      } else {\n         resources[key] = {\n            translation: value\n         };\n      }\n   }\n});\n\nexport const initLanguage = async function(language: string = DEFAULT_LANGUAGE) {\n   if (i18n.isInitialized) {\n      if (language !== i18n.language) {\n         await i18n.changeLanguage(language);\n      }\n      return;\n   }\n   return await i18n\n      .use(initReactI18next) // passes i18n down to react-i18next\n      .init({\n         resources,\n         debug: process.env.NODE_ENV === \'development\',\n         lng: language,\n         keySeparator: false, // we do not use keys in form messages.welcome\n         interpolation: {\n            escapeValue: false\n         }\n         // 不能使用数组或对象，因为需要用户去填字符串\n         // returnObjects: true\n      })\n      .catch((error) => {\n         console.info(\'initReactI18next error:\', error);\n      });\n};`, `90726299235081440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">import</span> i18n<span class="token punctuation">,</span> <span class="token punctuation">{</span> Resource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'i18next\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> initReactI18next <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-i18next\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">DEFAULT_LANGUAGE</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@/constants\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">\'path\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> camelCase <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'lodash\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> moduleFiles <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">\'./lang\'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\\.ts$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> resources<span class="token punctuation">:</span> Resource <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\nmoduleFiles<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// 取路径里面的第一个目录</span>\n   <span class="token keyword">const</span> keys <span class="token operator">=</span> dirname<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">&amp;&amp;</span> item <span class="token operator">!==</span> <span class="token string">\'.\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> <span class="token operator">...</span>restKey<span class="token punctuation">]</span> <span class="token operator">=</span> keys<span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">moduleFiles</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span> <span class="token operator">||</span> <span class="token function">moduleFiles</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> pathPrefix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token comment">// 是否携带路径前缀</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>withPathPrefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         pathPrefix<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>restKey<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// 是否携带文件前缀</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>withFilePrefix<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> basename <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">\'.ts\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         pathPrefix<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>basename<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>pathPrefix<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> newValue<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n         <span class="token keyword">const</span> newPathPrefix <span class="token operator">=</span> pathPrefix<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>camelCase<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'.\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            newValue<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newPathPrefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">[</span>key2<span class="token punctuation">]</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>resources<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         resources<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>translation <span class="token operator">=</span> <span class="token punctuation">{</span>\n            <span class="token operator">...</span><span class="token punctuation">(</span>resources<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>translation <span class="token keyword">as</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n            <span class="token operator">...</span>value\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n         resources<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n            translation<span class="token punctuation">:</span> value\n         <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initLanguage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">language<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token constant">DEFAULT_LANGUAGE</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>i18n<span class="token punctuation">.</span>isInitialized<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>language <span class="token operator">!==</span> i18n<span class="token punctuation">.</span>language<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">await</span> i18n<span class="token punctuation">.</span><span class="token function">changeLanguage</span><span class="token punctuation">(</span>language<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">return</span> <span class="token keyword">await</span> i18n\n      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>initReactI18next<span class="token punctuation">)</span> <span class="token comment">// passes i18n down to react-i18next</span>\n      <span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n         resources<span class="token punctuation">,</span>\n         debug<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n         lng<span class="token punctuation">:</span> language<span class="token punctuation">,</span>\n         keySeparator<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// we do not use keys in form messages.welcome</span>\n         interpolation<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            escapeValue<span class="token punctuation">:</span> <span class="token boolean">false</span>\n         <span class="token punctuation">}</span>\n         <span class="token comment">// 不能使用数组或对象，因为需要用户去填字符串</span>\n         <span class="token comment">// returnObjects: true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">\'initReactI18next error:\'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>添加所需的字段：</p>\n<p>web/locales/lang/en-US/p7/app-download.ts</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81210427678391090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export default {\n   withPathPrefix: true,\n   withFilePrefix: true,\n   title: \'123456\'\n};`, `81210427678391090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n   withPathPrefix<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   withFilePrefix<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   title<span class="token punctuation">:</span> <span class="token string">\'123456\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用时的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39670294518183910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { useTranslation } from \'react-i18next\';\nconst { t } = useTranslation();\nconst getValue = (param: string) => t(\\`p7.appDownload.\\${param}\\`);\n// console.log(getValue(\'title\'))`, `39670294518183910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> useTranslation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-i18next\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> t <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useTranslation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token function-variable function">getValue</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">param<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">t</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">p7.appDownload.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>param<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// console.log(getValue(\'title\'))</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="路由复用"><a href="#%E8%B7%AF%E7%94%B1%E5%A4%8D%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>路由复用</h2>\n<h3 id="需求背景-6"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>国家站的页面和国际站大部分的页面相同，只是语言不同，可以复用路由</p>\n<h3 id="核心代码-6"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<p>见标红部分代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17241304222576615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const { join } = require(\'path\')\nconst { getFeDir } = require(\'ssr-server-utils\')\nconst fs = require(\'fs\')\n\nconst countryList = [\'no\', \'se\', \'dk\', \'nl\'] // 挪威 NO, 瑞典 SE, 丹麦 DK, 荷兰 NL\n\n// https://github.com/zhangyuang/ssr/blob/8e9e5514d81f0db24a8c9e59bac8379f7a09a2c0/packages/server-utils/src/parse.ts#L159\nconst renderRoutes = (pageDir, pathRecord, route) => {\n  let arr = []\n  const pagesFolders = fs.readdirSync(pageDir)\n  const prefixPath = pathRecord.join(\'/\')\n  const aliasPath = \\`@/pages\\${prefixPath}\\`\n  const routeArr = []\n  const fetchExactMatch = pagesFolders.filter(p => p.includes(\'fetch\'))\n  for (const pageFiles of pagesFolders) {\n    const abFolder = join(pageDir, pageFiles)\n    const isDirectory = fs.lstatSync(abFolder).isDirectory()\n    if (isDirectory) {\n      // 如果是文件夹则递归下去, 记录路径\n      pathRecord.push(pageFiles)\n      const childArr = renderRoutes(abFolder, pathRecord, Object.assign({}, route))\n      pathRecord.pop() // 回溯\n      arr = arr.concat(childArr)\n    } else {\n      // 遍历一个文件夹下面的所有文件\n      if (!pageFiles.includes(\'render\')) {\n        continue\n      }\n      // 拿到具体的文件\n      if (pageFiles.includes(\'render\\$\')) {\n        /* /news/:id */\n        route.path = \\`\\${prefixPath}/:\\${getDynamicParam(pageFiles)}\\`\n        route.component = \\`\\${aliasPath}/\\${pageFiles}\\`\n        let webpackChunkName = pathRecord.join(\'-\')\n        if (webpackChunkName.startsWith(\'-\')) {\n          webpackChunkName = webpackChunkName.replace(\'-\', \'\')\n        }\n        route.webpackChunkName = \\`\\${webpackChunkName}-\\${getDynamicParam(pageFiles).replace(/\\/:\\??/g, \'-\').replace(\'?\', \'-optional\')}\\`\n      } else if (pageFiles.includes(\'render\')) {\n        /* /news */\n        route.path = \\`\\${prefixPath}\\`\n        route.component = \\`\\${aliasPath}/\\${pageFiles}\\`\n        let webpackChunkName = pathRecord.join(\'-\')\n        if (webpackChunkName.startsWith(\'-\')) {\n          webpackChunkName = webpackChunkName.replace(\'-\', \'\')\n        }\n        route.webpackChunkName = webpackChunkName\n      }\n\n      if (fetchExactMatch.length >= 2) {\n        // fetch 文件数量 >=2 启用完全匹配策略 render\\$id => fetch\\$id, render => fetch\n        const fetchPageFiles = \\`\\${pageFiles.replace(\'render\', \'fetch\').split(\'.\')[0]}.ts\\`\n        if (fetchExactMatch.includes(fetchPageFiles)) {\n          route.fetch = \\`\\${aliasPath}/\\${fetchPageFiles}\\`\n        }\n      } else if (fetchExactMatch.includes(\'fetch.ts\')) {\n        // 单 fetch 文件的情况 所有类型的 render 都对应该 fetch\n        route.fetch = \\`\\${aliasPath}/fetch.ts\\`\n      }\n      routeArr.push({ ...route })\n    }\n  }\n  routeArr.forEach((r) => {\n    if (r.path?.includes(\'index\')) {\n      r.path && arr.push(JSON.parse(JSON.stringify(r)))\n      // /index 映射为 /\n      if (r.path.split(\'/\').length >= 3) {\n        r.path = r.path.replace(\'/index\', \'\')\n      } else {\n        r.path = r.path.replace(\'index\', \'\')\n      }\n    }\n\n    r.path && arr.push(r)\n  })\n\n  return arr\n}\n\nconst getDynamicParam = (url) => {\n  return url.split(\'\\$\').filter(r => r !== \'render\' && r !== \'\').map(r => r.replace(/\\.[\\s\\S]+/, \'\').replace(\'#\', \'?\')).join(\'/:\')\n}\n\nconst accessFile = (file) => {\n  try {\n    fs.accessSync(file)\n  } catch (error) {\n    return false\n  }\n  return true\n}\n\nconst { dynamic = true, routerPriority, routerOptimize } = {}\nconst prefix = \'\'\n// 根据目录结构生成前端路由表\nconst pathRecord = [\'\'] // 路径记录\nconst route = {}\nlet arr = renderRoutes(join(getFeDir(), \'pages\'), pathRecord, route)\nif (routerPriority) {\n  // 路由优先级排序\n  arr.sort((a, b) => {\n    // 没有显示指定的路由优先级统一为 0\n    return (routerPriority[b.path] || 0) - (routerPriority[a.path] || 0)\n  })\n}\n\nif (routerOptimize) {\n  // 路由过滤\n  if (routerOptimize.include && routerOptimize.exclude) {\n    throw new Error(\'include and exclude cannot exist synchronal\')\n  }\n  if (routerOptimize.include) {\n    arr = arr.filter(route => routerOptimize.include.includes(route.path))\n  }\n  if (routerOptimize.exclude) {\n    arr = arr.filter(route => !routerOptimize.exclude.includes(route.path))\n  }\n}\n\nconst countryRoutes = []\ncountryList.forEach(country => {\n  arr.forEach(route => {\n    const path = \\`/\\${country}\\${route.path}\\`\n    // 注意这里需要去除掉 2 个国家的无效路径\n    if (arr.every(route => route.path !== path) && path.split(\'/\').filter((item) => countryList.includes(item)).length <= 1) {\n      countryRoutes.push({\n        ...route,\n        path\n      })\n    }\n    if (route.path === \'/\') {\n      countryRoutes.push({\n        ...route,\n        path: \\`/\\${country}\\`\n      })\n    }\n  })\n})\n\narr = arr.concat(countryRoutes)\n\nconst accessReactApp = accessFile(join(getFeDir(), \'./components/layout/App.tsx\'))\nconst layoutFetch = accessFile(join(getFeDir(), \'./components/layout/fetch.ts\'))\nconst accessStore = accessFile(join(getFeDir(), \'./store/index.ts\'))\nconst re = /&quot;webpackChunkName&quot;:(&quot;(.+?)&quot;)/g\n\nlet routes = \\`\n        // The file is provisional，don\'t depend on it\n        export const FeRoutes = \\${JSON.stringify(arr)}\n        \\${accessReactApp ? \'export { default as App } from &quot;@/components/layout/App.tsx&quot;\' : \'\'}\n        \\${layoutFetch ? \'export { default as layoutFetch } from &quot;@/components/layout/fetch.ts&quot;\' : \'\'}\n        \\${accessStore ? \'export * from &quot;@/store/index.ts&quot;\' : \'\'}\n        \\${prefix ? \\`export const PrefixRouterBase=\'\\${prefix}\'\\` : \'\'}\n      \\`\nroutes = routes.replace(/&quot;component&quot;:(&quot;(.+?)&quot;)/g, (global, m1, m2) => {\n  const currentWebpackChunkName = re.exec(routes)[2]\n  if (dynamic) {\n    return \\`&quot;component&quot;: function dynamicComponent () {\n            return import(/* webpackChunkName: &quot;\\${currentWebpackChunkName}&quot; */ \'\\${m2.replace(/\\^/g, \'&quot;\')}\')\n          }\n          \\`\n  } else {\n    return \\`&quot;component&quot;: require(\'\\${m2.replace(/\\^/g, \'&quot;\')}\').default\\`\n  }\n})\nre.lastIndex = 0\nroutes = routes.replace(/&quot;fetch&quot;:(&quot;(.+?)&quot;)/g, (global, m1, m2) => {\n  const currentWebpackChunkName = re.exec(routes)[2]\n  return \\`&quot;fetch&quot;: () => import(/* webpackChunkName: &quot;\\${currentWebpackChunkName}-fetch&quot; */ \'\\${m2.replace(/\\^/g, \'&quot;\')}\')\\`\n})\n\nfs.writeFileSync(join(getFeDir(), \'route.ts\'), routes)\n// 替换以下 console.log 内容即可在 router.json 文件找到所有的官网路径\n// console.log(arr.map((item) => item.path).join(\'\\n\'))\nfs.writeFileSync(join(__dirname, \'../src/router.json\'), JSON.stringify(arr))`, `17241304222576615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts{120-140}"\n              >\n                <span class="gatsby-code-button-language">ts{120-140}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> getFeDir <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'ssr-server-utils\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> countryList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'no\'</span><span class="token punctuation">,</span> <span class="token string">\'se\'</span><span class="token punctuation">,</span> <span class="token string">\'dk\'</span><span class="token punctuation">,</span> <span class="token string">\'nl\'</span><span class="token punctuation">]</span> <span class="token comment">// 挪威 NO, 瑞典 SE, 丹麦 DK, 荷兰 NL</span>\n\n<span class="token comment">// https://github.com/zhangyuang/ssr/blob/8e9e5514d81f0db24a8c9e59bac8379f7a09a2c0/packages/server-utils/src/parse.ts#L159</span>\n<span class="token keyword">const</span> <span class="token function-variable function">renderRoutes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pageDir<span class="token punctuation">,</span> pathRecord<span class="token punctuation">,</span> route</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n  <span class="token keyword">const</span> pagesFolders <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>pageDir<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> prefixPath <span class="token operator">=</span> pathRecord<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span>\n  <span class="token keyword">const</span> aliasPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@/pages</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n  <span class="token keyword">const</span> routeArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n  <span class="token keyword">const</span> fetchExactMatch <span class="token operator">=</span> pagesFolders<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=></span> p<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">\'fetch\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> pageFiles <span class="token keyword">of</span> pagesFolders<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> abFolder <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>pageDir<span class="token punctuation">,</span> pageFiles<span class="token punctuation">)</span>\n    <span class="token keyword">const</span> isDirectory <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">lstatSync</span><span class="token punctuation">(</span>abFolder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>isDirectory<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 如果是文件夹则递归下去, 记录路径</span>\n      pathRecord<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pageFiles<span class="token punctuation">)</span>\n      <span class="token keyword">const</span> childArr <span class="token operator">=</span> <span class="token function">renderRoutes</span><span class="token punctuation">(</span>abFolder<span class="token punctuation">,</span> pathRecord<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">)</span>\n      pathRecord<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 回溯</span>\n      arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>childArr<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 遍历一个文件夹下面的所有文件</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pageFiles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">\'render\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">continue</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// 拿到具体的文件</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>pageFiles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">\'render$\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">/* /news/:id */</span>\n        route<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getDynamicParam</span><span class="token punctuation">(</span>pageFiles<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n        route<span class="token punctuation">.</span>component <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aliasPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageFiles<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n        <span class="token keyword">let</span> webpackChunkName <span class="token operator">=</span> pathRecord<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'-\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>webpackChunkName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">\'-\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          webpackChunkName <span class="token operator">=</span> webpackChunkName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'-\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        route<span class="token punctuation">.</span>webpackChunkName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>webpackChunkName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getDynamicParam</span><span class="token punctuation">(</span>pageFiles<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\/:\\??/g</span><span class="token punctuation">,</span> <span class="token string">\'-\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'?\'</span><span class="token punctuation">,</span> <span class="token string">\'-optional\'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pageFiles<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">\'render\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">/* /news */</span>\n        route<span class="token punctuation">.</span>path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n        route<span class="token punctuation">.</span>component <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aliasPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageFiles<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n        <span class="token keyword">let</span> webpackChunkName <span class="token operator">=</span> pathRecord<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'-\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>webpackChunkName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">\'-\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          webpackChunkName <span class="token operator">=</span> webpackChunkName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'-\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n        route<span class="token punctuation">.</span>webpackChunkName <span class="token operator">=</span> webpackChunkName\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>fetchExactMatch<span class="token punctuation">.</span>length <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// fetch 文件数量 >=2 启用完全匹配策略 render$id => fetch$id, render => fetch</span>\n        <span class="token keyword">const</span> fetchPageFiles <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageFiles<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'render\'</span><span class="token punctuation">,</span> <span class="token string">\'fetch\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'.\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.ts</span><span class="token template-punctuation string">`</span></span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>fetchExactMatch<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>fetchPageFiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          route<span class="token punctuation">.</span>fetch <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aliasPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fetchPageFiles<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>fetchExactMatch<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">\'fetch.ts\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 单 fetch 文件的情况 所有类型的 render 都对应该 fetch</span>\n        route<span class="token punctuation">.</span>fetch <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aliasPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/fetch.ts</span><span class="token template-punctuation string">`</span></span>\n      <span class="token punctuation">}</span>\n      routeArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>route <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  routeArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>path<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">\'index\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      r<span class="token punctuation">.</span>path <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token comment">// /index 映射为 /</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        r<span class="token punctuation">.</span>path <span class="token operator">=</span> r<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'/index\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        r<span class="token punctuation">.</span>path <span class="token operator">=</span> r<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'index\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    r<span class="token punctuation">.</span>path <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n  <span class="token keyword">return</span> arr\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getDynamicParam</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'$\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=></span> r <span class="token operator">!==</span> <span class="token string">\'render\'</span> <span class="token operator">&amp;&amp;</span> r <span class="token operator">!==</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=></span> r<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\.[\\s\\S]+/</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'#\'</span><span class="token punctuation">,</span> <span class="token string">\'?\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'/:\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">accessFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    fs<span class="token punctuation">.</span><span class="token function">accessSync</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> dynamic <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> routerPriority<span class="token punctuation">,</span> routerOptimize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">const</span> prefix <span class="token operator">=</span> <span class="token string">\'\'</span>\n<span class="token comment">// 根据目录结构生成前端路由表</span>\n<span class="token keyword">const</span> pathRecord <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'\'</span><span class="token punctuation">]</span> <span class="token comment">// 路径记录</span>\n<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token function">renderRoutes</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token function">getFeDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'pages\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pathRecord<span class="token punctuation">,</span> route<span class="token punctuation">)</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>routerPriority<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 路由优先级排序</span>\n  arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 没有显示指定的路由优先级统一为 0</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>routerPriority<span class="token punctuation">[</span>b<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>routerPriority<span class="token punctuation">[</span>a<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>routerOptimize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 路由过滤</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>routerOptimize<span class="token punctuation">.</span>include <span class="token operator">&amp;&amp;</span> routerOptimize<span class="token punctuation">.</span>exclude<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'include and exclude cannot exist synchronal\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>routerOptimize<span class="token punctuation">.</span>include<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> routerOptimize<span class="token punctuation">.</span>include<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>routerOptimize<span class="token punctuation">.</span>exclude<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> <span class="token operator">!</span>routerOptimize<span class="token punctuation">.</span>exclude<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> countryRoutes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="gatsby-highlight-code-line">countryList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">country</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>country<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>route<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></span><span class="gatsby-highlight-code-line">    <span class="token comment">// 注意这里需要去除掉 2 个国家的无效路径</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> route<span class="token punctuation">.</span>path <span class="token operator">!==</span> path<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> countryList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      countryRoutes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">...</span>route<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        path</span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">\'/\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      countryRoutes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">...</span>route<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        path<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>country<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">arr <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>countryRoutes<span class="token punctuation">)</span></span>\n<span class="token keyword">const</span> accessReactApp <span class="token operator">=</span> <span class="token function">accessFile</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token function">getFeDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'./components/layout/App.tsx\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> layoutFetch <span class="token operator">=</span> <span class="token function">accessFile</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token function">getFeDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'./components/layout/fetch.ts\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> accessStore <span class="token operator">=</span> <span class="token function">accessFile</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token function">getFeDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'./store/index.ts\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> re <span class="token operator">=</span> <span class="token regex">/"webpackChunkName":("(.+?)")/g</span>\n\n<span class="token keyword">let</span> routes <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"></span>\n<span class="token string">        // The file is provisional，don\'t depend on it</span>\n<span class="token string">        export const FeRoutes = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span>\n<span class="token string">        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accessReactApp <span class="token operator">?</span> <span class="token string">\'export { default as App } from "@/components/layout/App.tsx"\'</span> <span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span>\n<span class="token string">        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>layoutFetch <span class="token operator">?</span> <span class="token string">\'export { default as layoutFetch } from "@/components/layout/fetch.ts"\'</span> <span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span>\n<span class="token string">        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>accessStore <span class="token operator">?</span> <span class="token string">\'export * from "@/store/index.ts"\'</span> <span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span>\n<span class="token string">        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export const PrefixRouterBase=\'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\'</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"></span>\n<span class="token string">      </span><span class="token template-punctuation string">`</span></span>\nroutes <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/"component":("(.+?)")/g</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">global<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> m2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> currentWebpackChunkName <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>dynamic<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">"component": function dynamicComponent () {</span>\n<span class="token string">            return import(/* webpackChunkName: "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currentWebpackChunkName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" */ \'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m2<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\^/g</span><span class="token punctuation">,</span> <span class="token string">\'"\'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\')</span>\n<span class="token string">          }</span>\n<span class="token string">          </span><span class="token template-punctuation string">`</span></span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">"component": require(\'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m2<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\^/g</span><span class="token punctuation">,</span> <span class="token string">\'"\'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\').default</span><span class="token template-punctuation string">`</span></span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\nre<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> <span class="token number">0</span>\nroutes <span class="token operator">=</span> routes<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/"fetch":("(.+?)")/g</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">global<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> m2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> currentWebpackChunkName <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>\n  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">"fetch": () => import(/* webpackChunkName: "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currentWebpackChunkName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-fetch" */ \'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m2<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\^/g</span><span class="token punctuation">,</span> <span class="token string">\'"\'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\')</span><span class="token template-punctuation string">`</span></span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\nfs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token function">getFeDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'route.ts\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> routes<span class="token punctuation">)</span>\n<span class="token comment">// 替换以下 console.log 内容即可在 router.json 文件找到所有的官网路径</span>\n<span class="token comment">// console.log(arr.map((item) => item.path).join(\'\\n\'))</span>\nfs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../src/router.json\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="多平台适配"><a href="#%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%80%82%E9%85%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多平台适配</h1>\n<h2 id="需求背景-7"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h2>\n<p>需要适配 PC、H5 的样式</p>\n<h2 id="选型过程-5"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h2>\n<ol>\n<li>PC 使用 rem 单位，h5 使用 vw 单位（ipad 端适配有问题，需要全部使用 rem 单位，便于样式控制），使用 @our-patches/postcss-px-to-viewport 插件做转换</li>\n<li>h5 端 100vh 的高度展示有问题，需要实时计算高度，使用 postcss-viewport-height-correction 插件实现</li>\n</ol>\n<h2 id="核心代码-7"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h2>\n<p>postcss.config.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38829429298084640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n   plugins: [\n      [\n         \'@our-patches/postcss-px-to-viewport\',\n         {\n            // https://github.com/evrone/postcss-px-to-viewport/blob/master/README_CN.md\n            unitToConvert: \'px\', // 需要转换的单位，默认为&quot;px&quot;\n            viewportWidth: 1920, // 视窗的宽度，对应设计稿的宽度\n            unitPrecision: 8, // 指定 px 转换为视窗单位值的小数后 x 位数，转换精度尽可能的大，防止出现图片比例问题\n            viewportUnit: \'rem\', // 希望使用的视口单位\n            fontViewportUnit: \'rem\', // 字体使用的视口单位,\n            minPixelValue: 1, // 最小的转换数值\n            mediaQuery: true, // 媒体查询里的单位是否需要转换单位\n            selectorBlackList: [/^html\\$/, \'hack\'],\n            exclude: /node_modules/,\n            include: [/(\\\\|\\/)web(\\\\|\\/)/]\n         }\n      ],\n      // 此插件主要修复了移动端 100vh 的高度（即减去搜索框的高度），需要配合 script 脚本实现，详见 postcss-viewport-height-correction 文档\n      // 效果：https://codepen.io/team/css-tricks/full/vapjge\n      // https://css-tricks.com/the-trick-to-viewport-units-on-mobile/\n      \'postcss-viewport-height-correction\'\n   ]\n};`, `38829429298084640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">[</span>\n         <span class="token string">\'@our-patches/postcss-px-to-viewport\'</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            <span class="token comment">// https://github.com/evrone/postcss-px-to-viewport/blob/master/README_CN.md</span>\n            unitToConvert<span class="token punctuation">:</span> <span class="token string">\'px\'</span><span class="token punctuation">,</span> <span class="token comment">// 需要转换的单位，默认为"px"</span>\n            viewportWidth<span class="token punctuation">:</span> <span class="token number">1920</span><span class="token punctuation">,</span> <span class="token comment">// 视窗的宽度，对应设计稿的宽度</span>\n            unitPrecision<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// 指定 px 转换为视窗单位值的小数后 x 位数，转换精度尽可能的大，防止出现图片比例问题</span>\n            viewportUnit<span class="token punctuation">:</span> <span class="token string">\'rem\'</span><span class="token punctuation">,</span> <span class="token comment">// 希望使用的视口单位</span>\n            fontViewportUnit<span class="token punctuation">:</span> <span class="token string">\'rem\'</span><span class="token punctuation">,</span> <span class="token comment">// 字体使用的视口单位,</span>\n            minPixelValue<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 最小的转换数值</span>\n            mediaQuery<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 媒体查询里的单位是否需要转换单位</span>\n            selectorBlackList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/^html$/</span><span class="token punctuation">,</span> <span class="token string">\'hack\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n            exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n            include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/(\\\\|\\/)web(\\\\|\\/)/</span><span class="token punctuation">]</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token comment">// 此插件主要修复了移动端 100vh 的高度（即减去搜索框的高度），需要配合 script 脚本实现，详见 postcss-viewport-height-correction 文档</span>\n      <span class="token comment">// 效果：https://codepen.io/team/css-tricks/full/vapjge</span>\n      <span class="token comment">// https://css-tricks.com/the-trick-to-viewport-units-on-mobile/</span>\n      <span class="token string">\'postcss-viewport-height-correction\'</span>\n   <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="swiper"><a href="#swiper" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>swiper</h1>\n<h2 id="需求背景-8"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h2>\n<ol>\n<li>swiper 嵌套时的垂直滚动不会离开当前嵌套的容器，需要做到滚动到边缘会离开当前嵌套容器即边缘检测</li>\n<li>需要实现 swiper 延迟滚动、解决滚轮不够顺滑问题</li>\n</ol>\n<h2 id="核心代码-8"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h2>\n<h3 id="嵌套边缘检测"><a href="#%E5%B5%8C%E5%A5%97%E8%BE%B9%E7%BC%98%E6%A3%80%E6%B5%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>嵌套边缘检测</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73412078577189920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const handleContainerWheel = (element) => {\n   const scrollHeight = element.scrollHeight\n   const slideSize = element.swiperSlideSize\n   const scrollDifferenceTop = scrollHeight - slideSize\n\n   const handleWheel = (event) => {\n      const scrollDifference = scrollHeight - slideSize - element.scrollTop\n\n      // Scroll wheel browser compatibility\n      const delta = event.wheelDelta || -1 * event.deltaY\n\n      // Enable scrolling if at edges\n      const spos = delta < 0 ? 0 : scrollDifferenceTop\n      const parseScrollDifference = Number.parseInt(\\`\\${scrollDifference}\\`)\n      const parseSpos = Number.parseInt(\\`\\${spos}\\`)\n\n      console.log(scrollDifference, spos)\n      if (parseScrollDifference !== parseSpos) {\n         console.log(\'stopPropagation\')\n         event.stopPropagation()\n      } else {\n         // 边缘释放参数关闭时才生效\n         if (!swiperRef?.current?.params?.mousewheel?.releaseOnEdges) {\n            // 滑动到最后一个幻灯片的底部，继续监听事件\n            if (parseScrollDifference === 0 && parseSpos === 0 && current === swiperRef?.current?.slides?.length - 1) {\n               return\n            }\n            // 滑动到第一个幻灯片的顶部，暂不处理，暂时没有首屏有滚动条的情况\n         }\n         element.removeEventListener(\'wheel\', handleWheel)\n         element.removeEventListener(\'scroll\', handleScroll)\n      }\n   }\n\n   element.addEventListener(\'wheel\', handleWheel)\n}\n\nconst handleScrollContainerEvent = (activeSlide: ActiveSlide) => {\n   const hasVerticalScrollbar = activeSlide.scrollHeight > activeSlide.clientHeight;\n   if (!hasVerticalScrollbar) {\n      return;\n   }\n   // 进入时重置滚动条\n   activeSlide.scrollTo(0, 0);\n   activeSlide.addEventListener(\'scroll\', handleScroll);\n   handleContainerWheel(activeSlide);\n}\n\n// 监听 swiper 的 onSlideChange 事件\nreturn (\n   <Swiper\n      onSlideChange={(slide) => {\n         swiperRef.current = slide;\n         if (haveNestedScrollbar) {\n            handleScrollContainerEvent(slide.slides[slide.realIndex] as ActiveSlide);\n         }\n      }}\n   ></Swiper>\n)`, `73412078577189920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">handleContainerWheel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> scrollHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>scrollHeight\n   <span class="token keyword">const</span> slideSize <span class="token operator">=</span> element<span class="token punctuation">.</span>swiperSlideSize\n   <span class="token keyword">const</span> scrollDifferenceTop <span class="token operator">=</span> scrollHeight <span class="token operator">-</span> slideSize\n\n   <span class="token keyword">const</span> <span class="token function-variable function">handleWheel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> scrollDifference <span class="token operator">=</span> scrollHeight <span class="token operator">-</span> slideSize <span class="token operator">-</span> element<span class="token punctuation">.</span>scrollTop\n\n      <span class="token comment">// Scroll wheel browser compatibility</span>\n      <span class="token keyword">const</span> delta <span class="token operator">=</span> event<span class="token punctuation">.</span>wheelDelta <span class="token operator">||</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> event<span class="token punctuation">.</span>deltaY\n\n      <span class="token comment">// Enable scrolling if at edges</span>\n      <span class="token keyword">const</span> spos <span class="token operator">=</span> delta <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> scrollDifferenceTop\n      <span class="token keyword">const</span> parseScrollDifference <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scrollDifference<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n      <span class="token keyword">const</span> parseSpos <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>spos<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>scrollDifference<span class="token punctuation">,</span> spos<span class="token punctuation">)</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>parseScrollDifference <span class="token operator">!==</span> parseSpos<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'stopPropagation\'</span><span class="token punctuation">)</span>\n         event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n         <span class="token comment">// 边缘释放参数关闭时才生效</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>swiperRef<span class="token operator">?</span><span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span>params<span class="token operator">?</span><span class="token punctuation">.</span>mousewheel<span class="token operator">?</span><span class="token punctuation">.</span>releaseOnEdges<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 滑动到最后一个幻灯片的底部，继续监听事件</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>parseScrollDifference <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> parseSpos <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> current <span class="token operator">===</span> swiperRef<span class="token operator">?</span><span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span>slides<span class="token operator">?</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span>\n            <span class="token punctuation">}</span>\n            <span class="token comment">// 滑动到第一个幻灯片的顶部，暂不处理，暂时没有首屏有滚动条的情况</span>\n         <span class="token punctuation">}</span>\n         element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">\'wheel\'</span><span class="token punctuation">,</span> handleWheel<span class="token punctuation">)</span>\n         element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">\'scroll\'</span><span class="token punctuation">,</span> handleScroll<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n\n   element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'wheel\'</span><span class="token punctuation">,</span> handleWheel<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">handleScrollContainerEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">activeSlide<span class="token punctuation">:</span> ActiveSlide</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> hasVerticalScrollbar <span class="token operator">=</span> activeSlide<span class="token punctuation">.</span>scrollHeight <span class="token operator">></span> activeSlide<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasVerticalScrollbar<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token comment">// 进入时重置滚动条</span>\n   activeSlide<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   activeSlide<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'scroll\'</span><span class="token punctuation">,</span> handleScroll<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">handleContainerWheel</span><span class="token punctuation">(</span>activeSlide<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 监听 swiper 的 onSlideChange 事件</span>\n<span class="token keyword">return</span> <span class="token punctuation">(</span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Swiper</span></span>\n      <span class="token attr-name">onSlideChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">slide</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         swiperRef<span class="token punctuation">.</span>current <span class="token operator">=</span> slide<span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>haveNestedScrollbar<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">handleScrollContainerEvent</span><span class="token punctuation">(</span>slide<span class="token punctuation">.</span>slides<span class="token punctuation">[</span>slide<span class="token punctuation">.</span>realIndex<span class="token punctuation">]</span> <span class="token keyword">as</span> ActiveSlide<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n   <span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Swiper</span></span><span class="token punctuation">></span></span>\n<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="延迟滚动"><a href="#%E5%BB%B6%E8%BF%9F%E6%BB%9A%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>延迟滚动</h3>\n<p>具体代码见 <a href="https://github.com/towavephone/swiper/commit/c7daf2d123e4fdda385b69c1eaa636d876562ee3" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<h2 id="运行效果-5"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h2>\n<h3 id="延迟滚动-1"><a href="#%E5%BB%B6%E8%BF%9F%E6%BB%9A%E5%8A%A8-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>延迟滚动</h3>\n<!-- <iframe data-src="https://codesandbox.io/embed/n67jtt?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/x34hxw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="懒加载"><a href="#%E6%87%92%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>懒加载</h1>\n<h2 id="需求背景-9"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h2>\n<p>需要对图片、视频进行懒加载</p>\n<h2 id="选型过程-6"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h2>\n<table>\n<thead>\n<tr>\n<th align="left">选型</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><a href="https://github.com/tuupola/lazyload" target="_blank" rel="nofollow noreferrer noopener">lazyload</a></td>\n<td align="left">支持 img 延迟加载</td>\n<td align="left">不支持 video 延迟加载</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/aFarkas/lazysizes" target="_blank" rel="nofollow noreferrer noopener">lazysizes</a></td>\n<td align="left">支持 img、iframe 延迟加载</td>\n<td align="left">不支持 video 延迟加载</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/verlok/vanilla-lazyload" target="_blank" rel="nofollow noreferrer noopener">vanilla-lazyload</a></td>\n<td align="left"><a href="https://github.com/verlok/vanilla-lazyload#vanilla-lazyload-vs-lazysizes" target="_blank" rel="nofollow noreferrer noopener">优点</a></td>\n<td align="left">需要手动通知 dom 变化</td>\n</tr>\n</tbody>\n</table>\n<h2 id="实现难点"><a href="#%E5%AE%9E%E7%8E%B0%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现难点</h2>\n<ol>\n<li>lazyloader 循环引用导致的报错、检测</li>\n<li>lazyloader 加载不同分辨率的图片（ahooks 的 useReponsive 封装有问题，需要自己重新封装）</li>\n<li>封装使用形式类似 react-spring 的 lazyloader</li>\n<li>动态监听 src/srcSet 实现同步</li>\n<li>需要封装各种使用形式的组件，为此需要合理组织文件结构，需要实现的功能大致如下</li>\n</ol>\n<table>\n  <thead>\n    <tr>\n      <th>UI 类型</th>\n      <th>平台</th>\n      <th>策略</th>\n      <th>详细说明</th>\n      <th>传递属性</th>\n      <th>代码示例</th>\n   </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td rowspan="9">视频</td>\n      <td rowspan="8">pc</td>\n      <td>自动播放</td>\n      <td>默认自动循环静音播放</td>\n      <td>playStrategy = \'autoPlay\'，默认不用传</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>点击播放</td>\n      <td>点击循环静音播放、带自定义播放图标</td>\n      <td>playStrategy = \'clickPlay\'</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>按住播放</td>\n      <td>按住循环播放、带自定义播放图标、带播放进度条显示</td>\n      <td>playStrategy = \'pressHoldPlay\'</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>点击视频弹窗播放</td>\n      <td>短视频自动循环静音播放，点击短视频后弹窗自动播放长视频一次</td>\n      <td>\n         <ol>\n            <li>传递 playStrategy = \'clickVideoModalPlay\'</li>\n            <li>原有的 srcSet、minSrcSet、src 控制短视频，这 3 个属性加上 long 前缀控制长视频，即 longSrcSet、longMinSrcSet、longSrc，如果不传 long 前缀属性则取短视频属性</li>\n            <li>通过 ref 控制弹窗打开，调用 videoRef.current?.openModal()</li>\n         </ol>\n      </td>\n      <td>\n         import { l, ClickVideoModalPlayRef } from &#x27;@/components/lazyLoader&#x27;\n         <br/>\n         <br/>\n         const videoRef = useRef&lt;ClickVideoModalPlayRef&gt;(null)\n         <br/>\n         <br/>\n         // 调用示例\n         useEffect(() =&gt; {\n            setTimeout(() =&gt; {\n               videoRef.current?.openModal()\n            }, 6000)\n         }, [])\n         <br/>\n         <br/>\n         &lt;l.video\n            ref={videoRef}\n            playStrategy=&quot;clickVideoModalPlay&quot;\n            src=&quot;/public/p7/xmart-os/p7-p6-1@short.mp4&quot;\n            longSrc=&quot;/public/p7/xmart-os/p7-p6-1@long.mp4&quot; // 不传则取 src\n         /&gt;\n      </td>\n    </tr>\n    <tr>\n      <td>悬停播放</td>\n      <td>鼠标悬浮循环静音播放视频，离开时回到初始状态</td>\n      <td>playStrategy = \'mouseOverPlay\'</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>进度控制</td>\n      <td>控制视频进度</td>\n      <td>playStrategy = \'progressControl\'，传递 progress（百分比，以 1 为单位）控制视频进度</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>点击播放（带控制条，播放状态控制）</td>\n      <td>点击后播放一次视频、自带控制条、初始播放状态控制</td>\n      <td>playStrategy = \'clickPlayWithControl\'，传递 playing 控制初始播放状态</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>进入视口播放一次</td>\n      <td>完全 100% 看到视频从头开始播放一次（每次看到视频就会触发）</td>\n      <td>playStrategy = \'inViewportPlay\'</td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>h5</td>\n      <td>点击图片弹窗播放</td>\n      <td>\n         <ol>\n            <li>\n               图片展示，带自定义播放图标，如无图片则取原视频第一帧\n            </li>\n            <li>\n               点击自定义播放图标弹窗自动播放一次视频\n            </li>\n         </ol>\n      </td>\n      <td>\n         <ol>\n            <li>\n               传 srcSetPoster, srcPoster, minSrcSetPoster 作为封面图片，可以只传 srcPoster\n            </li>\n            <li>\n               默认 h5 使用此策略，不需要传 playStrategy（playStrategy === \'clickImgModalPlay\'）\n            </li>\n            <li>\n               如需覆盖请直接传具体的 playStrategy\n            </li>\n            <li>\n               需要保证播放图标可以点击，全屏视频有可能点击不到，需要把视频样式的 z-index 去掉\n            </li>\n            <li>\n               传递 playIconPosition 代表播放按钮位置\n            </li>\n            <li>\n               showPlayIcon 代表是否展示播放图标\n            </li>\n            <li>\n               通过 ref 控制弹窗打开，调用 videoRef.current?.openModal()\n            </li>\n         </ol>\n      </td>\n      <td></td>\n    </tr>\n    <tr>\n      <td rowspan="2">图片</td>\n      <td>pc</td>\n      <td>正常展示</td>\n      <td></td>\n      <td></td>\n      <td></td>\n    </tr>\n    <tr>\n      <td>h5</td>\n      <td>弹窗展示</td>\n      <td>点击弹窗后展示，等比例放大，宽度自适应（弹窗图片的左右切换实现难度大，之后再做）</td>\n      <td></td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n<h2 id="运行效果-6"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h2>\n<!-- <iframe data-src="https://codesandbox.io/embed/etwmhs?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nxsy6m?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="优化方向"><a href="#%E4%BC%98%E5%8C%96%E6%96%B9%E5%90%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化方向</h2>\n<ol>\n<li>编译原理相关：利用 ts-morph、ts-morpher 自动导入 lazyloader 的 lazyElement 的 div、video、img 组件</li>\n<li>img 组件没有封装，复用之前的组件</li>\n</ol>\n<h1 id="弹窗-hook-封装"><a href="#%E5%BC%B9%E7%AA%97-hook-%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>弹窗 hook 封装</h1>\n<h2 id="需求背景-10"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h2>\n<p>由于需要实现大量弹窗展示的功能，为了尽量减少代码行数，提高复用性，这里采用 hooks 的方式去实现弹窗</p>\n<h2 id="usemodal-封装"><a href="#usemodal-%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useModal 封装</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85209268342683700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, {\n   useRef,\n   forwardRef,\n   useState,\n   useImperativeHandle,\n   useCallback,\n   ComponentType,\n   PropsWithoutRef\n} from \'react\';\nimport { ModalProps, Modal } from \'antd\';\n\ntype ModalRefType<T> =\n   | {\n        open: (initProp?: Partial<T>) => void;\n        close: () => void;\n     }\n   | undefined;\n\ninterface UseModalProps<T> {\n   component: ComponentType<T>; // 子组件\n   modalProps?: Partial<ModalProps>; // 弹窗属性\n}\n\nconst useModal = function<T>({ component: Component, modalProps }: UseModalProps<T>) {\n   const modalRef = useRef<ModalRefType<T>>();\n   const [globalVisible, setGlobalVisible] = useState(false);\n\n   const ComponentModal = forwardRef<ModalRefType<T>, T>((componetProps, componentRef) => {\n      const [visible, setVisible] = useState(false);\n      const [componentInitProp, setComponentInitProp] = useState<Partial<T>>();\n\n      const handleOk = (initProps?: Partial<T>) => {\n         if (initProps) {\n            setComponentInitProp(initProps);\n         }\n         setVisible(true);\n         setGlobalVisible(true);\n      };\n\n      const handleCancel = () => {\n         setVisible(false);\n         setGlobalVisible(false);\n      };\n\n      useImperativeHandle(componentRef, () => ({\n         open: handleOk,\n         close: handleCancel\n      }));\n\n      return (\n         <Modal onCancel={handleCancel} visible={visible} {...modalProps}>\n            <Component onCancel={handleCancel} {...componetProps} {...componentInitProp} />\n         </Modal>\n      );\n   });\n\n   return {\n      Slot: useCallback((props: PropsWithoutRef<T>) => {\n         return <ComponentModal ref={modalRef} {...props} />;\n         // eslint-disable-next-line react-hooks/exhaustive-deps\n      }, []),\n      // 这里不能传 modalRef.current，因为传递的是引用\n      // 如果传的是 modalRef.current，会导致 modelRef.current 更新时不会同步更新到外部\n      api: modalRef,\n      visible: globalVisible\n   };\n};\n\nexport default useModal;`, `85209268342683700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n   useRef<span class="token punctuation">,</span>\n   forwardRef<span class="token punctuation">,</span>\n   useState<span class="token punctuation">,</span>\n   useImperativeHandle<span class="token punctuation">,</span>\n   useCallback<span class="token punctuation">,</span>\n   ComponentType<span class="token punctuation">,</span>\n   PropsWithoutRef\n<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> ModalProps<span class="token punctuation">,</span> Modal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'antd\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ModalRefType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text"> =\n   | </span><span class="token punctuation">{</span>\n        open<span class="token punctuation">:</span> <span class="token punctuation">(</span>initProp<span class="token operator">?</span><span class="token punctuation">:</span> Partial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">) => void;\n        close: () => void;\n     }\n   | undefined;\n\ninterface UseModalProps</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">{</span>\n   component<span class="token punctuation">:</span> ComponentType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">; // 子组件\n   modalProps?: Partial</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ModalProps</span></span><span class="token punctuation">></span></span><span class="token plain-text">; // 弹窗属性\n}\n\nconst useModal = function</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">(</span><span class="token punctuation">{</span> component<span class="token punctuation">:</span> Component<span class="token punctuation">,</span> modalProps <span class="token punctuation">}</span><span class="token plain-text">: UseModalProps</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">) </span><span class="token punctuation">{</span>\n   <span class="token keyword">const</span> modalRef <span class="token operator">=</span> useRef<span class="token operator">&lt;</span>ModalRefType<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">>();\n   const [globalVisible, setGlobalVisible] = useState(false);\n\n   const ComponentModal = forwardRef&lt;ModalRefType</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">, T>((componetProps, componentRef) => </span><span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">[</span>visible<span class="token punctuation">,</span> setVisible<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> <span class="token punctuation">[</span>componentInitProp<span class="token punctuation">,</span> setComponentInitProp<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span>Partial<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">>();\n\n      const handleOk = (initProps?: Partial</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">) => </span><span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>initProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">setComponentInitProp</span><span class="token punctuation">(</span>initProps<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n         <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token function">setGlobalVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token plain-text">;\n\n      const handleCancel = () => </span><span class="token punctuation">{</span>\n         <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token function">setGlobalVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token plain-text">;\n\n      useImperativeHandle(componentRef, () => (</span><span class="token punctuation">{</span>\n         open<span class="token punctuation">:</span> handleOk<span class="token punctuation">,</span>\n         close<span class="token punctuation">:</span> handleCancel\n      <span class="token punctuation">}</span><span class="token plain-text">));\n\n      return (\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span> <span class="token attr-name">onCancel</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleCancel<span class="token punctuation">}</span></span> <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>visible<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">modalProps</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Component</span></span> <span class="token attr-name">onCancel</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleCancel<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">componetProps</span><span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">componentInitProp</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      );\n   });\n\n   return </span><span class="token punctuation">{</span>\n      Slot<span class="token punctuation">:</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>props<span class="token punctuation">:</span> PropsWithoutRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">) => </span><span class="token punctuation">{</span>\n         <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentModal</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>modalRef<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">props</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>\n         <span class="token comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>\n      <span class="token punctuation">}</span><span class="token plain-text">, []),\n      // 这里不能传 modalRef.current，因为传递的是引用\n      // 如果传的是 modalRef.current，会导致 modelRef.current 更新时不会同步更新到外部\n      api: modalRef,\n      visible: globalVisible\n   };\n};\n\nexport default useModal;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="usedisplayermodal-封装"><a href="#usedisplayermodal-%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useDisplayerModal 封装</h2>\n<p>弹窗有一些公用属性，需要再次分层便于复用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26949110953911992000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { ComponentType } from \'react\';\n\nimport useModal from \'@/hooks/useModal\';\n\nimport styles from \'./index.module.less\';\n\nconst useDisplayerModal = function<T>(Component: ComponentType<T>) {\n   const result = useModal({\n      component: Component,\n      modalProps: {\n         className: styles.modal,\n         wrapClassName: styles.wrapClassName,\n         closable: false,\n         footer: null,\n         // 这里 destroyOnClose 设置 true 的原因是：swiper 需要销毁，否则导致 swiper 卡住的 bug\n         destroyOnClose: true,\n         centered: false\n      }\n   });\n   return result;\n};\n\nexport default useDisplayerModal;`, `26949110953911992000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> ComponentType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> useModal <span class="token keyword">from</span> <span class="token string">\'@/hooks/useModal\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./index.module.less\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">useDisplayerModal</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">(Component: ComponentType</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T</span></span><span class="token punctuation">></span></span><span class="token plain-text">) </span><span class="token punctuation">{</span>\n   <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">useModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      component<span class="token punctuation">:</span> Component<span class="token punctuation">,</span>\n      modalProps<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         className<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>modal<span class="token punctuation">,</span>\n         wrapClassName<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>wrapClassName<span class="token punctuation">,</span>\n         closable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n         footer<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n         <span class="token comment">// 这里 destroyOnClose 设置 true 的原因是：swiper 需要销毁，否则导致 swiper 卡住的 bug</span>\n         destroyOnClose<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n         centered<span class="token punctuation">:</span> <span class="token boolean">false</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> result<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token plain-text">;\n\nexport default useDisplayerModal;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="运行效果-7"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h2>\n<!-- <iframe data-src="https://codesandbox.io/embed/9pxwy5?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/whshqm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="其他"><a href="#%E5%85%B6%E4%BB%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他</h1>\n<h2 id="loadscript-优化"><a href="#loadscript-%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>loadScript 优化</h2>\n<h3 id="需求背景-11"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>需要有一个方法来手动加载脚本，延迟脚本加载的时机</p>\n<h3 id="优化过程"><a href="#%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化过程</h3>\n<ol>\n<li>生成唯一性的 uuid 来判断这个脚本是否加载，以实现只加载一次脚本的功能</li>\n<li>由于 loadScript 方法会在同一个页面同一 src 多次调用，实际上判断脚本是否加载并不能完美实现（会导致同一脚本多次加载），考虑使用函数缓存实现</li>\n</ol>\n<h3 id="核心代码-9"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32516847763356393000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { memoize } from \'lodash\';\n\ntype loadScriptOptions = Partial<Omit<HTMLScriptElement, \'src\' | \'async\'>> & {\n   attributesMap?: {\n      [key: string]: any;\n   };\n   [key: string]: any;\n};\n\n// 异步加载单个脚本\nasync function loadSingleScript(src: string, options: loadScriptOptions = {}) {\n   return await new Promise((resolve, reject) => {\n      // 这里未考虑到同一 src 同时发起的情况，改用缓存实现\n      // if (!id) {\n      //   const NAMESPACE = \'c2b16a16-12b3-423a-879f-6b46d1a01d60\'\n      //   const PREFIX = \'script-id-\'\n      //   id = PREFIX + uuidv5(src, NAMESPACE)\n      // }\n      // if (!src || document.querySelector(\\`#\\${id}\\`)) {\n      //   return\n      // }\n      const script: any = document.createElement(\'script\');\n      const { attributesMap = {}, ...rest } = options;\n      Object.keys(rest).forEach((key) => {\n         script[key] = rest[key];\n      });\n      Object.keys(attributesMap).forEach((key) => {\n         script.setAttribute(key, attributesMap[key]);\n      });\n      script.async = true;\n      script.src = src;\n      script.onload = resolve;\n      script.onerror = reject;\n      document.getElementsByTagName(\'head\')[0].appendChild(script);\n   });\n}\n\n// 异步加载多个脚本\n// memoize 默认情况下用第一个参数作为缓存的 key，即 src\nexport const loadScript = memoize(loadSingleScript);`, `32516847763356393000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> memoize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'lodash\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> loadScriptOptions <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>Omit<span class="token operator">&lt;</span>HTMLScriptElement<span class="token punctuation">,</span> <span class="token string">\'src\'</span> <span class="token operator">|</span> <span class="token string">\'async\'</span><span class="token operator">>></span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span>\n   attributesMap<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token punctuation">[</span>key<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token punctuation">[</span>key<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 异步加载单个脚本</span>\n<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadSingleScript</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> options<span class="token punctuation">:</span> loadScriptOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 这里未考虑到同一 src 同时发起的情况，改用缓存实现</span>\n      <span class="token comment">// if (!id) {</span>\n      <span class="token comment">//   const NAMESPACE = \'c2b16a16-12b3-423a-879f-6b46d1a01d60\'</span>\n      <span class="token comment">//   const PREFIX = \'script-id-\'</span>\n      <span class="token comment">//   id = PREFIX + uuidv5(src, NAMESPACE)</span>\n      <span class="token comment">// }</span>\n      <span class="token comment">// if (!src || document.querySelector(`#${id}`)) {</span>\n      <span class="token comment">//   return</span>\n      <span class="token comment">// }</span>\n      <span class="token keyword">const</span> script<span class="token punctuation">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'script\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> attributesMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>\n      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         script<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> rest<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>attributesMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> attributesMap<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      script<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>\n      script<span class="token punctuation">.</span>onload <span class="token operator">=</span> resolve<span class="token punctuation">;</span>\n      script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span>\n      document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">\'head\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 异步加载多个脚本</span>\n<span class="token comment">// memoize 默认情况下用第一个参数作为缓存的 key，即 src</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> loadScript <span class="token operator">=</span> <span class="token function">memoize</span><span class="token punctuation">(</span>loadSingleScript<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="视频播放进度控制失效"><a href="#%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E8%BF%9B%E5%BA%A6%E6%8E%A7%E5%88%B6%E5%A4%B1%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视频播放进度控制失效</h2>\n<p>对于长视频，<code class="language-text">domRef.current.currentTime = 0</code> 方法失效，需要对服务器配置，具体见<a href="https://stackoverflow.com/questions/4360060/video-streaming-with-html-5-via-node-js#18241169" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<h2 id="usescrolldirection-封装"><a href="#usescrolldirection-%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useScrollDirection 封装</h2>\n<h3 id="需求背景-12"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>需要知道页面的向上、向下滚动来实现特定需求</p>\n<h3 id="实现要点"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h3>\n<p>使用 ahooks 的 useScroll、usePrevious、useThrottle，来分别实现得到当前滚动信息、得到前一个滚动信息、性能优化的节流处理的功能</p>\n<h3 id="核心代码-10"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<p>web/hooks/useScrollDirection.ts</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39390949414687510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { useScroll, usePrevious, useThrottle } from \'ahooks\'\nimport type { Target, ScrollListenController } from \'ahooks/lib/useScroll\'\nimport type { ThrottleOptions } from \'ahooks/lib/useThrottle/throttleOptions\'\n\ninterface UseScrollDirectionResult {\n  leftDelta: number\n  topDelta: number\n  scrollXDirection?: \'left\' | \'right\'\n  scrollYDirection?: \'up\' | \'down\'\n  left: number\n  top: number\n}\n\nconst useScrollDirection = (target: Target, shouldUpdate?: ScrollListenController, options: ThrottleOptions & { enable: boolean } = {\n  enable: false,\n  wait: 300,\n  leading: true,\n  trailing: true\n}): UseScrollDirectionResult => {\n  const position = useScroll(target, shouldUpdate)\n  const prevPosition = usePrevious(position)\n\n  const throttledPosition = useThrottle(position, options)\n  const throttledPrevPosition = useThrottle(prevPosition, options)\n\n  const newPosition = options.enable ? throttledPosition : position\n  const newPrevPosition = options.enable ? throttledPrevPosition : prevPosition\n\n  if (!newPosition || !newPrevPosition) {\n    return {\n      leftDelta: 0,\n      topDelta: 0,\n      left: 0,\n      top: 0\n    }\n  }\n\n  const leftDelta = newPosition.left - newPrevPosition.left\n  const topDelta = newPosition.top - newPrevPosition.top\n\n  const scrollXDirection = leftDelta > 0 ? \'right\' : \'left\'\n  const scrollYDirection = topDelta > 0 ? \'down\' : \'up\'\n\n  // console.log(\'throttledPosition\', newPosition, newPrevPosition)\n\n  return {\n    leftDelta,\n    topDelta,\n    scrollXDirection,\n    scrollYDirection,\n    left: newPosition.left,\n    top: newPosition.top\n  }\n}\n\nexport default useScrollDirection`, `39390949414687510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> useScroll<span class="token punctuation">,</span> usePrevious<span class="token punctuation">,</span> useThrottle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks\'</span>\n<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Target<span class="token punctuation">,</span> ScrollListenController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks/lib/useScroll\'</span>\n<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ThrottleOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'ahooks/lib/useThrottle/throttleOptions\'</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">UseScrollDirectionResult</span> <span class="token punctuation">{</span>\n  leftDelta<span class="token punctuation">:</span> <span class="token builtin">number</span>\n  topDelta<span class="token punctuation">:</span> <span class="token builtin">number</span>\n  scrollXDirection<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">\'left\'</span> <span class="token operator">|</span> <span class="token string">\'right\'</span>\n  scrollYDirection<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">\'up\'</span> <span class="token operator">|</span> <span class="token string">\'down\'</span>\n  left<span class="token punctuation">:</span> <span class="token builtin">number</span>\n  top<span class="token punctuation">:</span> <span class="token builtin">number</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> useScrollDirection <span class="token operator">=</span> <span class="token punctuation">(</span>target<span class="token punctuation">:</span> Target<span class="token punctuation">,</span> shouldUpdate<span class="token operator">?</span><span class="token punctuation">:</span> ScrollListenController<span class="token punctuation">,</span> options<span class="token punctuation">:</span> ThrottleOptions <span class="token operator">&amp;</span> <span class="token punctuation">{</span> enable<span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  enable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n  wait<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>\n  leading<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  trailing<span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">UseScrollDirectionResult</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> position <span class="token operator">=</span> <span class="token function">useScroll</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> shouldUpdate<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> prevPosition <span class="token operator">=</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> throttledPosition <span class="token operator">=</span> <span class="token function">useThrottle</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> options<span class="token punctuation">)</span>\n  <span class="token keyword">const</span> throttledPrevPosition <span class="token operator">=</span> <span class="token function">useThrottle</span><span class="token punctuation">(</span>prevPosition<span class="token punctuation">,</span> options<span class="token punctuation">)</span>\n\n  <span class="token keyword">const</span> newPosition <span class="token operator">=</span> options<span class="token punctuation">.</span>enable <span class="token operator">?</span> throttledPosition <span class="token punctuation">:</span> position\n  <span class="token keyword">const</span> newPrevPosition <span class="token operator">=</span> options<span class="token punctuation">.</span>enable <span class="token operator">?</span> throttledPrevPosition <span class="token punctuation">:</span> prevPosition\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>newPosition <span class="token operator">||</span> <span class="token operator">!</span>newPrevPosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      leftDelta<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      topDelta<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      left<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      top<span class="token punctuation">:</span> <span class="token number">0</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> leftDelta <span class="token operator">=</span> newPosition<span class="token punctuation">.</span>left <span class="token operator">-</span> newPrevPosition<span class="token punctuation">.</span>left\n  <span class="token keyword">const</span> topDelta <span class="token operator">=</span> newPosition<span class="token punctuation">.</span>top <span class="token operator">-</span> newPrevPosition<span class="token punctuation">.</span>top\n\n  <span class="token keyword">const</span> scrollXDirection <span class="token operator">=</span> leftDelta <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">\'right\'</span> <span class="token punctuation">:</span> <span class="token string">\'left\'</span>\n  <span class="token keyword">const</span> scrollYDirection <span class="token operator">=</span> topDelta <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">\'down\'</span> <span class="token punctuation">:</span> <span class="token string">\'up\'</span>\n\n  <span class="token comment">// console.log(\'throttledPosition\', newPosition, newPrevPosition)</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    leftDelta<span class="token punctuation">,</span>\n    topDelta<span class="token punctuation">,</span>\n    scrollXDirection<span class="token punctuation">,</span>\n    scrollYDirection<span class="token punctuation">,</span>\n    left<span class="token punctuation">:</span> newPosition<span class="token punctuation">.</span>left<span class="token punctuation">,</span>\n    top<span class="token punctuation">:</span> newPosition<span class="token punctuation">.</span>top\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> useScrollDirection</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-8"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<!-- <iframe data-src="https://codesandbox.io/embed/sb4gnr?codemirror=1&hidenavigation=1&theme=light&view=preview" class="embedded-codesandbox" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe> --><html><head></head><body></body></html>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/shsntv?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="set-cookie-失效"><a href="#set-cookie-%E5%A4%B1%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>set-cookie 失效</h2>\n<p>UC 浏览器下服务器端设置 set-cookie 失效即 csrf token 设置失败，进而接口请求失败，原因未知</p>\n<p>// TODO set-cookie 失效待解决</p>\n<h2 id="子级滚动、父级不滚动"><a href="#%E5%AD%90%E7%BA%A7%E6%BB%9A%E5%8A%A8%E3%80%81%E7%88%B6%E7%BA%A7%E4%B8%8D%E6%BB%9A%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>子级滚动、父级不滚动</h2>\n<h3 id="需求背景-13"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>打开弹窗时此时有半透明遮罩，弹窗内是有滚动条的，此时弹窗的滚动条的滚动会牵连外面滚动条的滚动</p>\n<h3 id="解决过程"><a href="#%E8%A7%A3%E5%86%B3%E8%BF%87%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决过程</h3>\n<ol>\n<li>css：<code class="language-text">overscroll-behavior: contain</code>，但是在移动端 safari 不支持</li>\n<li>js：在不支持 css 的方法时，降级处理</li>\n</ol>\n<h3 id="核心代码-11"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22766568186429125000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export function enableBodyScroll() {\n   if (document.readyState === \'complete\') {\n      document.body.style.position = \'\';\n      document.body.style.overflowY = \'\';\n\n      if (document.body.style.marginTop) {\n         const scrollTop = -parseInt(document.body.style.marginTop, 10);\n         document.body.style.marginTop = \'\';\n         window.scrollTo({\n            left: window.pageXOffset,\n            top: scrollTop,\n            behavior: \'instant\' // 关闭动画\n         });\n      }\n   } else {\n      window.addEventListener(\'load\', enableBodyScroll);\n   }\n}\n\nexport function disableBodyScroll({ savePosition = false } = {}) {\n   if (document.readyState === \'complete\') {\n      if (document.body.scrollHeight > window.innerHeight) {\n         if (savePosition) document.body.style.marginTop = \\`-\\${window.pageYOffset}px\\`;\n         document.body.style.position = \'fixed\';\n         document.body.style.overflowY = \'scroll\';\n      }\n   } else {\n      window.addEventListener(\'load\', () => disableBodyScroll({ savePosition }));\n   }\n}`, `22766568186429125000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">enableBodyScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">\'complete\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflowY <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> scrollTop <span class="token operator">=</span> <span class="token operator">-</span><span class="token function">parseInt</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n         window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            left<span class="token punctuation">:</span> window<span class="token punctuation">.</span>pageXOffset<span class="token punctuation">,</span>\n            top<span class="token punctuation">:</span> scrollTop<span class="token punctuation">,</span>\n            behavior<span class="token punctuation">:</span> <span class="token string">\'instant\'</span> <span class="token comment">// 关闭动画</span>\n         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'load\'</span><span class="token punctuation">,</span> enableBodyScroll<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">disableBodyScroll</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> savePosition <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">\'complete\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollHeight <span class="token operator">></span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>savePosition<span class="token punctuation">)</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token punctuation">.</span>pageYOffset<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n         document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">\'fixed\'</span><span class="token punctuation">;</span>\n         document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflowY <span class="token operator">=</span> <span class="token string">\'scroll\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'load\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">disableBodyScroll</span><span class="token punctuation">(</span><span class="token punctuation">{</span> savePosition <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="进度转换函数"><a href="#%E8%BF%9B%E5%BA%A6%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>进度转换函数</h2>\n<h3 id="需求背景-14"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<ol>\n<li>页面固定动效多次用到百分比转换，需要封装函数便于使用、理解</li>\n<li>后期可能会实现缓动函数，需要提前封装便于修改</li>\n</ol>\n<h3 id="核心代码-12"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97582921794470610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface GetAnimateProgressProps {\n   progress: number;\n   start: number;\n   duration: number;\n}\n\n// 获取单个进度\nexport const getAnimateProgress = ({ progress, start, duration }: GetAnimateProgressProps) =>\n   (progress - start) / duration;\n\ntype GetAnimateProgressesOptions = Omit<GetAnimateProgressProps, \'progress\'>;\n\n// 获取多个进度\nexport const getAnimateProgresses = (progress: number, options: GetAnimateProgressesOptions[]) =>\n   options.map(({ start, duration }) =>\n      getAnimateProgress({\n         progress,\n         start,\n         duration\n      })\n   );`, `97582921794470610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">GetAnimateProgressProps</span> <span class="token punctuation">{</span>\n   progress<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   start<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   duration<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 获取单个进度</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getAnimateProgress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> progress<span class="token punctuation">,</span> start<span class="token punctuation">,</span> duration <span class="token punctuation">}</span><span class="token punctuation">:</span> GetAnimateProgressProps</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token punctuation">(</span>progress <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> duration<span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> GetAnimateProgressesOptions <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>GetAnimateProgressProps<span class="token punctuation">,</span> <span class="token string">\'progress\'</span><span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获取多个进度</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getAnimateProgresses</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">progress<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> options<span class="token punctuation">:</span> GetAnimateProgressesOptions<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   options<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> start<span class="token punctuation">,</span> duration <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span>\n      <span class="token function">getAnimateProgress</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n         progress<span class="token punctuation">,</span>\n         start<span class="token punctuation">,</span>\n         duration\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="cdn-链接替换"><a href="#cdn-%E9%93%BE%E6%8E%A5%E6%9B%BF%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>cdn 链接替换</h2>\n<h3 id="需求背景-15"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>public 下的所有文件都需要放到 cdn，减少服务器的压力同时访问速度更快，即要对所有前缀为 /public 的资源路径做替换</p>\n<h3 id="选型过程-7"><a href="#%E9%80%89%E5%9E%8B%E8%BF%87%E7%A8%8B-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>选型过程</h3>\n<ol>\n<li>动态变量：在 midway 后端设置可读变量然后注入到前端 window 变量中，但是不能解决 midway、css 的前缀问题</li>\n<li>静态替换：在 build 阶段对所有的 /public 替换，但是目前运维不支持，运维只在 dev 环境中才能 build，需要运维解决</li>\n<li>静态资源 hash 处理：需要由 webpack 接管去处理</li>\n</ol>\n<h3 id="核心代码-13"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<p>以下是 <code class="language-text">静态替换</code> 的核心代码，见标红部分的核心代码</p>\n<p>scripts/build.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78476785381596870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shelljs = require(\'shelljs\');\nconst fsExtra = require(\'fs-extra\');\nconst path = require(\'path\');\nconst fs = require(\'fs\');\nconst packageJson = require(\'../package.json\');\nconst glob = require(\'glob\');\nconst { merge } = require(\'lodash\');\n\nlet config = require(\'../dist/config/config.default\');\nconst ENV = process.env.EGG_SERVER_ENV || \'prod\';\nconst fakeConfigParams = {\n   name: \'\',\n   appDir: \'\'\n};\nconst configPath = \\`../dist/config/config.\\${ENV}.js\\`;\n// console.log(\'ENV\', ENV)\nif (fs.existsSync(path.resolve(__dirname, configPath))) {\n   config = merge(config.default(fakeConfigParams), require(configPath).default(fakeConfigParams));\n}\n\nconsole.log(\'Start handle source...\');\n\nfsExtra.mkdirpSync(path.resolve(__dirname, \'../deploy\'), { overwrite: true });\nfsExtra.copySync(path.resolve(__dirname, \'../public\'), path.resolve(__dirname, \'../deploy/public\'), {\n   overwrite: true\n});\n\ndelete packageJson.devDependencies;\ndelete packageJson.scripts.preinstall;\n\nfs.writeFileSync(path.resolve(__dirname, \'../deploy/package.json\'), JSON.stringify(packageJson));\n\n// 暂时不需要处理异步加载的资源\n// const assetManifest = require(\'../build/client/asset-manifest.json\')\n// const runtimePagePath = path.resolve(\n//   __dirname,\n//   \'../build\' + assetManifest[\'runtime~Page.js\'].replace(\'/public\', \'\')\n// )\n\n// const runtimePage = fs.readFileSync(runtimePagePath).toString()\n\n// // 替换 webpack 打包的资源路径前缀\n// fs.writeFileSync(\n//   runtimePagePath,\n//   runtimePage.replace(/&quot;\\/public\\//g, \'window.__publicPath+&quot;/public/\')\n// )\n\nconst assetManifest = require(\'../build/client/asset-manifest.json\');\nconst runtimePagePath = assetManifest[\'runtime~Page.js\'].replace(\'/public\', \'build\');\n// console.log(\'runtimePagePath\', runtimePagePath)\n\nconst replacePrefixFiles = [\n   ...glob.sync(\'build/{client,server}/**/*.{js,css}\'),\n   ...glob.sync(\'dist/config/{menu,site}/**/*.js\')\n].filter((item) => item !== runtimePagePath);\nconst newPublicPath = config.publicPath || \'\';\nconst publicPath = newPublicPath.endsWith(\'/\') ? newPublicPath + \'public/\' : newPublicPath + \'/public/\';\n// console.log(\'publicPath\', publicPath)\nreplacePrefixFiles.forEach(function(file) {\n   const fileContent = fs.readFileSync(file).toString();\n   if (config.publicPath) {\n      fs.writeFileSync(file, fileContent.replace(/\\/public\\//g, publicPath));\n   }\n});\n\nfsExtra.moveSync(path.resolve(__dirname, \'../build\'), path.resolve(__dirname, \'../deploy/build\'), { overwrite: true });\n\nif (fs.existsSync(path.resolve(__dirname, \'../dist\'))) {\n   fsExtra.moveSync(path.resolve(__dirname, \'../dist\'), path.resolve(__dirname, \'../deploy/dist\'), { overwrite: true });\n}\n\nfsExtra.moveSync(path.resolve(__dirname, \'../deploy\'), path.resolve(__dirname, \'../dist\'), { overwrite: true });\n\nglob.sync(path.resolve(__dirname, \'../dist/**/*.map\')).forEach(function(file) {\n   fs.unlinkSync(file);\n});\n\nfsExtra.mkdirpSync(path.resolve(__dirname, \'../dist/node_modules\'), {\n   overwrite: true\n});\n\nshelljs.exec(\'cp -r node_modules/xp-react-scrollmagic dist/node_modules/xp-react-scrollmagic\');`, `78476785381596870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts{48-64}"\n              >\n                <span class="gatsby-code-button-language">ts{48-64}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> shelljs <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fsExtra <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'fs-extra\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> packageJson <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'../package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'glob\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> merge <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'../dist/config/config.default\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token constant">ENV</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">EGG_SERVER_ENV</span> <span class="token operator">||</span> <span class="token string">\'prod\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fakeConfigParams <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n   appDir<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> configPath <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../dist/config/config.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">ENV</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token comment">// console.log(\'ENV\', ENV)</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> configPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   config <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span>fakeConfigParams<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">require</span><span class="token punctuation">(</span>configPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span>fakeConfigParams<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Start handle source...\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nfsExtra<span class="token punctuation">.</span><span class="token function">mkdirpSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../deploy\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nfsExtra<span class="token punctuation">.</span><span class="token function">copySync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../public\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../deploy/public\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n   overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">delete</span> packageJson<span class="token punctuation">.</span>devDependencies<span class="token punctuation">;</span>\n<span class="token keyword">delete</span> packageJson<span class="token punctuation">.</span>scripts<span class="token punctuation">.</span>preinstall<span class="token punctuation">;</span>\n\nfs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../deploy/package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>packageJson<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 暂时不需要处理异步加载的资源</span>\n<span class="token comment">// const assetManifest = require(\'../build/client/asset-manifest.json\')</span>\n<span class="token comment">// const runtimePagePath = path.resolve(</span>\n<span class="token comment">//   __dirname,</span>\n<span class="token comment">//   \'../build\' + assetManifest[\'runtime~Page.js\'].replace(\'/public\', \'\')</span>\n<span class="token comment">// )</span>\n\n<span class="token comment">// const runtimePage = fs.readFileSync(runtimePagePath).toString()</span>\n\n<span class="token comment">// // 替换 webpack 打包的资源路径前缀</span>\n<span class="token comment">// fs.writeFileSync(</span>\n<span class="token comment">//   runtimePagePath,</span>\n<span class="token comment">//   runtimePage.replace(/"\\/public\\//g, \'window.__publicPath+"/public/\')</span>\n<span class="token comment">// )</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> assetManifest <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'../build/client/asset-manifest.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> runtimePagePath <span class="token operator">=</span> assetManifest<span class="token punctuation">[</span><span class="token string">\'runtime~Page.js\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'/public\'</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// console.log(\'runtimePagePath\', runtimePagePath)</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> replacePrefixFiles <span class="token operator">=</span> <span class="token punctuation">[</span></span><span class="gatsby-highlight-code-line">   <span class="token operator">...</span>glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token string">\'build/{client,server}/**/*.{js,css}\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">   <span class="token operator">...</span>glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token string">\'dist/config/{menu,site}/**/*.js\'</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">!==</span> runtimePagePath<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> newPublicPath <span class="token operator">=</span> config<span class="token punctuation">.</span>publicPath <span class="token operator">||</span> <span class="token string">\'\'</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">const</span> publicPath <span class="token operator">=</span> newPublicPath<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">\'/\'</span><span class="token punctuation">)</span> <span class="token operator">?</span> newPublicPath <span class="token operator">+</span> <span class="token string">\'public/\'</span> <span class="token punctuation">:</span> newPublicPath <span class="token operator">+</span> <span class="token string">\'/public/\'</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// console.log(\'publicPath\', publicPath)</span></span><span class="gatsby-highlight-code-line">replacePrefixFiles<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">   <span class="token keyword">const</span> fileContent <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>publicPath<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fileContent<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\/public\\//g</span><span class="token punctuation">,</span> publicPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\nfsExtra<span class="token punctuation">.</span><span class="token function">moveSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../build\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../deploy/build\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../dist\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   fsExtra<span class="token punctuation">.</span><span class="token function">moveSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../dist\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../deploy/dist\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nfsExtra<span class="token punctuation">.</span><span class="token function">moveSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../deploy\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../dist\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nglob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../dist/**/*.map\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nfsExtra<span class="token punctuation">.</span><span class="token function">mkdirpSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../dist/node_modules\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n   overwrite<span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nshelljs<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">\'cp -r node_modules/xp-react-scrollmagic dist/node_modules/xp-react-scrollmagic\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="dangerouslysetinnerhtml-编译更新失效"><a href="#dangerouslysetinnerhtml-%E7%BC%96%E8%AF%91%E6%9B%B4%E6%96%B0%E5%A4%B1%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dangerouslySetInnerHTML 编译更新失效</h2>\n<h3 id="需求背景-16"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h3>\n<p>使用了 dangerouslySetInnerHTML 渲染的富文本组件，在编译之后不生效</p>\n<h3 id="核心代码-14"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h3>\n<p>web/components/htmlComponent/index.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60948252769545870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { ReactNode } from \'react\';\n\ninterface HtmlComponentProps {\n   children: ReactNode;\n   className?: string;\n}\n\nconst HtmlComponent = ({ children, className }: HtmlComponentProps) =>\n   typeof children === \'string\' ? (\n      // key={Math.random()} 必须设置，否则 props 不会更新，导致热更新失败\n      <div className={className} key={Math.random()} dangerouslySetInnerHTML={{ __html: children }} />\n   ) : (\n      <div className={className}>{children}</div>\n   );\n\nexport default HtmlComponent;`, `60948252769545870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> ReactNode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">HtmlComponentProps</span> <span class="token punctuation">{</span>\n   children<span class="token punctuation">:</span> ReactNode<span class="token punctuation">;</span>\n   className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">HtmlComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> className <span class="token punctuation">}</span><span class="token punctuation">:</span> HtmlComponentProps</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token keyword">typeof</span> children <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">?</span> <span class="token punctuation">(</span>\n      <span class="token comment">// key={Math.random()} 必须设置，否则 props 不会更新，导致热更新失败</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">dangerouslySetInnerHTML</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> __html<span class="token punctuation">:</span> children <span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n   <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>className<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> HtmlComponent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/国际官网技术难点攻关/index.md absPath of file >>> MarkdownRemark",timeToRead:56,frontmatter:{date:"2022-12-16 17:26:58",path:"/international-official-website-technical-difficulties/",tags:"前端, 国际官网, 预研",title:"国际官网技术难点攻关",draft:null}}],page:5,pagesSum:48,length:238,prevPath:"/page/4",nextPath:"/page/6"}}}});