webpackJsonp([0xb2078d670e21],{1358:function(n,s){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"设计原则 引言 对比（Contrast） 对比的基本思想是，要避免页面上的元素太过相似。如果元素（字体、颜色、大小、线宽、形状、空间等）不相同，那就干脆让它们截然不同。要让页面引人注目，对比通常是最重要的一个因素，正是它能使读者首先看这个页面。 重复（Repetition） 让设计中的视觉要素在整个作品中重复出现。可以重复颜色、形状、材质、空间关系、线宽、字体、大小和图片，等等。这样一来，既能增加条理性，还可以加强统一性。 对齐（Alignment…",html:'<h1 id="设计原则"><a href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设计原则</h1>\n<h2 id="引言"><a href="#%E5%BC%95%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引言</h2>\n<h3 id="对比（contrast）"><a href="#%E5%AF%B9%E6%AF%94%EF%BC%88contrast%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对比（Contrast）</h3>\n<p>对比的基本思想是，要避免页面上的元素太过相似。如果元素（字体、颜色、大小、线宽、形状、空间等）不相同，那就干脆让它们截然不同。要让页面引人注目，对比通常是最重要的一个因素，正是它能使读者首先看这个页面。</p>\n<h3 id="重复（repetition）"><a href="#%E9%87%8D%E5%A4%8D%EF%BC%88repetition%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重复（Repetition）</h3>\n<p>让设计中的视觉要素在整个作品中重复出现。可以重复颜色、形状、材质、空间关系、线宽、字体、大小和图片，等等。这样一来，既能增加条理性，还可以加强统一性。</p>\n<h3 id="对齐（alignment）"><a href="#%E5%AF%B9%E9%BD%90%EF%BC%88alignment%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对齐（Alignment）</h3>\n<p>任何东西都不能在页面上随意安放。每个元素都应当与页面上的另一个元素有某种视觉联系。这样能建立一种清晰、精巧而且清爽的外观。</p>\n<h3 id="亲密性（proximity）"><a href="#%E4%BA%B2%E5%AF%86%E6%80%A7%EF%BC%88proximity%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>亲密性（Proximity）</h3>\n<p>彼此相关的项应当靠近，归组在一起。如果多个项相互之间存在很近的亲密性，它们就会成为一个视觉单元，而不是多个孤立的元素。这有助于组织信息，减少混乱，为读者提供清晰的结构。</p>\n<h2 id="亲密性"><a href="#%E4%BA%B2%E5%AF%86%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>亲密性</h2>\n<h3 id="案例一"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例一</h3>\n<p>来看看下面这个企业名片的布局，这是一种很典型的布局。在这样小的空间里你看到多少个单独的元素？你的眼睛要停下来多少次才能看全这张名片上的所有信息？</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-1d472.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 732px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.09836065573771%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABV0lEQVQoz4VS2U7CQBTtZ6sx8UEhEaNGY0IQsWwvQjfp3jLQmXZmWqQWqB/kTNuwRWJycma7587dBEuRLE12zU9b1wxFcnQtTAKaReQ73CFFtqE5BVxrMp85pYGAyAwRgOgsjOeMYQTwEh4ody4K7N0IdBVxME9ZyLj6M0WHOJZV4nKhKxyvSZKTeEPiFU42JPmhfL/GSU75Mad0jeOckL2MBJwi9mCqktob+J4piz3P1V1TM+SxMhjKYnfUevOn1ke7o4hdYzyKFsFWX4ktVWqeX/cbT/3Gs9LrD+9fWhe1Tu1u3H5vXdbF+kPz7Ob16lasP0I8ZWkehI2XVWK4ZHbMisz5KzpVwkrMTUvOji2KWkb/ibPw7w5tvZR9KVrDCsxYwF+QY8lj49GeULLSQAwY2FywiQigBwkQPEc32YRZE9tQfc84+XOKpr7BJ8yeAOCwiQSB+wtjPfB73vAlNAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 48 37" title="" data-src="/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-1d472.png" data-srcset="/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-e9d85.png 200w,\n/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-b1edf.png 400w,\n/static/2022-05-24-23-48-37-088806b0a6435c21d93f0097bb2a33e0-1d472.png 732w" data-sizes="(max-width: 732px) 100vw, 732px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>名片上的每一项看上去都与其他任何项没有关联。这样一来，首先不清楚从哪里开始读名片，另外不知道何时才算结束。如果对这张企业名片做一点调整——把相关的元素分在一组，使它们建立更近的亲密性，看看会发生什么。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-f67c7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 729px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.418381344307264%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSElEQVQoz5WQ+U7CQBDGeWIfQBJjjELUkPCPUUKsB8jdc2m3pRftdrdbsFyG8DpOATEqJJh8mczszi8z8+XYhIBoGobM4wsGeZT4fE4h5wsaxl5AXZaS5CMm3I9GAXxtEFBulwnFklAovdyWhauSoYjV8+vHi5tuVaicFcsn+c5D9f70spIvvJXv+JzBsG84nka6Isq1mtZq6GLXxkh6ramNhm0grEi9p2fUbautJjT0xU48o78nw2KjJR+vRn5gKfU6VmUATCSjdguwIbHHqyRZcmjbszZLQ7pWNA5C5mbXMpckQ5L4Q+JASdfWbBb+A+80jeCKbcxKEs++8p/aB0+23Zlm9BB5EPY807H6A6w5tgHRdc3j4DQb6zoG1iSM5IGJDFm0DA0ej4XBHl3qgdUW1kxdDaj3j5vpexhEduY5GM59KPe2fQISde/Jf7k9YAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 51 24" title="" data-src="/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-f67c7.png" data-srcset="/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-c5342.png 200w,\n/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-4721d.png 400w,\n/static/2022-05-24-23-51-24-0a27f71eb5d3752ae73c96b0d1ee98cb-f67c7.png 729w" data-sizes="(max-width: 729px) 100vw, 729px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>如果多个项相互之间有很近的亲密性，它们就会成为一个视觉单元，而不是多个孤立的元素。就像实际生活中一样，亲密性（即紧密性）意味着存在关联。</p>\n<p>如果把类似的元素组织为一个单元，马上会带来很多变化。首先，页面会变得更有条理。其次，你会清楚地知道从哪里开始读信息，而且明白什么时候结束。另外，“空白”（字母以外的空间）也会变得更有组织。</p>\n<h3 id="案例二"><a href="#%E6%A1%88%E4%BE%8B%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例二</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-99df0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.815738963531672%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAqklEQVQY002PgQqDMAxE+//fp1XpRFGLgpVW3Jyi0z3MBh40XK5JLlHjOC7L8r6B1Dlnre26rmmauq77vr/XzPNMDCEo1PM8PzeQeu9pmKaJKW3bUic1x3FIJKVfybAoitI0TZIkjmOtNbyqKvRt2/I8z7KML/1HURTsi7/iYU7F44IxRuIwDPu+81WWpfRLpJNz1nX9ObPD68LzAgpcdDaEs7/oEDkT4PoF9LoXtf0N0lYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 53 59" title="" data-src="/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-fee1c.png" data-srcset="/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-a67b7.png 200w,\n/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-0b187.png 400w,\n/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-fee1c.png 800w,\n/static/2022-05-24-23-53-59-11d99b820fa3440cdc475419a5a2dc26-99df0.png 1042w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>请注意这两栏中的项目符号，看看它们和相关联的项目间的距离。中间的项目符号事实上离有些左栏的项目更近。看起来几乎就像是 4 个单独的列一样，其中有两列是项目符号。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-429c6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 25.865384615384617%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAsklEQVQY002PiQqDMBBE/f+vE4n1QpQiKijibb2SPrNQOpDJZHdn2DjDMHz+sG3bvu9t2xZFUZbl24Inxd/Muq6MYXS4jDHXdWmt7/vWFjT6vh/Hseu6uq6naZKuwFgQ4RBJtuu6YRgqpTzP830fjY0JotEviyAIlEWe5/M803rMVVVFUZSmaZIkCDjLMtmIeKnEcQwTgbNpmvM8HzMHtSwLQphfESzrwWjq8k/EcRy/tb/chBegA4NRcwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 54 55" title="" data-src="/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-fee1c.png" data-srcset="/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-a67b7.png 200w,\n/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-0b187.png 400w,\n/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-fee1c.png 800w,\n/static/2022-05-24-23-54-55-9f6900cc1034949ca101420c27beb3e2-429c6.png 1040w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>现在关系就清晰了，我们可以立刻分辨出哪些项目符号属于哪些项目，也可以马上看出有两列项目清单，而不是一列项目符号，一些信息，一列项目符号，再来更多的信息。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-032bb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 598px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 83.4448160535117%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC6UlEQVQ4y0VTyY4URxCdv/R/+OKLxcFcOcDB0pxsGUvIlgAhAZItGMkCBjEzPd3VPd21V3XXvnfte1Umr6oHLIVSkRkZ8eK9yDyjQ0aHfFpJRWlLKdZyMgIrKK3pWH0L1fehsZhSKDkjXTg2IaUJf8VePPscaFpsm7FjZb5Txa54zamMdLiT3/15ubxgEEocq0o92h8JGc7GNhrqiNL87sP29wdvX5//99ejf3798eWLJxfPH7/745c3129XKiP/9vObvx/9+/CHp+c/vXr/7JLSYhz6MzIcCcp0x6E5tkXUllFTBHngdmVUp0GTByg9tkds88hbvd9UiT8jxxTIZeg3aUjHuMrtwJXK1Kpyp8zsKrPbyquLyc8Ts0jNOnfaxsUJHWKATcnKjWYLFqVpmdrM8lJTd64lCeyNqbOWzsME9pbb3ugHVhHXPJz9DkxJNyMbO9PfuxAsjQxL5xAzNV7iV8zikyIxpsbJAoMtzrG1NG6CnZJnZNJFJ85d5fd1gLWrg74Jm8KFPzThyXA4QNo2pCTD5ftkRzI9xaEkyWNzt7nybBm2l9e2wYOqY4kA92zRtcSDcqfKGxABxr1gykpTlwaS69zdyxvbEHAPPBWRMTQWmYq05rmFY4qaupWFla5u23JSe5qzyZqR4dIRnHXb4IyJM3eQN5vVZ0DZOo+KxmEHzgdl49kSXgTp4++c7+fcz6zIkMyBbOLWHyeEIaFjSk4OySBHVwXk1La+NfStiVF5lrS6/YgmI38PHNCGz+1u0MLRP2zXX5jbT+hc4BYITaWRrK504YuG5NBT0WHoqiK3FLglOvRn8TAqTNh3FMcQeXahyuvx+6gy3y+jgA5JEuoSv/QnqTeacgfmtimghGMKpsYCExKq0hoY/4+KjuAZYfR5bHC7a9cSAlfmttfIiXx11p8PPcUyOIFd4KlSijmHeB2zYH1KOmiTTzYWZICTDW2KTzt20Ck7ncx/Ph/7bD6cLlMyfgXTupvmGbIadQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 57 22" title="" data-src="/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-032bb.png" data-srcset="/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-ec00a.png 200w,\n/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-80fd8.png 400w,\n/static/2022-05-24-23-57-22-93329bfce2352c6c179d6cf84b7f9f15-032bb.png 598w" data-sizes="(max-width: 598px) 100vw, 598px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>数字看起来就像是一个单独的单元，与文字无关。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-87f29.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 82.3920265780731%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACtklEQVQoz01TSW/TYBDt/+VXcOTAgTMIJJCgEkjlQCm0qAKablmcuIn3LbbjfUliO4n3j+c2UKRRNN9k3sx7M+MD0uxInZI6a6u02KzqPCEkf7Q2b8qkytflZl1kqxbJpOjigDT5QVslbRE2RUTI6tPzHyevfw9OKOpsfPtlxN2yg+/U8ctfjqy9fXr87c3F+fur4el42pu2ZYh+AKdtGdU5wMnolL48GtwcU2fvel9fXfSOBueH15efh1ns/Ty84W74F08+fnh2gmCXvwcXUVstUaKpYpQgJP1r2f63WXdGsizy6hJO1699AJMmdmU79QPfEe/G16tQN7SZYwqhp0aeaukcnpbBw+wFr6uzPPNIFbdVdoB5ELKU+ror2cnaUEXat2VDZUR+pIhj15bMOcPO+pp8Z2qsLEx8V6l2YVveg7vOdZz4/ib2l+E88jV0CD3NUGeaTEe+apuCZ8uuJVoG5ztyW68INBb3mjH0Jo92q6DeRpvESpeLahfsUmebOigPH1Zs/CoPt4mNeJ65WM1eM8AYnTo2Fowd+gpNXYaews36ikg7C2GhcxCiiBO0lXiKZwbTyXUczEm96mh3nYsQmm3B8hwJ2WA7V2Y0dTUZ9WyTB5JnhiJPwcEUMK3HztCMR7WNmiK+Z+jtMrfcBkiCU2y9fOPVeYi/EKnzgLRr0iaPtAEO5u7S9hYmC6pglcRm7GueLfmYtsYiglGZczZ0lcBV5sr0cWAoLA8NuW/o2p0mT02dEzgK+wQMKqBTlWhdY2RxAvIcM3AtYb9ngLE3V7Fj013orGUK0MkxffiGxqCnbQhohfOYqzOJHysSXe7CPfjhtnFk+DAck2emt2ArC0ia4LxMbQa2KIdaPDuwDBaauwsp/t12GTcFbnsJClgpppUurV3q4vkwvP+tQ5ZIjkm9+QPNTGSiV+YqMQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 24 23 57 41" title="" data-src="/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-87f29.png" data-srcset="/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-38577.png 200w,\n/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-26124.png 400w,\n/static/2022-05-24-23-57-41-8608047ad4c06f61d2d6fd82f3cb27a8-87f29.png 602w" data-sizes="(max-width: 602px) 100vw, 602px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>当数字和信息靠得更近时，我们就能发现数字和文字之间的关系了。</p>\n<h4 id="总结-1"><a href="#%E6%80%BB%E7%BB%93-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>亲密性的使用很微妙，不过相当重要。布局的时候一定要明确元素和其所属元属是否在一起，留意无关元素。</p>\n<h3 id="案例三"><a href="#%E6%A1%88%E4%BE%8B%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例三</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-a3e5c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 748px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 57.486631016042786%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACCUlEQVQozz2Sa3OaQBSG+fP9kn7o9FtnmuklMVVULgpGCbjLXlhYwBoEowhyMf0hPSYzmdk5wy488LznoLRB0wVNw881qzInm3xTrR+z0BCL35b1c2Z+17C6dgZLZ7AybrXA4DWr4eFOtAAqDW8Aq2glTCFngkwQneLIDEIzSKwo1DkZr2NbpnYS6FSYXBjB3ivO/PoKpaZnYQa+inwVSyuUtmQahS/QKZHzSBgcqWv3YUk1HxQ2dhpbsTAEuOycTGlF20ddvJBI9diUYhWthx6Z+EwjaLQGYLvcRrNoPXT9sY9GXvqYRPOw9A9X7RpXJ/e4uU+KWX4WdUVOpX8kUwwpwBBgrjGuswPat7yFgJtBkk22lVc27KyIr4x+xviTm9zKXvZ92ENaf4wgC9c4VGhEoHOukRMpG//Mv1Byg8iNv7lLlfRXXJj53ir28xz8Iaf3x8Ejj2sUVOEi0Jg/xtCFQGcgletZuXrZ3Ke5BpnD9mAX+1nxKl//ydeKnp5XWzJGaOhBbFBgUxJbUlpRics+7DrWFkZeuscu7BTI3Uf9ER/IBKd2nDnPXKerwePTYOk+OPyNX94toFXxPEosmAVJ7AQcr6MCGFZNq+3q7+4py90d8IW7y5+ywssP6GXv5XAOFbYwYbh1bd4bBTD8K20XdJfocgkvveivNezfVye6TvQf24/Dd+o/twH8poaW2usAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 25 00 00 43" title="" data-src="/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-a3e5c.png" data-srcset="/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-24e67.png 200w,\n/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-f22f2.png 400w,\n/static/2022-05-25-00-00-43-e5d4cc5b528c43fb439510861a311496-a3e5c.png 748w" data-sizes="(max-width: 748px) 100vw, 748px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>这张明信片看起来很平淡，没有任何东西能吸引你来看一看正文，或许，除了那两颗心。但是更关键的是，需要一分钟才能找到真正重要的信息。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f363d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 760px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.28947368421053%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB9UlEQVQoz1VSiW7aQBDN//9Aq0pBTUIhJkCwjc+1ja/1Cb4B45sE+h0dQxuKNFrtSPv2HTMPLW5b3HRWW+kl/8LNf0z5F3bN+NSAXE0UcSiQjwuP9vhnRn6V0EiEM+Kjo901uH64gq+lT9Xpd2I5IFVCkcYS+TjnntnJN0KfasKQZ37SzNMSLhnKOquD9zcwkNdGtZd3qRhvln4iRgmKd8o24oOtlEElQpSipFBzoG1xfQ/GbSalQGLODIe0HMo25gaem/bCcknbmGngAqSFXPCl9KE129a6NvURd+abjn5x8hjBO5WQJTA5RlD9ZSSCndqsbuBerdb3lVZVcuVP1nhiBdwGMouFKOJDn3YjIXQpZ82uoW3M+gbeLfc7Js+5PKN2B3QohPJAF7/988k7/S33E86zfz57pw/n+IXsweEorrV6z+bpe5YLhxKVeGzZC+zRjku5MCSPdv2lF160lHr5z+MFnL1vK6VsjKYxm16/2cR0bM41GCk/ZFev8oqQIC19poVcWBv1HXOt9rTgBMwfnbaQig/8maLIo+yAXQeMD5xw8SkHNF934z4wvSpQUSrVQSzKVQlpKZD22wpoNUIxZzrETg8WkP9WhvVo/xtVvx4NOOnTViv4OOA3sRjBzGMhyKQkEcIUxRA48OfqvrMvo73UH7uuNipSaBZmAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 25 00 01 39" title="" data-src="/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f363d.png" data-srcset="/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-b96f0.png 200w,\n/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f66e7.png 400w,\n/static/2022-05-25-00-01-39-f9c264697af06da092b9f325be1997b5-f363d.png 760w" data-sizes="(max-width: 760px) 100vw, 760px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不用改变很多（不过，需要改变的还有不少，详见后面章节），只要把有关联的元素放在一起，然后在不同单元间增加合适的空间，就让信息变得更直观。</p>\n<h4 id="总结-2"><a href="#%E6%80%BB%E7%BB%93-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>将类似的项归为一组来建立很近的亲密性时，有时需要做一些修改，如需要调整文本的大小或字体粗细，或者要改变图片的大小或放置位置，等等。正文（所读内容的主干部分）的字号不一定非得是 12 磅！期号和新闻简报发行年份等正文的辅助信息，可以占据相当小的位置。</p>\n<h3 id="案例四"><a href="#%E6%A1%88%E4%BE%8B%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例四</h3>\n<p>找到至少 8 个让第二个例子看起来更加专业的不同。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-e973b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.45086705202311%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACP0lEQVQoz0VSa2vbMBTN//8Jg7FP+zzKxlq6DcrokuZZx44jybItWZb1sGUrzqvpHrCbru3gIumCjs45V2fQH7rNsbXeoIwilhGexzk13vQn33TaeVNYqTstawnltjXXJS2Z37dtbwftvtmcWlGLq+Hd5fDuejz+/GPEbLH97SvDdVNc3A6v7sY394u3F1efboczHL/5cJlUrO3VwB9cd2yarZmswu+z+c10NolCaDePraoL04gv09nXyWy0it5ffrseT2Ykfvfxmip+Bnd7lysWpWSB4lkcRRQtE7QkqKhLXRe6FnZrFmmCRD7BKMrpIiXLLGkPjfVy0O6aOCcBjkOKohTFGVmlOMBrxKmyHMC7X37N6ZJi1SnjtXTS7Szosp08y05EGpA4TNA6I1ABRiHsFQNmUA73sjLDLMnKXOiiaiSY8qcnMMiO8wRoA4IiilcpCSlekjUuslfwmicLvAJHsintRru99Sf3zMytoGUGmudxBM7XLEmrXLgSpvUPzBQjjKYiBfLSlv/BwFxvDTcCMOB8ep4ZPhs7NK/M4H+6ipKC2o3SXVX35hkMCVFdhViyysg9jgMQzCEtienNKzOoZZqXtVBtpZy0vX6RvXdwdRwuoebr829NouUoCGLAP4H9g/MPECTXP7YQJ2ghF/74wgyN7Q28TSVLyjxTzO3r7qE1TuhG7P70MNFRFM5RrNsKhMCo+5++2aiBdZU0+dOXgkNYOayV5VXNC5FKlcM5ZSTjhOZYyFQadi7L4PwXBbOs5zl9/L8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 25 00 04 45" title="" data-src="/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-fee1c.png" data-srcset="/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-a67b7.png 200w,\n/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-0b187.png 400w,\n/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-fee1c.png 800w,\n/static/2022-05-25-00-04-45-345beda4e45e03930551bc11dad3bef1-e973b.png 1038w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不看正文来回答这个问题，左右图分别组织了多少场读书会？</p>\n<p>我们看一眼就能回答右边的传单上列了多少场读书会，因为每场读书会的信息都被归入有逻辑的亲密关系中（另外，活动名称现在加粗了，使用的是对比原则）。请注意，三场读书会之间的空白是相同的，显示出这三组之间有某些关系。就算文本字号小到不能阅读，你也马上就能知道有三个活动。</p>\n<p>虽然传单底部的小块文字小到无法阅读，你也知道那是什么，对不对？一定是售票信息和联系方式。你马上就知道这个单元并不是另一场活动，因为它和其他区块之间的亲密性是不同的。首先，根据理解对信息进行分组（这个工作心算完成，也可以在纸上把想法简单画出来）；你知道该怎么办。然后在页面上对文本进行实际分组。</p>\n<h4 id="总结-3"><a href="#%E6%80%BB%E7%BB%93-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h4>\n<p>亲密性原则并不是说所有一切都要更靠近，其真正的含义是：如果某些元素在理解上存在关联，或者相互之间存在某种关系，那么这些元素在视觉上也应当有关联。除此以外，其他孤立的元素或元素组则不应存在亲密性。位置是否靠近可以体现出元素之间是否存在关系。</p>\n<h3 id="总结-4"><a href="#%E6%80%BB%E7%BB%93-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<p>如果多个项相互之间存在很近的亲密性，它们将成为一个视觉单元，而不是多个孤立的元素。彼此相关的项应当归在一组。要有意识地注意你是怎样阅读的，你的视线怎样移动：从哪里开始；沿着怎样的路径；到哪里结束；读完之后，接下来看哪里？整个过程应当是一个合理的过程，有确定的开始，而且要有确定的结束。</p>\n<h4 id="根本目的"><a href="#%E6%A0%B9%E6%9C%AC%E7%9B%AE%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>根本目的</h4>\n<p>亲密性的根本目的是实现组织性。尽管其他原则也能达到这个目的，不过利用亲密性原则，只需简单地将相关的元素分在一组建立更近的亲密性，就能自动实现条理性和组织性。如果信息很有条理，将更容易阅读，也更容易被记住。此外还有一个很好的“副产品”，利用亲密性原则，还可以使空白（这是设计者们最喜欢的）更美观（也更有条理）。</p>\n<h4 id="如何实现"><a href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何实现</h4>\n<p>微微眯起眼睛，统计眼睛停顿的次数来数一数页面上有多少个元素。如果页面上的项超过 3 ～ 5 个（当然，这取决于具体情况），就要看看哪些孤立的元素可以归在一组建立更近的亲密性，使之成为一个视觉单元。</p>\n<h4 id="要避免的问题"><a href="#%E8%A6%81%E9%81%BF%E5%85%8D%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>要避免的问题</h4>\n<ul>\n<li>避免一个页面上有太多孤立的元素。</li>\n<li>不要在元素之间留出同样大小的空白，除非各组同属于一个子集。</li>\n<li>标题、子标题、图表标题、图片能否归入其相关材料？在这个问题上一定要非常清楚（哪怕只有一点含糊都要尽量避免）。在有很近亲密性的元素之间建立关系。</li>\n<li>不同属一组的元素之间不要建立关系！如果元素彼此无关，要把它们分开。</li>\n<li>不要仅仅因为有空白就把元素放在角落或中央。</li>\n</ul>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/写给大家看的设计书/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2022-05-19 11:40:02",path:"/the-non-designer-design-book/",tags:"UI, 读书笔记",title:"写给大家看的设计书",draft:null
}},{excerpt:"WebGL 三维正射投影 上一篇文章概述了二维矩阵的工作原理，我们讲到了如何平移，旋转，缩放甚至从像素空间投影到裁剪空间，并且将这些操作通过一个矩阵实现，做三维只需要再迈出一小步。 二维例子中的二维点 (x, y) 与 3x3 的矩阵相乘，在三维中我们需要三维点 (x, y, z) 与 4x4 的矩阵相乘。 让我们将上个例子改成三维的，这里会继续使用 F，但是这次是三维的 ‘F’ 。 首先需要修改顶点着色器以支持三维处理，这是原顶点着色器 这是新着色器 它甚至变简单了！在二维中我们提供 x…",html:'<h1 id="webgl-三维正射投影"><a href="#webgl-%E4%B8%89%E7%BB%B4%E6%AD%A3%E5%B0%84%E6%8A%95%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维正射投影</h1>\n<p>上一篇文章概述了二维矩阵的工作原理，我们讲到了如何平移，旋转，缩放甚至从像素空间投影到裁剪空间，并且将这些操作通过一个矩阵实现，做三维只需要再迈出一小步。</p>\n<p>二维例子中的二维点 (x, y) 与 3x3 的矩阵相乘，在三维中我们需要三维点 (x, y, z) 与 4x4 的矩阵相乘。</p>\n<p>让我们将上个例子改成三维的，这里会继续使用 F，但是这次是三维的 ‘F’ 。</p>\n<p>首先需要修改顶点着色器以支持三维处理，这是原顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2024482130304594700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec2 a_position;\n\n   uniform mat3 u_matrix;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n   }\n</script>`, `2024482130304594700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   attribute vec2 a_position<span class="token punctuation">;</span>\n\n   uniform mat3 u_matrix<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_matrix <span class="token operator">*</span> <span class="token function">vec3</span><span class="token punctuation">(</span>a_position<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是新着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39612345361437140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec4 a_position;\n\n   uniform mat4 u_matrix;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n   }\n</script>`, `39612345361437140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2,4,8}"\n              >\n                <span class="gatsby-code-button-language">js{2,4,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n<span class="gatsby-highlight-code-line">   attribute vec4 a_position<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line">   uniform mat4 u_matrix<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n<span class="gatsby-highlight-code-line">      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它甚至变简单了！在二维中我们提供 x 和 y 并设置 z 为 1，在三维中我们将提供 x，y 和 z，然后将 w 设置为 1，而在属性中 w 的默认值就是 1，我们可以利用这点不用再次设置。</p>\n<p>然后提供三维数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81791172360330640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\n// 告诉属性怎么从 positionBuffer (ARRAY_BUFFER) 中读取位置\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是 32 位的浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);\n\n// ...\n\n// 填充当前 ARRAY_BUFFER 缓冲\n// 使用组成 \'F\' 的数据填充缓冲.\nfunction setGeometry(gl) {\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([\n      // 左竖\n      0,\n      0,\n      0,\n      30,\n      0,\n      0,\n      0,\n      150,\n      0,\n      0,\n      150,\n      0,\n      30,\n      0,\n      0,\n      30,\n      150,\n      0,\n\n      // 上横\n      30,\n      0,\n      0,\n      100,\n      0,\n      0,\n      30,\n      30,\n      0,\n      30,\n      30,\n      0,\n      100,\n      0,\n      0,\n      100,\n      30,\n      0,\n\n      // 下横\n      30,\n      60,\n      0,\n      67,\n      60,\n      0,\n      30,\n      90,\n      0,\n      30,\n      90,\n      0,\n      67,\n      60,\n      0,\n      67,\n      90,\n      0\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `81791172360330640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token comment">// 告诉属性怎么从 positionBuffer (ARRAY_BUFFER) 中读取位置</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span></span><span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是 32 位的浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 填充当前 ARRAY_BUFFER 缓冲</span>\n<span class="token comment">// 使用组成 \'F\' 的数据填充缓冲.</span>\n<span class="token keyword">function</span> <span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// 左竖</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">150</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 上横</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">100</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 下横</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">30</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">60</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">67</span><span class="token punctuation">,</span>\n      <span class="token number">90</span><span class="token punctuation">,</span>\n      <span class="token number">0</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来把二维矩阵方法改成三维的</p>\n<p>这是二维（之前的）版本的 <code class="language-text">m3.translation</code>, <code class="language-text">m3.rotation</code>, 和 <code class="language-text">m3.scaling</code> 方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21175635825206387000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m3 = {\n  translation: function translation(tx, ty) {\n    return [1, 0, 0, 0, 1, 0, tx, ty, 1];\n  },\n\n  rotation: function rotation(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n    return [c, -s, 0, s, c, 0, 0, 0, 1];\n  },\n\n  scaling: function scaling(sx, sy) {\n    return [sx, 0, 0, 0, sy, 0, 0, 0, 1];\n  }\n};`, `21175635825206387000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m3 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">translation</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">translation</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> ty</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">rotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">rotation</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">scaling</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">scaling</span><span class="token punctuation">(</span><span class="token parameter">sx<span class="token punctuation">,</span> sy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>sx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是升级到三维的版本。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64311352131926840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  translation: function(tx, ty, tz) {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, tx, ty, tz, 1];\n  },\n\n  xRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [1, 0, 0, 0, 0, c, s, 0, 0, -s, c, 0, 0, 0, 0, 1];\n  },\n\n  yRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [c, 0, -s, 0, 0, 1, 0, 0, s, 0, c, 0, 0, 0, 0, 1];\n  },\n\n  zRotation: function(angleInRadians) {\n    var c = Math.cos(angleInRadians);\n    var s = Math.sin(angleInRadians);\n\n    return [c, s, 0, 0, -s, c, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n  },\n\n  scaling: function(sx, sy, sz) {\n    return [sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1];\n  }\n};`, `64311352131926840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">translation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">xRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">yRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">zRotation</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> c <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> s <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>c<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">scaling</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>sx<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sz<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意到我们现在有三个旋转方法，在二维中只需要一个是因为我们只需要绕 Z 轴旋转，现在在三维中还可以绕 X 轴和 Y 轴旋转。它们看起来还是很简单，如果使用它们后你会发现和之前一样</p>\n<p>绕 Z 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11142926553355559000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newX = x * c + y * s;\nnewY = x * -s + y * c;`, `11142926553355559000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newX = x * c + y * s;\nnewY = x * -s + y * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>绕 Y 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63913617680740930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newX = x * c + z * s;\nnewZ = x * -s + z * c;`, `63913617680740930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newX = x * c + z * s;\nnewZ = x * -s + z * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>绕 X 轴旋转</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4840776096670773000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`newY = y * c + z * s;\nnewZ = y * -s + z * c;`, `4840776096670773000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">newY = y * c + z * s;\nnewZ = y * -s + z * c;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>它们提供这些旋转方式。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/bhlktz?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [axis-diagram](embedded-codesandbox://webgl-fundamental-3d/axis-diagram?view=preview) -->\n<p>同样的我们将实现一些简单的方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3311808434184260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`translate: function(m, tx, ty, tz) {\n   return m4.multiply(m, m4.translation(tx, ty, tz));\n},\n\nxRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.xRotation(angleInRadians));\n},\n\nyRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.yRotation(angleInRadians));\n},\n\nzRotate: function(m, angleInRadians) {\n   return m4.multiply(m, m4.zRotation(angleInRadians));\n},\n\nscale: function(m, sx, sy, sz) {\n   return m4.multiply(m, m4.scaling(sx, sy, sz));\n},`, `3311808434184260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">translate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">translation</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> ty<span class="token punctuation">,</span> tz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">xRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">xRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">yRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">zRotate</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> angleInRadians</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">zRotation</span><span class="token punctuation">(</span>angleInRadians<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="token function-variable function">scale</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">scaling</span><span class="token punctuation">(</span>sx<span class="token punctuation">,</span> sy<span class="token punctuation">,</span> sz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们还需要更新投影方法，这是原代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72910800148733390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`projection: function (width, height) {\n   // 注意：这个矩阵翻转了 Y 轴，所以 0 在上方\n   return [\n      2 / width, 0, 0,\n      0, -2 / height, 0,\n      -1, 1, 1\n   ];\n},`, `72910800148733390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">projection</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 注意：这个矩阵翻转了 Y 轴，所以 0 在上方</span>\n   <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">/</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span>\n   <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它将像素坐标转换到裁剪空间，在初次尝试三维时我们将这样做</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40291508628644790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`projection: function(width, height, depth) {\n   // 注意：这个矩阵翻转了 Y 轴，所以 0 在上方\n   return [\n      2 / width, 0, 0, 0,\n      0, -2 / height, 0, 0,\n      0, 0, 2 / depth, 0,\n      -1, 1, 0, 1,\n   ];\n},`, `40291508628644790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">projection</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> depth</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 注意：这个矩阵翻转了 Y 轴，所以 0 在上方</span>\n   <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> width<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">/</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">/</span> depth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>就像 X 和 Y 需要从像素空间转换到裁剪空间一样，Z 也需要。在这个例子中我也将 Z 单位化了，我会传递一些和 width 相似的值给 depth，所以我们的空间将会是 0 到 width 像素宽，0 到 height 像素高，但是对于 depth 将会是 -depth / 2 到 +depth / 2 。</p>\n<p>最后需要更新计算矩阵的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73072601196762180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算矩阵\nvar matrix = m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400);\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);\n\n// 设置矩阵\ngl.uniformMatrix4fv(matrixLocation, false, matrix);`, `73072601196762180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算矩阵</span>\n<span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 设置矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/81z8xd?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step1](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step1?view=preview) -->\n<p>我们遇到的第一个问题是 F 在三维中过于扁平，所以很难看出三维效果。解决这个问题的方法是将它拉伸成三维几何体。现在的 F 是由三个矩形组成，每个矩形两个三角形。让它变三维需要 16 个矩形。三个矩形在正面，三个背面，一个左侧，四个右侧，两个上侧，三个底面。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 225px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADdUlEQVQ4y12Te0xTVxzHL6L7SzNdFhfnK4ozi1gUQ3qhraXF1iuspaIwGAooKVuB1jBKi2DLQ2DAHQtUW4agtCnVVNGJraU+KCkqzAcPH5TVV0yMJvyjiYkxyu09P+GSy9jOP+d7fvn+Pud7cs7BsHkjaosYqz7qZrRGbQ5j62lpuq8ZYWvbGFFRs5itS8aC4VxLJ+NTAWBbSdO/sPTMMqy1dZTRFcbzC9j6sdaRhlqyz3tuNVF6SNs0Ibzse/59/4BmRduJZaxH/uR1eJzNORcAK1SbMadzktG/k/3hbN3051ibzfoMutPrIUAY4bZIB+17SkHXdBok53onN/sGGlb19Kxn/bEufxiWrNBg9+7CLMB0e+HM/BWGfXG845Hb3h6AHpmBeiDU0wPiXymH8GDo7+16+hFPS3mTDVBb1QlyR88H3OW3c1tObmQgALOw9o4AA8tPKfnG3PnPiN10D3p36qbGEvTosrQIOcoU9KAyFt2U70ZeohANxZfS47wS6ga/BFVaTgLuueqbO/KZs5MMzFhs3WyxPn5pr/PBdXHR1IOEMvCJipF91wGkqiGRvrEOrhcm04GDeOhmRhLySlXomiqL7vNIQN5eX/+fhLU1bqnFGnzfdfgC+OM1Uw9FBnBMN5zn56MAzwij8XpoTKuhE+r+gob0RvDnKND9bO6nW644GBzD70xTFs0l/KNpIPvEqSB0qTthUKihRvgGOJurRGrPLpTqykSk9hfo3qGlDXGXgMj1TnJlvUO7xX6okFuguagYFLLTT5cvq4tkYNq85uWWjnGw5plhNFZNDW83QEdhDiKDUlR+NSMkceqQ6FUKJTMZ6BxBEFK5ttSZPgHXIRII+p0Swa2QhOfu5kT+sJQBlpfavqyscpn3q/Mmqn8qoE2HMynyhQSMnuzQjyl9II1xgbzAAbKqFlAIrlA8vFUz/zPwt2k2sFrIbQnDBBly5kISy7P2EWW5D4s80o+GC/mhvYnDsAP3XIza8jNnZ5T3tyR+/5tE8ZW3/G3HiRk/IXQvVKZ/WsDeQwynevZhr8FIdoNFCbxTw/uUZ2BP0hCIYy62zU/CiVZ9GxlRsHJGH9j7jmmOjjyC4VvJsOhN5YwnhnN02rhJySzWRvCXiPCuQ0Scb0KEOypZEB7dEJ6WND73ewihi0nV1QzYd+uysP+Pz4/VkctcukeqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 16 13 50 21" title="" data-src="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png" data-srcset="/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-a6db4.png 200w,\n/static/2022-05-16-13-50-21-a3fe4f5e55b69fb5a06493f3dfb24830-8917b.png 225w" data-sizes="(max-width: 225px) 100vw, 225px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>需要列出的还有很多，16 个矩形每个有两个三角形，每个三角形有 3 个顶点，所以一共有 96 个顶点。如果你想看这些可以去示例的源码里找。</p>\n<p>我们需要绘制更多顶点所以</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10184273187241622000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制几何体\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 16 * 6;\ngl.drawArrays(primitiveType, offset, count);`, `10184273187241622000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制几何体</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span></span>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是对应结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/06sn49?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step2](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step2?view=preview) -->\n<p>拖动滑块很难看出它是三维的，让我们给矩形上不同的颜色。需要在顶点着色器中添加一个属性和一个可变量，将颜色值传到片断着色器中。</p>\n<p>这是新的顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33889627061902660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n   attribute vec4 a_position;\n   attribute vec4 a_color;\n\n   uniform mat4 u_matrix;\n\n   varying vec4 v_color;\n\n   void main() {\n      // 将位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n\n      // 将颜色传递给片断着色器\n      v_color = a_color;\n   }\n</script>`, `33889627061902660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,7,13-14}"\n              >\n                <span class="gatsby-code-button-language">js{3,7,13-14}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   attribute vec4 a_position<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">   attribute vec4 a_color<span class="token punctuation">;</span></span>\n   uniform mat4 u_matrix<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">   varying vec4 v_color<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">      <span class="token comment">// 将颜色传递给片断着色器</span></span><span class="gatsby-highlight-code-line">      v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在片断着色器中使用颜色</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25344323925423850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-3d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 从顶点着色器中传入\n   varying vec4 v_color;\n\n   void main() {\n      gl_FragColor = v_color;\n   }\n</script>`, `25344323925423850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4-5,8}"\n              >\n                <span class="gatsby-code-button-language">js{4-5,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">   <span class="token comment">// 从顶点着色器中传入</span></span><span class="gatsby-highlight-code-line">   varying vec4 v_color<span class="token punctuation">;</span></span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">      gl_FragColor <span class="token operator">=</span> v_color<span class="token punctuation">;</span></span>   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们需要找到属性的位置，然后在另一个缓冲中存入对应的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50301557310518730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');\n\n// ...\n// 给颜色创建一个缓冲\nvar colorBuffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// 将颜色值传入缓冲\nsetColors(gl);\n\n// ...\n// 向缓冲传入 \'F\' 的颜色值\nfunction setColors(gl) {\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Uint8Array([\n      // 正面左竖\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n      200,\n      70,\n      120,\n\n      // 正面上横\n      200,\n      70,\n      120,\n      200,\n      70,\n      120\n    ]),\n    // ...\n    // ...\n    gl.STATIC_DRAW\n  );\n}`, `50301557310518730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token comment">// 给颜色创建一个缓冲</span>\n<span class="token keyword">var</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 将颜色值传入缓冲</span>\n<span class="token function">setColors</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token comment">// 向缓冲传入 \'F\' 的颜色值</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// 正面左竖</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n\n      <span class="token comment">// 正面上横</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span><span class="token punctuation">,</span>\n      <span class="token number">200</span><span class="token punctuation">,</span>\n      <span class="token number">70</span><span class="token punctuation">,</span>\n      <span class="token number">120</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment">// ...</span>\n    <span class="token comment">// ...</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染时告诉颜色属性如何从缓冲中获取颜色值</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51482614993834730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 启用颜色属性\ngl.enableVertexAttribArray(colorLocation);\n\n// 绑定颜色缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值\nvar size = 3; // 每次迭代使用 3 个单位的数据\nvar type = gl.UNSIGNED_BYTE; // 单位数据类型是无符号 8 位整数\nvar normalize = true; // 标准化数据 (从 0-255 转换到 0.0-1.0)\nvar stride = 0; // 0 = 移动距离 * 单位距离长度sizeof(type)，每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `51482614993834730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 启用颜色属性</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定颜色缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用 3 个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是无符号 8 位整数</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标准化数据 (从 0-255 转换到 0.0-1.0)</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度sizeof(type)，每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们得到这个。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/ebud7i?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step3](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step3?view=preview) -->\n<p>它好像把 ‘F’ 的所有部分都按照提供的顺序显示出来了，正面，背面，侧面等等。有时候这并不是想要的结果，在背面的物体反而被绘制出来了。</p>\n<p><img src="/static/polygon-drawing-order-6f0c8bfb4a988b0b830d2a0fe618b6ad.gif"></p>\n<p>红色部分是 ‘F’ 的正面，但是因为它在数据的前部所以最先被绘制出来，然后它后面的面绘制后挡住了它。例如紫色部分实际上是 ‘F’ 的背面，由于它在数据中是第二个所以第二个被画出来。</p>\n<p>WebGL 中的三角形有正反面的概念，正面三角形的顶点顺序是逆时针方向，反面三角形是顺时针方向。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 232px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.65517241379311%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAC5UlEQVQ4y2Ng42ZhqLkYzgACm/7XgGlZIxE3IMXJAAX8UlwwJoN99QwGJMDKKSxu0/v/PxOIoxmYzMAQ1G0JlsnZ7sMMorO3ervFzHH8D2Sqg/hyJqKMVedCwWq0glLBtG54DlitlImjo13F1D+efRtkQHyzrBZGsAKPKiNGqI1cNZfCb838n/0/dbU72NnFhwPBmvlkFMEKhNX04M4LXXp2X+7V///dOldlgfjhKy6C1TKs+F8KZhTs9Zsx+Uf6/0nf0v6XnwzeChK7838Wk322DoN751Kw2pTDn1nAjuhdX5d69Ov/tGPf/ocsOXMEJPb/P9BjUdPtwQqiZzl4d79O/N/7NulP3/vk/813o787FegpgV0ywQbsA/fuNWCLTdMbzGI23/uffOD9/6T97/7FbL7/3zy71RDudB5RLt7aS+GPQC4DGvqn503Sb5BLs7Z4F4PkG29FMZtl1sGChQnooovpJ378T9z7+nfSvje/00/++u8zdWcbzDxOYHhtnP4/63/P26TvQAN/A/FPkOGVZ0JOwLwSu+UuOCZDlpzuyTzzF+i6d99BBgLxz9QjX/6Hr7x8jQEai1HAmP3f+Tz+L8irU35l/J/8M/3/1N8Z//s/pvxPXOpiBrNZzSvG3KV16f+YLffB3s0Auiz95M//Gad+/wcZqhmQHMPgWWPM7lykLxM+2dY0bY17YNZmr5KiAwEzGm5Ebk5e7vrLp8G0A+LKjYzc4rK8QKalRV6HiXvXGn9gcinyn7lvWsji09vDV168r+4Tt4GBAJBj52WVg7IZCahlAyZ6QTCLmY1ZnoWDxYqNm9WBS4jdgIOfzZydh9WBnY/NHJRxQGp4JbgYmFhYGUzTGoBpUomblYvHko2Hz4qVm9eOnU/QAJsNIkDsAHQHCDsDsTsQq8IkGZkYQW6EuJKRURbI8oeq8wGKeDMyM4thM1QAqEAHiK1A3oWLMjEhVDDCaVEg1gWybIC0OEwaAF6MGEfnVjJKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 18 11 30 35" title="" data-src="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png" data-srcset="/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-b0d34.png 200w,\n/static/2022-05-18-11-30-35-dcc0f83da6fad24ec82c14beeb61dca7-6144b.png 232w" data-sizes="(max-width: 232px) 100vw, 232px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>WebGL 可以只绘制正面或反面三角形，可以这样开启</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85208966137193820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enable(gl.CULL_FACE);`, `85208966137193820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">CULL_FACE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将它放在 drawScene 方法里，开启这个特性后 WebGL 默认“剔除”背面三角形，“剔除”在这里是“不用绘制”的花哨叫法。</p>\n<p>对于 WebGL 而言，一个三角形是顺时针还是逆时针是根据裁剪空间中的顶点顺序判断的，换句话说，WebGL 是根据你在顶点着色器中运算后提供的结果来判定的，这就意味着如果你把一个顺时针的三角形沿 X 轴缩放 -1，它将会变成逆时针，或者将顺时针的三角形旋转 180 度后变成逆时针。由于我们没有开启 CULL_FACE，所以可以同时看到顺时针（正面）和逆时针（反面）三角形。现在开启了，任何时候正面三角形无论是缩放还是旋转的原因导致翻转了，WebGL 就不会绘制它。这件事很有用，因为通常情况下你只需要看到你正面对的面。</p>\n<p>开启 CULL_FACE 后得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/lmtm5y?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step4](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step4?view=preview) -->\n<p>结果证明，大多数三角形朝向都是错的，旋转的时候你会看到背面的三角形，幸好它很容易解决，我们只需要看看哪些是三角形是反的，然后交换它们的两个顶点。例如一个反的三角形</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74773685833201830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  1,   2,   3,\n 40,  50,  60,\n700, 800, 900,`, `74773685833201830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">  1,   2,   3,\n 40,  50,  60,\n700, 800, 900,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>只需要交换后两个顶点的位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52107260838052220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  1,   2,   3,\n700, 800, 900,\n 40,  50,  60,`, `52107260838052220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">  1,   2,   3,\n700, 800, 900,\n 40,  50,  60,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>通过修正朝向错误后得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/pfgtxt?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step5](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step5?view=preview) -->\n<p>这很接近实际效果了但是还有一个问题，即使所有三角形的朝向是正确的，然后背面的被剔除了，有些应该在背面的部分还是出现在了前面。</p>\n<p>深度缓冲有时也叫 Z-Buffer，是一个存储像素深度的矩形，一个深度像素对应一个着色像素，在绘制图像时组合使用。当 WebGL 绘制每个着色像素时也会写入深度像素，它的值基于顶点着色器返回的 Z 值，就像我们将 X 和 Y 转换到裁剪空间一样，Z 也在裁剪空间或者 (-1 到 +1)。这个值会被转换到深度空间( 0 到 +1)，WebGL 绘制一个着色像素之前会检查对应的深度像素，如果对应的深度像素中的深度值小于当前像素的深度值，WebGL 就不会绘制新的颜色。反之它会绘制片断着色器提供的新颜色并更新深度像素中的深度值。这也意味着在其他像素后面的像素不会被绘制。</p>\n<p>我们可以像这样开启这个特性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85046387170955850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enable(gl.DEPTH_TEST);`, `85046387170955850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在开始绘制前还需要清除深度缓冲为 1.0。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19057307832355574000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制场景\nfunction drawScene() {\n  // ...\n\n  // 清空画布和深度缓冲\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n  // ...\n}`, `19057307832355574000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制场景</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n\n  <span class="token comment">// 清空画布和深度缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span> <span class="token operator">|</span> gl<span class="token punctuation">.</span><span class="token constant">DEPTH_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在得到</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/ts2ymi?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-step6](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-step6?view=preview) -->\n<p>这才是三维！</p>\n<p>还有一件小事，在大多数三维数学库中没有负责像素空间与裁剪空间转换的 projection 方法。代替的是叫做 ortho 或 orthographic 的方法，它看起来像这样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68643324162525650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  orthographic: function(left, right, bottom, top, near, far) {\n    return [\n      2 / (right - left),\n      0,\n      0,\n      0,\n      0,\n      2 / (top - bottom),\n      0,\n      0,\n      0,\n      0,\n      2 / (near - far),\n      0,\n\n      (left + right) / (left - right),\n      (bottom + top) / (bottom - top),\n      (near + far) / (near - far),\n      1\n    ];\n  }\n};`, `68643324162525650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">orthographic</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> top<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>top <span class="token operator">-</span> bottom<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      <span class="token number">2</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n\n      <span class="token punctuation">(</span>left <span class="token operator">+</span> right<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>left <span class="token operator">-</span> right<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span>bottom <span class="token operator">+</span> top<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>bottom <span class="token operator">-</span> top<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span>near <span class="token operator">+</span> far<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">1</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和我们简单的 projection 方法不同的是正射投影有更多的参数可以传递，左，右，上，下，近和远，给我们更灵活的选择。为了用这个方法实现之前的投影，需要这样调用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17684515500328346000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var left = 0;\nvar right = gl.canvas.clientWidth;\nvar bottom = gl.canvas.clientHeight;\nvar top = 0;\nvar near = 400;\nvar far = -400;\nm4.orthographic(left, right, bottom, top, near, far);`, `17684515500328346000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> right <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n<span class="token keyword">var</span> bottom <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> near <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> far <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">400</span><span class="token punctuation">;</span>\nm4<span class="token punctuation">.</span><span class="token function">orthographic</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> top<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="webgl-三维透视投影"><a href="#webgl-%E4%B8%89%E7%BB%B4%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维透视投影</h1>\n<p>上一篇文章讲述了如何实现三维，那个三维用的不是透视投影，而是的所谓的“正射”投影，但那不是我们日常观看三维的方式。</p>\n<p>我们应使用透视投影代替它，但什么是透视投影？它的基础特性就是离得越远显得越小。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-222ff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 52.38095238095239%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACjElEQVQoz5WPW0gUURzGT/RgdkMDU0vaHoIMsjAxC6yIQJIMr7nrKkllarigokEhle39Ioa2O7MzbjOmaRfR7K1eJAoXS11XYzWvac32UD3UU9Qw83Xc6C2IHn58f875853fIdefB7+b/DMy5afRPy1HGA7RnPkffphHZnHjxdQKcU2EZX2XGxV999Aa+gTb+BJckxJsgXeROZL/YnxJdb0Jw/xqNkzso8tykmE/UppOqe3TX9VrLwNqzZNB1TGxojoCK+rqsnVsUbWMztNciMx/QXFOfoBp5K1Eah4PyqSIYF3pZtU0MoOL/b1IrN6DlsmPqOy/j+bhKTgC7+EKSjSXYR+j1qMLlHnK3G9ezynO4DLM/pBEMpr1MskjIKeJqhVv4aizEiSboHrgEXbVH0IO04QCwQHDs6e46p+AcXwRlqkwLNNfYAl9/oNin/sGYzAskWjtenkNNSQFRI0v346NZbEghQSxFzQgurUgpZuw4UwUNCVxyDIcQUObGW08A8ZUA8ZaB8bWQLNe4Z2NaDfXSoR+VyZaWqglKsknWJtLEJMXhSRqnXk8GrqcONTp0+G8fA5MixUiz4Fra0VHYxk68zXoyt2GuwU7lZ5CDYTcHRIpLkqQM07EIDNri1qiS4ThZCKq0rai6/xh3L6khWAz0hIfOJ+Ih339EEQRLMfDK3aDbbHAV3EMojZZ6S5PRYd+n0Qe6FLkytQE1KfHq4NnD4Cvyob9igFedzs4QYT3jgC3243e3h4MDPTD4/GA46gly9JHBLCMB3xdkdKt2w1fcbJEuJK9sqn4IEwGvcq2WsFSG5/QCY6nFl4WLMtAEAQMDQ2Bj5x5I4Xe1VJ6v7rHdgiK72Yt+LI06Rcu/wbO8qWs0QAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 19 11 22 58" title="" data-src="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-fee1c.png" data-srcset="/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-a67b7.png 200w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-0b187.png 400w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-fee1c.png 800w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-b1a91.png 1200w,\n/static/2022-05-19-11-22-58-4ea6413cc5e31caaf16339481cd770a0-222ff.png 1344w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在上方的示例中，远处的物体会变小，想要实现例子中近大远小的效果，简单的做法就是将裁减空间中的 X 和 Y 值除以 Z 值。</p>\n<p>你可以这么想：如果一个线段是 (10, 15) 到 (20,15)，它长度为十个单位，在当前的代码中它就是 10 个像素长，但是如果我们将它除以 Z，且 Z 值 为 1</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82370380127620560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 1 = 10\n20 / 1 = 20\nabs(10-20) = 10`, `82370380127620560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 1 = 10\n20 / 1 = 20\nabs(10-20) = 10</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>它将是 10 个像素长，如果 Z 值为 2</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34354090082904265000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 2 = 5\n20 / 2 = 10\nabs(5 - 10) = 5`, `34354090082904265000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 2 = 5\n20 / 2 = 10\nabs(5 - 10) = 5</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>就是 5 像素了，当 Z 值为 3 时</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8910782147875107000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`10 / 3 = 3.333\n20 / 3 = 6.666\nabs(3.333 - 6.666) = 3.333`, `8910782147875107000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">10 / 3 = 3.333\n20 / 3 = 6.666\nabs(3.333 - 6.666) = 3.333</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>你可以看出随着 Z 变大距离就变远了，画的也会小一点。如果我们除以裁剪空间中的 Z，值可能会变大，因为 Z 是一个较小的值(-1 到 +1)。但是我们可以提供一个 fudgeFactor 因子和 Z 相乘，这样就可以调整缩放的程度。</p>\n<p>让我们来试试，首先修改顶点着色器，除以 Z 再乘以我们的 “fudgeFactor” 因子。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51311940389147020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-3d&quot; type=&quot;x-shader/x-vertex&quot;>\n  // ...\n  uniform float u_fudgeFactor;\n  // ...\n  void main() {\n    // 将位置和矩阵相乘\n    vec4 position = u_matrix * a_position;\n\n    // 调整除数\n    float zToDivideBy = 1.0 + position.z * u_fudgeFactor;\n\n    // x 和 y 除以调整后的除数\n    gl_Position = vec4(position.xy / zToDivideBy, position.zw);\n  }\n</script>`, `51311940389147020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,9-10,12-13}"\n              >\n                <span class="gatsby-code-button-language">js{3,9-10,12-13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-3d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n  <span class="token comment">// ...</span>\n<span class="gatsby-highlight-code-line">  uniform float u_fudgeFactor<span class="token punctuation">;</span></span>  <span class="token comment">// ...</span>\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 将位置和矩阵相乘</span>\n    vec4 position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line">    <span class="token comment">// 调整除数</span></span><span class="gatsby-highlight-code-line">    float zToDivideBy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> position<span class="token punctuation">.</span>z <span class="token operator">*</span> u_fudgeFactor<span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line">    <span class="token comment">// x 和 y 除以调整后的除数</span></span><span class="gatsby-highlight-code-line">    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>xy <span class="token operator">/</span> zToDivideBy<span class="token punctuation">,</span> position<span class="token punctuation">.</span>zw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意，由于裁减空间中的 Z 值是 -1 到 +1 的，所以 +1 是为了让 zToDivideBy 变成 0 到 <code class="language-text">+2 * fudgeFactor</code></p>\n<p>还需要更新代码以设置 fudgeFactor。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30044240449257443000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\nvar fudgeLocation = gl.getUniformLocation(program, \'u_fudgeFactor\');\n\n// ...\nvar fudgeFactor = 1;\n// ...\nfunction drawScene() {\n  // ...\n  // 设置 fudgeFactor\n  gl.uniform1f(fudgeLocation, fudgeFactor);\n\n  // 绘制几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 16 * 6;\n  gl.drawArrays(primitiveType, offset, count);\n  // ...\n}`, `30044240449257443000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token keyword">var</span> fudgeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_fudgeFactor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> fudgeFactor <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 设置 fudgeFactor</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>fudgeLocation<span class="token punctuation">,</span> fudgeFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 绘制几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/pokxmd?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective?view=preview) -->\n<p>如果效果不明显，可以将 “fudgeFactor” 滑块从 1.0 拖到 0.0 来对比没添加这些代码之前的样子。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 313px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.0223642172524%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+ElEQVQoz2P4////v/////77B6LA7K9/gDwwBwb+AQX+/oNz4OIMEAoo8PDf302fv9TffzX/Uu+ndwdAysDqIAb9+//n2bM1T54s/g+1Aqb52e/flZfvpK/ZX92+aF5k954Ox+t3KyGaITq/33t/ZXHD0TMWR45YvXq5DW4uSPO5naeX+teecq24aF1yw6f5afecXz8fw1346dK9s+GtR20KTsyOOHra9cmTrTC3gjX/e/PxamjrMY/ic81BN6/t3vj8/8WLX8HGg1RdKZh22DznlEfd6eScL2/OwK0Faf73F8R6feTKcfvS0/WxLUvmpWTvSPW69PbVL4iKX+8+XUqdfLoo7PoK+2MXNszf+PbZXYjR/xgggQkk73avOmhdetKz5pR5xczccx8+QxwOMvrn66/XK1r3tEXlN2/0Nr3cU/AQ4i5waIPd9/P9pwvhbYe9imcvC7/5ZD8itMFG/3z1+XzKlGPWJQ3uG5atOgfy9N9/0Kj69wek7u3hSyesS+cujZn2NP3L9/eIeALb//v1p/NFvdOWBU14GP7g43lEPMNV3Gtbdcg6p3u7++XP+0DG//uDLPv75Zfj7V1tW+3Pvd+Kohnq+DcfrmVNv7Z+3a//v/7/+//v/z/kdAbS//TTowsnfv//haoZqgRqCXbw7z8sFYMoAJqia9bsRhwAAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 05 23 11 12 31" title="" data-src="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png" data-srcset="/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-8a062.png 200w,\n/static/2022-05-23-11-12-31-c942b8801b3460af9800e28beacf184d-24151.png 313w" data-sizes="(max-width: 313px) 100vw, 313px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>事实上 WebGL 会将我们提供给 <code class="language-text">gl_Position</code> 的 x, y, z, w 值自动除以 w 。</p>\n<p>我们可以通过修改着色器来证明，用 zToDivideBy 代替 <code class="language-text">gl_Position.w</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76945590555436600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   // ...\n   uniform float u_fudgeFactor;\n   // ...\n   void main() {\n      // 将位置和矩阵相乘\n      vec4 position = u_matrix * a_position;\n\n      // 调整除数\n      float zToDivideBy = 1.0 + position.z * u_fudgeFactor;\n\n      // 将 x y z 除以 zToDivideBy\n      gl_Position = vec4(position.xyz, zToDivideBy);\n\n      // 传递颜色到给片断着色器\n      v_color = a_color;\n   }\n</script>`, `76945590555436600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{13}"\n              >\n                <span class="gatsby-code-button-language">js{13}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   <span class="token comment">// ...</span>\n   uniform float u_fudgeFactor<span class="token punctuation">;</span>\n   <span class="token comment">// ...</span>\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将位置和矩阵相乘</span>\n      vec4 position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n\n      <span class="token comment">// 调整除数</span>\n      float zToDivideBy <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">+</span> position<span class="token punctuation">.</span>z <span class="token operator">*</span> u_fudgeFactor<span class="token punctuation">;</span>\n\n      <span class="token comment">// 将 x y z 除以 zToDivideBy</span>\n<span class="gatsby-highlight-code-line">      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>xyz<span class="token punctuation">,</span> zToDivideBy<span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n      <span class="token comment">// 传递颜色到给片断着色器</span>\n      v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看他们多像。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/1jhg42?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-w](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-w?view=preview) -->\n<p>为什么 WebGL 会自动除以 W ？因为使用矩阵的魔力，可以用把值从 z 传值到 w 。</p>\n<p>一个这样的矩阵</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65566317197028810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 0,`, `65566317197028810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 0,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>将会把 z 的值复制给 w，你可以把每列看作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32425131708061540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x_out = x_in * 1 +\n        y_in * 0 +\n        z_in * 0 +\n        w_in * 0 ;\n\ny_out = x_in * 0 +\n        y_in * 1 +\n        z_in * 0 +\n        w_in * 0 ;\n\nz_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;\n\nw_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;`, `32425131708061540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x_out = x_in * 1 +\n        y_in * 0 +\n        z_in * 0 +\n        w_in * 0 ;\n\ny_out = x_in * 0 +\n        y_in * 1 +\n        z_in * 0 +\n        w_in * 0 ;\n\nz_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;\n\nw_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 0 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>简化后得到</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55196605470648844000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`x_out = x_in;\ny_out = y_in;\nz_out = z_in;\nw_out = z_in;`, `55196605470648844000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x_out = x_in;\ny_out = y_in;\nz_out = z_in;\nw_out = z_in;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 w 原来就是 1.0 就会加 1</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38407322279174185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 1,`, `38407322279174185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 1,\n0, 0, 0, 1,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>他会将 W 的运算变为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79977858307825070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 1 ;`, `79977858307825070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * 1 +\n        w_in * 1 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为 w_in = 1.0 是已知的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13867070829520722000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = z_in + 1;`, `13867070829520722000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = z_in + 1;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最后可以将 fudgeFactor 像这样放入矩阵中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48686889786754220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, fudgeFactor,\n0, 0, 0, 1,`, `48686889786754220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, fudgeFactor,\n0, 0, 0, 1,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>相当于</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29111195032621450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * fudgeFactor +\n        w_in * 1 ;`, `29111195032621450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = x_in * 0 +\n        y_in * 0 +\n        z_in * fudgeFactor +\n        w_in * 1 ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>简化后为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10753921256313537000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`w_out = z_in * fudgeFactor + 1;`, `10753921256313537000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">w_out = z_in * fudgeFactor + 1;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们来修改代码，使用这个矩阵。</p>\n<p>首先将顶点着色器还原，又变成简单的样子</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3834983660147562000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   uniform mat4 u_matrix;\n\n   void main() {\n      // 位置和矩阵相乘\n      gl_Position = u_matrix * a_position;\n      // ...\n   }\n</script>`, `3834983660147562000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   uniform mat4 u_matrix<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 位置和矩阵相乘</span>\n      gl_Position <span class="token operator">=</span> u_matrix <span class="token operator">*</span> a_position<span class="token punctuation">;</span>\n      <span class="token comment">// ...</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接下来定义一个方法实现 Z → W 的矩阵</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79826583056546960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function makeZToWMatrix(fudgeFactor) {\n  return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, fudgeFactor, 0, 0, 0, 1];\n}`, `79826583056546960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">makeZToWMatrix</span><span class="token punctuation">(</span><span class="token parameter">fudgeFactor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> fudgeFactor<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后使用它。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93327986567628930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n// 计算矩阵\nvar matrix = makeZToWMatrix(fudgeFactor);\nmatrix = m4.multiply(matrix, m4.projection(gl.canvas.clientWidth, gl.canvas.clientHeight, 400));\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);\n\n// ...`, `93327986567628930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3-4}"\n              >\n                <span class="gatsby-code-button-language">js{3-4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n<span class="token comment">// 计算矩阵</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> matrix <span class="token operator">=</span> <span class="token function">makeZToWMatrix</span><span class="token punctuation">(</span>fudgeFactor<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> m4<span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>和之前的很像。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/b0ky3t?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-w-matrix](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-w-matrix?view=preview) -->\n<p>这只是展示了除以 Z 值获可以实现透视投影，以及在 WebGL 中简单实现。</p>\n<p>但还有一些问题需要解决，比如将 Z 值设置为 -100 左右的时候会遇到下面的情形</p>\n<p><img src="/static/z-clipping-948d177dcce9ad96f72b6ddd71253aeb.gif"></p>\n<p>为什么会这样？为什么 F 提前消失了？WebGL 裁剪空间中的 X 和 Y 会被 +1 和 -1 裁剪，Z 也一样。我们看到的是 Z &#x3C; -1 的情况。</p>\n<p>我可以从数学方法深入探讨并寻找解决办法，但是你可以联想二维中的的解决方法。我们需要获取 Z 值，然后加上一些量，缩放一些量，就可以将任意范围映射到 -1 到 +1 的范围内。</p>\n<p>最有意思的是这件事可以在一个矩阵中完成，更方便的是，我们可以定义一个 fieldOfView 代替 fudgeFactor，计算出更合适的值。</p>\n<p>这是创建矩阵的方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61143928590917980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  perspective: function(fieldOfViewInRadians, aspect, near, far) {\n    var f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewInRadians);\n    var rangeInv = 1.0 / (near - far);\n\n    return [f / aspect, 0, 0, 0, 0, f, 0, 0, 0, 0, (near + far) * rangeInv, -1, 0, 0, near * far * rangeInv * 2, 0];\n  }\n};\n\n// ...`, `61143928590917980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">perspective</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fieldOfViewInRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> near<span class="token punctuation">,</span> far</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> f <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">tan</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> fieldOfViewInRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> rangeInv <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>near <span class="token operator">-</span> far<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>f <span class="token operator">/</span> aspect<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> f<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>near <span class="token operator">+</span> far<span class="token punctuation">)</span> <span class="token operator">*</span> rangeInv<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> near <span class="token operator">*</span> far <span class="token operator">*</span> rangeInv <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个矩阵会为我们完成所有转换。它可以调整单位以适应裁剪空间，它可以自定义视场角，选择 Z-裁剪面。假设有一个眼睛或者摄像机在原点(0, 0, 0)，根据 zNear 和 fieldOfView 可以将 zNear 对应到 Z = -1，在 zNear 平面上一半的 fieldOfView 长度对应画布中心到 Y = -1 或 Y = 1 的距离，X 的值通过乘以 aspect 获取，最后通过设置 zFar 对应 Z = 1，控制缩放的程度。</p>\n<p>这是矩阵的图解。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/5sl3lw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [frustum-diagram](embedded-codesandbox://webgl-fundamental-3d/frustum-diagram?view=preview) -->\n<p>正方体所在的有四个侧面的椎体叫做“视锥”，矩阵将视锥中的空间转换到裁剪空间中，zNear 决定了被正面切割的位置，zFar 决定被背面切割的位置。将 zNear 设置为 23 就会看到正方体正面被切割，将 zFar 设置为 24 就会看到正方体背面被切割。</p>\n<p>还有一个问题，矩阵假定观察位置为 0, 0, 0 并且看向 Z 轴负方向，Y 轴为上方向。这和我们目前为止做法不同，为了解决这个问题我们需要将物体放到视图范围内。</p>\n<p>我们在 (45, 150, 0) 绘制的 F，可以将它移动到 (-150, 0, -360)</p>\n<p>使用 m4.projection 方法代替之前的投影方法，可以调用 m4.perspective</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39724639285946384000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;\nvar zNear = 1;\nvar zFar = 2000;\nvar matrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);\nmatrix = m4.translate(matrix, translation[0], translation[1], translation[2]);\nmatrix = m4.xRotate(matrix, rotation[0]);\nmatrix = m4.yRotate(matrix, rotation[1]);\nmatrix = m4.zRotate(matrix, rotation[2]);\nmatrix = m4.scale(matrix, scale[0], scale[1], scale[2]);`, `39724639285946384000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> aspect <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> zNear <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> zFar <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">perspective</span><span class="token punctuation">(</span>fieldOfViewRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> zNear<span class="token punctuation">,</span> zFar<span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> translation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">xRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">zRotate</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> rotation<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> scale<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果在这里。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/y9yucf?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-perspective-matrix](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-perspective-matrix?view=preview) -->\n<p>我们讲了矩阵乘法，视角和自定义 Z 范围。还有很多没讲完，但这篇文章已经很长了，所以接下来继续讲相机。</p>\n<blockquote>\n<p><strong>为什么将 F 移动到那么远的距离（Z = -360）?</strong></p>\n<p>在其他的例子中 F 都在 (45, 150, 0)，但在最后一个例子中它被移动到了 (-150, 0, -360)。为什么它被移动到那么远的地方？</p>\n<p>原因是在最后一个例子中用 m4.projection 方法将像素移动到裁减空间，我们的显示范围是 <code class="language-text">400 x 300</code> 像素，<code class="language-text">像素</code> 在三维中无法解释。所以新投影创建了一个视锥，它在 zNear 的距离时是 2 个单位高和 <code class="language-text">2 * aspect</code> 个单位宽。由于 <code class="language-text">F</code> 的大小是 150 个单位，在近平面的时候只能看到 2 个单位的高度，所以我们将它移到足够远的地方才能看到完整的它。</p>\n<p>同样的将 <code class="language-text">X</code> 从 45 移动到 -150。过去视图表示的范围是 0 到 400 个单位，现在它表示的 -1 到 +1 个单位。</p>\n</blockquote>\n<h1 id="webgl-三维相机"><a href="#webgl-%E4%B8%89%E7%BB%B4%E7%9B%B8%E6%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 三维相机</h1>\n<p>在上篇文章中我们将 F 移动到了视锥中，原因是 <code class="language-text">m4.perspective</code> 默认将相机放在了原点 <code class="language-text">(0, 0, 0)</code> 并且视锥的范围是 <code class="language-text">-zNear</code> 到 <code class="language-text">-zFar</code>。</p>\n<p>将物体移动到视场中可能并不是正确的方法，在实际生活中通常是移动相机去拍摄建筑物。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=0" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=0) -->\n<p>将物体移动到相机前面并不是常见做法。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=1" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=1) -->\n<p>但在上节中由于投影的原因物体需要在 -Z 轴上，我们通过将相机移动到原点，物体移动到相机前来保持原始的相对位置。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=2" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=2) -->\n<p>高效的将物体移动到相机前是非常重要的。最简单的方式是使用一个“逆向”矩阵，计算逆矩阵的数学原理比较复杂但概念很简单，逆就是你想通过一个值去抵消一个值。例如，123 的逆就是 -123，一个缩放为 5 的缩放矩阵的逆是缩放为 1/5 或 0.2 的缩放矩阵，一个绕 X 轴旋转 30° 的旋转矩阵的逆是绕 X 旋转 -30°。</p>\n<p>目前为止我们使用过平移，旋转和缩放去控制 ‘F’ 的位置和姿态，将这些矩阵相乘后得到一个矩阵，可以将物体从原始位置移动到期望的位置，大小和姿态。我们可以对相机进行同样的操作，一旦有了相机从原点移动旋转到目标位置的矩阵后，就可以计算出它的逆矩阵，利用这个逆矩阵可以不动相机，将物体从相反的方向移动到相机前。</p>\n<p>让我们来做一个三维场景，像上图一样有一圈 ‘F’ 。</p>\n<p>首先，由于 5 个物体使用的是同一个投影矩阵，所以我们将投影矩阵的计算放在循环外</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34988326777629710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算投影矩阵\nvar aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;\nvar zNear = 1;\nvar zFar = 2000;\nvar projectionMatrix = m4.perspective(fieldOfViewRadians, aspect, zNear, zFar);`, `34988326777629710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算投影矩阵</span>\n<span class="token keyword">var</span> aspect <span class="token operator">=</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientWidth <span class="token operator">/</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token keyword">var</span> zNear <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> zFar <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> projectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">perspective</span><span class="token punctuation">(</span>fieldOfViewRadians<span class="token punctuation">,</span> aspect<span class="token punctuation">,</span> zNear<span class="token punctuation">,</span> zFar<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接着计算相机矩阵，这个矩阵代表的是相机在世界坐标中的位置和姿态。下方的代码计算的是看向原点，在半径为 <code class="language-text">radius * 1.5</code> 的圆上移动的相机。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/rsob1c?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=3" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [camera-move-camera](embedded-codesandbox://webgl-fundamental-3d/camera-move-camera?view=preview&initialpath=?mode=3) -->\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50877400747151810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var numFs = 5;\nvar radius = 200;\n\n// 计算相机的矩阵\nvar cameraMatrix = m4.yRotation(cameraAngleRadians);\ncameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);`, `50877400747151810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> numFs <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> radius <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机的矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>cameraAngleRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\ncameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> radius <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后通过相机矩阵计算“视图矩阵”，视图矩阵是将所有物体以相反于相机的方向运动，尽管相机还是在原点但是相对关系是期望的。我们可以使用 inverse 方法计算逆矩阵（完全对立的转换矩阵），在这个例子中提供的是绕原点转动的矩阵，它的逆矩阵是移动相机以外的所有物体，好像相机在原点一样。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99274935469367360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 通过相机矩阵计算视图矩阵\nvar viewMatrix = m4.inverse(cameraMatrix);`, `99274935469367360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 通过相机矩阵计算视图矩阵</span>\n<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>现在将视图矩阵和投影矩阵结合在一起</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69644472517765090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算组合矩阵\nvar viewProjectionMatrix = m4.multiply(projectionMatrix, viewMatrix);`, `69644472517765090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 计算组合矩阵</span>\n<span class="token keyword">var</span> viewProjectionMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>projectionMatrix<span class="token punctuation">,</span> viewMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>最后绘制一圈 F，将每个 F 乘以视图投影矩阵，然后旋转和向外平移 radius 个单位。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13209325677929495000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for (var ii = 0; ii < numFs; ++ii) {\n  var angle = (ii * Math.PI * 2) / numFs;\n  var x = Math.cos(angle) * radius;\n  var y = Math.sin(angle) * radius;\n\n  // 从视图投影矩阵开始\n  // 计算 F 的矩阵\n  var matrix = m4.translate(viewProjectionMatrix, x, 0, y);\n\n  // 设置矩阵\n  gl.uniformMatrix4fv(matrixLocation, false, matrix);\n\n  // 获得几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 16 * 6;\n  gl.drawArrays(primitiveType, offset, count);\n}`, `13209325677929495000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> numFs<span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> angle <span class="token operator">=</span> <span class="token punctuation">(</span>ii <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> numFs<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius<span class="token punctuation">;</span>\n\n  <span class="token comment">// 从视图投影矩阵开始</span>\n  <span class="token comment">// 计算 F 的矩阵</span>\n  <span class="token keyword">var</span> matrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>viewProjectionMatrix<span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置矩阵</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>matrixLocation<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 获得几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个绕 F 旋转的相机。拖动 cameraAngle 滑块移动相机。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/2cxg3w?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera?view=preview) -->\n<p>这样做没什么问题，但是有时利用旋转和平移去移动相机，让它到达期望的位置并看向期望的方向并不容易。例如你想让它总是看向一个特定的 F，而相机又在绕一圈 F 旋转，这时计算会变的相当复杂。</p>\n<p>幸好这有一个简单的方法，我们可以同时定义相机位置和朝向，然后矩阵就可以将相机放在那，基于矩阵这个工作就会变得非常简单。</p>\n<p>首先我们需要知道相机的期望位置，将它叫做 cameraPosition，然后需要知道看向或对准的目标位置，将它叫做 target。如果将 target 减去 cameraPosition 就会得到相机的朝向，将它叫做 zAxis。由于我们知道相机看向的是 -Z 方向，所以可以用另一种方式相减 <code class="language-text">cameraPosition - target</code>，将结果单位化后直接赋给矩阵的 z 区域。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47925222619554430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n| Zx | Zy | Zz |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+`, `47925222619554430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+\n| Zx | Zy | Zz |    |\n+----+----+----+----+\n|    |    |    |    |\n+----+----+----+----+</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>矩阵的这个区域代表的是 Z 轴。在这个例子中相机的 Z-axis 进行了单位化，单位化也就是一个做一个类似 1.0 的矢量，如果你回到二维旋转的文章，那里讲到的单位圆在二维旋转中用法，在三维中需要一个单位球，单位向量表示单位球上的点。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=0" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=0) -->\n<p>这些信息还不够，只给了一个单位圆上点，如何来确定物体的姿态呢？这就需要填充矩阵的其他区域，尤其是 X 轴和 Y 轴。通常情况下我们知道它们互相垂直，如果再知道哪里是上方，在该例中是 <code class="language-text">(0, 1, 0)</code>，就可以使用“叉乘”去计算矩阵的 X 轴和 Y 轴。</p>\n<p>我不知道叉乘的数学意义是什么，但我知道将两个单位向量叉乘后可以得到一个和它们都垂直的向量。换句话说，如果你有一个向量指向东南方，一个向量指向上方，叉乘后会得到一个指向西南方或东北方的矢量，因为这两个矢量都和东南方和上方垂直，相乘的顺序不同得到结果相反。</p>\n<p>在任何情况下我们可以通过叉乘 zAxis 和 up 得到相机的 xAxis。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=1" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=1) -->\n<p>现在我们有了 xAxis，可以叉乘 zAxis 和 xAxis 得到相机的 yAxis。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/d8lusx?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview&amp;initialpath=?mode=2" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [cross-product-diagram](embedded-codesandbox://webgl-fundamental-3d/cross-product-diagram?view=preview&initialpath=?mode=2) -->\n<p>现在将三个轴插入矩阵中，会给我们提供一个从 cameraPosition 指向 target 的转换，只需要再加上 position</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52559063620040016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`+----+----+----+----+\n| Xx | Xy | Xz |  0 |  <- x axis\n+----+----+----+----+\n| Yx | Yy | Yz |  0 |  <- y axis\n+----+----+----+----+\n| Zx | Zy | Zz |  0 |  <- z axis\n+----+----+----+----+\n| Tx | Ty | Tz |  1 |  <- 相机位置\n+----+----+----+----+`, `52559063620040016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">+----+----+----+----+\n| Xx | Xy | Xz |  0 |  &lt;- x axis\n+----+----+----+----+\n| Yx | Yy | Yz |  0 |  &lt;- y axis\n+----+----+----+----+\n| Zx | Zy | Zz |  0 |  &lt;- z axis\n+----+----+----+----+\n| Tx | Ty | Tz |  1 |  &lt;- 相机位置\n+----+----+----+----+</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是计算叉乘的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20709059454310695000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function cross(a, b) {\n  return [a[1] * b[2] - a[2] * b[1], a[2] * b[0] - a[0] * b[2], a[0] * b[1] - a[1] * b[0]];\n}`, `20709059454310695000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">cross</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是向量相减的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10251631759294888000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function subtractVectors(a, b) {\n  return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\n}`, `10251631759294888000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">subtractVectors</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这是单位化向量的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71963190261928370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function normalize(v) {\n  var length = Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\n  // 确定不会除以 0\n  if (length > 0.00001) {\n    return [v[0] / length, v[1] / length, v[2] / length];\n  } else {\n    return [0, 0, 0];\n  }\n}`, `71963190261928370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 确定不会除以 0</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>length <span class="token operator">></span> <span class="token number">0.00001</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> length<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是计算“朝向”矩阵的代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11432164641139230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var m4 = {\n  lookAt: function(cameraPosition, target, up) {\n    var zAxis = normalize(subtractVectors(cameraPosition, target));\n    var xAxis = normalize(cross(up, zAxis));\n    var yAxis = normalize(cross(zAxis, xAxis));\n\n    return [\n      xAxis[0],\n      xAxis[1],\n      xAxis[2],\n      0,\n      yAxis[0],\n      yAxis[1],\n      yAxis[2],\n      0,\n      zAxis[0],\n      zAxis[1],\n      zAxis[2],\n      0,\n      cameraPosition[0],\n      cameraPosition[1],\n      cameraPosition[2],\n      1\n    ];\n  }\n};`, `11432164641139230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> m4 <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">lookAt</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cameraPosition<span class="token punctuation">,</span> target<span class="token punctuation">,</span> up</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> zAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">subtractVectors</span><span class="token punctuation">(</span>cameraPosition<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> xAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>up<span class="token punctuation">,</span> zAxis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> yAxis <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span>zAxis<span class="token punctuation">,</span> xAxis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      xAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      yAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      zAxis<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">0</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      cameraPosition<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      <span class="token number">1</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是在移动过程中朝向某个确切的 ‘F’ 的用法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31211397520566830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\n// 计算第一个 F 的位置\nvar fPosition = [radius, 0, 0];\n\n// 计算相机在圆上的位置矩阵\nvar cameraMatrix = m4.yRotation(cameraAngleRadians);\ncameraMatrix = m4.translate(cameraMatrix, 0, 0, radius * 1.5);\n\n// 获得矩阵中相机的位置\nvar cameraPosition = [cameraMatrix[12], cameraMatrix[13], cameraMatrix[14]];\n\nvar up = [0, 1, 0];\n\n// 计算相机的朝向矩阵\nvar cameraMatrix = m4.lookAt(cameraPosition, fPosition, up);\n\n// 通过相机矩阵获得视图矩阵\nvar viewMatrix = m4.inverse(cameraMatrix);\n\n// ...`, `31211397520566830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token comment">// 计算第一个 F 的位置</span>\n<span class="token keyword">var</span> fPosition <span class="token operator">=</span> <span class="token punctuation">[</span>radius<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机在圆上的位置矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">yRotation</span><span class="token punctuation">(</span>cameraAngleRadians<span class="token punctuation">)</span><span class="token punctuation">;</span>\ncameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> radius <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获得矩阵中相机的位置</span>\n<span class="token keyword">var</span> cameraPosition <span class="token operator">=</span> <span class="token punctuation">[</span>cameraMatrix<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cameraMatrix<span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cameraMatrix<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> up <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 计算相机的朝向矩阵</span>\n<span class="token keyword">var</span> cameraMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span>cameraPosition<span class="token punctuation">,</span> fPosition<span class="token punctuation">,</span> up<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 通过相机矩阵获得视图矩阵</span>\n<span class="token keyword">var</span> viewMatrix <span class="token operator">=</span> m4<span class="token punctuation">.</span><span class="token function">inverse</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/9uxqkz?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera-look-at](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera-look-at?view=preview) -->\n<p>拖动滑块观察相机是如何追踪单个 ‘F’ 的。</p>\n<p>你也可以对其他东西使用 lookAt 方法而不只是相机。通常是让角色视线跟着某人，将炮塔指向目标，让物体沿着路径移动。你可以算出物体当前在路径上的位置和不久后的位置，然后将这两个值放入 lookAt 方法，可以让物体沿着路径移动并且朝着路径的方向。</p>\n<h2 id="lookat-标准"><a href="#lookat-%E6%A0%87%E5%87%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>lookAt 标准</h2>\n<p>大多数三维数学库都有 lookAt 方法，通常它是用于计算 <code class="language-text">视图矩阵</code> 而不是 <code class="language-text">相机矩阵</code>。换句话说这个矩阵将所有物体移动到相机前而不是将相机移动到物体前。</p>\n<p>我发现它并不好用，前面指出一个 lookAt 方法有很多用处，当你需要视图矩阵的时候只需要调用 inverse 方法，但当你想要让角色跟随另一个角色或者炮台跟随目标的时候，在我看来 lookAt 方法返回世界坐标中的朝向和位置转换会好一些。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/51gr6f?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-3d-camera-look-at-heads](embedded-codesandbox://webgl-fundamental-3d/webgl-3d-camera-look-at-heads?view=preview) -->',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——三维/index.md absPath of file >>> MarkdownRemark",timeToRead:16,frontmatter:{date:"2022-05-16 11:31:23",path:"/webgl-fundamental-3d/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——三维",draft:null}},{excerpt:"WebGL 图像处理 在 WebGL 中绘制图片需要使用纹理。和 WebGL 渲染时需要裁剪空间坐标相似，渲染纹理时需要纹理坐标，而不是像素坐标。无论纹理是什么尺寸，纹理坐标范围始终是 0.0 到 1.0 。 因为我们只用画一个矩形（其实是两个三角形），所以需要告诉 WebGL 矩形中每个顶点对应的纹理坐标。我们将使用一种特殊的叫做 varying 的变量将纹理坐标从顶点着色器传到片断着色器，它叫做“可变量” 是因为它的值有很多个，WebGL…",html:'<h1 id="webgl-图像处理"><a href="#webgl-%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 图像处理</h1>\n<p>在 WebGL 中绘制图片需要使用纹理。和 WebGL 渲染时需要裁剪空间坐标相似，渲染纹理时需要纹理坐标，而不是像素坐标。无论纹理是什么尺寸，纹理坐标范围始终是 0.0 到 1.0 。</p>\n<p>因为我们只用画一个矩形（其实是两个三角形），所以需要告诉 WebGL 矩形中每个顶点对应的纹理坐标。我们将使用一种特殊的叫做 varying 的变量将纹理坐标从顶点着色器传到片断着色器，它叫做“可变量” 是因为它的值有很多个，WebGL 会用顶点着色器中值的进行插值，然后传给对应像素执行的片断着色器。</p>\n<p>接着用顶点着色器，我们需要添加一个属性，用它接收纹理坐标然后传给片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27746421209119610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec2 a_texCoord;\n// ...\nvarying vec2 v_texCoord;\n\nvoid main() {\n   // ...\n   // 将纹理坐标传给片断着色器\n   // GPU 会在点之间进行插值\n   v_texCoord = a_texCoord;\n}`, `27746421209119610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_texCoord<span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec2</span> v_texCoord<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// ...</span>\n   <span class="token comment">// 将纹理坐标传给片断着色器</span>\n   <span class="token comment">// GPU 会在点之间进行插值</span>\n   v_texCoord <span class="token operator">=</span> a_texCoord<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后用片断着色器寻找纹理上对应的颜色</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37207870231000320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n\n   // 从顶点着色器传入的纹理坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      // 在纹理上寻找对应颜色值\n      gl_FragColor = texture2D(u_image, v_texCoord);\n   }\n</script>`, `37207870231000320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的纹理坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 在纹理上寻找对应颜色值</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后我们需要加载一个图像，创建一个纹理然后将图像复制到纹理中。由于浏览器中的图片是异步加载的，所以我们需要重新组织一下代码，等待纹理加载，一旦加载完成就开始绘制。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79376224220242070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function main() {\n  var image = new Image();\n  image.src = \'http://someimage/on/our/server\'; // 必须在同一域名下\n  image.onload = function() {\n    render(image);\n  };\n}\n\nfunction render(image) {\n  // ...\n  // 之前的代码\n  // ...\n  // 找到纹理的地址\n  var texCoordLocation = gl.getAttribLocation(program, \'a_texCoord\');\n\n  // 给矩形提供纹理坐标\n  var texCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0]),\n    gl.STATIC_DRAW\n  );\n  gl.enableVertexAttribArray(texCoordLocation);\n  gl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 0, 0);\n\n  // 创建纹理\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  // 设置参数，让我们可以绘制任何尺寸的图像\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n  // 将图像上传到纹理\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  // ...\n}`, `79376224220242070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'http://someimage/on/our/server\'</span><span class="token punctuation">;</span> <span class="token comment">// 必须在同一域名下</span>\n  image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">render</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 之前的代码</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 找到纹理的地址</span>\n  <span class="token keyword">var</span> texCoordLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_texCoord\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 给矩形提供纹理坐标</span>\n  <span class="token keyword">var</span> texCoordBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> texCoordBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>texCoordLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>texCoordLocation<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 创建纹理</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置参数，让我们可以绘制任何尺寸的图像</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 将图像上传到纹理</span>\n  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是 WebGL 绘制的图像。注意：如果你想在本地运行，需要使用一个简单的 web 服务，使得 WebGL 可以加载本地图片。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/8f3085?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>这个图片没什么特别的，让我们来对它进行一些操作。把红和蓝调换位置如何？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44696938620978480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\ngl_FragColor = texture2D(u_image, v_texCoord).bgra;\n// ...`, `44696938620978480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// ...</span>\ngl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span><span class="token punctuation">.</span>bgra<span class="token punctuation">;</span>\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>现在红色和蓝色调换位置了。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/0gxj1r?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>如果我们的图像处理需要其他像素的颜色值怎么办？由于 WebGL 的纹理坐标范围是 0.0 到 1.0，那我们可以简单计算出移动一个像素对应的距离，onePixel = 1.0 / textureSize。</p>\n<p>这个片断着色器将每个像素的值设置为与左右像素的均值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53508426301322730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n   uniform vec2 u_textureSize;\n\n   // 从顶点着色器传入的像素坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      // 计算 1 像素对应的纹理坐标\n      vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\n      // 对左中右像素求均值\n      gl_FragColor = (\n         texture2D(u_image, v_texCoord) +\n         texture2D(u_image, v_texCoord + vec2(onePixel.x, 0.0)) +\n         texture2D(u_image, v_texCoord + vec2(-onePixel.x, 0.0))\n      ) / 3.0;\n   }\n</script>`, `53508426301322730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n   uniform vec2 u_textureSize<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的像素坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 计算 1 像素对应的纹理坐标</span>\n      vec2 onePixel <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> u_textureSize<span class="token punctuation">;</span>\n\n      <span class="token comment">// 对左中右像素求均值</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token punctuation">(</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord<span class="token punctuation">)</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> <span class="token function">vec2</span><span class="token punctuation">(</span>onePixel<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span>onePixel<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3.0</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们需要在 JavaScript 中传入纹理的大小。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12241029079222864000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\nvar textureSizeLocation = gl.getUniformLocation(program, \'u_textureSize\');\n\n// ...\n\n// 设置图像的大小\ngl.uniform2f(textureSizeLocation, image.width, image.height);\n\n// ...`, `12241029079222864000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> textureSizeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_textureSize\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置图像的大小</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>textureSizeLocation<span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以和上方没有模糊处理的图片对比一下。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nrpkhw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>知道了怎么获取像素值，现在我们来做一些图片处理常用的卷积内核。在这个例子中我们将使用 3×3 的内核，卷积内核就是一个 3×3 的矩阵，矩阵中的每一项代表当前处理的像素和周围 8 个像素的乘法因子，相乘后将结果加起来除以内核权重（内核中所有值的和或 1.0，取二者中较大者），这有一个不错的<a href="https://docs.gimp.org/2.6/en/plug-in-convmatrix.html" target="_blank" rel="nofollow noreferrer noopener">相关文章</a>，这里是 C++ 实现的一些<a href="https://www.codeproject.com/KB/graphics/ImageConvolution.aspx" target="_blank" rel="nofollow noreferrer noopener">具体代码</a>。</p>\n<p>我们将在片断着色器中计算卷积，所以创建一个新的片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50568343042553760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;x-shader/x-fragment&quot;>\n   precision mediump float;\n\n   // 纹理\n   uniform sampler2D u_image;\n   uniform vec2 u_textureSize;\n   uniform float u_kernel[9];\n   uniform float u_kernelWeight;\n\n   // 从顶点着色器传入的纹理坐标\n   varying vec2 v_texCoord;\n\n   void main() {\n      vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n      vec4 colorSum =\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, -1)) * u_kernel[0] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, -1)) * u_kernel[1] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, -1)) * u_kernel[2] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, 0)) * u_kernel[3] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, 0)) * u_kernel[4] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, 0)) * u_kernel[5] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(-1, 1)) * u_kernel[6] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(0, 1)) * u_kernel[7] +\n         texture2D(u_image, v_texCoord + onePixel * vec2(1, 1)) * u_kernel[8];\n\n      // 只把 rgb 值求和除以权重\n      // 将阿尔法值设为 1.0\n      gl_FragColor = vec4((colorSum / u_kernelWeight).rgb, 1.0);\n   }\n</script>`, `50568343042553760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"fragment-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-fragment"</span><span class="token operator">></span>\n   precision mediump float<span class="token punctuation">;</span>\n\n   <span class="token comment">// 纹理</span>\n   uniform sampler2D u_image<span class="token punctuation">;</span>\n   uniform vec2 u_textureSize<span class="token punctuation">;</span>\n   uniform float u_kernel<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   uniform float u_kernelWeight<span class="token punctuation">;</span>\n\n   <span class="token comment">// 从顶点着色器传入的纹理坐标</span>\n   varying vec2 v_texCoord<span class="token punctuation">;</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      vec2 onePixel <span class="token operator">=</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> u_textureSize<span class="token punctuation">;</span>\n      vec4 colorSum <span class="token operator">=</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">+</span>\n         <span class="token function">texture2D</span><span class="token punctuation">(</span>u_image<span class="token punctuation">,</span> v_texCoord <span class="token operator">+</span> onePixel <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> u_kernel<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 只把 rgb 值求和除以权重</span>\n      <span class="token comment">// 将阿尔法值设为 1.0</span>\n      gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>colorSum <span class="token operator">/</span> u_kernelWeight<span class="token punctuation">)</span><span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 JavaScript 中我们需要提供卷积内核和它的权重</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49847735285402050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function computeKernelWeight(kernel) {\n  var weight = kernel.reduce(function(prev, curr) {\n    return prev + curr;\n  });\n  return weight <= 0 ? 1 : weight;\n}\n\n// ...\nvar kernelLocation = gl.getUniformLocation(program, \'u_kernel[0]\');\nvar kernelWeightLocation = gl.getUniformLocation(program, \'u_kernelWeight\');\n// ...\nvar edgeDetectKernel = [-1, -1, -1, -1, 8, -1, -1, -1, -1];\n\ngl.uniform1fv(kernelLocation, edgeDetectKernel);\ngl.uniform1f(kernelWeightLocation, computeKernelWeight(edgeDetectKernel));\n// ...`, `49847735285402050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">computeKernelWeight</span><span class="token punctuation">(</span><span class="token parameter">kernel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> weight <span class="token operator">=</span> kernel<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> curr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> prev <span class="token operator">+</span> curr<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> weight <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> weight<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> kernelLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_kernel[0]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> kernelWeightLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_kernelWeight\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">var</span> edgeDetectKernel <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>kernelLocation<span class="token punctuation">,</span> edgeDetectKernel<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>kernelWeightLocation<span class="token punctuation">,</span> <span class="token function">computeKernelWeight</span><span class="token punctuation">(</span>edgeDetectKernel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>看！可以用下拉菜单选择不同的卷积内核。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/drq261?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="为什么-u_image-没有设置还能正常运行？"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-u_image-%E6%B2%A1%E6%9C%89%E8%AE%BE%E7%BD%AE%E8%BF%98%E8%83%BD%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么 u_image 没有设置还能正常运行？</h2>\n<p>全局变量默认为 0 所以 <code class="language-text">u_image</code> 默认使用纹理单元 0。纹理单元 0 默认为当前活跃纹理，所以调用 bindTexture 会将纹理绑定到单元 0。</p>\n<p>WebGL 有一个纹理单元队列，每个 sampler 全局变量的值对应着一个纹理单元，它会从对应的单元寻找纹理数据，你可以将纹理设置到你想用的纹理单元。</p>\n<p>例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69642189440431860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var textureUnitIndex = 6; // 用单元 6\nvar u_imageLoc = gl.getUniformLocation(program, \'u_image\');\ngl.uniform1i(u_imageLoc, textureUnitIndex);`, `69642189440431860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> textureUnitIndex <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 用单元 6</span>\n<span class="token keyword">var</span> u_imageLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_image\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>u_imageLoc<span class="token punctuation">,</span> textureUnitIndex<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>为了将纹理设置在不同的单元你可以调用 gl.activeTexture。 例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21141631492984760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绑定纹理到单元 6\ngl.activeTexture(gl.TEXTURE6);\ngl.bindTexture(gl.TEXTURE_2D, someTexture);`, `21141631492984760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绑定纹理到单元 6</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> someTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这样也可以</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44353564682691310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var textureUnitIndex = 6; // 使用纹理单元 6\n// 绑定纹理到单元 6\ngl.activeTexture(gl.TEXTURE0 + textureUnitIndex);\ngl.bindTexture(gl.TEXTURE_2D, someTexture);`, `44353564682691310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> textureUnitIndex <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 使用纹理单元 6</span>\n<span class="token comment">// 绑定纹理到单元 6</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span> <span class="token operator">+</span> textureUnitIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> someTexture<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所有支持 WebGL 的环境，在片断着色器中至少有 8 个纹理单元，顶点着色器中可以是 0 个。所以如果你使用超过 8 个纹理单元就应该调用 <code class="language-text">gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)</code> 查看单元个数，或者调用 <code class="language-text">gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)</code> 查看顶点着色器中可以用几个纹理单元。超过 99% 的机器在顶点着色器中至少有 4 个纹理单元。</p>\n<h2 id="在-glsl-中为什么变量的前缀都是-a_-u_-或-v_？"><a href="#%E5%9C%A8-glsl-%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%98%E9%87%8F%E7%9A%84%E5%89%8D%E7%BC%80%E9%83%BD%E6%98%AF-a_-u_-%E6%88%96-v_%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 GLSL 中为什么变量的前缀都是 <code class="language-text">a_</code>, <code class="language-text">u_</code> 或 <code class="language-text">v_</code>？</h2>\n<p>那只是一个命名约定，不是强制要求的。但是对我来说可以轻松通过名字知道值从哪里来，<code class="language-text">a_</code> 代表属性，值从缓冲中提供；<code class="language-text">u_</code> 代表全局变量，直接对着色器设置；<code class="language-text">v_</code> 代表可变量，是从顶点着色器的顶点中插值来出来的</p>\n<h1 id="webgl-进一步处理图像"><a href="#webgl-%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%A4%84%E7%90%86%E5%9B%BE%E5%83%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 进一步处理图像</h1>\n<p>图像处理的下一个问题是如何同时施加多种效果？</p>\n<p>当然，你可以试着在运行时创建着色器，根据用户从交互界面选择的一些效果，创建一个可以全部实现的着色器。尽管有人用过<a href="https://www.youtube.com/watch?v=cQUn0Zeh-0Q" target="_blank" rel="nofollow noreferrer noopener">在运行时创建渲染效果</a>，但是大部分情况下是不适合的。</p>\n<p>一个更灵活的方式是使用 2 个或以上的纹理，然后交替渲染它们，像乒乓球一样每次渲染一种效果，传给另一个渲染下一个效果，如下所示。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24139618903962014000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`原始图像    -> [模糊]     -> 纹理 1\n纹理 1      -> [锐化]     -> 纹理 2\n纹理 2      -> [边缘检测] -> 纹理 1\n纹理 1      -> [模糊]     -> 纹理 2\n纹理 2      -> [平滑]     -> 画布`, `24139618903962014000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">原始图像    -&gt; [模糊]     -&gt; 纹理 1\n纹理 1      -&gt; [锐化]     -&gt; 纹理 2\n纹理 2      -&gt; [边缘检测] -&gt; 纹理 1\n纹理 1      -&gt; [模糊]     -&gt; 纹理 2\n纹理 2      -&gt; [平滑]     -&gt; 画布</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个操作需要使用帧缓冲来实现。在 WebGL 和 OpenGL 中，帧缓冲事实上是一个糟糕的名字。WebGL/OpenGL 中的帧缓冲只是一系列状态（一列附加物）不是任何形式的缓冲。但是当我们给帧缓冲绑定一个纹理后，可以将渲染结果写入那个纹理。</p>\n<p>首先让我们把以前创建纹理的代码写到一个方法里</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50850805189350500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createAndSetupTexture(gl) {\n  var texture = gl.createTexture();\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  // 设置材质，这样我们可以对任意大小的图像进行像素操作\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n  return texture;\n}\n\n// 创建一个纹理并写入图像\nvar originalImageTexture = createAndSetupTexture(gl);\ngl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);`, `50850805189350500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置材质，这样我们可以对任意大小的图像进行像素操作</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_S</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_WRAP_T</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">CLAMP_TO_EDGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MAG_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">NEAREST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> texture<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 创建一个纹理并写入图像</span>\n<span class="token keyword">var</span> originalImageTexture <span class="token operator">=</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让我们用这个方法生成两个纹理并绑定到两个帧缓冲。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35842512998593890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建两个纹理绑定到帧缓冲\nvar textures = [];\nvar framebuffers = [];\nfor (var ii = 0; ii < 2; ++ii) {\n  var texture = createAndSetupTexture(gl);\n  textures.push(texture);\n\n  // 设置纹理大小和图像大小一致\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, image.width, image.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n  // 创建一个帧缓冲\n  var fbo = gl.createFramebuffer();\n  framebuffers.push(fbo);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n\n  // 绑定纹理到帧缓冲\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n}`, `35842512998593890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建两个纹理绑定到帧缓冲</span>\n<span class="token keyword">var</span> textures <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> framebuffers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> texture <span class="token operator">=</span> <span class="token function">createAndSetupTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  textures<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>texture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 设置纹理大小和图像大小一致</span>\n  gl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 创建一个帧缓冲</span>\n  <span class="token keyword">var</span> fbo <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createFramebuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  framebuffers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 绑定纹理到帧缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">framebufferTexture2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COLOR_ATTACHMENT0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> texture<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在让我们做一些卷积核并按使用顺序存入列表中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1304448879701647400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义一些卷积核\nvar kernels = {\n  normal: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n  gaussianBlur: [0.045, 0.122, 0.045, 0.122, 0.332, 0.122, 0.045, 0.122, 0.045],\n  unsharpen: [-1, -1, -1, -1, 9, -1, -1, -1, -1],\n  emboss: [-2, -1, 0, -1, 1, 1, 0, 1, 2]\n};\n\n// 将要使用的效果列表\nvar effectsToApply = [\'gaussianBlur\', \'emboss\', \'gaussianBlur\', \'unsharpen\'];`, `1304448879701647400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 定义一些卷积核</span>\n<span class="token keyword">var</span> kernels <span class="token operator">=</span> <span class="token punctuation">{</span>\n  normal<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  gaussianBlur<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.332</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">,</span> <span class="token number">0.122</span><span class="token punctuation">,</span> <span class="token number">0.045</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  unsharpen<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  emboss<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 将要使用的效果列表</span>\n<span class="token keyword">var</span> effectsToApply <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'gaussianBlur\'</span><span class="token punctuation">,</span> <span class="token string">\'emboss\'</span><span class="token punctuation">,</span> <span class="token string">\'gaussianBlur\'</span><span class="token punctuation">,</span> <span class="token string">\'unsharpen\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后让我们使用所有渲染效果，像乒乓一样来回渲染</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3033514399942860300"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 从原始图像开始\ngl.bindTexture(gl.TEXTURE_2D, originalImageTexture);\n\n// 在渲染效果时不翻转 y 轴\ngl.uniform1f(flipYLocation, 1);\n\n// 循环施加每一种渲染效果\nfor (var ii = 0; ii < effectsToApply.length; ++ii) {\n  // 使用两个帧缓冲中的一个\n  setFramebuffer(framebuffers[ii % 2], image.width, image.height);\n\n  drawWithKernel(effectsToApply[ii]);\n\n  // 下次绘制时使用刚才的渲染结果\n  gl.bindTexture(gl.TEXTURE_2D, textures[ii % 2]);\n}\n\n// 最后将结果绘制到画布\ngl.uniform1f(flipYLocation, -1); // 需要绕 y 轴翻转\nsetFramebuffer(null, canvas.width, canvas.height);\ndrawWithKernel(\'normal\');\n\nfunction setFramebuffer(fbo, width, height) {\n  // 设定当前使用帧缓冲\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n\n  // 告诉着色器分辨率是多少\n  gl.uniform2f(resolutionLocation, width, height);\n\n  // 告诉 WebGL 帧缓冲需要的视图大小\n  gl.viewport(0, 0, width, height);\n}\n\nfunction drawWithKernel(name) {\n  // 设置卷积核\n  gl.uniform1fv(kernelLocation, kernels[name]);\n\n  // 画出矩形\n  gl.drawArrays(gl.TRIANGLES, 0, 6);\n}`, `3033514399942860300`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 从原始图像开始</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> originalImageTexture<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 在渲染效果时不翻转 y 轴</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 循环施加每一种渲染效果</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> effectsToApply<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 使用两个帧缓冲中的一个</span>\n  <span class="token function">setFramebuffer</span><span class="token punctuation">(</span>framebuffers<span class="token punctuation">[</span>ii <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">drawWithKernel</span><span class="token punctuation">(</span>effectsToApply<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 下次绘制时使用刚才的渲染结果</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> textures<span class="token punctuation">[</span>ii <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 最后将结果绘制到画布</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 需要绕 y 轴翻转</span>\n<span class="token function">setFramebuffer</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">drawWithKernel</span><span class="token punctuation">(</span><span class="token string">\'normal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">setFramebuffer</span><span class="token punctuation">(</span><span class="token parameter">fbo<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设定当前使用帧缓冲</span>\n  gl<span class="token punctuation">.</span><span class="token function">bindFramebuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">FRAMEBUFFER</span><span class="token punctuation">,</span> fbo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 告诉着色器分辨率是多少</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionLocation<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 告诉 WebGL 帧缓冲需要的视图大小</span>\n  gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">drawWithKernel</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设置卷积核</span>\n  gl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>kernelLocation<span class="token punctuation">,</span> kernels<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 画出矩形</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面是一个可交互示例，用了稍微灵活一点的用户交互。勾选表示开启对应效果，拖拽改变渲染顺序。</p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/1f3ywc?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>有些东西需要回顾一下。</p>\n<p>调用 gl.bindFramebuffer 设置为 null 是告诉 WebGL 你想在画布上绘制，而不是在帧缓冲上。</p>\n<p>WebGL 需要从裁剪空间对应到屏幕像素，设置 gl.viewport 就是为了实现这个。因为我们的帧缓冲的大小和画布的大小不同，所以我们需要给帧缓冲设置一个合适的视图大小让它渲染到对应的纹理上，最后再渲染到画布上。</p>\n<p>原例中，我们在渲染时绕 y 轴翻转是因为 WebGL 的 0, 0 点在左下角而不是常见二维屏幕坐标的左上角。而在帧缓冲中绘制的时候不需要翻转，因为帧缓冲不用显示，谁上谁下无所谓，最重要的是我们计算中的 0, 0 也对应帧缓冲中的 0, 0 像素。为了解决这个问题，通过在着色器中添加一个输入来决定是否翻转。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85427668439947180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;x-shader/x-vertex&quot;>\n   // ...\n   uniform float u_flipY;\n   // ...\n\n   void main() {\n      // ...\n\n      gl_Position = vec4(clipSpace * vec2(1, u_flipY), 0, 1);\n\n      // ...\n   }\n</script>`, `85427668439947180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>script id<span class="token operator">=</span><span class="token string">"vertex-shader-2d"</span> type<span class="token operator">=</span><span class="token string">"x-shader/x-vertex"</span><span class="token operator">></span>\n   <span class="token comment">// ...</span>\n   uniform float u_flipY<span class="token punctuation">;</span>\n   <span class="token comment">// ...</span>\n\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...</span>\n\n      gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> u_flipY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// ...</span>\n   <span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在渲染的时候可以这样设置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47890027256641330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ...\n\nvar flipYLocation = gl.getUniformLocation(program, \'u_flipY\');\n\n// ...\n\n// 不翻转\ngl.uniform1f(flipYLocation, 1);\n\n// ...\n\n// 翻转\ngl.uniform1f(flipYLocation, -1);`, `47890027256641330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ...</span>\n\n<span class="token keyword">var</span> flipYLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_flipY\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 不翻转</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 翻转</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>flipYLocation<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>为了让这个例子简单化，我只用了一个 GLSL 实现了多种渲染效果。如果专做图像处理可能需要多个 GLSL 程序，一个调节色彩、饱和度和明度，一个调节亮度和对比度，一个做反色，一个做色彩平衡，等等。你需要用代码更换 GLSL 程序，并更新程序对应的参数。我想过写一个类似的例子，但最好留给读者自己实现，因为多个 GLSL 程序和参数需要良好的重构，不然代码会一团糟，所以它是一个很好的练习机会。</p>\n<p>希望这个和之前的例子让你更了解 WebGL，从二维开始讲解是希望你更有利于对 WebGL 的理解。如果有时间我会试着写一些关于如何实现三维效果的文章，讲一些一些关于 WebGL 的底层原理和细节。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——图像处理/index.md absPath of file >>> MarkdownRemark",timeToRead:8,frontmatter:{date:"2022-04-29 11:05:21",path:"/webgl-fundamental-image-processing/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——图像处理",draft:null}},{excerpt:"基础概念 背景 WebGL 经常被当成 3D API，人们总想“我可以使用 WebGL 和一些神奇的东西做出炫酷的 3D 作品”。事实上 WebGL 仅仅是一个光栅化引擎，它可以根据你的代码绘制出点，线和三角形。想要利用 WebGL 完成更复杂任务，取决于你能否提供合适的代码，组合使用点，线和三角形代替实现。 WebGL 在电脑的 GPU 中运行。因此你需要使用能够在 GPU 上运行的代码。这样的代码需要提供成对的方法。每对方法中一个叫顶点着色器，另一个叫片断着色器，并且使用一种和 C 或 C…",html:'<h1 id="基础概念"><a href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基础概念</h1>\n<h2 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h2>\n<p>WebGL 经常被当成 3D API，人们总想“我可以使用 WebGL 和一些神奇的东西做出炫酷的 3D 作品”。事实上 WebGL 仅仅是一个光栅化引擎，它可以根据你的代码绘制出点，线和三角形。想要利用 WebGL 完成更复杂任务，取决于你能否提供合适的代码，组合使用点，线和三角形代替实现。</p>\n<p>WebGL 在电脑的 GPU 中运行。因此你需要使用能够在 GPU 上运行的代码。这样的代码需要提供成对的方法。每对方法中一个叫顶点着色器，另一个叫片断着色器，并且使用一种和 C 或 C++ 类似的强类型的语言 GLSL（GL 着色语言），每一对组合起来称作一个 program（着色程序）。</p>\n<p>顶点着色器的作用是计算顶点的位置。根据计算出的一系列顶点位置，WebGL 可以对点，线和三角形在内的一些图元进行光栅化处理。当对这些图元进行光栅化处理时需要使用片断着色器方法。片断着色器的作用是计算出当前绘制图元中每个像素的颜色值。</p>\n<p>几乎整个 WebGL API 都是关于如何设置这些成对方法的状态值以及运行它们。对于想要绘制的每一个对象，都需要先设置一系列状态值，然后通过调用 gl.drawArrays 或 gl.drawElements 运行一个着色方法对，使得你的着色器对能够在 GPU 上运行。</p>\n<p>这些方法对所需的任何数据都需要发送到 GPU，这里有着色器获取数据的 4 种方法。</p>\n<h3 id="属性（attributes）和缓冲"><a href="#%E5%B1%9E%E6%80%A7%EF%BC%88attributes%EF%BC%89%E5%92%8C%E7%BC%93%E5%86%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>属性（Attributes）和缓冲</h3>\n<p>缓冲是发送到 GPU 的一些二进制数据序列，通常情况下缓冲数据包括位置，法向量，纹理坐标，顶点颜色值等。你可以存储任何数据。</p>\n<p>属性用来指明怎么从缓冲中获取所需数据并将它提供给顶点着色器。例如你可能在缓冲中用三个 32 位的浮点型数据存储一个位置值。对于一个确切的属性你需要告诉它从哪个缓冲中获取数据，获取什么类型的数据（三个 32 位的浮点数据），起始偏移值是多少，到下一个位置的字节数是多少。</p>\n<p>缓冲不是随意读取的。事实上顶点着色器运行的次数是一个指定的确切数字，每一次运行属性会从指定的缓冲中按照指定规则依次获取下一个值。</p>\n<h3 id="全局变量（uniforms）"><a href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%88uniforms%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全局变量（Uniforms）</h3>\n<p>全局变量在着色程序运行前赋值，在运行过程中全局有效。</p>\n<h3 id="纹理（textures）"><a href="#%E7%BA%B9%E7%90%86%EF%BC%88textures%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纹理（Textures）</h3>\n<p>纹理是一个数据序列，可以在着色程序运行中随意读取其中的数据。大多数情况存放的是图像数据，但是纹理仅仅是数据序列，你也可以随意存放除了颜色数据以外的其它数据。</p>\n<h3 id="可变量（varyings）"><a href="#%E5%8F%AF%E5%8F%98%E9%87%8F%EF%BC%88varyings%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可变量（Varyings）</h3>\n<p>可变量是一种顶点着色器给片断着色器传值的方式，依照渲染的图元是点，线还是三角形，顶点着色器中设置的可变量会在片断着色器运行中获取不同的插值。</p>\n<h2 id="hello-world"><a href="#hello-world" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hello World</h2>\n<p>WebGL 只关心两件事：裁剪空间中的坐标值和颜色值。使用 WebGL 只需要给它提供这两个东西。你需要提供两个着色器来做这两件事，一个顶点着色器提供裁剪空间坐标值，一个片断着色器提供颜色值。</p>\n<p>无论你的画布有多大，裁剪空间的坐标范围永远是 -1 到 1。这里有一个简单的 WebGL 例子展示 WebGL 的简单用法。</p>\n<p>让我们从顶点着色器开始</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53634055987757875000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 一个属性值，将会从缓冲中获取数据\nattribute vec4 a_position;\n\n// 所有着色器都有一个 main 方法\nvoid main() {\n\n  // gl_Position 是一个顶点着色器主要设置的变量\n  gl_Position = a_position;\n}`, `53634055987757875000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 一个属性值，将会从缓冲中获取数据</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token comment">// 所有着色器都有一个 main 方法</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n  <span class="token comment">// gl_Position 是一个顶点着色器主要设置的变量</span>\n  gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果用 JavaScript 代替 GLSL，当它运行的时候，你可以想象它做了类似以下的事情</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93284093453740980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 伪代码\nvar positionBuffer = [0, 0, 0, 0, 0, 0.5, 0, 0, 0.7, 0, 0, 0];\nvar attributes = {};\nvar gl_Position;\n\nfunction drawArrays(_, offset, count) {\n  var stride = 4;\n  var size = 4;\n  for (var i = 0; i < count; ++i) {\n    // 从 positionBuffer 复制接下来 4 个值给 a_position 属性\n    const start = offset + i * stride;\n    attributes.a_position = positionBuffer.slice(start, start + size);\n    runVertexShader(); // 运行顶点着色器\n    // ...\n    doSomethingWith_gl_Position();\n  }\n}`, `93284093453740980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 伪代码</span>\n<span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> attributes <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> gl_Position<span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">drawArrays</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 从 positionBuffer 复制接下来 4 个值给 a_position 属性</span>\n    <span class="token keyword">const</span> start <span class="token operator">=</span> offset <span class="token operator">+</span> i <span class="token operator">*</span> stride<span class="token punctuation">;</span>\n    attributes<span class="token punctuation">.</span>a_position <span class="token operator">=</span> positionBuffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> start <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">runVertexShader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 运行顶点着色器</span>\n    <span class="token comment">// ...</span>\n    <span class="token function">doSomethingWith_gl_Position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际情况没有那么简单，因为 positionBuffer 将会被转换成二进制数据（见下文），所以真实情况下从缓冲中读取数据有些麻烦，但是希望这个例子能够让你想象出顶点着色器是怎么执行的。</p>\n<p>接下来我们需要一个片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63926568802610210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 片断着色器没有默认精度，所以我们需要设置一个精度\n// mediump 是一个不错的默认值，代表 medium precision（中等精度）\nprecision mediump float;\n\nvoid main() {\n  // gl_FragColor 是一个片断着色器主要设置的变量\n  gl_FragColor = vec4(1, 0, 0.5, 1); // 返回“红紫色”\n}`, `63926568802610210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 片断着色器没有默认精度，所以我们需要设置一个精度</span>\n<span class="token comment">// mediump 是一个不错的默认值，代表 medium precision（中等精度）</span>\n<span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// gl_FragColor 是一个片断着色器主要设置的变量</span>\n  gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回“红紫色”</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上方我们设置 gl_FragColor 为 <code class="language-text">1, 0, 0.5, 1</code>，其中 1 代表红色值，0 代表绿色值，0.5 代表蓝色值，最后一个 1 表示阿尔法通道值。WebGL 中的颜色值范围从 0 到 1 。</p>\n<p>现在我们有了两个着色器方法，让我们开始使用 WebGL 吧</p>\n<p>首先我们需要一个 HTML 中的 canvas（画布）对象</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11405848427581567000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<canvas id=&quot;c&quot;></canvas>`, `11405848427581567000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后可以用 JavaScript 获取它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38346413532373980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.querySelector(\'#c\');`, `38346413532373980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们创建一个 WebGL 渲染上下文（WebGLRenderingContext）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53417350914250750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var gl = canvas.getContext(\'webgl\');\nif (!gl) {\n  // 你不能使用 WebGL！\n  // ...\n}`, `53417350914250750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 你不能使用 WebGL！</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们需要编译着色器对然后提交到 GPU，先让我们通过字符串获取它们。 你可以利用 JavaScript 中创建字符串的方式创建 GLSL 字符串：用串联的方式（concatenating），用 AJAX 下载，用多行模板数据。或者在这个例子里，将它们放在非 JavaScript 类型的标签中。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3545845984471007700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;notjs&quot;>\n\n  // 一个属性变量，将会从缓冲中获取数据\n  attribute vec4 a_position;\n\n  // 所有着色器都有一个 main 方法\n  void main() {\n\n    // gl_Position 是一个顶点着色器主要设置的变量\n    gl_Position = a_position;\n  }\n</script>\n\n<script id=&quot;fragment-shader-2d&quot; type=&quot;notjs&quot;>\n\n  // 片断着色器没有默认精度，所以我们需要设置一个精度\n  // mediump 是一个不错的默认值，代表 medium precision（中等精度）\n  precision mediump float;\n\n  void main() {\n    // gl_FragColor 是一个片断着色器主要设置的变量\n    gl_FragColor = vec4(1, 0, 0.5, 1); // 返回“红紫色”\n  }\n</script>`, `3545845984471007700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n  <span class="token comment">// 一个属性变量，将会从缓冲中获取数据</span>\n  attribute vec4 a_position<span class="token punctuation">;</span>\n\n  <span class="token comment">// 所有着色器都有一个 main 方法</span>\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n    <span class="token comment">// gl_Position 是一个顶点着色器主要设置的变量</span>\n    gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n  <span class="token comment">// 片断着色器没有默认精度，所以我们需要设置一个精度</span>\n  <span class="token comment">// mediump 是一个不错的默认值，代表 medium precision（中等精度）</span>\n  precision mediump float<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// gl_FragColor 是一个片断着色器主要设置的变量</span>\n    gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回“红紫色”</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>事实上，大多数三维引擎在运行时利用模板，串联等方式创建 GLSL。对于这个网站上的例子来说，没有复杂到要在运行时创建 GLSL 的程度。</p>\n<p>接下来我们使用的方法将会创建一个着色器，只需要上传 GLSL 数据，然后编译成着色器。你可能注意到这段代码没有任何注释，因为可以从方法名很清楚的了解方法的作用（这里作为翻译版本我还是稍微注释一下）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51236295421231580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建着色器方法，输入参数：渲染上下文，着色器类型，数据源\nfunction createShader(gl, type, source) {\n  var shader = gl.createShader(type); // 创建着色器对象\n  gl.shaderSource(shader, source); // 提供数据源\n  gl.compileShader(shader); // 编译 -> 生成着色器\n  var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n  if (success) {\n    return shader;\n  }\n\n  console.log(gl.getShaderInfoLog(shader));\n  gl.deleteShader(shader);\n}`, `51236295421231580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建着色器方法，输入参数：渲染上下文，着色器类型，数据源</span>\n<span class="token keyword">function</span> <span class="token function">createShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建着色器对象</span>\n  gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提供数据源</span>\n  gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 编译 -> 生成着色器</span>\n  <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COMPILE_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> shader<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们可以使用以上方法创建两个着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76045640224330020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var vertexShaderSource = document.querySelector(\'#vertex-shader-2d\').text;\nvar fragmentShaderSource = document.querySelector(\'#fragment-shader-2d\').text;\n\nvar vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);\nvar fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);`, `76045640224330020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#vertex-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n<span class="token keyword">var</span> fragmentShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#fragment-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> vertexShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vertexShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> fragmentShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fragmentShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后我们将这两个着色器 link（链接）到一个 program（着色程序）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97981640951656000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function createProgram(gl, vertexShader, fragmentShader) {\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader); // 添加顶点着色器\n  gl.attachShader(program, fragmentShader); // 添加片元着色器\n  gl.linkProgram(program); // 连接 program 中的着色器\n  var success = gl.getProgramParameter(program, gl.LINK_STATUS);\n  if (success) {\n    return program;\n  }\n\n  console.log(gl.getProgramInfoLog(program));\n  gl.deleteProgram(program);\n}`, `97981640951656000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加顶点着色器</span>\n  gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加片元着色器</span>\n  gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 连接 program 中的着色器</span>\n  <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINK_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> program<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后调用它</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4567911980381511700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var program = createProgram(gl, vertexShader, fragmentShader);`, `4567911980381511700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们已经在 GPU 上创建了一个 GLSL 着色程序，我们还需要给它提供数据。WebGL 的主要任务就是设置好状态并为 GLSL 着色程序提供数据。在这个例子中 GLSL 着色程序的唯一输入是一个属性值 a_position。我们要做的第一件事就是从刚才创建的 GLSL 着色程序中找到这个属性值所在的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44777874797656090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionAttributeLocation = gl.getAttribLocation(program, \'a_position\');`, `44777874797656090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>寻找属性值位置（和全局属性位置）应该在初始化的时候完成，而不是在渲染循环中。</p>\n<p>属性值从缓冲中获取数据，所以我们创建一个缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18207598143499325000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionBuffer = gl.createBuffer();`, `18207598143499325000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>WebGL 可以通过绑定点操控全局范围内的许多数据，你可以把绑定点想象成一个 WebGL 内部的全局变量。首先绑定一个数据源到绑定点，然后可以引用绑定点指向该数据源。所以让我们来绑定位置信息缓冲（下面的绑定点就是 ARRAY_BUFFER）。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18951885583344484000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);`, `18951885583344484000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在我们需要通过绑定点向缓冲中存放数据</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61475448099757000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 三个二维点坐标\nvar positions = [0, 0, 0, 0.5, 0.7, 0];\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);`, `61475448099757000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 三个二维点坐标</span>\n<span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这里完成了一系列事情，第一件事是我们有了一个 JavaScript 序列 positions。然而 WebGL 需要强类型数据，所以 <code class="language-text">new Float32Array(positions)</code> 创建了 32 位浮点型数据序列，并从 positions 中复制数据到序列中，然后 gl.bufferData 复制这些数据到 GPU 的 positionBuffer 对象上。它最终传递到 positionBuffer 上是因为在前一步中我们我们将它绑定到了 ARRAY_BUFFER（也就是绑定点）上。</p>\n<p>最后一个参数 <code class="language-text">gl.STATIC_DRAW</code> 是提示 WebGL 我们将怎么使用这些数据。WebGL 会根据提示做出一些优化。<code class="language-text">gl.STATIC_DRAW</code> 提示 WebGL 我们不会经常改变这些数据。</p>\n<p>在此之上的代码是初始化代码。这些代码在页面加载时只会运行一次。接下来的代码是渲染代码，而这些代码将在我们每次要渲染或者绘制时执行。</p>\n<h2 id="渲染"><a href="#%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染</h2>\n<p>在绘制之前我们应该调整画布（canvas）的尺寸以匹配它的显示尺寸。画布就像图片一样有两个尺寸。一个是它拥有的实际像素个数，另一个是它显示的大小。CSS 决定画布显示的大小。你应该尽可能用 CSS 设置所需画布大小，因为它比其它方式灵活的多。</p>\n<p>这里的例子中，有独立窗口显示的示例大多使用 400x300 像素大小的画布。但是如果像稍后展示的示例那样嵌在页面中，它就会被拉伸以填满可用空间。通过使用 CSS 调整画布尺寸可以轻松处理这些情况。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12363532677449250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`webglUtils.resizeCanvasToDisplaySize(gl.canvas);`, `12363532677449250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们需要告诉 WebGL 怎样把提供的 gl_Position 裁剪空间坐标对应到画布像素坐标，通常我们也把画布像素坐标叫做屏幕空间。为了实现这个目的，我们只需要调用 gl.viewport 方法并传递画布的当前尺寸。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83973656902297320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);`, `83973656902297320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这样就告诉 WebGL 裁剪空间的 -1 -> +1 分别对应到 x 轴的 0 -> gl.canvas.width 和 y 轴的 0 -> gl.canvas.height。</p>\n<p>我们用 <code class="language-text">0, 0, 0, 0</code> 清空画布，分别对应 r, g, b, alpha（红，绿，蓝，阿尔法）值，所以在这个例子中我们让画布变透明了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45033273293957780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 清空画布\ngl.clearColor(0, 0, 0, 0);\ngl.clear(gl.COLOR_BUFFER_BIT);`, `45033273293957780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 清空画布</span>\ngl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>我们需要告诉 WebGL 运行哪个着色程序</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96979077078906450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 告诉它用我们之前写好的着色程序（一个着色器对）\ngl.useProgram(program);`, `96979077078906450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 告诉它用我们之前写好的着色程序（一个着色器对）</span>\ngl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>接下来我们需要告诉 WebGL 怎么从我们之前准备的缓冲中获取数据给着色器中的属性。首先我们需要启用对应属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32366717620799590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(positionAttributeLocation);`, `32366717620799590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后指定从缓冲中读取数据的方式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86839967563231120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 将绑定点绑定到缓冲数据（positionBuffer）\ngl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n\n// 告诉属性怎么从 positionBuffer 中读取数据 (ARRAY_BUFFER)\nvar size = 2; // 每次迭代运行提取两个单位数据\nvar type = gl.FLOAT; // 每个单位的数据类型是 32 位浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动单位数量 * 每个单位占用内存（sizeof(type)）\n// 每次迭代运行运动多少内存到下一个数据开始点\nvar offset = 0; // 从缓冲起始位置开始读取\ngl.vertexAttribPointer(positionAttributeLocation, size, type, normalize, stride, offset);`, `86839967563231120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 将绑定点绑定到缓冲数据（positionBuffer）</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉属性怎么从 positionBuffer 中读取数据 (ARRAY_BUFFER)</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代运行提取两个单位数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 每个单位的数据类型是 32 位浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动单位数量 * 每个单位占用内存（sizeof(type)）</span>\n<span class="token comment">// 每次迭代运行运动多少内存到下一个数据开始点</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲起始位置开始读取</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个隐藏信息是 <code class="language-text">gl.vertexAttribPointer</code> 是将属性绑定到当前的 <code class="language-text">ARRAY_BUFFER</code>。换句话说就是属性绑定到了 positionBuffer 上。这也意味着现在利用绑定点随意将 <code class="language-text">ARRAY_BUFFER</code> 绑定到其它数据上后，该属性依然从 positionBuffer 上读取数据。</p>\n<p>从 GLSL 的顶点着色器中注意到 a_position 属性的数据类型是 vec4</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78142706191494960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;`, `78142706191494960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">attribute vec4 a_position;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>vec4 是一个有四个浮点数据的数据类型。在 JavaScript 中你可以把它想象成 <code class="language-text">a_position = {x: 0, y: 0, z: 0, w: 0}</code>。之前我们设置的 size = 2， 属性默认值是 <code class="language-text">0, 0, 0, 1</code>，然后属性将会从缓冲中获取前两个值（ x 和 y ）。z 和 w 还是默认值 0 和 1 。</p>\n<p>我们终于可以让 WebGL 运行我们的 GLSL 着色程序了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14970698648984637000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 3;\ngl.drawArrays(primitiveType, offset, count);`, `14970698648984637000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为 count = 3，所以顶点着色器将运行三次。第一次运行将会从位置缓冲中读取前两个值赋给属性值 <code class="language-text">a_position.x</code> 和 <code class="language-text">a_position.y</code>。第二次运行 <code class="language-text">a_position.x</code> 和 <code class="language-text">a_position.y</code> 将会被赋予后两个值，最后一次运行将被赋予最后两个值。</p>\n<p>因为我们设置 primitiveType（图元类型）为 <code class="language-text">gl.TRIANGLES</code>（三角形），顶点着色器每运行三次 WebGL 将会根据三个 gl_Position 值绘制一个三角形，不论我们的画布大小是多少，在裁剪空间中每个方向的坐标范围都是 -1 到 1。</p>\n<p>由于我们的顶点着色器仅仅是传递位置缓冲中的值给 gl_Position，所以三角形在裁剪空间中的坐标如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78611377661990030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`0, 0,\n0, 0.5,\n0.7, 0,`, `78611377661990030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">0, 0,\n0, 0.5,\n0.7, 0,</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>WebGL 将会把它们从裁剪空间转换到屏幕空间并在屏幕空间绘制一个三角形，如果画布大小是 400×300 我们会得到类似以下的转换</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96069593107249230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(` 裁剪空间            屏幕空间\n   0, 0       ->   200, 150\n   0, 0.5     ->   200, 225\n 0.7, 0       ->   340, 150`, `96069593107249230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text"> 裁剪空间            屏幕空间\n   0, 0       -&gt;   200, 150\n   0, 0.5     -&gt;   200, 225\n 0.7, 0       -&gt;   340, 150</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在 WebGL 将渲染出这个三角形。绘制每个像素时 WebGL 都将调用我们的片断着色器。我们的片断着色器只是简单设置 gl_FragColor 为 <code class="language-text">1, 0, 0.5, 1</code>， 由于画布的每个通道宽度为 8 位，这表示 WebGL 最终在画布上绘制<code class="language-text">[255, 0, 127, 255]</code>。</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// an attribute will receive data from a buffer</span>\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      <span class="token comment">// all shaders have a main function</span>\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n        <span class="token comment">// gl_Position is a special variable a vertex shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">function</span> <span class="token function">createShader</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> type<span class="token punctuation">,</span> source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> shader <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createShader</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">shaderSource</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">compileShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getShaderParameter</span><span class="token punctuation">(</span>shader<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">COMPILE_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> shader<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getShaderInfoLog</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">deleteShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> vertexShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">attachShader</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">linkProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> success <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getProgramParameter</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINK_STATUS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> program<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token function">getProgramInfoLog</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">deleteProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Get the strings for our GLSL shaders</span>\n        <span class="token keyword">var</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#vertex-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> fragmentShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#fragment-shader-2d\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">;</span>\n\n        <span class="token comment">// create GLSL shaders, upload the GLSL source, compile the shaders</span>\n        <span class="token keyword">var</span> vertexShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">VERTEX_SHADER</span><span class="token punctuation">,</span> vertexShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> fragmentShader <span class="token operator">=</span> <span class="token function">createShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FRAGMENT_SHADER</span><span class="token punctuation">,</span> fragmentShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Link the two shaders into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">createProgram</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShader<span class="token punctuation">,</span> fragmentShader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer and put three 2d clip space points in it</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// code above this line is initialization code.</span>\n        <span class="token comment">// code below this line is rendering code.</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>在上例中可以发现顶点着色器只是简单的传递了位置信息。由于位置数据坐标就是裁剪空间中的坐标，所以顶点着色器没有做什么特别的事。如果你想做三维渲染，你需要提供合适的着色器将三维坐标转换到裁剪空间坐标，因为 WebGL 只是一个光栅化 API。</p>\n<p>你可能会好奇为什么这个三角形从中间开始然后朝向右上方。裁剪空间的 x 坐标范围是 -1 到 +1. 这就意味着 0 在中间并且正值在它右边。</p>\n<p>至于它为什么在上方，是因为裁剪空间中 -1 是最底端 +1 是最顶端，这也意味值 0 在中间，正值在上方。</p>\n<p>对于描述二维空间中的物体，比起裁剪空间坐标你可能更希望使用屏幕像素坐标。所以我们来改造一下顶点着色器，让我们提供给它像素坐标而不是裁剪空间坐标。这是我们新的顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56571026129940760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;vertex-shader-2d&quot; type=&quot;notjs&quot;>\n  // attribute vec4 a_position;\n  attribute vec2 a_position;\n\n  uniform vec2 u_resolution;\n\n  void main() {\n    // 从像素坐标转换到 0.0 到 1.0\n    vec2 zeroToOne = a_position / u_resolution;\n\n    // 再把 0->1 转换 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n\n    // 把 0->2 转换到 -1->+1 (裁剪空间)\n    vec2 clipSpace = zeroToTwo - 1.0;\n\n    gl_Position = vec4(clipSpace, 0, 1);\n  }\n</script>`, `56571026129940760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  <span class="token comment">// attribute vec4 a_position;</span>\n  attribute vec2 a_position<span class="token punctuation">;</span>\n\n  uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 从像素坐标转换到 0.0 到 1.0</span>\n    vec2 zeroToOne <span class="token operator">=</span> a_position <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n    <span class="token comment">// 再把 0->1 转换 0->2</span>\n    vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 把 0->2 转换到 -1->+1 (裁剪空间)</span>\n    vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n    gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里有些变化需要注意，我们将 a_position 改成 vec2 类型是因为我们只需要用 x 和 y 值。vec2 和 vec4 有些类似但是仅有 x 和 y 值。</p>\n<p>接着我们添加了一个 uniform（全局变量）叫做 u_resolution，为了设置它的值我们需要找到它的位置。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8233124140298042000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var resolutionUniformLocation = gl.getUniformLocation(program, \'u_resolution\');`, `8233124140298042000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其余变化的应该能从注释中理解。通过设置 u_resolution 为画布的分辨率，着色器将会从 positionBuffer 中获取像素坐标将之转换为对应的裁剪空间坐标。</p>\n<p>现在我们可以将位置信息转换为像素坐标。这次我们将通过绘制两个三角形来绘制一个矩形，每个三角形有三个点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9781367916815497000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positions = [10, 20, 80, 20, 10, 30, 10, 30, 80, 20, 80, 30];\ngl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);`, `9781367916815497000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>在我们设置好使用这个着色程序后，可以设置刚才创建的全局变量的值。gl.useProgram 就与之前讲到的 gl.bindBuffer 相似，设置当前使用的着色程序。之后所有类似 gl.uniformXXX 格式的方法都是设置当前着色程序的全局变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39314441591143590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.useProgram(program);\n\n// ...\n\n// 设置全局变量分辨率\ngl.uniform2f(resolutionUniformLocation, gl.canvas.width, gl.canvas.height);`, `39314441591143590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ...</span>\n\n<span class="token comment">// 设置全局变量分辨率</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>显然我们需要告诉 WebGL 要运行六次顶点着色器来画两个三角形。所以我们将 count 改成 6。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85080004710622360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 6;\ngl.drawArrays(primitiveType, offset, count);`, `85080004710622360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-two-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Use our boilerplate utils to compile the shaders and link into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>你可能注意到矩形在区域左下角，WebGL 认为左下角是 0，0。想要像传统二维 API 那样起点在左上角，我们只需翻转 y 轴即可。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82743374984123560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);`, `82743374984123560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在矩形在我们期望的位置了</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-two-triangle-revert.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n\n      <span class="token comment">// fragment shaders don\'t have a default precision so we need</span>\n      <span class="token comment">// to pick one. mediump is a good default</span>\n      precision mediump float<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// gl_FragColor is a special variable a fragment shader</span>\n        <span class="token comment">// is responsible for setting</span>\n        gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// return redish-purple</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#c\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// Use our boilerplate utils to compile the shaders and link into a program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">var</span> positions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span>positions<span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw</span>\n        <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>让我们来定义一个可以生成矩形的方法，这样我们就可以调用它定义形状不一的多个矩形。同时我们需要矩形的颜色是可设置的。</p>\n<p>首先我们定义一个片断着色器，可以通过全局变量接收自定义颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78713957066076340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script id=&quot;fragment-shader-2d&quot; type=&quot;notjs&quot;>\n  precision mediump float;\n\n  uniform vec4 u_color;\n\n  void main() {\n    gl_FragColor = u_color;\n  }\n</script>`, `78713957066076340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  precision mediump float<span class="token punctuation">;</span>\n\n  uniform vec4 u_color<span class="token punctuation">;</span>\n\n  <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里是一段新代码，可以随机绘制 50 个随机位置，随机大小，随机颜色的矩形。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91511703080715760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var colorUniformLocation = gl.getUniformLocation(program, \'u_color\');\n{\n  // ...\n  // 绘制 50 个随机颜色矩形\n  for (var ii = 0; ii < 50; ++ii) {\n    // 创建一个随机矩形并将写入位置缓冲\n    // 因为位置缓冲是我们绑定在 ARRAY_BUFFER 绑定点上的最后一个缓冲\n    setRectangle(gl, randomInt(300), randomInt(300), randomInt(300), randomInt(300));\n\n    // 设置一个随机颜色\n    gl.uniform4f(colorUniformLocation, Math.random(), Math.random(), Math.random(), 1);\n\n    // 绘制矩形\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n  }\n}\n\n// 返回 0 到 range 范围内的随机整数\nfunction randomInt(range) {\n  return Math.floor(Math.random() * range);\n}\n\n// 用参数生成矩形顶点并写进缓冲\nfunction setRectangle(gl, x, y, width, height) {\n  var x1 = x;\n  var x2 = x + width;\n  var y1 = y;\n  var y2 = y + height;\n\n  // 注意: gl.bufferData(gl.ARRAY_BUFFER, ...) 将会影响到当前绑定点 ARRAY_BUFFER 的绑定缓冲\n  // 目前我们只有一个缓冲，如果我们有多个缓冲，我们需要先将所需缓冲绑定到 ARRAY_BUFFER\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([x1, y1, x2, y1, x1, y2, x1, y2, x2, y1, x2, y2]), gl.STATIC_DRAW);\n}`, `91511703080715760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> colorUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 绘制 50 个随机颜色矩形</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 创建一个随机矩形并将写入位置缓冲</span>\n    <span class="token comment">// 因为位置缓冲是我们绑定在 ARRAY_BUFFER 绑定点上的最后一个缓冲</span>\n    <span class="token function">setRectangle</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 设置一个随机颜色</span>\n    gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>colorUniformLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 绘制矩形</span>\n    gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 返回 0 到 range 范围内的随机整数</span>\n<span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 用参数生成矩形顶点并写进缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setRectangle</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> x1 <span class="token operator">=</span> x<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> x2 <span class="token operator">=</span> x <span class="token operator">+</span> width<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y1 <span class="token operator">=</span> y<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> y2 <span class="token operator">=</span> y <span class="token operator">+</span> height<span class="token punctuation">;</span>\n\n  <span class="token comment">// 注意: gl.bufferData(gl.ARRAY_BUFFER, ...) 将会影响到当前绑定点 ARRAY_BUFFER 的绑定缓冲</span>\n  <span class="token comment">// 目前我们只有一个缓冲，如果我们有多个缓冲，我们需要先将所需缓冲绑定到 ARRAY_BUFFER</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里是 50 个矩形。</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/webgl-fundamental-base-concept/draw-many-triangle.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0, user-scalable=yes<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>WebGL - Fundamentals<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-tutorials.css<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>398<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>298<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>resources/webgl-utils.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertex-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      attribute vec4 a_position<span class="token punctuation">;</span>\n\n      uniform vec2 u_resolution<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token comment">// convert the position from pixels to 0.0 to 1.0</span>\n         vec2 zeroToOne <span class="token operator">=</span> a_position<span class="token punctuation">.</span>xy <span class="token operator">/</span> u_resolution<span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->1 to 0->2</span>\n         vec2 zeroToTwo <span class="token operator">=</span> zeroToOne <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n\n         <span class="token comment">// convert from 0->2 to -1->+1 (clipspace)</span>\n         vec2 clipSpace <span class="token operator">=</span> zeroToTwo <span class="token operator">-</span> <span class="token number">1.0</span><span class="token punctuation">;</span>\n\n         gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span>clipSpace <span class="token operator">*</span> <span class="token function">vec2</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragment-shader-2d<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>notjs<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      precision mediump float<span class="token punctuation">;</span>\n\n      uniform vec4 u_color<span class="token punctuation">;</span>\n\n      <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        gl_FragColor <span class="token operator">=</span> u_color<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token string">\'use strict\'</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Get A WebGL context</span>\n        <span class="token comment">/** @type {HTMLCanvasElement} */</span>\n        <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> gl <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'webgl\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// setup GLSL program</span>\n        <span class="token keyword">var</span> program <span class="token operator">=</span> webglUtils<span class="token punctuation">.</span><span class="token function">createProgramFromScripts</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'vertex-shader-2d\'</span><span class="token punctuation">,</span> <span class="token string">\'fragment-shader-2d\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up where the vertex data needs to go.</span>\n        <span class="token keyword">var</span> positionAttributeLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// look up uniform locations</span>\n        <span class="token keyword">var</span> resolutionUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_resolution\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">var</span> colorUniformLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Create a buffer to put three 2d clip space points in</span>\n        <span class="token keyword">var</span> positionBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = positionBuffer)</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        webglUtils<span class="token punctuation">.</span><span class="token function">resizeCanvasToDisplaySize</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell WebGL how to convert from clip space to pixels</span>\n        gl<span class="token punctuation">.</span><span class="token function">viewport</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Clear the canvas</span>\n        gl<span class="token punctuation">.</span><span class="token function">clearColor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">COLOR_BUFFER_BIT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell it to use our program (pair of shaders)</span>\n        gl<span class="token punctuation">.</span><span class="token function">useProgram</span><span class="token punctuation">(</span>program<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Turn on the attribute</span>\n        gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Bind the position buffer.</span>\n        gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> positionBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// Tell the attribute how to get data out of positionBuffer (ARRAY_BUFFER)</span>\n        <span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 2 components per iteration</span>\n        <span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// the data is 32bit floats</span>\n        <span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// don\'t normalize the data</span>\n        <span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = move forward size * sizeof(type) each iteration to get the next position</span>\n        <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// start at the beginning of the buffer</span>\n        gl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionAttributeLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// set the resolution</span>\n        gl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>resolutionUniformLocation<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> gl<span class="token punctuation">.</span>canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// draw 50 random rectangles in random colors</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> ii <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token operator">++</span>ii<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// Setup a random rectangle</span>\n          <span class="token comment">// This will write to positionBuffer because</span>\n          <span class="token comment">// its the last thing we bound on the ARRAY_BUFFER</span>\n          <span class="token comment">// bind point</span>\n          <span class="token function">setRectangle</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// Set a random color.</span>\n          gl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>colorUniformLocation<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// Draw the rectangle.</span>\n          <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n          <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n          <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>\n          gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// Returns a random integer from 0 to range - 1.</span>\n      <span class="token keyword">function</span> <span class="token function">randomInt</span><span class="token punctuation">(</span><span class="token parameter">range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// Fill the buffer with the values that define a rectangle.</span>\n      <span class="token keyword">function</span> <span class="token function">setRectangle</span><span class="token punctuation">(</span><span class="token parameter">gl<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> x1 <span class="token operator">=</span> x<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> x2 <span class="token operator">=</span> x <span class="token operator">+</span> width<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> y1 <span class="token operator">=</span> y<span class="token punctuation">;</span>\n        <span class="token keyword">var</span> y2 <span class="token operator">=</span> y <span class="token operator">+</span> height<span class="token punctuation">;</span>\n        gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n          gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n          <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>WebGL 其实是一个非常简单的 API。好吧，“简单”可能是一个不恰当的描述。它做的是一件简单的事，它仅仅运行用户提供的两个方法，一个顶点着色器和一个片断着色器，去绘制点，线和三角形。虽然做三维可以变得很复杂，但是这种复杂只是作为程序员的你，是一种复杂形式的“着色器”。WebGL API 只做光栅化处理并且在概念上十分容易理解。</p>\n<p>我们简单的示例向你展示了怎么给属性和两个全局变量提供数据。它和多个属性以及多个全局变量的原理一致。在这篇文章的开始部分，我们还提到了 varyings（可变量）和 textures（纹理），这些将会在随后的课程中出现。</p>\n<p>上例中用 setRectangle 更新缓冲数据的方式在大多数程序中并不常见。我这么用只是因为在这个例子中，为了解释 GLSL 接收像素坐标并通过少量数学运算得到期望结果，这可能是最简单的方式，不是常规做法。</p>\n<h1 id="工作原理"><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工作原理</h1>\n<p>在继续学习之前，我们需要探讨一下 WebGL 在 GPU 上究竟做了什么。WebGL 在 GPU 上的工作基本上分为两部分，第一部分是将顶点（或数据流）转换到裁剪空间坐标，第二部分是基于第一部分的结果绘制像素点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33623460420044960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 9;\ngl.drawArrays(primitiveType, offset, count);`, `33623460420044960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里的 9 表示“处理 9 个顶点”，所以将会有 9 个顶点被转换。</p>\n<p><img src="/static/vertex-shader-anim-33263e801ba33d7a89d6af77129031ac.gif"></p>\n<p>左侧是你提供的数据。顶点着色器（Vertex Shader）是你写进 GLSL 中的一个方法，每个顶点调用一次，在这个方法中做一些数学运算后设置了一个特殊的 gl_Position 变量，这个变量就是该顶点转换到裁剪空间中的坐标值，GPU 接收该值并将其保存起来。</p>\n<p>假设你正在画三角形，顶点着色器每完成三次顶点处理，WebGL 就会用这三个顶点画一个三角形。它计算出这三个顶点对应的像素后，就会光栅化这个三角形，“光栅化”其实就是“用像素画出来”的花哨叫法。对于每一个像素，它会调用你的片断着色器询问你使用什么颜色。你通过给片断着色器的一个特殊变量 gl_FragColor 设置一个颜色值，实现自定义像素颜色。</p>\n<p>使用它们可以做出非常有趣的东西，但如你所见，到目前为止的例子中，处理每个像素时片断着色器可用信息很少，幸运的是我们可以给它传递更多信息。想要从顶点着色器传值到片断着色器，我们可以定义“可变量（varyings）”。</p>\n<p>一个简单的例子，将顶点着色器计算出的裁剪空间坐标从顶点着色器传递到片断着色器。</p>\n<p>我们来画一个简单的三角形，从之前的例子继续，让我们把矩形改成三角形。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21676943520735370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义一个三角形填充到缓冲里\nfunction setGeometry(gl) {\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([0, -100, 150, 125, -175, 100]), gl.STATIC_DRAW);\n}`, `21676943520735370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 定义一个三角形填充到缓冲里</span>\n<span class="token keyword">function</span> <span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">175</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们只需要画三个顶点</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14444366194579606000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 绘制场景\nfunction drawScene() {\n  // ...\n  // 绘制几何体\n  var primitiveType = gl.TRIANGLES;\n  var offset = 0;\n  var count = 3;\n  gl.drawArrays(primitiveType, offset, count);\n}`, `14444366194579606000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 绘制场景</span>\n<span class="token keyword">function</span> <span class="token function">drawScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n  <span class="token comment">// 绘制几何体</span>\n  <span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n  gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在我们的顶点着色器中定义一个 varying（可变量）用来给片断着色器传值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23223236538513637000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`varying vec4 v_color;\n// ...\nvoid main() {\n  // 将位置和矩阵相乘\n  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n\n  // 从裁减空间转换到颜色空间\n  // 裁减空间范围 -1.0 到 +1.0\n  // 颜色空间范围 0.0 到 1.0\n  v_color = gl_Position * 0.5 + 0.5;\n}`, `23223236538513637000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{10}"\n              >\n                <span class="gatsby-code-button-language">glsl{10}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n<span class="token comment">// ...</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将位置和矩阵相乘</span>\n  gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token punctuation">(</span>u_matrix <span class="token operator">*</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span>a_position<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xy<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 从裁减空间转换到颜色空间</span>\n  <span class="token comment">// 裁减空间范围 -1.0 到 +1.0</span>\n  <span class="token comment">// 颜色空间范围 0.0 到 1.0</span>\n<span class="gatsby-highlight-code-line">  v_color <span class="token operator">=</span> gl_Position <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在片断着色器中定义同名 varying 变量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85346396693459270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}`, `85346396693459270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{3,6}"\n              >\n                <span class="gatsby-code-button-language">glsl{3,6}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span></span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">  gl_FragColor <span class="token operator">=</span> v_color<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>WebGL 会将同名的可变量从顶点着色器输入到片断着色器中。</p>\n<p>下面是运行结果</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/7xbtl?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [draw-colorful-triangle](embedded-codesandbox://webgl-fundamental-base-concept/draw-colorful-triangle) -->\n<p>当你移动、缩放、旋转三角形时，发现颜色随位置变化，不跟着三角形移动。</p>\n<p>回想一下，我们只计算了三个顶点，调用了三次顶点着色器，所以也只计算出了三个颜色值，但是我们的三角形却有很多颜色，这就是称之为可变量的 varying 的原因啦！</p>\n<p>WebGL 先获得顶点着色器中计算的三个颜色值，在光栅化三角形时将会根据这三个值进行插值。 每一个像素在调用片断着色器时，可变量的值是与之对应的插值。</p>\n<p>让我们从上例的三个顶点开始分析</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="2">顶点</th>\n      </tr>\n      <tr>\n         <td>0</td>\n         <td>-100</td>\n      </tr>\n      <tr>\n         <td>150</td>\n         <td>125</td>\n      </tr>\n      <tr>\n         <td>-175</td>\n         <td>100</td>\n      </tr>\n   </tbody>\n</table>\n<p>我们的给顶点着色器施加了一个包含平移，旋转和缩放的的矩阵，并将结果转换到裁剪空间。默认平移，旋转和缩放值为：平移 = 200, 150，旋转 = 0，缩放 = 1，所以这里只进行了平移。画布大小（背景缓冲）为 400×300，所以三个顶点在裁剪空间中为以下坐标值。</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="2">写入 gl_Position 的值</th>\n      </tr>\n      <tr>\n         <td>0.000</td>\n         <td>0.660</td>\n      </tr>\n      <tr>\n         <td>0.750</td>\n         <td>-0.830</td>\n      </tr>\n      <tr>\n         <td>-0.875</td>\n         <td>-0.660</td>\n      </tr>\n   </tbody>\n</table>\n<p>同时将这些值转换到颜色空间中赋给我们定义的可变量 v_color。</p>\n<table>\n   <tbody>\n      <tr>\n         <th colspan="3">写入 v_color 的值</th>\n      </tr>\n      <tr>\n         <td>0.5000</td>\n         <td>0.830</td>\n         <td>0.5</td>\n      </tr>\n      <tr>\n         <td>0.8750</td>\n         <td>0.086</td>\n         <td>0.5</td>\n      </tr>\n      <tr>\n         <td>0.0625</td>\n         <td>0.170</td>\n         <td>0.5</td>\n      </tr>\n   </tbody>\n</table>\n<p>利用这三个值进行插值后传进每个像素运行的片断着色器中。</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/zi15x?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [fragment-shader-anim](embedded-codesandbox://webgl-fundamental-base-concept/fragment-shader-anim?view=preview) -->\n<p>想要给片断着色器传值，我们可以先把值传递给顶点着色器然后再传给片断着色器。让我们来画一个由两个不同颜色三角形组成的矩形。我们需要给顶点着色器添加一个属性值，把值通过属性传递给它后它再直接传递给片断着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70940745868260890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec2 a_position;\nattribute vec4 a_color;\n// ...\nvarying vec4 v_color;\n\nvoid main() {\n  // 直接把属性值中的数据赋给可变量\n  v_color = a_color;\n}`, `70940745868260890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl{2,8}"\n              >\n                <span class="gatsby-code-button-language">glsl{2,8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec2</span> a_position<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_color<span class="token punctuation">;</span></span><span class="token comment">// ...</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 直接把属性值中的数据赋给可变量</span>\n<span class="gatsby-highlight-code-line">  v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在要给 WebGL 提供要用的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98843000698990410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 寻找顶点着色器中需要的数据\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');\n// ..\n// 给颜色数据创建一个缓冲\nvar colorBuffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n// 设置颜色\nsetColors(gl);\n// ..\n\n// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 生成两个随机颜色\n  var r1 = Math.random();\n  var b1 = Math.random();\n  var g1 = Math.random();\n\n  var r2 = Math.random();\n  var b2 = Math.random();\n  var g2 = Math.random();\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([r1, b1, g1, 1, r1, b1, g1, 1, r1, b1, g1, 1, r2, b2, g2, 1, r2, b2, g2, 1, r2, b2, g2, 1]),\n    gl.STATIC_DRAW\n  );\n}`, `98843000698990410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3,5-9,12-29}"\n              >\n                <span class="gatsby-code-button-language">js{3,5-9,12-29}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 寻找顶点着色器中需要的数据</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token comment">// ..</span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// 给颜色数据创建一个缓冲</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// 设置颜色</span></span><span class="gatsby-highlight-code-line"><span class="token function">setColors</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token comment">// ..</span>\n\n<span class="gatsby-highlight-code-line"><span class="token comment">// 给矩形的两个三角形</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// 设置颜色值并发到缓冲</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token comment">// 生成两个随机颜色</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> r1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> b1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> g1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> r2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> b2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">var</span> g2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"></span><span class="gatsby-highlight-code-line">  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r1<span class="token punctuation">,</span> b1<span class="token punctuation">,</span> g1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> r2<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> g2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在渲染的时候设置颜色属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96100751258573160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(colorLocation);\n\n// 绑定颜色缓冲\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n\n// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值\nvar size = 4; // 每次迭代使用4个单位的数据\nvar type = gl.FLOAT; // 单位数据类型是32位的浮点型\nvar normalize = false; // 不需要归一化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度sizeof(type)\n\n// 每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从绑定缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `96100751258573160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 绑定颜色缓冲</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 告诉颜色属性怎么从 colorBuffer (ARRAY_BUFFER) 中读取颜色值</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用4个单位的数据</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 单位数据类型是32位的浮点型</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不需要归一化数据</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度sizeof(type)</span>\n\n<span class="token comment">// 每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从绑定缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>调整顶点的数量为 6 用来画两个三角形</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54094893572049200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 画几何体\nvar primitiveType = gl.TRIANGLES;\nvar offset = 0;\nvar count = 6;\ngl.drawArrays(primitiveType, offset, count);`, `54094893572049200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{4}"\n              >\n                <span class="gatsby-code-button-language">js{4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 画几何体</span>\n<span class="token keyword">var</span> primitiveType <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></span>gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>primitiveType<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/fi4uh?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-2d-rectangle-with-2-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-2-colors) -->\n<p>你可能注意到这两个三角形是纯色的。我们传递给每个三角形的顶点的颜色值是相同的，所以我们传递的 varying 会被插值成相同的颜色，如果我们传递不同的颜色，就会看到插值的颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37985267738893810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 给每个顶点定义不同的颜色\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array([\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1,\n      Math.random(),\n      Math.random(),\n      Math.random(),\n      1\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `37985267738893810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{8-31}"\n              >\n                <span class="gatsby-code-button-language">js{8-31}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 给矩形的两个三角形</span>\n<span class="token comment">// 设置颜色值并发到缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 给每个顶点定义不同的颜色</span>\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n<span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token number">1</span></span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在看到的是插值的 varying</p>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/5ohcj?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!--\n[webgl-2d-rectangle-with-random-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-random-colors) -->\n<p>上例还演示了使用多个属性并且通过顶点着色器向片断着色器传值。如果你看了处理图片的例子，那里面还用了另外一个属性传递纹理坐标。</p>\n<h2 id="关于-buffer-和-attribute-的代码是干什么的？"><a href="#%E5%85%B3%E4%BA%8E-buffer-%E5%92%8C-attribute-%E7%9A%84%E4%BB%A3%E7%A0%81%E6%98%AF%E5%B9%B2%E4%BB%80%E4%B9%88%E7%9A%84%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 buffer 和 attribute 的代码是干什么的？</h2>\n<p>缓冲操作是在 GPU 上获取顶点和其他顶点数据的一种方式。gl.createBuffer 创建一个缓冲；gl.bindBuffer 是设置缓冲为当前使用缓冲；gl.bufferData 将数据拷贝到缓冲，这个操作一般在初始化完成。</p>\n<p>一旦数据存到缓冲中，还需要告诉 WebGL 怎么从缓冲中提取数据传给顶点着色器的属性。</p>\n<p>要做这些，首先需要获取 WebGL 给属性分配的地址，如下方代码所示</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4254615629026093000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 询问顶点数据应该放在哪里\nvar positionLocation = gl.getAttribLocation(program, \'a_position\');\nvar colorLocation = gl.getAttribLocation(program, \'a_color\');`, `4254615629026093000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 询问顶点数据应该放在哪里</span>\n<span class="token keyword">var</span> positionLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> colorLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这一步一般也是在初始化部分完成。</p>\n<p>一旦知道了属性的地址，在绘制前还需要发出三个命令。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7919592679072185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.enableVertexAttribArray(location); // 这个命令是告诉 WebGL 我们想从缓冲中提供数据。\ngl.bindBuffer(gl.ARRAY_BUFFER, someBuffer); // 这个命令是将缓冲绑定到 ARRAY_BUFFER 绑定点，它是 WebGL 内部的一个全局变量。\ngl.vertexAttribPointer(location, numComponents, typeOfData, normalizeFlag, strideToNextPieceOfData, offsetIntoBuffer);`, `7919592679072185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个命令是告诉 WebGL 我们想从缓冲中提供数据。</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> someBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个命令是将缓冲绑定到 ARRAY_BUFFER 绑定点，它是 WebGL 内部的一个全局变量。</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> numComponents<span class="token punctuation">,</span> typeOfData<span class="token punctuation">,</span> normalizeFlag<span class="token punctuation">,</span> strideToNextPieceOfData<span class="token punctuation">,</span> offsetIntoBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>最后一条命令告诉 WebGL 从 <code class="language-text">ARRAY_BUFFER</code> 绑定点当前绑定的缓冲获取数据。每个顶点有几个单位的数据(1 - 4)，单位数据类型是什么(BYTE, FLOAT, INT, <code class="language-text">UNSIGNED_SHORT</code>, 等等…)，stride 是从一个数据到下一个数据要跳过多少位，最后是数据在缓冲的什么位置。</p>\n<p>单位个数永远是 1 到 4 之间。</p>\n<p>如果每个类型的数据都用一个缓冲存储，stride 和 offset 都是 0。对 stride 来说 0 表示 “用符合单位类型和单位个数的大小”。对 offset 来说 0 表示从缓冲起始位置开始读取。它们使用 0 以外的值时会复杂得多，虽然这样会取得一些性能能上的优势，但是一般情况下并不值得，除非你想充分压榨 WebGL 的性能。</p>\n<h2 id="vertexattribpointer-中的-normalizeflag-参数是什么意思？"><a href="#vertexattribpointer-%E4%B8%AD%E7%9A%84-normalizeflag-%E5%8F%82%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vertexAttribPointer 中的 normalizeFlag 参数是什么意思？</h2>\n<p>标准化标记（normalizeFlag）适用于所有非浮点型数据。如果传递 false 就解读原数据类型。 BYTE 类型的范围是从 -128 到 127，UNSIGNED_BYTE 类型的范围是从 0 到 255， SHORT 类型的范围是从 -32768 到 32767，等等…</p>\n<p>如果标准化标记设为 true，BYTE 数据的值(-128 to 127)将会转换到 -1.0 到 +1.0 之间， UNSIGNED_BYTE (0 to 255) 变为 0.0 到 +1.0 之间，SHORT 也是转换到 -1.0 到 +1.0 之间， 但比 BYTE 精确度高。</p>\n<p>最常用的是标准化颜色数据。大多数情况颜色值范围为 0.0 到 +1.0。 使用 4 个浮点型数据存储红，绿，蓝和阿尔法通道数据时，每个顶点的颜色将会占用 16 字节空间， 如果你有复杂的几何体将会占用很多内存。代替的做法是将颜色数据转换为四个 UNSIGNED_BYTE ， 其中 0 表示 0.0，255 表示 1.0。现在每个顶点只需要四个字节存储颜色值，省了 75% 空间。</p>\n<p>我们来修改之前代码实现。当我们告诉 WebGL 如何获取颜色数据时将这样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13566957072841146000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 告诉颜色属性如何从 colorBuffer 中提取数据 (ARRAY_BUFFER)\nvar size = 4; // 每次迭代使用四个单位数据\nvar type = gl.UNSIGNED_BYTE; // 数据类型是 8 位的 UNSIGNED_BYTE 类型。\nvar normalize = true; // 标准化数据\nvar stride = 0; // 0 = 移动距离 * 单位距离长度 sizeof(type)\n// 每次迭代跳多少距离到下一个数据\nvar offset = 0; // 从缓冲的起始处开始\ngl.vertexAttribPointer(colorLocation, size, type, normalize, stride, offset);`, `13566957072841146000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3-4}"\n              >\n                <span class="gatsby-code-button-language">js{3-4}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 告诉颜色属性如何从 colorBuffer 中提取数据 (ARRAY_BUFFER)</span>\n<span class="token keyword">var</span> size <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 每次迭代使用四个单位数据</span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">;</span> <span class="token comment">// 数据类型是 8 位的 UNSIGNED_BYTE 类型。</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 标准化数据</span></span><span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 = 移动距离 * 单位距离长度 sizeof(type)</span>\n<span class="token comment">// 每次迭代跳多少距离到下一个数据</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲的起始处开始</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>colorLocation<span class="token punctuation">,</span> size<span class="token punctuation">,</span> type<span class="token punctuation">,</span> normalize<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如下向缓冲添加数据</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25221193384469220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 给矩形的两个三角形\n// 设置颜色值并发到缓冲\nfunction setColors(gl) {\n  // 设置两个随机颜色\n  var r1 = Math.random() * 256; // 0 到 255.99999 之间\n  var b1 = Math.random() * 256; // 这些数据\n  var g1 = Math.random() * 256; // 在存入缓冲时\n  var r2 = Math.random() * 256; // 将被截取成\n  var b2 = Math.random() * 256; // Uint8Array 类型\n  var g2 = Math.random() * 256;\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Uint8Array([\n      // Uint8Array\n      r1,\n      b1,\n      g1,\n      255,\n      r1,\n      b1,\n      g1,\n      255,\n      r1,\n      b1,\n      g1,\n      255,\n      r2,\n      b2,\n      g2,\n      255,\n      r2,\n      b2,\n      g2,\n      255,\n      r2,\n      b2,\n      g2,\n      255\n    ]),\n    gl.STATIC_DRAW\n  );\n}`, `25221193384469220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 给矩形的两个三角形</span>\n<span class="token comment">// 设置颜色值并发到缓冲</span>\n<span class="token keyword">function</span> <span class="token function">setColors</span><span class="token punctuation">(</span><span class="token parameter">gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 设置两个随机颜色</span>\n  <span class="token keyword">var</span> r1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 0 到 255.99999 之间</span>\n  <span class="token keyword">var</span> b1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 这些数据</span>\n  <span class="token keyword">var</span> g1 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 在存入缓冲时</span>\n  <span class="token keyword">var</span> r2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// 将被截取成</span>\n  <span class="token keyword">var</span> b2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token comment">// Uint8Array 类型</span>\n  <span class="token keyword">var</span> g2 <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">;</span>\n\n  gl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>\n    gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n      <span class="token comment">// Uint8Array</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r1<span class="token punctuation">,</span>\n      b1<span class="token punctuation">,</span>\n      g1<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span><span class="token punctuation">,</span>\n      r2<span class="token punctuation">,</span>\n      b2<span class="token punctuation">,</span>\n      g2<span class="token punctuation">,</span>\n      <span class="token number">255</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/x51g6?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-2d-rectangle-with-2-byte-colors](embedded-codesandbox://webgl-fundamental-base-concept/webgl-2d-rectangle-with-2-byte-colors) -->\n<h1 id="webgl-着色器和-glsl"><a href="#webgl-%E7%9D%80%E8%89%B2%E5%99%A8%E5%92%8C-glsl" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 着色器和 GLSL</h1>\n<p>我们之前提到过着色器和 GLSL，但是没有涉及细节，你可能已经对此有所了解，但以防万一，这里将详细讲解着色器和 GLSL。</p>\n<p>在工作原理中我们提到，WebGL 每次绘制需要两个着色器，一个顶点着色器和一个片断着色器，每一个着色器都是一个方法。一个顶点着色器和一个片断着色器链接在一起放入一个着色程序中（或者只叫程序）。一个典型的 WebGL 应用会有多个着色程序。</p>\n<h2 id="顶点着色器"><a href="#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点着色器</h2>\n<p>一个顶点着色器的工作是生成裁剪空间坐标值，通常是以下的形式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54480774163344695000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void main() {\n   gl_Position = doMathToMakeClipspaceCoordinates\n}`, `54480774163344695000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> doMathToMakeClipspaceCoordinates\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>每个顶点调用一次（顶点）着色器，每次调用都需要设置一个特殊的全局变量 gl_Position， 该变量的值就是裁减空间坐标值。</p>\n<p>顶点着色器需要的数据，可以通过以下三种方式获得</p>\n<ol>\n<li>Attributes 属性 (从缓冲中获取的数据)</li>\n<li>Uniforms 全局变量 (在一次绘制中对所有顶点保持一致值)</li>\n<li>Textures 纹理 (从像素或纹理元素中获取的数据)</li>\n</ol>\n<h3 id="attributes-属性"><a href="#attributes-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Attributes 属性</h3>\n<p>最常用的方法是缓冲和属性，在工作原理中讲到了缓冲和属性，你可以创建缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7209828654647143000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var buf = gl.createBuffer();`, `7209828654647143000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> buf <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>将数据存入缓冲</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78262838557919360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.bindBuffer(gl.ARRAY_BUFFER, buf);\ngl.bufferData(gl.ARRAY_BUFFER, someData, gl.STATIC_DRAW);`, `78262838557919360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> someData<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后初始化的时候，在你制作的（着色）程序中找到属性所在地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43301138115124260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var positionLoc = gl.getAttribLocation(someShaderProgram, \'a_position\');`, `43301138115124260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> positionLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>someShaderProgram<span class="token punctuation">,</span> <span class="token string">\'a_position\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在渲染的时候告诉 WebGL 怎么从缓冲中获取数据传递给属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60424663855244760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 开启从缓冲中获取数据\ngl.enableVertexAttribArray(positionLoc);\n\nvar numComponents = 3; // (x, y, z)\nvar type = gl.FLOAT; // 32 位浮点数据\nvar normalize = false; // 不标准化\nvar offset = 0; // 从缓冲起始位置开始获取\nvar stride = 0; // 到下一个数据跳多少位内存\n// 0 = 使用当前的单位个数和单位长度（3 * Float32Array.BYTES_PER_ELEMENT）\n\ngl.vertexAttribPointer(positionLoc, numComponents, type, false, stride, offset);`, `60424663855244760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 开启从缓冲中获取数据</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>positionLoc<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> numComponents <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// (x, y, z)</span>\n<span class="token keyword">var</span> type <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">;</span> <span class="token comment">// 32 位浮点数据</span>\n<span class="token keyword">var</span> normalize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 不标准化</span>\n<span class="token keyword">var</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 从缓冲起始位置开始获取</span>\n<span class="token keyword">var</span> stride <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 到下一个数据跳多少位内存</span>\n<span class="token comment">// 0 = 使用当前的单位个数和单位长度（3 * Float32Array.BYTES_PER_ELEMENT）</span>\n\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>positionLoc<span class="token punctuation">,</span> numComponents<span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> stride<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 <code class="language-text">WebGL 基础概念</code> 中示范了不做任何运算直接将数据传递给 <code class="language-text">gl_Position</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91943944222942860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n\nvoid main() {\n   gl_Position = a_position;\n}`, `91943944222942860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> a_position<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果缓冲中存的是裁剪空间坐标就没什么问题。</p>\n<p>属性可以用 float, vec2, vec3, vec4, mat2, mat3 和 mat4 数据类型。</p>\n<h3 id="uniforms-全局变量"><a href="#uniforms-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniforms 全局变量</h3>\n<p>全局变量在一次绘制过程中传递给着色器的值都一样，在下面的一个简单的例子中，用全局变量给顶点着色器添加了一个偏移量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76987798853890130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\nuniform vec4 u_offset;\n\nvoid main() {\n   gl_Position = a_position + u_offset;\n}`, `76987798853890130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_offset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_Position <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在可以把所有顶点偏移一个固定值，首先在初始化时找到全局变量的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37897985453527605000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var offsetLoc = gl.getUniformLocation(someProgram, \'u_offset\');`, `37897985453527605000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> offsetLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_offset\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>然后在绘制前设置全局变量</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19225781334849556000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform4fv(offsetLoc, [1, 0, 0, 0]); // 向右偏移一半屏幕宽度`, `19225781334849556000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>offsetLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 向右偏移一半屏幕宽度</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>要注意的是全局变量属于单个着色程序，如果多个着色程序有同名全局变量，需要找到每个全局变量并设置自己的值。 我们调用 <code class="language-text">gl.uniform???</code> 的时候只是设置了当前程序的全局变量，当前程序是传递给 <code class="language-text">gl.useProgram</code> 的最后一个程序。</p>\n<p>全局变量有很多类型，对应的类型有对应的设置方法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10799291558939572000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform1f(floatUniformLoc, v);                 // float\ngl.uniform1fv(floatUniformLoc, [v]);              // float 或 float array\ngl.uniform2f(vec2UniformLoc, v0, v1);             // vec2\ngl.uniform2fv(vec2UniformLoc, [v0, v1]);          // vec2 或 vec2 array\ngl.uniform3f(vec3UniformLoc, v0, v1, v2);         // vec3\ngl.uniform3fv(vec3UniformLoc, [v0, v1, v2]);      // vec3 或 vec3 array\ngl.uniform4f(vec4UniformLoc, v0, v1, v2, v4);     // vec4\ngl.uniform4fv(vec4UniformLoc, [v0, v1, v2, v4]);  // vec4 或 vec4 array\n\ngl.uniformMatrix2fv(mat2UniformLoc, false, [4x element array])    // mat2 或 mat2 array\ngl.uniformMatrix3fv(mat3UniformLoc, false, [9x element array])    // mat3 或 mat3 array\ngl.uniformMatrix4fv(mat4UniformLoc, false, [16x element array])   // mat4 或 mat4 array\n\ngl.uniform1i(intUniformLoc, v);                   // int\ngl.uniform1iv(intUniformLoc, [v]);                // int 或 int array\ngl.uniform2i(ivec2UniformLoc, v0, v1);            // ivec2\ngl.uniform2iv(ivec2UniformLoc, [v0, v1]);         // ivec2 或 ivec2 array\ngl.uniform3i(ivec3UniformLoc, v0, v1, v2);        // ivec3\ngl.uniform3iv(ivec3UniformLoc, [v0, v1, v2]);     // ivec3 or ivec3 array\ngl.uniform4i(ivec4UniformLoc, v0, v1, v2, v4);    // ivec4\ngl.uniform4iv(ivec4UniformLoc, [v0, v1, v2, v4]); // ivec4 或 ivec4 array\n\ngl.uniform1i(sampler2DUniformLoc, v);             // sampler2D (textures)\ngl.uniform1iv(sampler2DUniformLoc, [v]);          // sampler2D 或 sampler2D array\n\ngl.uniform1i(samplerCubeUniformLoc, v);           // samplerCube (textures)\ngl.uniform1iv(samplerCubeUniformLoc, [v]);        // samplerCube 或 samplerCube array`, `10799291558939572000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform1f</span><span class="token punctuation">(</span>floatUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// float</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1fv</span><span class="token punctuation">(</span>floatUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// float 或 float array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2f</span><span class="token punctuation">(</span>vec2UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// vec2</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>vec2UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// vec2 或 vec2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>vec3UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// vec3</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3fv</span><span class="token punctuation">(</span>vec3UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// vec3 或 vec3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4f</span><span class="token punctuation">(</span>vec4UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// vec4</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4fv</span><span class="token punctuation">(</span>vec4UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// vec4 或 vec4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix2fv</span><span class="token punctuation">(</span>mat2UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// mat2 或 mat2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix3fv</span><span class="token punctuation">(</span>mat3UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// mat3 或 mat3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>mat4UniformLoc<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">16</span>x element array<span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment">// mat4 或 mat4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>intUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// int</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>intUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// int 或 int array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2i</span><span class="token punctuation">(</span>ivec2UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ivec2</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2iv</span><span class="token punctuation">(</span>ivec2UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// ivec2 或 ivec2 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3i</span><span class="token punctuation">(</span>ivec3UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ivec3</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3iv</span><span class="token punctuation">(</span>ivec3UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// ivec3 or ivec3 array</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4i</span><span class="token punctuation">(</span>ivec4UniformLoc<span class="token punctuation">,</span> v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ivec4</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform4iv</span><span class="token punctuation">(</span>ivec4UniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v0<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v4<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ivec4 或 ivec4 array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>sampler2DUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// sampler2D (textures)</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>sampler2DUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// sampler2D 或 sampler2D array</span>\n\ngl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>samplerCubeUniformLoc<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// samplerCube (textures)</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform1iv</span><span class="token punctuation">(</span>samplerCubeUniformLoc<span class="token punctuation">,</span> <span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// samplerCube 或 samplerCube array</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还有一些类型 bool, bvec2, bvec3, bvec4。它们可用 <code class="language-text">gl.uniform?f?</code> 或 <code class="language-text">gl.uniform?i?</code>。</p>\n<p>一个数组可以一次设置所有的全局变量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69113794463362520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 着色器里\nuniform vec2 u_someVec2[3];\n\n// JavaScript 初始化时\nvar someVec2Loc = gl.getUniformLocation(someProgram, &quot;u_someVec2&quot;);\n\n// 渲染的时候\ngl.uniform2fv(someVec2Loc, [1, 2, 3, 4, 5, 6]);  // 设置数组 u_someVec2`, `69113794463362520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 着色器里</span>\nuniform vec2 u_someVec2<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// JavaScript 初始化时</span>\n<span class="token keyword">var</span> someVec2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">"u_someVec2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 渲染的时候</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置数组 u_someVec2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果你想单独设置数组中的某个值，就要单独找到该值的地址。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48996256022312526000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// JavaScript 初始化时\nvar someVec2Element0Loc = gl.getUniformLocation(someProgram, \'u_someVec2[0]\');\nvar someVec2Element1Loc = gl.getUniformLocation(someProgram, \'u_someVec2[1]\');\nvar someVec2Element2Loc = gl.getUniformLocation(someProgram, \'u_someVec2[2]\');\n\n// 渲染的时候\ngl.uniform2fv(someVec2Element0Loc, [1, 2]); // set element 0\ngl.uniform2fv(someVec2Element1Loc, [3, 4]); // set element 1\ngl.uniform2fv(someVec2Element2Loc, [5, 6]); // set element 2`, `48996256022312526000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// JavaScript 初始化时</span>\n<span class="token keyword">var</span> someVec2Element0Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[0]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someVec2Element1Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[1]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someVec2Element2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someVec2[2]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 渲染的时候</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element0Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 0</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element1Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 1</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform2fv</span><span class="token punctuation">(</span>someVec2Element2Loc<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set element 2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样的，如果你创建了一个结构体</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33364766569412830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`struct SomeStruct {\n  bool active;\n  vec2 someVec2;\n};\n\nuniform SomeStruct u_someThing;`, `33364766569412830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">struct</span> SomeStruct <span class="token punctuation">{</span>\n  <span class="token keyword">bool</span> <span class="token keyword">active</span><span class="token punctuation">;</span>\n  <span class="token keyword">vec2</span> someVec2<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> SomeStruct u_someThing<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你需要找到每个元素的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52763994926111500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var someThingActiveLoc = gl.getUniformLocation(someProgram, \'u_someThing.active\');\nvar someThingSomeVec2Loc = gl.getUniformLocation(someProgram, \'u_someThing.someVec2\');`, `52763994926111500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> someThingActiveLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someThing.active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> someThingSomeVec2Loc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_someThing.someVec2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="纹理（顶点着色器中）"><a href="#%E7%BA%B9%E7%90%86%EF%BC%88%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纹理（顶点着色器中）</h3>\n<p>同 Textures 纹理（在片断着色器中）。</p>\n<h2 id="片断着色器"><a href="#%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>片断着色器</h2>\n<p>一个片断着色器的工作是为当前光栅化的像素提供颜色值，通常是以下的形式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27987193780668340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvoid main() {\n   gl_FragColor = doMathToMakeAColor;\n}`, `27987193780668340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   gl_FragColor <span class="token operator">=</span> doMathToMakeAColor<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每个像素都将调用一次片断着色器，每次调用需要从你设置的特殊全局变量 gl_FragColor 中获取颜色信息。</p>\n<p>片断着色器所需的数据，可以通过以下三种方式获取</p>\n<ol>\n<li>Uniforms 全局变量 (values that stay the same for every pixel of a single draw call)</li>\n<li>Textures 纹理 (data from pixels/texels)</li>\n<li>Varyings 可变量 (data passed from the vertex shader and interpolated)</li>\n</ol>\n<h3 id="uniform-全局变量（片断着色器中）"><a href="#uniform-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%88%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniform 全局变量（片断着色器中）</h3>\n<p>同 Uniforms 全局变量</p>\n<h3 id="textures-纹理（片断着色器中）"><a href="#textures-%E7%BA%B9%E7%90%86%EF%BC%88%E7%89%87%E6%96%AD%E7%9D%80%E8%89%B2%E5%99%A8%E4%B8%AD%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Textures 纹理（片断着色器中）</h3>\n<p>在着色器中获取纹理信息，可以先创建一个 sampler2D 类型全局变量，然后用 GLSL 方法 texture2D 从纹理中提取信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57802453318396330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n   vec2 texcoord = vec2(0.5, 0.5)  // 获取纹理中心的值\n   gl_FragColor = texture2D(u_texture, texcoord);\n}`, `57802453318396330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">sampler2D</span> u_texture<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">vec2</span> texcoord <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>  <span class="token comment">// 获取纹理中心的值</span>\n   gl_FragColor <span class="token operator">=</span> <span class="token function">texture2D</span><span class="token punctuation">(</span>u_texture<span class="token punctuation">,</span> texcoord<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从纹理中获取的数据取决于很多设置，至少要创建并给纹理填充数据，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49366559913224830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var tex = gl.createTexture();\ngl.bindTexture(gl.TEXTURE_2D, tex);\nvar level = 0;\nvar width = 2;\nvar height = 1;\nvar data = new Uint8Array([\n  255,\n  0,\n  0,\n  255, // 一个红色的像素\n  0,\n  255,\n  0,\n  255 // 一个绿色的像素\n]);\ngl.texImage2D(gl.TEXTURE_2D, level, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, data);\ngl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);`, `49366559913224830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> tex <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createTexture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> tex<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> level <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> width <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> height <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token number">255</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span><span class="token punctuation">,</span> <span class="token comment">// 一个红色的像素</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span><span class="token punctuation">,</span>\n  <span class="token number">0</span><span class="token punctuation">,</span>\n  <span class="token number">255</span> <span class="token comment">// 一个绿色的像素</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texImage2D</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> level<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">RGBA</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">texParameteri</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_MIN_FILTER</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">LINEAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在初始化时找到全局变量的地址</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15246054552219701000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var someSamplerLoc = gl.getUniformLocation(someProgram, \'u_texture\');`, `15246054552219701000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> someSamplerLoc <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>someProgram<span class="token punctuation">,</span> <span class="token string">\'u_texture\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在渲染的时候 WebGL 要求纹理必须绑定到一个纹理单元上</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79815705481148430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var unit = 5; // 挑选一个纹理单元\ngl.activeTexture(gl.TEXTURE0 + unit);\ngl.bindTexture(gl.TEXTURE_2D, tex);`, `79815705481148430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> unit <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 挑选一个纹理单元</span>\ngl<span class="token punctuation">.</span><span class="token function">activeTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE0</span> <span class="token operator">+</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindTexture</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TEXTURE_2D</span><span class="token punctuation">,</span> tex<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后告诉着色器你要使用的纹理在那个纹理单元</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6273951800112320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform1i(someSamplerLoc, unit);`, `6273951800112320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform1i</span><span class="token punctuation">(</span>someSamplerLoc<span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="varyings-可变量"><a href="#varyings-%E5%8F%AF%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Varyings 可变量</h3>\n<p>在工作原理提到过，可变量是一种顶点着色器给片断着色器传值的方式。</p>\n<p>为了使用可变量，要在两个着色器中定义同名的可变量。给顶点着色器中可变量设置的值，会作为参考值进行内插，在绘制像素时传给片断着色器的可变量。</p>\n<p>顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52139280289499860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 a_position;\n\nuniform vec4 u_offset;\n\nvarying vec4 v_positionWithOffset;\n\nvoid main() {\n  gl_Position = a_position + u_offset;\n  v_positionWithOffset = a_position + u_offset;\n}`, `52139280289499860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_position<span class="token punctuation">;</span>\n\n<span class="token keyword">uniform</span> <span class="token keyword">vec4</span> u_offset<span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_positionWithOffset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  gl_Position <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n  v_positionWithOffset <span class="token operator">=</span> a_position <span class="token operator">+</span> u_offset<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>片断着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95224791460072880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`precision mediump float;\n\nvarying vec4 v_positionWithOffset;\n\nvoid main() {\n  // 从裁剪空间 (-1 <-> +1) 转换到颜色空间 (0 -> 1).\n  vec4 color = v_positionWithOffset * 0.5 + 0.5\n  gl_FragColor = color;\n}`, `95224791460072880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">precision</span> <span class="token keyword">mediump</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_positionWithOffset<span class="token punctuation">;</span>\n\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 从裁剪空间 (-1 &lt;-> +1) 转换到颜色空间 (0 -> 1).</span>\n  <span class="token keyword">vec4</span> color <span class="token operator">=</span> v_positionWithOffset <span class="token operator">*</span> <span class="token number">0.5</span> <span class="token operator">+</span> <span class="token number">0.5</span>\n  gl_FragColor <span class="token operator">=</span> color<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上方的示例几乎没有意义，通常情况下直接将裁剪空间的值传给片断着色器当作颜色值是没有意义的，虽然它可以运行并且可以生成颜色值。</p>\n<h2 id="glsl"><a href="#glsl" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GLSL</h2>\n<p>GLSL 全称是 Graphics Library Shader Language（图形库着色器语言），是着色器使用的语言。它有一些不同于 JavaScript 的特性，主要目的是为栅格化图形提供常用的计算功能。所以它内建的数据类型例如 vec2, vec3 和 vec4 分别代表两个值，三个值和四个值，类似的还有 mat2, mat3 和 mat4 分别代表 2x2, 3x3 和 4x4 矩阵。你可以做一些运算例如常量和矢量的乘法。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16206672130192245000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 a = vec4(1, 2, 3, 4);\nvec4 b = a * 2.0;\n// b 现在是 vec4(2, 4, 6, 8);`, `16206672130192245000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> a <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">vec4</span> b <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2.0</span><span class="token punctuation">;</span>\n<span class="token comment">// b 现在是 vec4(2, 4, 6, 8);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>它同样可以做矩阵乘法以及矢量和矩阵的乘法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16730272331869323000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`mat4 a = ???\nmat4 b = ???\nmat4 c = a * b;\n\nvec4 v = ???\nvec4 y = c * v;`, `16730272331869323000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">mat4</span> a <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">mat4</span> b <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">mat4</span> c <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>\n\n<span class="token keyword">vec4</span> v <span class="token operator">=</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>\n<span class="token keyword">vec4</span> y <span class="token operator">=</span> c <span class="token operator">*</span> v<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>他还为矢量数据提供多种分量选择器，例如 vec4</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29172635454663086000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 v;`, `29172635454663086000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> v<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<ul>\n<li>v.x 和 v.s 以及 v.r ， <code class="language-text">v[0]</code> 表达的是同一个分量。</li>\n<li>v.y 和 v.t 以及 v.g ， <code class="language-text">v[1]</code> 表达的是同一个分量。</li>\n<li>v.z 和 v.p 以及 v.b ， <code class="language-text">v[2]</code> 表达的是同一个分量。</li>\n<li>v.w 和 v.q 以及 v.a ， <code class="language-text">v[3]</code> 表达的是同一个分量。</li>\n</ul>\n<p>它还支持矢量调制，意味者你可以交换或重复分量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82824739069651170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v.yyyy`, `82824739069651170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v<span class="token punctuation">.</span>yyyy</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96088570156638470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.y, v.y, v.y, v.y)`, `96088570156638470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v<span class="token punctuation">.</span>y<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。同样的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59105973633473920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`v.bgra`, `59105973633473920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">v<span class="token punctuation">.</span>bgra</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23989683552192110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.b, v.g, v.r, v.a)`, `23989683552192110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> v<span class="token punctuation">.</span>g<span class="token punctuation">,</span> v<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v<span class="token punctuation">.</span>a<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>等价。当构造一个矢量或矩阵时可以一次提供多个分量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89282181315708000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.rgb, 1)`, `89282181315708000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19545715456813230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(v.r, v.g, v.b, 1)`, `19545715456813230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>r<span class="token punctuation">,</span> v<span class="token punctuation">.</span>g<span class="token punctuation">,</span> v<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。同样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39067268451806840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(1)`, `39067268451806840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57881597903236506000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4(1, 1, 1, 1)`, `57881597903236506000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>相同。值得注意的是 GLSL 是一个强类型的语言。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81998355482227600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float f = 1;  // 错误，1 是 int 类型，不能将 int 型赋值给 float`, `81998355482227600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 错误，1 是 int 类型，不能将 int 型赋值给 float</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>正确的方式是</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70333247145644220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`float f = 1.0;      // 使用 float\nfloat f = float(1)  // 转换 integer 为 float`, `70333247145644220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>      <span class="token comment">// 使用 float</span>\n<span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token keyword">float</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// 转换 integer 为 float</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>上例中 <code class="language-text">vec4(v.rgb, 1)</code> 不会因为 1 报错，因为 vec4 内部进行了转换类似 <code class="language-text">float(1)</code> 。</p>\n<p>GLSL 有一系列内置方法，其中大多数运算支持多种数据类型，并且一次可以运算多个分量，例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51691775203524305000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`T sin(T angle)`, `51691775203524305000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl">T <span class="token function">sin</span><span class="token punctuation">(</span>T angle<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>T 可以是 float, vec2, vec3 或 vec4。如果你传的是 vec4 返回的也是 vec4, 返回结果对应每个分量的正弦值。换句话说如果 v 是 vec4 类型。那么</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69385315559334535000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 s = sin(v);`, `69385315559334535000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> s <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6128500408832016000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 s = vec4(sin(v.x), sin(v.y), sin(v.z), sin(v.w));`, `6128500408832016000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> s <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>是一样的。有时一个参数是浮点型而剩下的都是 T，意思是那个浮点数据会作为所有其他参数的一个新分量。例如如果 v1 和 v2 是 vec4 同时 f 是浮点型，那么</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88139039379571950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 m = mix(v1, v2, f);`, `88139039379571950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> m <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>和</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29716989924331872000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`vec4 m = vec4(\n  mix(v1.x, v2.x, f),\n  mix(v1.y, v2.y, f),\n  mix(v1.z, v2.z, f),\n  mix(v1.w, v2.w, f));`, `29716989924331872000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">vec4</span> m <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>y<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>z<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>z<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">mix</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>w<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>w<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>等价。你可以在 <a href="https://www.khronos.org/files/webgl/webgl-reference-card-1_0.pdf" target="_blank" rel="nofollow noreferrer noopener">WebGL 引用表</a> 最后一页看到所有 GLSL 方法的列表。如果你喜欢干货以更详细的东西你可以看看 <a href="https://www.khronos.org/files/opengles_shading_language.pdf" target="_blank" rel="nofollow noreferrer noopener">GLSL 规范</a>。</p>\n<h2 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>\n<p>这是当前系列文章的重点。WebGL 的全部内容就是创建不同的着色器，向着色器提供数据然后调用 gl.drawArrays 或 gl.drawElements 让 WebGL 调用当前顶点着色器处理每个顶点，调用当前片断着色器渲染每个像素。</p>\n<p>实际上创建着色器需要为数不多的几行代码，并且在大多数 WebGL 应用程序中都相似， 因此一旦写完几乎可以不再关心它们了。</p>\n<h1 id="webgl-state-diagram"><a href="#webgl-state-diagram" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL State Diagram</h1>\n<html><head></head><body><iframe data-src="https://codesandbox.io/embed/8gqf5w?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=preview" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe></body></html>\n<!-- [webgl-state-diagram](embedded-codesandbox://webgl-fundamental-base-concept/webgl-state-diagram) -->',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/WebGL 理论基础——基础概念/index.md absPath of file >>> MarkdownRemark",timeToRead:34,frontmatter:{date:"2022-04-26 11:03:10",path:"/webgl-fundamental-base-concept/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 理论基础——基础概念",draft:null}},{excerpt:"版本一 版本二 工具 虚拟环境 对象自省 语法 异常 For - Else 三元运算符 Global Return open 函数  和  上下文管理器 // TODO  https://py.eastlakeside.cn/book/FunctionalProgramming/README.html",html:'<h1 id="版本一"><a href="#%E7%89%88%E6%9C%AC%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本一</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44203902039624430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# _*_ coding: utf-8 _*_\n\n&quot;&quot;&quot;类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算&quot;&quot;&quot;\n\n#-- 寻求帮助:\n    dir(obj)            # 简单的列出对象obj所包含的方法名称，返回一个字符串列表\n    help(obj.func)      # 查询obj.func的具体介绍和用法\n\n#-- 测试类型的三种方法，推荐第三种\n    if type(L) == type([]):\n        print(&quot;L is list&quot;)\n    if type(L) == list:\n        print(&quot;L is list&quot;)\n    if isinstance(L, list):\n        print(&quot;L is list&quot;)\n\n#-- Python数据类型：哈希类型、不可哈希类型\n    # 哈希类型，即在原地不能改变的变量类型，不可变类型。可利用hash函数查看其hash值，也可以作为字典的key\n    &quot;数字类型：int, float, decimal.Decimal, fractions.Fraction, complex&quot;\n    &quot;字符串类型：str, bytes&quot;\n    &quot;元组：tuple&quot;\n    &quot;冻结集合：frozenset&quot;\n    &quot;布尔类型：True, False&quot;\n    &quot;None&quot;\n    # 不可hash类型：原地可变类型：list、dict和set。它们不可以作为字典的key。\n\n#-- 数字常量\n    1234, -1234, 0, 999999999                    # 整数\n    1.23, 1., 3.14e-10, 4E210, 4.0e+210          # 浮点数\n    0o177, 0x9ff, 0X9FF, 0b101010                # 八进制、十六进制、二进制数字\n    3+4j, 3.0+4.0j, 3J                           # 复数常量，也可以用complex(real, image)来创建\n    hex(I), oct(I), bin(I)                       # 将十进制数转化为十六进制、八进制、二进制表示的“字符串”\n    int(string, base)                            # 将字符串转化为整数，base为进制数\n    # 2.x中，有两种整数类型：一般整数（32位）和长整数（无穷精度）。可以用l或L结尾，迫使一般整数成为长整数\n    float(\'inf\'), float(\'-inf\'), float(\'nan\')    # 无穷大, 无穷小, 非数\n\n#-- 数字的表达式操作符\n    yield x                                      # 生成器函数发送协议\n    lambda args: expression                      # 生成匿名函数\n    x if y else z                                # 三元选择表达式\n    x and y, x or y, not x                       # 逻辑与、逻辑或、逻辑非\n    x in y, x not in y                           # 成员对象测试\n    x is y, x is not y                           # 对象实体测试\n    x<y, x<=y, x>y, x>=y, x==y, x!=y             # 大小比较，集合子集或超集值相等性操作符\n    1 < a < 3                                    # Python中允许连续比较\n    x|y, x&y, x^y                                # 位或、位与、位异或\n    x<<y, x>>y                                   # 位操作：x左移、右移y位\n    +, -, *, /, //, %, **                        # 真除法、floor除法：返回不大于真除法结果的整数值、取余、幂运算\n    -x, +x, ~x                                   # 一元减法、识别、按位求补（取反）\n    x[i], x[i:j:k]                               # 索引、分片\n    int(3.14), float(3)                          # 强制类型转换\n\n#-- 整数可以利用bit_length函数测试所占的位数\n    a = 1;       a.bit_length()    # 1\n    a = 1024;    a.bit_length()    # 11\n\n#-- repr和str显示格式的区别\n    &quot;&quot;&quot;\n    repr格式：默认的交互模式回显，产生的结果看起来它们就像是代码。\n    str格式：打印语句，转化成一种对用户更加友好的格式。\n    &quot;&quot;&quot;\n\n#-- 数字相关的模块\n    # math模块\n    # Decimal模块：小数模块\n        import decimal\n        from decimal import Decimal\n        Decimal(&quot;0.01&quot;) + Decimal(&quot;0.02&quot;)        # 返回Decimal(&quot;0.03&quot;)\n        decimal.getcontext().prec = 4            # 设置全局精度为4 即小数点后边4位\n    # Fraction模块：分数模块\n        from fractions import Fraction\n        x = Fraction(4, 6)                       # 分数类型 4/6\n        x = Fraction(&quot;0.25&quot;)                     # 分数类型 1/4 接收字符串类型的参数\n\n#-- 集合set\n    &quot;&quot;&quot;\n    set是一个无序不重复元素集, 基本功能包括关系测试和消除重复元素。\n    set支持union(联合), intersection(交), difference(差)和symmetric difference(对称差集)等数学运算。\n    set支持x in set, len(set), for x in set。\n    set不记录元素位置或者插入点, 因此不支持indexing, slicing, 或其它类序列的操作\n    &quot;&quot;&quot;\n    s = set([3,5,9,10])                          # 创建一个数值集合，返回{3, 5, 9, 10}\n    t = set(&quot;Hello&quot;)                             # 创建一个字符的集合，返回{\'l\', \'H\', \'e\', \'o\'}\n    a = t | s;    t.union(s)                     # t 和 s的并集\n    b = t & s;    t.intersection(s)              # t 和 s的交集\n    c = t – s;    t.difference(s)                # 求差集（项在t中, 但不在s中）\n    d = t ^ s;    t.symmetric_difference(s)      # 对称差集（项在t或s中, 但不会同时出现在二者中）\n    t.add(\'x\');   t.remove(\'H\')                  # 增加/删除一个item\n    s.update([10,37,42])                         # 利用[......]更新s集合\n    x in s,  x not in s                          # 集合中是否存在某个值\n    s.issubset(t);      s <= t                   # 测试是否 s 中的每一个元素都在 t 中\n    s.issuperset(t);    s >= t                   # 测试是否 t 中的每一个元素都在 s 中\n    s.copy();\n    s.discard(x);                                # 删除s中x\n    s.clear()                                    # 清空s\n    {x**2 for x in [1, 2, 3, 4]}                 # 集合解析，结果：{16, 1, 4, 9}\n    {x for x in \'spam\'}                          # 集合解析，结果：{\'a\', \'p\', \'s\', \'m\'}\n\n#-- 集合frozenset，不可变对象\n    &quot;&quot;&quot;\n    set是可变对象，即不存在hash值，不能作为字典的键值。同样的还有list等(tuple是可以作为字典key的)\n    frozenset是不可变对象，即存在hash值，可作为字典的键值\n    frozenset对象没有add、remove等方法，但有union/intersection/difference等方法\n    &quot;&quot;&quot;\n    a = set([1, 2, 3])\n    b = set()\n    b.add(a)                     # error: set是不可哈希类型\n    b.add(frozenset(a))          # ok，将set变为frozenset，可哈希\n\n#-- 布尔类型bool\n    type(True)                   # 返回<class \'bool\'>\n    isinstance(False, int)       # bool类型属于整型，所以返回True\n    True == 1; True is 1         # 输出(True, False)\n\n#-- 动态类型简介\n    &quot;&quot;&quot;\n    变量名通过引用，指向对象。\n    Python中的“类型”属于对象，而不是变量，每个对象都包含有头部信息，比如&quot;类型标示符&quot; &quot;引用计数器&quot;等\n    &quot;&quot;&quot;\n    #共享引用及在原处修改：对于可变对象，要注意尽量不要共享引用！\n    #共享引用和相等测试：\n        L = [1], M = [1], L is M            # 返回False\n        L = M = [1, 2, 3], L is M           # 返回True，共享引用\n    #增强赋值和共享引用：普通+号会生成新的对象，而增强赋值+=会在原处修改\n        L = M = [1, 2]\n        L = L + [3, 4]                      # L = [1, 2, 3, 4], M = [1, 2]\n        L += [3, 4]                         # L = [1, 2, 3, 4], M = [1, 2, 3, 4]\n\n#-- 常见字符串常量和表达式\n    S = \'\'                                  # 空字符串\n    S = &quot;spam’s&quot;                            # 双引号和单引号相同\n    S = &quot;s\\np\\ta\\x00m&quot;                      # 转义字符\n    S = &quot;&quot;&quot;spam&quot;&quot;&quot;                          # 三重引号字符串，一般用于函数说明\n    S = r\'\\temp\'                            # Raw字符串，不会进行转义，抑制转义\n    S = b\'Spam\'                             # Python3中的字节字符串\n    S = u\'spam\'                             # Python2.6中的Unicode字符串\n    s1+s2, s1*3, s[i], s[i:j], len(s)       # 字符串操作\n    \'a %s parrot\' % \'kind\'                  # 字符串格式化表达式\n    \'a {1} {0} parrot\'.format(\'kind\', \'red\')# 字符串格式化方法\n    for x in s: print(x)                    # 字符串迭代，成员关系\n    [x*2 for x in s]                        # 字符串列表解析\n    \',\'.join([\'a\', \'b\', \'c\'])               # 字符串输出，结果：a,b,c\n\n#-- 内置str处理函数：\n    str1 = &quot;stringobject&quot;\n    str1.upper(); str1.lower(); str1.swapcase(); str1.capitalize(); str1.title()        # 全部大写，全部小写、大小写转换，首字母大写，每个单词的首字母都大写\n    str1.ljust(width)                       # 获取固定长度，左对齐，右边不够用空格补齐\n    str1.rjust(width)                       # 获取固定长度，右对齐，左边不够用空格补齐\n    str1.center(width)                      # 获取固定长度，中间对齐，两边不够用空格补齐\n    str1.zfill(width)                       # 获取固定长度，右对齐，左边不足用0补齐\n    str1.find(\'t\',start,end)                # 查找字符串，可以指定起始及结束位置搜索\n    str1.rfind(\'t\')                         # 从右边开始查找字符串\n    str1.count(\'t\')                         # 查找字符串出现的次数\n    #上面所有方法都可用index代替，不同的是使用index查找不到会抛异常，而find返回-1\n    str1.replace(\'old\',\'new\')               # 替换函数，替换old为new，参数中可以指定maxReplaceTimes，即替换指定次数的old为new\n    str1.strip();                           # 默认删除空白符\n    str1.strip(\'d\');                        # 删除str1字符串中开头、结尾处，位于 d 删除序列的字符\n    str1.lstrip();\n    str1.lstrip(\'d\');                       # 删除str1字符串中开头处，位于 d 删除序列的字符\n    str1.rstrip();\n    str1.rstrip(\'d\')                        # 删除str1字符串中结尾处，位于 d 删除序列的字符\n    str1.startswith(\'start\')                # 是否以start开头\n    str1.endswith(\'end\')                    # 是否以end结尾\n    str1.isalnum(); str1.isalpha(); str1.isdigit(); str1.islower(); str1.isupper()      # 判断字符串是否全为字符、数字、小写、大写\n\n#-- 三重引号编写多行字符串块，并且在代码折行处嵌入换行字符\\n\n    mantra = &quot;&quot;&quot;hello world\n            hello python\n            hello my friend&quot;&quot;&quot;\n    # mantra为&quot;&quot;&quot;hello world \\n hello python \\n hello my friend&quot;&quot;&quot;\n\n#-- 索引和分片：\n    S[0], S[len(S)–1], S[-1]                # 索引\n    S[1:3], S[1:], S[:-1], S[1:10:2]        # 分片，第三个参数指定步长，如\\`S[1:10:2]\\`是从1位到10位没隔2位获取一个字符。\n\n#-- 字符串转换工具：\n    int(\'42\'), str(42)                      # 返回(42, \'42\')\n    float(\'4.13\'), str(4.13)                # 返回(4.13, \'4.13\')\n    ord(\'s\'), chr(115)                      # 返回(115, \'s\')\n    int(\'1001\', 2)                          # 将字符串作为二进制数字，转化为数字，返回9\n    bin(13), oct(13), hex(13)               # 将整数转化为二进制/八进制/十六进制字符串，返回(\'0b1101\', \'015\', \'0xd\')\n\n#-- 另类字符串连接\n    name = &quot;wang&quot; &quot;hong&quot;                    # 单行，name = &quot;wanghong&quot;\n    name = &quot;wang&quot; \\\n            &quot;hong&quot;                          # 多行，name = &quot;wanghong&quot;\n\n#-- Python中的字符串格式化实现1--字符串格式化表达式\n    &quot;&quot;&quot;\n    基于C语言的\'print\'模型，并且在大多数的现有的语言中使用。\n    通用结构：%[(name)][flag][width].[precision]typecode\n    &quot;&quot;&quot;\n    &quot;this is %d %s bird&quot; % (1, \'dead\')                          # 一般的格式化表达式\n    &quot;%s---%s---%s&quot; % (42, 3.14, [1, 2, 3])                      # 字符串输出：\'42---3.14---[1, 2, 3]\'\n    &quot;%d...%6d...%-6d...%06d&quot; % (1234, 1234, 1234, 1234)         # 对齐方式及填充：&quot;1234...  1234...1234  ...001234&quot;\n    x = 1.23456789\n    &quot;%e | %f | %g&quot; % (x, x, x)                                  # 对齐方式：&quot;1.234568e+00 | 1.234568 | 1.23457&quot;\n    &quot;%6.2f*%-6.2f*%06.2f*%+6.2f&quot; % (x, x, x, x)                 # 对齐方式：\'  1.23*1.23  *001.23* +1.23\'\n    &quot;%(name1)d---%(name2)s&quot; % {&quot;name1&quot;:23, &quot;name2&quot;:&quot;value2&quot;}    # 基于字典的格式化表达式\n    &quot;%(name)s is %(age)d&quot; % vars()                              # vars()函数调用返回一个字典，包含了所有本函数调用时存在的变量\n\n#-- Python中的字符串格式化实现2--字符串格式化调用方法\n    # 普通调用\n    &quot;{0}, {1} and {2}&quot;.format(\'spam\', \'ham\', \'eggs\')            # 基于位置的调用\n    &quot;{motto} and {pork}&quot;.format(motto = \'spam\', pork = \'ham\')   # 基于Key的调用\n    &quot;{motto} and {0}&quot;.format(\'ham\', motto = \'spam\')             # 混合调用\n    # 添加键 属性 偏移量 (import sys)\n    &quot;my {1[spam]} runs {0.platform}&quot;.format(sys, {\'spam\':\'laptop\'})                 # 基于位置的键和属性\n    &quot;{config[spam]} {sys.platform}&quot;.format(sys = sys, config = {\'spam\':\'laptop\'})   # 基于Key的键和属性\n    &quot;first = {0[0]}, second = {0[1]}&quot;.format([\'A\', \'B\', \'C\'])                       # 基于位置的偏移量\n    # 具体格式化\n    &quot;{0:e}, {1:.3e}, {2:g}&quot;.format(3.14159, 3.14159, 3.14159)   # 输出\'3.141590e+00, 3.142e+00, 3.14159\'\n    &quot;{fieldname:format_spec}&quot;.format(......)\n    # 说明:\n    &quot;&quot;&quot;\n        fieldname是指定参数的一个数字或关键字, 后边可跟可选的&quot;.name&quot;或&quot;[index]&quot;成分引用\n        format_spec ::=  [[fill]align][sign][#][0][width][,][.precision][type]\n        fill        ::=  <any character>              #填充字符\n        align       ::=  &quot;<&quot; | &quot;>&quot; | &quot;=&quot; | &quot;^&quot;        #对齐方式\n        sign        ::=  &quot;+&quot; | &quot;-&quot; | &quot; &quot;              #符号说明\n        width       ::=  integer                      #字符串宽度\n        precision   ::=  integer                      #浮点数精度\n        type        ::=  &quot;b&quot; | &quot;c&quot; | &quot;d&quot; | &quot;e&quot; | &quot;E&quot; | &quot;f&quot; | &quot;F&quot; | &quot;g&quot; | &quot;G&quot; | &quot;n&quot; | &quot;o&quot; | &quot;s&quot; | &quot;x&quot; | &quot;X&quot; | &quot;%&quot;\n    &quot;&quot;&quot;\n    # 例子:\n        \'={0:10} = {1:10}\'.format(\'spam\', 123.456)    # 输出\'=spam       =    123.456\'\n        \'={0:>10}=\'.format(\'test\')                    # 输出\'=      test=\'\n        \'={0:<10}=\'.format(\'test\')                    # 输出\'=test      =\'\n        \'={0:^10}=\'.format(\'test\')                    # 输出\'=   test   =\'\n        \'{0:X}, {1:o}, {2:b}\'.format(255, 255, 255)   # 输出\'FF, 377, 11111111\'\n        \'My name is {0:{1}}.\'.format(\'Fred\', 8)       # 输出\'My name is Fred    .\'  动态指定参数\n\n#-- 常用列表常量和操作\n    L = [[1, 2], \'string\', {}]                        # 嵌套列表\n    L = list(\'spam\')                                  # 列表初始化\n    L = list(range(0, 4))                             # 列表初始化\n    list(map(ord, \'spam\'))                            # 列表解析\n    len(L)                                            # 求列表长度\n    L.count(value)                                    # 求列表中某个值的个数\n    L.append(obj)                                     # 向列表的尾部添加数据，比如append(2)，添加元素2\n    L.insert(index, obj)                              # 向列表的指定index位置添加数据，index及其之后的数据后移\n    L.extend(interable)                               # 通过添加iterable中的元素来扩展列表，比如extend([2])，添加元素2，注意和append的区别\n    L.index(value, [start, [stop]])                   # 返回列表中值value的第一个索引\n    L.pop([index])                                    # 删除并返回index处的元素，默认为删除并返回最后一个元素\n    L.remove(value)                                   # 删除列表中的value值，只删除第一次出现的value的值\n    L.reverse()                                       # 反转列表\n    L.sort(cmp=None, key=None, reverse=False)         # 排序列表\n    a = [1, 2, 3], b = a[10:]                         # 注意，这里不会引发IndexError异常，只会返回一个空的列表[]\n    a = [], a += [1]                                  # 这里实在原有列表的基础上进行操作，即列表的id没有改变\n    a = [], a = a + [1]                               # 这里最后的a要构建一个新的列表，即a的id发生了变化\n\n#-- 用切片来删除序列的某一段\n    a = [1, 2, 3, 4, 5, 6, 7]\n    a[1:4] = []                                       # a = [1, 5, 6, 7]\n    a = [0, 1, 2, 3, 4, 5, 6, 7]\n    del a[::2]                                        # 去除偶数项(偶数索引的)，a = [1, 3, 5, 7]\n\n#-- 常用字典常量和操作\n    D = {}\n    D = {\'spam\':2, \'tol\':{\'ham\':1}}                   # 嵌套字典\n    D = dict.fromkeys([\'s\', \'d\'], 8)                  # {\'s\': 8, \'d\': 8}\n    D = dict(name = \'tom\', age = 12)                  # {\'age\': 12, \'name\': \'tom\'}\n    D = dict([(\'name\', \'tom\'), (\'age\', 12)])          # {\'age\': 12, \'name\': \'tom\'}\n    D = dict(zip([\'name\', \'age\'], [\'tom\', 12]))       # {\'age\': 12, \'name\': \'tom\'}\n    D.keys(); D.values(); D.items()                   # 字典键、值以及键值对\n    D.get(key, default)                               # get函数\n    D.update(D_other)                                 # 合并字典，如果存在相同的键值，D_other的数据会覆盖掉D的数据\n    D.pop(key, [D])                                   # 删除字典中键值为key的项，返回键值为key的值，如果不存在，返回默认值D，否则异常\n    D.popitem()                                       # pop字典中随机的一项（一个键值对）\n    D.setdefault(k[, d])                              # 设置D中某一项的默认值。如果k存在，则返回D[k]，否则设置D[k]=d，同时返回D[k]。\n    del D                                             # 删除字典\n    del D[\'key\']                                      # 删除字典的某一项\n    if key in D:   if key not in D:                   # 测试字典键是否存在\n    # 字典注意事项：（1）对新索引赋值会添加一项（2）字典键不一定非得是字符串，也可以为任何的不可变对象\n    # 不可变对象：调用对象自身的任意方法，也不会改变该对象自身的内容，这些方法会创建新的对象并返回。\n    # 字符串、整数、tuple都是不可变对象，dict、set、list都是可变对象\n    D[(1,2,3)] = 2                                    # tuple作为字典的key\n\n#-- 字典解析\n    D = {k:8 for k in [\'s\', \'d\']}                     # {\'s\': 8, \'d\': 8}\n    D = {k:v for (k, v) in zip([\'name\', \'age\'], [\'tom\', 12])}       # {\'age\': 12, \'name\': tom}\n\n#-- 字典的特殊方法__missing__：当查找找不到key时，会执行该方法\n    class Dict(dict):\n        def __missing__(self, key):\n            self[key] = []\n            return self[key]\n    dct = dict()\n    dct[&quot;foo&quot;].append(1)    # 这有点类似于collections.defalutdict\n    dct[&quot;foo&quot;]              # [1]\n\n#-- 元组和列表的唯一区别在于元组是不可变对象，列表是可变对象\n    a = [1, 2, 3]           # a[1] = 0, OK\n    a = (1, 2, 3)           # a[1] = 0, Error\n    a = ([1, 2],)           # a[0][1] = 0, OK\n    a = [(1, 2)]            # a[0][1] = 0, Error\n\n#-- 元组的特殊语法: 逗号和圆括号\n    D = (12)                # 此时D为一个整数 即D = 12\n    D = (12, )              # 此时D为一个元组 即D = (12, )\n\n#-- 文件基本操作\n    output = open(r\'C:\\spam\', \'w\')          # 打开输出文件，用于写\n    input = open(\'data\', \'r\')               # 打开输入文件，用于读。打开的方式可以为\'w\', \'r\', \'a\', \'wb\', \'rb\', \'ab\'等\n    fp.read([size])                         # size为读取的长度，以byte为单位\n    fp.readline([size])                     # 读一行，如果定义了size，有可能返回的只是一行的一部分\n    fp.readlines([size])                    # 把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长。\n    fp.readable()                           # 是否可读\n    fp.write(str)                           # 把str写到文件中，write()并不会在str后加上一个换行符\n    fp.writelines(seq)                      # 把seq的内容全部写到文件中(多行一次性写入)\n    fp.writeable()                          # 是否可写\n    fp.close()                              # 关闭文件。\n    fp.flush()                              # 把缓冲区的内容写入硬盘\n    fp.fileno()                             # 返回一个长整型的”文件标签“\n    fp.isatty()                             # 文件是否是一个终端设备文件（unix系统中的）\n    fp.tell()                               # 返回文件操作标记的当前位置，以文件的开头为原点\n    fp.next()                               # 返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。\n    fp.seek(offset[,whence])                # 将文件打开操作标记移到offset的位置。whence为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。\n    fp.seekable()                           # 是否可以seek\n    fp.truncate([size])                     # 把文件裁成规定的大小，默认的是裁到当前文件操作标记的位置。\n    for line in open(\'data\'):\n        print(line)                         # 使用for语句，比较适用于打开比较大的文件\n    with open(\'data\') as file:\n        print(file.readline())              # 使用with语句，可以保证文件关闭\n    with open(\'data\') as file:\n        lines = file.readlines()            # 一次读入文件所有行，并关闭文件\n    open(\'f.txt\', encoding = \'latin-1\')     # Python3.x Unicode文本文件\n    open(\'f.bin\', \'rb\')                     # Python3.x 二进制bytes文件\n    # 文件对象还有相应的属性：buffer closed encoding errors line_buffering name newlines等\n\n#-- 其他\n    # Python中的真假值含义：1. 数字如果非零，则为真，0为假。 2. 其他对象如果非空，则为真\n    # 通常意义下的类型分类：1. 数字、序列、映射。 2. 可变类型和不可变类型\n\n\n&quot;&quot;&quot;语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句&quot;&quot;&quot;\n\n#-- 赋值语句的形式\n    spam = \'spam\'                          # 基本形式\n    spam, ham = \'spam\', \'ham\'              # 元组赋值形式\n    [spam, ham] = [\'s\', \'h\']               # 列表赋值形式\n    a, b, c, d = \'abcd\'                    # 序列赋值形式\n    a, *b, c = \'spam\'                      # 序列解包形式（Python3.x中才有）\n    spam = ham = \'no\'                      # 多目标赋值运算，涉及到共享引用\n    spam += 42                             # 增强赋值，涉及到共享引用\n\n#-- 序列赋值 序列解包\n    [a, b, c] = (1, 2, 3)                  # a = 1, b = 2, c = 3\n    a, b, c, d = &quot;spam&quot;                    # a = \'s\', b = \'p\', c = \'a\', d = \'m\'\n    a, b, c = range(3)                     # a = 0, b = 1, c = 2\n    a, *b = [1, 2, 3, 4]                   # a = 1, b = [2, 3, 4]\n    *a, b = [1, 2, 3, 4]                   # a = [1, 2, 3], b = 4\n    a, *b, c = [1, 2, 3, 4]                # a = 1, b = [2, 3], c = 4\n    # 带有*时 会优先匹配*之外的变量 如\n    a, *b, c = [1, 2]                      # a = 1, c = 2, b = []\n\n#-- print函数原型\n    print(value, ..., sep=\' \', end=\'\\n\', file=sys.stdout, flush=False)\n    # 流的重定向\n    print(\'hello world\')                   # 等于sys.stdout.write(\'hello world\')\n    temp = sys.stdout                      # 原有流的保存\n    sys.stdout = open(\'log.log\', \'a\')      # 流的重定向\n    print(\'hello world\')                   # 写入到文件log.log\n    sys.stdout.close()\n    sys.stdout = temp                      # 原有流的复原\n\n#-- Python中and或or总是返回对象(左边的对象或右边的对象) 且具有短路求值的特性\n    1 or 2 or 3                            # 返回 1\n    1 and 2 and 3                          # 返回 3\n\n#-- if/else三元表达符（if语句在行内）\n    A = 1 if X else 2\n    A = 1 if X else (2 if Y else 3)\n    # 也可以使用and-or语句（一条语句实现多个if-else）\n    a = 6\n    result = (a > 20 and &quot;big than 20&quot; or a > 10 and &quot;big than 10&quot; or a > 5 and &quot;big than 5&quot;)    # 返回&quot;big than 5&quot;\n\n#-- Python的while语句或者for语句可以带else语句 当然也可以带continue/break/pass语句\n    while a > 1:\n        anything\n    else:\n        anything\n    # else语句会在循环结束后执行，除非在循环中执行了break，同样的还有for语句\n    for i in range(5):\n        anything\n    else:\n        anything\n\n#-- for循环的元组赋值\n    for (a, b) in [(1, 2), (3, 4)]:                   # 最简单的赋值\n    for ((a, b), c) in [((1, 2), 3), ((4, 5), 6)]:    # 自动解包赋值\n    for ((a, b), c) in [((1, 2), 3), (&quot;XY&quot;, 6)]:      # 自动解包 a = X, b = Y, c = 6\n    for (a, *b) in [(1, 2, 3), (4, 5, 6)]:            # 自动解包赋值\n\n#-- 列表解析语法\n    M = [[1,2,3], [4,5,6], [7,8,9]]\n    res = [sum(row) for row in M]                     # G = [6, 15, 24] 一般的列表解析 生成一个列表\n    res = [c * 2 for c in \'spam\']                     # [\'ss\', \'pp\', \'aa\', \'mm\']\n    res = [a * b for a in [1, 2] for b in [4, 5]]     # 多解析过程 返回[4, 5, 8, 10]\n    res = [a for a in [1, 2, 3] if a < 2]             # 带判断条件的解析过程\n    res = [a if a > 0 else 0 for a in [-1, 0, 1]]     # 带判断条件的高级解析过程\n    # 两个列表同时解析：使用zip函数\n    for teama, teamb in zip([&quot;Packers&quot;, &quot;49ers&quot;], [&quot;Ravens&quot;, &quot;Patriots&quot;]):\n        print(teama + &quot; vs. &quot; + teamb)\n    # 带索引的列表解析：使用enumerate函数\n    for index, team in enumerate([&quot;Packers&quot;, &quot;49ers&quot;, &quot;Ravens&quot;, &quot;Patriots&quot;]):\n        print(index, team)                            # 输出0, Packers \\n 1, 49ers \\n ......\n\n#-- 生成器表达式\n    G = (sum(row) for row in M)                       # 使用小括号可以创建所需结果的生成器generator object\n    next(G), next(G), next(G)                         # 输出(6, 15, 24)\n    G = {sum(row) for row in M}                       # G = {6, 15, 24} 解析语法还可以生成集合和字典\n    G = {i:sum(M[i]) for i in range(3)}               # G = {0: 6, 1: 15, 2: 24}\n\n#-- 文档字符串:出现在Module的开端以及其中函数或类的开端 使用三重引号字符串\n    &quot;&quot;&quot;\n    module document\n    &quot;&quot;&quot;\n    def func():\n        &quot;&quot;&quot;\n        function document\n        &quot;&quot;&quot;\n        print()\n    class Employee(object):\n        &quot;&quot;&quot;\n        class document\n        &quot;&quot;&quot;\n        print()\n    print(func.__doc__)                # 输出函数文档字符串\n    print(Employee.__doc__)            # 输出类的文档字符串\n\n#-- 命名惯例:\n    &quot;&quot;&quot;\n    以单一下划线开头的变量名(_X)不会被from module import*等语句导入\n    前后有两个下划线的变量名(__X__)是系统定义的变量名，对解释器有特殊意义\n    以两个下划线开头但不以下划线结尾的变量名(__X)是类的本地(私有)变量\n    &quot;&quot;&quot;\n\n#-- 列表解析 in成员关系测试 map sorted zip enumerate内置函数等都使用了迭代协议\n    \'first line\' in open(\'test.txt\')   # in测试 返回True或False\n    list(map(str.upper, open(\'t\')))    # map内置函数\n    sorted(iter([2, 5, 8, 3, 1]))      # sorted内置函数\n    list(zip([1, 2], [3, 4]))          # zip内置函数 [(1, 3), (2, 4)]\n\n#-- del语句: 手动删除某个变量\n    del X\n\n#-- 获取列表的子表的方法:\n    x = [1,2,3,4,5,6]\n    x[:3]                              # 前3个[1,2,3]\n    x[1:5]                             # 中间4个[2,3,4,5]\n    x[-3:]                             # 最后3个[4,5,6]\n    x[::2]                             # 奇数项[1,3,5]\n    x[1::2]                            # 偶数项[2,4,6]\n\n#-- 手动迭代：iter和next\n    L = [1, 2]\n    I = iter(L)                        # I为L的迭代器\n    I.next()                           # 返回1\n    I.next()                           # 返回2\n    I.next()                           # Error:StopIteration\n\n#-- Python中的可迭代对象\n    &quot;&quot;&quot;\n    1.range迭代器\n    2.map、zip和filter迭代器\n    3.字典视图迭代器：D.keys()), D.items()等\n    4.文件类型\n    &quot;&quot;&quot;\n\n\n&quot;&quot;&quot;函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则&quot;&quot;&quot;\n\n#-- 函数相关的语句和表达式\n    myfunc(\'spam\')                     # 函数调用\n    def myfunc():                      # 函数定义\n    return None                        # 函数返回值\n    global a                           # 全局变量\n    nonlocal x                         # 在函数或其他作用域中使用外层（非全局）变量\n    yield x                            # 生成器函数返回\n    lambda                             # 匿名函数\n\n#-- Python函数变量名解析:LEGB原则，即:\n    &quot;&quot;&quot;\n    local(functin) --> encloseing function locals --> global(module) --> build-in(python)\n    说明:以下边的函数maker为例 则相对于action而言 X为Local N为Encloseing\n    &quot;&quot;&quot;\n\n#-- 嵌套函数举例:工厂函数\n    def maker(N):\n        def action(X):\n            return X ** N\n        return action\n    f = maker(2)                       # pass 2 to N\n    f(3)                               # 9, pass 3 to X\n\n#-- 嵌套函数举例:lambda实例\n    def maker(N):\n        action = (lambda X: X**N)\n        return action\n    f = maker(2)                       # pass 2 to N\n    f(3)                               # 9, pass 3 to X\n\n#-- nonlocal和global语句的区别\n    # nonlocal应用于一个嵌套的函数的作用域中的一个名称 例如:\n    start = 100\n    def tester(start):\n        def nested(label):\n            nonlocal start             # 指定start为tester函数内的local变量 而不是global变量start\n            print(label, start)\n            start += 3\n        return nested\n    # global为全局的变量 即def之外的变量\n    def tester(start):\n        def nested(label):\n            global start               # 指定start为global变量start\n            print(label, start)\n            start += 3\n        return nested\n\n#-- 函数参数，不可变参数通过“值”传递，可变参数通过“引用”传递\n    def f(a, b, c): print(a, b, c)\n    f(1, 2, 3)                         # 参数位置匹配\n    f(1, c = 3, b = 2)                 # 参数关键字匹配\n    def f(a, b=1, c=2): print(a, b, c)\n    f(1)                               # 默认参数匹配\n    f(1, 2)                            # 默认参数匹配\n    f(a = 1, c = 3)                    # 关键字参数和默认参数的混合\n    # Keyword-Only参数:出现在*args之后 必须用关键字进行匹配\n    def keyOnly(a, *b, c): print(\'\')   # c就为keyword-only匹配 必须使用关键字c = value匹配\n    def keyOnly(a, *, b, c): ......    # b c为keyword-only匹配 必须使用关键字匹配\n    def keyOnly(a, *, b = 1): ......   # b有默认值 或者省略 或者使用关键字参数b = value\n\n#-- 可变参数匹配: * 和 **\n    def f(*args): print(args)          # 在元组中收集不匹配的位置参数\n    f(1, 2, 3)                         # 输出(1, 2, 3)\n    def f(**args): print(args)         # 在字典中收集不匹配的关键字参数\n    f(a = 1, b = 2)                    # 输出{\'a\':1, \'b\':2}\n    def f(a, *b, **c): print(a, b, c)  # 两者混合使用\n    f(1, 2, 3, x=4, y=5)               # 输出1, (2, 3), {\'x\':4, \'y\':5}\n\n#-- 函数调用时的参数解包: * 和 ** 分别解包元组和字典\n    func(1, *(2, 3))  <==>  func(1, 2, 3)\n    func(1, **{\'c\':3, \'b\':2})  <==>  func(1, b = 2, c = 3)\n    func(1, *(2, 3), **{\'c\':3, \'b\':2})  <==>  func(1, 2, 3, b = 2, c = 3)\n\n#-- 函数属性:(自己定义的)函数可以添加属性\n    def func():.....\n    func.count = 1                     # 自定义函数添加属性\n    print.count = 1                    # Error 内置函数不可以添加属性\n\n#-- 函数注解: 编写在def头部行 主要用于说明参数范围、参数类型、返回值类型等\n    def func(a:\'spam\', b:(1, 10), c:float) -> int :\n        print(a, b, c)\n    func.__annotations__               # {\'c\':<class \'float\'>, \'b\':(1, 10), \'a\':\'spam\', \'return\':<class \'int\'>}\n    # 编写注解的同时 还是可以使用函数默认值 并且注解的位置位于=号的前边\n    def func(a:\'spam\'=\'a\', b:(1, 10)=2, c:float=3) -> int :\n        print(a, b, c)\n\n#-- 匿名函数:lambda\n    f = lambda x, y, z : x + y + z     # 普通匿名函数，使用方法f(1, 2, 3)\n    f = lambda x = 1, y = 1: x + y     # 带默认参数的lambda函数\n    def action(x):                     # 嵌套lambda函数\n        return (lambda y : x + y)\n    f = lambda: a if xxx() else b      # 无参数的lambda函数，使用方法f()\n\n#-- lambda函数与map filter reduce函数的结合\n    list(map((lambda x: x + 1), [1, 2, 3]))              # [2, 3, 4]\n    list(filter((lambda x: x > 0), range(-4, 5)))        # [1, 2, 3, 4]\n    functools.reduce((lambda x, y: x + y), [1, 2, 3])    # 6\n    functools.reduce((lambda x, y: x * y), [2, 3, 4])    # 24\n\n#-- 生成器函数:yield VS return\n    def gensquare(N):\n        for i in range(N):\n            yield i** 2                # 状态挂起 可以恢复到此时的状态\n    for i in gensquare(5):             # 使用方法\n        print(i, end = \' \')            # [0, 1, 4, 9, 16]\n    x = gensquare(2)                   # x是一个生成对象\n    next(x)                            # 等同于x.__next__() 返回0\n    next(x)                            # 等同于x.__next__() 返回1\n    next(x)                            # 等同于x.__next__() 抛出异常StopIteration\n\n#-- 生成器表达式:小括号进行列表解析\n    G = (x ** 2 for x in range(3))     # 使用小括号可以创建所需结果的生成器generator object\n    next(G), next(G), next(G)          # 和上述中的生成器函数的返回值一致\n    #（1）生成器(生成器函数/生成器表达式)是单个迭代对象\n    G = (x ** 2 for x in range(4))\n    I1 = iter(G)                       # 这里实际上iter(G) = G\n    next(I1)                           # 输出0\n    next(G)                            # 输出1\n    next(I1)                           # 输出4\n    #（2）生成器不保留迭代后的结果\n    gen = (i for i in range(4))\n    2 in gen                           # 返回True\n    3 in gen                           # 返回True\n    1 in gen                           # 返回False，其实检测2的时候，1已经就不在生成器中了，即1已经被迭代过了，同理2、3也不在了\n\n#-- 本地变量是静态检测的\n    X = 22                             # 全局变量X的声明和定义\n    def test():\n        print(X)                       # 如果没有下一语句 则该句合法 打印全局变量X\n        X = 88                         # 这一语句使得上一语句非法 因为它使得X变成了本地变量 上一句变成了打印一个未定义的本地变量(局部变量)\n        if False:                      # 即使这样的语句 也会把print语句视为非法语句 因为:\n            X = 88                     # Python会无视if语句而仍然声明了局部变量X\n    def test():                        # 改进\n        global X                       # 声明变量X为全局变量\n        print(X)                       # 打印全局变量X\n        X = 88                         # 改变全局变量X\n\n#-- 函数的默认值是在函数定义的时候实例化的 而不是在调用的时候 例子:\n    def foo(numbers=[]):               # 这里的[]是可变的\n        numbers.append(9)\n        print(numbers)\n    foo()                              # first time, like before, [9]\n    foo()                              # second time, not like before, [9, 9]\n    foo()                              # third time, not like before too, [9, 9, 9]\n    # 改进:\n    def foo(numbers=None):\n        if numbers is None: numbers = []\n        numbers.append(9)\n        print(numbers)\n    # 另外一个例子 参数的默认值为不可变的:\n    def foo(count=0):                  # 这里的0是数字, 是不可变的\n        count += 1\n        print(count)\n    foo()                              # 输出1\n    foo()                              # 还是输出1\n    foo(3)                             # 输出4\n    foo()                              # 还是输出1\n\n\n&quot;&quot;&quot;函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子&quot;&quot;&quot;\n\n    &quot;&quot;&quot;数学运算类&quot;&quot;&quot;\n    abs(x)                              # 求绝对值，参数可以是整型，也可以是复数，若参数是复数，则返回复数的模\n    complex([real[, imag]])             # 创建一个复数\n    divmod(a, b)                        # 分别取商和余数，注意：整型、浮点型都可以\n    float([x])                          # 将一个字符串或数转换为浮点数。如果无参数将返回0.0\n    int([x[, base]])                    # 将一个字符串或浮点数转换为int类型，base表示进制\n    long([x[, base]])                   # 将一个字符串或浮点数转换为long类型\n    pow(x, y)                           # 返回x的y次幂\n    range([start], stop[, step])        # 产生一个序列，默认从0开始\n    round(x[, n])                       # 四舍五入\n    sum(iterable[, start])              # 对集合求和\n    oct(x)                              # 将一个数字转化为8进制字符串\n    hex(x)                              # 将一个数字转换为16进制字符串\n    chr(i)                              # 返回给定int类型对应的ASCII字符\n    unichr(i)                           # 返回给定int类型的unicode\n    ord(c)                              # 返回ASCII字符对应的整数\n    bin(x)                              # 将整数x转换为二进制字符串\n    bool([x])                           # 将x转换为Boolean类型\n\n    &quot;&quot;&quot;集合类操作&quot;&quot;&quot;\n    basestring()                        # str和unicode的超类，不能直接调用，可以用作isinstance判断\n    format(value [, format_spec])       # 格式化输出字符串，格式化的参数顺序从0开始，如“I am {0},I like {1}”\n    enumerate(sequence[, start=0])      # 返回一个可枚举的对象，注意它有第二个参数\n    iter(obj[, sentinel])               # 生成一个对象的迭代器，第二个参数表示分隔符\n    max(iterable[, args...][key])       # 返回集合中的最大值\n    min(iterable[, args...][key])       # 返回集合中的最小值\n    dict([arg])                         # 创建数据字典\n    list([iterable])                    # 将一个集合类转换为另外一个集合类\n    set()                               # set对象实例化\n    frozenset([iterable])               # 产生一个不可变的set\n    tuple([iterable])                   # 生成一个tuple类型\n    str([object])                       # 转换为string类型\n    sorted(iterable[, cmp[, key[, reverse]]])             # 集合排序\n        L = [(\'b\',2),(\'a\',1),(\'c\',3),(\'d\',4)]\n        sorted(L, key=lambda x: x[1], reverse=True)       # 使用Key参数和reverse参数\n        sorted(L, key=lambda x: (x[0], x[1]))             # 使用key参数进行多条件排序，即如果x[0]相同，则比较x[1]\n\n    &quot;&quot;&quot;逻辑判断&quot;&quot;&quot;\n    all(iterable)                       # 集合中的元素都为真的时候为真，特别的，若为空串返回为True\n    any(iterable)                       # 集合中的元素有一个为真的时候为真，特别的，若为空串返回为False\n    cmp(x, y)                           # 如果x < y ,返回负数；x == y, 返回0；x > y,返回正数\n\n    &quot;&quot;&quot;IO操作&quot;&quot;&quot;\n    file(filename [, mode [, bufsize]]) # file类型的构造函数。\n    input([prompt])                     # 获取用户输入，推荐使用raw_input，因为该函数将不会捕获用户的错误输入，意思是自行判断类型\n    # 在 Built-in Functions 里有一句话是这样写的：Consider using the raw_input() function for general input from users.\n    raw_input([prompt])                 # 设置输入，输入都是作为字符串处理\n    open(name[, mode[, buffering]])     # 打开文件，与file有什么不同？推荐使用open\n\n    &quot;&quot;&quot;其他&quot;&quot;&quot;\n    callable(object)                    # 检查对象object是否可调用\n    classmethod(func)                   # 用来说明这个func是个类方法\n    staticmethod(func)                  # 用来说明这个func为静态方法\n    dir([object])                       # 不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。\n    help(obj)                           # 返回obj的帮助信息\n    eval(expression)                    # 计算表达式expression的值，并返回\n    exec(str)                           # 将str作为Python语句执行\n    execfile(filename)                  # 用法类似exec()，不同的是execfile的参数filename为文件名，而exec的参数为字符串。\n    filter(function, iterable)          # 构造一个序列，等价于[item for item in iterable if function(item)]，function返回值为True或False的函数\n        list(filter(bool, range(-3, 4)))# 返回[-3, -2, -1, 1, 2, 3], 没有0\n    hasattr(object, name)               # 判断对象object是否包含名为name的特性\n    getattr(object, name [, defalut])   # 获取一个类的属性\n    setattr(object, name, value)        # 设置属性值\n    delattr(object, name)               # 删除object对象名为name的属性\n    globals()                           # 返回一个描述当前全局符号表的字典\n    hash(object)                        # 如果对象object为哈希表类型，返回对象object的哈希值\n    id(object)                          # 返回对象的唯一标识，一串数字\n    isinstance(object, classinfo)       # 判断object是否是class的实例\n        isinstance(1, int)              # 判断是不是int类型\n        isinstance(1, (int, float))     # isinstance的第二个参数接受一个元组类型\n    issubclass(class, classinfo)        # 判断class是否为classinfo的子类\n    locals()                            # 返回当前的变量列表\n    map(function, iterable, ...)        # 遍历每个元素，执行function操作\n        list(map(abs, range(-3, 4)))    # 返回[3, 2, 1, 0, 1, 2, 3]\n    next(iterator[, default])           # 类似于iterator.next()\n    property([fget[, fset[, fdel[, doc]]]])           # 属性访问的包装类，设置后可以通过c.x=value等来访问setter和getter\n    reduce(function, iterable[, initializer])         # 合并操作，从第一个开始是前两个参数，然后是前两个的结果与第三个合并进行处理，以此类推\n        def add(x,y):return x + y\n        reduce(add, range(1, 11))                     # 返回55 (注:1+2+3+4+5+6+7+8+9+10 = 55)\n        reduce(add, range(1, 11), 20)                 # 返回75\n    reload(module)                      # 重新加载模块\n    repr(object)                        # 将一个对象变幻为可打印的格式\n    slice(start, stop[, step])          # 产生分片对象\n    type(object)                        # 返回该object的类型\n    vars([object])                      # 返回对象的变量名、变量值的字典\n        a = Class();                    # Class为一个空类\n        a.name = \'qi\', a.age = 9\n        vars(a)                         # {\'name\':\'qi\', \'age\':9}\n    zip([iterable, ...])                # 返回对应数组\n        list(zip([1, 2, 3], [4, 5, 6])) # [(1, 4), (2, 5), (3, 6)]\n        a = [1, 2, 3],  b = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]\n        z = zip(a, b)                   # 压缩：[(1, &quot;a&quot;), (2, &quot;b&quot;), (3, &quot;c&quot;)]\n        zip(*z)                         # 解压缩：[(1, 2, 3), (&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)]\n    unicode(string, encoding, errors)   # 将字符串string转化为unicode形式，string为encoded string。\n\n\n&quot;&quot;&quot;模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle&quot;&quot;&quot;\n\n#-- Python模块搜索路径:\n    &quot;&quot;&quot;\n    (1)程序的主目录    (2)PYTHONPATH目录 (3)标准链接库目录 (4)任何.pth文件的内容\n    &quot;&quot;&quot;\n\n#-- 查看全部的模块搜索路径\n    import sys\n    sys.path\n    sys.argv                            # 获得脚本的参数\n    sys.builtin_module_names            # 查找内建模块\n    sys.platform                        # 返回当前平台 出现如： &quot;win32&quot; &quot;linux&quot; &quot;darwin&quot;等\n    sys.modules                         # 查找已导入的模块\n    sys.modules.keys()\n    sys.stdout                          # stdout 和 stderr 都是类文件对象，但是它们都是只写的。它们都没有 read 方法，只有 write 方法\n    sys.stdout.write(&quot;hello&quot;)\n    sys.stderr\n    sys.stdin\n\n#-- 模块的使用代码\n    import module1, module2             # 导入module1 使用module1.printer()\n    from module1 import printer         # 导入module1中的printer变量 使用printer()\n    from module1 import *               # 导入module1中的全部变量 使用不必添加module1前缀\n\n#-- 重载模块reload: 这是一个内置函数 而不是一条语句\n    from imp import reload\n    reload(module)\n\n#-- 模块的包导入:使用点号(.)而不是路径(dir1\\dir2)进行导入\n    import dir1.dir2.mod                # d导入包(目录)dir1中的包dir2中的mod模块 此时dir1必须在Python可搜索路径中\n    from dir1.dir2.mod import *         # from语法的包导入\n\n#-- __init__.py包文件:每个导入的包中都应该包含这么一个文件\n    &quot;&quot;&quot;\n    该文件可以为空\n    首次进行包导入时 该文件会自动执行\n    高级功能:在该文件中使用__all__列表来定义包(目录)以from*的形式导入时 需要导入什么\n    &quot;&quot;&quot;\n\n#-- 包相对导入:使用点号(.) 只能使用from语句\n    from . import spam                  # 导入当前目录下的spam模块（Python2: 当前目录下的模块, 直接导入即可）\n    from .spam import name              # 导入当前目录下的spam模块的name属性（Python2: 当前目录下的模块, 直接导入即可，不用加.）\n    from .. import spam                 # 导入当前目录的父目录下的spam模块\n\n#-- 包相对导入与普通导入的区别\n    from string import *                # 这里导入的string模块为sys.path路径上的 而不是本目录下的string模块(如果存在也不是)\n    from .string import *               # 这里导入的string模块为本目录下的(不存在则导入失败) 而不是sys.path路径上的\n\n#-- 模块数据隐藏:最小化from*的破坏\n    _X                                  # 变量名前加下划线可以防止from*导入时该变量名被复制出去\n    __all__ = [\'x\', \'x1\', \'x2\']         # 使用__all__列表指定from*时复制出去的变量名(变量名在列表中为字符串形式)\n\n#-- 可以使用__name__进行模块的单元测试:当模块为顶层执行文件时值为\'__main__\' 当模块被导入时为模块名\n    if __name__ == \'__main__\':\n        doSomething\n    # 模块属性中还有其他属性，例如：\n    __doc__                             # 模块的说明文档\n    __file__                            # 模块文件的文件名，包括全路径\n    __name__                            # 主文件或者被导入文件\n    __package__                         # 模块所在的包\n\n#-- import语句from语句的as扩展\n    import modulename as name\n    from modulename import attrname as name\n\n#-- 得到模块属性的几种方法 假设为了得到name属性的值\n    M.name\n    M.__dict__[\'name\']\n    sys.modules[\'M\'].name\n    getattr(M, \'name\')\n\n\n&quot;&quot;&quot;类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象&quot;&quot;&quot;\n\n#-- 最普通的类\n    class C1(C2, C3):\n        spam = 42                       # 数据属性\n        def __init__(self, name):       # 函数属性:构造函数\n            self.name = name\n        def __del__(self):              # 函数属性:析构函数\n            print(&quot;goodbey &quot;, self.name)\n    I1 = C1(\'bob\')\n\n#-- Python的类没有基于参数的函数重载\n    class FirstClass(object):\n        def test(self, string):\n            print(string)\n        def test(self):                 # 此时类中只有一个test函数 即后者test(self) 它覆盖掉前者带参数的test函数\n            print(&quot;hello world&quot;)\n\n#-- 子类扩展超类: 尽量调用超类的方法\n    class Manager(Person):\n        def giveRaise(self, percent, bonus = .10):\n            self.pay = int(self.pay*(1 + percent + bonus))     # 不好的方式 复制粘贴超类代码\n            Person.giveRaise(self, percent + bonus)            # 好的方式 尽量调用超类方法\n\n#-- 类内省工具\n    bob = Person(\'bob\')\n    bob.__class__                       # <class \'Person\'>\n    bob.__class__.__name__              # \'Person\'\n    bob.__dict__                        # {\'pay\':0, \'name\':\'bob\', \'job\':\'Manager\'}\n\n#-- 返回1中 数据属性spam是属于类 而不是对象\n    I1 = C1(\'bob\'); I2 = C2(\'tom\')      # 此时I1和I2的spam都为42 但是都是返回的C1的spam属性\n    C1.spam = 24                        # 此时I1和I2的spam都为24\n    I1.spam = 3                         # 此时I1新增自有属性spam 值为3 I2和C1的spam还都为24\n\n#-- 类方法调用的两种方式\n    instance.method(arg...)\n    class.method(instance, arg...)\n\n#-- 抽象超类的实现方法\n    # (1)某个函数中调用未定义的函数 子类中定义该函数\n        def delegate(self):\n            self.action()               # 本类中不定义action函数 所以使用delegate函数时就会出错\n    # (2)定义action函数 但是返回异常\n        def action(self):\n            raise NotImplementedError(&quot;action must be defined&quot;)\n    # (3)上述的两种方法还都可以定义实例对象 实际上可以利用@装饰器语法生成不能定义的抽象超类\n        from abc import ABCMeta, abstractmethod\n        class Super(metaclass = ABCMeta):\n            @abstractmethod\n            def action(self): pass\n        x = Super()                     # 返回 TypeError: Can\'t instantiate abstract class Super with abstract methods action\n\n#-- # OOP和继承: &quot;is-a&quot;的关系\n    class A(B):\n        pass\n    a = A()\n    isinstance(a, B)                    # 返回True, A是B的子类 a也是B的一种\n    # OOP和组合: &quot;has-a&quot;的关系\n    pass\n    # OOP和委托: &quot;包装&quot;对象 在Python中委托通常是以&quot;__getattr__&quot;钩子方法实现的, 这个方法会拦截对不存在属性的读取\n    # 包装类(或者称为代理类)可以使用__getattr__把任意读取转发给被包装的对象\n    class wrapper(object):\n        def __init__(self, object):\n            self.wrapped = object\n        def __getattr(self, attrname):\n            print(\'Trace: \', attrname)\n            return getattr(self.wrapped, attrname)\n    # 注:这里使用getattr(X, N)内置函数以变量名字符串N从包装对象X中取出属性 类似于X.__dict__[N]\n    x = wrapper([1, 2, 3])\n    x.append(4)                         # 返回 &quot;Trace: append&quot; [1, 2, 3, 4]\n    x = wrapper({\'a\':1, \'b\':2})\n    list(x.keys())                      # 返回 &quot;Trace: keys&quot; [\'a\', \'b\']\n\n#-- 类的伪私有属性:使用__attr\n    class C1(object):\n        def __init__(self, name):\n            self.__name = name          # 此时类的__name属性为伪私有属性 原理 它会自动变成self._C1__name = name\n        def __str__(self):\n            return \'self.name = %s\' % self.__name\n    I = C1(\'tom\')\n    print(I)                            # 返回 self.name = tom\n    I.__name = \'jeey\'                   # 这里无法访问 __name为伪私有属性\n    I._C1__name = \'jeey\'                # 这里可以修改成功 self.name = jeey\n\n#-- 类方法是对象:无绑定类方法对象 / 绑定实例方法对象\n    class Spam(object):\n        def doit(self, message):\n            print(message)\n        def selfless(message)\n            print(message)\n    obj = Spam()\n    x = obj.doit                        # 类的绑定方法对象 实例 + 函数\n    x(\'hello world\')\n    x = Spam.doit                       # 类的无绑定方法对象 类名 + 函数\n    x(obj, \'hello world\')\n    x = Spam.selfless                   # 类的无绑定方法函数 在3.0之前无效\n    x(\'hello world\')\n\n#-- 获取对象信息: 属性和方法\n    a = MyObject()\n    dir(a)                              # 使用dir函数\n    hasattr(a, \'x\')                     # 测试是否有x属性或方法 即a.x是否已经存在\n    setattr(a, \'y\', 19)                 # 设置属性或方法 等同于a.y = 19\n    getattr(a, \'z\', 0)                  # 获取属性或方法 如果属性不存在 则返回默认值0\n    #这里有个小技巧，setattr可以设置一个不能访问到的属性，即只能用getattr获取\n    setattr(a, &quot;can\'t touch&quot;, 100)      # 这里的属性名带有空格，不能直接访问\n    getattr(a, &quot;can\'t touch&quot;, 0)        # 但是可以用getattr获取\n\n#-- 为类动态绑定属性或方法: MethodType方法\n    # 一般创建了一个class的实例后, 可以给该实例绑定任何属性和方法, 这就是动态语言的灵活性\n    class Student(object):\n        pass\n    s = Student()\n    s.name = \'Michael\'                  # 动态给实例绑定一个属性\n    def set_age(self, age):             # 定义一个函数作为实例方法\n        self.age = age\n    from types import MethodType\n    s.set_age = MethodType(set_age, s)  # 给实例绑定一个方法 类的其他实例不受此影响\n    s.set_age(25)                       # 调用实例方法\n    Student.set_age = MethodType(set_age, Student)    # 为类绑定一个方法 类的所有实例都拥有该方法\n\n\n&quot;&quot;&quot;类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题&quot;&quot;&quot;\n\n#-- 多重继承: &quot;混合类&quot;, 搜索方式&quot;从下到上 从左到右 广度优先&quot;\n    class A(B, C):\n        pass\n\n#-- 类的继承和子类的初始化\n    # 1.子类定义了__init__方法时，若未显示调用基类__init__方法，python不会帮你调用。\n    # 2.子类未定义__init__方法时，python会自动帮你调用首个基类的__init__方法，注意是首个。\n    # 3.子类显示调用基类的初始化函数：\n    class FooParent(object):\n        def __init__(self, a):\n            self.parent = \'I\\\'m the Parent.\'\n            print(\'Parent:a=\' + str(a))\n        def bar(self, message):\n            print(message + \' from Parent\')\n    class FooChild(FooParent):\n        def __init__(self, a):\n            FooParent.__init__(self, a)\n            print(\'Child:a=\' + str(a))\n        def bar(self, message):\n            FooParent.bar(self, message)\n            print(message + \' from Child\')\n    fooChild = FooChild(10)\n    fooChild.bar(\'HelloWorld\')\n\n#-- #实例方法 / 静态方法 / 类方法\n    class Methods(object):\n        def imeth(self, x): print(self, x)      # 实例方法：传入的是实例和数据，操作的是实例的属性\n        def smeth(x): print(x)                  # 静态方法：只传入数据 不传入实例，操作的是类的属性而不是实例的属性\n        def cmeth(cls, x): print(cls, x)        # 类方法：传入的是类对象和数据\n        smeth = staticmethod(smeth)             # 调用内置函数，也可以使用@staticmethod\n        cmeth = classmethod(cmeth)              # 调用内置函数，也可以使用@classmethod\n    obj = Methods()\n    obj.imeth(1)                                # 实例方法调用 <__main__.Methods object...> 1\n    Methods.imeth(obj, 2)                       # <__main__.Methods object...> 2\n    Methods.smeth(3)                            # 静态方法调用 3\n    obj.smeth(4)                                # 这里可以使用实例进行调用\n    Methods.cmeth(5)                            # 类方法调用 <class \'__main__.Methods\'> 5\n    obj.cmeth(6)                                # <class \'__main__.Methods\'> 6\n\n#-- 函数装饰器:是它后边的函数的运行时的声明 由@符号以及后边紧跟的&quot;元函数&quot;(metafunction)组成\n        @staticmethod\n        def smeth(x): print(x)\n    # 等同于:\n        def smeth(x): print(x)\n        smeth = staticmethod(smeth)\n    # 同理\n        @classmethod\n        def cmeth(cls, x): print(x)\n    # 等同于\n        def cmeth(cls, x): print(x)\n        cmeth = classmethod(cmeth)\n\n#-- 类修饰器:是它后边的类的运行时的声明 由@符号以及后边紧跟的&quot;元函数&quot;(metafunction)组成\n        def decorator(aClass):.....\n        @decorator\n        class C(object):....\n    # 等同于:\n        class C(object):....\n        C = decorator(C)\n\n#-- 限制class属性: __slots__属性\n    class Student(object):\n        __slots__ = (\'name\', \'age\')             # 限制Student及其实例只能拥有name和age属性\n    # __slots__属性只对当前类起作用, 对其子类不起作用\n    # __slots__属性能够节省内存\n    # __slots__属性可以为列表list，或者元组tuple\n\n#-- 类属性高级话题: @property\n    # 假设定义了一个类:C，该类必须继承自object类，有一私有变量_x\n    class C(object):\n        def __init__(self):\n            self.__x = None\n    # 第一种使用属性的方法\n        def getx(self):\n            return self.__x\n        def setx(self, value):\n            self.__x = value\n        def delx(self):\n            del self.__x\n        x = property(getx, setx, delx, \'\')\n    # property函数原型为property(fget=None,fset=None,fdel=None,doc=None)\n    # 使用\n    c = C()\n    c.x = 100                         # 自动调用setx方法\n    y = c.x                           # 自动调用getx方法\n    del c.x                           # 自动调用delx方法\n    # 第二种方法使用属性的方法\n        @property\n        def x(self):\n            return self.__x\n        @x.setter\n        def x(self, value):\n           self.__x = value\n        @x.deleter\n        def x(self):\n           del self.__x\n    # 使用\n    c = C()\n    c.x = 100                         # 自动调用setter方法\n    y = c.x                           # 自动调用x方法\n    del c.x                           # 自动调用deleter方法\n\n#-- 定制类: 重写类的方法\n    # (1)__str__方法、__repr__方法: 定制类的输出字符串\n    # (2)__iter__方法、next方法: 定制类的可迭代性\n    class Fib(object):\n        def __init__(self):\n            self.a, self.b = 0, 1     # 初始化两个计数器a，b\n        def __iter__(self):\n            return self               # 实例本身就是迭代对象，故返回自己\n        def next(self):\n            self.a, self.b = self.b, self.a + self.b\n            if self.a > 100000:       # 退出循环的条件\n                raise StopIteration()\n            return self.a             # 返回下一个值\n    for n in Fib():\n        print(n)                      # 使用\n    # (3)__getitem__方法、__setitem__方法: 定制类的下标操作[] 或者切片操作slice\n    class Indexer(object):\n        def __init__(self):\n            self.data = {}\n        def __getitem__(self, n):             # 定义getitem方法\n            print(\'getitem:\', n)\n            return self.data[n]\n        def __setitem__(self, key, value):    # 定义setitem方法\n            print(\'setitem:key = {0}, value = {1}\'.format(key, value))\n            self.data[key] = value\n    test = Indexer()\n    test[0] = 1;   test[3] = \'3\'              # 调用setitem方法\n    print(test[0])                            # 调用getitem方法\n    # (4)__getattr__方法: 定制类的属性操作\n    class Student(object):\n        def __getattr__(self, attr):          # 定义当获取类的属性时的返回值\n            if attr==\'age\':\n                return 25                     # 当获取age属性时返回25\n        raise AttributeError(\'object has no attribute: %s\' % attr)\n        # 注意: 只有当属性不存在时 才会调用该方法 且该方法默认返回None 需要在函数最后引发异常\n    s = Student()\n    s.age                                     # s中age属性不存在 故调用__getattr__方法 返回25\n    # (5)__call__方法: 定制类的\'可调用\'性\n    class Student(object):\n        def __call__(self):                   # 也可以带参数\n            print(\'Calling......\')\n    s = Student()\n    s()                                       # s变成了可调用的 也可以带参数\n    callable(s)                               # 测试s的可调用性 返回True\n    #    (6)__len__方法：求类的长度\n    def __len__(self):\n        return len(self.data)\n\n#-- 动态创建类type()\n    # 一般创建类 需要在代码中提前定义\n        class Hello(object):\n            def hello(self, name=\'world\'):\n                print(\'Hello, %s.\' % name)\n        h = Hello()\n        h.hello()                             # Hello, world\n        type(Hello)                           # Hello是一个type类型 返回<class \'type\'>\n        type(h)                               # h是一个Hello类型 返回<class \'Hello\'>\n    # 动态类型语言中 类可以动态创建 type函数可用于创建新类型\n        def fn(self, name=\'world\'):           # 先定义函数\n            print(\'Hello, %s.\' % name)\n        Hello = type(\'Hello\', (object,), dict(hello=fn))    # 创建Hello类 type原型: type(name, bases, dict)\n        h = Hello()                           # 此时的h和上边的h一致\n\n\n&quot;&quot;&quot;异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关&quot;&quot;&quot;\n\n#-- #捕获异常:\n        try:\n        except:                               # 捕获所有的异常 等同于except Exception:\n        except name:                          # 捕获指定的异常\n        except name, value:                   # 捕获指定的异常和额外的数据(实例)\n        except (name1, name2):\n        except (name1, name2), value:\n        except name4 as X:\n        else:                                 # 如果没有发生异常\n        finally:                              # 总会执行的部分\n    # 引发异常: raise子句(raise IndexError)\n        raise <instance>                      # raise instance of a class, raise IndexError()\n        raise <class>                         # make and raise instance of a class, raise IndexError\n        raise                                 # reraise the most recent exception\n\n#-- Python3.x中的异常链: raise exception from otherException\n    except Exception as X:\n        raise IndexError(\'Bad\') from X\n\n#-- assert子句: assert <test>, <data>\n    assert x < 0, \'x must be negative\'\n\n#-- with/as环境管理器:作为常见的try/finally用法模式的替代方案\n    with expression [as variable], expression [as variable]:\n    # 例子:\n        with open(\'test.txt\') as myfile:\n            for line in myfile: print(line)\n    # 等同于:\n        myfile = open(\'test.txt\')\n        try:\n            for line in myfile: print(line)\n        finally:\n            myfile.close()\n\n#-- 用户自定义异常: class Bad(Exception):.....\n    &quot;&quot;&quot;\n    Exception超类 / except基类即可捕获到其所有子类\n    Exception超类有默认的打印消息和状态 当然也可以定制打印显示:\n    &quot;&quot;&quot;\n    class MyBad(Exception):\n        def __str__(self):\n            return \'定制的打印消息\'\n    try:\n        MyBad()\n    except MyBad as x:\n        print(x)\n\n#-- 用户定制异常数据\n    class FormatError(Exception):\n        def __init__(self, line ,file):\n            self.line = line\n            self.file = file\n    try:\n        raise FormatError(42, \'test.py\')\n    except FormatError as X:\n        print(\'Error at \', X.file, X.line)\n    # 用户定制异常行为(方法):以记录日志为例\n    class FormatError(Exception):\n        logfile = \'formaterror.txt\'\n        def __init__(self, line ,file):\n            self.line = line\n            self.file = file\n        def logger(self):\n            open(self.logfile, \'a\').write(\'Error at \', self.file, self.line)\n    try:\n        raise FormatError(42, \'test.py\')\n    except FormatError as X:\n        X.logger()\n\n#-- 关于sys.exc_info:允许一个异常处理器获取对最近引发的异常的访问\n    try:\n        ......\n    except:\n        # 此时sys.exc_info()返回一个元组(type, value, traceback)\n        # type:正在处理的异常的异常类型\n        # value:引发的异常的实例\n        # traceback:堆栈信息\n\n#-- 异常层次\n    BaseException\n    +-- SystemExit\n    +-- KeyboardInterrupt\n    +-- GeneratorExit\n    +-- Exception\n        +-- StopIteration\n        +-- ArithmeticError\n        +-- AssertionError\n        +-- AttributeError\n        +-- BufferError\n        +-- EOFError\n        +-- ImportError\n        +-- LookupError\n        +-- MemoryError\n        +-- NameError\n        +-- OSError\n        +-- ReferenceError\n        +-- RuntimeError\n        +-- SyntaxError\n        +-- SystemError\n        +-- TypeError\n        +-- ValueError\n        +-- Warning\n\n\n&quot;&quot;&quot;Unicode和字节字符串---Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串&quot;&quot;&quot;\n\n#-- Python的字符串类型\n    &quot;&quot;&quot;Python2.x&quot;&quot;&quot;\n    # 1.str表示8位文本和二进制数据\n    # 2.unicode表示宽字符Unicode文本\n    &quot;&quot;&quot;Python3.x&quot;&quot;&quot;\n    # 1.str表示Unicode文本（8位或者更宽）\n    # 2.bytes表示不可变的二进制数据\n    # 3.bytearray是一种可变的bytes类型\n\n#-- 字符编码方法\n    &quot;&quot;&quot;ASCII&quot;&quot;&quot;                   # 一个字节，只包含英文字符，0到127，共128个字符，利用函数可以进行字符和数字的相互转换\n    ord(\'a\')                      # 字符a的ASCII码为97，所以这里返回97\n    chr(97)                       # 和上边的过程相反，返回字符\'a\'\n    &quot;&quot;&quot;Latin-1&quot;&quot;&quot;                 # 一个字节，包含特殊字符，0到255，共256个字符，相当于对ASCII码的扩展\n    chr(196)                      # 返回一个特殊字符：Ä\n    &quot;&quot;&quot;Unicode&quot;&quot;&quot;                 # 宽字符，一个字符包含多个字节，一般用于亚洲的字符集，比如中文有好几万字\n    &quot;&quot;&quot;UTF-8&quot;&quot;&quot;                   # 可变字节数，小于128的字符表示为单个字节，128到0X7FF之间的代码转换为两个字节，0X7FF以上的代码转换为3或4个字节\n    # 注意：可以看出来，ASCII码是Latin-1和UTF-8的一个子集\n    # 注意：utf-8是unicode的一种实现方式，unicode、gbk、gb2312是编码字符集\n\n#-- 查看Python中的字符串编码名称，查看系统的编码\n    import encodings\n    help(encoding)\n    import sys\n    sys.platform                  # \'win64\'\n    sys.getdefaultencoding()      # \'utf-8\'\n    sys.getdefaultencoding()      # 返回当前系统平台的编码类型\n    sys.getsizeof(object)         # 返回object占有的bytes的大小\n\n#-- 源文件字符集编码声明: 添加注释来指定想要的编码形式 从而改变默认值 注释必须出现在脚本的第一行或者第二行\n    &quot;&quot;&quot;说明：其实这里只会检查#和coding:utf-8，其余的字符都是为了美观加上的&quot;&quot;&quot;\n    # _*_ coding: utf-8 _*_\n    # coding = utf-8\n\n#-- #编码: 字符串 --> 原始字节       #解码: 原始字节 --> 字符串\n\n#-- Python3.x中的字符串应用\n    s = \'...\'                     # 构建一个str对象，不可变对象\n    b = b\'...\'                    # 构建一个bytes对象，不可变对象\n    s[0], b[0]                    # 返回(\'.\', 113)\n    s[1:], b[1:]                  # 返回(\'..\', b\'..\')\n    B = B&quot;&quot;&quot;\n        xxxx\n        yyyy\n        &quot;&quot;&quot;\n    # B = b\'\\nxxxx\\nyyyy\\n\'\n    # 编码，将str字符串转化为其raw bytes形式：\n        str.encode(encoding = \'utf-8\', errors = \'strict\')\n        bytes(str, encoding)\n    # 编码例子：\n        S = \'egg\'\n        S.encode()                    # b\'egg\'\n        bytes(S, encoding = \'ascii\')  # b\'egg\'\n    # 解码，将raw bytes字符串转化为str形式：\n        bytes.decode(encoding = \'utf-8\', errors = \'strict\')\n        str(bytes_or_buffer[, encoding[, errors]])\n    # 解码例子：\n        B = b\'spam\'\n        B.decode()                # \'spam\'\n        str(B)                    # &quot;b\'spam\'&quot;，不带编码的str调用，结果为打印该bytes对象\n        str(B, encoding = \'ascii\')# \'spam\'，带编码的str调用，结果为转化该bytes对象\n\n#-- Python2.x的编码问题\n    u = u\'汉\'\n    print repr(u)                 # u\'\\xba\\xba\'\n    s = u.encode(\'UTF-8\')\n    print repr(s)                 # \'\\xc2\\xba\\xc2\\xba\'\n    u2 = s.decode(\'UTF-8\')\n    print repr(u2)                # u\'\\xba\\xba\'\n    # 对unicode进行解码是错误的\n    s2 = u.decode(\'UTF-8\')        # UnicodeEncodeError: \'ascii\' codec can\'t encode characters in position 0-1: ordinal not in range(128)\n    # 同样，对str进行编码也是错误的\n    u2 = s.encode(\'UTF-8\')        # UnicodeDecodeError: \'ascii\' codec can\'t decode byte 0xc2 in position 0: ordinal not in range(128)\n\n#-- bytes对象\n    B = b\'abc\'\n    B = bytes(\'abc\', \'ascii\')\n    B = bytes([97, 98, 99])\n    B = \'abc\'.encode()\n    # bytes对象的方法调用基本和str类型一致 但:B[0]返回的是ASCII码值97, 而不是b\'a\'\n\n#-- #文本文件: 根据Unicode编码来解释文件内容，要么是平台的默认编码，要么是指定的编码类型\n    # 二进制文件：表示字节值的整数的一个序列 open(\'bin.txt\', \'rb\')\n\n#-- Unicode文件\n    s = \'A\\xc4B\\xe8C\'             # s = \'A?BèC\'  len(s) = 5\n    #手动编码\n        l = s.encode(\'latin-1\')   # l = b\'A\\xc4B\\xe8C\'  len(l) = 5\n        u = s.encode(\'utf-8\')     # u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7\n    #文件输出编码\n        open(\'latindata\', \'w\', encoding = \'latin-1\').write(s)\n        l = open(\'latindata\', \'rb\').read()                        # l = b\'A\\xc4B\\xe8C\'  len(l) = 5\n        open(\'uft8data\', \'w\', encoding = \'utf-8\').write(s)\n        u = open(\'uft8data\', \'rb\').read()                         # u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7\n    #文件输入编码\n        s = open(\'latindata\', \'r\', encoding = \'latin-1\').read()   # s = \'A?BèC\'  len(s) = 5\n        s = open(\'latindata\', \'rb\').read().decode(\'latin-1\')      # s = \'A?BèC\'  len(s) = 5\n        s = open(\'utf8data\', \'r\', encoding = \'utf-8\').read()      # s = \'A?BèC\'  len(s) = 5\n        s = open(\'utf8data\', \'rb\').read().decode(\'utf-8\')         # s = \'A?BèC\'  len(s) = 5\n\n\n&quot;&quot;&quot;其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他&quot;&quot;&quot;\n\n#-- Python实现任意深度的赋值 例如a[0] = \'value1\'; a[1][2] = \'value2\'; a[3][4][5] = \'value3\'\n    class MyDict(dict):\n        def __setitem__(self, key, value):                 # 该函数不做任何改动 这里只是为了输出\n            print(\'setitem:\', key, value, self)\n            super().__setitem__(key, value)\n        def __getitem__(self, item):                       # 主要技巧在该函数\n            print(\'getitem:\', item, self)                  # 输出信息\n            # 基本思路: a[1][2]赋值时 需要先取出a[1] 然后给a[1]的[2]赋值\n            if item not in self:                           # 如果a[1]不存在 则需要新建一个dict 并使得a[1] = dict\n                temp = MyDict()                            # 新建的dict: temp\n                super().__setitem__(item, temp)            # 赋值a[1] = temp\n                return temp                                # 返回temp 使得temp[2] = value有效\n            return super().__getitem__(item)               # 如果a[1]存在 则直接返回a[1]\n    # 例子:\n        test = MyDict()\n        test[0] = \'test\'\n        print(test[0])\n        test[1][2] = \'test1\'\n        print(test[1][2])\n        test[1][3] = \'test2\'\n        print(test[1][3])\n\n#-- Python中的多维数组\n    lists = [0] * 3                                        # 扩展list，结果为[0, 0, 0]\n    lists = [[]] * 3                                       # 多维数组，结果为[[], [], []]，但有问题，往下看\n    lists[0].append(3)                                     # 期望看到的结果[[3], [], []]，实际结果[[3], [3], [3]]，原因：list*n操作，是浅拷贝，如何避免？往下看\n    lists = [[] for i in range(3)]                         # 多维数组，结果为[[], [], []]\n    lists[0].append(3)                                     # 结果为[[3], [], []]\n    lists[1].append(6)                                     # 结果为[[3], [6], []]\n    lists[2].append(9)                                     # 结果为[[3], [6], [9]]\n    lists = [[[] for j in range(4)] for i in range(3)]     # 3行4列，且每一个元素为[]`, `44203902039624430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># _*_ coding: utf-8 _*_</span>\n\n<span class="token triple-quoted-string string">"""类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算----类型和运算"""</span>\n\n<span class="token comment">#-- 寻求帮助:</span>\n    <span class="token builtin">dir</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>            <span class="token comment"># 简单的列出对象obj所包含的方法名称，返回一个字符串列表</span>\n    <span class="token builtin">help</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>func<span class="token punctuation">)</span>      <span class="token comment"># 查询obj.func的具体介绍和用法</span>\n\n<span class="token comment">#-- 测试类型的三种方法，推荐第三种</span>\n    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"L is list"</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">list</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"L is list"</span><span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"L is list"</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- Python数据类型：哈希类型、不可哈希类型</span>\n    <span class="token comment"># 哈希类型，即在原地不能改变的变量类型，不可变类型。可利用hash函数查看其hash值，也可以作为字典的key</span>\n    <span class="token string">"数字类型：int, float, decimal.Decimal, fractions.Fraction, complex"</span>\n    <span class="token string">"字符串类型：str, bytes"</span>\n    <span class="token string">"元组：tuple"</span>\n    <span class="token string">"冻结集合：frozenset"</span>\n    <span class="token string">"布尔类型：True, False"</span>\n    <span class="token string">"None"</span>\n    <span class="token comment"># 不可hash类型：原地可变类型：list、dict和set。它们不可以作为字典的key。</span>\n\n<span class="token comment">#-- 数字常量</span>\n    <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">999999999</span>                    <span class="token comment"># 整数</span>\n    <span class="token number">1.23</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">3.14e-10</span><span class="token punctuation">,</span> <span class="token number">4E210</span><span class="token punctuation">,</span> <span class="token number">4.0e+210</span>          <span class="token comment"># 浮点数</span>\n    <span class="token number">0o177</span><span class="token punctuation">,</span> <span class="token number">0x9ff</span><span class="token punctuation">,</span> <span class="token number">0X9FF</span><span class="token punctuation">,</span> <span class="token number">0b101010</span>                <span class="token comment"># 八进制、十六进制、二进制数字</span>\n    <span class="token number">3</span><span class="token operator">+</span><span class="token number">4j</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token operator">+</span><span class="token number">4.0j</span><span class="token punctuation">,</span> <span class="token number">3J</span>                           <span class="token comment"># 复数常量，也可以用complex(real, image)来创建</span>\n    <span class="token builtin">hex</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">oct</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">bin</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span>                       <span class="token comment"># 将十进制数转化为十六进制、八进制、二进制表示的“字符串”</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> base<span class="token punctuation">)</span>                            <span class="token comment"># 将字符串转化为整数，base为进制数</span>\n    <span class="token comment"># 2.x中，有两种整数类型：一般整数（32位）和长整数（无穷精度）。可以用l或L结尾，迫使一般整数成为长整数</span>\n    <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'inf\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'-inf\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'nan\'</span><span class="token punctuation">)</span>    <span class="token comment"># 无穷大, 无穷小, 非数</span>\n\n<span class="token comment">#-- 数字的表达式操作符</span>\n    <span class="token keyword">yield</span> x                                      <span class="token comment"># 生成器函数发送协议</span>\n    <span class="token keyword">lambda</span> args<span class="token punctuation">:</span> expression                      <span class="token comment"># 生成匿名函数</span>\n    x <span class="token keyword">if</span> y <span class="token keyword">else</span> z                                <span class="token comment"># 三元选择表达式</span>\n    x <span class="token keyword">and</span> y<span class="token punctuation">,</span> x <span class="token keyword">or</span> y<span class="token punctuation">,</span> <span class="token keyword">not</span> x                       <span class="token comment"># 逻辑与、逻辑或、逻辑非</span>\n    x <span class="token keyword">in</span> y<span class="token punctuation">,</span> x <span class="token keyword">not</span> <span class="token keyword">in</span> y                           <span class="token comment"># 成员对象测试</span>\n    x <span class="token keyword">is</span> y<span class="token punctuation">,</span> x <span class="token keyword">is</span> <span class="token keyword">not</span> y                           <span class="token comment"># 对象实体测试</span>\n    x<span class="token operator">&lt;</span>y<span class="token punctuation">,</span> x<span class="token operator">&lt;=</span>y<span class="token punctuation">,</span> x<span class="token operator">></span>y<span class="token punctuation">,</span> x<span class="token operator">>=</span>y<span class="token punctuation">,</span> x<span class="token operator">==</span>y<span class="token punctuation">,</span> x<span class="token operator">!=</span>y             <span class="token comment"># 大小比较，集合子集或超集值相等性操作符</span>\n    <span class="token number">1</span> <span class="token operator">&lt;</span> a <span class="token operator">&lt;</span> <span class="token number">3</span>                                    <span class="token comment"># Python中允许连续比较</span>\n    x<span class="token operator">|</span>y<span class="token punctuation">,</span> x<span class="token operator">&amp;</span>y<span class="token punctuation">,</span> x<span class="token operator">^</span>y                                <span class="token comment"># 位或、位与、位异或</span>\n    x<span class="token operator">&lt;&lt;</span>y<span class="token punctuation">,</span> x<span class="token operator">>></span>y                                   <span class="token comment"># 位操作：x左移、右移y位</span>\n    <span class="token operator">+</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token operator">/</span><span class="token punctuation">,</span> <span class="token operator">//</span><span class="token punctuation">,</span> <span class="token operator">%</span><span class="token punctuation">,</span> <span class="token operator">**</span>                        <span class="token comment"># 真除法、floor除法：返回不大于真除法结果的整数值、取余、幂运算</span>\n    <span class="token operator">-</span>x<span class="token punctuation">,</span> <span class="token operator">+</span>x<span class="token punctuation">,</span> <span class="token operator">~</span>x                                   <span class="token comment"># 一元减法、识别、按位求补（取反）</span>\n    x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span>i<span class="token punctuation">:</span>j<span class="token punctuation">:</span>k<span class="token punctuation">]</span>                               <span class="token comment"># 索引、分片</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                          <span class="token comment"># 强制类型转换</span>\n\n<span class="token comment">#-- 整数可以利用bit_length函数测试所占的位数</span>\n    a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       a<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 1</span>\n    a <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>    a<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 11</span>\n\n<span class="token comment">#-- repr和str显示格式的区别</span>\n    <span class="token triple-quoted-string string">"""\n    repr格式：默认的交互模式回显，产生的结果看起来它们就像是代码。\n    str格式：打印语句，转化成一种对用户更加友好的格式。\n    """</span>\n\n<span class="token comment">#-- 数字相关的模块</span>\n    <span class="token comment"># math模块</span>\n    <span class="token comment"># Decimal模块：小数模块</span>\n        <span class="token keyword">import</span> decimal\n        <span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal\n        Decimal<span class="token punctuation">(</span><span class="token string">"0.01"</span><span class="token punctuation">)</span> <span class="token operator">+</span> Decimal<span class="token punctuation">(</span><span class="token string">"0.02"</span><span class="token punctuation">)</span>        <span class="token comment"># 返回Decimal("0.03")</span>\n        decimal<span class="token punctuation">.</span>getcontext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prec <span class="token operator">=</span> <span class="token number">4</span>            <span class="token comment"># 设置全局精度为4 即小数点后边4位</span>\n    <span class="token comment"># Fraction模块：分数模块</span>\n        <span class="token keyword">from</span> fractions <span class="token keyword">import</span> Fraction\n        x <span class="token operator">=</span> Fraction<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>                       <span class="token comment"># 分数类型 4/6</span>\n        x <span class="token operator">=</span> Fraction<span class="token punctuation">(</span><span class="token string">"0.25"</span><span class="token punctuation">)</span>                     <span class="token comment"># 分数类型 1/4 接收字符串类型的参数</span>\n\n<span class="token comment">#-- 集合set</span>\n    <span class="token triple-quoted-string string">"""\n    set是一个无序不重复元素集, 基本功能包括关系测试和消除重复元素。\n    set支持union(联合), intersection(交), difference(差)和symmetric difference(对称差集)等数学运算。\n    set支持x in set, len(set), for x in set。\n    set不记录元素位置或者插入点, 因此不支持indexing, slicing, 或其它类序列的操作\n    """</span>\n    s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                          <span class="token comment"># 创建一个数值集合，返回{3, 5, 9, 10}</span>\n    t <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span>                             <span class="token comment"># 创建一个字符的集合，返回{\'l\', \'H\', \'e\', \'o\'}</span>\n    a <span class="token operator">=</span> t <span class="token operator">|</span> s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>union<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                     <span class="token comment"># t 和 s的并集</span>\n    b <span class="token operator">=</span> t <span class="token operator">&amp;</span> s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>intersection<span class="token punctuation">(</span>s<span class="token punctuation">)</span>              <span class="token comment"># t 和 s的交集</span>\n    c <span class="token operator">=</span> t – s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>difference<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                <span class="token comment"># 求差集（项在t中, 但不在s中）</span>\n    d <span class="token operator">=</span> t <span class="token operator">^</span> s<span class="token punctuation">;</span>    t<span class="token punctuation">.</span>symmetric_difference<span class="token punctuation">(</span>s<span class="token punctuation">)</span>      <span class="token comment"># 对称差集（项在t或s中, 但不会同时出现在二者中）</span>\n    t<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">\'x\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   t<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">\'H\'</span><span class="token punctuation">)</span>                  <span class="token comment"># 增加/删除一个item</span>\n    s<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                         <span class="token comment"># 利用[......]更新s集合</span>\n    x <span class="token keyword">in</span> s<span class="token punctuation">,</span>  x <span class="token keyword">not</span> <span class="token keyword">in</span> s                          <span class="token comment"># 集合中是否存在某个值</span>\n    s<span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>      s <span class="token operator">&lt;=</span> t                   <span class="token comment"># 测试是否 s 中的每一个元素都在 t 中</span>\n    s<span class="token punctuation">.</span>issuperset<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>    s <span class="token operator">>=</span> t                   <span class="token comment"># 测试是否 t 中的每一个元素都在 s 中</span>\n    s<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    s<span class="token punctuation">.</span>discard<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment"># 删除s中x</span>\n    s<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>                                    <span class="token comment"># 清空s</span>\n    <span class="token punctuation">{</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">}</span>                 <span class="token comment"># 集合解析，结果：{16, 1, 4, 9}</span>\n    <span class="token punctuation">{</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token string">\'spam\'</span><span class="token punctuation">}</span>                          <span class="token comment"># 集合解析，结果：{\'a\', \'p\', \'s\', \'m\'}</span>\n\n<span class="token comment">#-- 集合frozenset，不可变对象</span>\n    <span class="token triple-quoted-string string">"""\n    set是可变对象，即不存在hash值，不能作为字典的键值。同样的还有list等(tuple是可以作为字典key的)\n    frozenset是不可变对象，即存在hash值，可作为字典的键值\n    frozenset对象没有add、remove等方法，但有union/intersection/difference等方法\n    """</span>\n    a <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    b <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    b<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">)</span>                     <span class="token comment"># error: set是不可哈希类型</span>\n    b<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token builtin">frozenset</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment"># ok，将set变为frozenset，可哈希</span>\n\n<span class="token comment">#-- 布尔类型bool</span>\n    <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>                   <span class="token comment"># 返回&lt;class \'bool\'></span>\n    <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>       <span class="token comment"># bool类型属于整型，所以返回True</span>\n    <span class="token boolean">True</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token boolean">True</span> <span class="token keyword">is</span> <span class="token number">1</span>         <span class="token comment"># 输出(True, False)</span>\n\n<span class="token comment">#-- 动态类型简介</span>\n    <span class="token triple-quoted-string string">"""\n    变量名通过引用，指向对象。\n    Python中的“类型”属于对象，而不是变量，每个对象都包含有头部信息，比如"类型标示符" "引用计数器"等\n    """</span>\n    <span class="token comment">#共享引用及在原处修改：对于可变对象，要注意尽量不要共享引用！</span>\n    <span class="token comment">#共享引用和相等测试：</span>\n        L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L <span class="token keyword">is</span> M            <span class="token comment"># 返回False</span>\n        L <span class="token operator">=</span> M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L <span class="token keyword">is</span> M           <span class="token comment"># 返回True，共享引用</span>\n    <span class="token comment">#增强赋值和共享引用：普通+号会生成新的对象，而增强赋值+=会在原处修改</span>\n        L <span class="token operator">=</span> M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n        L <span class="token operator">=</span> L <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                      <span class="token comment"># L = [1, 2, 3, 4], M = [1, 2]</span>\n        L <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                         <span class="token comment"># L = [1, 2, 3, 4], M = [1, 2, 3, 4]</span>\n\n<span class="token comment">#-- 常见字符串常量和表达式</span>\n    S <span class="token operator">=</span> <span class="token string">\'\'</span>                                  <span class="token comment"># 空字符串</span>\n    S <span class="token operator">=</span> <span class="token string">"spam’s"</span>                            <span class="token comment"># 双引号和单引号相同</span>\n    S <span class="token operator">=</span> <span class="token string">"s\\np\\ta\\x00m"</span>                      <span class="token comment"># 转义字符</span>\n    S <span class="token operator">=</span> <span class="token triple-quoted-string string">"""spam"""</span>                          <span class="token comment"># 三重引号字符串，一般用于函数说明</span>\n    S <span class="token operator">=</span> <span class="token string">r\'\\temp\'</span>                            <span class="token comment"># Raw字符串，不会进行转义，抑制转义</span>\n    S <span class="token operator">=</span> <span class="token string">b\'Spam\'</span>                             <span class="token comment"># Python3中的字节字符串</span>\n    S <span class="token operator">=</span> <span class="token string">u\'spam\'</span>                             <span class="token comment"># Python2.6中的Unicode字符串</span>\n    s1<span class="token operator">+</span>s2<span class="token punctuation">,</span> s1<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">[</span>i<span class="token punctuation">:</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>       <span class="token comment"># 字符串操作</span>\n    <span class="token string">\'a %s parrot\'</span> <span class="token operator">%</span> <span class="token string">\'kind\'</span>                  <span class="token comment"># 字符串格式化表达式</span>\n    <span class="token string">\'a {1} {0} parrot\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'kind\'</span><span class="token punctuation">,</span> <span class="token string">\'red\'</span><span class="token punctuation">)</span><span class="token comment"># 字符串格式化方法</span>\n    <span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                    <span class="token comment"># 字符串迭代，成员关系</span>\n    <span class="token punctuation">[</span>x<span class="token operator">*</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> s<span class="token punctuation">]</span>                        <span class="token comment"># 字符串列表解析</span>\n    <span class="token string">\',\'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> <span class="token string">\'c\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment"># 字符串输出，结果：a,b,c</span>\n\n<span class="token comment">#-- 内置str处理函数：</span>\n    str1 <span class="token operator">=</span> <span class="token string">"stringobject"</span>\n    str1<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>swapcase<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 全部大写，全部小写、大小写转换，首字母大写，每个单词的首字母都大写</span>\n    str1<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                       <span class="token comment"># 获取固定长度，左对齐，右边不够用空格补齐</span>\n    str1<span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                       <span class="token comment"># 获取固定长度，右对齐，左边不够用空格补齐</span>\n    str1<span class="token punctuation">.</span>center<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                      <span class="token comment"># 获取固定长度，中间对齐，两边不够用空格补齐</span>\n    str1<span class="token punctuation">.</span>zfill<span class="token punctuation">(</span>width<span class="token punctuation">)</span>                       <span class="token comment"># 获取固定长度，右对齐，左边不足用0补齐</span>\n    str1<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">,</span>start<span class="token punctuation">,</span>end<span class="token punctuation">)</span>                <span class="token comment"># 查找字符串，可以指定起始及结束位置搜索</span>\n    str1<span class="token punctuation">.</span>rfind<span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">)</span>                         <span class="token comment"># 从右边开始查找字符串</span>\n    str1<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">)</span>                         <span class="token comment"># 查找字符串出现的次数</span>\n    <span class="token comment">#上面所有方法都可用index代替，不同的是使用index查找不到会抛异常，而find返回-1</span>\n    str1<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">\'old\'</span><span class="token punctuation">,</span><span class="token string">\'new\'</span><span class="token punctuation">)</span>               <span class="token comment"># 替换函数，替换old为new，参数中可以指定maxReplaceTimes，即替换指定次数的old为new</span>\n    str1<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment"># 默认删除空白符</span>\n    str1<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment"># 删除str1字符串中开头、结尾处，位于 d 删除序列的字符</span>\n    str1<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    str1<span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token comment"># 删除str1字符串中开头处，位于 d 删除序列的字符</span>\n    str1<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    str1<span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">)</span>                        <span class="token comment"># 删除str1字符串中结尾处，位于 d 删除序列的字符</span>\n    str1<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span>                <span class="token comment"># 是否以start开头</span>\n    str1<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">\'end\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 是否以end结尾</span>\n    str1<span class="token punctuation">.</span>isalnum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>isalpha<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>islower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> str1<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># 判断字符串是否全为字符、数字、小写、大写</span>\n\n<span class="token comment">#-- 三重引号编写多行字符串块，并且在代码折行处嵌入换行字符\\n</span>\n    mantra <span class="token operator">=</span> <span class="token triple-quoted-string string">"""hello world\n            hello python\n            hello my friend"""</span>\n    <span class="token comment"># mantra为"""hello world \\n hello python \\n hello my friend"""</span>\n\n<span class="token comment">#-- 索引和分片：</span>\n    S<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>S<span class="token punctuation">)</span>–<span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token comment"># 索引</span>\n    S<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> S<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>        <span class="token comment"># 分片，第三个参数指定步长，如`S[1:10:2]`是从1位到10位没隔2位获取一个字符。</span>\n\n<span class="token comment">#-- 字符串转换工具：</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'42\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回(42, \'42\')</span>\n    <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">\'4.13\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">4.13</span><span class="token punctuation">)</span>                <span class="token comment"># 返回(4.13, \'4.13\')</span>\n    <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">\'s\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回(115, \'s\')</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">\'1001\'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                          <span class="token comment"># 将字符串作为二进制数字，转化为数字，返回9</span>\n    <span class="token builtin">bin</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">oct</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>               <span class="token comment"># 将整数转化为二进制/八进制/十六进制字符串，返回(\'0b1101\', \'015\', \'0xd\')</span>\n\n<span class="token comment">#-- 另类字符串连接</span>\n    name <span class="token operator">=</span> <span class="token string">"wang"</span> <span class="token string">"hong"</span>                    <span class="token comment"># 单行，name = "wanghong"</span>\n    name <span class="token operator">=</span> <span class="token string">"wang"</span> \\\n            <span class="token string">"hong"</span>                          <span class="token comment"># 多行，name = "wanghong"</span>\n\n<span class="token comment">#-- Python中的字符串格式化实现1--字符串格式化表达式</span>\n    <span class="token triple-quoted-string string">"""\n    基于C语言的\'print\'模型，并且在大多数的现有的语言中使用。\n    通用结构：%[(name)][flag][width].[precision]typecode\n    """</span>\n    <span class="token string">"this is %d %s bird"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'dead\'</span><span class="token punctuation">)</span>                          <span class="token comment"># 一般的格式化表达式</span>\n    <span class="token string">"%s---%s---%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                      <span class="token comment"># 字符串输出：\'42---3.14---[1, 2, 3]\'</span>\n    <span class="token string">"%d...%6d...%-6d...%06d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">)</span>         <span class="token comment"># 对齐方式及填充："1234...  1234...1234  ...001234"</span>\n    x <span class="token operator">=</span> <span class="token number">1.23456789</span>\n    <span class="token string">"%e | %f | %g"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span>                                  <span class="token comment"># 对齐方式："1.234568e+00 | 1.234568 | 1.23457"</span>\n    <span class="token string">"%6.2f*%-6.2f*%06.2f*%+6.2f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x<span class="token punctuation">)</span>                 <span class="token comment"># 对齐方式：\'  1.23*1.23  *001.23* +1.23\'</span>\n    <span class="token string">"%(name1)d---%(name2)s"</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">"name1"</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token string">"name2"</span><span class="token punctuation">:</span><span class="token string">"value2"</span><span class="token punctuation">}</span>    <span class="token comment"># 基于字典的格式化表达式</span>\n    <span class="token string">"%(name)s is %(age)d"</span> <span class="token operator">%</span> <span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># vars()函数调用返回一个字典，包含了所有本函数调用时存在的变量</span>\n\n<span class="token comment">#-- Python中的字符串格式化实现2--字符串格式化调用方法</span>\n    <span class="token comment"># 普通调用</span>\n    <span class="token string">"{0}, {1} and {2}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">,</span> <span class="token string">\'ham\'</span><span class="token punctuation">,</span> <span class="token string">\'eggs\'</span><span class="token punctuation">)</span>            <span class="token comment"># 基于位置的调用</span>\n    <span class="token string">"{motto} and {pork}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>motto <span class="token operator">=</span> <span class="token string">\'spam\'</span><span class="token punctuation">,</span> pork <span class="token operator">=</span> <span class="token string">\'ham\'</span><span class="token punctuation">)</span>   <span class="token comment"># 基于Key的调用</span>\n    <span class="token string">"{motto} and {0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'ham\'</span><span class="token punctuation">,</span> motto <span class="token operator">=</span> <span class="token string">\'spam\'</span><span class="token punctuation">)</span>             <span class="token comment"># 混合调用</span>\n    <span class="token comment"># 添加键 属性 偏移量 (import sys)</span>\n    <span class="token string">"my {1[spam]} runs {0.platform}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sys<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">\'spam\'</span><span class="token punctuation">:</span><span class="token string">\'laptop\'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>                 <span class="token comment"># 基于位置的键和属性</span>\n    <span class="token string">"{config[spam]} {sys.platform}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sys <span class="token operator">=</span> sys<span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'spam\'</span><span class="token punctuation">:</span><span class="token string">\'laptop\'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment"># 基于Key的键和属性</span>\n    <span class="token string">"first = {0[0]}, second = {0[1]}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'A\'</span><span class="token punctuation">,</span> <span class="token string">\'B\'</span><span class="token punctuation">,</span> <span class="token string">\'C\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 基于位置的偏移量</span>\n    <span class="token comment"># 具体格式化</span>\n    <span class="token string">"{0:e}, {1:.3e}, {2:g}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">3.14159</span><span class="token punctuation">,</span> <span class="token number">3.14159</span><span class="token punctuation">,</span> <span class="token number">3.14159</span><span class="token punctuation">)</span>   <span class="token comment"># 输出\'3.141590e+00, 3.142e+00, 3.14159\'</span>\n    <span class="token string">"{fieldname:format_spec}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>\n    <span class="token comment"># 说明:</span>\n    <span class="token triple-quoted-string string">"""\n        fieldname是指定参数的一个数字或关键字, 后边可跟可选的".name"或"[index]"成分引用\n        format_spec ::=  [[fill]align][sign][#][0][width][,][.precision][type]\n        fill        ::=  &lt;any character>              #填充字符\n        align       ::=  "&lt;" | ">" | "=" | "^"        #对齐方式\n        sign        ::=  "+" | "-" | " "              #符号说明\n        width       ::=  integer                      #字符串宽度\n        precision   ::=  integer                      #浮点数精度\n        type        ::=  "b" | "c" | "d" | "e" | "E" | "f" | "F" | "g" | "G" | "n" | "o" | "s" | "x" | "X" | "%"\n    """</span>\n    <span class="token comment"># 例子:</span>\n        <span class="token string">\'={0:10} = {1:10}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">,</span> <span class="token number">123.456</span><span class="token punctuation">)</span>    <span class="token comment"># 输出\'=spam       =    123.456\'</span>\n        <span class="token string">\'={0:>10}=\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出\'=      test=\'</span>\n        <span class="token string">\'={0:&lt;10}=\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出\'=test      =\'</span>\n        <span class="token string">\'={0:^10}=\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'test\'</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出\'=   test   =\'</span>\n        <span class="token string">\'{0:X}, {1:o}, {2:b}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>   <span class="token comment"># 输出\'FF, 377, 11111111\'</span>\n        <span class="token string">\'My name is {0:{1}}.\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">\'Fred\'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>       <span class="token comment"># 输出\'My name is Fred    .\'  动态指定参数</span>\n\n<span class="token comment">#-- 常用列表常量和操作</span>\n    L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">\'string\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span>                        <span class="token comment"># 嵌套列表</span>\n    L <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">)</span>                                  <span class="token comment"># 列表初始化</span>\n    L <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                             <span class="token comment"># 列表初始化</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">,</span> <span class="token string">\'spam\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token comment"># 列表解析</span>\n    <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>                                            <span class="token comment"># 求列表长度</span>\n    L<span class="token punctuation">.</span>count<span class="token punctuation">(</span>value<span class="token punctuation">)</span>                                    <span class="token comment"># 求列表中某个值的个数</span>\n    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>                                     <span class="token comment"># 向列表的尾部添加数据，比如append(2)，添加元素2</span>\n    L<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>index<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>                              <span class="token comment"># 向列表的指定index位置添加数据，index及其之后的数据后移</span>\n    L<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>interable<span class="token punctuation">)</span>                               <span class="token comment"># 通过添加iterable中的元素来扩展列表，比如extend([2])，添加元素2，注意和append的区别</span>\n    L<span class="token punctuation">.</span>index<span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">[</span>start<span class="token punctuation">,</span> <span class="token punctuation">[</span>stop<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment"># 返回列表中值value的第一个索引</span>\n    L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>                                    <span class="token comment"># 删除并返回index处的元素，默认为删除并返回最后一个元素</span>\n    L<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>value<span class="token punctuation">)</span>                                   <span class="token comment"># 删除列表中的value值，只删除第一次出现的value的值</span>\n    L<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>                                       <span class="token comment"># 反转列表</span>\n    L<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token builtin">cmp</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>         <span class="token comment"># 排序列表</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                         <span class="token comment"># 注意，这里不会引发IndexError异常，只会返回一个空的列表[]</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                                  <span class="token comment"># 这里实在原有列表的基础上进行操作，即列表的id没有改变</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>                               <span class="token comment"># 这里最后的a要构建一个新的列表，即a的id发生了变化</span>\n\n<span class="token comment">#-- 用切片来删除序列的某一段</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>\n    a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                                       <span class="token comment"># a = [1, 5, 6, 7]</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>\n    <span class="token keyword">del</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>                                        <span class="token comment"># 去除偶数项(偶数索引的)，a = [1, 3, 5, 7]</span>\n\n<span class="token comment">#-- 常用字典常量和操作</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">\'spam\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'tol\'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">\'ham\'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                   <span class="token comment"># 嵌套字典</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">.</span>fromkeys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'s\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>                  <span class="token comment"># {\'s\': 8, \'d\': 8}</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">\'tom\'</span><span class="token punctuation">,</span> age <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">)</span>                  <span class="token comment"># {\'age\': 12, \'name\': \'tom\'}</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'tom\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">\'age\'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment"># {\'age\': 12, \'name\': \'tom\'}</span>\n    D <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'age\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'tom\'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># {\'age\': 12, \'name\': \'tom\'}</span>\n    D<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> D<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> D<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>                   <span class="token comment"># 字典键、值以及键值对</span>\n    D<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">,</span> default<span class="token punctuation">)</span>                               <span class="token comment"># get函数</span>\n    D<span class="token punctuation">.</span>update<span class="token punctuation">(</span>D_other<span class="token punctuation">)</span>                                 <span class="token comment"># 合并字典，如果存在相同的键值，D_other的数据会覆盖掉D的数据</span>\n    D<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">[</span>D<span class="token punctuation">]</span><span class="token punctuation">)</span>                                   <span class="token comment"># 删除字典中键值为key的项，返回键值为key的值，如果不存在，返回默认值D，否则异常</span>\n    D<span class="token punctuation">.</span>popitem<span class="token punctuation">(</span><span class="token punctuation">)</span>                                       <span class="token comment"># pop字典中随机的一项（一个键值对）</span>\n    D<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>k<span class="token punctuation">[</span><span class="token punctuation">,</span> d<span class="token punctuation">]</span><span class="token punctuation">)</span>                              <span class="token comment"># 设置D中某一项的默认值。如果k存在，则返回D[k]，否则设置D[k]=d，同时返回D[k]。</span>\n    <span class="token keyword">del</span> D                                             <span class="token comment"># 删除字典</span>\n    <span class="token keyword">del</span> D<span class="token punctuation">[</span><span class="token string">\'key\'</span><span class="token punctuation">]</span>                                      <span class="token comment"># 删除字典的某一项</span>\n    <span class="token keyword">if</span> key <span class="token keyword">in</span> D<span class="token punctuation">:</span>   <span class="token keyword">if</span> key <span class="token keyword">not</span> <span class="token keyword">in</span> D<span class="token punctuation">:</span>                   <span class="token comment"># 测试字典键是否存在</span>\n    <span class="token comment"># 字典注意事项：（1）对新索引赋值会添加一项（2）字典键不一定非得是字符串，也可以为任何的不可变对象</span>\n    <span class="token comment"># 不可变对象：调用对象自身的任意方法，也不会改变该对象自身的内容，这些方法会创建新的对象并返回。</span>\n    <span class="token comment"># 字符串、整数、tuple都是不可变对象，dict、set、list都是可变对象</span>\n    D<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>                                    <span class="token comment"># tuple作为字典的key</span>\n\n<span class="token comment">#-- 字典解析</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span><span class="token number">8</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">\'s\'</span><span class="token punctuation">,</span> <span class="token string">\'d\'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>                     <span class="token comment"># {\'s\': 8, \'d\': 8}</span>\n    D <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span>v <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'age\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'tom\'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span>       <span class="token comment"># {\'age\': 12, \'name\': tom}</span>\n\n<span class="token comment">#-- 字典的特殊方法__missing__：当查找找不到key时，会执行该方法</span>\n    <span class="token keyword">class</span> <span class="token class-name">Dict</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__missing__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n    dct <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    dct<span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment"># 这有点类似于collections.defalutdict</span>\n    dct<span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">]</span>              <span class="token comment"># [1]</span>\n\n<span class="token comment">#-- 元组和列表的唯一区别在于元组是不可变对象，列表是可变对象</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>           <span class="token comment"># a[1] = 0, OK</span>\n    a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>           <span class="token comment"># a[1] = 0, Error</span>\n    a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span>           <span class="token comment"># a[0][1] = 0, OK</span>\n    a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>            <span class="token comment"># a[0][1] = 0, Error</span>\n\n<span class="token comment">#-- 元组的特殊语法: 逗号和圆括号</span>\n    D <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span>                <span class="token comment"># 此时D为一个整数 即D = 12</span>\n    D <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>              <span class="token comment"># 此时D为一个元组 即D = (12, )</span>\n\n<span class="token comment">#-- 文件基本操作</span>\n    output <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r\'C:\\spam\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span>          <span class="token comment"># 打开输出文件，用于写</span>\n    <span class="token builtin">input</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">)</span>               <span class="token comment"># 打开输入文件，用于读。打开的方式可以为\'w\', \'r\', \'a\', \'wb\', \'rb\', \'ab\'等</span>\n    fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                         <span class="token comment"># size为读取的长度，以byte为单位</span>\n    fp<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                     <span class="token comment"># 读一行，如果定义了size，有可能返回的只是一行的一部分</span>\n    fp<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token comment"># 把文件每一行作为一个list的一个成员，并返回这个list。其实它的内部是通过循环调用readline()来实现的。如果提供size参数，size是表示读取内容的总长。</span>\n    fp<span class="token punctuation">.</span>readable<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 是否可读</span>\n    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>                           <span class="token comment"># 把str写到文件中，write()并不会在str后加上一个换行符</span>\n    fp<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>                      <span class="token comment"># 把seq的内容全部写到文件中(多行一次性写入)</span>\n    fp<span class="token punctuation">.</span>writeable<span class="token punctuation">(</span><span class="token punctuation">)</span>                          <span class="token comment"># 是否可写</span>\n    fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 关闭文件。</span>\n    fp<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 把缓冲区的内容写入硬盘</span>\n    fp<span class="token punctuation">.</span>fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># 返回一个长整型的”文件标签“</span>\n    fp<span class="token punctuation">.</span>isatty<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># 文件是否是一个终端设备文件（unix系统中的）</span>\n    fp<span class="token punctuation">.</span>tell<span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># 返回文件操作标记的当前位置，以文件的开头为原点</span>\n    fp<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># 返回下一行，并将文件操作标记位移到下一行。把一个file用于for … in file这样的语句时，就是调用next()函数来实现遍历的。</span>\n    fp<span class="token punctuation">.</span>seek<span class="token punctuation">(</span>offset<span class="token punctuation">[</span><span class="token punctuation">,</span>whence<span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token comment"># 将文件打开操作标记移到offset的位置。whence为0表示从头开始计算，1表示以当前位置为原点计算。2表示以文件末尾为原点进行计算。</span>\n    fp<span class="token punctuation">.</span>seekable<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 是否可以seek</span>\n    fp<span class="token punctuation">.</span>truncate<span class="token punctuation">(</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span>                     <span class="token comment"># 把文件裁成规定的大小，默认的是裁到当前文件操作标记的位置。</span>\n    <span class="token keyword">for</span> line <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>                         <span class="token comment"># 使用for语句，比较适用于打开比较大的文件</span>\n    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment"># 使用with语句，可以保证文件关闭</span>\n    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>\n        lines <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># 一次读入文件所有行，并关闭文件</span>\n    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'f.txt\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'latin-1\'</span><span class="token punctuation">)</span>     <span class="token comment"># Python3.x Unicode文本文件</span>\n    <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'f.bin\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>                     <span class="token comment"># Python3.x 二进制bytes文件</span>\n    <span class="token comment"># 文件对象还有相应的属性：buffer closed encoding errors line_buffering name newlines等</span>\n\n<span class="token comment">#-- 其他</span>\n    <span class="token comment"># Python中的真假值含义：1. 数字如果非零，则为真，0为假。 2. 其他对象如果非空，则为真</span>\n    <span class="token comment"># 通常意义下的类型分类：1. 数字、序列、映射。 2. 可变类型和不可变类型</span>\n\n\n<span class="token triple-quoted-string string">"""语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句----语法和语句"""</span>\n\n<span class="token comment">#-- 赋值语句的形式</span>\n    spam <span class="token operator">=</span> <span class="token string">\'spam\'</span>                          <span class="token comment"># 基本形式</span>\n    spam<span class="token punctuation">,</span> ham <span class="token operator">=</span> <span class="token string">\'spam\'</span><span class="token punctuation">,</span> <span class="token string">\'ham\'</span>              <span class="token comment"># 元组赋值形式</span>\n    <span class="token punctuation">[</span>spam<span class="token punctuation">,</span> ham<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'s\'</span><span class="token punctuation">,</span> <span class="token string">\'h\'</span><span class="token punctuation">]</span>               <span class="token comment"># 列表赋值形式</span>\n    a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token string">\'abcd\'</span>                    <span class="token comment"># 序列赋值形式</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token string">\'spam\'</span>                      <span class="token comment"># 序列解包形式（Python3.x中才有）</span>\n    spam <span class="token operator">=</span> ham <span class="token operator">=</span> <span class="token string">\'no\'</span>                      <span class="token comment"># 多目标赋值运算，涉及到共享引用</span>\n    spam <span class="token operator">+=</span> <span class="token number">42</span>                             <span class="token comment"># 增强赋值，涉及到共享引用</span>\n\n<span class="token comment">#-- 序列赋值 序列解包</span>\n    <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>                  <span class="token comment"># a = 1, b = 2, c = 3</span>\n    a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token string">"spam"</span>                    <span class="token comment"># a = \'s\', b = \'p\', c = \'a\', d = \'m\'</span>\n    a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                     <span class="token comment"># a = 0, b = 1, c = 2</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                   <span class="token comment"># a = 1, b = [2, 3, 4]</span>\n    <span class="token operator">*</span>a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                   <span class="token comment"># a = [1, 2, 3], b = 4</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>                <span class="token comment"># a = 1, b = [2, 3], c = 4</span>\n    <span class="token comment"># 带有*时 会优先匹配*之外的变量 如</span>\n    a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>                      <span class="token comment"># a = 1, c = 2, b = []</span>\n\n<span class="token comment">#-- print函数原型</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">\' \'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">\'\\n\'</span><span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token operator">=</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> flush<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>\n    <span class="token comment"># 流的重定向</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>                   <span class="token comment"># 等于sys.stdout.write(\'hello world\')</span>\n    temp <span class="token operator">=</span> sys<span class="token punctuation">.</span>stdout                      <span class="token comment"># 原有流的保存</span>\n    sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'log.log\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">)</span>      <span class="token comment"># 流的重定向</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>                   <span class="token comment"># 写入到文件log.log</span>\n    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> temp                      <span class="token comment"># 原有流的复原</span>\n\n<span class="token comment">#-- Python中and或or总是返回对象(左边的对象或右边的对象) 且具有短路求值的特性</span>\n    <span class="token number">1</span> <span class="token keyword">or</span> <span class="token number">2</span> <span class="token keyword">or</span> <span class="token number">3</span>                            <span class="token comment"># 返回 1</span>\n    <span class="token number">1</span> <span class="token keyword">and</span> <span class="token number">2</span> <span class="token keyword">and</span> <span class="token number">3</span>                          <span class="token comment"># 返回 3</span>\n\n<span class="token comment">#-- if/else三元表达符（if语句在行内）</span>\n    A <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> X <span class="token keyword">else</span> <span class="token number">2</span>\n    A <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">if</span> X <span class="token keyword">else</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token keyword">if</span> Y <span class="token keyword">else</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    <span class="token comment"># 也可以使用and-or语句（一条语句实现多个if-else）</span>\n    a <span class="token operator">=</span> <span class="token number">6</span>\n    result <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">20</span> <span class="token keyword">and</span> <span class="token string">"big than 20"</span> <span class="token keyword">or</span> a <span class="token operator">></span> <span class="token number">10</span> <span class="token keyword">and</span> <span class="token string">"big than 10"</span> <span class="token keyword">or</span> a <span class="token operator">></span> <span class="token number">5</span> <span class="token keyword">and</span> <span class="token string">"big than 5"</span><span class="token punctuation">)</span>    <span class="token comment"># 返回"big than 5"</span>\n\n<span class="token comment">#-- Python的while语句或者for语句可以带else语句 当然也可以带continue/break/pass语句</span>\n    <span class="token keyword">while</span> a <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>\n        anything\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        anything\n    <span class="token comment"># else语句会在循环结束后执行，除非在循环中执行了break，同样的还有for语句</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        anything\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        anything\n\n<span class="token comment">#-- for循环的元组赋值</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                   <span class="token comment"># 最简单的赋值</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    <span class="token comment"># 自动解包赋值</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"XY"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>      <span class="token comment"># 自动解包 a = X, b = Y, c = 6</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            <span class="token comment"># 自动解包赋值</span>\n\n<span class="token comment">#-- 列表解析语法</span>\n    M <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> M<span class="token punctuation">]</span>                     <span class="token comment"># G = [6, 15, 24] 一般的列表解析 生成一个列表</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>c <span class="token operator">*</span> <span class="token number">2</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">\'spam\'</span><span class="token punctuation">]</span>                     <span class="token comment"># [\'ss\', \'pp\', \'aa\', \'mm\']</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token operator">*</span> b <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span>     <span class="token comment"># 多解析过程 返回[4, 5, 8, 10]</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">if</span> a <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">]</span>             <span class="token comment"># 带判断条件的解析过程</span>\n    res <span class="token operator">=</span> <span class="token punctuation">[</span>a <span class="token keyword">if</span> a <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>     <span class="token comment"># 带判断条件的高级解析过程</span>\n    <span class="token comment"># 两个列表同时解析：使用zip函数</span>\n    <span class="token keyword">for</span> teama<span class="token punctuation">,</span> teamb <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Packers"</span><span class="token punctuation">,</span> <span class="token string">"49ers"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"Ravens"</span><span class="token punctuation">,</span> <span class="token string">"Patriots"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>teama <span class="token operator">+</span> <span class="token string">" vs. "</span> <span class="token operator">+</span> teamb<span class="token punctuation">)</span>\n    <span class="token comment"># 带索引的列表解析：使用enumerate函数</span>\n    <span class="token keyword">for</span> index<span class="token punctuation">,</span> team <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"Packers"</span><span class="token punctuation">,</span> <span class="token string">"49ers"</span><span class="token punctuation">,</span> <span class="token string">"Ravens"</span><span class="token punctuation">,</span> <span class="token string">"Patriots"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> team<span class="token punctuation">)</span>                            <span class="token comment"># 输出0, Packers \\n 1, 49ers \\n ......</span>\n\n<span class="token comment">#-- 生成器表达式</span>\n    G <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> M<span class="token punctuation">)</span>                       <span class="token comment"># 使用小括号可以创建所需结果的生成器generator object</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>                         <span class="token comment"># 输出(6, 15, 24)</span>\n    G <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">sum</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token keyword">for</span> row <span class="token keyword">in</span> M<span class="token punctuation">}</span>                       <span class="token comment"># G = {6, 15, 24} 解析语法还可以生成集合和字典</span>\n    G <span class="token operator">=</span> <span class="token punctuation">{</span>i<span class="token punctuation">:</span><span class="token builtin">sum</span><span class="token punctuation">(</span>M<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span>               <span class="token comment"># G = {0: 6, 1: 15, 2: 24}</span>\n\n<span class="token comment">#-- 文档字符串:出现在Module的开端以及其中函数或类的开端 使用三重引号字符串</span>\n    <span class="token triple-quoted-string string">"""\n    module document\n    """</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token triple-quoted-string string">"""\n        function document\n        """</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token triple-quoted-string string">"""\n        class document\n        """</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>__doc__<span class="token punctuation">)</span>                <span class="token comment"># 输出函数文档字符串</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>Employee<span class="token punctuation">.</span>__doc__<span class="token punctuation">)</span>            <span class="token comment"># 输出类的文档字符串</span>\n\n<span class="token comment">#-- 命名惯例:</span>\n    <span class="token triple-quoted-string string">"""\n    以单一下划线开头的变量名(_X)不会被from module import*等语句导入\n    前后有两个下划线的变量名(__X__)是系统定义的变量名，对解释器有特殊意义\n    以两个下划线开头但不以下划线结尾的变量名(__X)是类的本地(私有)变量\n    """</span>\n\n<span class="token comment">#-- 列表解析 in成员关系测试 map sorted zip enumerate内置函数等都使用了迭代协议</span>\n    <span class="token string">\'first line\'</span> <span class="token keyword">in</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">)</span>   <span class="token comment"># in测试 返回True或False</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>upper<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'t\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># map内置函数</span>\n    <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment"># sorted内置函数</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment"># zip内置函数 [(1, 3), (2, 4)]</span>\n\n<span class="token comment">#-- del语句: 手动删除某个变量</span>\n    <span class="token keyword">del</span> X\n\n<span class="token comment">#-- 获取列表的子表的方法:</span>\n    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>\n    x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>                              <span class="token comment"># 前3个[1,2,3]</span>\n    x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>                             <span class="token comment"># 中间4个[2,3,4,5]</span>\n    x<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                             <span class="token comment"># 最后3个[4,5,6]</span>\n    x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>                             <span class="token comment"># 奇数项[1,3,5]</span>\n    x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>                            <span class="token comment"># 偶数项[2,4,6]</span>\n\n<span class="token comment">#-- 手动迭代：iter和next</span>\n    L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>\n    I <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>                        <span class="token comment"># I为L的迭代器</span>\n    I<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 返回1</span>\n    I<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 返回2</span>\n    I<span class="token punctuation">.</span><span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># Error:StopIteration</span>\n\n<span class="token comment">#-- Python中的可迭代对象</span>\n    <span class="token triple-quoted-string string">"""\n    1.range迭代器\n    2.map、zip和filter迭代器\n    3.字典视图迭代器：D.keys()), D.items()等\n    4.文件类型\n    """</span>\n\n\n<span class="token triple-quoted-string string">"""函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则----函数语法规则"""</span>\n\n<span class="token comment">#-- 函数相关的语句和表达式</span>\n    myfunc<span class="token punctuation">(</span><span class="token string">\'spam\'</span><span class="token punctuation">)</span>                     <span class="token comment"># 函数调用</span>\n    <span class="token keyword">def</span> <span class="token function">myfunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                      <span class="token comment"># 函数定义</span>\n    <span class="token keyword">return</span> <span class="token boolean">None</span>                        <span class="token comment"># 函数返回值</span>\n    <span class="token keyword">global</span> a                           <span class="token comment"># 全局变量</span>\n    <span class="token keyword">nonlocal</span> x                         <span class="token comment"># 在函数或其他作用域中使用外层（非全局）变量</span>\n    <span class="token keyword">yield</span> x                            <span class="token comment"># 生成器函数返回</span>\n    <span class="token keyword">lambda</span>                             <span class="token comment"># 匿名函数</span>\n\n<span class="token comment">#-- Python函数变量名解析:LEGB原则，即:</span>\n    <span class="token triple-quoted-string string">"""\n    local(functin) --> encloseing function locals --> global(module) --> build-in(python)\n    说明:以下边的函数maker为例 则相对于action而言 X为Local N为Encloseing\n    """</span>\n\n<span class="token comment">#-- 嵌套函数举例:工厂函数</span>\n    <span class="token keyword">def</span> <span class="token function">maker</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> X <span class="token operator">**</span> N\n        <span class="token keyword">return</span> action\n    f <span class="token operator">=</span> maker<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                       <span class="token comment"># pass 2 to N</span>\n    f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                               <span class="token comment"># 9, pass 3 to X</span>\n\n<span class="token comment">#-- 嵌套函数举例:lambda实例</span>\n    <span class="token keyword">def</span> <span class="token function">maker</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        action <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> X<span class="token punctuation">:</span> X<span class="token operator">**</span>N<span class="token punctuation">)</span>\n        <span class="token keyword">return</span> action\n    f <span class="token operator">=</span> maker<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                       <span class="token comment"># pass 2 to N</span>\n    f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                               <span class="token comment"># 9, pass 3 to X</span>\n\n<span class="token comment">#-- nonlocal和global语句的区别</span>\n    <span class="token comment"># nonlocal应用于一个嵌套的函数的作用域中的一个名称 例如:</span>\n    start <span class="token operator">=</span> <span class="token number">100</span>\n    <span class="token keyword">def</span> <span class="token function">tester</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">nested</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">nonlocal</span> start             <span class="token comment"># 指定start为tester函数内的local变量 而不是global变量start</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> start<span class="token punctuation">)</span>\n            start <span class="token operator">+=</span> <span class="token number">3</span>\n        <span class="token keyword">return</span> nested\n    <span class="token comment"># global为全局的变量 即def之外的变量</span>\n    <span class="token keyword">def</span> <span class="token function">tester</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">nested</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">global</span> start               <span class="token comment"># 指定start为global变量start</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>label<span class="token punctuation">,</span> start<span class="token punctuation">)</span>\n            start <span class="token operator">+=</span> <span class="token number">3</span>\n        <span class="token keyword">return</span> nested\n\n<span class="token comment">#-- 函数参数，不可变参数通过“值”传递，可变参数通过“引用”传递</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>                         <span class="token comment"># 参数位置匹配</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>                 <span class="token comment"># 参数关键字匹配</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                               <span class="token comment"># 默认参数匹配</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                            <span class="token comment"># 默认参数匹配</span>\n    f<span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>                    <span class="token comment"># 关键字参数和默认参数的混合</span>\n    <span class="token comment"># Keyword-Only参数:出现在*args之后 必须用关键字进行匹配</span>\n    <span class="token keyword">def</span> <span class="token function">keyOnly</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span>   <span class="token comment"># c就为keyword-only匹配 必须使用关键字c = value匹配</span>\n    <span class="token keyword">def</span> <span class="token function">keyOnly</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token comment"># b c为keyword-only匹配 必须使用关键字匹配</span>\n    <span class="token keyword">def</span> <span class="token function">keyOnly</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token comment"># b有默认值 或者省略 或者使用关键字参数b = value</span>\n\n<span class="token comment">#-- 可变参数匹配: * 和 **</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>          <span class="token comment"># 在元组中收集不匹配的位置参数</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>                         <span class="token comment"># 输出(1, 2, 3)</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">**</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>         <span class="token comment"># 在字典中收集不匹配的关键字参数</span>\n    f<span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>                    <span class="token comment"># 输出{\'a\':1, \'b\':2}</span>\n    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">*</span>b<span class="token punctuation">,</span> <span class="token operator">**</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>  <span class="token comment"># 两者混合使用</span>\n    f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>               <span class="token comment"># 输出1, (2, 3), {\'x\':4, \'y\':5}</span>\n\n<span class="token comment">#-- 函数调用时的参数解包: * 和 ** 分别解包元组和字典</span>\n    func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">&lt;=</span><span class="token operator">=</span><span class="token operator">></span>  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{</span><span class="token string">\'c\'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token operator">&lt;=</span><span class="token operator">=</span><span class="token operator">></span>  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>\n    func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{</span><span class="token string">\'c\'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token operator">&lt;=</span><span class="token operator">=</span><span class="token operator">></span>  func<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 函数属性:(自己定义的)函数可以添加属性</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    func<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span>                     <span class="token comment"># 自定义函数添加属性</span>\n    <span class="token keyword">print</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span>                    <span class="token comment"># Error 内置函数不可以添加属性</span>\n\n<span class="token comment">#-- 函数注解: 编写在def头部行 主要用于说明参数范围、参数类型、返回值类型等</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token string">\'spam\'</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span><span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span> <span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n    func<span class="token punctuation">.</span>__annotations__               <span class="token comment"># {\'c\':&lt;class \'float\'>, \'b\':(1, 10), \'a\':\'spam\', \'return\':&lt;class \'int\'>}</span>\n    <span class="token comment"># 编写注解的同时 还是可以使用函数默认值 并且注解的位置位于=号的前边</span>\n    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token string">\'spam\'</span><span class="token operator">=</span><span class="token string">\'a\'</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span><span class="token builtin">float</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span> <span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 匿名函数:lambda</span>\n    f <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z <span class="token punctuation">:</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z     <span class="token comment"># 普通匿名函数，使用方法f(1, 2, 3)</span>\n    f <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">:</span> x <span class="token operator">+</span> y     <span class="token comment"># 带默认参数的lambda函数</span>\n    <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>                     <span class="token comment"># 嵌套lambda函数</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> y <span class="token punctuation">:</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>\n    f <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> a <span class="token keyword">if</span> xxx<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> b      <span class="token comment"># 无参数的lambda函数，使用方法f()</span>\n\n<span class="token comment">#-- lambda函数与map filter reduce函数的结合</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment"># [2, 3, 4]</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment"># [1, 2, 3, 4]</span>\n    functools<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 6</span>\n    functools<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment"># 24</span>\n\n<span class="token comment">#-- 生成器函数:yield VS return</span>\n    <span class="token keyword">def</span> <span class="token function">gensquare</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">yield</span> i<span class="token operator">**</span> <span class="token number">2</span>                <span class="token comment"># 状态挂起 可以恢复到此时的状态</span>\n    <span class="token keyword">for</span> i <span class="token keyword">in</span> gensquare<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token comment"># 使用方法</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">\' \'</span><span class="token punctuation">)</span>            <span class="token comment"># [0, 1, 4, 9, 16]</span>\n    x <span class="token operator">=</span> gensquare<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>                   <span class="token comment"># x是一个生成对象</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                            <span class="token comment"># 等同于x.__next__() 返回0</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                            <span class="token comment"># 等同于x.__next__() 返回1</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                            <span class="token comment"># 等同于x.__next__() 抛出异常StopIteration</span>\n\n<span class="token comment">#-- 生成器表达式:小括号进行列表解析</span>\n    G <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 使用小括号可以创建所需结果的生成器generator object</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>          <span class="token comment"># 和上述中的生成器函数的返回值一致</span>\n    <span class="token comment">#（1）生成器(生成器函数/生成器表达式)是单个迭代对象</span>\n    G <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    I1 <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>                       <span class="token comment"># 这里实际上iter(G) = G</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>I1<span class="token punctuation">)</span>                           <span class="token comment"># 输出0</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span>                            <span class="token comment"># 输出1</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>I1<span class="token punctuation">)</span>                           <span class="token comment"># 输出4</span>\n    <span class="token comment">#（2）生成器不保留迭代后的结果</span>\n    gen <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token number">2</span> <span class="token keyword">in</span> gen                           <span class="token comment"># 返回True</span>\n    <span class="token number">3</span> <span class="token keyword">in</span> gen                           <span class="token comment"># 返回True</span>\n    <span class="token number">1</span> <span class="token keyword">in</span> gen                           <span class="token comment"># 返回False，其实检测2的时候，1已经就不在生成器中了，即1已经被迭代过了，同理2、3也不在了</span>\n\n<span class="token comment">#-- 本地变量是静态检测的</span>\n    X <span class="token operator">=</span> <span class="token number">22</span>                             <span class="token comment"># 全局变量X的声明和定义</span>\n    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>                       <span class="token comment"># 如果没有下一语句 则该句合法 打印全局变量X</span>\n        X <span class="token operator">=</span> <span class="token number">88</span>                         <span class="token comment"># 这一语句使得上一语句非法 因为它使得X变成了本地变量 上一句变成了打印一个未定义的本地变量(局部变量)</span>\n        <span class="token keyword">if</span> <span class="token boolean">False</span><span class="token punctuation">:</span>                      <span class="token comment"># 即使这样的语句 也会把print语句视为非法语句 因为:</span>\n            X <span class="token operator">=</span> <span class="token number">88</span>                     <span class="token comment"># Python会无视if语句而仍然声明了局部变量X</span>\n    <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                        <span class="token comment"># 改进</span>\n        <span class="token keyword">global</span> X                       <span class="token comment"># 声明变量X为全局变量</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>                       <span class="token comment"># 打印全局变量X</span>\n        X <span class="token operator">=</span> <span class="token number">88</span>                         <span class="token comment"># 改变全局变量X</span>\n\n<span class="token comment">#-- 函数的默认值是在函数定义的时候实例化的 而不是在调用的时候 例子:</span>\n    <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>numbers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>               <span class="token comment"># 这里的[]是可变的</span>\n        numbers<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># first time, like before, [9]</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># second time, not like before, [9, 9]</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># third time, not like before too, [9, 9, 9]</span>\n    <span class="token comment"># 改进:</span>\n    <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>numbers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> numbers <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n        numbers<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span>\n    <span class="token comment"># 另外一个例子 参数的默认值为不可变的:</span>\n    <span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                  <span class="token comment"># 这里的0是数字, 是不可变的</span>\n        count <span class="token operator">+=</span> <span class="token number">1</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 输出1</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 还是输出1</span>\n    foo<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                             <span class="token comment"># 输出4</span>\n    foo<span class="token punctuation">(</span><span class="token punctuation">)</span>                              <span class="token comment"># 还是输出1</span>\n\n\n<span class="token triple-quoted-string string">"""函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子----函数例子"""</span>\n\n    <span class="token triple-quoted-string string">"""数学运算类"""</span>\n    <span class="token builtin">abs</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 求绝对值，参数可以是整型，也可以是复数，若参数是复数，则返回复数的模</span>\n    <span class="token builtin">complex</span><span class="token punctuation">(</span><span class="token punctuation">[</span>real<span class="token punctuation">[</span><span class="token punctuation">,</span> imag<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment"># 创建一个复数</span>\n    <span class="token builtin">divmod</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>                        <span class="token comment"># 分别取商和余数，注意：整型、浮点型都可以</span>\n    <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>                          <span class="token comment"># 将一个字符串或数转换为浮点数。如果无参数将返回0.0</span>\n    <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span> base<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token comment"># 将一个字符串或浮点数转换为int类型，base表示进制</span>\n    <span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span> base<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment"># 将一个字符串或浮点数转换为long类型</span>\n    <span class="token builtin">pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>                           <span class="token comment"># 返回x的y次幂</span>\n    <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> stop<span class="token punctuation">[</span><span class="token punctuation">,</span> step<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment"># 产生一个序列，默认从0开始</span>\n    <span class="token builtin">round</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span> n<span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 四舍五入</span>\n    <span class="token builtin">sum</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> start<span class="token punctuation">]</span><span class="token punctuation">)</span>              <span class="token comment"># 对集合求和</span>\n    <span class="token builtin">oct</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 将一个数字转化为8进制字符串</span>\n    <span class="token builtin">hex</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 将一个数字转换为16进制字符串</span>\n    <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                              <span class="token comment"># 返回给定int类型对应的ASCII字符</span>\n    <span class="token builtin">unichr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>                           <span class="token comment"># 返回给定int类型的unicode</span>\n    <span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>                              <span class="token comment"># 返回ASCII字符对应的整数</span>\n    <span class="token builtin">bin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                              <span class="token comment"># 将整数x转换为二进制字符串</span>\n    <span class="token builtin">bool</span><span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>                           <span class="token comment"># 将x转换为Boolean类型</span>\n\n    <span class="token triple-quoted-string string">"""集合类操作"""</span>\n    <span class="token builtin">basestring</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># str和unicode的超类，不能直接调用，可以用作isinstance判断</span>\n    <span class="token builtin">format</span><span class="token punctuation">(</span>value <span class="token punctuation">[</span><span class="token punctuation">,</span> format_spec<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token comment"># 格式化输出字符串，格式化的参数顺序从0开始，如“I am {0},I like {1}”</span>\n    <span class="token builtin">enumerate</span><span class="token punctuation">(</span>sequence<span class="token punctuation">[</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment"># 返回一个可枚举的对象，注意它有第二个参数</span>\n    <span class="token builtin">iter</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token punctuation">,</span> sentinel<span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment"># 生成一个对象的迭代器，第二个参数表示分隔符</span>\n    <span class="token builtin">max</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token comment"># 返回集合中的最大值</span>\n    <span class="token builtin">min</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>       <span class="token comment"># 返回集合中的最小值</span>\n    <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">[</span>arg<span class="token punctuation">]</span><span class="token punctuation">)</span>                         <span class="token comment"># 创建数据字典</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">]</span><span class="token punctuation">)</span>                    <span class="token comment"># 将一个集合类转换为另外一个集合类</span>\n    <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                               <span class="token comment"># set对象实例化</span>\n    <span class="token builtin">frozenset</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">]</span><span class="token punctuation">)</span>               <span class="token comment"># 产生一个不可变的set</span>\n    <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment"># 生成一个tuple类型</span>\n    <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">object</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 转换为string类型</span>\n    <span class="token builtin">sorted</span><span class="token punctuation">(</span>iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token builtin">cmp</span><span class="token punctuation">[</span><span class="token punctuation">,</span> key<span class="token punctuation">[</span><span class="token punctuation">,</span> reverse<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>             <span class="token comment"># 集合排序</span>\n        L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">\'c\'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">\'d\'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n        <span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>       <span class="token comment"># 使用Key参数和reverse参数</span>\n        <span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>             <span class="token comment"># 使用key参数进行多条件排序，即如果x[0]相同，则比较x[1]</span>\n\n    <span class="token triple-quoted-string string">"""逻辑判断"""</span>\n    <span class="token builtin">all</span><span class="token punctuation">(</span>iterable<span class="token punctuation">)</span>                       <span class="token comment"># 集合中的元素都为真的时候为真，特别的，若为空串返回为True</span>\n    <span class="token builtin">any</span><span class="token punctuation">(</span>iterable<span class="token punctuation">)</span>                       <span class="token comment"># 集合中的元素有一个为真的时候为真，特别的，若为空串返回为False</span>\n    <span class="token builtin">cmp</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>                           <span class="token comment"># 如果x &lt; y ,返回负数；x == y, 返回0；x > y,返回正数</span>\n\n    <span class="token triple-quoted-string string">"""IO操作"""</span>\n    <span class="token builtin">file</span><span class="token punctuation">(</span>filename <span class="token punctuation">[</span><span class="token punctuation">,</span> mode <span class="token punctuation">[</span><span class="token punctuation">,</span> bufsize<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># file类型的构造函数。</span>\n    <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">[</span>prompt<span class="token punctuation">]</span><span class="token punctuation">)</span>                     <span class="token comment"># 获取用户输入，推荐使用raw_input，因为该函数将不会捕获用户的错误输入，意思是自行判断类型</span>\n    <span class="token comment"># 在 Built-in Functions 里有一句话是这样写的：Consider using the raw_input() function for general input from users.</span>\n    <span class="token builtin">raw_input</span><span class="token punctuation">(</span><span class="token punctuation">[</span>prompt<span class="token punctuation">]</span><span class="token punctuation">)</span>                 <span class="token comment"># 设置输入，输入都是作为字符串处理</span>\n    <span class="token builtin">open</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span><span class="token punctuation">,</span> mode<span class="token punctuation">[</span><span class="token punctuation">,</span> buffering<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     <span class="token comment"># 打开文件，与file有什么不同？推荐使用open</span>\n\n    <span class="token triple-quoted-string string">"""其他"""</span>\n    <span class="token builtin">callable</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                    <span class="token comment"># 检查对象object是否可调用</span>\n    <span class="token builtin">classmethod</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>                   <span class="token comment"># 用来说明这个func是个类方法</span>\n    <span class="token builtin">staticmethod</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>                  <span class="token comment"># 用来说明这个func为静态方法</span>\n    <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">object</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                       <span class="token comment"># 不带参数时，返回当前范围内的变量、方法和定义的类型列表；带参数时，返回参数的属性、方法列表。</span>\n    <span class="token builtin">help</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>                           <span class="token comment"># 返回obj的帮助信息</span>\n    <span class="token builtin">eval</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>                    <span class="token comment"># 计算表达式expression的值，并返回</span>\n    <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>                           <span class="token comment"># 将str作为Python语句执行</span>\n    <span class="token builtin">execfile</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>                  <span class="token comment"># 用法类似exec()，不同的是execfile的参数filename为文件名，而exec的参数为字符串。</span>\n    <span class="token builtin">filter</span><span class="token punctuation">(</span>function<span class="token punctuation">,</span> iterable<span class="token punctuation">)</span>          <span class="token comment"># 构造一个序列，等价于[item for item in iterable if function(item)]，function返回值为True或False的函数</span>\n        <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 返回[-3, -2, -1, 1, 2, 3], 没有0</span>\n    <span class="token builtin">hasattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>               <span class="token comment"># 判断对象object是否包含名为name的特性</span>\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name <span class="token punctuation">[</span><span class="token punctuation">,</span> defalut<span class="token punctuation">]</span><span class="token punctuation">)</span>   <span class="token comment"># 获取一个类的属性</span>\n    <span class="token builtin">setattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>        <span class="token comment"># 设置属性值</span>\n    <span class="token builtin">delattr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>               <span class="token comment"># 删除object对象名为name的属性</span>\n    <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 返回一个描述当前全局符号表的字典</span>\n    <span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                        <span class="token comment"># 如果对象object为哈希表类型，返回对象object的哈希值</span>\n    <span class="token builtin">id</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                          <span class="token comment"># 返回对象的唯一标识，一串数字</span>\n    <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> classinfo<span class="token punctuation">)</span>       <span class="token comment"># 判断object是否是class的实例</span>\n        <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">)</span>              <span class="token comment"># 判断是不是int类型</span>\n        <span class="token builtin">isinstance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># isinstance的第二个参数接受一个元组类型</span>\n    <span class="token builtin">issubclass</span><span class="token punctuation">(</span><span class="token keyword">class</span><span class="token punctuation">,</span> classinfo<span class="token punctuation">)</span>        <span class="token comment"># 判断class是否为classinfo的子类</span>\n    <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># 返回当前的变量列表</span>\n    <span class="token builtin">map</span><span class="token punctuation">(</span>function<span class="token punctuation">,</span> iterable<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>        <span class="token comment"># 遍历每个元素，执行function操作</span>\n        <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 返回[3, 2, 1, 0, 1, 2, 3]</span>\n    <span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">[</span><span class="token punctuation">,</span> default<span class="token punctuation">]</span><span class="token punctuation">)</span>           <span class="token comment"># 类似于iterator.next()</span>\n    <span class="token builtin">property</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fget<span class="token punctuation">[</span><span class="token punctuation">,</span> fset<span class="token punctuation">[</span><span class="token punctuation">,</span> fdel<span class="token punctuation">[</span><span class="token punctuation">,</span> doc<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>           <span class="token comment"># 属性访问的包装类，设置后可以通过c.x=value等来访问setter和getter</span>\n    <span class="token builtin">reduce</span><span class="token punctuation">(</span>function<span class="token punctuation">,</span> iterable<span class="token punctuation">[</span><span class="token punctuation">,</span> initializer<span class="token punctuation">]</span><span class="token punctuation">)</span>         <span class="token comment"># 合并操作，从第一个开始是前两个参数，然后是前两个的结果与第三个合并进行处理，以此类推</span>\n        <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">return</span> x <span class="token operator">+</span> y\n        <span class="token builtin">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                     <span class="token comment"># 返回55 (注:1+2+3+4+5+6+7+8+9+10 = 55)</span>\n        <span class="token builtin">reduce</span><span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>                 <span class="token comment"># 返回75</span>\n    <span class="token builtin">reload</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>                      <span class="token comment"># 重新加载模块</span>\n    <span class="token builtin">repr</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                        <span class="token comment"># 将一个对象变幻为可打印的格式</span>\n    <span class="token builtin">slice</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">[</span><span class="token punctuation">,</span> step<span class="token punctuation">]</span><span class="token punctuation">)</span>          <span class="token comment"># 产生分片对象</span>\n    <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>                        <span class="token comment"># 返回该object的类型</span>\n    <span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">object</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回对象的变量名、变量值的字典</span>\n        a <span class="token operator">=</span> Class<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment"># Class为一个空类</span>\n        a<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'qi\'</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">9</span>\n        <span class="token builtin">vars</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>                         <span class="token comment"># {\'name\':\'qi\', \'age\':9}</span>\n    <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span>iterable<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token comment"># 返回对应数组</span>\n        <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [(1, 4), (2, 5), (3, 6)]</span>\n        a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">]</span>\n        z <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>                   <span class="token comment"># 压缩：[(1, "a"), (2, "b"), (3, "c")]</span>\n        <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>z<span class="token punctuation">)</span>                         <span class="token comment"># 解压缩：[(1, 2, 3), ("a", "b", "c")]</span>\n    <span class="token builtin">unicode</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> errors<span class="token punctuation">)</span>   <span class="token comment"># 将字符串string转化为unicode形式，string为encoded string。</span>\n\n\n<span class="token triple-quoted-string string">"""模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle----模块Moudle"""</span>\n\n<span class="token comment">#-- Python模块搜索路径:</span>\n    <span class="token triple-quoted-string string">"""\n    (1)程序的主目录    (2)PYTHONPATH目录 (3)标准链接库目录 (4)任何.pth文件的内容\n    """</span>\n\n<span class="token comment">#-- 查看全部的模块搜索路径</span>\n    <span class="token keyword">import</span> sys\n    sys<span class="token punctuation">.</span>path\n    sys<span class="token punctuation">.</span>argv                            <span class="token comment"># 获得脚本的参数</span>\n    sys<span class="token punctuation">.</span>builtin_module_names            <span class="token comment"># 查找内建模块</span>\n    sys<span class="token punctuation">.</span>platform                        <span class="token comment"># 返回当前平台 出现如： "win32" "linux" "darwin"等</span>\n    sys<span class="token punctuation">.</span>modules                         <span class="token comment"># 查找已导入的模块</span>\n    sys<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    sys<span class="token punctuation">.</span>stdout                          <span class="token comment"># stdout 和 stderr 都是类文件对象，但是它们都是只写的。它们都没有 read 方法，只有 write 方法</span>\n    sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span>\n    sys<span class="token punctuation">.</span>stderr\n    sys<span class="token punctuation">.</span>stdin\n\n<span class="token comment">#-- 模块的使用代码</span>\n    <span class="token keyword">import</span> module1<span class="token punctuation">,</span> module2             <span class="token comment"># 导入module1 使用module1.printer()</span>\n    <span class="token keyword">from</span> module1 <span class="token keyword">import</span> printer         <span class="token comment"># 导入module1中的printer变量 使用printer()</span>\n    <span class="token keyword">from</span> module1 <span class="token keyword">import</span> <span class="token operator">*</span>               <span class="token comment"># 导入module1中的全部变量 使用不必添加module1前缀</span>\n\n<span class="token comment">#-- 重载模块reload: 这是一个内置函数 而不是一条语句</span>\n    <span class="token keyword">from</span> imp <span class="token keyword">import</span> <span class="token builtin">reload</span>\n    <span class="token builtin">reload</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 模块的包导入:使用点号(.)而不是路径(dir1\\dir2)进行导入</span>\n    <span class="token keyword">import</span> dir1<span class="token punctuation">.</span>dir2<span class="token punctuation">.</span>mod                <span class="token comment"># d导入包(目录)dir1中的包dir2中的mod模块 此时dir1必须在Python可搜索路径中</span>\n    <span class="token keyword">from</span> dir1<span class="token punctuation">.</span>dir2<span class="token punctuation">.</span>mod <span class="token keyword">import</span> <span class="token operator">*</span>         <span class="token comment"># from语法的包导入</span>\n\n<span class="token comment">#-- __init__.py包文件:每个导入的包中都应该包含这么一个文件</span>\n    <span class="token triple-quoted-string string">"""\n    该文件可以为空\n    首次进行包导入时 该文件会自动执行\n    高级功能:在该文件中使用__all__列表来定义包(目录)以from*的形式导入时 需要导入什么\n    """</span>\n\n<span class="token comment">#-- 包相对导入:使用点号(.) 只能使用from语句</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> spam                  <span class="token comment"># 导入当前目录下的spam模块（Python2: 当前目录下的模块, 直接导入即可）</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span>spam <span class="token keyword">import</span> name              <span class="token comment"># 导入当前目录下的spam模块的name属性（Python2: 当前目录下的模块, 直接导入即可，不用加.）</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">import</span> spam                 <span class="token comment"># 导入当前目录的父目录下的spam模块</span>\n\n<span class="token comment">#-- 包相对导入与普通导入的区别</span>\n    <span class="token keyword">from</span> string <span class="token keyword">import</span> <span class="token operator">*</span>                <span class="token comment"># 这里导入的string模块为sys.path路径上的 而不是本目录下的string模块(如果存在也不是)</span>\n    <span class="token keyword">from</span> <span class="token punctuation">.</span>string <span class="token keyword">import</span> <span class="token operator">*</span>               <span class="token comment"># 这里导入的string模块为本目录下的(不存在则导入失败) 而不是sys.path路径上的</span>\n\n<span class="token comment">#-- 模块数据隐藏:最小化from*的破坏</span>\n    _X                                  <span class="token comment"># 变量名前加下划线可以防止from*导入时该变量名被复制出去</span>\n    __all__ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'x\'</span><span class="token punctuation">,</span> <span class="token string">\'x1\'</span><span class="token punctuation">,</span> <span class="token string">\'x2\'</span><span class="token punctuation">]</span>         <span class="token comment"># 使用__all__列表指定from*时复制出去的变量名(变量名在列表中为字符串形式)</span>\n\n<span class="token comment">#-- 可以使用__name__进行模块的单元测试:当模块为顶层执行文件时值为\'__main__\' 当模块被导入时为模块名</span>\n    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">\'__main__\'</span><span class="token punctuation">:</span>\n        doSomething\n    <span class="token comment"># 模块属性中还有其他属性，例如：</span>\n    __doc__                             <span class="token comment"># 模块的说明文档</span>\n    __file__                            <span class="token comment"># 模块文件的文件名，包括全路径</span>\n    __name__                            <span class="token comment"># 主文件或者被导入文件</span>\n    __package__                         <span class="token comment"># 模块所在的包</span>\n\n<span class="token comment">#-- import语句from语句的as扩展</span>\n    <span class="token keyword">import</span> modulename <span class="token keyword">as</span> name\n    <span class="token keyword">from</span> modulename <span class="token keyword">import</span> attrname <span class="token keyword">as</span> name\n\n<span class="token comment">#-- 得到模块属性的几种方法 假设为了得到name属性的值</span>\n    M<span class="token punctuation">.</span>name\n    M<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span><span class="token string">\'name\'</span><span class="token punctuation">]</span>\n    sys<span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token string">\'M\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token string">\'name\'</span><span class="token punctuation">)</span>\n\n\n<span class="token triple-quoted-string string">"""类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象----类与面向对象"""</span>\n\n<span class="token comment">#-- 最普通的类</span>\n    <span class="token keyword">class</span> <span class="token class-name">C1</span><span class="token punctuation">(</span>C2<span class="token punctuation">,</span> C3<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        spam <span class="token operator">=</span> <span class="token number">42</span>                       <span class="token comment"># 数据属性</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>       <span class="token comment"># 函数属性:构造函数</span>\n            self<span class="token punctuation">.</span>name <span class="token operator">=</span> name\n        <span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>              <span class="token comment"># 函数属性:析构函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"goodbey "</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>\n    I1 <span class="token operator">=</span> C1<span class="token punctuation">(</span><span class="token string">\'bob\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- Python的类没有基于参数的函数重载</span>\n    <span class="token keyword">class</span> <span class="token class-name">FirstClass</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                 <span class="token comment"># 此时类中只有一个test函数 即后者test(self) 它覆盖掉前者带参数的test函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 子类扩展超类: 尽量调用超类的方法</span>\n    <span class="token keyword">class</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">giveRaise</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> percent<span class="token punctuation">,</span> bonus <span class="token operator">=</span> <span class="token number">.10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>pay <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pay<span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> percent <span class="token operator">+</span> bonus<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 不好的方式 复制粘贴超类代码</span>\n            Person<span class="token punctuation">.</span>giveRaise<span class="token punctuation">(</span>self<span class="token punctuation">,</span> percent <span class="token operator">+</span> bonus<span class="token punctuation">)</span>            <span class="token comment"># 好的方式 尽量调用超类方法</span>\n\n<span class="token comment">#-- 类内省工具</span>\n    bob <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">\'bob\'</span><span class="token punctuation">)</span>\n    bob<span class="token punctuation">.</span>__class__                       <span class="token comment"># &lt;class \'Person\'></span>\n    bob<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__name__              <span class="token comment"># \'Person\'</span>\n    bob<span class="token punctuation">.</span>__dict__                        <span class="token comment"># {\'pay\':0, \'name\':\'bob\', \'job\':\'Manager\'}</span>\n\n<span class="token comment">#-- 返回1中 数据属性spam是属于类 而不是对象</span>\n    I1 <span class="token operator">=</span> C1<span class="token punctuation">(</span><span class="token string">\'bob\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> I2 <span class="token operator">=</span> C2<span class="token punctuation">(</span><span class="token string">\'tom\'</span><span class="token punctuation">)</span>      <span class="token comment"># 此时I1和I2的spam都为42 但是都是返回的C1的spam属性</span>\n    C1<span class="token punctuation">.</span>spam <span class="token operator">=</span> <span class="token number">24</span>                        <span class="token comment"># 此时I1和I2的spam都为24</span>\n    I1<span class="token punctuation">.</span>spam <span class="token operator">=</span> <span class="token number">3</span>                         <span class="token comment"># 此时I1新增自有属性spam 值为3 I2和C1的spam还都为24</span>\n\n<span class="token comment">#-- 类方法调用的两种方式</span>\n    instance<span class="token punctuation">.</span>method<span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>\n    <span class="token keyword">class</span><span class="token punctuation">.</span>method<span class="token punctuation">(</span>instance<span class="token punctuation">,</span> arg<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 抽象超类的实现方法</span>\n    <span class="token comment"># (1)某个函数中调用未定义的函数 子类中定义该函数</span>\n        <span class="token keyword">def</span> <span class="token function">delegate</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>action<span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment"># 本类中不定义action函数 所以使用delegate函数时就会出错</span>\n    <span class="token comment"># (2)定义action函数 但是返回异常</span>\n        <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">raise</span> NotImplementedError<span class="token punctuation">(</span><span class="token string">"action must be defined"</span><span class="token punctuation">)</span>\n    <span class="token comment"># (3)上述的两种方法还都可以定义实例对象 实际上可以利用@装饰器语法生成不能定义的抽象超类</span>\n        <span class="token keyword">from</span> abc <span class="token keyword">import</span> ABCMeta<span class="token punctuation">,</span> abstractmethod\n        <span class="token keyword">class</span> <span class="token class-name">Super</span><span class="token punctuation">(</span>metaclass <span class="token operator">=</span> ABCMeta<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            @abstractmethod\n            <span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span>\n        x <span class="token operator">=</span> Super<span class="token punctuation">(</span><span class="token punctuation">)</span>                     <span class="token comment"># 返回 TypeError: Can\'t instantiate abstract class Super with abstract methods action</span>\n\n<span class="token comment">#-- # OOP和继承: "is-a"的关系</span>\n    <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">pass</span>\n    a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token builtin">isinstance</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> B<span class="token punctuation">)</span>                    <span class="token comment"># 返回True, A是B的子类 a也是B的一种</span>\n    <span class="token comment"># OOP和组合: "has-a"的关系</span>\n    <span class="token keyword">pass</span>\n    <span class="token comment"># OOP和委托: "包装"对象 在Python中委托通常是以"__getattr__"钩子方法实现的, 这个方法会拦截对不存在属性的读取</span>\n    <span class="token comment"># 包装类(或者称为代理类)可以使用__getattr__把任意读取转发给被包装的对象</span>\n    <span class="token keyword">class</span> <span class="token class-name">wrapper</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>wrapped <span class="token operator">=</span> <span class="token builtin">object</span>\n        <span class="token keyword">def</span> <span class="token function">__getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attrname<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Trace: \'</span><span class="token punctuation">,</span> attrname<span class="token punctuation">)</span>\n            <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>wrapped<span class="token punctuation">,</span> attrname<span class="token punctuation">)</span>\n    <span class="token comment"># 注:这里使用getattr(X, N)内置函数以变量名字符串N从包装对象X中取出属性 类似于X.__dict__[N]</span>\n    x <span class="token operator">=</span> wrapper<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                         <span class="token comment"># 返回 "Trace: append" [1, 2, 3, 4]</span>\n    x <span class="token operator">=</span> wrapper<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">\'a\'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token builtin">list</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回 "Trace: keys" [\'a\', \'b\']</span>\n\n<span class="token comment">#-- 类的伪私有属性:使用__attr</span>\n    <span class="token keyword">class</span> <span class="token class-name">C1</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>__name <span class="token operator">=</span> name          <span class="token comment"># 此时类的__name属性为伪私有属性 原理 它会自动变成self._C1__name = name</span>\n        <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'self.name = %s\'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>__name\n    I <span class="token operator">=</span> C1<span class="token punctuation">(</span><span class="token string">\'tom\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span>                            <span class="token comment"># 返回 self.name = tom</span>\n    I<span class="token punctuation">.</span>__name <span class="token operator">=</span> <span class="token string">\'jeey\'</span>                   <span class="token comment"># 这里无法访问 __name为伪私有属性</span>\n    I<span class="token punctuation">.</span>_C1__name <span class="token operator">=</span> <span class="token string">\'jeey\'</span>                <span class="token comment"># 这里可以修改成功 self.name = jeey</span>\n\n<span class="token comment">#-- 类方法是对象:无绑定类方法对象 / 绑定实例方法对象</span>\n    <span class="token keyword">class</span> <span class="token class-name">Spam</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">doit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">selfless</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>\n    obj <span class="token operator">=</span> Spam<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    x <span class="token operator">=</span> obj<span class="token punctuation">.</span>doit                        <span class="token comment"># 类的绑定方法对象 实例 + 函数</span>\n    x<span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>\n    x <span class="token operator">=</span> Spam<span class="token punctuation">.</span>doit                       <span class="token comment"># 类的无绑定方法对象 类名 + 函数</span>\n    x<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">\'hello world\'</span><span class="token punctuation">)</span>\n    x <span class="token operator">=</span> Spam<span class="token punctuation">.</span>selfless                   <span class="token comment"># 类的无绑定方法函数 在3.0之前无效</span>\n    x<span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 获取对象信息: 属性和方法</span>\n    a <span class="token operator">=</span> MyObject<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token builtin">dir</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>                              <span class="token comment"># 使用dir函数</span>\n    <span class="token builtin">hasattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">\'x\'</span><span class="token punctuation">)</span>                     <span class="token comment"># 测试是否有x属性或方法 即a.x是否已经存在</span>\n    <span class="token builtin">setattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">\'y\'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span>                 <span class="token comment"># 设置属性或方法 等同于a.y = 19</span>\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">\'z\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>                  <span class="token comment"># 获取属性或方法 如果属性不存在 则返回默认值0</span>\n    <span class="token comment">#这里有个小技巧，setattr可以设置一个不能访问到的属性，即只能用getattr获取</span>\n    <span class="token builtin">setattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"can\'t touch"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>      <span class="token comment"># 这里的属性名带有空格，不能直接访问</span>\n    <span class="token builtin">getattr</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">"can\'t touch"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token comment"># 但是可以用getattr获取</span>\n\n<span class="token comment">#-- 为类动态绑定属性或方法: MethodType方法</span>\n    <span class="token comment"># 一般创建了一个class的实例后, 可以给该实例绑定任何属性和方法, 这就是动态语言的灵活性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">pass</span>\n    s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    s<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'Michael\'</span>                  <span class="token comment"># 动态给实例绑定一个属性</span>\n    <span class="token keyword">def</span> <span class="token function">set_age</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token comment"># 定义一个函数作为实例方法</span>\n        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age\n    <span class="token keyword">from</span> types <span class="token keyword">import</span> MethodType\n    s<span class="token punctuation">.</span>set_age <span class="token operator">=</span> MethodType<span class="token punctuation">(</span>set_age<span class="token punctuation">,</span> s<span class="token punctuation">)</span>  <span class="token comment"># 给实例绑定一个方法 类的其他实例不受此影响</span>\n    s<span class="token punctuation">.</span>set_age<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>                       <span class="token comment"># 调用实例方法</span>\n    Student<span class="token punctuation">.</span>set_age <span class="token operator">=</span> MethodType<span class="token punctuation">(</span>set_age<span class="token punctuation">,</span> Student<span class="token punctuation">)</span>    <span class="token comment"># 为类绑定一个方法 类的所有实例都拥有该方法</span>\n\n\n<span class="token triple-quoted-string string">"""类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题----类的高级话题"""</span>\n\n<span class="token comment">#-- 多重继承: "混合类", 搜索方式"从下到上 从左到右 广度优先"</span>\n    <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> C<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">pass</span>\n\n<span class="token comment">#-- 类的继承和子类的初始化</span>\n    <span class="token comment"># 1.子类定义了__init__方法时，若未显示调用基类__init__方法，python不会帮你调用。</span>\n    <span class="token comment"># 2.子类未定义__init__方法时，python会自动帮你调用首个基类的__init__方法，注意是首个。</span>\n    <span class="token comment"># 3.子类显示调用基类的初始化函数：</span>\n    <span class="token keyword">class</span> <span class="token class-name">FooParent</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token string">\'I\\\'m the Parent.\'</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Parent:a=\'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message <span class="token operator">+</span> <span class="token string">\' from Parent\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">class</span> <span class="token class-name">FooChild</span><span class="token punctuation">(</span>FooParent<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            FooParent<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Child:a=\'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            FooParent<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>self<span class="token punctuation">,</span> message<span class="token punctuation">)</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>message <span class="token operator">+</span> <span class="token string">\' from Child\'</span><span class="token punctuation">)</span>\n    fooChild <span class="token operator">=</span> FooChild<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>\n    fooChild<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token string">\'HelloWorld\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- #实例方法 / 静态方法 / 类方法</span>\n    <span class="token keyword">class</span> <span class="token class-name">Methods</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">imeth</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span>      <span class="token comment"># 实例方法：传入的是实例和数据，操作的是实例的属性</span>\n        <span class="token keyword">def</span> <span class="token function">smeth</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>                  <span class="token comment"># 静态方法：只传入数据 不传入实例，操作的是类的属性而不是实例的属性</span>\n        <span class="token keyword">def</span> <span class="token function">cmeth</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span>        <span class="token comment"># 类方法：传入的是类对象和数据</span>\n        smeth <span class="token operator">=</span> <span class="token builtin">staticmethod</span><span class="token punctuation">(</span>smeth<span class="token punctuation">)</span>             <span class="token comment"># 调用内置函数，也可以使用@staticmethod</span>\n        cmeth <span class="token operator">=</span> <span class="token builtin">classmethod</span><span class="token punctuation">(</span>cmeth<span class="token punctuation">)</span>              <span class="token comment"># 调用内置函数，也可以使用@classmethod</span>\n    obj <span class="token operator">=</span> Methods<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    obj<span class="token punctuation">.</span>imeth<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                <span class="token comment"># 实例方法调用 &lt;__main__.Methods object...> 1</span>\n    Methods<span class="token punctuation">.</span>imeth<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>                       <span class="token comment"># &lt;__main__.Methods object...> 2</span>\n    Methods<span class="token punctuation">.</span>smeth<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                            <span class="token comment"># 静态方法调用 3</span>\n    obj<span class="token punctuation">.</span>smeth<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                                <span class="token comment"># 这里可以使用实例进行调用</span>\n    Methods<span class="token punctuation">.</span>cmeth<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>                            <span class="token comment"># 类方法调用 &lt;class \'__main__.Methods\'> 5</span>\n    obj<span class="token punctuation">.</span>cmeth<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>                                <span class="token comment"># &lt;class \'__main__.Methods\'> 6</span>\n\n<span class="token comment">#-- 函数装饰器:是它后边的函数的运行时的声明 由@符号以及后边紧跟的"元函数"(metafunction)组成</span>\n        <span class="token decorator annotation punctuation">@staticmethod</span>\n        <span class="token keyword">def</span> <span class="token function">smeth</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n    <span class="token comment"># 等同于:</span>\n        <span class="token keyword">def</span> <span class="token function">smeth</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n        smeth <span class="token operator">=</span> <span class="token builtin">staticmethod</span><span class="token punctuation">(</span>smeth<span class="token punctuation">)</span>\n    <span class="token comment"># 同理</span>\n        <span class="token decorator annotation punctuation">@classmethod</span>\n        <span class="token keyword">def</span> <span class="token function">cmeth</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n    <span class="token comment"># 等同于</span>\n        <span class="token keyword">def</span> <span class="token function">cmeth</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n        cmeth <span class="token operator">=</span> <span class="token builtin">classmethod</span><span class="token punctuation">(</span>cmeth<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 类修饰器:是它后边的类的运行时的声明 由@符号以及后边紧跟的"元函数"(metafunction)组成</span>\n        <span class="token keyword">def</span> <span class="token function">decorator</span><span class="token punctuation">(</span>aClass<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n        @decorator\n        <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token comment"># 等同于:</span>\n        <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n        C <span class="token operator">=</span> decorator<span class="token punctuation">(</span>C<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 限制class属性: __slots__属性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        __slots__ <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'age\'</span><span class="token punctuation">)</span>             <span class="token comment"># 限制Student及其实例只能拥有name和age属性</span>\n    <span class="token comment"># __slots__属性只对当前类起作用, 对其子类不起作用</span>\n    <span class="token comment"># __slots__属性能够节省内存</span>\n    <span class="token comment"># __slots__属性可以为列表list，或者元组tuple</span>\n\n<span class="token comment">#-- 类属性高级话题: @property</span>\n    <span class="token comment"># 假设定义了一个类:C，该类必须继承自object类，有一私有变量_x</span>\n    <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>__x <span class="token operator">=</span> <span class="token boolean">None</span>\n    <span class="token comment"># 第一种使用属性的方法</span>\n        <span class="token keyword">def</span> <span class="token function">getx</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__x\n        <span class="token keyword">def</span> <span class="token function">setx</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>__x <span class="token operator">=</span> value\n        <span class="token keyword">def</span> <span class="token function">delx</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">del</span> self<span class="token punctuation">.</span>__x\n        x <span class="token operator">=</span> <span class="token builtin">property</span><span class="token punctuation">(</span>getx<span class="token punctuation">,</span> setx<span class="token punctuation">,</span> delx<span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>\n    <span class="token comment"># property函数原型为property(fget=None,fset=None,fdel=None,doc=None)</span>\n    <span class="token comment"># 使用</span>\n    c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    c<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">100</span>                         <span class="token comment"># 自动调用setx方法</span>\n    y <span class="token operator">=</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用getx方法</span>\n    <span class="token keyword">del</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用delx方法</span>\n    <span class="token comment"># 第二种方法使用属性的方法</span>\n        <span class="token decorator annotation punctuation">@property</span>\n        <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>__x\n        @x<span class="token punctuation">.</span>setter\n        <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>\n           self<span class="token punctuation">.</span>__x <span class="token operator">=</span> value\n        @x<span class="token punctuation">.</span>deleter\n        <span class="token keyword">def</span> <span class="token function">x</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n           <span class="token keyword">del</span> self<span class="token punctuation">.</span>__x\n    <span class="token comment"># 使用</span>\n    c <span class="token operator">=</span> C<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    c<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">100</span>                         <span class="token comment"># 自动调用setter方法</span>\n    y <span class="token operator">=</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用x方法</span>\n    <span class="token keyword">del</span> c<span class="token punctuation">.</span>x                           <span class="token comment"># 自动调用deleter方法</span>\n\n<span class="token comment">#-- 定制类: 重写类的方法</span>\n    <span class="token comment"># (1)__str__方法、__repr__方法: 定制类的输出字符串</span>\n    <span class="token comment"># (2)__iter__方法、next方法: 定制类的可迭代性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Fib</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>     <span class="token comment"># 初始化两个计数器a，b</span>\n        <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> self               <span class="token comment"># 实例本身就是迭代对象，故返回自己</span>\n        <span class="token keyword">def</span> <span class="token function">next</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span>b <span class="token operator">=</span> self<span class="token punctuation">.</span>b<span class="token punctuation">,</span> self<span class="token punctuation">.</span>a <span class="token operator">+</span> self<span class="token punctuation">.</span>b\n            <span class="token keyword">if</span> self<span class="token punctuation">.</span>a <span class="token operator">></span> <span class="token number">100000</span><span class="token punctuation">:</span>       <span class="token comment"># 退出循环的条件</span>\n                <span class="token keyword">raise</span> StopIteration<span class="token punctuation">(</span><span class="token punctuation">)</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>a             <span class="token comment"># 返回下一个值</span>\n    <span class="token keyword">for</span> n <span class="token keyword">in</span> Fib<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>                      <span class="token comment"># 使用</span>\n    <span class="token comment"># (3)__getitem__方法、__setitem__方法: 定制类的下标操作[] 或者切片操作slice</span>\n    <span class="token keyword">class</span> <span class="token class-name">Indexer</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n        <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token comment"># 定义getitem方法</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'getitem:\'</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>\n            <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>n<span class="token punctuation">]</span>\n        <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 定义setitem方法</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'setitem:key = {0}, value = {1}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>\n            self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value\n    test <span class="token operator">=</span> Indexer<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   test<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'3\'</span>              <span class="token comment"># 调用setitem方法</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                            <span class="token comment"># 调用getitem方法</span>\n    <span class="token comment"># (4)__getattr__方法: 定制类的属性操作</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__getattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token comment"># 定义当获取类的属性时的返回值</span>\n            <span class="token keyword">if</span> attr<span class="token operator">==</span><span class="token string">\'age\'</span><span class="token punctuation">:</span>\n                <span class="token keyword">return</span> <span class="token number">25</span>                     <span class="token comment"># 当获取age属性时返回25</span>\n        <span class="token keyword">raise</span> AttributeError<span class="token punctuation">(</span><span class="token string">\'object has no attribute: %s\'</span> <span class="token operator">%</span> attr<span class="token punctuation">)</span>\n        <span class="token comment"># 注意: 只有当属性不存在时 才会调用该方法 且该方法默认返回None 需要在函数最后引发异常</span>\n    s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    s<span class="token punctuation">.</span>age                                     <span class="token comment"># s中age属性不存在 故调用__getattr__方法 返回25</span>\n    <span class="token comment"># (5)__call__方法: 定制类的\'可调用\'性</span>\n    <span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                   <span class="token comment"># 也可以带参数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Calling......\'</span><span class="token punctuation">)</span>\n    s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    s<span class="token punctuation">(</span><span class="token punctuation">)</span>                                       <span class="token comment"># s变成了可调用的 也可以带参数</span>\n    <span class="token builtin">callable</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>                               <span class="token comment"># 测试s的可调用性 返回True</span>\n    <span class="token comment">#    (6)__len__方法：求类的长度</span>\n    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 动态创建类type()</span>\n    <span class="token comment"># 一般创建类 需要在代码中提前定义</span>\n        <span class="token keyword">class</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s.\'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span>\n        h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        h<span class="token punctuation">.</span>hello<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># Hello, world</span>\n        <span class="token builtin">type</span><span class="token punctuation">(</span>Hello<span class="token punctuation">)</span>                           <span class="token comment"># Hello是一个type类型 返回&lt;class \'type\'></span>\n        <span class="token builtin">type</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>                               <span class="token comment"># h是一个Hello类型 返回&lt;class \'Hello\'></span>\n    <span class="token comment"># 动态类型语言中 类可以动态创建 type函数可用于创建新类型</span>\n        <span class="token keyword">def</span> <span class="token function">fn</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">\'world\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>           <span class="token comment"># 先定义函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Hello, %s.\'</span> <span class="token operator">%</span> name<span class="token punctuation">)</span>\n        Hello <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'Hello\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>hello<span class="token operator">=</span>fn<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># 创建Hello类 type原型: type(name, bases, dict)</span>\n        h <span class="token operator">=</span> Hello<span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token comment"># 此时的h和上边的h一致</span>\n\n\n<span class="token triple-quoted-string string">"""异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关----异常相关"""</span>\n\n<span class="token comment">#-- #捕获异常:</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">except</span><span class="token punctuation">:</span>                               <span class="token comment"># 捕获所有的异常 等同于except Exception:</span>\n        <span class="token keyword">except</span> name<span class="token punctuation">:</span>                          <span class="token comment"># 捕获指定的异常</span>\n        <span class="token keyword">except</span> name<span class="token punctuation">,</span> value<span class="token punctuation">:</span>                   <span class="token comment"># 捕获指定的异常和额外的数据(实例)</span>\n        <span class="token keyword">except</span> <span class="token punctuation">(</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">except</span> <span class="token punctuation">(</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span>\n        <span class="token keyword">except</span> name4 <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        <span class="token keyword">else</span><span class="token punctuation">:</span>                                 <span class="token comment"># 如果没有发生异常</span>\n        <span class="token keyword">finally</span><span class="token punctuation">:</span>                              <span class="token comment"># 总会执行的部分</span>\n    <span class="token comment"># 引发异常: raise子句(raise IndexError)</span>\n        <span class="token keyword">raise</span> <span class="token operator">&lt;</span>instance<span class="token operator">></span>                      <span class="token comment"># raise instance of a class, raise IndexError()</span>\n        <span class="token keyword">raise</span> <span class="token operator">&lt;</span><span class="token keyword">class</span><span class="token operator">></span>                         <span class="token comment"># make and raise instance of a class, raise IndexError</span>\n        <span class="token keyword">raise</span>                                 <span class="token comment"># reraise the most recent exception</span>\n\n<span class="token comment">#-- Python3.x中的异常链: raise exception from otherException</span>\n    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> IndexError<span class="token punctuation">(</span><span class="token string">\'Bad\'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> X\n\n<span class="token comment">#-- assert子句: assert &lt;test>, &lt;data></span>\n    <span class="token keyword">assert</span> x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">\'x must be negative\'</span>\n\n<span class="token comment">#-- with/as环境管理器:作为常见的try/finally用法模式的替代方案</span>\n    <span class="token keyword">with</span> expression <span class="token punctuation">[</span><span class="token keyword">as</span> variable<span class="token punctuation">]</span><span class="token punctuation">,</span> expression <span class="token punctuation">[</span><span class="token keyword">as</span> variable<span class="token punctuation">]</span><span class="token punctuation">:</span>\n    <span class="token comment"># 例子:</span>\n        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> myfile<span class="token punctuation">:</span>\n            <span class="token keyword">for</span> line <span class="token keyword">in</span> myfile<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>\n    <span class="token comment"># 等同于:</span>\n        myfile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">)</span>\n        <span class="token keyword">try</span><span class="token punctuation">:</span>\n            <span class="token keyword">for</span> line <span class="token keyword">in</span> myfile<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>\n        <span class="token keyword">finally</span><span class="token punctuation">:</span>\n            myfile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 用户自定义异常: class Bad(Exception):.....</span>\n    <span class="token triple-quoted-string string">"""\n    Exception超类 / except基类即可捕获到其所有子类\n    Exception超类有默认的打印消息和状态 当然也可以定制打印显示:\n    """</span>\n    <span class="token keyword">class</span> <span class="token class-name">MyBad</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">return</span> <span class="token string">\'定制的打印消息\'</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        MyBad<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> MyBad <span class="token keyword">as</span> x<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>\n\n<span class="token comment">#-- 用户定制异常数据</span>\n    <span class="token keyword">class</span> <span class="token class-name">FormatError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> line <span class="token punctuation">,</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>line <span class="token operator">=</span> line\n            self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">file</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> FormatError<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">\'test.py\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> FormatError <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'Error at \'</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>line<span class="token punctuation">)</span>\n    <span class="token comment"># 用户定制异常行为(方法):以记录日志为例</span>\n    <span class="token keyword">class</span> <span class="token class-name">FormatError</span><span class="token punctuation">(</span>Exception<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        logfile <span class="token operator">=</span> <span class="token string">\'formaterror.txt\'</span>\n        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> line <span class="token punctuation">,</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n            self<span class="token punctuation">.</span>line <span class="token operator">=</span> line\n            self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">file</span>\n        <span class="token keyword">def</span> <span class="token function">logger</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token builtin">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>logfile<span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Error at \'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>line<span class="token punctuation">)</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token keyword">raise</span> FormatError<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">\'test.py\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">except</span> FormatError <span class="token keyword">as</span> X<span class="token punctuation">:</span>\n        X<span class="token punctuation">.</span>logger<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- 关于sys.exc_info:允许一个异常处理器获取对最近引发的异常的访问</span>\n    <span class="token keyword">try</span><span class="token punctuation">:</span>\n        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token keyword">except</span><span class="token punctuation">:</span>\n        <span class="token comment"># 此时sys.exc_info()返回一个元组(type, value, traceback)</span>\n        <span class="token comment"># type:正在处理的异常的异常类型</span>\n        <span class="token comment"># value:引发的异常的实例</span>\n        <span class="token comment"># traceback:堆栈信息</span>\n\n<span class="token comment">#-- 异常层次</span>\n    BaseException\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> SystemExit\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> KeyboardInterrupt\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> GeneratorExit\n    <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> Exception\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> StopIteration\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ArithmeticError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> AssertionError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> AttributeError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> BufferError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> EOFError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ImportError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> LookupError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> MemoryError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> NameError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> OSError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ReferenceError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> RuntimeError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> SyntaxError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> SystemError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> TypeError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> ValueError\n        <span class="token operator">+</span><span class="token operator">-</span><span class="token operator">-</span> Warning\n\n\n<span class="token triple-quoted-string string">"""Unicode和字节字符串---Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串----Unicode和字节字符串"""</span>\n\n<span class="token comment">#-- Python的字符串类型</span>\n    <span class="token triple-quoted-string string">"""Python2.x"""</span>\n    <span class="token comment"># 1.str表示8位文本和二进制数据</span>\n    <span class="token comment"># 2.unicode表示宽字符Unicode文本</span>\n    <span class="token triple-quoted-string string">"""Python3.x"""</span>\n    <span class="token comment"># 1.str表示Unicode文本（8位或者更宽）</span>\n    <span class="token comment"># 2.bytes表示不可变的二进制数据</span>\n    <span class="token comment"># 3.bytearray是一种可变的bytes类型</span>\n\n<span class="token comment">#-- 字符编码方法</span>\n    <span class="token triple-quoted-string string">"""ASCII"""</span>                   <span class="token comment"># 一个字节，只包含英文字符，0到127，共128个字符，利用函数可以进行字符和数字的相互转换</span>\n    <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span>                      <span class="token comment"># 字符a的ASCII码为97，所以这里返回97</span>\n    <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">)</span>                       <span class="token comment"># 和上边的过程相反，返回字符\'a\'</span>\n    <span class="token triple-quoted-string string">"""Latin-1"""</span>                 <span class="token comment"># 一个字节，包含特殊字符，0到255，共256个字符，相当于对ASCII码的扩展</span>\n    <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">196</span><span class="token punctuation">)</span>                      <span class="token comment"># 返回一个特殊字符：Ä</span>\n    <span class="token triple-quoted-string string">"""Unicode"""</span>                 <span class="token comment"># 宽字符，一个字符包含多个字节，一般用于亚洲的字符集，比如中文有好几万字</span>\n    <span class="token triple-quoted-string string">"""UTF-8"""</span>                   <span class="token comment"># 可变字节数，小于128的字符表示为单个字节，128到0X7FF之间的代码转换为两个字节，0X7FF以上的代码转换为3或4个字节</span>\n    <span class="token comment"># 注意：可以看出来，ASCII码是Latin-1和UTF-8的一个子集</span>\n    <span class="token comment"># 注意：utf-8是unicode的一种实现方式，unicode、gbk、gb2312是编码字符集</span>\n\n<span class="token comment">#-- 查看Python中的字符串编码名称，查看系统的编码</span>\n    <span class="token keyword">import</span> encodings\n    <span class="token builtin">help</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span>\n    <span class="token keyword">import</span> sys\n    sys<span class="token punctuation">.</span>platform                  <span class="token comment"># \'win64\'</span>\n    sys<span class="token punctuation">.</span>getdefaultencoding<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># \'utf-8\'</span>\n    sys<span class="token punctuation">.</span>getdefaultencoding<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># 返回当前系统平台的编码类型</span>\n    sys<span class="token punctuation">.</span>getsizeof<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span>         <span class="token comment"># 返回object占有的bytes的大小</span>\n\n<span class="token comment">#-- 源文件字符集编码声明: 添加注释来指定想要的编码形式 从而改变默认值 注释必须出现在脚本的第一行或者第二行</span>\n    <span class="token triple-quoted-string string">"""说明：其实这里只会检查#和coding:utf-8，其余的字符都是为了美观加上的"""</span>\n    <span class="token comment"># _*_ coding: utf-8 _*_</span>\n    <span class="token comment"># coding = utf-8</span>\n\n<span class="token comment">#-- #编码: 字符串 --> 原始字节       #解码: 原始字节 --> 字符串</span>\n\n<span class="token comment">#-- Python3.x中的字符串应用</span>\n    s <span class="token operator">=</span> <span class="token string">\'...\'</span>                     <span class="token comment"># 构建一个str对象，不可变对象</span>\n    b <span class="token operator">=</span> <span class="token string">b\'...\'</span>                    <span class="token comment"># 构建一个bytes对象，不可变对象</span>\n    s<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>                    <span class="token comment"># 返回(\'.\', 113)</span>\n    s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>                  <span class="token comment"># 返回(\'..\', b\'..\')</span>\n    B <span class="token operator">=</span> <span class="token triple-quoted-string string">B"""\n        xxxx\n        yyyy\n        """</span>\n    <span class="token comment"># B = b\'\\nxxxx\\nyyyy\\n\'</span>\n    <span class="token comment"># 编码，将str字符串转化为其raw bytes形式：</span>\n        <span class="token builtin">str</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">,</span> errors <span class="token operator">=</span> <span class="token string">\'strict\'</span><span class="token punctuation">)</span>\n        <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">,</span> encoding<span class="token punctuation">)</span>\n    <span class="token comment"># 编码例子：</span>\n        S <span class="token operator">=</span> <span class="token string">\'egg\'</span>\n        S<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment"># b\'egg\'</span>\n        <span class="token builtin">bytes</span><span class="token punctuation">(</span>S<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'ascii\'</span><span class="token punctuation">)</span>  <span class="token comment"># b\'egg\'</span>\n    <span class="token comment"># 解码，将raw bytes字符串转化为str形式：</span>\n        <span class="token builtin">bytes</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">,</span> errors <span class="token operator">=</span> <span class="token string">\'strict\'</span><span class="token punctuation">)</span>\n        <span class="token builtin">str</span><span class="token punctuation">(</span>bytes_or_buffer<span class="token punctuation">[</span><span class="token punctuation">,</span> encoding<span class="token punctuation">[</span><span class="token punctuation">,</span> errors<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    <span class="token comment"># 解码例子：</span>\n        B <span class="token operator">=</span> <span class="token string">b\'spam\'</span>\n        B<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment"># \'spam\'</span>\n        <span class="token builtin">str</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span>                    <span class="token comment"># "b\'spam\'"，不带编码的str调用，结果为打印该bytes对象</span>\n        <span class="token builtin">str</span><span class="token punctuation">(</span>B<span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'ascii\'</span><span class="token punctuation">)</span><span class="token comment"># \'spam\'，带编码的str调用，结果为转化该bytes对象</span>\n\n<span class="token comment">#-- Python2.x的编码问题</span>\n    u <span class="token operator">=</span> <span class="token string">u\'汉\'</span>\n    <span class="token keyword">print</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>                 <span class="token comment"># u\'\\xba\\xba\'</span>\n    s <span class="token operator">=</span> u<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>                 <span class="token comment"># \'\\xc2\\xba\\xc2\\xba\'</span>\n    u2 <span class="token operator">=</span> s<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">print</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>u2<span class="token punctuation">)</span>                <span class="token comment"># u\'\\xba\\xba\'</span>\n    <span class="token comment"># 对unicode进行解码是错误的</span>\n    s2 <span class="token operator">=</span> u<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>        <span class="token comment"># UnicodeEncodeError: \'ascii\' codec can\'t encode characters in position 0-1: ordinal not in range(128)</span>\n    <span class="token comment"># 同样，对str进行编码也是错误的</span>\n    u2 <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'UTF-8\'</span><span class="token punctuation">)</span>        <span class="token comment"># UnicodeDecodeError: \'ascii\' codec can\'t decode byte 0xc2 in position 0: ordinal not in range(128)</span>\n\n<span class="token comment">#-- bytes对象</span>\n    B <span class="token operator">=</span> <span class="token string">b\'abc\'</span>\n    B <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token string">\'abc\'</span><span class="token punctuation">,</span> <span class="token string">\'ascii\'</span><span class="token punctuation">)</span>\n    B <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n    B <span class="token operator">=</span> <span class="token string">\'abc\'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token comment"># bytes对象的方法调用基本和str类型一致 但:B[0]返回的是ASCII码值97, 而不是b\'a\'</span>\n\n<span class="token comment">#-- #文本文件: 根据Unicode编码来解释文件内容，要么是平台的默认编码，要么是指定的编码类型</span>\n    <span class="token comment"># 二进制文件：表示字节值的整数的一个序列 open(\'bin.txt\', \'rb\')</span>\n\n<span class="token comment">#-- Unicode文件</span>\n    s <span class="token operator">=</span> <span class="token string">\'A\\xc4B\\xe8C\'</span>             <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n    <span class="token comment">#手动编码</span>\n        l <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'latin-1\'</span><span class="token punctuation">)</span>   <span class="token comment"># l = b\'A\\xc4B\\xe8C\'  len(l) = 5</span>\n        u <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>     <span class="token comment"># u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7</span>\n    <span class="token comment">#文件输出编码</span>\n        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'latin-1\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n        l <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token comment"># l = b\'A\\xc4B\\xe8C\'  len(l) = 5</span>\n        <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'uft8data\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>\n        u <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'uft8data\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment"># u = b\'A\\xc3\\x84B\\xc3\\xa8C\'  len(u) = 7</span>\n    <span class="token comment">#文件输入编码</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'latin-1\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'latindata\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'latin-1\'</span><span class="token punctuation">)</span>      <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'utf8data\'</span><span class="token punctuation">,</span> <span class="token string">\'r\'</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">\'utf-8\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n        s <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'utf8data\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span>         <span class="token comment"># s = \'A?BèC\'  len(s) = 5</span>\n\n\n<span class="token triple-quoted-string string">"""其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他----其他"""</span>\n\n<span class="token comment">#-- Python实现任意深度的赋值 例如a[0] = \'value1\'; a[1][2] = \'value2\'; a[3][4][5] = \'value3\'</span>\n    <span class="token keyword">class</span> <span class="token class-name">MyDict</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>                 <span class="token comment"># 该函数不做任何改动 这里只是为了输出</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'setitem:\'</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> self<span class="token punctuation">)</span>\n            <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__setitem__<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>\n        <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>                       <span class="token comment"># 主要技巧在该函数</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'getitem:\'</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> self<span class="token punctuation">)</span>                  <span class="token comment"># 输出信息</span>\n            <span class="token comment"># 基本思路: a[1][2]赋值时 需要先取出a[1] 然后给a[1]的[2]赋值</span>\n            <span class="token keyword">if</span> item <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">:</span>                           <span class="token comment"># 如果a[1]不存在 则需要新建一个dict 并使得a[1] = dict</span>\n                temp <span class="token operator">=</span> MyDict<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token comment"># 新建的dict: temp</span>\n                <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__setitem__<span class="token punctuation">(</span>item<span class="token punctuation">,</span> temp<span class="token punctuation">)</span>            <span class="token comment"># 赋值a[1] = temp</span>\n                <span class="token keyword">return</span> temp                                <span class="token comment"># 返回temp 使得temp[2] = value有效</span>\n            <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span>item<span class="token punctuation">)</span>               <span class="token comment"># 如果a[1]存在 则直接返回a[1]</span>\n    <span class="token comment"># 例子:</span>\n        test <span class="token operator">=</span> MyDict<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'test\'</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'test1\'</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n        test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'test2\'</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n\n<span class="token comment">#-- Python中的多维数组</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span>                                        <span class="token comment"># 扩展list，结果为[0, 0, 0]</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span>                                       <span class="token comment"># 多维数组，结果为[[], [], []]，但有问题，往下看</span>\n    lists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                                     <span class="token comment"># 期望看到的结果[[3], [], []]，实际结果[[3], [3], [3]]，原因：list*n操作，是浅拷贝，如何避免？往下看</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>                         <span class="token comment"># 多维数组，结果为[[], [], []]</span>\n    lists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                                     <span class="token comment"># 结果为[[3], [], []]</span>\n    lists<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>                                     <span class="token comment"># 结果为[[3], [6], []]</span>\n    lists<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>                                     <span class="token comment"># 结果为[[3], [6], [9]]</span>\n    lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>     <span class="token comment"># 3行4列，且每一个元素为[]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="版本二"><a href="#%E7%89%88%E6%9C%AC%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>版本二</h1>\n<h2 id="工具"><a href="#%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工具</h2>\n<h3 id="虚拟环境"><a href="#%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>虚拟环境</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37642700736817770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 安装\n\\$ pip install virtualenv\n\n# 创建环境\n\\$ virtualenv myproject\n\\$ source myproject/bin/activate\n\n# virtualenv 使用系统全局模块\n\\$ virtualenv --system-site-packages mycoolproject\n\n# 退出这个 virtualenv\n\\$ deactivate`, `37642700736817770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 安装</span>\n$ pip <span class="token function">install</span> virtualenv\n\n<span class="token comment"># 创建环境</span>\n$ virtualenv myproject\n$ <span class="token builtin class-name">source</span> myproject/bin/activate\n\n<span class="token comment"># virtualenv 使用系统全局模块</span>\n$ virtualenv --system-site-packages mycoolproject\n\n<span class="token comment"># 退出这个 virtualenv</span>\n$ deactivate</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="对象自省"><a href="#%E5%AF%B9%E8%B1%A1%E8%87%AA%E7%9C%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对象自省</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91443253111179020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`my_list = [1, 2, 3]\n# 列出一个对象所拥有的属性和方法\ndir(my_list)\n# 返回当前作用域的所有名字\ndir()\n\n# type 函数返回一个对象的类型\nprint(type(\'\')) # Output: <type \'str\'>\n\n# 函数返回任意不同种类对象的唯一 ID\nname = &quot;Yasoob&quot;\nprint(id(name)) # Output: 139972439030304\n\n# 查看一个对象的成员\nimport inspect\nprint(inspect.getmembers(str)) # Output: [(\'__add__\', <slot wrapper \'__add__\' of ... ...`, `91443253111179020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">my_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>\n<span class="token comment"># 列出一个对象所拥有的属性和方法</span>\n<span class="token builtin">dir</span><span class="token punctuation">(</span>my_list<span class="token punctuation">)</span>\n<span class="token comment"># 返回当前作用域的所有名字</span>\n<span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># type 函数返回一个对象的类型</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Output: &lt;type \'str\'></span>\n\n<span class="token comment"># 函数返回任意不同种类对象的唯一 ID</span>\nname <span class="token operator">=</span> <span class="token string">"Yasoob"</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Output: 139972439030304</span>\n\n<span class="token comment"># 查看一个对象的成员</span>\n<span class="token keyword">import</span> inspect\n<span class="token keyword">print</span><span class="token punctuation">(</span>inspect<span class="token punctuation">.</span>getmembers<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Output: [(\'__add__\', &lt;slot wrapper \'__add__\' of ... ...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="语法"><a href="#%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>语法</h2>\n<h3 id="异常"><a href="#%E5%BC%82%E5%B8%B8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异常</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65808643330480620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 正常例子\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept IOError as e:\n    print(\'An IOError occurred. {}\'.format(e.args[-1]))\n\n# 处理多个异常，有 3 种方法\n## 方法 1：\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept (IOError, EOFError) as e:\n    print(&quot;An error occurred. {}&quot;.format(e.args[-1]))\n##　方法 2：\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept EOFError as e:\n    print(&quot;An EOF error occurred.&quot;)\n    raise e\nexcept IOError as e:\n    print(&quot;An error occurred.&quot;)\n    raise e\n## 方法 3：\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept Exception:\n    # 打印一些异常日志，如果你想要的话\n    raise\n\n# finally 从句\ntry:\n    file = open(\'test.txt\', \'rb\')\nexcept IOError as e:\n    print(\'An IOError occurred. {}\'.format(e.args[-1]))\nfinally:\n    print(&quot;This would be printed whether or not an exception occurred!&quot;)\n# Output: An IOError occurred. No such file or directory\n# This would be printed whether or not an exception occurred!\n\n# try/else 从句\ntry:\n    print(\'I am sure no exception is going to occur!\')\nexcept Exception:\n    print(\'exception\')\nelse:\n    # 这里的代码只会在 try 语句里没有触发异常时运行,\n    # 但是这里的异常将 *不会* 被捕获\n    print(\'This would only run if no exception occurs. And an error here would NOT be caught.\')\nfinally:\n    print(\'This would be printed in every case.\')\n\n# Output: I am sure no exception is going to occur!\n# This would only run if no exception occurs. And an error here would NOT be caught.\n# This would be printed in every case.`, `65808643330480620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 正常例子</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'An IOError occurred. {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 处理多个异常，有 3 种方法</span>\n<span class="token comment">## 方法 1：</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> <span class="token punctuation">(</span>IOError<span class="token punctuation">,</span> EOFError<span class="token punctuation">)</span> <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"An error occurred. {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token comment">##　方法 2：</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> EOFError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"An EOF error occurred."</span><span class="token punctuation">)</span>\n    <span class="token keyword">raise</span> e\n<span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"An error occurred."</span><span class="token punctuation">)</span>\n    <span class="token keyword">raise</span> e\n<span class="token comment">## 方法 3：</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>\n    <span class="token comment"># 打印一些异常日志，如果你想要的话</span>\n    <span class="token keyword">raise</span>\n\n<span class="token comment"># finally 从句</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'test.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> IOError <span class="token keyword">as</span> e<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'An IOError occurred. {}\'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"This would be printed whether or not an exception occurred!"</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: An IOError occurred. No such file or directory</span>\n<span class="token comment"># This would be printed whether or not an exception occurred!</span>\n\n<span class="token comment"># try/else 从句</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'I am sure no exception is going to occur!\'</span><span class="token punctuation">)</span>\n<span class="token keyword">except</span> Exception<span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'exception\'</span><span class="token punctuation">)</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    <span class="token comment"># 这里的代码只会在 try 语句里没有触发异常时运行,</span>\n    <span class="token comment"># 但是这里的异常将 *不会* 被捕获</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'This would only run if no exception occurs. And an error here would NOT be caught.\'</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">\'This would be printed in every case.\'</span><span class="token punctuation">)</span>\n\n<span class="token comment"># Output: I am sure no exception is going to occur!</span>\n<span class="token comment"># This would only run if no exception occurs. And an error here would NOT be caught.</span>\n<span class="token comment"># This would be printed in every case.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="for---else"><a href="#for---else" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>For - Else</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45631224903551450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for n in range(2, 10):\n    for x in range(2, n):\n        if n % x == 0:\n            print(n, \'equals\', x, \'*\', n / x)\n            break\n    else: # 这个 else 从句会在循环正常结束时执行即循环没有遇到任何 break\n        # loop fell through without finding a factor\n        print(n, \'is a prime number\')`, `45631224903551450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">if</span> n <span class="token operator">%</span> x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>\n            <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token string">\'equals\'</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> <span class="token string">\'*\'</span><span class="token punctuation">,</span> n <span class="token operator">/</span> x<span class="token punctuation">)</span>\n            <span class="token keyword">break</span>\n    <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># 这个 else 从句会在循环正常结束时执行即循环没有遇到任何 break</span>\n        <span class="token comment"># loop fell through without finding a factor</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token string">\'is a prime number\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="三元运算符"><a href="#%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>三元运算符</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21490066202611290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 正常例子\nis_fat = True\nstate = &quot;fat&quot; if is_fat else &quot;not fat&quot;\n\n# 另一种用法，较少使用，会把 2 个条件都执行\nfat = True\nfitness = (&quot;skinny&quot;, &quot;fat&quot;)[fat]\nprint(&quot;Ali is&quot;, fitness)\n# 输出: Ali is fat`, `21490066202611290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 正常例子</span>\nis_fat <span class="token operator">=</span> <span class="token boolean">True</span>\nstate <span class="token operator">=</span> <span class="token string">"fat"</span> <span class="token keyword">if</span> is_fat <span class="token keyword">else</span> <span class="token string">"not fat"</span>\n\n<span class="token comment"># 另一种用法，较少使用，会把 2 个条件都执行</span>\nfat <span class="token operator">=</span> <span class="token boolean">True</span>\nfitness <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"skinny"</span><span class="token punctuation">,</span> <span class="token string">"fat"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>fat<span class="token punctuation">]</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ali is"</span><span class="token punctuation">,</span> fitness<span class="token punctuation">)</span>\n<span class="token comment"># 输出: Ali is fat</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="global"><a href="#global" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Global</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88621355646100850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 首先，是没有使用 global 变量\ndef add(value1, value2):\n    result = value1 + value2\n\nadd(2, 4)\nprint(result)\n\n# Oh 糟了，我们遇到异常了。为什么会这样？\n# python 解释器报错说没有一个叫 result 的变量。\n# 这是因为 result 变量只能在创建它的函数内部才允许访问，除非它是全局的(global)。\nTraceback (most recent call last):\n  File &quot;&quot;, line 1, in\n    result\nNameError: name \'result\' is not defined\n\n# 现在我们运行相同的代码，不过是在将 result 变量设为 global 之后\ndef add(value1, value2):\n    global result\n    result = value1 + value2\n\nadd(2, 4)\nprint(result)\n6`, `88621355646100850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 首先，是没有使用 global 变量</span>\n<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    result <span class="token operator">=</span> value1 <span class="token operator">+</span> value2\n\nadd<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n\n<span class="token comment"># Oh 糟了，我们遇到异常了。为什么会这样？</span>\n<span class="token comment"># python 解释器报错说没有一个叫 result 的变量。</span>\n<span class="token comment"># 这是因为 result 变量只能在创建它的函数内部才允许访问，除非它是全局的(global)。</span>\nTraceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>\n  File <span class="token string">""</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span>\n    result\nNameError<span class="token punctuation">:</span> name <span class="token string">\'result\'</span> <span class="token keyword">is</span> <span class="token keyword">not</span> defined\n\n<span class="token comment"># 现在我们运行相同的代码，不过是在将 result 变量设为 global 之后</span>\n<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">global</span> result\n    result <span class="token operator">=</span> value1 <span class="token operator">+</span> value2\n\nadd<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>\n<span class="token number">6</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="return"><a href="#return" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Return</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20822280078246380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 方法 1：\ndef profile():\n    name = &quot;Danny&quot;\n    age = 30\n    return (name, age)\n\nprofile_data = profile()\nprint(profile_data[0])\n# Output: Danny\n\nprint(profile_data[1])\n# Output: 30\n\n# 方法二：\ndef profile():\n    name = &quot;Danny&quot;\n    age = 30\n    return name, age`, `20822280078246380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 方法 1：</span>\n<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    name <span class="token operator">=</span> <span class="token string">"Danny"</span>\n    age <span class="token operator">=</span> <span class="token number">30</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>\n\nprofile_data <span class="token operator">=</span> profile<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">print</span><span class="token punctuation">(</span>profile_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: Danny</span>\n\n<span class="token keyword">print</span><span class="token punctuation">(</span>profile_data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: 30</span>\n\n<span class="token comment"># 方法二：</span>\n<span class="token keyword">def</span> <span class="token function">profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    name <span class="token operator">=</span> <span class="token string">"Danny"</span>\n    age <span class="token operator">=</span> <span class="token number">30</span>\n    <span class="token keyword">return</span> name<span class="token punctuation">,</span> age</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="open-函数"><a href="#open-%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>open 函数</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76066305457867850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 以下代码有问题\nf = open(\'photo.jpg\', \'r+\')\njpgdata = f.read()\nf.close()\n\n# 异常产生不会调用到 f.close()，需要包裹成 with 语句\n# 读取文件，传入 r；\n# 读取并写入文件，传入 r+；\n# 覆盖写入文件，传入 w；\n# 在文件末尾附加内容，传入 a；\nwith open(\'photo.jpg\', \'r+\') as f:\n    jpgdata = f.read()\n\n# 检测文件格式\nimport io\n# 二进制模式打开\nwith open(\'photo.jpg\', \'rb\') as inf:\n    jpgdata = inf.read()\n# 检测文件格式\nif jpgdata.startswith(b\'\\xff\\xd8\'):\n    text = u\'This is a JPEG file (%d bytes long)\\n\'\nelse:\n    text = u\'This is a random file (%d bytes long)\\n\'\n# io.open 兼容 python2.x 和 python3.x\nwith io.open(\'summary.txt\', \'w\', encoding=\'utf-8\') as outf:\n    outf.write(text % len(jpgdata))`, `76066305457867850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># 以下代码有问题</span>\nf <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'photo.jpg\'</span><span class="token punctuation">,</span> <span class="token string">\'r+\'</span><span class="token punctuation">)</span>\njpgdata <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\nf<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 异常产生不会调用到 f.close()，需要包裹成 with 语句</span>\n<span class="token comment"># 读取文件，传入 r；</span>\n<span class="token comment"># 读取并写入文件，传入 r+；</span>\n<span class="token comment"># 覆盖写入文件，传入 w；</span>\n<span class="token comment"># 在文件末尾附加内容，传入 a；</span>\n<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'photo.jpg\'</span><span class="token punctuation">,</span> <span class="token string">\'r+\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n    jpgdata <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 检测文件格式</span>\n<span class="token keyword">import</span> io\n<span class="token comment"># 二进制模式打开</span>\n<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'photo.jpg\'</span><span class="token punctuation">,</span> <span class="token string">\'rb\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> inf<span class="token punctuation">:</span>\n    jpgdata <span class="token operator">=</span> inf<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 检测文件格式</span>\n<span class="token keyword">if</span> jpgdata<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">b\'\\xff\\xd8\'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    text <span class="token operator">=</span> <span class="token string">u\'This is a JPEG file (%d bytes long)\\n\'</span>\n<span class="token keyword">else</span><span class="token punctuation">:</span>\n    text <span class="token operator">=</span> <span class="token string">u\'This is a random file (%d bytes long)\\n\'</span>\n<span class="token comment"># io.open 兼容 python2.x 和 python3.x</span>\n<span class="token keyword">with</span> io<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'summary.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">\'utf-8\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> outf<span class="token punctuation">:</span>\n    outf<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>jpgdata<span class="token punctuation">)</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="args-和-kwargs"><a href="#args-%E5%92%8C-kwargs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">*args</code> 和 <code class="language-text">**kwargs</code></h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65688823789675620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# *args\ndef test_var_args(f_arg, *argv):\n    print(&quot;first normal arg:&quot;, f_arg)\n    for arg in argv:\n        print(&quot;another arg through *argv:&quot;, arg)\n\ntest_var_args(\'yasoob\', \'python\', \'eggs\', \'test\')\n# Output:\n# first normal arg: yasoob\n# another arg through *argv: python\n# another arg through *argv: eggs\n# another arg through *argv: test\n\n## **kwargs\ndef greet_me(**kwargs):\n    for key, value in kwargs.items():\n        print(&quot;{0} == {1}&quot;.format(key, value))\ngreet_me(name=&quot;yasoob&quot;)\n# Output:\n# name == yasoob`, `65688823789675620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token comment"># *args</span>\n<span class="token keyword">def</span> <span class="token function">test_var_args</span><span class="token punctuation">(</span>f_arg<span class="token punctuation">,</span> <span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"first normal arg:"</span><span class="token punctuation">,</span> f_arg<span class="token punctuation">)</span>\n    <span class="token keyword">for</span> arg <span class="token keyword">in</span> argv<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"another arg through *argv:"</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>\n\ntest_var_args<span class="token punctuation">(</span><span class="token string">\'yasoob\'</span><span class="token punctuation">,</span> <span class="token string">\'python\'</span><span class="token punctuation">,</span> <span class="token string">\'eggs\'</span><span class="token punctuation">,</span> <span class="token string">\'test\'</span><span class="token punctuation">)</span>\n<span class="token comment"># Output:</span>\n<span class="token comment"># first normal arg: yasoob</span>\n<span class="token comment"># another arg through *argv: python</span>\n<span class="token comment"># another arg through *argv: eggs</span>\n<span class="token comment"># another arg through *argv: test</span>\n\n<span class="token comment">## **kwargs</span>\n<span class="token keyword">def</span> <span class="token function">greet_me</span><span class="token punctuation">(</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{0} == {1}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>\ngreet_me<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"yasoob"</span><span class="token punctuation">)</span>\n<span class="token comment"># Output:</span>\n<span class="token comment"># name == yasoob</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="上下文管理器"><a href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>上下文管理器</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13852414373931432000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`with open(\'some_file\', \'w\') as opened_file:\n    opened_file.write(\'Hola!\')\n# 等价于\nfile = open(\'some_file\', \'w\')\ntry:\n    file.write(\'Hola!\')\nfinally:\n    file.close()\n\n# 实现上下文管理器\n# 1. with 语句先暂存了 File 类的 __exit__ 方法。\n# 2. 然后它调用 File 类的 __enter__ 方法。\n# 3. __enter__ 方法打开文件并返回给 with 语句。\n# 4. 打开的文件句柄被传递给 opened_file 参数。\n# 5. 我们使用 .write() 来写文件。\n# 6. with 语句调用之前暂存的 __exit__ 方法。\n# 7. __exit__ 方法关闭了文件。\nclass File(object):\n    def __init__(self, file_name, method):\n        self.file_obj = open(file_name, method)\n    def __enter__(self):\n        return self.file_obj\n    def __exit__(self, type, value, traceback):\n        self.file_obj.close()\n# 使用\nwith File(\'demo.txt\', \'w\') as opened_file:\n    opened_file.write(\'Hola!\')\n\n# 尝试下在 __exit__ 方法中处理异常\n# 1. 它把异常的 type，value 和 traceback 传递给 __exit__方法。\n# 2. 它让 __exit__ 方法来处理异常。\n# 3. 如果 __exit__ 返回的是 True，那么这个异常就被优雅地处理了。\n# 4. 如果 __exit__ 返回的是 True 以外的任何东西，那么这个异常将被 with 语句抛出。\nclass File(object):\n    def __init__(self, file_name, method):\n        self.file_obj = open(file_name, method)\n    def __enter__(self):\n        return self.file_obj\n    def __exit__(self, type, value, traceback):\n        print(&quot;Exception has been handled&quot;)\n        self.file_obj.close()\n        return True\nwith File(\'demo.txt\', \'w\') as opened_file:\n    opened_file.undefined_function()\n# Output: Exception has been handled\n\n# 基于生成器的实现\n# 1. Python 解释器遇到了 yield 关键字。因为这个缘故它创建了一个生成器而不是一个普通的函数。\n# 2. 因为这个装饰器，contextmanager 会被调用并传入函数名（open_file）作为参数。\n# 3. contextmanager 函数返回一个以 GeneratorContextManager 对象封装过的生成器。\n# 4. 这个 GeneratorContextManager 被赋值给 open_file 函数，我们实际上是在调用 GeneratorContextManager 对象。\nfrom contextlib import contextmanager\n\n@contextmanager\ndef open_file(name):\n    f = open(name, \'w\')\n    yield f\n    f.close()\n# 使用\nwith open_file(\'some_file\') as f:\n    f.write(\'hola!\')`, `13852414373931432000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'some_file\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> opened_file<span class="token punctuation">:</span>\n    opened_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hola!\'</span><span class="token punctuation">)</span>\n<span class="token comment"># 等价于</span>\n<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">\'some_file\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span>\n<span class="token keyword">try</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hola!\'</span><span class="token punctuation">)</span>\n<span class="token keyword">finally</span><span class="token punctuation">:</span>\n    <span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 实现上下文管理器</span>\n<span class="token comment"># 1. with 语句先暂存了 File 类的 __exit__ 方法。</span>\n<span class="token comment"># 2. 然后它调用 File 类的 __enter__ 方法。</span>\n<span class="token comment"># 3. __enter__ 方法打开文件并返回给 with 语句。</span>\n<span class="token comment"># 4. 打开的文件句柄被传递给 opened_file 参数。</span>\n<span class="token comment"># 5. 我们使用 .write() 来写文件。</span>\n<span class="token comment"># 6. with 语句调用之前暂存的 __exit__ 方法。</span>\n<span class="token comment"># 7. __exit__ 方法关闭了文件。</span>\n<span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>file_obj <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span>\n    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>file_obj\n    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>file_obj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 使用</span>\n<span class="token keyword">with</span> File<span class="token punctuation">(</span><span class="token string">\'demo.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> opened_file<span class="token punctuation">:</span>\n    opened_file<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'Hola!\'</span><span class="token punctuation">)</span>\n\n<span class="token comment"># 尝试下在 __exit__ 方法中处理异常</span>\n<span class="token comment"># 1. 它把异常的 type，value 和 traceback 传递给 __exit__方法。</span>\n<span class="token comment"># 2. 它让 __exit__ 方法来处理异常。</span>\n<span class="token comment"># 3. 如果 __exit__ 返回的是 True，那么这个异常就被优雅地处理了。</span>\n<span class="token comment"># 4. 如果 __exit__ 返回的是 True 以外的任何东西，那么这个异常将被 with 语句抛出。</span>\n<span class="token keyword">class</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        self<span class="token punctuation">.</span>file_obj <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> method<span class="token punctuation">)</span>\n    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">return</span> self<span class="token punctuation">.</span>file_obj\n    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> traceback<span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Exception has been handled"</span><span class="token punctuation">)</span>\n        self<span class="token punctuation">.</span>file_obj<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token boolean">True</span>\n<span class="token keyword">with</span> File<span class="token punctuation">(</span><span class="token string">\'demo.txt\'</span><span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> opened_file<span class="token punctuation">:</span>\n    opened_file<span class="token punctuation">.</span>undefined_function<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># Output: Exception has been handled</span>\n\n<span class="token comment"># 基于生成器的实现</span>\n<span class="token comment"># 1. Python 解释器遇到了 yield 关键字。因为这个缘故它创建了一个生成器而不是一个普通的函数。</span>\n<span class="token comment"># 2. 因为这个装饰器，contextmanager 会被调用并传入函数名（open_file）作为参数。</span>\n<span class="token comment"># 3. contextmanager 函数返回一个以 GeneratorContextManager 对象封装过的生成器。</span>\n<span class="token comment"># 4. 这个 GeneratorContextManager 被赋值给 open_file 函数，我们实际上是在调用 GeneratorContextManager 对象。</span>\n<span class="token keyword">from</span> contextlib <span class="token keyword">import</span> contextmanager\n\n@contextmanager\n<span class="token keyword">def</span> <span class="token function">open_file</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">\'w\'</span><span class="token punctuation">)</span>\n    <span class="token keyword">yield</span> f\n    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token comment"># 使用</span>\n<span class="token keyword">with</span> open_file<span class="token punctuation">(</span><span class="token string">\'some_file\'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>\n    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">\'hola!\'</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO <a href="https://py.eastlakeside.cn/book/FunctionalProgramming/README.html" target="_blank" rel="nofollow noreferrer noopener">https://py.eastlakeside.cn/book/FunctionalProgramming/README.html</a></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Python语法一览/index.md absPath of file >>> MarkdownRemark",timeToRead:28,frontmatter:{date:"2022-04-18 14:16:27",path:"/python-syntax-overview/",tags:"后端, python, 读书笔记",title:"Python语法一览",draft:null}}],page:6,pagesSum:46,length:227,prevPath:"/page/5",nextPath:"/page/7"}}}});