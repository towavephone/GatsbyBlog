webpackJsonp([73561527382206],{1615:function(n,s){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"需求背景 最近要做一个将第三方聊天库打包为链接，以便于顾客端使用，类似于这个样子  , 以实现将代码嵌入到顾客端网站的 标签之前即可完成部署，开发过程中遇到诸多难点 需求难点 打包工具选型 最容易想到的办法就是沿用公司之前的 webpack 框架，这里升级到了 webpack4（见之前的文章  Webpack 配置笔记 ），考虑到打包后可能会包含一些 webpack 的多余代码，因此不是最优方案。但迫于技术的不成熟以及开发时间的压力，还是把 webpack…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近要做一个将第三方聊天库打包为链接，以便于顾客端使用，类似于这个样子 <code class="language-text">&lt;script src=&quot;打包后库的地址?deployId=部署ID&quot; name=&quot;唯一标识符&quot;&gt;&lt;/script&gt;</code>, 以实现将代码嵌入到顾客端网站的<code class="language-text">&lt;/body&gt;</code>标签之前即可完成部署，开发过程中遇到诸多难点</p>\n<h1 id="需求难点"><a href="#%E9%9C%80%E6%B1%82%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求难点</h1>\n<h2 id="打包工具选型"><a href="#%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打包工具选型</h2>\n<p>最容易想到的办法就是沿用公司之前的 webpack 框架，这里升级到了 webpack4（见之前的文章 <a href="/webpack-config-note/">Webpack 配置笔记</a>），考虑到打包后可能会包含一些 webpack 的多余代码，因此不是最优方案。但迫于技术的不成熟以及开发时间的压力，还是把 webpack 作为此次选型。这里需要后期优化，考虑到的方案有 rollup.js、jQuery、VanillaJS（原生 js）</p>\n<h2 id="打包工具重构"><a href="#%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E9%87%8D%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打包工具重构</h2>\n<p>这里需要将所有代码打包成一个类似于一个 js 文件，所以这里需要对框架做出调整，以下只列出改动的地方，其中标红的部分是最核心的改动</p>\n<h3 id="webpackbasebabeljs"><a href="#webpackbasebabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.base.babel.js</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29012896576501658000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// const CopyWebpackPlugin = require(\'copy-webpack-plugin\'); 去掉 copy-webpack-plugin\n\n{\n  test: /\\.(jpe?g|png|gif|svg)\\$/,\n  use: [\n    {\n      loader: \'url-loader\',\n      options: {\n        // Inline files smaller than 10 kB，尽可能将所有的图片内联到 js\n        limit: 100 * 1024,\n      },\n    },\n  ],\n},\n\nnew webpack.optimize.MinChunkSizePlugin({\n  minChunkSize: Infinity, // Minimum number of characters，尽可能的打包 js 为一个文件\n}),\n\n// 屏蔽 CopyWebpackPlugin 没用\n// new CopyWebpackPlugin([\n//   \'app/favicon.ico\',\n//   \'app/manifest.json\',\n// ].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))),`, `29012896576501658000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{16-18}"\n              >\n                <span class="gatsby-code-button-language">js{16-18}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// const CopyWebpackPlugin = require(\'copy-webpack-plugin\'); 去掉 copy-webpack-plugin</span>\n\n<span class="token punctuation">{</span>\n  test<span class="token punctuation">:</span> <span class="token regex">/\\.(jpe?g|png|gif|svg)$/</span><span class="token punctuation">,</span>\n  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      loader<span class="token punctuation">:</span> <span class="token string">\'url-loader\'</span><span class="token punctuation">,</span>\n      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Inline files smaller than 10 kB，尽可能将所有的图片内联到 js</span>\n        limit<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>MinChunkSizePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  minChunkSize<span class="token punctuation">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span> <span class="token comment">// Minimum number of characters，尽可能的打包 js 为一个文件</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="token comment">// 屏蔽 CopyWebpackPlugin 没用</span>\n<span class="token comment">// new CopyWebpackPlugin([</span>\n<span class="token comment">//   \'app/favicon.ico\',</span>\n<span class="token comment">//   \'app/manifest.json\',</span>\n<span class="token comment">// ].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))),</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="webpackprodbabeljs"><a href="#webpackprodbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.prod.babel.js</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77475834714704990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// const LodashModuleReplacementPlugin = require(\'lodash-webpack-plugin\'); 实测对打包成一个 js 时有影响，暂未找到原因\n\ncssDebug: true, // 打开 cssDebug，以避免使用 MiniCssExtractPlugin，会产生多余的 css\nentry: \'./app/app.js\', // 改变入口，不分包\noutput: {\n  filename: \'bundle.js\', // 只输出一个 bundle.js 文件\n},\n\nsplitChunks: false,  // 关闭分包优化，下面同理\nruntimeChunk: false,\n\n// new LodashModuleReplacementPlugin(), // lodash 优化，暂时屏蔽，理由同上\n// new webpack.HashedModuleIdsPlugin(), // 不需要固定 chunkhash，因为只有一个文件`, `77475834714704990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// const LodashModuleReplacementPlugin = require(\'lodash-webpack-plugin\'); 实测对打包成一个 js 时有影响，暂未找到原因</span>\n\ncssDebug<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 打开 cssDebug，以避免使用 MiniCssExtractPlugin，会产生多余的 css</span>\nentry<span class="token punctuation">:</span> <span class="token string">\'./app/app.js\'</span><span class="token punctuation">,</span> <span class="token comment">// 改变入口，不分包</span>\noutput<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  filename<span class="token punctuation">:</span> <span class="token string">\'bundle.js\'</span><span class="token punctuation">,</span> <span class="token comment">// 只输出一个 bundle.js 文件</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\nsplitChunks<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 关闭分包优化，下面同理</span>\nruntimeChunk<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n\n<span class="token comment">// new LodashModuleReplacementPlugin(), // lodash 优化，暂时屏蔽，理由同上</span>\n<span class="token comment">// new webpack.HashedModuleIdsPlugin(), // 不需要固定 chunkhash，因为只有一个文件</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上就实现了将所有代码都打包到一个 bundle.js 文件</p>\n<h2 id="bundlejs-插入渲染结点"><a href="#bundlejs-%E6%8F%92%E5%85%A5%E6%B8%B2%E6%9F%93%E7%BB%93%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bundle.js 插入渲染结点</h2>\n<p>原来的方式是在 index.html 中写要渲染的 div 标签，由于引入到顾客端时是不可能在别人的 html 中写入 div 标签，所以解决方案如下</p>\n<p>主要是对 app.js 入口文件做出改动，在渲染 app.js 时通过主动创建一个 div 结点加入到 body 标签的最后</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24674984637713936000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const render = () => {\n  const root = document.createElement(\'div\');\n  document.querySelector(\'body\').appendChild(root);\n  ReactDOM.render(<App />, root);\n};\n\nrender();`, `24674984637713936000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="bundlejs-二次引入-babel-polyfill"><a href="#bundlejs-%E4%BA%8C%E6%AC%A1%E5%BC%95%E5%85%A5-babel-polyfill" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bundle.js 二次引入 babel-polyfill</h2>\n<p>在顾客端同样引用 babel-polyfill 的情况下，会造成 bundle.js 的报错，此时需要判断</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66532353084566176000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (!global._babelPolyfill) {\n  // 防止二次引入\n  require(\'babel-polyfill\');\n}`, `66532353084566176000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>global<span class="token punctuation">.</span>_babelPolyfill<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 防止二次引入</span>\n  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'babel-polyfill\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="bundlejs-报错会引起顾客端整个崩溃"><a href="#bundlejs-%E6%8A%A5%E9%94%99%E4%BC%9A%E5%BC%95%E8%B5%B7%E9%A1%BE%E5%AE%A2%E7%AB%AF%E6%95%B4%E4%B8%AA%E5%B4%A9%E6%BA%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bundle.js 报错会引起顾客端整个崩溃</h2>\n<p>需要引入 ErrorBoundary 组件，即使报错也只有引入的 bundle.js 聊天窗口崩溃</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82439978646356100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport PropTypes from \'prop-types\';\n\nclass ErrorBoundary extends React.Component {\n  static propTypes = {\n    children: PropTypes.node\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = { error: null, errorInfo: null };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.log(error, errorInfo);\n    // Display fallback UI\n    this.setState({ error, errorInfo });\n    // You can also log the error to an error reporting service\n  }\n\n  render() {\n    // if (this.state.hasError) {\n    //   // You can render any custom fallback UI\n    //   return <h1>Something went wrong.</h1>;\n    // }\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;`, `82439978646356100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">\'prop-types\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    children<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>node\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> errorInfo<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// Display fallback UI</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">,</span> errorInfo <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// You can also log the error to an error reporting service</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// if (this.state.hasError) {</span>\n    <span class="token comment">//   // You can render any custom fallback UI</span>\n    <span class="token comment">//   return &lt;h1>Something went wrong.&lt;/h1>;</span>\n    <span class="token comment">// }</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> ErrorBoundary<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在预测可能要报错的结点前包裹 ErrorBoundary</p>\n<h2 id="修改主题色"><a href="#%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%A2%98%E8%89%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修改主题色</h2>\n<p>由于需要实现读取后端给出的样式变量，所以需要实现在 css 样式中读取到 js 变量，找了很多资料，发现最理想的还是 styled-components 可以在内联的 css 中读取到变量</p>\n<p>但是由于 bundle.js 的大小已经达到了 1.6M 左右，再引入 styled-components 只怕会更大，所以暂时只能通过 style 样式在代码里写，当然，这个是不能实现比如说在 hover 状态下改变 css 样式，对于这个问题，暂未想到比较好的解决方案</p>\n<h2 id="nginx-相关设置"><a href="#nginx-%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>nginx 相关设置</h2>\n<h3 id="跨域设置-cookie"><a href="#%E8%B7%A8%E5%9F%9F%E8%AE%BE%E7%BD%AE-cookie" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨域设置 cookie</h3>\n<p>由于顾客端是未知域名，所以涉及到跨域设置 cookie 的问题，需要前后端同时设置才能做到跨域设置 cookie</p>\n<h3 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h3>\n<p>CORS 把 HTTP 请求分成两类，不同类别按不同的策略进行跨域资源共享协商。</p>\n<ol>\n<li>\n<p>简单跨域请求</p>\n<p>当 HTTP 请求出现以下两种情况时，浏览器认为是简单跨域请求：</p>\n<ol>\n<li>请求方法是 GET、HEAD 或者 POST，并且当请求方法是 POST 时，Content-Type 必须是 application/x-www-form-urlencoded, multipart/form-data 或着 text/plain 中的一个值。</li>\n<li>请求中没有自定义 HTTP 头部。</li>\n</ol>\n<p>对于简单跨域请求，浏览器要做的就是在 HTTP 请求中添加 Origin Header，将 JavaScript 脚本所在域填充进去，向其他域的服务器请求资源。服务器端收到一个简单跨域请求后，根据资源权限配置，在响应头中添加 Access-Control-Allow-Origin Header。浏览器收到响应后，查看 Access-Control-Allow-Origin Header，如果当前域已经得到授权，则将结果返回给 JavaScript，否则浏览器忽略此次响应。</p>\n</li>\n<li>\n<p>带预检 (Preflighted) 的跨域请求</p>\n<p>当 HTTP 请求出现以下两种情况时，浏览器认为是带预检 (Preflighted) 的跨域请求：</p>\n<ol>\n<li>除 GET、HEAD 和 POST(only with application/x-www-form-urlencoded, multipart/form-data, text/plain Content-Type) 以外的其他 HTTP 方法。</li>\n<li>请求中出现自定义 HTTP 头部。</li>\n</ol>\n<p>带预检 (Preflighted) 的跨域请求需要浏览器在发送真实 HTTP 请求之前先发送一个 OPTIONS 的预检请求，检测服务器端是否支持真实请求进行跨域资源访问，真实请求的信息在 OPTIONS 请求中通过 Access-Control-Request-Method Header 和 Access-Control-Request-Headers Header 描述，此外与简单跨域请求一样，浏览器也会添加 Origin Header。服务器端接到预检请求后，根据资源权限配置，在响应头中放入 Access-Control-Allow-Origin Header、Access-Control-Allow-Methods 和 Access-Control-Allow-Headers Header，分别表示允许跨域资源请求的域、请求方法和请求头。此外，服务器端还可以加入 Access-Control-Max-Age Header，允许浏览器在指定时间内，无需再发送预检请求进行协商，直接用本次协商结果即可。浏览器根据 OPTIONS 请求返回的结果来决定是否继续发送真实的请求进行跨域资源访问，这个过程对真实请求的调用者来说是透明的。</p>\n</li>\n</ol>\n<p>XMLHttpRequest 支持通过 withCredentials 属性实现在跨域请求携带身份信息 (Credential，例如 Cookie 或者 HTTP 认证信息)。浏览器将携带 Cookie Header 的请求发送到服务器端后，如果服务器没有响应 Access-Control-Allow-Credentials Header，那么浏览器会忽略掉这次响应。</p>\n<p>这里讨论的 HTTP 请求是指由 Ajax XMLHttpRequest 对象发起的，所有的 CORS HTTP 请求头都可由浏览器填充，无需在 XMLHttpRequest 对象中设置。以下是 CORS 协议规定的 HTTP 头，用来进行浏览器发起跨域资源请求时进行协商：</p>\n<ol>\n<li>Origin。HTTP 请求头，任何涉及 CORS 的请求都必需携带。</li>\n<li>Access-Control-Request-Method。HTTP 请求头，在带预检 (Preflighted) 的跨域请求中用来表示真实请求的方法。</li>\n<li>Access-Control-Request-Headers。HTTP 请求头，在带预检 (Preflighted) 的跨域请求中用来表示真实请求的自定义 Header 列表。</li>\n<li>Access-Control-Allow-Origin。HTTP 响应头，指定服务器端允许进行跨域资源访问的来源域。可以用通配符 * 表示允许任何域的 JavaScript 访问资源，但是在响应一个携带身份信息 (Credential) 的 HTTP 请求时，Access-Control-Allow-Origin 必需指定具体的域，不能用通配符。</li>\n<li>Access-Control-Allow-Methods。HTTP 响应头，指定服务器允许进行跨域资源访问的请求方法列表，一般用在响应预检请求上。</li>\n<li>Access-Control-Allow-Headers。HTTP 响应头，指定服务器允许进行跨域资源访问的请求头列表，一般用在响应预检请求上。</li>\n<li>Access-Control-Max-Age。HTTP 响应头，用在响应预检请求上，表示本次预检响应的有效时间。在此时间内，浏览器都可以根据此次协商结果决定是否有必要直接发送真实请求，而无需再次发送预检请求。</li>\n<li>Access-Control-Allow-Credentials。HTTP 响应头，凡是浏览器请求中携带了身份信息，而响应头中没有返回 Access-Control-Allow-Credentials:true 的，浏览器都会忽略此次响应。</li>\n</ol>\n<h4 id="后端"><a href="#%E5%90%8E%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后端</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95812920329010660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 设置到某个文件下的别名，可以通过 /im 访问到调试端\nlocation ^~ /im {\n  alias /home/frontend/pony/;\n}\n# 设置到某个文件下的别名，可以通过 /bundle.js 直接访问到 bundle.js\nlocation = /bundle.js {\n  alias /home/frontend/pony/bundle.js;\n}\n# 反代设置跨域并允许设置 cookie\nlocation /service-tp-api/ {\n  add_header Access-Control-Allow-Credentials true;  # 是否允许发送 Cookie\n  add_header Access-Control-Allow-Origin \\$http_origin; # 这里 \\$http_origin 代表引用 bundle.js 的网站域名（真实域名），不能设置为 * ，否则不能成功设置 cookie\n  add_header Access-Control-Allow-Methods \'GET, POST, OPTIONS\'; # 用到哪些 HTTP 方法\n  add_header Access-Control-Allow-Headers \'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,Cookie,Set-Cookie,x-requested-with,content-type,pragma\'; # 允许使用的 header 字段，可以查看自己的 request 来进行添加\n\n  if (\\$request_method = \'OPTIONS\') {\n    # 跨域预检\n    return 204;\n  }\n\n  # 以下是反代到哪里\n  proxy_pass http://localhost:10602/api/im-service/;\n  proxy_redirect off;\n  proxy_set_header Host \\$host;\n  proxy_set_header X-Real-IP \\$remote_addr;\n  proxy_set_header X-Forward-For \\$proxy_add_x_forwarded_for;\n}`, `95812920329010660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 设置到某个文件下的别名，可以通过 /im 访问到调试端</span>\nlocation ^~ /im <span class="token punctuation">{</span>\n  <span class="token builtin class-name">alias</span> /home/frontend/pony/<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment"># 设置到某个文件下的别名，可以通过 /bundle.js 直接访问到 bundle.js</span>\nlocation <span class="token operator">=</span> /bundle.js <span class="token punctuation">{</span>\n  <span class="token builtin class-name">alias</span> /home/frontend/pony/bundle.js<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment"># 反代设置跨域并允许设置 cookie</span>\nlocation /service-tp-api/ <span class="token punctuation">{</span>\n  add_header Access-Control-Allow-Credentials <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment"># 是否允许发送 Cookie</span>\n  add_header Access-Control-Allow-Origin <span class="token variable">$http_origin</span><span class="token punctuation">;</span> <span class="token comment"># 这里 $http_origin 代表引用 bundle.js 的网站域名（真实域名），不能设置为 * ，否则不能成功设置 cookie</span>\n  add_header Access-Control-Allow-Methods <span class="token string">\'GET, POST, OPTIONS\'</span><span class="token punctuation">;</span> <span class="token comment"># 用到哪些 HTTP 方法</span>\n  add_header Access-Control-Allow-Headers <span class="token string">\'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,Cookie,Set-Cookie,x-requested-with,content-type,pragma\'</span><span class="token punctuation">;</span> <span class="token comment"># 允许使用的 header 字段，可以查看自己的 request 来进行添加</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">\'OPTIONS\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment"># 跨域预检</span>\n    <span class="token builtin class-name">return</span> <span class="token number">204</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment"># 以下是反代到哪里</span>\n  proxy_pass http://localhost:10602/api/im-service/<span class="token punctuation">;</span>\n  proxy_redirect off<span class="token punctuation">;</span>\n  proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>\n  proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>\n  proxy_set_header X-Forward-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="前端"><a href="#%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端</h4>\n<p>主要就是 fetch 方法里面添加 mode 和 credentials 字段，或者如果是 xhr 的话设置 withCredentials</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25909887177198620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export function createDebugUserInfo(data) {\n  return httpFetch(\'/service-tp-api/create-debug-user\', {\n    method: \'POST\',\n    data,\n    mode: \'cors\',\n    credentials: \'include\'\n  });\n}`, `25909887177198620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createDebugUserInfo</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">httpFetch</span><span class="token punctuation">(</span><span class="token string">\'/service-tp-api/create-debug-user\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    method<span class="token punctuation">:</span> <span class="token string">\'POST\'</span><span class="token punctuation">,</span>\n    data<span class="token punctuation">,</span>\n    mode<span class="token punctuation">:</span> <span class="token string">\'cors\'</span><span class="token punctuation">,</span>\n    credentials<span class="token punctuation">:</span> <span class="token string">\'include\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上更新于<code class="language-text">2019-5-11 17:52:48</code></p>\n<hr>\n<h2 id="光标位置的读取写入"><a href="#%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE%E7%9A%84%E8%AF%BB%E5%8F%96%E5%86%99%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>光标位置的读取写入</h2>\n<p>由于要实现中间插入标签或者换行符的效果，光标位置的读取与写入还是非常重要的，否则光标会“乱飘”</p>\n<h3 id="读取光标位置"><a href="#%E8%AF%BB%E5%8F%96%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>读取光标位置</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26773799570086830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function getCursorPosition(textDom) {\n  let cursorPos = 0;\n  if (document.selection) {\n    // IE Support\n    textDom.focus();\n    const selectRange = document.selection.createRange();\n    selectRange.moveStart(\'character\', -textDom.value.length);\n    cursorPos = selectRange.text.length;\n  } else if (textDom.selectionStart || textDom.selectionStart === 0) {\n    // Firefox support\n    cursorPos = textDom.selectionStart;\n  }\n  return cursorPos;\n}`, `26773799570086830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">textDom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> cursorPos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// IE Support</span>\n    textDom<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> selectRange <span class="token operator">=</span> document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    selectRange<span class="token punctuation">.</span><span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token operator">-</span>textDom<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cursorPos <span class="token operator">=</span> selectRange<span class="token punctuation">.</span>text<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>textDom<span class="token punctuation">.</span>selectionStart <span class="token operator">||</span> textDom<span class="token punctuation">.</span>selectionStart <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Firefox support</span>\n    cursorPos <span class="token operator">=</span> textDom<span class="token punctuation">.</span>selectionStart<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> cursorPos<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="写入光标位置"><a href="#%E5%86%99%E5%85%A5%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>写入光标位置</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35328271575056937000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function setCursorPosition(elem, index) {\n  const val = elem.value;\n  const len = val.length;\n\n  // 超过文本长度直接返回\n  if (len < index) return;\n  // 注意这里的 setTimeout 延迟写入，否则不生效\n  setTimeout(() => {\n    elem.focus();\n    if (elem.setSelectionRange) {\n      // 标准浏览器\n      elem.setSelectionRange(index, index);\n    } else {\n      // IE9-\n      const range = elem.createTextRange();\n      range.moveStart(\'character\', -len);\n      range.moveEnd(\'character\', -len);\n      range.moveStart(\'character\', index);\n      range.moveEnd(\'character\', 0);\n      range.select();\n    }\n  }, 0);\n}`, `35328271575056937000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">elem<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> val <span class="token operator">=</span> elem<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> len <span class="token operator">=</span> val<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n\n  <span class="token comment">// 超过文本长度直接返回</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token comment">// 注意这里的 setTimeout 延迟写入，否则不生效</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    elem<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>setSelectionRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 标准浏览器</span>\n      elem<span class="token punctuation">.</span><span class="token function">setSelectionRange</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// IE9-</span>\n      <span class="token keyword">const</span> range <span class="token operator">=</span> elem<span class="token punctuation">.</span><span class="token function">createTextRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token operator">-</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveEnd</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token operator">-</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveEnd</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上更新于<code class="language-text">2019-5-22 10:01:50</code></p>\n<hr>\n<h1 id="最终实现效果"><a href="#%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最终实现效果</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-05-11-17-58-09-aaffb4e7585ee5a923cfe6afde592009-db987.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 782px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 26.08695652173913%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArElEQVQY023NyW7FMAgF0Pz/R1ZqpCappzgDBGyMH4k6LNqrI4QXvgxuWt0c0oqX9JOagWf+7Df+3zCO+f0tjvPpAiWQzD2TZtaN1Zb1W7p+RYO3gbBA2LeUvYMQ+QTOB02pTLFkEDgYUaqoSq1VRZoa1f5kODY8lrTF7FJdAn0GmgNNnj48LZEXT7Onfb/KhYDCJEK1Sfv6DAkKkpU1a3x067Vh7ht3nkf/mxd3kCGAW/E3OwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 05 11 17 58 09" title="" data-src="/static/2019-05-11-17-58-09-aaffb4e7585ee5a923cfe6afde592009-db987.png" data-srcset="/static/2019-05-11-17-58-09-aaffb4e7585ee5a923cfe6afde592009-18266.png 200w,\n/static/2019-05-11-17-58-09-aaffb4e7585ee5a923cfe6afde592009-975aa.png 400w,\n/static/2019-05-11-17-58-09-aaffb4e7585ee5a923cfe6afde592009-db987.png 782w" data-sizes="(max-width: 782px) 100vw, 782px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-a484c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 577px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 139.3414211438475%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC0klEQVQ4y72TS0/UQBzA93tggvHghYOJBw+ePPMhjCePfg58xFfAiBpBMIBAEFgCshpFAZfHLshjee2Tbru7fW2n7XQ603Zap0gWhAUhUf/5HWY685vOzP8/keuxjjvx5JWJp03jTy6PPWwcvX/xZC5FH1wYuftsfZ6YjqQZkRufultTuasf2q7F2prGHzcMt7Dhk2gcvdcw0tK6Ft+XEyKXkPKLFW6hwiVFflkWlqU95N9YkvglMWRR5NKSXAWWCmCEEo9i6hOGh3QDyCrUdAsYlqabqsbaIUD3bCecSTw2TQWWrJmhDJFdQ9N1RVU1AERVFWSpJEtKVWPdqgZMiGrTJM1UfskWwjWQTRgYO7uamlGlvKYYCNt7Hw9Pqy8frBJCUL2hP8un85fkvXPaCJ2AjdEpsm3jbDbPFSt+EPh+HQhxoGXXl4njUqJSq0gt3oOCZ5U8XfBgibVdJHmea2NyXJY1QwFmxPECxE2Cjdco3YUzr3Cu3d5uR1vP8c4La6eH2ObxM7MKMXQbGjhC3ICUpqvbA0p+AhbelTMxLfceFAZh9g0q9DgYHpdFzVivlBkR1w1kfim3ESvP9ILNbjXbp271s1XMTLSS6mO7ZueqbZs1XOwuCsVb3wdvxgcjjhuYwpS41mGuvlyLTi70fwapt3ah19kdMrPdPqtplx6RkwLfPNXV/LUzlKvFL/pOJ+b7Ut+GEx/HN+cGVlbj6eQYmB0KHOJ43uELY5UnqPo0l58t5tltBz5MO9yKWC6JiTkorCPAI1M0+RlL5sNUOUdTJWvQ0JFp2BFWCRCaAOisWnzqU+r5LKjL8FhnP+hhVN0KU83y7DgEQsuE0GVXd7aoGmj/PVNKga5jTIIzx4Ec7pHS4DxxIAfnj/8uszfGckB9/9//mV0kJphlmdVJ4NIf1dKdRLQtPafolnIW2SGE5Z8tEbh+UuVvzw892pqpyT8B/ZABox2pPncAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 05 11 17 55 32" title="" data-src="/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-a484c.png" data-srcset="/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-64be4.png 200w,\n/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-6870d.png 400w,\n/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-a484c.png 577w" data-sizes="(max-width: 577px) 100vw, 577px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/记一次组件打包为链接的实践/index.md absPath of file >>> MarkdownRemark",timeToRead:7,frontmatter:{date:"2019-05-11 14:47:57",path:"/components-pack-as-library/",tags:"前端, 前端构建工具, webpack, 预研",title:"记一次组件打包为链接的实践",draft:null}},{excerpt:"webpack4 配置一览 基于 react-boilerplate 技术栈 antd + react + less 不断更新 前端的发展 模块化 模块化是指把一个复杂的系统分解到多个模块以方便编码。 挂载到变量 jQuery 库把它的 API 都放在了   下，在加载完 jQuery 后其他模块再通过   去使用 jQuery 命名空间冲突，两个库可能会使用同一个名称，例如 Zepto 也被放在   下； 无法合理地管理项目的依赖和版本； 无法方便地控制依赖的加载顺序。 CommonJS…",html:'<h1 id="webpack4-配置一览"><a href="#webpack4-%E9%85%8D%E7%BD%AE%E4%B8%80%E8%A7%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack4 配置一览</h1>\n<ul>\n<li>基于<a href="https://github.com/react-boilerplate/react-boilerplate" target="_blank" rel="nofollow noreferrer noopener">react-boilerplate</a></li>\n<li>技术栈 antd + react + less</li>\n<li>不断更新</li>\n</ul>\n<h2 id="前端的发展"><a href="#%E5%89%8D%E7%AB%AF%E7%9A%84%E5%8F%91%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端的发展</h2>\n<h3 id="模块化"><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块化</h3>\n<p>模块化是指把一个复杂的系统分解到多个模块以方便编码。</p>\n<h3 id="挂载到变量"><a href="#%E6%8C%82%E8%BD%BD%E5%88%B0%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挂载到变量</h3>\n<p>jQuery 库把它的 API 都放在了 <code class="language-text">window.$</code> 下，在加载完 jQuery 后其他模块再通过 <code class="language-text">window.$</code> 去使用 jQuery</p>\n<ul>\n<li>命名空间冲突，两个库可能会使用同一个名称，例如 Zepto 也被放在 <code class="language-text">window.$</code> 下；</li>\n<li>无法合理地管理项目的依赖和版本；</li>\n<li>无法方便地控制依赖的加载顺序。</li>\n</ul>\n<h3 id="commonjs"><a href="#commonjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CommonJS</h3>\n<p>通过 require 方法来同步地加载依赖的其他模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90502859197835670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 导入\nconst moduleA = require(\'./moduleA\');\n\n// 导出\nmodule.exports = moduleA.someFunc;`, `90502859197835670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 导入</span>\n<span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./moduleA\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 导出</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>someFunc<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>CommonJS 的优点在于：</p>\n<ul>\n<li>代码可复用于 Node.js 环境下并运行，例如做同构应用；</li>\n<li>通过 NPM 发布的很多第三方模块都采用了 CommonJS 规范。</li>\n</ul>\n<p>缺点在于这样的代码无法直接运行在浏览器环境下，必须通过工具转换成标准的 ES5。</p>\n<h3 id="amd"><a href="#amd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AMD</h3>\n<p>采用异步的方式去加载依赖的模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35982799607015760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(\'module\', [\'dep\'], function(dep) {\n  return exports;\n});\n\n// 导入和使用\nrequire([\'module\'], function(module) {});`, `35982799607015760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'module\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'dep\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> exports<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 导入和使用</span>\n<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'module\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>AMD 的优点在于：</p>\n<ul>\n<li>可在不转换代码的情况下直接在浏览器中运行；</li>\n<li>可异步加载依赖；</li>\n<li>可并行加载多个依赖；</li>\n<li>代码可运行在浏览器环境和 Node.js 环境下。</li>\n</ul>\n<p>AMD 的缺点在于 JavaScript 运行环境没有原生支持 AMD，需要先导入实现了 AMD 的库后才能正常使用。</p>\n<h3 id="es6-模块化"><a href="#es6-%E6%A8%A1%E5%9D%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES6 模块化</h3>\n<p>逐渐取代 CommonJS 和 AMD 规范</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7452596792831390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 导入\nimport { readFile } from \'fs\';\nimport React from \'react\';\n// 导出\nexport function hello() {}\nexport default {\n  // ...\n};`, `7452596792831390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 导入</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'fs\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 导出</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它的缺点在于目前无法直接运行在大部分 JavaScript 运行环境下，必须通过工具转换成标准的 ES5 后才能正常运行。</p>\n<h2 id="webpack-核心概念"><a href="#webpack-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 核心概念</h2>\n<p>源代码无法直接运行，必须通过转换后才可以正常运行。</p>\n<ul>\n<li>Entry：入口，Webpack 执行构建的第一步将从 Entry 开始，可抽象成输入。</li>\n<li>Module：模块，在 Webpack 里一切皆模块，一个模块对应着一个文件。Webpack 会从配置的 Entry 开始递归找出所有依赖的模块。</li>\n<li>Chunk：代码块，一个 Chunk 由多个模块组合而成，用于代码合并与分割。</li>\n<li>Loader：模块转换器，用于把模块原内容按照需求转换成新内容。</li>\n<li>Plugin：扩展插件，在 Webpack 构建流程中的特定时机注入扩展逻辑来改变构建结果或做你想要的事情。</li>\n<li>Output：输出结果，在 Webpack 经过一系列处理并得出最终想要的代码后输出结果。</li>\n</ul>\n<p>Webpack 启动后会从 Entry 里配置的 Module 开始递归解析 Entry 依赖的所有 Module。每找到一个 Module，就会根据配置的 Loader 去找出对应的转换规则，对 Module 进行转换后，再解析出当前 Module 依赖的 Module。这些模块会以 Entry 为单位进行分组，一个 Entry 和其所有依赖的 Module 被分到一个组也就是一个 Chunk。最后 Webpack 会把所有 Chunk 转换成文件输出。在整个流程中 Webpack 会在恰当的时机执行 Plugin 里定义的逻辑。</p>\n<h2 id="webpackbasebabeljs"><a href="#webpackbasebabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.base.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27784018975281310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * COMMON WEBPACK CONFIGURATION\n */\n\nconst path = require(\'path\');\nconst webpack = require(\'webpack\');\n\nconst fs = require(\'fs\');\nconst lessToJs = require(\'less-vars-to-js\');\nconst themer = lessToJs(fs.readFileSync(path.join(__dirname, \'../../app/antd-theme/theme.less\'), \'utf8\'));\n\nconst postcssGlobalImport = require(\'postcss-global-import\');\nconst postcssImport = require(\'postcss-import\');\nconst postcssCustomProperties = require(\'postcss-custom-properties\');\nconst postcssCustomMedia = require(\'postcss-custom-media\');\nconst postcssMediaMinmax = require(\'postcss-media-minmax\');\nconst postcssCustomSelectors = require(\'postcss-custom-selectors\');\nconst postcssCalc = require(\'postcss-calc\');\nconst postcssNesting = require(\'postcss-nesting\');\nconst postcssNested = require(\'postcss-nested\');\nconst postcssColorFunction = require(\'postcss-color-function\');\nconst pleeeaseFilters = require(\'pleeease-filters\');\nconst pixrem = require(\'pixrem\');\nconst postcssSelectorMatches = require(\'postcss-selector-matches\');\nconst postcssSelectorNot = require(\'postcss-selector-not\');\nconst postcssFlexbugsFixes = require(\'postcss-flexbugs-fixes\');\nconst autoprefixer = require(\'autoprefixer\');\nconst globalJSON = require(path.resolve(process.cwd(), \'global.json\'));\n\n// 将 CSS 提取到单独的文件中，它为每个包含 CSS 的 JS 文件创建一个 CSS 文件，它支持 CSS 和 SourceMaps 的按需加载。\nconst MiniCssExtractPlugin = require(\'mini-css-extract-plugin\');\nconst SimpleProgressWebpackPlugin = require(\'simple-progress-webpack-plugin\');\nconst CopyWebpackPlugin = require(\'copy-webpack-plugin\');\n\nmodule.exports = (options) => ({\n  // context: path.resolve(__dirname, \'app\') // 默认 context 为根目录，影响相对路径所指向的真实文件\n  entry: options.entry, // 必填，配置模块的入口\n  mode: options.mode,\n  optimization: options.optimization,\n  output: Object.assign(\n    {\n      // Compile into js/build.js\n      // 配置输出文件存放在本地的目录\n      path: path.resolve(process.cwd(), \'build\'),\n      // 发布到线上的所有资源的 URL 前缀，string 类型\n      publicPath: \'/\'\n    },\n    options.output\n  ), // Merge with env dependent settings\n  module: {\n    // 配置如何处理模块。\n    rules: [\n      {\n        test: /\\.js\\$/, // Transform all .js files required somewhere with Babel\n        // 尽可能的缩小命中范围，加快 Webpack 搜索速度\n        include: [/app/, /unicorn/],\n        // 排除 node_modules 目录下的文件\n        // exclude: path.resolve(__dirname, \'node_modules\'),\n        use: [\n          // 一组 Loader 的执行顺序默认是从右到左执行，通过 enforce 选项可以让其中一个 Loader 的执行顺序放到最前或者最后。\n          // 多线程加载耗时 loader\n          \'thread-loader\',\n          {\n            loader: \'babel-loader\',\n            options: options.babelQuery\n            // enforce: \'post\' 的含义是把该 Loader 的执行顺序放到最后\n            // enforce 的值还可以是 pre，代表把 Loader 的执行顺序放到最前面\n          }\n        ]\n      },\n      {\n        test: /\\.css/,\n        include: [/app/, /unicorn/],\n        use: [\n          {\n            // 大概是把 CSS 内容用 JavaScript 里的字符串存储起来\n            // 在网页执行 JavaScript 时通过 DOM 操作动态地往 HTML head 标签里插入 HTML style 标签。\n            // 也许你认为这样做会导致 JavaScript 文件变大并导致加载网页时间变长，如果想让 Webpack 单独输出 CSS 文件\n            // webpack4 用 mini-css-extract-plugin, 之前的版本用 extract-text-webpack-plugin\n            loader: options.cssDebug ? \'style-loader\' : MiniCssExtractPlugin.loader,\n            options: {\n              // Stylesheet Limits in Internet Explorer\n              // Internet Explorer 6 到 9 支持的最大样式表和规则数\n              // https://blogs.msdn.microsoft.com/ieinternals/2011/05/14/stylesheet-limits-in-internet-explorer/\n              singleton: false\n            }\n          },\n          {\n            loader: \'css-loader\',\n            options: {\n              // CSS Loader https://github.com/webpack/css-loader\n              // 指定 css-loader 处理前最多可以经过的 loader 个数\n              // 0 => no loaders (default); 1 => postcss-loader; 2 => postcss-loader, sass-loader\n              importLoaders: 1,\n              sourceMap: options.cssDebug,\n              // CSS Modules https://github.com/css-modules/css-modules\n              modules: true,\n              localIdentName: options.cssDebug ? \'[name]-[local]-[hash:base64:5]\' : \'[hash:base64:5]\'\n              // CSS Nano http://cssnano.co/options/\n              // minimize: !options.cssDebug, // v2 中会报错\n              // discardComments: { removeAll: true }, // v2 中会报错\n            }\n          },\n          {\n            loader: \'postcss-loader\',\n            options: {\n              plugins: [\n                // Transfer @global-import rule by inlining content with :global CSS Modules scope\n                // e.g. @global-import \'draft-js/dist/Draft.css\'\n                // https://github.com/scherebedov/postcss-global-import\n                postcssGlobalImport(),\n                // Transfer @import rule by inlining content, e.g. @import \'normalize.css\'\n                // https://github.com/postcss/postcss-import\n                postcssImport({ path: \'app\' }),\n                // W3C variables, e.g. :root { --color: red; } div { background: var(--color); }\n                // https://github.com/postcss/postcss-custom-properties\n                postcssCustomProperties(),\n                // W3C CSS Custom Media Queries, e.g. @custom-media --small-viewport (max-width: 30em);\n                // https://github.com/postcss/postcss-custom-media\n                postcssCustomMedia(),\n                // CSS4 Media Queries, e.g. @media screen and (width >= 500px) and (width <= 1200px) { }\n                // https://github.com/postcss/postcss-media-minmax\n                postcssMediaMinmax(),\n                // W3C CSS Custom Selectors, e.g. @custom-selector :--heading h1, h2, h3, h4, h5, h6;\n                // https://github.com/postcss/postcss-custom-selectors\n                postcssCustomSelectors(),\n                // W3C calc() function, e.g. div { height: calc(100px - 2em); }\n                // https://github.com/postcss/postcss-calc\n                postcssCalc(),\n                // Allows you to nest one style rule inside another\n                // https://github.com/jonathantneal/postcss-nesting\n                postcssNesting(),\n                // Unwraps nested rules like how Sass does it\n                // https://github.com/postcss/postcss-nested\n                postcssNested(),\n                // W3C color() function, e.g. div { background: color(red alpha(90%)); }\n                // https://github.com/postcss/postcss-color-function\n                postcssColorFunction(),\n                // Convert CSS shorthand filters to SVG equivalent, e.g. .blur { filter: blur(4px); }\n                // https://github.com/iamvdo/pleeease-filters\n                pleeeaseFilters(),\n                // Generate pixel fallback for &quot;rem&quot; units, e.g. div { margin: 2.5rem 2px 3em 100%; }\n                // https://github.com/robwierzbowski/node-pixrem\n                pixrem(),\n                // W3C CSS Level4 :matches() pseudo class, e.g. p:matches(:first-child, .special) { }\n                // https://github.com/postcss/postcss-selector-matches\n                postcssSelectorMatches(),\n                // Transforms :not() W3C CSS Level 4 pseudo class to :not() CSS Level 3 selectors\n                // https://github.com/postcss/postcss-selector-not\n                postcssSelectorNot(),\n                // Postcss flexbox bug fixer\n                // https://github.com/luisrudge/postcss-flexbugs-fixes\n                postcssFlexbugsFixes(),\n                // Add vendor prefixes to CSS rules using values from caniuse.com\n                // https://github.com/postcss/autoprefixer\n                autoprefixer(/* package.json/browserslist */)\n              ]\n            }\n          }\n        ]\n      },\n      {\n        // custom Ant Design theme\n        test: /\\.less\\$/,\n        include: /node_modules/,\n        use: [\n          {\n            loader: options.cssDebug ? \'style-loader\' : MiniCssExtractPlugin.loader\n          },\n          {\n            loader: \'css-loader\'\n            // options: {\n            //   minimize: true,\n            // },\n          },\n          {\n            loader: \'postcss-loader\',\n            options: {\n              plugins: [autoprefixer()]\n            }\n          },\n          {\n            // 每一个 Loader 都可以通过 URL querystring 的方式传入参数，也可以通过 options 传入\n            // 还可以在源码中指定用什么 Loader 去处理文件\n            // require(\'style-loader!css-loader?minimize!./main.css\');\n            // import \'!file-loader?name=[name].[ext]!./manifest.json\';\n            loader: \\`less-loader?{&quot;sourceMap&quot;:true,&quot;modifyVars&quot;:\\${JSON.stringify(themer)}}\\`\n          }\n        ]\n      },\n      {\n        test: /\\.css/,\n        include: /node_modules/,\n        use: [\n          {\n            loader: options.cssDebug ? \'style-loader\' : MiniCssExtractPlugin.loader\n          },\n          {\n            loader: \'css-loader\',\n            options: {\n              importLoaders: 1,\n              sourceMap: options.cssDebug,\n              // do not use css modules for original css in node_modules\n              // 引入第三方库时不对其 hash 处理，防止样式不生效\n              // 启用 CSS 模块规范，自动为每一个类生成一个哈希值，可以惟一标志这个类\n              // :global 不对其类名进行转化，默认为 :local\n              modules: false,\n              // 生成 hash 时的格式\n              localIdentName: options.cssDebug ? \'[name]-[local]-[hash:base64:5]\' : \'[hash:base64:5]\'\n            }\n          }\n        ]\n      },\n      // 暂时屏蔽，对 IE 有影响\n      // {\n      //   test: /\\.svg\\$/,\n      //   use: [\n      //     {\n      //       loader: \'svg-url-loader\',\n      //       options: {\n      //         // Inline files smaller than 10 kB\n      //         limit: 10 * 1024,\n      //         noquotes: true,\n      //       },\n      //     },\n      //   ],\n      // },\n      {\n        test: /\\.(eot|ttf|woff|woff2|mp3|xls|xlsx|csv|mp4|webm|json|svg)\\$/,\n        use: [\n          {\n            loader: \'file-loader\',\n            options: {\n              name() {\n                return \'[name]-[hash].[ext]\';\n              }\n            }\n          }\n        ]\n      },\n      {\n        test: /\\.(jpe?g|png|gif)\\$/,\n        use: [\n          {\n            loader: \'url-loader\',\n            options: {\n              // Inline files smaller than 10 kB\n              limit: 10 * 1024\n            }\n          }\n          // {\n          //   loader: \'image-webpack-loader\',\n          //   options: {\n          //     mozjpeg: {\n          //       enabled: false,\n          //       // NOTE: mozjpeg is disabled as it causes errors in some Linux environments\n          //       // Try enabling it in your environment by switching the config to:\n          //       // enabled: true,\n          //       // progressive: true,\n          //     },\n          //     gifsicle: {\n          //       interlaced: false,\n          //     },\n          //     optipng: {\n          //       optimizationLevel: 7,\n          //     },\n          //     pngquant: {\n          //       quality: \'65-90\',\n          //       speed: 4,\n          //     },\n          //   },\n          // },\n        ]\n      },\n      {\n        test: /\\.html\\$/,\n        use: \'html-loader\'\n      },\n      {\n        test: /\\.md\\$/,\n        use: [\n          {\n            loader: \'html-loader\'\n          },\n          {\n            loader: \'markdown-loader\',\n            options: {\n              gfm: true,\n              tables: true\n              // highlight: (code) => highlight.highlightAuto(code).value,\n            }\n          }\n        ]\n      }\n    ]\n    // noParse: [ // 不用解析和处理的模块\n    //   /special-library\\.js\\$/  // 用正则匹配\n    // ],\n  },\n  // externals: {\n  //   // 把导入语句里的 jquery 替换成运行环境里的全局变量 jQuery\n  //   jquery: \'jQuery\'\n  // }\n  plugins: options.plugins.concat([\n    // 扩展 Webpack 功能，几乎让 Webpack 可以做任何构建相关的事情\n    // new SimpleProgressWebpackPlugin(),\n\n    new webpack.ProvidePlugin({\n      // make fetch available 和 externals 一样的效果\n      fetch: \'exports-loader?self.fetch!whatwg-fetch\',\n      \\$: \'jquery\',\n      jQuery: \'jquery\'\n    }),\n\n    // Always expose NODE_ENV to webpack, in order to use \\`process.env.NODE_ENV\\`\n    // inside your code for any environment checks; UglifyJS will automatically\n    // drop any unreachable code.\n    new webpack.DefinePlugin({\n      \'process.env\': {\n        NODE_ENV: JSON.stringify(process.env.NODE_ENV),\n        GLOBAL: JSON.stringify(globalJSON || {}),\n        SERVER: JSON.stringify(process.env.SERVER)\n      }\n    }),\n\n    new CopyWebpackPlugin(\n      [\'app/favicon.ico\', \'app/manifest.json\'].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))\n    ),\n\n    new MiniCssExtractPlugin({\n      filename: \'[name].[contenthash:8].css\',\n      chunkFilename: \'[name].[contenthash:8].css\'\n    }),\n\n    // only load locale we need\n    // https://github.com/moment/moment/issues/2517#issuecomment-185836313\n    new webpack.ContextReplacementPlugin(/moment[\\/\\\\]locale\\$/, /zh/) // eslint-disable-line\n  ]),\n  resolve: {\n    // 配置 Webpack 如何寻找模块所对应的文件\n    // 配置 Webpack 去哪些目录下寻找第三方模块，配置后可以简单的引入 import \'components\'，等价于 import \'app/components\'\n    modules: [\'app\', \'node_modules\'],\n    // 通过别名来把原导入路径映射成一个新的导入路径，\\$ 符号来缩小范围到只命中以关键字结尾\n    alias: {\n      // zh-cn.js will import \'../moment\', since we are using jsnext:main, it will pack two copys of moment.\n      moment\\$: path.resolve(process.cwd(), \'node_modules/moment/moment\'),\n      unicorn: path.resolve(process.cwd(), \'unicorn\'),\n      // 使用 alias 把导入 react 的语句换成直接使用单独完整的 react.production.min.js 文件，减少耗时的递归解析操作\n      // 因为会影响 Tree-Shaking 去除无效代码，一般对整体性比较强的库采用本方法优化\n      // 不适用一些工具类的库，如 lodash，导致输出代码中包含很多永远不会执行的代码\n      react: path.resolve(process.cwd(), \'node_modules/react/cjs/react.production.min.js\'),\n      \'react-dom\\$\': path.resolve(process.cwd(), \'node_modules/react-dom/cjs/react-dom.production.min.js\'),\n      \'react-dom/server\\$\': path.resolve(\n        process.cwd(),\n        \'node_modules/react-dom/cjs/react-dom-server.browser.production.min.js\'\n      )\n    },\n    // 在导入语句没带文件后缀时，Webpack 会自动带上后缀后去尝试访问文件是否存在\n    extensions: [\n      // 尽可能的减少后缀尝试的可能性\n      \'.js\'\n      // \'.jsx\',\n      // \'.react.js\',\n    ],\n    // 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个\n    mainFields: [\n      // 针对 Npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件，\n      // 利于 Tree Shaking/Scope Hoisting\n      // 剔除 JavaScript 中用不上的死代码 / 让 Webpack 打包出来的代码文件更小、运行的更快，合并声明性的代码\n      \'jsnext:main\',\n      // \'browser\',\n      \'main\' // 采用 ES5 语法的代码入口文件，尽量采用 main 字段作为入口文件描述字段，以减少搜索步骤\n    ]\n  },\n  devtool: options.devtool,\n  // 让 Webpack 构建出针对不同运行环境的代码\n  target: \'web\', // Make web variables accessible to webpack, e.g. window\n  performance: options.performance || {}\n  // 输出文件性能检查配置\n  // performance: {\n  //   hints: \'warning\', // 有性能问题时输出警告\n  //   hints: \'error\', // 有性能问题时输出错误\n  //   hints: false, // 关闭性能检查\n  //   maxAssetSize: 200000, // 最大文件大小 (单位 bytes)\n  //   maxEntrypointSize: 400000, // 最大入口文件大小 (单位 bytes)\n  //   assetFilter: function(assetFilename) { // 过滤要检查的文件\n  //     return assetFilename.endsWith(\'.css\') || assetFilename.endsWith(\'.js\');\n  //   }\n  // },\n});`, `27784018975281310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * COMMON WEBPACK CONFIGURATION\n */</span>\n\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> lessToJs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'less-vars-to-js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> themer <span class="token operator">=</span> <span class="token function">lessToJs</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../../app/antd-theme/theme.less\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> postcssGlobalImport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-global-import\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssImport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-import\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCustomProperties <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-custom-properties\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCustomMedia <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-custom-media\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssMediaMinmax <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-media-minmax\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCustomSelectors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-custom-selectors\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCalc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-calc\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssNesting <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-nesting\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssNested <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-nested\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssColorFunction <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-color-function\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pleeeaseFilters <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'pleeease-filters\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pixrem <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'pixrem\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssSelectorMatches <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-selector-matches\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssSelectorNot <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-selector-not\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssFlexbugsFixes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-flexbugs-fixes\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> autoprefixer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'autoprefixer\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> globalJSON <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'global.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 将 CSS 提取到单独的文件中，它为每个包含 CSS 的 JS 文件创建一个 CSS 文件，它支持 CSS 和 SourceMaps 的按需加载。</span>\n<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'mini-css-extract-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> SimpleProgressWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'simple-progress-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'copy-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token comment">// context: path.resolve(__dirname, \'app\') // 默认 context 为根目录，影响相对路径所指向的真实文件</span>\n  entry<span class="token punctuation">:</span> options<span class="token punctuation">.</span>entry<span class="token punctuation">,</span> <span class="token comment">// 必填，配置模块的入口</span>\n  mode<span class="token punctuation">:</span> options<span class="token punctuation">.</span>mode<span class="token punctuation">,</span>\n  optimization<span class="token punctuation">:</span> options<span class="token punctuation">.</span>optimization<span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>\n    <span class="token punctuation">{</span>\n      <span class="token comment">// Compile into js/build.js</span>\n      <span class="token comment">// 配置输出文件存放在本地的目录</span>\n      path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">// 发布到线上的所有资源的 URL 前缀，string 类型</span>\n      publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    options<span class="token punctuation">.</span>output\n  <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Merge with env dependent settings</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 配置如何处理模块。</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.js$/</span><span class="token punctuation">,</span> <span class="token comment">// Transform all .js files required somewhere with Babel</span>\n        <span class="token comment">// 尽可能的缩小命中范围，加快 Webpack 搜索速度</span>\n        include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/app/</span><span class="token punctuation">,</span> <span class="token regex">/unicorn/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token comment">// 排除 node_modules 目录下的文件</span>\n        <span class="token comment">// exclude: path.resolve(__dirname, \'node_modules\'),</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token comment">// 一组 Loader 的执行顺序默认是从右到左执行，通过 enforce 选项可以让其中一个 Loader 的执行顺序放到最前或者最后。</span>\n          <span class="token comment">// 多线程加载耗时 loader</span>\n          <span class="token string">\'thread-loader\'</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'babel-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> options<span class="token punctuation">.</span>babelQuery\n            <span class="token comment">// enforce: \'post\' 的含义是把该 Loader 的执行顺序放到最后</span>\n            <span class="token comment">// enforce 的值还可以是 pre，代表把 Loader 的执行顺序放到最前面</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.css/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/app/</span><span class="token punctuation">,</span> <span class="token regex">/unicorn/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            <span class="token comment">// 大概是把 CSS 内容用 JavaScript 里的字符串存储起来</span>\n            <span class="token comment">// 在网页执行 JavaScript 时通过 DOM 操作动态地往 HTML head 标签里插入 HTML style 标签。</span>\n            <span class="token comment">// 也许你认为这样做会导致 JavaScript 文件变大并导致加载网页时间变长，如果想让 Webpack 单独输出 CSS 文件</span>\n            <span class="token comment">// webpack4 用 mini-css-extract-plugin, 之前的版本用 extract-text-webpack-plugin</span>\n            loader<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'style-loader\'</span> <span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token comment">// Stylesheet Limits in Internet Explorer</span>\n              <span class="token comment">// Internet Explorer 6 到 9 支持的最大样式表和规则数</span>\n              <span class="token comment">// https://blogs.msdn.microsoft.com/ieinternals/2011/05/14/stylesheet-limits-in-internet-explorer/</span>\n              singleton<span class="token punctuation">:</span> <span class="token boolean">false</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'css-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token comment">// CSS Loader https://github.com/webpack/css-loader</span>\n              <span class="token comment">// 指定 css-loader 处理前最多可以经过的 loader 个数</span>\n              <span class="token comment">// 0 => no loaders (default); 1 => postcss-loader; 2 => postcss-loader, sass-loader</span>\n              importLoaders<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n              sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug<span class="token punctuation">,</span>\n              <span class="token comment">// CSS Modules https://github.com/css-modules/css-modules</span>\n              modules<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n              localIdentName<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'[name]-[local]-[hash:base64:5]\'</span> <span class="token punctuation">:</span> <span class="token string">\'[hash:base64:5]\'</span>\n              <span class="token comment">// CSS Nano http://cssnano.co/options/</span>\n              <span class="token comment">// minimize: !options.cssDebug, // v2 中会报错</span>\n              <span class="token comment">// discardComments: { removeAll: true }, // v2 中会报错</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n                <span class="token comment">// Transfer @global-import rule by inlining content with :global CSS Modules scope</span>\n                <span class="token comment">// e.g. @global-import \'draft-js/dist/Draft.css\'</span>\n                <span class="token comment">// https://github.com/scherebedov/postcss-global-import</span>\n                <span class="token function">postcssGlobalImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Transfer @import rule by inlining content, e.g. @import \'normalize.css\'</span>\n                <span class="token comment">// https://github.com/postcss/postcss-import</span>\n                <span class="token function">postcssImport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">\'app\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C variables, e.g. :root { --color: red; } div { background: var(--color); }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-custom-properties</span>\n                <span class="token function">postcssCustomProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C CSS Custom Media Queries, e.g. @custom-media --small-viewport (max-width: 30em);</span>\n                <span class="token comment">// https://github.com/postcss/postcss-custom-media</span>\n                <span class="token function">postcssCustomMedia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// CSS4 Media Queries, e.g. @media screen and (width >= 500px) and (width &lt;= 1200px) { }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-media-minmax</span>\n                <span class="token function">postcssMediaMinmax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C CSS Custom Selectors, e.g. @custom-selector :--heading h1, h2, h3, h4, h5, h6;</span>\n                <span class="token comment">// https://github.com/postcss/postcss-custom-selectors</span>\n                <span class="token function">postcssCustomSelectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C calc() function, e.g. div { height: calc(100px - 2em); }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-calc</span>\n                <span class="token function">postcssCalc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Allows you to nest one style rule inside another</span>\n                <span class="token comment">// https://github.com/jonathantneal/postcss-nesting</span>\n                <span class="token function">postcssNesting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Unwraps nested rules like how Sass does it</span>\n                <span class="token comment">// https://github.com/postcss/postcss-nested</span>\n                <span class="token function">postcssNested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C color() function, e.g. div { background: color(red alpha(90%)); }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-color-function</span>\n                <span class="token function">postcssColorFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Convert CSS shorthand filters to SVG equivalent, e.g. .blur { filter: blur(4px); }</span>\n                <span class="token comment">// https://github.com/iamvdo/pleeease-filters</span>\n                <span class="token function">pleeeaseFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Generate pixel fallback for "rem" units, e.g. div { margin: 2.5rem 2px 3em 100%; }</span>\n                <span class="token comment">// https://github.com/robwierzbowski/node-pixrem</span>\n                <span class="token function">pixrem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C CSS Level4 :matches() pseudo class, e.g. p:matches(:first-child, .special) { }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-selector-matches</span>\n                <span class="token function">postcssSelectorMatches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Transforms :not() W3C CSS Level 4 pseudo class to :not() CSS Level 3 selectors</span>\n                <span class="token comment">// https://github.com/postcss/postcss-selector-not</span>\n                <span class="token function">postcssSelectorNot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Postcss flexbox bug fixer</span>\n                <span class="token comment">// https://github.com/luisrudge/postcss-flexbugs-fixes</span>\n                <span class="token function">postcssFlexbugsFixes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Add vendor prefixes to CSS rules using values from caniuse.com</span>\n                <span class="token comment">// https://github.com/postcss/autoprefixer</span>\n                <span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token comment">/* package.json/browserslist */</span><span class="token punctuation">)</span>\n              <span class="token punctuation">]</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token comment">// custom Ant Design theme</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.less$/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'style-loader\'</span> <span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'css-loader\'</span>\n            <span class="token comment">// options: {</span>\n            <span class="token comment">//   minimize: true,</span>\n            <span class="token comment">// },</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            <span class="token comment">// 每一个 Loader 都可以通过 URL querystring 的方式传入参数，也可以通过 options 传入</span>\n            <span class="token comment">// 还可以在源码中指定用什么 Loader 去处理文件</span>\n            <span class="token comment">// require(\'style-loader!css-loader?minimize!./main.css\');</span>\n            <span class="token comment">// import \'!file-loader?name=[name].[ext]!./manifest.json\';</span>\n            loader<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">less-loader?{"sourceMap":true,"modifyVars":</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>themer<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.css/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'style-loader\'</span> <span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'css-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              importLoaders<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n              sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug<span class="token punctuation">,</span>\n              <span class="token comment">// do not use css modules for original css in node_modules</span>\n              <span class="token comment">// 引入第三方库时不对其 hash 处理，防止样式不生效</span>\n              <span class="token comment">// 启用 CSS 模块规范，自动为每一个类生成一个哈希值，可以惟一标志这个类</span>\n              <span class="token comment">// :global 不对其类名进行转化，默认为 :local</span>\n              modules<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n              <span class="token comment">// 生成 hash 时的格式</span>\n              localIdentName<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'[name]-[local]-[hash:base64:5]\'</span> <span class="token punctuation">:</span> <span class="token string">\'[hash:base64:5]\'</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// 暂时屏蔽，对 IE 有影响</span>\n      <span class="token comment">// {</span>\n      <span class="token comment">//   test: /\\.svg$/,</span>\n      <span class="token comment">//   use: [</span>\n      <span class="token comment">//     {</span>\n      <span class="token comment">//       loader: \'svg-url-loader\',</span>\n      <span class="token comment">//       options: {</span>\n      <span class="token comment">//         // Inline files smaller than 10 kB</span>\n      <span class="token comment">//         limit: 10 * 1024,</span>\n      <span class="token comment">//         noquotes: true,</span>\n      <span class="token comment">//       },</span>\n      <span class="token comment">//     },</span>\n      <span class="token comment">//   ],</span>\n      <span class="token comment">// },</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.(eot|ttf|woff|woff2|mp3|xls|xlsx|csv|mp4|webm|json|svg)$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'file-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token keyword">return</span> <span class="token string">\'[name]-[hash].[ext]\'</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.(jpe?g|png|gif)$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'url-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token comment">// Inline files smaller than 10 kB</span>\n              limit<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n          <span class="token comment">// {</span>\n          <span class="token comment">//   loader: \'image-webpack-loader\',</span>\n          <span class="token comment">//   options: {</span>\n          <span class="token comment">//     mozjpeg: {</span>\n          <span class="token comment">//       enabled: false,</span>\n          <span class="token comment">//       // NOTE: mozjpeg is disabled as it causes errors in some Linux environments</span>\n          <span class="token comment">//       // Try enabling it in your environment by switching the config to:</span>\n          <span class="token comment">//       // enabled: true,</span>\n          <span class="token comment">//       // progressive: true,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//     gifsicle: {</span>\n          <span class="token comment">//       interlaced: false,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//     optipng: {</span>\n          <span class="token comment">//       optimizationLevel: 7,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//     pngquant: {</span>\n          <span class="token comment">//       quality: \'65-90\',</span>\n          <span class="token comment">//       speed: 4,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//   },</span>\n          <span class="token comment">// },</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.html$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token string">\'html-loader\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.md$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'html-loader\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'markdown-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              gfm<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n              tables<span class="token punctuation">:</span> <span class="token boolean">true</span>\n              <span class="token comment">// highlight: (code) => highlight.highlightAuto(code).value,</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n    <span class="token comment">// noParse: [ // 不用解析和处理的模块</span>\n    <span class="token comment">//   /special-library\\.js$/  // 用正则匹配</span>\n    <span class="token comment">// ],</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// externals: {</span>\n  <span class="token comment">//   // 把导入语句里的 jquery 替换成运行环境里的全局变量 jQuery</span>\n  <span class="token comment">//   jquery: \'jQuery\'</span>\n  <span class="token comment">// }</span>\n  plugins<span class="token punctuation">:</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n    <span class="token comment">// 扩展 Webpack 功能，几乎让 Webpack 可以做任何构建相关的事情</span>\n    <span class="token comment">// new SimpleProgressWebpackPlugin(),</span>\n\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// make fetch available 和 externals 一样的效果</span>\n      fetch<span class="token punctuation">:</span> <span class="token string">\'exports-loader?self.fetch!whatwg-fetch\'</span><span class="token punctuation">,</span>\n      $<span class="token punctuation">:</span> <span class="token string">\'jquery\'</span><span class="token punctuation">,</span>\n      jQuery<span class="token punctuation">:</span> <span class="token string">\'jquery\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// Always expose NODE_ENV to webpack, in order to use `process.env.NODE_ENV`</span>\n    <span class="token comment">// inside your code for any environment checks; UglifyJS will automatically</span>\n    <span class="token comment">// drop any unreachable code.</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token string">\'process.env\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token constant">NODE_ENV</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token constant">GLOBAL</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>globalJSON <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token constant">SERVER</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SERVER</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span>\n      <span class="token punctuation">[</span><span class="token string">\'app/favicon.ico\'</span><span class="token punctuation">,</span> <span class="token string">\'app/manifest.json\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> src<span class="token punctuation">,</span> to<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      filename<span class="token punctuation">:</span> <span class="token string">\'[name].[contenthash:8].css\'</span><span class="token punctuation">,</span>\n      chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[contenthash:8].css\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// only load locale we need</span>\n    <span class="token comment">// https://github.com/moment/moment/issues/2517#issuecomment-185836313</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ContextReplacementPlugin</span><span class="token punctuation">(</span><span class="token regex">/moment[\\/\\\\]locale$/</span><span class="token punctuation">,</span> <span class="token regex">/zh/</span><span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line</span>\n  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 配置 Webpack 如何寻找模块所对应的文件</span>\n    <span class="token comment">// 配置 Webpack 去哪些目录下寻找第三方模块，配置后可以简单的引入 import \'components\'，等价于 import \'app/components\'</span>\n    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'app\'</span><span class="token punctuation">,</span> <span class="token string">\'node_modules\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token comment">// 通过别名来把原导入路径映射成一个新的导入路径，$ 符号来缩小范围到只命中以关键字结尾</span>\n    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// zh-cn.js will import \'../moment\', since we are using jsnext:main, it will pack two copys of moment.</span>\n      moment$<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/moment/moment\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      unicorn<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'unicorn\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">// 使用 alias 把导入 react 的语句换成直接使用单独完整的 react.production.min.js 文件，减少耗时的递归解析操作</span>\n      <span class="token comment">// 因为会影响 Tree-Shaking 去除无效代码，一般对整体性比较强的库采用本方法优化</span>\n      <span class="token comment">// 不适用一些工具类的库，如 lodash，导致输出代码中包含很多永远不会执行的代码</span>\n      react<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/react/cjs/react.production.min.js\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token string">\'react-dom$\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/react-dom/cjs/react-dom.production.min.js\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token string">\'react-dom/server$\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>\n        process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">\'node_modules/react-dom/cjs/react-dom-server.browser.production.min.js\'</span>\n      <span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment">// 在导入语句没带文件后缀时，Webpack 会自动带上后缀后去尝试访问文件是否存在</span>\n    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token comment">// 尽可能的减少后缀尝试的可能性</span>\n      <span class="token string">\'.js\'</span>\n      <span class="token comment">// \'.jsx\',</span>\n      <span class="token comment">// \'.react.js\',</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token comment">// 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个</span>\n    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token comment">// 针对 Npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件，</span>\n      <span class="token comment">// 利于 Tree Shaking/Scope Hoisting</span>\n      <span class="token comment">// 剔除 JavaScript 中用不上的死代码 / 让 Webpack 打包出来的代码文件更小、运行的更快，合并声明性的代码</span>\n      <span class="token string">\'jsnext:main\'</span><span class="token punctuation">,</span>\n      <span class="token comment">// \'browser\',</span>\n      <span class="token string">\'main\'</span> <span class="token comment">// 采用 ES5 语法的代码入口文件，尽量采用 main 字段作为入口文件描述字段，以减少搜索步骤</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  devtool<span class="token punctuation">:</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">,</span>\n  <span class="token comment">// 让 Webpack 构建出针对不同运行环境的代码</span>\n  target<span class="token punctuation">:</span> <span class="token string">\'web\'</span><span class="token punctuation">,</span> <span class="token comment">// Make web variables accessible to webpack, e.g. window</span>\n  performance<span class="token punctuation">:</span> options<span class="token punctuation">.</span>performance <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token comment">// 输出文件性能检查配置</span>\n  <span class="token comment">// performance: {</span>\n  <span class="token comment">//   hints: \'warning\', // 有性能问题时输出警告</span>\n  <span class="token comment">//   hints: \'error\', // 有性能问题时输出错误</span>\n  <span class="token comment">//   hints: false, // 关闭性能检查</span>\n  <span class="token comment">//   maxAssetSize: 200000, // 最大文件大小 (单位 bytes)</span>\n  <span class="token comment">//   maxEntrypointSize: 400000, // 最大入口文件大小 (单位 bytes)</span>\n  <span class="token comment">//   assetFilter: function(assetFilename) { // 过滤要检查的文件</span>\n  <span class="token comment">//     return assetFilename.endsWith(\'.css\') || assetFilename.endsWith(\'.js\');</span>\n  <span class="token comment">//   }</span>\n  <span class="token comment">// },</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="webpackdevbabeljs"><a href="#webpackdevbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.dev.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32658438359728214000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * DEVELOPMENT WEBPACK CONFIGURATION\n */\n\nconst path = require(\'path\');\nconst fs = require(\'fs\');\nconst webpack = require(\'webpack\');\nconst HtmlWebpackPlugin = require(\'html-webpack-plugin\');\nconst CircularDependencyPlugin = require(\'circular-dependency-plugin\');\nconst logger = require(\'../../server/logger\');\nconst cheerio = require(\'cheerio\');\nconst pkg = require(path.resolve(process.cwd(), \'package.json\'));\nconst dllPlugin = pkg.dllPlugin;\n\nconst plugins = [\n  new webpack.HotModuleReplacementPlugin(), // Tell webpack we want hot reloading\n  new HtmlWebpackPlugin({\n    inject: true, // Inject all files that are generated by webpack, e.g. bundle.js\n    templateContent: templateContent() // eslint-disable-line no-use-before-define\n  }),\n  new webpack.DefinePlugin({\n    __APP__: JSON.stringify({})\n  }),\n  new CircularDependencyPlugin({\n    exclude: /a\\.js|node_modules/, // exclude node_modules\n    failOnError: false // show a warning when there is a circular dependency\n  })\n];\n\nmodule.exports = require(\'./webpack.base.babel\')({\n  mode: \'development\',\n  // Add hot reloading in development\n  // 如果 entry 是一个 string 或 array，就只会生成一个 Chunk，这时 Chunk 的名称是 main；\n  entry: [\n    \'babel-polyfill\',\n    \'eventsource-polyfill\', // Necessary for hot reloading with IE\n    \'webpack-hot-middleware/client?reload=true\',\n    path.join(process.cwd(), \'app/app.js\') // Start with js/app.js\n  ],\n\n  // Don\'t use hashes in dev mode for better performance\n  output: {\n    filename: \'[name].js\', // 配置输出文件的名称，有多个 Chunk 要输出时采用 [name].js 的写法\n    // 内置变量包括 id、name、hash、chunkhash\n    // 其中 hash 和 chunkhash 的长度是可指定的，[hash:8] 代表取 8 位 Hash 值，默认是 20 位。\n\n    // 注意 ExtractTextWebpackPlugin 插件是使用 contenthash 来代表哈希值而不是 chunkhash\n    // 原因在于 ExtractTextWebpackPlugin 提取出来的内容是代码内容本身而不是由一组模块组成的 Chunk。\n\n    // 配置无入口的 Chunk 在输出时的文件名称, 用于指定在运行过程中生成的 Chunk 在输出时的文件名称\n    // 生成 Chunk 场景有在使用 CommonChunkPlugin、使用 import(\'path/to/module\') 动态加载等时。\n    // chunkFilename 支持和 filename 一致的内置变量\n    chunkFilename: \'[name].chunk.js\'\n  },\n\n  optimization: {\n    noEmitOnErrors: true, // 跳过报错阶段\n    splitChunks: {\n      chunks: \'all\'\n    }\n  },\n\n  // Add development plugins\n  plugins: dependencyHandlers().concat(plugins), // eslint-disable-line no-use-before-define\n\n  // Tell babel that we want to hot-reload\n  babelQuery: {\n    // require.resolve solves the issue of relative presets when dealing with\n    // locally linked packages. This is an issue with babel and webpack.\n    // See https://github.com/babel/babel-loader/issues/149 and\n    // https://github.com/webpack/webpack/issues/1866\n    presets: [\'babel-preset-react-hmre\'].map(require.resolve)\n  },\n\n  // Emit a source map for easier debugging\n  // 配置 Webpack 如何生成 Source Map\n  // eval：用 eval 语句包裹需要安装的模块；\n  // source：生成独立的 Source Map 文件；\n  // hidden: JavaScript 文件中指出 Source Map 文件所在，这样浏览器就不会自动加载 Source Map；\n  // inline：把生成的 Source Map 转换成 base64 格式内嵌在 JavaScript 文件中；\n  // cheap：生成的 Source Map 中不会包含列信息，这样计算量更小，输出的 Source Map 文件更小；同时 Loader 输出的 Source Map 不会被采用；\n  // module：来自 Loader 的 Source Map 被简单处理成每行一个模块；\n\n  //在开发环境下把 devtool 设置成 cheap-module-eval-source-map，因为生成这种 Source Map 的速度最快，能加速构建。由于在开发环境下不会做代码压缩，Source Map 中即使没有列信息也不会影响断点调试；\n  // 在生产环境下把 devtool 设置成 hidden-source-map，意思是生成最详细的 Source Map，但不会把 Source Map 暴露出去。由于在生产环境下会做代码压缩，一个 JavaScript 文件只有一行，所以需要列信息。\n  devtool: \'cheap-module-eval-source-map\',\n\n  performance: {\n    hints: false\n  },\n\n  cssDebug: true\n});\n\n/**\n * Select which plugins to use to optimize the bundle\'s handling of\n * third party dependencies.\n *\n * If there is a dllPlugin key on the project\'s package.json, the\n * Webpack DLL Plugin will be used.  Otherwise the CommonsChunkPlugin\n * will be used.\n *\n */\nfunction dependencyHandlers() {\n  // Don\'t do anything during the DLL Build step\n  if (process.env.BUILDING_DLL) {\n    return [];\n  }\n\n  // If the package.json does not have a dllPlugin property, use the CommonsChunkPlugin\n  if (!dllPlugin) {\n    return [\n      new webpack.optimize.CommonsChunkPlugin({\n        name: \'vendor\',\n        children: true,\n        minChunks: 2,\n        async: true\n      })\n    ];\n  }\n\n  const dllPath = path.resolve(process.cwd(), dllPlugin.path || \'node_modules/react-boilerplate-dlls\');\n\n  /**\n   * If DLLs aren\'t explicitly defined, we assume all production dependencies listed in package.json\n   * Reminder: You need to exclude any server side dependencies by listing them in dllConfig.exclude\n   */\n  if (!dllPlugin.dlls) {\n    const manifestPath = path.resolve(dllPath, \'reactBoilerplateDeps.json\');\n\n    if (!fs.existsSync(manifestPath)) {\n      logger.error(\'The DLL manifest is missing. Please run \\`npm run build:dll\\`\');\n      process.exit(0);\n    }\n\n    return [\n      new webpack.DllReferencePlugin({\n        context: process.cwd(),\n        // 描述动态链接库的文件内容\n        manifest: require(manifestPath) // eslint-disable-line global-require\n      })\n    ];\n  }\n\n  // If DLLs are explicitly defined, we automatically create a DLLReferencePlugin for each of them.\n  const dllManifests = Object.keys(dllPlugin.dlls).map((name) => path.join(dllPath, \\`/\\${name}.json\\`));\n\n  return dllManifests.map((manifestPath) => {\n    if (!fs.existsSync(path)) {\n      if (!fs.existsSync(manifestPath)) {\n        logger.error(\\`The following Webpack DLL manifest is missing: \\${path.basename(manifestPath)}\\`);\n        logger.error(\\`Expected to find it in \\${dllPath}\\`);\n        logger.error(\'Please run: npm run build:dll\');\n\n        process.exit(0);\n      }\n    }\n\n    return new webpack.DllReferencePlugin({\n      context: process.cwd(),\n      manifest: require(manifestPath) // eslint-disable-line global-require\n    });\n  });\n}\n\n/**\n * We dynamically generate the HTML content in development so that the different\n * DLL Javascript files are loaded in script tags and available to our application.\n */\nfunction templateContent() {\n  const html = fs.readFileSync(path.resolve(process.cwd(), \'app/index.html\')).toString();\n\n  if (!dllPlugin) {\n    return html;\n  }\n\n  const doc = cheerio(html);\n  const body = doc.find(\'body\');\n  const dllNames = !dllPlugin.dlls ? [\'reactBoilerplateDeps\'] : Object.keys(dllPlugin.dlls);\n\n  dllNames.forEach((dllName) => body.append(\\`<script data-dll=\'true\' src=\'/\\${dllName}.dll.js\'></script>\\`));\n\n  return doc.toString();\n}`, `32658438359728214000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * DEVELOPMENT WEBPACK CONFIGURATION\n */</span>\n\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> CircularDependencyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'circular-dependency-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../../server/logger\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'cheerio\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dllPlugin <span class="token operator">=</span> pkg<span class="token punctuation">.</span>dllPlugin<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Tell webpack we want hot reloading</span>\n  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    inject<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Inject all files that are generated by webpack, e.g. bundle.js</span>\n    templateContent<span class="token punctuation">:</span> <span class="token function">templateContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line no-use-before-define</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    __APP__<span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">new</span> <span class="token class-name">CircularDependencyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    exclude<span class="token punctuation">:</span> <span class="token regex">/a\\.js|node_modules/</span><span class="token punctuation">,</span> <span class="token comment">// exclude node_modules</span>\n    failOnError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// show a warning when there is a circular dependency</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./webpack.base.babel\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n  <span class="token comment">// Add hot reloading in development</span>\n  <span class="token comment">// 如果 entry 是一个 string 或 array，就只会生成一个 Chunk，这时 Chunk 的名称是 main；</span>\n  entry<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token string">\'babel-polyfill\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'eventsource-polyfill\'</span><span class="token punctuation">,</span> <span class="token comment">// Necessary for hot reloading with IE</span>\n    <span class="token string">\'webpack-hot-middleware/client?reload=true\'</span><span class="token punctuation">,</span>\n    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'app/app.js\'</span><span class="token punctuation">)</span> <span class="token comment">// Start with js/app.js</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n  <span class="token comment">// Don\'t use hashes in dev mode for better performance</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].js\'</span><span class="token punctuation">,</span> <span class="token comment">// 配置输出文件的名称，有多个 Chunk 要输出时采用 [name].js 的写法</span>\n    <span class="token comment">// 内置变量包括 id、name、hash、chunkhash</span>\n    <span class="token comment">// 其中 hash 和 chunkhash 的长度是可指定的，[hash:8] 代表取 8 位 Hash 值，默认是 20 位。</span>\n\n    <span class="token comment">// 注意 ExtractTextWebpackPlugin 插件是使用 contenthash 来代表哈希值而不是 chunkhash</span>\n    <span class="token comment">// 原因在于 ExtractTextWebpackPlugin 提取出来的内容是代码内容本身而不是由一组模块组成的 Chunk。</span>\n\n    <span class="token comment">// 配置无入口的 Chunk 在输出时的文件名称, 用于指定在运行过程中生成的 Chunk 在输出时的文件名称</span>\n    <span class="token comment">// 生成 Chunk 场景有在使用 CommonChunkPlugin、使用 import(\'path/to/module\') 动态加载等时。</span>\n    <span class="token comment">// chunkFilename 支持和 filename 一致的内置变量</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].chunk.js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    noEmitOnErrors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 跳过报错阶段</span>\n    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token comment">// Add development plugins</span>\n  plugins<span class="token punctuation">:</span> <span class="token function">dependencyHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>plugins<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// eslint-disable-line no-use-before-define</span>\n\n  <span class="token comment">// Tell babel that we want to hot-reload</span>\n  babelQuery<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// require.resolve solves the issue of relative presets when dealing with</span>\n    <span class="token comment">// locally linked packages. This is an issue with babel and webpack.</span>\n    <span class="token comment">// See https://github.com/babel/babel-loader/issues/149 and</span>\n    <span class="token comment">// https://github.com/webpack/webpack/issues/1866</span>\n    presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'babel-preset-react-hmre\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span>resolve<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token comment">// Emit a source map for easier debugging</span>\n  <span class="token comment">// 配置 Webpack 如何生成 Source Map</span>\n  <span class="token comment">// eval：用 eval 语句包裹需要安装的模块；</span>\n  <span class="token comment">// source：生成独立的 Source Map 文件；</span>\n  <span class="token comment">// hidden: JavaScript 文件中指出 Source Map 文件所在，这样浏览器就不会自动加载 Source Map；</span>\n  <span class="token comment">// inline：把生成的 Source Map 转换成 base64 格式内嵌在 JavaScript 文件中；</span>\n  <span class="token comment">// cheap：生成的 Source Map 中不会包含列信息，这样计算量更小，输出的 Source Map 文件更小；同时 Loader 输出的 Source Map 不会被采用；</span>\n  <span class="token comment">// module：来自 Loader 的 Source Map 被简单处理成每行一个模块；</span>\n\n  <span class="token comment">//在开发环境下把 devtool 设置成 cheap-module-eval-source-map，因为生成这种 Source Map 的速度最快，能加速构建。由于在开发环境下不会做代码压缩，Source Map 中即使没有列信息也不会影响断点调试；</span>\n  <span class="token comment">// 在生产环境下把 devtool 设置成 hidden-source-map，意思是生成最详细的 Source Map，但不会把 Source Map 暴露出去。由于在生产环境下会做代码压缩，一个 JavaScript 文件只有一行，所以需要列信息。</span>\n  devtool<span class="token punctuation">:</span> <span class="token string">\'cheap-module-eval-source-map\'</span><span class="token punctuation">,</span>\n\n  performance<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    hints<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  cssDebug<span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * Select which plugins to use to optimize the bundle\'s handling of\n * third party dependencies.\n *\n * If there is a dllPlugin key on the project\'s package.json, the\n * Webpack DLL Plugin will be used.  Otherwise the CommonsChunkPlugin\n * will be used.\n *\n */</span>\n<span class="token keyword">function</span> <span class="token function">dependencyHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Don\'t do anything during the DLL Build step</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BUILDING_DLL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// If the package.json does not have a dllPlugin property, use the CommonsChunkPlugin</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dllPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> <span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n        children<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n        async<span class="token punctuation">:</span> <span class="token boolean">true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> dllPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dllPlugin<span class="token punctuation">.</span>path <span class="token operator">||</span> <span class="token string">\'node_modules/react-boilerplate-dlls\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">/**\n   * If DLLs aren\'t explicitly defined, we assume all production dependencies listed in package.json\n   * Reminder: You need to exclude any server side dependencies by listing them in dllConfig.exclude\n   */</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dllPlugin<span class="token punctuation">.</span>dlls<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> manifestPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dllPath<span class="token punctuation">,</span> <span class="token string">\'reactBoilerplateDeps.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">\'The DLL manifest is missing. Please run `npm run build:dll`\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        context<span class="token punctuation">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 描述动态链接库的文件内容</span>\n        manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line global-require</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// If DLLs are explicitly defined, we automatically create a DLLReferencePlugin for each of them.</span>\n  <span class="token keyword">const</span> dllManifests <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>dllPlugin<span class="token punctuation">.</span>dlls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dllPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> dllManifests<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">manifestPath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The following Webpack DLL manifest is missing: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Expected to find it in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dllPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">\'Please run: npm run build:dll\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      context<span class="token punctuation">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line global-require</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * We dynamically generate the HTML content in development so that the different\n * DLL Javascript files are loaded in script tags and available to our application.\n */</span>\n<span class="token keyword">function</span> <span class="token function">templateContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> html <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'app/index.html\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dllPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> html<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token function">cheerio</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> body <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> dllNames <span class="token operator">=</span> <span class="token operator">!</span>dllPlugin<span class="token punctuation">.</span>dlls <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">\'reactBoilerplateDeps\'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>dllPlugin<span class="token punctuation">.</span>dlls<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  dllNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dllName</span><span class="token punctuation">)</span> <span class="token operator">=></span> body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script data-dll=\'true\' src=\'/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dllName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.dll.js\'>&lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> doc<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="webpackdllbabeljs"><a href="#webpackdllbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.dll.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32152811828125483000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * WEBPACK DLL GENERATOR\n *\n * This profile is used to cache webpack\'s module\n * contexts for external library and framework type\n * dependencies which will usually not change often enough\n * to warrant building them from scratch every time we use\n * the webpack process.\n */\n\nconst { join } = require(\'path\');\nconst defaults = require(\'lodash/defaultsDeep\');\nconst webpack = require(\'webpack\');\nconst pkg = require(join(process.cwd(), \'package.json\'));\nconst dllPlugin = require(\'../config\').dllPlugin;\n\nif (!pkg.dllPlugin) {\n  process.exit(0);\n}\n\nconst dllConfig = defaults(pkg.dllPlugin, dllPlugin.defaults);\nconst outputPath = join(process.cwd(), dllConfig.path);\n\nmodule.exports = require(\'./webpack.base.babel\')({\n  mode: \'development\',\n  context: process.cwd(),\n  entry: dllConfig.dlls ? dllConfig.dlls : dllPlugin.entry(pkg),\n  devtool: \'eval\',\n  output: {\n    filename: \'[name].dll.js\', // 输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称\n    path: outputPath,\n    library: \'[name]\' // 存放动态链接库的全局变量名称，例如对应 react 来说就是 _dll_react\n  },\n  plugins: [\n    new webpack.DllPlugin({\n      // 动态链接库的全局变量名称，需要和 output.library 中保持一致\n      // 该字段的值也就是输出的 [name].json 文件 中 name 字段的值\n      // 在 webpack.dev.babel.js 文件中 DllReferencePlugin 会去 [name].json 文件读取 name 字段的值\n      // 把值的内容作为在从全局变量中获取动态链接库中内容时的全局变量名\n      name: \'[name]\',\n      // 描述动态链接库的 manifest.json 文件输出时的文件名称\n      path: join(outputPath, \'[name].json\')\n    }) // eslint-disable-line no-new\n  ],\n  performance: {\n    hints: false\n  }\n});`, `32152811828125483000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * WEBPACK DLL GENERATOR\n *\n * This profile is used to cache webpack\'s module\n * contexts for external library and framework type\n * dependencies which will usually not change often enough\n * to warrant building them from scratch every time we use\n * the webpack process.\n */</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> defaults <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash/defaultsDeep\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dllPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../config\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dllPlugin<span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pkg<span class="token punctuation">.</span>dllPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> dllConfig <span class="token operator">=</span> <span class="token function">defaults</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dllPlugin<span class="token punctuation">,</span> dllPlugin<span class="token punctuation">.</span>defaults<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> outputPath <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dllConfig<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./webpack.base.babel\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n  context<span class="token punctuation">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  entry<span class="token punctuation">:</span> dllConfig<span class="token punctuation">.</span>dlls <span class="token operator">?</span> dllConfig<span class="token punctuation">.</span>dlls <span class="token punctuation">:</span> dllPlugin<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  devtool<span class="token punctuation">:</span> <span class="token string">\'eval\'</span><span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].dll.js\'</span><span class="token punctuation">,</span> <span class="token comment">// 输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称</span>\n    path<span class="token punctuation">:</span> outputPath<span class="token punctuation">,</span>\n    library<span class="token punctuation">:</span> <span class="token string">\'[name]\'</span> <span class="token comment">// 存放动态链接库的全局变量名称，例如对应 react 来说就是 _dll_react</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// 动态链接库的全局变量名称，需要和 output.library 中保持一致</span>\n      <span class="token comment">// 该字段的值也就是输出的 [name].json 文件 中 name 字段的值</span>\n      <span class="token comment">// 在 webpack.dev.babel.js 文件中 DllReferencePlugin 会去 [name].json 文件读取 name 字段的值</span>\n      <span class="token comment">// 把值的内容作为在从全局变量中获取动态链接库中内容时的全局变量名</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'[name]\'</span><span class="token punctuation">,</span>\n      <span class="token comment">// 描述动态链接库的 manifest.json 文件输出时的文件名称</span>\n      path<span class="token punctuation">:</span> <span class="token function">join</span><span class="token punctuation">(</span>outputPath<span class="token punctuation">,</span> <span class="token string">\'[name].json\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line no-new</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  performance<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    hints<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="webpackprodbabeljs"><a href="#webpackprodbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.prod.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85186155542711060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Important modules this config uses\nconst path = require(\'path\');\nconst webpack = require(\'webpack\');\nconst HtmlWebpackPlugin = require(\'html-webpack-plugin\');\nconst UglifyJsPlugin = require(\'uglifyjs-webpack-plugin\');\nconst OptimizeCSSAssetsPlugin = require(\'optimize-css-assets-webpack-plugin\');\nconst LodashModuleReplacementPlugin = require(\'lodash-webpack-plugin\');\n\nmodule.exports = require(\'./webpack.base.babel\')({\n  mode: \'production\',\n  // In production, we skip all hot-reloading stuff\n  // 如果 entry 是一个 object，就可能会出现多个 Chunk，这时 Chunk 的名称是 object 键值对里键的名称。\n  entry: {\n    main: [\'babel-polyfill\', \'raf/polyfill\', path.join(process.cwd(), \'app/app.js\')],\n    draft: [\'draft-js\', \'draft-js-plugins-editor\', \'draft-js-mention-plugin\', \'draft-convert\'],\n    \'react-player\': [\'react-player\']\n  },\n  babelOptions: {\n    // babel-loader 的参数，用于缓存 babel 编译结果加快重新编译速度\n    cacheDirectory: true\n  },\n  // Utilize long-term caching by adding content hashes (not compilation hashes) to compiled assets\n  output: {\n    // 根据文件内容 hash 值生成文件名称，用于浏览器长时间缓存文件\n    filename: \'[name].[chunkhash].js\',\n    chunkFilename: \'[name].[chunkhash].chunk.js\'\n  },\n\n  optimization: {\n    minimize: true,\n    minimizer: [\n      new UglifyJsPlugin({\n        cache: true,\n        parallel: true,\n        sourceMap: false,\n        // 多嵌套了一层\n        uglifyOptions: {\n          mangle: true,\n          compress: {\n            // 在 UglifyJs 删除没有用到的代码时不输出警告\n            warnings: false,\n            // 删除所有的 \\`console\\` 语句，可以兼容 ie 浏览器\n            drop_console: true,\n            // 内嵌定义了但是只用到一次的变量\n            collapse_vars: true,\n            // 提取出出现多次但是没有定义成变量去引用的静态值\n            reduce_vars: true\n          },\n          output: {\n            // 最紧凑的输出\n            beautify: false,\n            // 删除所有的注释\n            comments: false\n          }\n        }\n      }),\n      new OptimizeCSSAssetsPlugin()\n    ],\n    // Scope Hoisting\n    // 分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。\n    // 因此只有那些被引用了一次的模块才能被合并。\n    concatenateModules: true,\n    splitChunks: {\n      // splitChunks、runtimeChunk 代替 webpack1~3 原有的 commonsChunkPlugin 的方法\n      // 这里设置 initial 时首页为 777k，跳转到任务中心 204k\n      // 未升级前首页为 739k，跳转到任务中心 201k\n      // 设置为 all 时，首页为 1.1M，跳转到任务中心 18.7k\n      // chunks: \'initial\', // 可填 async, initial, all. 顾名思义，async 针对异步加载的 chunk 做切割，initial 针对初始 chunk，all 针对所有 chunk\n      // minSize: 30000, // 切割完要生成的新 chunk 要>30kb，否则不生成新 chunk\n      // minChunks: 2, // 共享该 module 的最小 chunk 数\n      // maxAsyncRequests: 2, // 最多有 5 个异步加载请求该 module\n      // maxInitialRequests: 5, // 初始化的时候最多有 4 个请求该 module\n      // automaticNameDelimiter: \'-\', // 名字中间的间隔符\n      // name: true, // chunk 的名字，如果设成 true，会根据被提取的 chunk 自动生成\n      // 优化原则：保持最大重用性，首页提取 node_modules 所有的公共库导致加载时间较长\n      // 后续加载很快\n      cacheGroups: {\n        default: false,\n        // vendors: false,\n        draft: {\n          test: \'draft\',\n          name: \'draft\',\n          chunks: \'async\',\n          priority: 3 // 该配置项是设置处理的优先级，数值越大越优先处理\n        },\n        \'react-player\': {\n          test: \'react-player\',\n          name: \'react-player\',\n          chunks: \'async\',\n          priority: 2 // 该配置项是设置处理的优先级，数值越大越优先处理\n        },\n        vendors: {\n          test: /[\\\\/]node_modules[\\\\/]/,\n          name: \'vendors\',\n          chunks: \'all\',\n          priority: 1 // 该配置项是设置处理的优先级，数值越大越优先处理\n        },\n        common: {\n          name: \'common\',\n          minChunks: 2,\n          priority: -1,\n          chunks: \'all\',\n          reuseExistingChunk: true // 这个配置允许我们使用已经存在的代码块\n        }\n        // polyfill: {\n        //   test: \'polyfill\', // 用来决定提取哪些 module，可以接受字符串，正则表达式，或者函数，函数的一个参数为 module，第二个参数为引用这个 module 的 chunk(数组)\n        //   name: \'polyfill\',\n        //   // reuseExistingChunk // 当 module 未变时，是否可以使用之前的 chunk\n        // },\n        // vendor: {\n        //   test: \'vendor\',\n        //   name: \'vendor\',\n        // },\n        // styles: {\n        //   name: \'styles\',\n        //   test: /\\.css\\$/,\n        //   chunks: \'all\',\n        // },\n        // styles: {\n        //   name: \'styles\',\n        //   test: /\\.css\\$/,\n        //   chunks: \'all\',\n        //   enforce: true,\n        //   priority: 20,\n        // },\n      }\n    },\n    runtimeChunk: {\n      name: \'manifest\'\n    }\n  },\n\n  plugins: [\n    new LodashModuleReplacementPlugin(), // lodash 优化由 592.53k 到 240k\n    // 实现 chunkhash 的稳定化\n    new webpack.HashedModuleIdsPlugin(),\n    // Minify and optimize the index.html\n    new HtmlWebpackPlugin({\n      template: \'app/index.html\',\n      minify: {\n        removeComments: true,\n        collapseWhitespace: true,\n        removeRedundantAttributes: true,\n        useShortDoctype: true,\n        removeEmptyAttributes: true,\n        removeStyleLinkTypeAttributes: true,\n        keepClosingSlash: true,\n        minifyJS: true,\n        minifyCSS: true,\n        minifyURLs: true\n      },\n      inject: true\n    })\n  ],\n\n  performance: {\n    assetFilter: (assetFilename) => !/(\\.map\\$)|(^(main\\.|favicon\\.))/.test(assetFilename)\n  }\n});`, `85186155542711060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Important modules this config uses</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'uglifyjs-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'optimize-css-assets-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> LodashModuleReplacementPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./webpack.base.babel\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'production\'</span><span class="token punctuation">,</span>\n  <span class="token comment">// In production, we skip all hot-reloading stuff</span>\n  <span class="token comment">// 如果 entry 是一个 object，就可能会出现多个 Chunk，这时 Chunk 的名称是 object 键值对里键的名称。</span>\n  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    main<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'babel-polyfill\'</span><span class="token punctuation">,</span> <span class="token string">\'raf/polyfill\'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'app/app.js\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    draft<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'draft-js\'</span><span class="token punctuation">,</span> <span class="token string">\'draft-js-plugins-editor\'</span><span class="token punctuation">,</span> <span class="token string">\'draft-js-mention-plugin\'</span><span class="token punctuation">,</span> <span class="token string">\'draft-convert\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token string">\'react-player\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'react-player\'</span><span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  babelOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// babel-loader 的参数，用于缓存 babel 编译结果加快重新编译速度</span>\n    cacheDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// Utilize long-term caching by adding content hashes (not compilation hashes) to compiled assets</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 根据文件内容 hash 值生成文件名称，用于浏览器长时间缓存文件</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].chunk.js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    minimize<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        cache<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        parallel<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        sourceMap<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token comment">// 多嵌套了一层</span>\n        uglifyOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          mangle<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n          compress<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 在 UglifyJs 删除没有用到的代码时不输出警告</span>\n            warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            <span class="token comment">// 删除所有的 `console` 语句，可以兼容 ie 浏览器</span>\n            drop_console<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token comment">// 内嵌定义了但是只用到一次的变量</span>\n            collapse_vars<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span>\n            reduce_vars<span class="token punctuation">:</span> <span class="token boolean">true</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 最紧凑的输出</span>\n            beautify<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            <span class="token comment">// 删除所有的注释</span>\n            comments<span class="token punctuation">:</span> <span class="token boolean">false</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token comment">// Scope Hoisting</span>\n    <span class="token comment">// 分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。</span>\n    <span class="token comment">// 因此只有那些被引用了一次的模块才能被合并。</span>\n    concatenateModules<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// splitChunks、runtimeChunk 代替 webpack1~3 原有的 commonsChunkPlugin 的方法</span>\n      <span class="token comment">// 这里设置 initial 时首页为 777k，跳转到任务中心 204k</span>\n      <span class="token comment">// 未升级前首页为 739k，跳转到任务中心 201k</span>\n      <span class="token comment">// 设置为 all 时，首页为 1.1M，跳转到任务中心 18.7k</span>\n      <span class="token comment">// chunks: \'initial\', // 可填 async, initial, all. 顾名思义，async 针对异步加载的 chunk 做切割，initial 针对初始 chunk，all 针对所有 chunk</span>\n      <span class="token comment">// minSize: 30000, // 切割完要生成的新 chunk 要>30kb，否则不生成新 chunk</span>\n      <span class="token comment">// minChunks: 2, // 共享该 module 的最小 chunk 数</span>\n      <span class="token comment">// maxAsyncRequests: 2, // 最多有 5 个异步加载请求该 module</span>\n      <span class="token comment">// maxInitialRequests: 5, // 初始化的时候最多有 4 个请求该 module</span>\n      <span class="token comment">// automaticNameDelimiter: \'-\', // 名字中间的间隔符</span>\n      <span class="token comment">// name: true, // chunk 的名字，如果设成 true，会根据被提取的 chunk 自动生成</span>\n      <span class="token comment">// 优化原则：保持最大重用性，首页提取 node_modules 所有的公共库导致加载时间较长</span>\n      <span class="token comment">// 后续加载很快</span>\n      cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token comment">// vendors: false,</span>\n        draft<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          test<span class="token punctuation">:</span> <span class="token string">\'draft\'</span><span class="token punctuation">,</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'draft\'</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'async\'</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment">// 该配置项是设置处理的优先级，数值越大越优先处理</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token string">\'react-player\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          test<span class="token punctuation">:</span> <span class="token string">\'react-player\'</span><span class="token punctuation">,</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'react-player\'</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'async\'</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">// 该配置项是设置处理的优先级，数值越大越优先处理</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          test<span class="token punctuation">:</span> <span class="token regex">/[\\\\/]node_modules[\\\\/]/</span><span class="token punctuation">,</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'vendors\'</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment">// 该配置项是设置处理的优先级，数值越大越优先处理</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        common<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'common\'</span><span class="token punctuation">,</span>\n          minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span><span class="token punctuation">,</span>\n          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 这个配置允许我们使用已经存在的代码块</span>\n        <span class="token punctuation">}</span>\n        <span class="token comment">// polyfill: {</span>\n        <span class="token comment">//   test: \'polyfill\', // 用来决定提取哪些 module，可以接受字符串，正则表达式，或者函数，函数的一个参数为 module，第二个参数为引用这个 module 的 chunk(数组)</span>\n        <span class="token comment">//   name: \'polyfill\',</span>\n        <span class="token comment">//   // reuseExistingChunk // 当 module 未变时，是否可以使用之前的 chunk</span>\n        <span class="token comment">// },</span>\n        <span class="token comment">// vendor: {</span>\n        <span class="token comment">//   test: \'vendor\',</span>\n        <span class="token comment">//   name: \'vendor\',</span>\n        <span class="token comment">// },</span>\n        <span class="token comment">// styles: {</span>\n        <span class="token comment">//   name: \'styles\',</span>\n        <span class="token comment">//   test: /\\.css$/,</span>\n        <span class="token comment">//   chunks: \'all\',</span>\n        <span class="token comment">// },</span>\n        <span class="token comment">// styles: {</span>\n        <span class="token comment">//   name: \'styles\',</span>\n        <span class="token comment">//   test: /\\.css$/,</span>\n        <span class="token comment">//   chunks: \'all\',</span>\n        <span class="token comment">//   enforce: true,</span>\n        <span class="token comment">//   priority: 20,</span>\n        <span class="token comment">// },</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    runtimeChunk<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'manifest\'</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">LodashModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// lodash 优化由 592.53k 到 240k</span>\n    <span class="token comment">// 实现 chunkhash 的稳定化</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment">// Minify and optimize the index.html</span>\n    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      template<span class="token punctuation">:</span> <span class="token string">\'app/index.html\'</span><span class="token punctuation">,</span>\n      minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        removeRedundantAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        useShortDoctype<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        removeEmptyAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        removeStyleLinkTypeAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        keepClosingSlash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minifyJS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minifyCSS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minifyURLs<span class="token punctuation">:</span> <span class="token boolean">true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      inject<span class="token punctuation">:</span> <span class="token boolean">true</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n  performance<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">assetFilter</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">assetFilename</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token regex">/(\\.map$)|(^(main\\.|favicon\\.))/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>assetFilename<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<p>以上更新于 2019-2-13 19:47:27</p>\n<h1 id="webpack-配置全局变量"><a href="#webpack-%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 配置全局变量</h1>\n<h2 id="项目背景"><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目背景</h2>\n<p>个性化项目标题、图标，可以对编译后的文件改动，以达到无需编译即可改变标题或图标的效果</p>\n<h2 id="解决思路"><a href="#%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决思路</h2>\n<p>主要是在 <code class="language-text">index.html</code> 文件中注入全局变量</p>\n<h2 id="解决步骤"><a href="#%E8%A7%A3%E5%86%B3%E6%AD%A5%E9%AA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决步骤</h2>\n<ol>\n<li>在 <code class="language-text">index.html</code> 中注入全局变量</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37601515366277380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script>\n  document.write(\n    \'<s\' +\n      &quot;cript type=\'text/javascript\' src=\'/config.js?&quot; +\n      Math.random()\n        .toString(36)\n        .substr(2) +\n      &quot;\'></scr&quot; +\n      \'ipt>\'\n  );\n</script>`, `37601515366277380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>\n    <span class="token string">\'&lt;s\'</span> <span class="token operator">+</span>\n      <span class="token string">"cript type=\'text/javascript\' src=\'/config.js?"</span> <span class="token operator">+</span>\n      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span>\n      <span class="token string">"\'>&lt;/scr"</span> <span class="token operator">+</span>\n      <span class="token string">\'ipt>\'</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start="2">\n<li>在 <code class="language-text">app.js</code> 中注入此文件，编译时 <code class="language-text">webpack</code> 会拷贝文件到 <code class="language-text">build</code> 目录下</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17273254099120239000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import \'!file-loader?name=[name].[ext]!./config.js\';`, `17273254099120239000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token string">\'!file-loader?name=[name].[ext]!./config.js\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或在 <code class="language-text">webpack.base.config.js</code> 中添加如下代码达到相同效果</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82920957595950920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new CopyWebpackPlugin([\n  \'app/config.js\',\n].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))),`, `82920957595950920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token string">\'app/config.js\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> src<span class="token punctuation">,</span> to<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<ol start="3">\n<li>在 <code class="language-text">config.js</code> 中添加全局变量</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93092135042381990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`window.RUNTIME_CONSTANTS = {\n  title: \'百度\'\n};`, `93092135042381990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">window<span class="token punctuation">.</span><span class="token constant">RUNTIME_CONSTANTS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  title<span class="token punctuation">:</span> <span class="token string">\'百度\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<ol start="4">\n<li>愉快使用全局变量</li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/Webpack配置笔记/index.md absPath of file >>> MarkdownRemark",timeToRead:15,frontmatter:{date:"2019-04-18 13:35:17",path:"/webpack-config-note/",tags:"前端, 前端构建工具, webpack, 预研",title:"webpack 配置笔记",draft:null}},{excerpt:"项目背景 最近帮平台组做 UI 自动化测试，在多次调研下，选定阿里的 macaca 作为技术栈，参考  sample-nodejs ，在模板  macaca-nodejs-boilerplate  的基础下进行 UI 自动化测试的开发 前期准备 因为 UI 自动化测试需要用到 CSS 选择器，为了查找的方便，要在做自动化测试的项目中设置锚点，本人以   属性作为自动化测试的锚点 研究过程以及疑难点 查看报告结果 目标：在 macaca 编译成功输出报告后打开相应的浏览器查看 安装 open…",html:'<h1 id="项目背景"><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目背景</h1>\n<p>最近帮平台组做 UI 自动化测试，在多次调研下，选定阿里的 macaca 作为技术栈，参考 <a href="https://github.com/macaca-sample/sample-nodejs" target="_blank" rel="nofollow noreferrer noopener">sample-nodejs</a>，在模板 <a href="https://github.com/macaca-sample/macaca-nodejs-boilerplate" target="_blank" rel="nofollow noreferrer noopener">macaca-nodejs-boilerplate</a> 的基础下进行 UI 自动化测试的开发</p>\n<h1 id="前期准备"><a href="#%E5%89%8D%E6%9C%9F%E5%87%86%E5%A4%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前期准备</h1>\n<p>因为 UI 自动化测试需要用到 CSS 选择器，为了查找的方便，要在做自动化测试的项目中设置锚点，本人以 <code class="language-text">name=&quot;&quot;</code> 属性作为自动化测试的锚点</p>\n<h1 id="研究过程以及疑难点"><a href="#%E7%A0%94%E7%A9%B6%E8%BF%87%E7%A8%8B%E4%BB%A5%E5%8F%8A%E7%96%91%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>研究过程以及疑难点</h1>\n<h2 id="查看报告结果"><a href="#%E6%9F%A5%E7%9C%8B%E6%8A%A5%E5%91%8A%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>查看报告结果</h2>\n<p>目标：在 macaca 编译成功输出报告后打开相应的浏览器查看</p>\n<ol>\n<li>安装 open 库</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92863891665862820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`yarn add open`, `92863891665862820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> <span class="token function">open</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<ol start="2">\n<li>编写 open.js 工具类</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37166022399156870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const open = require(\'open\');\nconst path = require(\'path\');\n\n// Opens the image in the default image viewer\n(async () => {\n  // Specify app arguments\n  await open(path.join(__dirname, \'..\', \'reports\', \'index.html\'), { app: \'chrome\' });\n})();`, `37166022399156870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> open <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'open\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Opens the image in the default image viewer</span>\n<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// Specify app arguments</span>\n  <span class="token keyword">await</span> <span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'..\'</span><span class="token punctuation">,</span> <span class="token string">\'reports\'</span><span class="token punctuation">,</span> <span class="token string">\'index.html\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> app<span class="token punctuation">:</span> <span class="token string">\'chrome\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start="3">\n<li>在 package.json 文件调用</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14380488313416050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`&quot;scripts&quot;: {\n  &quot;doctor&quot;: &quot;macaca doctor&quot;,\n  &quot;start&quot;: &quot;npm run test:chrome & yarn test:report&quot;, // 注意必须要用 & 否则测试失败后不会调用\n  &quot;test:chrome&quot;: &quot;cross-env browser=chrome npm run test:desktop-browser&quot;,\n  &quot;test:desktop-browser&quot;: &quot;macaca run --reporter macaca-reporter --verbose -d ./test/index.js&quot;,\n  &quot;test:report&quot;: &quot;node ./utils/open.js&quot;\n}`, `14380488313416050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  <span class="token property">"doctor"</span><span class="token operator">:</span> <span class="token string">"macaca doctor"</span><span class="token punctuation">,</span>\n  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"npm run test:chrome &amp; yarn test:report"</span><span class="token punctuation">,</span> <span class="token comment">// 注意必须要用 &amp; 否则测试失败后不会调用</span>\n  <span class="token property">"test:chrome"</span><span class="token operator">:</span> <span class="token string">"cross-env browser=chrome npm run test:desktop-browser"</span><span class="token punctuation">,</span>\n  <span class="token property">"test:desktop-browser"</span><span class="token operator">:</span> <span class="token string">"macaca run --reporter macaca-reporter --verbose -d ./test/index.js"</span><span class="token punctuation">,</span>\n  <span class="token property">"test:report"</span><span class="token operator">:</span> <span class="token string">"node ./utils/open.js"</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="自定义截图到-screenshots-文件夹下"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%88%AA%E5%9B%BE%E5%88%B0-screenshots-%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义截图到 screenshots 文件夹下</h2>\n<p>在 wx-extend.js 中编写自定义方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17124320967395357000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`wd.addPromiseChainMethod(\'customSaveScreenshot\', function(context) {\n  const filepath = path.join(__dirname, \'..\', \'screenshots\', \\`\\${_.uuid()}.png\\`);\n  const reportspath = path.join(__dirname, \'..\', \'reports\');\n  _.mkdir(path.dirname(filepath));\n  return this.saveScreenshot(filepath).then(() => {\n    appendToContext(context, \\`\\${path.relative(reportspath, filepath)}\\`);\n  });\n});`, `17124320967395357000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">wd<span class="token punctuation">.</span><span class="token function">addPromiseChainMethod</span><span class="token punctuation">(</span><span class="token string">\'customSaveScreenshot\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> filepath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'..\'</span><span class="token punctuation">,</span> <span class="token string">\'screenshots\'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_<span class="token punctuation">.</span><span class="token function">uuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> reportspath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'..\'</span><span class="token punctuation">,</span> <span class="token string">\'reports\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  _<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveScreenshot</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">appendToContext</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>reportspath<span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="调用相同逻辑的操作步骤"><a href="#%E8%B0%83%E7%94%A8%E7%9B%B8%E5%90%8C%E9%80%BB%E8%BE%91%E7%9A%84%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用相同逻辑的操作步骤</h2>\n<p>实际上考察的是 Promise 的用法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60325520202207080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const Promise = require(\'bluebird\');\n\nconst array = [1, 2, 3, 4];\n// 调用 Promise.reduce 以实现链式顺序调用\n// 其中 reduce 方法是从第 2 个数据开始遍历的，故需要在 array 前加 null\nreturn driver\n  .then(() => Promise.reduce([null, ...array], (total, graph, index) => {\n      return driver\n      .elementByCss(选择器)\n      .click()\n      .sleep(1000)\n    }\n  ))\n});`, `60325520202207080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> Promise <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'bluebird\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token comment">// 调用 Promise.reduce 以实现链式顺序调用</span>\n<span class="token comment">// 其中 reduce 方法是从第 2 个数据开始遍历的，故需要在 array 前加 null</span>\n<span class="token keyword">return</span> driver\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Promise<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token operator">...</span>array<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> graph<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> driver\n      <span class="token punctuation">.</span><span class="token function">elementByCss</span><span class="token punctuation">(</span>选择器<span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模拟上传文件操作"><a href="#%E6%A8%A1%E6%8B%9F%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模拟上传文件操作</h2>\n<p>项目中用的是 antd 的框架，这里尝试了几种方式</p>\n<h3 id="domevent"><a href="#domevent" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>domEvent</h3>\n<p>调用 domEvent 方法模拟 <code class="language-text">&lt;input type=&quot;file&quot;&gt;</code> 的 change 操作</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1395608652223279000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`driver.elementByCss(\'#input-element\').domEvent(\'change\', {\n  data: {\n    files: [{ file: \'foo.jpg\' }]\n  }\n});`, `1395608652223279000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">driver<span class="token punctuation">.</span><span class="token function">elementByCss</span><span class="token punctuation">(</span><span class="token string">\'#input-element\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">domEvent</span><span class="token punctuation">(</span><span class="token string">\'change\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    files<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> file<span class="token punctuation">:</span> <span class="token string">\'foo.jpg\'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 antd 中不成功，估计是需要调用 upload 组件的方法才起作用</p>\n<h3 id="sendkeys"><a href="#sendkeys" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>sendKeys</h3>\n<p>sendKeys 方法直接赋值给 input 控件也是不成功，原因同上</p>\n<h3 id="用-autoit-软件编辑脚本，模拟上传操作"><a href="#%E7%94%A8-autoit-%E8%BD%AF%E4%BB%B6%E7%BC%96%E8%BE%91%E8%84%9A%E6%9C%AC%EF%BC%8C%E6%A8%A1%E6%8B%9F%E4%B8%8A%E4%BC%A0%E6%93%8D%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用 autoit 软件编辑脚本，模拟上传操作</h3>\n<ol>\n<li>\n<p>首先在官网下载 autoit 软件，安装完毕后打开上传窗口同时打开 autoit 软件，找出文件名和打开两个控件所对应的 ID，如下图</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-04-16-19-57-29-31fa0d3e83f4dcdb48f539c1f4677724-ad506.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 48.12785388127854%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABq0lEQVQoz22S24rUQBCG83Y+ic/h/d654K3XgsIKgheCNzIoLK7jYXcmacdxcu4knZ4+pE/p7sTeiQ4ifhQ/xU9XQVV1NAyD99N/sdYJIYw20zw77w/Xz29fPvrx5qJZXaL3l3D1OFJKG2Ps6IwZT6HtvZoll1orM/JBdoT/zOs7cKg72jPdEYWojDRauZEecWKMHFnircH9B6Go47dKQk+A6hrH1xp/LMsmjrdtC48YZWkOkl3U5++84WkNCCeSpFIqwTdKCdbctM130x+GqrIyJfVNmpWb7XZ/oijKuoYRY8yNWio9Ose5CFPAYYZ8PqRpnmV+mq1z1k1aaYS6LC8gbNquQwj1PY6uvmX5Ee3Tr6AbX3yBb3fiwdP54bOwoznsbD4zedR3RVlprRfDex992mwREy0EmJtX12Dfiosr9OQ1+11y1sm3YQywg3W99Aq3iJZH1tp7NSrYQnA7mvkfJi/EwBgPx1uMMRSXVRWmr6qqDFR1kLCJk1m0bUspxRhTyjhnlOC+7wjBA2chGD1GeZ4Xf1jys0JYx3G8Xn8GACRJEr6T/Asl5S+y7CuBrxS0UwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 04 16 19 57 29" title="" data-src="/static/2019-04-16-19-57-29-31fa0d3e83f4dcdb48f539c1f4677724-fee1c.png" data-srcset="/static/2019-04-16-19-57-29-31fa0d3e83f4dcdb48f539c1f4677724-a67b7.png 200w,\n/static/2019-04-16-19-57-29-31fa0d3e83f4dcdb48f539c1f4677724-0b187.png 400w,\n/static/2019-04-16-19-57-29-31fa0d3e83f4dcdb48f539c1f4677724-fee1c.png 800w,\n/static/2019-04-16-19-57-29-31fa0d3e83f4dcdb48f539c1f4677724-ad506.png 1095w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n<li>\n<p>打开编辑器，添加以下代码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76125569518824850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ControlFocus(&quot;[Class:#32770]&quot;,&quot;&quot;,&quot;Edit1&quot;) // 对文件名发起焦点事件\nWinWait(&quot;[Class:#32770]&quot;,&quot;&quot;,10) // 等待 10 ms\nControlSetText(&quot;[Class:#32770]&quot;,&quot;&quot;,&quot;Edit1&quot;,\\$CmdLine[1]) // 对文件名赋值，其中 \\$CmdLine[1] 代表调用命令的第一个参数\nSleep(2000)\nControlClick(&quot;[Class:#32770]&quot;,&quot;&quot;,&quot;Button1&quot;) // 点击打开按钮`, `76125569518824850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="cs"\n              >\n                <span class="gatsby-code-button-language">cs</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cs"><pre style="counter-reset: linenumber NaN" class="language-cs line-numbers"><code class="language-cs"><span class="token function">ControlFocus</span><span class="token punctuation">(</span><span class="token string">"[Class:#32770]"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"Edit1"</span><span class="token punctuation">)</span> <span class="token comment">// 对文件名发起焦点事件</span>\n<span class="token function">WinWait</span><span class="token punctuation">(</span><span class="token string">"[Class:#32770]"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// 等待 10 ms</span>\n<span class="token function">ControlSetText</span><span class="token punctuation">(</span><span class="token string">"[Class:#32770]"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"Edit1"</span><span class="token punctuation">,</span>$CmdLine<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 对文件名赋值，其中 $CmdLine[1] 代表调用命令的第一个参数</span>\n<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span>\n<span class="token function">ControlClick</span><span class="token punctuation">(</span><span class="token string">"[Class:#32770]"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"Button1"</span><span class="token punctuation">)</span> <span class="token comment">// 点击打开按钮</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>编译以上代码生成 upload.exe</p>\n</li>\n<li>\n<p>在 wx-extend.js 中编写自定义方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85445533738718660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`require(\'shelljs/global\');\nwd.addPromiseChainMethod(\'uploadFile\', function(filePath) {\n const uploadPath = path.resolve(__dirname, upload.exe所在目录);\n const voicePath = path.resolve(__dirname, 上传文件所在目录);\n exec(\\`\\${uploadPath} \\${path.join(voicePath, filePath)}\\`);\n});`, `85445533738718660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs/global\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nwd<span class="token punctuation">.</span><span class="token function">addPromiseChainMethod</span><span class="token punctuation">(</span><span class="token string">\'uploadFile\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">const</span> uploadPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> upload<span class="token punctuation">.</span>exe所在目录<span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token keyword">const</span> voicePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> 上传文件所在目录<span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>uploadPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>voicePath<span class="token punctuation">,</span> filePath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>愉快的调用方法，成功上传</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82662412595628180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`driver.uploadFile(文件名);`, `82662412595628180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">driver<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span>文件名<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/UI自动化测试疑难点/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-04-16 19:17:35",path:"/ui-auto-test-note/",tags:"测试, UI自动化测试, 预研",title:"UI自动化测试疑难点",draft:null}},{excerpt:"需求背景 最近要做一个声音波形图组件，方便运营人员对声音进行切分，以配合完成人工切分录音的工作 核心思路 利用 ref 属性调用原生方法 解决方案 功能点 点击播放只会在播放区域进行播放，再次点击暂停播放，鼠标右键点击播放区域也可播放 可以添加播放区域，添加时会删除上一个播放区域，按住 shift + 鼠标右键可删除播放区域 可以放大缩小波形图 WaveFormDivider/index.js WaveFormDivider/styles.css 类似实现效果",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近要做一个声音波形图组件，方便运营人员对声音进行切分，以配合完成人工切分录音的工作</p>\n<h1 id="核心思路"><a href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心思路</h1>\n<p>利用 ref 属性调用原生方法</p>\n<h1 id="解决方案"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h1>\n<h2 id="功能点"><a href="#%E5%8A%9F%E8%83%BD%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>功能点</h2>\n<ul>\n<li>点击播放只会在播放区域进行播放，再次点击暂停播放，鼠标右键点击播放区域也可播放</li>\n<li>可以添加播放区域，添加时会删除上一个播放区域，按住 shift + 鼠标右键可删除播放区域</li>\n<li>可以放大缩小波形图</li>\n</ul>\n<h2 id="waveformdividerindexjs"><a href="#waveformdividerindexjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WaveFormDivider/index.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53004228341528625000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* eslint-disable no-unused-expressions */\n/* eslint-disable import/no-unresolved */\n/* eslint-disable no-param-reassign */\nimport React from \'react\';\nimport WaveSurfer from \'waveSurfer.js\';\nimport RegionsPlugin from \'waveSurfer.js/dist/plugin/waveSurfer.regions\';\nimport TimelinePlugin from \'waveSurfer.js/dist/plugin/waveSurfer.timeline\';\nimport MinimapPlugin from \'waveSurfer.js/dist/plugin/waveSurfer.minimap\';\nimport { Slider, Button, Icon } from \'antd\';\nimport { fromJS } from \'immutable\';\nimport styles from \'./styles.css\';\n\n/**\n * Use formatTimeCallback to style the notch labels as you wish, such\n * as with more detail as the number of pixels per second increases.\n *\n * Here we format as M:SS.frac, with M suppressed for times < 1 minute,\n * and frac having 0, 1, or 2 digits as the zoom increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override timeInterval, primaryLabelInterval and/or\n * secondaryLabelInterval so they all work together.\n *\n * @param: seconds\n * @param: pxPerSec\n */\nfunction formatTimeCallback(seconds, pxPerSec) {\n  seconds = Number(seconds);\n  const minutes = Math.floor(seconds / 60);\n  seconds %= 60;\n\n  // fill up seconds with zeroes\n  let secondsStr = Math.round(seconds).toString();\n  if (pxPerSec >= 25 * 10) {\n    secondsStr = seconds.toFixed(2);\n  } else if (pxPerSec >= 25 * 1) {\n    secondsStr = seconds.toFixed(1);\n  }\n\n  if (minutes > 0) {\n    if (seconds < 10) {\n      secondsStr = \\`0\\${secondsStr}\\`;\n    }\n    return \\`\\${minutes}:\\${secondsStr}\\`;\n  }\n  return secondsStr;\n}\n\n/**\n * Use timeInterval to set the period between notches, in seconds,\n * adding notches as the number of pixels per second increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param: pxPerSec\n */\nfunction timeInterval(pxPerSec) {\n  let retval = 1;\n  if (pxPerSec >= 25 * 100) {\n    retval = 0.01;\n  } else if (pxPerSec >= 25 * 40) {\n    retval = 0.025;\n  } else if (pxPerSec >= 25 * 10) {\n    retval = 0.1;\n  } else if (pxPerSec >= 25 * 4) {\n    retval = 0.25;\n  } else if (pxPerSec >= 25) {\n    retval = 1;\n  } else if (pxPerSec * 5 >= 25) {\n    retval = 5;\n  } else if (pxPerSec * 15 >= 25) {\n    retval = 15;\n  } else {\n    retval = Math.ceil(0.5 / pxPerSec) * 60;\n  }\n  return retval;\n}\n\n/**\n * Return the cadence of notches that get labels in the primary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */\nfunction primaryLabelInterval(pxPerSec) {\n  let retval = 1;\n  if (pxPerSec >= 25 * 100) {\n    retval = 10;\n  } else if (pxPerSec >= 25 * 40) {\n    retval = 4;\n  } else if (pxPerSec >= 25 * 10) {\n    retval = 10;\n  } else if (pxPerSec >= 25 * 4) {\n    retval = 4;\n  } else if (pxPerSec >= 25) {\n    retval = 1;\n  } else if (pxPerSec * 5 >= 25) {\n    retval = 5;\n  } else if (pxPerSec * 15 >= 25) {\n    retval = 15;\n  } else {\n    retval = Math.ceil(0.5 / pxPerSec) * 60;\n  }\n  return retval;\n}\n\n/**\n * Return the cadence of notches to get labels in the secondary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Secondary labels are drawn after primary labels, so if\n * you want to have labels every 10 seconds and another color labels\n * every 60 seconds, the 60 second labels should be the secondaries.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */\nfunction secondaryLabelInterval(pxPerSec) {\n  // draw one every 10s as an example\n  return Math.floor(10 / timeInterval(pxPerSec));\n}\n\nexport class WaveFormDivider extends React.PureComponent {\n  // eslint-disable-line react/prefer-stateless-function\n  static defaultProps = {\n    startTime: undefined,\n    endTime: undefined,\n    src: \'\'\n  };\n\n  static initState = {\n    data: fromJS({\n      zoom: 0,\n      playing: false\n    })\n  };\n\n  state = WaveFormDivider.initState;\n\n  componentDidMount() {\n    const { src } = this.props;\n    src && this.initWaveSurfer();\n  }\n\n  componentWillUnmount() {\n    this.destroyWaveSurfer();\n  }\n\n  setImmState = (fn, cb) => {\n    this.setState(\n      ({ data }) => ({\n        data: fn(data)\n      }),\n      cb\n    );\n  };\n\n  destroyWaveSurfer = () => {\n    this.setState(WaveFormDivider.initState);\n    this.waveSurfer && this.waveSurfer.destroy();\n  };\n\n  initWaveSurfer = () => {\n    const { data } = this.state;\n    const { handleChangeStartEnd, src, startTime, endTime } = this.props;\n    this.waveSurfer = WaveSurfer.create({\n      container: this.waveForm,\n      scrollParent: true,\n      waveColor: \'#A8DBA8\',\n      progressColor: \'#3B8686\',\n      plugins: [\n        MinimapPlugin.create(),\n        RegionsPlugin.create({\n          dragSelection: {\n            slop: 5\n          }\n        }),\n        TimelinePlugin.create({\n          container: this.waveTimeline,\n          formatTimeCallback,\n          timeInterval,\n          primaryLabelInterval,\n          secondaryLabelInterval,\n          primaryColor: \'blue\',\n          secondaryColor: \'red\',\n          primaryFontColor: \'blue\',\n          secondaryFontColor: \'red\'\n        })\n      ]\n    });\n    this.waveSurfer.load(src);\n    this.waveSurfer.on(\'ready\', () => {\n      this.waveSurfer.zoom(data.get(\'zoom\'));\n      if (data.get(\'playing\')) {\n        this.waveSurfer.play();\n      }\n      startTime !== undefined && endTime !== undefined && this.addWaveFormRegion(startTime, endTime);\n    });\n    this.waveSurfer.on(\'region-update-end\', (e) => {\n      const { start, end } = e;\n      handleChangeStartEnd && handleChangeStartEnd(start, end);\n    });\n    this.waveSurfer.on(\'region-created\', () => {\n      this.waveSurfer.clearRegions();\n    });\n    // this.waveSurfer.on(\'region-removed\', () => {\n    //   handleChangeStartEnd && handleChangeStartEnd(undefined, undefined);\n    // });\n    this.waveSurfer.on(\'pause\', () => {\n      this.setImmState((dat) => dat.set(\'playing\', false));\n    });\n    this.waveSurfer.on(\'play\', () => {\n      this.setImmState((dat) => dat.set(\'playing\', true));\n    });\n    this.waveSurfer.on(\'zoom\', (value) => {\n      this.setImmState((dat) => dat.set(\'zoom\', value));\n    });\n    this.waveSurfer.on(\'region-click\', (region, e) => {\n      e.stopPropagation();\n      if (e.shiftKey) {\n        region.remove();\n        handleChangeStartEnd && handleChangeStartEnd(undefined, undefined);\n      } else {\n        region.play();\n      }\n    });\n  };\n\n  addWaveFormRegion = (start, end) => {\n    this.waveSurfer.addRegion({\n      start,\n      end,\n      color: \'hsla(400, 100%, 30%, 0.5)\'\n    });\n  };\n\n  handleWaveFormZoom = (value) => {\n    let tmp = value;\n    if (value < 0) {\n      tmp = 0;\n    }\n    if (value > 1000) {\n      tmp = 1000;\n    }\n    this.waveSurfer.zoom(tmp);\n  };\n\n  handleWaveFormPlayOrPause = () => {\n    const { data } = this.state;\n    const { startTime, endTime } = this.props;\n    if (data.get(\'playing\')) {\n      this.waveSurfer.pause();\n    } else {\n      this.waveSurfer.play(startTime, endTime);\n    }\n  };\n\n  render() {\n    const { data } = this.state;\n    return (\n      <div className={styles.container}>\n        <div\n          ref={(r) => {\n            this.waveForm = r;\n          }}\n          className={styles.waveForm}\n        />\n        <div\n          ref={(r) => {\n            this.waveTimeline = r;\n          }}\n        />\n        <div className={styles.control}>\n          <div className={styles.zoomContainer}>\n            <Icon type=\'minus-circle-o\' onClick={() => this.handleWaveFormZoom(data.get(\'zoom\') - 100)} />\n            <Slider\n              tipFormatter={(value) => \\`\\${value}%\\`}\n              max={1000}\n              onChange={(value) => this.handleWaveFormZoom(value)}\n              value={data.get(\'zoom\')}\n            />\n            <Icon type=\'plus-circle-o\' onClick={() => this.handleWaveFormZoom(data.get(\'zoom\') + 100)} />\n          </div>\n          <Button className={styles.playBtn} type=\'primary\' onClick={this.handleWaveFormPlayOrPause}>\n            {data.get(\'playing\') ? \'暂停\' : \'播放\'}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n}\n\nWaveFormDivider.propTypes = {\n  src: React.PropTypes.string,\n  handleChangeStartEnd: React.PropTypes.func,\n  startTime: React.PropTypes.number,\n  endTime: React.PropTypes.number\n};\n\nexport default WaveFormDivider;`, `53004228341528625000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token comment">/* eslint-disable no-unused-expressions */</span>\n<span class="token comment">/* eslint-disable import/no-unresolved */</span>\n<span class="token comment">/* eslint-disable no-param-reassign */</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> WaveSurfer <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> RegionsPlugin <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js/dist/plugin/waveSurfer.regions\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> TimelinePlugin <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js/dist/plugin/waveSurfer.timeline\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> MinimapPlugin <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js/dist/plugin/waveSurfer.minimap\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Slider<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'antd\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fromJS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'immutable\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./styles.css\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * Use formatTimeCallback to style the notch labels as you wish, such\n * as with more detail as the number of pixels per second increases.\n *\n * Here we format as M:SS.frac, with M suppressed for times &lt; 1 minute,\n * and frac having 0, 1, or 2 digits as the zoom increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override timeInterval, primaryLabelInterval and/or\n * secondaryLabelInterval so they all work together.\n *\n * @param: seconds\n * @param: pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">formatTimeCallback</span><span class="token punctuation">(</span><span class="token parameter">seconds<span class="token punctuation">,</span> pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  seconds <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>seconds <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  seconds <span class="token operator">%=</span> <span class="token number">60</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// fill up seconds with zeroes</span>\n  <span class="token keyword">let</span> secondsStr <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    secondsStr <span class="token operator">=</span> seconds<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    secondsStr <span class="token operator">=</span> seconds<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>minutes <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>seconds <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      secondsStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secondsStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>minutes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secondsStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> secondsStr<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * Use timeInterval to set the period between notches, in seconds,\n * adding notches as the number of pixels per second increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param: pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">timeInterval</span><span class="token punctuation">(</span><span class="token parameter">pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.025</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.25</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">15</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">/</span> pxPerSec<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> retval<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * Return the cadence of notches that get labels in the primary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">primaryLabelInterval</span><span class="token punctuation">(</span><span class="token parameter">pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">15</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">/</span> pxPerSec<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> retval<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * Return the cadence of notches to get labels in the secondary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Secondary labels are drawn after primary labels, so if\n * you want to have labels every 10 seconds and another color labels\n * every 60 seconds, the 60 second labels should be the secondaries.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">secondaryLabelInterval</span><span class="token punctuation">(</span><span class="token parameter">pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// draw one every 10s as an example</span>\n  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> <span class="token function">timeInterval</span><span class="token punctuation">(</span>pxPerSec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WaveFormDivider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-line react/prefer-stateless-function</span>\n  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n    startTime<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>\n    endTime<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>\n    src<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">static</span> initState <span class="token operator">=</span> <span class="token punctuation">{</span>\n    data<span class="token punctuation">:</span> <span class="token function">fromJS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      zoom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      playing<span class="token punctuation">:</span> <span class="token boolean">false</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  state <span class="token operator">=</span> WaveFormDivider<span class="token punctuation">.</span>initState<span class="token punctuation">;</span>\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> src <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    src <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initWaveSurfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroyWaveSurfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function-variable function">setImmState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>\n      <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n        data<span class="token punctuation">:</span> <span class="token function">fn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      cb\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">destroyWaveSurfer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>WaveFormDivider<span class="token punctuation">.</span>initState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">initWaveSurfer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> handleChangeStartEnd<span class="token punctuation">,</span> src<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> endTime <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer <span class="token operator">=</span> WaveSurfer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      container<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waveForm<span class="token punctuation">,</span>\n      scrollParent<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      waveColor<span class="token punctuation">:</span> <span class="token string">\'#A8DBA8\'</span><span class="token punctuation">,</span>\n      progressColor<span class="token punctuation">:</span> <span class="token string">\'#3B8686\'</span><span class="token punctuation">,</span>\n      plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n        MinimapPlugin<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        RegionsPlugin<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          dragSelection<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            slop<span class="token punctuation">:</span> <span class="token number">5</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        TimelinePlugin<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          container<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waveTimeline<span class="token punctuation">,</span>\n          formatTimeCallback<span class="token punctuation">,</span>\n          timeInterval<span class="token punctuation">,</span>\n          primaryLabelInterval<span class="token punctuation">,</span>\n          secondaryLabelInterval<span class="token punctuation">,</span>\n          primaryColor<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n          secondaryColor<span class="token punctuation">:</span> <span class="token string">\'red\'</span><span class="token punctuation">,</span>\n          primaryFontColor<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n          secondaryFontColor<span class="token punctuation">:</span> <span class="token string">\'red\'</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'ready\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">zoom</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      startTime <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> endTime <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addWaveFormRegion</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'region-update-end\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> end <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>\n      handleChangeStartEnd <span class="token operator">&amp;&amp;</span> <span class="token function">handleChangeStartEnd</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'region-created\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">clearRegions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// this.waveSurfer.on(\'region-removed\', () => {</span>\n    <span class="token comment">//   handleChangeStartEnd &amp;&amp; handleChangeStartEnd(undefined, undefined);</span>\n    <span class="token comment">// });</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'pause\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setImmState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dat</span><span class="token punctuation">)</span> <span class="token operator">=></span> dat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'play\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setImmState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dat</span><span class="token punctuation">)</span> <span class="token operator">=></span> dat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setImmState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dat</span><span class="token punctuation">)</span> <span class="token operator">=></span> dat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'region-click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">region<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>shiftKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        region<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        handleChangeStartEnd <span class="token operator">&amp;&amp;</span> <span class="token function">handleChangeStartEnd</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        region<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">addWaveFormRegion</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">addRegion</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      start<span class="token punctuation">,</span>\n      end<span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'hsla(400, 100%, 30%, 0.5)\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleWaveFormZoom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> tmp <span class="token operator">=</span> value<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      tmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      tmp <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">zoom</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleWaveFormPlayOrPause</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> startTime<span class="token punctuation">,</span> endTime <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>waveForm <span class="token operator">=</span> r<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>waveForm<span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>waveTimeline <span class="token operator">=</span> r<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>control<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>zoomContainer<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Icon</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>minus-circle-o<span class="token punctuation">\'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWaveFormZoom</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Slider</span></span>\n              <span class="token attr-name">tipFormatter</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">max</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1000</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWaveFormZoom</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n            <span class="token punctuation">/></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Icon</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>plus-circle-o<span class="token punctuation">\'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWaveFormZoom</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>playBtn<span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>primary<span class="token punctuation">\'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleWaveFormPlayOrPause<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'暂停\'</span> <span class="token punctuation">:</span> <span class="token string">\'播放\'</span><span class="token punctuation">}</span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nWaveFormDivider<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n  src<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  handleChangeStartEnd<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>\n  startTime<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>\n  endTime<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>number\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> WaveFormDivider<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="waveformdividerstylescss"><a href="#waveformdividerstylescss" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WaveFormDivider/styles.css</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72285909131878960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@import \'styles/vars.css\';\n\n.control {\n  text-align: center;\n}\n\n.zoomContainer {\n  position: relative;\n  padding: 0 30px;\n\n  :global {\n    .anticon {\n      position: absolute;\n      top: -2px;\n      width: 16px;\n      height: 16px;\n      line-height: 1;\n      font-size: 16px;\n      color: rgba(0, 0, 0, 0.25);\n      cursor: pointer;\n\n      &:hover {\n        color: var(--color-primary);\n      }\n    }\n\n    .anticon:first-child {\n      left: 0;\n    }\n\n    .anticon:last-child {\n      right: 0;\n    }\n  }\n}`, `72285909131878960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@import</span> <span class="token string">\'styles/vars.css\'</span><span class="token punctuation">;</span></span>\n\n<span class="token selector">.control</span> <span class="token punctuation">{</span>\n  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.zoomContainer</span> <span class="token punctuation">{</span>\n  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n  <span class="token property">padding</span><span class="token punctuation">:</span> 0 30px<span class="token selector">;\n\n  :global</span> <span class="token punctuation">{</span>\n    <span class="token selector">.anticon</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> -2px<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.25<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token selector">;\n\n      &amp;:hover</span> <span class="token punctuation">{</span>\n        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color-primary<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.anticon:first-child</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.anticon:last-child</span> <span class="token punctuation">{</span>\n      <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="类似实现效果"><a href="#%E7%B1%BB%E4%BC%BC%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类似实现效果</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-02-13-21-04-20-3de2799882851b83cbeb78dd39a6cc79-370b5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 26.169265033407573%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7ElEQVQY0z2O22qDQBCGff+rXoS2b9FCQml8gV60N0kxVE1FiYegzh41e3B37Rqhw8fHzM9c/ME8z252StCRdTcOtwFG2hol1txYJ7RZkZOVkxOLF7SxgX/6rsrNfvccbp/C7eN+9/rxHl2/Eno+4dMRokOXHrs06n/PpCpom5EmRZcYipp3gdYaCCkuWZ7HeZF4sixquxIxjBnqCaoBaui9GwQNQM8YHsee80HKQPCBYE7J4OG+O/H4ZMBogQL1oPuOFjjnSkknhZHiXvt/Xj7LTZg8vMU/FfOndW7NlVJmMtaY2Tlva72M1tMfBQkVYzDO9hsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 02 13 21 04 20" title="" data-src="/static/2019-02-13-21-04-20-3de2799882851b83cbeb78dd39a6cc79-fee1c.png" data-srcset="/static/2019-02-13-21-04-20-3de2799882851b83cbeb78dd39a6cc79-a67b7.png 200w,\n/static/2019-02-13-21-04-20-3de2799882851b83cbeb78dd39a6cc79-0b187.png 400w,\n/static/2019-02-13-21-04-20-3de2799882851b83cbeb78dd39a6cc79-fee1c.png 800w,\n/static/2019-02-13-21-04-20-3de2799882851b83cbeb78dd39a6cc79-370b5.png 898w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/基于wavesurfer.js声音波形图的研究/index.md absPath of file >>> MarkdownRemark",timeToRead:6,frontmatter:{date:"2019-02-13 20:39:46",path:"/wavesurfer-voice-wave-research/",tags:"前端, wavesurfer, 声音波形图, 预研",title:"基于wavesurfer.js声音波形图的研究",draft:null}},{excerpt:"需求背景 最近要做一个需求类似于富文本框的功能，需要输入带有 span 标签并显示，同时 span 标签是一个整体，只能同时输入同时删除，目前需求只有这一个 html 标签，暂时无其他标签 需求难点 placeholder 提示语 input 和 textarea 能轻松实现 placeholder 提示语的效果，但作用于 contenteditable 的元素，placeholder 不起作用，可以通过 css 的 :empty 解决 获取输入框的内容 可以利用 innerHTML…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近要做一个需求类似于富文本框的功能，需要输入带有 span 标签并显示，同时 span 标签是一个整体，只能同时输入同时删除，目前需求只有这一个 html 标签，暂时无其他标签</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-11-26-09-42-43-5e0f74f345d85ef1160cc06ba68eacfa-262af.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 517px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 76.40232108317214%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABcElEQVQoz6WRzU7CQBCA9018F+WCBxGsBylwNproCxjfQgmirUcvnvRiIjQxUqIXw80ohkCMkSACsUu73e2O01Z+kmoC8cvXbXe6s7M/ZCNCOp1WFEXT9IuSeVmuFovFZDKpqmp0JFEjZDLZdUUx7+63K7Bbhap5m1hJZHO56EiyOiIRvrBKai2+HDduKnsm7JtgGMZSLJZSFPw1MYBouD5UR7EJ0PXiUeGp3tgqwU4Z6vXnfP5Q10+1CER4Xr/XpxZtNlt0aAOAlNgAE7B55Rsi4RcI565j24w5lFouY54QqBTc5eK4Jk9qUmKf8zA+FiP4EFeA5UjqeFbg0IVQ/Pa4QKeDYykDTCSY+fb+0W53mq3X7mcf1yy8H23uO+5O65dkQHAO4clgU/KPrf0CZtBRMszLJJkLv6ScRx4um3E8G3+a2f1yYGCDgwcG/4DImfFv12WUieuGPH+ULz05R2XG2KDbafXcxTNYOPAKD/ANP7r1LJRY26UAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 11 26 09 42 43" title="" data-src="/static/2018-11-26-09-42-43-5e0f74f345d85ef1160cc06ba68eacfa-262af.png" data-srcset="/static/2018-11-26-09-42-43-5e0f74f345d85ef1160cc06ba68eacfa-1499b.png 200w,\n/static/2018-11-26-09-42-43-5e0f74f345d85ef1160cc06ba68eacfa-ea081.png 400w,\n/static/2018-11-26-09-42-43-5e0f74f345d85ef1160cc06ba68eacfa-262af.png 517w" data-sizes="(max-width: 517px) 100vw, 517px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-11-26-09-43-03-a69f16c79040e860efe81812288dab83-bb96f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 512px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 59.1796875%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA2klEQVQoz5WSsW7CMBCG/Wx9kA7sfYQ+Q8e+AQsTQkzdOjBVYiRThOgCsazEiSGO7fsPR2mlQhEO509efP/5/PtECKGpG2OMLKQxRx4dRCS8c8X+oHW1zXNVVmAG0koA3juB61wEgg9piFhYR1LpQmkl5XxjXz44k4iVW4fO3+PUQcQkreu4TKVWu+7ti7/robFE51HYi+lfHlL8FePHBQb9niXDDuLk825ytIhuc6DHcIFt6Pfhq8Zz4YkYP1Lxmn4EfTvLeLLE6+cj4uhrWVbUNu9rfprS8wJnNsS/jFGoy58AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 11 26 09 43 03" title="" data-src="/static/2018-11-26-09-43-03-a69f16c79040e860efe81812288dab83-bb96f.png" data-srcset="/static/2018-11-26-09-43-03-a69f16c79040e860efe81812288dab83-7728b.png 200w,\n/static/2018-11-26-09-43-03-a69f16c79040e860efe81812288dab83-23f96.png 400w,\n/static/2018-11-26-09-43-03-a69f16c79040e860efe81812288dab83-bb96f.png 512w" data-sizes="(max-width: 512px) 100vw, 512px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="需求难点"><a href="#%E9%9C%80%E6%B1%82%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求难点</h1>\n<h2 id="placeholder-提示语"><a href="#placeholder-%E6%8F%90%E7%A4%BA%E8%AF%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>placeholder 提示语</h2>\n<p>input 和 textarea 能轻松实现 placeholder 提示语的效果，但作用于 contenteditable 的元素，placeholder 不起作用，可以通过 css 的 :empty 解决</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66988037716477390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[contenteditable=\'true\']:empty::before {\n  content: attr(placeholder);\n}`, `66988037716477390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">[contenteditable=\'true\']:empty::before</span> <span class="token punctuation">{</span>\n  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token function">attr</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="获取输入框的内容"><a href="#%E8%8E%B7%E5%8F%96%E8%BE%93%E5%85%A5%E6%A1%86%E7%9A%84%E5%86%85%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取输入框的内容</h2>\n<p>可以利用 innerHTML、innerText、textContent 获取输入框的内容，详细对比介绍一下这几个方法：</p>\n<ol>\n<li>innerHTML 返回或修改标签之间的内容，包括标签和文本信息，基本上所有浏览器都支持。</li>\n<li>innerText 打印标签之间的纯文本信息，会将标签过滤掉,此功能最初由 Internet Explorer 引入，在 Firefox 上存在兼容问题。</li>\n</ol>\n<h3 id="innertext--textcontent"><a href="#innertext--textcontent" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>innerText !== textContent</h3>\n<p>innerText 和 textContent 均能获取标签的内容，但二者存在差别，使用的时候还需注意浏览器兼容性：</p>\n<ol>\n<li>textContent 会获取 style 元素里的文本（若有 script 元素也是这样），而 innerText 不会</li>\n<li>textContent 会保留空行、空格与换行符</li>\n<li>innerText 并不是标准，而 textContent 更早被纳入标准中</li>\n<li>innerText 会忽略 display: none 标签内的内容，textContent 则不会</li>\n<li>性能上 textContent > innerText</li>\n</ol>\n<h2 id="光标的位置"><a href="#%E5%85%89%E6%A0%87%E7%9A%84%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>光标的位置</h2>\n<p>首先遇到的一个问题是利用上述方法实现 placeholder 后，输入框的光标在 Firefox 中的位置会比其它浏览器要高一截。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-11-26-09-37-29-24c1eb9066149380d1ba230499064daf-38753.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 665px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 14.73684210526316%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAQklEQVQI15XNwQ0AIQhEUfoviAboxIXIxQ0cV4NICe47z88AESFiezgzI2Jfqz2YGbOM8VY557pXPYiIdnX376c6O9FlreVw/XlNAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 11 26 09 37 29" title="" data-src="/static/2018-11-26-09-37-29-24c1eb9066149380d1ba230499064daf-38753.png" data-srcset="/static/2018-11-26-09-37-29-24c1eb9066149380d1ba230499064daf-a480d.png 200w,\n/static/2018-11-26-09-37-29-24c1eb9066149380d1ba230499064daf-4026e.png 400w,\n/static/2018-11-26-09-37-29-24c1eb9066149380d1ba230499064daf-38753.png 665w" data-sizes="(max-width: 665px) 100vw, 665px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>尝试了很多方法来解决均无果，最终发现默认放置 <code class="language-text">&lt;\\br&gt;</code> 标签后，光标位置正常了。</p>\n<h3 id="受控组件下光标每次输入跳到文本开头"><a href="#%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E4%B8%8B%E5%85%89%E6%A0%87%E6%AF%8F%E6%AC%A1%E8%BE%93%E5%85%A5%E8%B7%B3%E5%88%B0%E6%96%87%E6%9C%AC%E5%BC%80%E5%A4%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>受控组件下光标每次输入跳到文本开头</h3>\n<p>另一个需求是输入文本时，在 react 富文本组件受控（即 setState) 的影响下，光标每次输入会跳到文本开头，而非受控组件不会出现此问题，但是需求原因，非受控组件是 react 的一种反模式，同时也会影响到组件的取值赋值过程不好同步，解决办法是只能自己控制光标的位置，实现受控组件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23429958158043673000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function isChildOf(node, parentId) {\n  while (node !== null) {\n    if (node.id === parentId) {\n      return true;\n    }\n    node = node.parentNode;\n  }\n\n  return false;\n}\n\nfunction getCurrentCursorPosition(parentId) {\n  const selection = window.getSelection();\n  let charCount = -1;\n  let node;\n\n  if (selection.focusNode) {\n    if (isChildOf(selection.focusNode, parentId)) {\n      node = selection.focusNode;\n      charCount = selection.focusOffset;\n      while (node) {\n        if (node.id === parentId) {\n          break;\n        }\n\n        if (node.previousSibling) {\n          node = node.previousSibling;\n          charCount += node.textContent.length;\n        } else {\n          node = node.parentNode;\n          if (node === null) {\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  return charCount;\n}\n\nfunction createRange(node, chars, range) {\n  if (!range) {\n    range = document.createRange();\n    range.selectNode(node);\n    range.setStart(node, 0);\n  }\n\n  if (chars.count === 0) {\n    range.setEnd(node, chars.count);\n  } else if (node && chars.count > 0) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      if (node.textContent.length < chars.count) {\n        chars.count -= node.textContent.length;\n      } else {\n        range.setEnd(node, chars.count);\n        chars.count = 0;\n      }\n    } else {\n      for (let lp = 0; lp < node.childNodes.length; lp++) {\n        range = createRange(node.childNodes[lp], chars, range);\n\n        if (chars.count === 0) {\n          break;\n        }\n      }\n    }\n  }\n\n  return range;\n}\n\nfunction setCurrentCursorPosition(that, chars, node) {\n  if (chars >= 0) {\n    const selection = window.getSelection();\n\n    const range = createRange(that, { count: chars }, node);\n\n    if (range) {\n      range.collapse(false);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n}`, `23429958158043673000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">isChildOf</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>node <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>id <span class="token operator">===</span> parentId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    node <span class="token operator">=</span> node<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">getCurrentCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">parentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> charCount <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> node<span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isChildOf</span><span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span> parentId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      node <span class="token operator">=</span> selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">;</span>\n      charCount <span class="token operator">=</span> selection<span class="token punctuation">.</span>focusOffset<span class="token punctuation">;</span>\n      <span class="token keyword">while</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>id <span class="token operator">===</span> parentId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">break</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>previousSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          node <span class="token operator">=</span> node<span class="token punctuation">.</span>previousSibling<span class="token punctuation">;</span>\n          charCount <span class="token operator">+=</span> node<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          node <span class="token operator">=</span> node<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">break</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> charCount<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">createRange</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>range<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">selectNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>chars<span class="token punctuation">.</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> chars<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">&amp;&amp;</span> chars<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> Node<span class="token punctuation">.</span><span class="token constant">TEXT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> chars<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        chars<span class="token punctuation">.</span>count <span class="token operator">-=</span> node<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> chars<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        chars<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> lp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> lp <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> lp<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        range <span class="token operator">=</span> <span class="token function">createRange</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>lp<span class="token punctuation">]</span><span class="token punctuation">,</span> chars<span class="token punctuation">,</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>chars<span class="token punctuation">.</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">break</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> range<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">setCurrentCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">that<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>chars <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> range <span class="token operator">=</span> <span class="token function">createRange</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> chars <span class="token punctuation">}</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      selection<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      selection<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>具体用法是先得到富文本框之前的光标位置，然后在 setState 之后恢复光标的位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76344231561888300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const lastRange = getCurrentCursorPosition(this.id);\nthis.setState(innerHTML, () => {\n  const that = document.getElementById(this.id);\n  setCurrentCursorPosition(that, lastRange);\n});`, `76344231561888300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> lastRange <span class="token operator">=</span> <span class="token function">getCurrentCursorPosition</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>innerHTML<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> that <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setCurrentCursorPosition</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> lastRange<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="删除遇到-span-时光标跳到文本开头"><a href="#%E5%88%A0%E9%99%A4%E9%81%87%E5%88%B0-span-%E6%97%B6%E5%85%89%E6%A0%87%E8%B7%B3%E5%88%B0%E6%96%87%E6%9C%AC%E5%BC%80%E5%A4%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除遇到 span 时光标跳到文本开头</h3>\n<p>接着又遇到一个坑，因为想实现的是整体删除 span，所以设置了 contenteditable 属性为 false，在删除光标遇到带有 span 标签的字符时，光标也会跳到不正确的位置</p>\n<p>经过一步步的调试，发现取出函数 getCurrentCursorPosition 的光标位置是不对的，它取出的是在 span 内部光标的位置，比如说 <code class="language-text">3233&lt;span&gt; 我是 &lt;/span&gt;</code>，此时取出的光标位置值为 2，而不是 6，考虑到修改 getCurrentCursorPosition 会影响之前的 bug，所以只能在删除遇到标签时做下特殊处理，在遇到 span 标签删除后，光标强制移到文本最后</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97028238646014250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function selectAllText(elem) {\n  // 将光标移到文本末尾\n  if (window.getSelection) {\n    elem.focus();\n    const range = window.getSelection();\n    range.selectAllChildren(elem);\n    range.collapseToEnd();\n  } else if (document.selection) {\n    const range = document.selection.createTextRange();\n    range.moveToElementText(elem);\n    range.collapse(false);\n    range.select(); /* 避免产生空格 */\n  }\n}\n\nconst selection = window.getSelection();\nif (selection.focusNode.id === this.id) {\n  // 焦点在 span 内部，即光标遇到 span 标签\n  this.props.onChange(innerHTML, () => {\n    const that = document.getElementById(this.id);\n    selectAllText(that);\n  });\n  return;\n}`, `97028238646014250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">selectAllText</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将光标移到文本末尾</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>getSelection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    elem<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> range <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">selectAllChildren</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">collapseToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">createTextRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">moveToElementText</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 避免产生空格 */</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 焦点在 span 内部，即光标遇到 span 标签</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>innerHTML<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> that <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">selectAllText</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="中文输入法会将英文字符一起输入"><a href="#%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95%E4%BC%9A%E5%B0%86%E8%8B%B1%E6%96%87%E5%AD%97%E7%AC%A6%E4%B8%80%E8%B5%B7%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>中文输入法会将英文字符一起输入</h2>\n<p>在输入中文字符时，会将英文字符一起输入，解决办法是触发相应事件给一个标志变量，判断中文输入是否已完成</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2018-11-26-10-07-29-b0cbe1e1d7455110dc9d074de87f17a2-262af.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 517px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 58.027079303675045%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABZElEQVQoz41SS07DMBD1DRFrbgAHYM8NOAQLJGDBClYsALGCDVJVFYHaqk1KyKdJHP9mPIOdQBeAREcv0hvHz555Y1GVZV03qzStqoq3DkQkIpHnZbFul4tFWeZI7DD8Iib6RwwQxZtdkUQNoWcgNkAWyCG5ngzp1woSIEfx6Yj2LvlharpWHt3R4Q2nZVdUtbFokZVl5VgjO88hNdCnwGsdaxT3Cz5+5LfCkdNnYzoZsezUyyyZrLpOu1gQGCtlUtmytcYCsw8AjBDhmB8R6qka9zpO5GwZqs0bs8zltLDPiZ5X1oDPJK41BiJCGaFJ6rsFzxjN8mQ0Fxm/p8a4TEKh0AKuWshaUBY/JAS0BkWtYyf6F5RnHW2LvUHfLXyTcJk00QIRvr8x2BtJFAxuDVDhdBcnI/oZbYnNTKl3Jsy5fxHboFPaG/WU0sG137/yszrevG00rXRdfTv3uxd+59xPSv4EYqm32jR0KcUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2018 11 26 10 07 29" title="" data-src="/static/2018-11-26-10-07-29-b0cbe1e1d7455110dc9d074de87f17a2-262af.png" data-srcset="/static/2018-11-26-10-07-29-b0cbe1e1d7455110dc9d074de87f17a2-1499b.png 200w,\n/static/2018-11-26-10-07-29-b0cbe1e1d7455110dc9d074de87f17a2-ea081.png 400w,\n/static/2018-11-26-10-07-29-b0cbe1e1d7455110dc9d074de87f17a2-262af.png 517w" data-sizes="(max-width: 517px) 100vw, 517px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70036036022272975000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<html>\n  <script>\n    handlingComposition = () => {\n      this.isCompositionEnd = false;\n    };\n\n    handleComposition = (e) => {\n      this.isCompositionEnd = true;\n      // 以下是解决中文字符在文本框末尾时不赋值的 bug\n      this.setState(e.target.innerHTML, () => {\n        const that = document.getElementById(this.id);\n        selectAllText(that); // 光标跳转到最后\n      });\n    };\n\n    emitChange = (e) => {\n      if (!this.isCompositionEnd) {\n        return; // 直接跳过，不赋值\n      }\n    };\n  </script>\n  <div\n    contenteditable\n    onInput=&quot;{this.emitChange}&quot;\n    onCompositionStart=&quot;{this.handlingComposition}&quot;\n    onCompositionUpdate=&quot;{this.handlingComposition}&quot;\n    onCompositionEnd=&quot;{this.handleComposition}&quot;\n  />\n</html>`, `70036036022272975000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token function-variable function">handlingComposition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>isCompositionEnd <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function-variable function">handleComposition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>isCompositionEnd <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token comment">// 以下是解决中文字符在文本框末尾时不赋值的 bug</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> that <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">selectAllText</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 光标跳转到最后</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function-variable function">emitChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isCompositionEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 直接跳过，不赋值</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n    <span class="token attr-name">contenteditable</span>\n    <span class="token attr-name">onInput</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.emitChange}<span class="token punctuation">"</span></span>\n    <span class="token attr-name">onCompositionStart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.handlingComposition}<span class="token punctuation">"</span></span>\n    <span class="token attr-name">onCompositionUpdate</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.handlingComposition}<span class="token punctuation">"</span></span>\n    <span class="token attr-name">onCompositionEnd</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.handleComposition}<span class="token punctuation">"</span></span>\n  <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>暂时遇到这么多问题，以后遇到 bug 再更新</p>\n<p>以上更新于<code class="language-text">2018-11-26 08:55:56</code></p>\n<hr>\n<h1 id="最终解决方案-draft-js"><a href="#%E6%9C%80%E7%BB%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-draft-js" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最终解决方案 draft-js</h1>\n<h2 id="代码注释"><a href="#%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码注释</h2>\n<p>以上方法有很多未知的 bug，比较明显的问题就是光标会到处乱跑，自己解决起来有太多的坑，故采用业界比较成熟的 <a href="https://github.com/draft-js-plugins/draft-js-plugins" target="_blank" rel="nofollow noreferrer noopener">draft-js-plugins</a>，底层采用 facebook 的开源库 <a href="https://github.com/facebook/draft-js" target="_blank" rel="nofollow noreferrer noopener">draft-js</a>，期间也遇到不少问题，详见代码注释</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="69933605050770240000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`import React from \'react\';\nimport PropTypes from \'prop-types\';\nimport { EditorState } from \'draft-js\';\nimport { convertFromHTML, convertToHTML } from \'draft-convert\';\nimport classnames from \'classnames\';\nimport Editor from \'draft-js-plugins-editor\';\nimport createMentionPlugin, { defaultSuggestionsFilter, defaultTheme } from \'draft-js-mention-plugin\';\nimport \'draft-js-mention-plugin/lib/plugin.css\';\nimport utils from \'utils\';\n\nimport styles from \'./styles.css\';\n// 为了解决 IE9 下 parseFromString(\'\', \'text/html\') 的报错\nimport \'./DomParserPloyfill\';\n\nclass GraphHintTextArea extends React.PureComponent {\n  // eslint-disable-line react/prefer-stateless-function\n  constructor(props) {\n    super(props);\n    let theme = {\n      ...defaultTheme,\n      mention: styles.mention\n    };\n    const browser = utils.getBrowserInfo();\n    if (browser.name === \'msie\' &amp;&amp; browser.version === \'9\') {\n      theme = {\n        ...defaultTheme,\n        mention: styles.mention,\n        mentionSuggestions: styles.mentionSuggestions\n      };\n    }\n    // 设置 mention 标签的可变性、触发字符、样式\n    this.mentionPlugin = createMentionPlugin({\n      entityMutability: \'IMMUTABLE\',\n      mentionTrigger: \'\\$\',\n      theme\n    });\n\n    const { value } = this.props;\n    const contentState = convertFromHTML({\n      // 遇到 class 带有 mention 的标签进行实体的不可变转化，此时 mention 即话术变量标签是一体的\n      // 删除只能整个删除，添加也将转化为普通字符\n      // eslint-disable-next-line consistent-return\n      htmlToEntity: (nodeName, node, createEntity) => {\n        if (nodeName === \'span\' &amp;&amp; node.className === \'mention\') {\n          const name = node.innerText || \'\';\n          return createEntity(\'\\$mention\', \'IMMUTABLE\', {\n            mention: {\n              name,\n              _id: node.id\n            }\n          });\n        }\n      }\n    })(value);\n\n    this.state = {\n      editorState: EditorState.createWithContent(contentState),\n      suggestions: []\n    };\n  }\n\n  // componentDidMount = () => {\n  //   this.focus();\n  // }\n\n  // https://github.com/facebook/draft-js/issues/1198\n  // 因为此处最开始打算使用 componentWillReceiveProps，但在和 onChange 一起作用时，\n  // 导致多次执行，光标跳到行首，只能采用非受控组件的方式手动调用\n  setEditorContent(text) {\n    const contentState = convertFromHTML({\n      // eslint-disable-next-line consistent-return\n      htmlToEntity: (nodeName, node, createEntity) => {\n        if (nodeName === \'span\' &amp;&amp; node.className === \'mention\') {\n          const name = node.innerText || \'\';\n          return createEntity(\'\\$mention\', \'IMMUTABLE\', {\n            mention: {\n              name,\n              _id: node.id\n            }\n          });\n        }\n      }\n    })(text);\n    const { editorState } = this.state;\n    // 这里必须用 push 方法，不然会导致编辑器提示框不能弹出\n    // https://github.com/draft-js-plugins/draft-js-plugins/issues/210\n    const newEditorState = EditorState.push(editorState, contentState);\n    this.setState({\n      editorState: newEditorState\n    });\n  }\n\n  // https://github.com/draft-js-plugins/draft-js-plugins/issues/800\n  // 不能直接调用 focus，否则会造成 draft-js-mention-plugin 的失效\n  // focus = () => {\n  //   setTimeout(() => {\n  //     this.editor.focus();\n  //   }, 0);\n  // }\n\n  handleChange = (editorState) => {\n    const contentState = editorState.getCurrentContent();\n    const pureText = this.convertToPureText(contentState);\n    // 暂时不能阻挡非受控组件的输入\n    // const { maxLength } = this.props;\n    // if (pureText.length > maxLength) {\n    //   return;\n    // }\n    this.setState(\n      {\n        editorState\n      },\n      () => {\n        this.triggerChange(contentState, pureText);\n      }\n    );\n  };\n\n  handleSearchChange = ({ value }) => {\n    const { hints } = this.props;\n    this.setState({\n      suggestions: defaultSuggestionsFilter(value, hints)\n    });\n  };\n\n  // 这里是转成看到标签的效果，目的是得到实际字符\n  convertToPureText = (contentState) => {\n    let htmlToPureText = convertToHTML({\n      // eslint-disable-next-line consistent-return\n      blockToHTML: (data) => {\n        const { type } = data;\n        if (type === \'unstyled\') {\n          return {\n            start: \'\',\n            end: \'\',\n            empty: \'\'\n          };\n        }\n      }\n    })(contentState);\n    htmlToPureText = htmlToPureText.replace(/<\\/?.+?\\/?>|\\s+/g, \'\');\n    return htmlToPureText;\n  };\n\n  // 这里是转成要传给后端的效果\n  triggerChange = (contentState, pureText) => {\n    const { onChange } = this.props;\n    let html = convertToHTML({\n      // 将遇到的实体标签转化为 \\${id}，以便后端进行处理\n      entityToHTML: (entity, originalText) => {\n        if (entity.type === \'\\$mention\') {\n          return \\`\\$\\{\\${entity.data.mention._id}}\\`;\n        }\n        return originalText;\n      },\n      // 语音合成需求要求，去除所有换行，即所有无用标签 p，否则会读出标签 p\n      // https://github.com/HubSpot/draft-convert/issues/59\n      // eslint-disable-next-line consistent-return\n      blockToHTML: (data) => {\n        const { type } = data;\n        if (type === \'unstyled\') {\n          return {\n            start: \'\',\n            end: \'\',\n            // empty 属性代表所有换行都去掉，而不是转为空格\n            empty: \'\'\n          };\n        }\n      }\n    })(contentState);\n    // 语音合成需求要求，去掉所有空白字符（包含空格、制表符、换页符）和 html 标签（包含<div class=&quot;test&quot;></div>、<img />、<My-Tag></My-Tag>这几种）\n    html = html.replace(/<\\/?.+?\\/?>|\\s+/g, \'\');\n    if (typeof onChange === \'function\') {\n      onChange(html, pureText);\n    }\n    return html;\n  };\n\n  handleFocus = () => {\n    const { onFocus } = this.props;\n    if (typeof onFocus === \'function\') {\n      onFocus();\n    }\n  };\n\n  handleBlur = () => {\n    const { onBlur } = this.props;\n    if (typeof onBlur === \'function\') {\n      onBlur();\n    }\n  };\n\n  render() {\n    const { placeholder, className } = this.props;\n    const { MentionSuggestions } = this.mentionPlugin;\n    const plugins = [this.mentionPlugin];\n    return (\n      <div className={classnames(styles.editor, className)}>\n        <Editor\n          editorState={this.state.editorState}\n          onChange={this.handleChange}\n          plugins={plugins}\n          placeholder={placeholder}\n          onFocus={this.handleFocus}\n          onBlur={this.handleBlur}\n          ref={(r) => {\n            this.editor = r;\n          }}\n        />\n        <MentionSuggestions onSearchChange={this.handleSearchChange} suggestions={this.state.suggestions} />\n      </div>\n    );\n  }\n}\n\nGraphHintTextArea.propTypes = {\n  placeholder: PropTypes.string,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  hints: PropTypes.array,\n  className: PropTypes.string,\n  onFocus: PropTypes.func,\n  onBlur: PropTypes.func\n};\n\nexport default GraphHintTextArea;`, `69933605050770240000`)">\n              <div class="gatsby-code-button" title="jsx{12-13,23-30}">\n                <span class="gatsby-code-button-language">jsx{12-13,23-30}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">\'prop-types\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> EditorState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'draft-js\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> convertFromHTML<span class="token punctuation">,</span> convertToHTML <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'draft-convert\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> classnames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> Editor <span class="token keyword">from</span> <span class="token string">\'draft-js-plugins-editor\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> createMentionPlugin<span class="token punctuation">,</span> <span class="token punctuation">{</span> defaultSuggestionsFilter<span class="token punctuation">,</span> defaultTheme <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'draft-js-mention-plugin\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token string">\'draft-js-mention-plugin/lib/plugin.css\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">\'utils\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./styles.css\'</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// 为了解决 IE9 下 parseFromString(\'\', \'text/html\') 的报错</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token string">\'./DomParserPloyfill\'</span><span class="token punctuation">;</span></span>\n<span class="token keyword">class</span> <span class="token class-name">GraphHintTextArea</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-line react/prefer-stateless-function</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> theme <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token operator">...</span>defaultTheme<span class="token punctuation">,</span>\n      mention<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>mention\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> browser <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getBrowserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'msie\'</span> <span class="token operator">&amp;&amp;</span> browser<span class="token punctuation">.</span>version <span class="token operator">===</span> <span class="token string">\'9\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      theme <span class="token operator">=</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">...</span>defaultTheme<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        mention<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>mention<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        mentionSuggestions<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>mentionSuggestions</span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span></span>    <span class="token comment">// 设置 mention 标签的可变性、触发字符、样式</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>mentionPlugin <span class="token operator">=</span> <span class="token function">createMentionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      entityMutability<span class="token punctuation">:</span> <span class="token string">\'IMMUTABLE\'</span><span class="token punctuation">,</span>\n      mentionTrigger<span class="token punctuation">:</span> <span class="token string">\'$\'</span><span class="token punctuation">,</span>\n      theme\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> contentState <span class="token operator">=</span> <span class="token function">convertFromHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// 遇到 class 带有 mention 的标签进行实体的不可变转化，此时 mention 即话术变量标签是一体的</span>\n      <span class="token comment">// 删除只能整个删除，添加也将转化为普通字符</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">htmlToEntity</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">nodeName<span class="token punctuation">,</span> node<span class="token punctuation">,</span> createEntity</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeName <span class="token operator">===</span> <span class="token string">\'span\'</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">\'mention\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> name <span class="token operator">=</span> node<span class="token punctuation">.</span>innerText <span class="token operator">||</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token function">createEntity</span><span class="token punctuation">(</span><span class="token string">\'$mention\'</span><span class="token punctuation">,</span> <span class="token string">\'IMMUTABLE\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            mention<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              name<span class="token punctuation">,</span>\n              _id<span class="token punctuation">:</span> node<span class="token punctuation">.</span>id\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>\n      editorState<span class="token punctuation">:</span> EditorState<span class="token punctuation">.</span><span class="token function">createWithContent</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      suggestions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// componentDidMount = () => {</span>\n  <span class="token comment">//   this.focus();</span>\n  <span class="token comment">// }</span>\n\n  <span class="token comment">// https://github.com/facebook/draft-js/issues/1198</span>\n  <span class="token comment">// 因为此处最开始打算使用 componentWillReceiveProps，但在和 onChange 一起作用时，</span>\n  <span class="token comment">// 导致多次执行，光标跳到行首，只能采用非受控组件的方式手动调用</span>\n  <span class="token function">setEditorContent</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> contentState <span class="token operator">=</span> <span class="token function">convertFromHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">htmlToEntity</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">nodeName<span class="token punctuation">,</span> node<span class="token punctuation">,</span> createEntity</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeName <span class="token operator">===</span> <span class="token string">\'span\'</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">\'mention\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> name <span class="token operator">=</span> node<span class="token punctuation">.</span>innerText <span class="token operator">||</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token function">createEntity</span><span class="token punctuation">(</span><span class="token string">\'$mention\'</span><span class="token punctuation">,</span> <span class="token string">\'IMMUTABLE\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            mention<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              name<span class="token punctuation">,</span>\n              _id<span class="token punctuation">:</span> node<span class="token punctuation">.</span>id\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> editorState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token comment">// 这里必须用 push 方法，不然会导致编辑器提示框不能弹出</span>\n    <span class="token comment">// https://github.com/draft-js-plugins/draft-js-plugins/issues/210</span>\n    <span class="token keyword">const</span> newEditorState <span class="token operator">=</span> EditorState<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>editorState<span class="token punctuation">,</span> contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      editorState<span class="token punctuation">:</span> newEditorState\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// https://github.com/draft-js-plugins/draft-js-plugins/issues/800</span>\n  <span class="token comment">// 不能直接调用 focus，否则会造成 draft-js-mention-plugin 的失效</span>\n  <span class="token comment">// focus = () => {</span>\n  <span class="token comment">//   setTimeout(() => {</span>\n  <span class="token comment">//     this.editor.focus();</span>\n  <span class="token comment">//   }, 0);</span>\n  <span class="token comment">// }</span>\n\n  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">editorState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> contentState <span class="token operator">=</span> editorState<span class="token punctuation">.</span><span class="token function">getCurrentContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> pureText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">convertToPureText</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 暂时不能阻挡非受控组件的输入</span>\n    <span class="token comment">// const { maxLength } = this.props;</span>\n    <span class="token comment">// if (pureText.length > maxLength) {</span>\n    <span class="token comment">//   return;</span>\n    <span class="token comment">// }</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>\n      <span class="token punctuation">{</span>\n        editorState\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerChange</span><span class="token punctuation">(</span>contentState<span class="token punctuation">,</span> pureText<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleSearchChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> hints <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      suggestions<span class="token punctuation">:</span> <span class="token function">defaultSuggestionsFilter</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> hints<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 这里是转成看到标签的效果，目的是得到实际字符</span>\n  <span class="token function-variable function">convertToPureText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">contentState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> htmlToPureText <span class="token operator">=</span> <span class="token function">convertToHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">blockToHTML</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">\'unstyled\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token punctuation">{</span>\n            start<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            end<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            empty<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    htmlToPureText <span class="token operator">=</span> htmlToPureText<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;\\/?.+?\\/?>|\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> htmlToPureText<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 这里是转成要传给后端的效果</span>\n  <span class="token function-variable function">triggerChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">contentState<span class="token punctuation">,</span> pureText</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> onChange <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">convertToHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// 将遇到的实体标签转化为 ${id}，以便后端进行处理</span>\n      <span class="token function-variable function">entityToHTML</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">entity<span class="token punctuation">,</span> originalText</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>entity<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'$mention\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$\\{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entity<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mention<span class="token punctuation">.</span>_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">return</span> originalText<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// 语音合成需求要求，去除所有换行，即所有无用标签 p，否则会读出标签 p</span>\n      <span class="token comment">// https://github.com/HubSpot/draft-convert/issues/59</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">blockToHTML</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">\'unstyled\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token punctuation">{</span>\n            start<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            end<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            <span class="token comment">// empty 属性代表所有换行都去掉，而不是转为空格</span>\n            empty<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 语音合成需求要求，去掉所有空白字符（包含空格、制表符、换页符）和 html 标签（包含&lt;div class="test">&lt;/div>、&lt;img />、&lt;My-Tag>&lt;/My-Tag>这几种）</span>\n    html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;\\/?.+?\\/?>|\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onChange <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onChange</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> pureText<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> html<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleFocus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> onFocus <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFocus <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleBlur</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> onBlur <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onBlur <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> placeholder<span class="token punctuation">,</span> className <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> MentionSuggestions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mentionPlugin<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>mentionPlugin<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>styles<span class="token punctuation">.</span>editor<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>\n<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Editor</span></span>\n          <span class="token attr-name">editorState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>editorState<span class="token punctuation">}</span></span>\n          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span>\n          <span class="token attr-name">plugins</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>plugins<span class="token punctuation">}</span></span>\n          <span class="token attr-name">placeholder</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>placeholder<span class="token punctuation">}</span></span>\n          <span class="token attr-name">onFocus</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleFocus<span class="token punctuation">}</span></span>\n          <span class="token attr-name">onBlur</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleBlur<span class="token punctuation">}</span></span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>editor <span class="token operator">=</span> r<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text"></span>\n<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MentionSuggestions</span></span> <span class="token attr-name">onSearchChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSearchChange<span class="token punctuation">}</span></span> <span class="token attr-name">suggestions</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>suggestions<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>\n<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nGraphHintTextArea<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n  placeholder<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  onChange<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>\n  value<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  hints<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>array<span class="token punctuation">,</span>\n  className<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  onFocus<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>\n  onBlur<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> GraphHintTextArea<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如下：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-02-13-20-25-26-4efe2f324a5467e5b091136c313cf39f-91452.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 521px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 61.42034548944337%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABOUlEQVQoz42SS1LDMAyGcySOwe1Ys2HZy3TFY90FTV9JhySOI/kp8SfpQGlhqEbj0dj6ZP2yCyZqmqZr2+1m23ZGVUVE/7M8WUFEXdP2nTkc9r21N8NphJk5qUbRLJqy+CQu3uAJ+VKYwVXVx7Gu3xtZllq2yTGhUEwoLueO7DzdMZ5mBT/CIaYYg49qvbKPgL33+cJQK8XvtkX9DE8STzpRprcDMc8ZoifHtSGEP+F5JR9XlX1d7VYV7axujGx7hSOwfAV3g0ujjJMetF23tD40R+NsUOOk9wpHAH1zjnxpJnY+owzmrC4CDsxUV3uiYeonz40jIBcAwAnTiSNfOOfOHxCasQN5WPmn4ejitQsM9voPyG8fBSMP3lHITy/6sNS3Gpq7Dry7wYzpd+V6Xff3C757HBbP/Am1i7vfQxXTbwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 02 13 20 25 26" title="" data-src="/static/2019-02-13-20-25-26-4efe2f324a5467e5b091136c313cf39f-91452.png" data-srcset="/static/2019-02-13-20-25-26-4efe2f324a5467e5b091136c313cf39f-e8fc4.png 200w,\n/static/2019-02-13-20-25-26-4efe2f324a5467e5b091136c313cf39f-c0ace.png 400w,\n/static/2019-02-13-20-25-26-4efe2f324a5467e5b091136c313cf39f-91452.png 521w" data-sizes="(max-width: 521px) 100vw, 521px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="兼容性问题"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性问题</h2>\n<p>这里遇到两个兼容性问题，如以上代码高亮部分</p>\n<ul>\n<li>在 IE9 下 draft-js 源码里面的 <code class="language-text">parseFromString(&#39;&#39;, &#39;text/html&#39;)</code> 会报错，引入一段兼容代码如下</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4014099060353549000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*\n * DOMParser HTML extension\n * 2012-09-04\n *\n * By Eli Grey, http://eligrey.com\n * Public domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */\n\n/*! @source https://gist.github.com/1129031 */\n/* global document, DOMParser*/\n\n// eslint-disable-next-line func-names\n(function(DOMParser) {\n  // eslint-disable-next-line\n  const DOMParser_proto = DOMParser.prototype,\n    real_parseFromString = DOMParser_proto.parseFromString;\n  // Firefox/Opera/IE throw errors on unsupported types\n  try {\n    // WebKit returns null on unsupported types\n    if (new DOMParser().parseFromString(\'\', \'text/html\')) {\n      // text/html parsing is natively supported\n      return;\n    }\n    // eslint-disable-next-line no-empty\n  } catch (ex) {}\n\n  // eslint-disable-next-line func-names\n  DOMParser_proto.parseFromString = function(markup, type) {\n    if (/^\\s*text\\/html\\s*(?:;|\\$)/i.test(type)) {\n      const doc = document.implementation.createHTMLDocument(\'\');\n      if (markup.toLowerCase().indexOf(\'<!doctype\') > -1) {\n        doc.documentElement.innerHTML = markup;\n      } else {\n        doc.body.innerHTML = markup;\n      }\n      return doc;\n      // eslint-disable-next-line no-else-return\n    } else {\n      // eslint-disable-next-line prefer-rest-params\n      return real_parseFromString.apply(this, arguments);\n    }\n  };\n})(DOMParser);`, `4014099060353549000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/*\n * DOMParser HTML extension\n * 2012-09-04\n *\n * By Eli Grey, http://eligrey.com\n * Public domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */</span>\n\n<span class="token comment">/*! @source https://gist.github.com/1129031 */</span>\n<span class="token comment">/* global document, DOMParser*/</span>\n\n<span class="token comment">// eslint-disable-next-line func-names</span>\n<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">DOMParser</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-next-line</span>\n  <span class="token keyword">const</span> DOMParser_proto <span class="token operator">=</span> <span class="token class-name">DOMParser</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>\n    real_parseFromString <span class="token operator">=</span> DOMParser_proto<span class="token punctuation">.</span>parseFromString<span class="token punctuation">;</span>\n  <span class="token comment">// Firefox/Opera/IE throw errors on unsupported types</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token comment">// WebKit returns null on unsupported types</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DOMParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseFromString</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token string">\'text/html\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// text/html parsing is natively supported</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// eslint-disable-next-line no-empty</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token comment">// eslint-disable-next-line func-names</span>\n  DOMParser_proto<span class="token punctuation">.</span><span class="token function-variable function">parseFromString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">markup<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/^\\s*text\\/html\\s*(?:;|$)/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> doc <span class="token operator">=</span> document<span class="token punctuation">.</span>implementation<span class="token punctuation">.</span><span class="token function">createHTMLDocument</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>markup<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">\'&lt;!doctype\'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        doc<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> markup<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        doc<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> markup<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> doc<span class="token punctuation">;</span>\n      <span class="token comment">// eslint-disable-next-line no-else-return</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-next-line prefer-rest-params</span>\n      <span class="token keyword">return</span> <span class="token function">real_parseFromString</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DOMParser<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>IE9 下不能弹出下拉框，这里查看了源码发现了是 IE9 transfrom 属性需要兼容下 IE9，去掉 transfrom 变换或者添加 -ms 前缀</li>\n</ul>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/富文本框疑难点处理过程/index.md absPath of file >>> MarkdownRemark",timeToRead:9,frontmatter:{date:"2019-02-13 20:13:58",path:"/rich-input-question/",tags:"前端, 富文本框, contenteditable, 预研",title:"富文本框疑难点处理过程",draft:null}}],length:26,tag:"预研",pagesSum:6,page:5}}}});