webpackJsonp([0xaa38b8eea144],{1237:function(n,a){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlElEQVRIx12We2xT5xXAbcI2Vmn7o1I1uhVYRxL8tuPn9bXv0+/4/YgdOyYkkATCCEEYsqVNC2wCIYQWShmUBFh4hMAWECot0BUtlI4yAS1oKqJQXimsDBgTU8codnLO7r0uUPpJn87Rp+/8vvOdc75zr8xmZmTieI1NykU5yxOfxDncz3NUjAlyDXMjXGMhys+cG+FzGQ8VU4t7XuV8z8m+GUkrJclSqVReYJ0ZWQ8Tl2AdTPhnq9ns2QKd+crDZiHha8NsYCE21HZiXphpb3sxxTf99Tdsw51ldHqFaLOXXyzvYqOyZ0YPk5soylfouuUbvHOxh56JbiqJfi4/FnE1lxKetrGUZ954nbcdU/752ORpxWVsc6mZjPxctFtApeVtra1lmIPwTxClgeCqvGTsX/WWOEbtyTGWSoGbToOPzUHQ1QghVxOEhRniZ5U8XB4TzvTdgj1ZJdq2OOrkGhVRBnrYFum6TiK0l2fr0emMlVxcBhlnEniqDjlBuqg0CnD0MPWiDrwzhR4u+5B3x3WiLUNHJjxzZYvR8ZKTCP+Xo1JoM/nBYvSB1egHuyUIrCOBPj4LtD0KlD2K4h7SGip62aygxzaK9rHA3Aqt2vw0MRYjnyJtYaQdsXG9hgWFwgmVlXZUKUjUqmm0CgfwhA80Kgr1Wg40Sue4SuFEnZq+YjMbJ0kh0zmfemjQ0j2EJYh2a23RVOODIBvHmCsBUaoWLDoWKIsP50bTApxC5QwH1Ghp0Gk4MBk8aDLQEslooCc88VClsK+zGANI2mqLer0XFuea8PSuN+DM7o3QWyhAR7IBfj+vDbyOICS9aSjkZo8nvSlUKuxXLDUOKdN6LSl/AlRUE+vNAnD50l8XeTIEPiYEzXYG5mlNeGz7BvjPpY/g5snDcHxwE+zs7oCh1zvHCrNm48u/ML8j2muVQblBZ3t6ZY2KXKtQcDiwdk1xx9rV0BlqghEuD4fNUTy1Zwhw7Cbioxu461fdsOgFDa5pbh3zu6NifE9f+XCPlGHS5nuaFI3K8brJ4EUHES4WFiyEP2/dCPc2vYH/3NIHePcywP1LWLp3Ec4tWQa3FvbAu7294yqVA801rju5utYfiQyKDD4DnC8GWEhMafJPtBALxuHjo3+C8bufIn59DfHBFcDiDcQvzyF+/iEsbWuDadNMaDW5H7nY6Iyyh165zfLNtdUqIqLTsEJSQqBVUTD1JQPqdRT8sf9NuH7kMHy0fRg+O3EUzp96H/Zs2SBklxFKxwFmowtdTCIoPQx7oKLzl32PPTRPVSudDwQgCrUGL0+twdzsDjjSdwD2J1fh/q7N0N+1EtykB178qVY4lAahRktWkw95JrG4DAxPvHU3Wwb+rlcsHfK0WNxCoMdUCgdUaxnMBPKw7dVe2LyhDw4MboORA4NQOd2CaiUFaqWjZJGAyQGRUeubP8FqElqZspquEBeUM2zrnEQUa3R8USVcp2qGDZV6ErqXL4PfrlwFhSU9cPL4MejfshOsZq90sCg5KvHZ5MnPfa+cmFrxukRFuRZNcYqIoNngHheeFmiF11ClIDBdPwfqG9qhc1E3rF25GnrX90M204JqBfWItPrP8lTqa7vFpSw3GJ9cZjI4pW5TXaWezpKxh4Q5gEY9LwApVOtZMApxVWhd2DKvC7K5FjTUsFCj45Ah4yXaHuz1MBlgyHCb1HXISIXMTcekOJqN1h/72Mx92h5DwuwHjeChWseBQsNgJJ6H944eB5oNgaLajnaL/07E24wuKr7Cz+XuuenUsMioCxYmyHhnSPLQTYVVYVfjI46Mo80WBLMgLY4E1FhCOENBAsfHQG/0juuNPqGguU8ywXas5XNbg6783wJ8w781GtUPJc+irkap/Ufdje0JXytStnDJbA2D1Z4EKxEHsyUMRmsIdcZaNFpCYBYqwWQLPhD3Btn6t2Pe5uF0cD7Sdr/xmSab8racFaDooOvuk0wDEs40EFQGbVQGbEKXJoTPgZ3JoJGIgULvR6M1jE67rzvpae5ojC7GEJ9rfgILc7lC3NV0T6flTtjoPLK+VuD8rcD65gDtaQInPxOtzoxQRrXgD8/BdW/+YezYByfxvfdHvnxl+ZLKCDfzUMIze60Ey+brJukrqcjA1u3tBw8dfZiZuRQFaNFory/WEPUlE5kFK5WDQKRtbFPfUOnChUvFL27cwKuj/8CBHXv2iQw/k/KGuNwyCYiIkhw+sO/569eu7b1+ffR/H5z4BAcG38X1m/biyjX9ODR8GC9dHsXLV0fx5KlzePDIyFd7ht9ZJZhJrcvLhV/wMuUPljQWtC6Z+FjfuWPHlPMXLq64Onpz3d8/Pf9WX//OW2vWbITBof3n3tqya9fbh/7SvW1gZ9Xj/V1dr8kf614qIZONjBwrezi8Ty54K5d9ZzTmF+xe1LnioaD+4Nvrn4/ermif3yHp8UCDLMCky7Z+n192+/YdST9z5mPZ7t1D8ouXv6gQ4S9WTplks7mut8xZijxbKz2vvi2D39/cPyB/HC5xOm2czPvd35F8rkGCS0+I4WXV1QbJaMq06XqbNXCQJIILpH8hOic3GghZMpl62qG/Nf4PRzaQ862MzO4AAAAASUVORK5CYII=",aspectRatio:.6666666666666666,src:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png",srcSet:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-8a97b.png 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-0fdf3.png 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png 600w",srcWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp",srcSetWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-5d70e.webp 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-d1677.webp 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于每个周末放假前都要给出代码量的统计，如果是手动统计的话需要到各个开发过的项目下运行相应的脚本，太过繁琐。故写出以下第一版统计代码量的脚本</p>\n<h1 id="代码展示"><a href="#%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码展示</h1>\n<p>以下是统计 G:/project/tungee/ 目录下的代码量，其中标红部分需要修改为自己的项目路径和 git 邮箱</p>\n<h2 id="第一版"><a href="#%E7%AC%AC%E4%B8%80%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第一版</h2>\n<h3 id="按项目统计"><a href="#%E6%8C%89%E9%A1%B9%E7%9B%AE%E7%BB%9F%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>按项目统计</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53618646557261650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\nset -euo pipefail\ntrap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array(){\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  files=(\\$(to_array \\$input))\n  echo -e &quot;\\n&quot;\n  for file in \\${files[@]}\n  do\n    if [ ! -d &quot;G:/project/tungee/\\$file&quot; ]; then\n      echo -e &quot;\\$file 目录不存在。&quot;\n      continue;\n    fi\n    if [ ! -d &quot;G:/project/tungee/\\$file/.git&quot; ]; then\n      echo -e &quot;\\$file 不是git仓库。&quot;\n      continue;\n    fi\n    cd &quot;G:/project/tungee/\\$file&quot;\n    echo &quot;\\$file 代码量统计：&quot;\n    i=\\`date +%w\\`\n    while [ \\$i -ge 1 ]\n    do\n      sinceDate=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      untilDate=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      git log --author=&quot;634407147@qq.com&quot; --since=\\$sinceDate --until=\\$untilDate --pretty=tformat: --numstat | gawk \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$untilDate\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      i=\\$((\\$i-1))\n    done\n    echo -e &quot;\\n&quot;\n  done\n}`, `53618646557261650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{25,29,33,40}"\n              >\n                <span class="gatsby-code-button-language">bash{25,29,33,40}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token builtin class-name">set</span> -euo pipefail\n<span class="token builtin class-name">trap</span> <span class="token string">"echo \'error: Script failed: see failed command above\'"</span> ERR\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>"</span>\n  <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${files<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"G:/project/tungee/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n<span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"G:/project/tungee/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n<span class="gatsby-highlight-code-line">    <span class="token builtin class-name">cd</span> <span class="token string">"G:/project/tungee/<span class="token variable">$file</span>"</span></span>    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> 代码量统计："</span>\n    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +%w<span class="token variable">`</span></span>\n    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n    <span class="token keyword">do</span>\n      <span class="token assign-left variable">sinceDate</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token assign-left variable">untilDate</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n<span class="gatsby-highlight-code-line">      <span class="token function">git</span> log --author<span class="token operator">=</span><span class="token string">"634407147@qq.com"</span> --since<span class="token operator">=</span><span class="token variable">$sinceDate</span> --until<span class="token operator">=</span><span class="token variable">$untilDate</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">gawk</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "\'</span><span class="token variable">$untilDate</span><span class="token string">\' 增加行总数：%s，删除行总数：%s，总代码行：%s<span class="token entity" title="\\n">\\n</span>", add, subs, loc }\'</span></span>      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>"</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-d5813.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 443px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 68.62302483069978%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABq0lEQVQoz5WS647bIBCFiQ34khobbIPBxJf4nsSVmo227/9mnTjVatNmpXZ+IBg4o28Ogxzr0COlledrD3GEMrR39hbZGCXhN6QU4hztduh1TN3UN8MyLaYwRmlrrK1sYYtYJEpC6qB1San3WixlluZZnudxHKdCpGmWQSLPH5sgCHzfdxxnt8ULPWQf167rEkq/pvwruq5tj8e6ro3Ryzxfrz+6rqeEAAWwCCE86hGCk4RzwR3Xfe55mpqm0UXRd926rvM8T/NECX57u47TdLvd7qIkPp8v6/rdD4InMec8ihg0liQJtAqNggHAXxQKrrTW0HYYBmkKKAJj/CQGJEyw5/kg+NLVD3f+OJemrKsDIJ1PC/Cj/4r22JZl2Tb1z/f3fhhYzIDTdTGlhDEWhnsIoIUj5MFC+A5CyO9vG8exqmolFegvl8tm2ByG4Tj0y+kELh0OFReibdu+H7TRUG6rvtmulAKPYsbAK2sBwhRaR1EEE2JLawxkyogxKe9TpJSEx+A5QN3FGLswIBvYJ55/jDRLoQx8iZQSVt8PHjP3WD+m8nNm29y1vwBcbSf6ZBrDjAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 05 22 22 18 59" title="" data-src="/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-d5813.png" data-srcset="/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-bf07a.png 200w,\n/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-250cd.png 400w,\n/static/2019-05-22-22-18-59-7b23c5da6b5c37ccfc10c0e8456e4915-d5813.png 443w" data-sizes="(max-width: 443px) 100vw, 443px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>以上更新于<code class="language-text">2019-5-22 22:17:24</code></p>\n<hr>\n<h2 id="第二版"><a href="#%E7%AC%AC%E4%BA%8C%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第二版</h2>\n<h3 id="增加按日期统计和-shell-参数输入"><a href="#%E5%A2%9E%E5%8A%A0%E6%8C%89%E6%97%A5%E6%9C%9F%E7%BB%9F%E8%AE%A1%E5%92%8C-shell-%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增加按日期统计和 shell 参数输入</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39370380319470290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\nset -euo pipefail\ntrap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;date +%w&quot; # 今天是一周的第几天，可换成具体数字 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  if [ \\$# -lt 1 ]; then\n    echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n    read input\n    files=(\\$(to_array \\$input))\n  else\n    files=\\$*\n  fi\n\n  echo -e &quot;按日期统计：&quot;\n  i=\\$(\\$date_stat)\n  while [ \\$i -ge 1 ]\n  do\n    add_sum=0\n    subs_sum=0\n    loc_sum=0\n    for file in \\${files[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      eval \\$(git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n      add_sum=\\$((\\$add_sum + \\$add))\n      subs_sum=\\$((\\$subs_sum + \\$subs))\n      loc_sum=\\$((\\$loc_sum + \\$loc))\n    done\n    printf &quot;\\$until_date 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n    i=\\$((\\$i-1))\n  done\n\n  echo -e &quot;\\n按项目统计：&quot;\n  for file in \\${files[@]}\n  do\n    if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n      echo -e &quot;\\$file 目录不存在。&quot;\n      continue;\n    fi\n    if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n      echo -e &quot;\\$file 不是git仓库。&quot;\n      continue;\n    fi\n    cd &quot;\\$file_path/\\$file&quot;\n    echo &quot;\\$file 代码量统计：&quot;\n    i=\\$(\\$date_stat)\n    while [ \\$i -ge 1 ]\n    do\n      since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      i=\\$((\\$i-1))\n    done\n  done\n}`, `39370380319470290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{21-22}"\n              >\n                <span class="gatsby-code-button-language">bash{21-22}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token builtin class-name">set</span> -euo pipefail\n<span class="token builtin class-name">trap</span> <span class="token string">"echo \'error: Script failed: see failed command above\'"</span> ERR\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n<span class="gatsby-highlight-code-line">  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span></span><span class="gatsby-highlight-code-line">  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span></span>  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"date +%w"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -lt <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n    <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n    <span class="token builtin class-name">read</span> input\n    <span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token keyword">else</span>\n    <span class="token assign-left variable">files</span><span class="token operator">=</span><span class="token variable">$*</span>\n  <span class="token keyword">fi</span>\n\n  <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n  <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n  <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n    <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n    <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${files<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span>$since_date --until<span class="token operator">=</span>$until_date --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span>\n      <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n      <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n      <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$until_date</span> 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span>\n    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n  <span class="token keyword">done</span>\n\n  <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>按项目统计："</span>\n  <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${files<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n      <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n    <span class="token keyword">fi</span>\n    <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> 代码量统计："</span>\n    <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n    <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n    <span class="token keyword">do</span>\n      <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n      <span class="token function">git</span> log --author<span class="token operator">=</span><span class="token variable">$git_email</span> --since<span class="token operator">=</span><span class="token variable">$since_date</span> --until<span class="token operator">=</span><span class="token variable">$until_date</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "\'</span><span class="token variable">$until_date</span><span class="token string">\' 增加行总数：%s，删除行总数：%s，总代码行：%s<span class="token entity" title="\\n">\\n</span>", add, subs, loc }\'</span>\n      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n    <span class="token keyword">done</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-1"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-5032e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 438px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 92.46575342465754%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACrElEQVQ4y3VT13KjMBR1sClGoohmRBUSotvOTv7/3/bITrJPe2eY4SLdcgqnpq2VVnrRSZHSgLCMJUkaB3EUREFIGQuD4Ho6nT4+rNMrLMtCgjDJpKdRqaZum6oexNA0bVVVPqFRFCol67oVYojimMWsKHIpZVmWNAiI75viYRjqqsqzfBD9vu/TNI2jjhkrsuw4dq3HfdvjJCnLW9u24zjicoCVKDHFWk8YWFW1VvL5fGzbNs0zJqHX5+fnuqzrukVRVFd8nqd5WbI0o5Tatm2KcRAAlnf1fYIXQnycOY7r+1fMxyl2dhzH81xsi5m2jXfvjf8kRA8kGE4oxdcsy3zgefPx//ghbJoBu+/7oe/ux/H19YU9CSG8LEFVXdclr1zXzdJUSpUXBd6t39bDIJu6LvJCCrEsixpHXIpZ0nXd/X7M84xeYRC2bSOEkEoVRQGM6G6KlVKgschvou/2fZvnBfdfhAkUY69l3QC1bRo0EoOEZi4ocd03Zgn20fjP87luGxozxsAQYzH0S2EYxmz7AtnTNA3C0LGdj9+1DbDKhJm4rl3XcygZhsYkUjZNA0bCKI7CKE0S8Mo5xyl9rw3du7a93W4Q9tj32cQCTbDn4/mYpwlrQ7ya8+O490IAguPY35OBuWub260E28Yh2jgM2hrDHTCcHvWEXlXF9TQNUlIKU/zo3MNenIMz+GlZ1izPsbLreZT40JyZSAw/rhvHUZIkOHJ/i1+TW9h9ho33HTghHiEUUoEFJP0gPe8KwYGH88q/Xi3rhzDYC/BAct+1IExrrdTIkhR7btsKCOu6QDle8qapcQTCIDJY+Cas7wU+qUEch3EFsIVhiJn3+x0/GVLiE1Tux2EIo8H5fP5W63K5mMSyLueLa8CZB3+8Y8J95/DjK3X+lb3iLxdnWiZOBA7KAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 05 27 17 41 19" title="" data-src="/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-5032e.png" data-srcset="/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-86481.png 200w,\n/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-1ca59.png 400w,\n/static/2019-05-27-17-41-19-7891bb91d13645249dcfef1fe14463ca-5032e.png 438w" data-sizes="(max-width: 438px) 100vw, 438px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="第三版"><a href="#%E7%AC%AC%E4%B8%89%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第三版</h2>\n<h3 id="增加按分支统计的功能，去掉-shell-参数输入（暂时不支持）"><a href="#%E5%A2%9E%E5%8A%A0%E6%8C%89%E5%88%86%E6%94%AF%E7%BB%9F%E8%AE%A1%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8E%BB%E6%8E%89-shell-%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5%EF%BC%88%E6%9A%82%E6%97%B6%E4%B8%8D%E6%94%AF%E6%8C%81%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增加按分支统计的功能，去掉 shell 参数输入（暂时不支持）</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17964975040340270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\n# set -euo pipefail\n# trap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;date +%w&quot; # 今天是一周的第几天，可换成具体数字如 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  projects=(\\$(to_array \\$input))\n  echo &quot;输入分支名，以英文逗号分隔，不能有空格&quot;\n  read input\n  branches=(\\$(to_array \\$input))\n\n  for branch in \\${branches[@]}\n  do\n    exist_branch_projects=()\n    for file in \\${projects[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      git checkout \\$branch -q >/dev/null 2>&1 # 重定向错误信息，即屏蔽错误信息\n      if [ \\$? -ne 0 ]; then\n        echo -e &quot;\\n\\$file 切换分支到 \\$branch 失败，可能不存在此分支&quot;\n      else\n        exist_branch_projects+=(\\$file)\n        git pull origin \\$branch -q\n      fi\n    done\n    echo -e &quot;\\n分支 \\$branch 上的代码统计：&quot;\n    {\n      echo -e &quot;按日期统计：&quot;\n      i=\\$(\\$date_stat)\n      while [ \\$i -ge 1 ]\n      do\n        add_sum=0\n        subs_sum=0\n        loc_sum=0\n        for file in \\${exist_branch_projects[@]}\n        do\n          if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n            echo -e &quot;\\$file 目录不存在。&quot;\n            continue;\n          fi\n          if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n            echo -e &quot;\\$file 不是git仓库。&quot;\n            continue;\n          fi\n          cd &quot;\\$file_path/\\$file&quot;\n          # git checkout master\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          eval \\$(git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n          add_sum=\\$((\\$add_sum + \\$add))\n          subs_sum=\\$((\\$subs_sum + \\$subs))\n          loc_sum=\\$((\\$loc_sum + \\$loc))\n        done\n        printf &quot;\\$until_date 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n        i=\\$((\\$i-1))\n      done\n\n      echo -e &quot;按项目统计：&quot;\n      for file in \\${exist_branch_projects[@]}\n      do\n        if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n          echo -e &quot;\\$file 目录不存在。&quot;\n          continue;\n        fi\n        if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n          echo -e &quot;\\$file 不是git仓库。&quot;\n          continue;\n        fi\n        cd &quot;\\$file_path/\\$file&quot;\n        # git checkout master\n        echo &quot;\\$file 代码量统计：&quot;\n        i=\\$(\\$date_stat)\n        while [ \\$i -ge 1 ]\n        do\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n          i=\\$((\\$i-1))\n        done\n      done\n    }\n  done\n}`, `17964975040340270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token comment"># set -euo pipefail</span>\n<span class="token comment"># trap "echo \'error: Script failed: see failed command above\'" ERR</span>\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span>\n  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span>\n  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"date +%w"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字如 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入分支名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">branches</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">${branches<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token function">git</span> checkout <span class="token variable">$branch</span> -q <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token comment"># 重定向错误信息，即屏蔽错误信息</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span><span class="token variable">$file</span> 切换分支到 <span class="token variable">$branch</span> 失败，可能不存在此分支"</span>\n      <span class="token keyword">else</span>\n        <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>\n        <span class="token function">git</span> pull origin <span class="token variable">$branch</span> -q\n      <span class="token keyword">fi</span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>分支 <span class="token variable">$branch</span> 上的代码统计："</span>\n    <span class="token punctuation">{</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n      <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n      <span class="token keyword">do</span>\n        <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n        <span class="token keyword">do</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n          <span class="token comment"># git checkout master</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span>$since_date --until<span class="token operator">=</span>$until_date --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span>\n          <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n          <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n          <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n        <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$until_date</span> 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span>\n        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n      <span class="token keyword">done</span>\n\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按项目统计："</span>\n      <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n      <span class="token keyword">do</span>\n        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n          <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n          <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n        <span class="token keyword">fi</span>\n        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n          <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n          <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n        <span class="token keyword">fi</span>\n        <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n        <span class="token comment"># git checkout master</span>\n        <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$file</span> 代码量统计："</span>\n        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>$date_stat<span class="token variable">)</span></span>\n        <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span>\n        <span class="token keyword">do</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token function">git</span> log --author<span class="token operator">=</span><span class="token variable">$git_email</span> --since<span class="token operator">=</span><span class="token variable">$since_date</span> --until<span class="token operator">=</span><span class="token variable">$until_date</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "\'</span><span class="token variable">$until_date</span><span class="token string">\' 增加行总数：%s，删除行总数：%s，总代码行：%s<span class="token entity" title="\\n">\\n</span>", add, subs, loc }\'</span>\n          <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n      <span class="token keyword">done</span>\n    <span class="token punctuation">}</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-2"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-aee79.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 563px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 74.06749555950266%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABjklEQVQoz41T2ZKkIBBsbW9OARXQ9r7m/39ws3si9klnpp4qCJI8qnjELsl8llVZoIJABCY05aNkLDBVmCbB4+fq+2EcR+d99SlTGS54KWVTN4TSX8DneY7j0Pf96/UygBojpNSqbNuWcY4LQXDP/7ktyrIsiiLPC0JoGIaPP9b59XUeh3WurirnnNYar3DOCSFJkmRZxhhP0+yaf993qAYMyt9SGQMeRtBTypRSXdvCyLWcdV3neUZUrffHcXAukiSmlMJDFEVxHH9LuJb96ntnm2VZj/MAuRTSfDN3UME1mLvulnlZltY7cCJ27z0AkIrsrbVFQaQQUHQLxlX5SdtaV9c1ZxzM3jt4xiFmAUd5nl8HJlFCvAcmQADNhlEKqwAQAuP5M4p+WpJ92xprtVZ1XZVKfWAEQ3o+n+/AiiJN02vmdd2wX3A4DAOywaiM0fM8YeHegWmFRt553vZ9nqamabxz27YxLjChPM/+M6OJ7pR33cs2UG2xLdu2KqXxEDr8Fi4kfso0jUrrS+Z/BRAp/jUC8aQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 08 13 17 03 10" title="" data-src="/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-aee79.png" data-srcset="/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-b3674.png 200w,\n/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-2063d.png 400w,\n/static/2019-08-13-17-03-10-868d6a826e31d1f2d54182909111bc96-aee79.png 563w" data-sizes="(max-width: 563px) 100vw, 563px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>以上更新于<code class="language-text">2019-8-15 20:49:40</code></p>\n<hr>\n<h2 id="第四版"><a href="#%E7%AC%AC%E5%9B%9B%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第四版</h2>\n<p>第三版的统计代码的数量对不上对应的时间，把昨天写的代码统计到今天了，做以下修复</p>\n<p>同时增加星期几的优化提示</p>\n<h3 id="修复代码统计对应不上错误的时间以及添加星期几的提示"><a href="#%E4%BF%AE%E5%A4%8D%E4%BB%A3%E7%A0%81%E7%BB%9F%E8%AE%A1%E5%AF%B9%E5%BA%94%E4%B8%8D%E4%B8%8A%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%B6%E9%97%B4%E4%BB%A5%E5%8F%8A%E6%B7%BB%E5%8A%A0%E6%98%9F%E6%9C%9F%E5%87%A0%E7%9A%84%E6%8F%90%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复代码统计对应不上错误的时间以及添加星期几的提示</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52355512844494600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\n# set -euo pipefail\n# trap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;date +%w&quot; # 今天是一周的第几天，可换成具体数字如 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  # if [ \\$date_stat -eq 0 ]; then\n  #   date_stat=7\n  # fi\n\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  projects=(\\$(to_array \\$input))\n  echo &quot;输入分支名，以英文逗号分隔，不能有空格&quot;\n  read input\n  branches=(\\$(to_array \\$input))\n\n  for branch in \\${branches[@]}\n  do\n    exist_branch_projects=()\n    for file in \\${projects[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      git checkout \\$branch -q >/dev/null 2>&1 # 重定向错误信息，即屏蔽错误信息\n      if [ \\$? -eq 0 ]; then\n        exist_branch_projects+=(\\$file)\n        git pull origin \\$branch -q\n      # else\n      #   # echo -e &quot;\\n\\$file 切换分支到 \\$branch 失败，可能不存在此分支&quot;\n      fi\n    done\n    echo -e &quot;\\n分支 \\$branch 上的代码统计：&quot;\n    {\n      echo -e &quot;按日期统计：&quot;\n      # 或 i=\\$((\\$(\\$date_stat)-1))\n      # \\$((\\$a+\\$b)) 用于整数运算，相当于 \\`expr \\$a + \\$b\\`\n      # \\$() 与 \\`\\` 相当于命令替换，执行结果替换\n      i=\\`expr \\$(\\$date_stat) - 1\\`\n      while [ \\$i -ge 0 ]\n      do\n        add_sum=0\n        subs_sum=0\n        loc_sum=0\n        for file in \\${exist_branch_projects[@]}\n        do\n          if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n            echo -e &quot;\\$file 目录不存在。&quot;\n            continue;\n          fi\n          if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n            echo -e &quot;\\$file 不是git仓库。&quot;\n            continue;\n          fi\n          cd &quot;\\$file_path/\\$file&quot;\n          # git checkout \\$branch\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          since_week=\\`date -d &quot;-\\$i day&quot; +%A\\`\n          until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          eval \\$(git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n          add_sum=\\$((\\$add_sum + \\$add))\n          subs_sum=\\$((\\$subs_sum + \\$subs))\n          loc_sum=\\$((\\$loc_sum + \\$loc))\n        done\n        printf &quot;\\$since_date（\\$since_week） 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n        i=\\$((\\$i-1))\n      done\n\n      # echo -e &quot;按项目统计：&quot;\n      # for file in \\${exist_branch_projects[@]}\n      # do\n      #   if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n      #     echo -e &quot;\\$file 目录不存在。&quot;\n      #     continue;\n      #   fi\n      #   if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n      #     echo -e &quot;\\$file 不是git仓库。&quot;\n      #     continue;\n      #   fi\n      #   cd &quot;\\$file_path/\\$file&quot;\n      #   # git checkout \\$branch\n      #   echo &quot;\\$file 代码量统计：&quot;\n      #   i=\\$(\\$date_stat)\n      #   while [ \\$i -ge 1 ]\n      #   do\n      #     since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      #     until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      #     git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      #     i=\\$((\\$i-1))\n      #   done\n      # done\n    }\n  done\n}`, `52355512844494600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{61-65,83,90}"\n              >\n                <span class="gatsby-code-button-language">bash{61-65,83,90}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token comment"># set -euo pipefail</span>\n<span class="token comment"># trap "echo \'error: Script failed: see failed command above\'" ERR</span>\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span>\n  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span>\n  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"date +%w"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字如 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token comment"># if [ $date_stat -eq 0 ]; then</span>\n  <span class="token comment">#   date_stat=7</span>\n  <span class="token comment"># fi</span>\n\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入分支名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">branches</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">${branches<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token function">git</span> checkout <span class="token variable">$branch</span> -q <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token comment"># 重定向错误信息，即屏蔽错误信息</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>\n        <span class="token function">git</span> pull origin <span class="token variable">$branch</span> -q\n      <span class="token comment"># else</span>\n      <span class="token comment">#   # echo -e "\\n$file 切换分支到 $branch 失败，可能不存在此分支"</span>\n      <span class="token keyword">fi</span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>分支 <span class="token variable">$branch</span> 上的代码统计："</span>\n    <span class="token punctuation">{</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n<span class="gatsby-highlight-code-line">      <span class="token comment"># 或 i=$(($($date_stat)-1))</span></span><span class="gatsby-highlight-code-line">      <span class="token comment"># $(($a+$b)) 用于整数运算，相当于 `expr $a + $b`</span></span><span class="gatsby-highlight-code-line">      <span class="token comment"># $() 与 `` 相当于命令替换，执行结果替换</span></span><span class="gatsby-highlight-code-line">      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">expr</span> <span class="token punctuation">$(</span>$date_stat<span class="token punctuation">)</span> - <span class="token number">1</span><span class="token variable">`</span></span></span><span class="gatsby-highlight-code-line">      <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">0</span> <span class="token punctuation">]</span></span>      <span class="token keyword">do</span>\n        <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n        <span class="token keyword">do</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n          <span class="token comment"># git checkout $branch</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n<span class="gatsby-highlight-code-line">          <span class="token assign-left variable">since_week</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%A<span class="token variable">`</span></span></span>          <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n          <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span>$since_date --until<span class="token operator">=</span>$until_date --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span>\n          <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n          <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n          <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n<span class="gatsby-highlight-code-line">        <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$since_date</span>（<span class="token variable">$since_week</span>） 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span></span>        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n      <span class="token keyword">done</span>\n\n      <span class="token comment"># echo -e "按项目统计："</span>\n      <span class="token comment"># for file in ${exist_branch_projects[@]}</span>\n      <span class="token comment"># do</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file" ]; then</span>\n      <span class="token comment">#     echo -e "$file 目录不存在。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file/.git" ]; then</span>\n      <span class="token comment">#     echo -e "$file 不是git仓库。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   cd "$file_path/$file"</span>\n      <span class="token comment">#   # git checkout $branch</span>\n      <span class="token comment">#   echo "$file 代码量统计："</span>\n      <span class="token comment">#   i=$($date_stat)</span>\n      <span class="token comment">#   while [ $i -ge 1 ]</span>\n      <span class="token comment">#   do</span>\n      <span class="token comment">#     since_date=`date -d "-$i day" +%Y-%m-%d`</span>\n      <span class="token comment">#     until_date=`date -d "-$(($i-1)) day" +%Y-%m-%d`</span>\n      <span class="token comment">#     git log --author=$git_email --since=$since_date --until=$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += $1 ; subs += $2 ; loc += $1 - $2 } END { printf "\'$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n", add, subs, loc }\'</span>\n      <span class="token comment">#     i=$(($i-1))</span>\n      <span class="token comment">#   done</span>\n      <span class="token comment"># done</span>\n    <span class="token punctuation">}</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-3"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-72de5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 648px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 65.74074074074075%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABh0lEQVQoz4WS23KjMBBEuScYvAJJgC6AJSQRA/H//17azlO8rvI8gKpET8+cJjrJE5lJycuYJOSjYQn7R1LK8iRNorflrXPGaantbC7m0vC264ZRT5+f5Xtx33eUUd7xfui10nVV53l+Kss0Td+LRz1O03y+V900TZZncRzFcZwkSfqoOIpwzrIs+b+d90FKta6rc34Y+hDCsiyMsa9HMcrQ21pLCCmK/Fm8hqD1eBzHsjit1b7v0A+DOPb9dvvWuBsnYwzemOtUVX/Ezjk4b9t23bZxHK/XK8Sc8+A9xPM8MZydsxgHGeR/zcUgCGkgw3iM0mma4AUTyGCIaTnvlFJ1XT8rUVIIpRW+xnVVVXhSys71GbziR4EZgL2mjSWNseudkxNCgBYMKaVAaB6cMAvGKj6KV1GNE2Pcez/PFzEMv7Qh3rc7uaZp0Wue56J4JQYYrLSB0/qllEQ8i3OI6vZ9wLxtW2sN2r3+4ayxUsgQPHykFOj1mzP4hzVQhpxH5AwW2P9J+wMBHDBe9cJk8AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 03 07 12 12 03" title="" data-src="/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-72de5.png" data-srcset="/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-bb436.png 200w,\n/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-c5634.png 400w,\n/static/2020-03-07-12-12-03-992b721bfa4f855f5abde72b8584f70d-72de5.png 648w" data-sizes="(max-width: 648px) 100vw, 648px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>以上更新于<code class="language-text">2020-3-7 11:57:55</code></p>\n<hr>\n<h2 id="第五版"><a href="#%E7%AC%AC%E4%BA%94%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>第五版</h2>\n<p>第四版的代码统计今天的代码有 2 个问题：</p>\n<ol>\n<li>当 i 循环到 0 时，<code class="language-text">-$(($i-1))</code> 这一行代码有问题，统计到的 <code class="language-text">until_date</code> 比 <code class="language-text">since_date</code> 反而早了一天，造成脚本统计错误</li>\n<li>统计今天的代码时，只传年月日会默认带上当前时分秒的时间导致统计不上，即还要加上时分秒，否则不能统计到今天的代码</li>\n</ol>\n<h3 id="修复统计今天代码"><a href="#%E4%BF%AE%E5%A4%8D%E7%BB%9F%E8%AE%A1%E4%BB%8A%E5%A4%A9%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复统计今天代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67104361245635570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/bin/sh\n# 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入\n# 能够检测一些错误，并在错误发生时中断程序并输出信息\n# 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。\n# set -euo pipefail\n# trap &quot;echo \'error: Script failed: see failed command above\'&quot; ERR\n# {} 防止下载不完全代码被执行\n{\n  function to_array() {\n    x=\\$1\n    OLD_IFS=&quot;\\$IFS&quot;\n    IFS=&quot;,&quot;\n    array=(\\$x)\n    IFS=&quot;\\$OLD_IFS&quot;\n    for each in \\${array[*]}\n    do\n    echo \\$each\n    done\n  }\n\n  file_path=&quot;G:/project/tungee&quot;\n  git_email=&quot;634407147@qq.com&quot;\n  date_stat=&quot;echo 9&quot; # 今天是一周的第几天，可换成具体数字如 date_stat=&quot;echo 5&quot; 以实现统计几天前代码的功能\n\n  # if [ \\$date_stat -eq 0 ]; then\n  #   date_stat=7\n  # fi\n\n  echo &quot;输入项目名，以英文逗号分隔，不能有空格&quot;\n  read input\n  projects=(\\$(to_array \\$input))\n  echo &quot;输入分支名，以英文逗号分隔，不能有空格&quot;\n  read input\n  branches=(\\$(to_array \\$input))\n\n  for branch in \\${branches[@]}\n  do\n    exist_branch_projects=()\n    for file in \\${projects[@]}\n    do\n      if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n        echo -e &quot;\\$file 目录不存在。&quot;\n        continue;\n      fi\n      if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n        echo -e &quot;\\$file 不是git仓库。&quot;\n        continue;\n      fi\n      cd &quot;\\$file_path/\\$file&quot;\n      git checkout \\$branch -q >/dev/null 2>&1 # 重定向错误信息，即屏蔽错误信息\n      if [ \\$? -eq 0 ]; then\n        exist_branch_projects+=(\\$file)\n        # git pull origin \\$branch -q\n      # else\n      #   # echo -e &quot;\\n\\$file 切换分支到 \\$branch 失败，可能不存在此分支&quot;\n      fi\n    done\n    echo -e &quot;\\n分支 \\$branch 上的代码统计：&quot;\n    {\n      echo -e &quot;按日期统计：&quot;\n      # 或 i=\\$((\\$(\\$date_stat)-1))\n      # \\$((\\$a+\\$b)) 用于整数运算，相当于 \\`expr \\$a + \\$b\\`\n      # \\$() 与 \\`\\` 相当于命令替换，执行结果替换\n      i=\\`expr \\$(\\$date_stat) - 1\\`\n      while [ \\$i -ge 0 ]\n      do\n        add_sum=0\n        subs_sum=0\n        loc_sum=0\n        for file in \\${exist_branch_projects[@]}\n        do\n          if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n            echo -e &quot;\\$file 目录不存在。&quot;\n            continue;\n          fi\n          if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n            echo -e &quot;\\$file 不是git仓库。&quot;\n            continue;\n          fi\n          cd &quot;\\$file_path/\\$file&quot;\n          # git checkout \\$branch\n          since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n          if [ \\$i -ge 1 ]; then\n            until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n          else\n            until_date=\\`date -d &quot;+\\$((0-\\$i+1)) day&quot; +%Y-%m-%d\\`\n          fi\n          eval \\$(git log --author=\\$git_email --since=&quot;\\$since_date 00:00:00&quot; --until=&quot;\\$until_date 00:00:00&quot; --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;add=%s; subs=%s; loc=%s;&quot;, add, subs, loc }\')\n          add_sum=\\$((\\$add_sum + \\$add))\n          subs_sum=\\$((\\$subs_sum + \\$subs))\n          loc_sum=\\$((\\$loc_sum + \\$loc))\n        done\n        since_week=\\`date -d &quot;-\\$i day&quot; +%A\\`\n        printf &quot;\\$since_date（\\$since_week） 增加行总数：\\$add_sum，删除行总数：\\$subs_sum，总代码行：\\$loc_sum\\n&quot;\n        i=\\$((\\$i-1))\n      done\n\n      # echo -e &quot;按项目统计：&quot;\n      # for file in \\${exist_branch_projects[@]}\n      # do\n      #   if [ ! -d &quot;\\$file_path/\\$file&quot; ]; then\n      #     echo -e &quot;\\$file 目录不存在。&quot;\n      #     continue;\n      #   fi\n      #   if [ ! -d &quot;\\$file_path/\\$file/.git&quot; ]; then\n      #     echo -e &quot;\\$file 不是git仓库。&quot;\n      #     continue;\n      #   fi\n      #   cd &quot;\\$file_path/\\$file&quot;\n      #   # git checkout \\$branch\n      #   echo &quot;\\$file 代码量统计：&quot;\n      #   i=\\$(\\$date_stat)\n      #   while [ \\$i -ge 1 ]\n      #   do\n      #     since_date=\\`date -d &quot;-\\$i day&quot; +%Y-%m-%d\\`\n      #     until_date=\\`date -d &quot;-\\$((\\$i-1)) day&quot; +%Y-%m-%d\\`\n      #     git log --author=\\$git_email --since=\\$since_date --until=\\$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += \\$1 ; subs += \\$2 ; loc += \\$1 - \\$2 } END { printf &quot;\'\\$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n&quot;, add, subs, loc }\'\n      #     i=\\$((\\$i-1))\n      #   done\n      # done\n    }\n  done\n}`, `67104361245635570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash{83-88}"\n              >\n                <span class="gatsby-code-button-language">bash{83-88}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\n<span class="token comment"># 周一到今天的代码量统计，使用方式：./git.bash mockingbird robin koala 或 执行 ./git.bash 后自行输入</span>\n<span class="token comment"># 能够检测一些错误，并在错误发生时中断程序并输出信息</span>\n<span class="token comment"># 使用 set -e 令脚本在发生错误时退出而不是继续运行；使用 set -u 来检查是否使用了未赋值的变量；试试 set -o pipefail，它可以监测管道中的错误。</span>\n<span class="token comment"># set -euo pipefail</span>\n<span class="token comment"># trap "echo \'error: Script failed: see failed command above\'" ERR</span>\n<span class="token comment"># {} 防止下载不完全代码被执行</span>\n<span class="token punctuation">{</span>\n  <span class="token keyword">function</span> <span class="token function-name function">to_array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token assign-left variable">x</span><span class="token operator">=</span><span class="token variable">$1</span>\n    <span class="token assign-left variable">OLD_IFS</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$IFS</span>"</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">","</span>\n    <span class="token assign-left variable">array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span>\n    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">$OLD_IFS</span>"</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">each</span> <span class="token keyword">in</span> <span class="token variable">${array<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n    <span class="token builtin class-name">echo</span> <span class="token variable">$each</span>\n    <span class="token keyword">done</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token assign-left variable">file_path</span><span class="token operator">=</span><span class="token string">"G:/project/tungee"</span>\n  <span class="token assign-left variable">git_email</span><span class="token operator">=</span><span class="token string">"634407147@qq.com"</span>\n  <span class="token assign-left variable">date_stat</span><span class="token operator">=</span><span class="token string">"echo 9"</span> <span class="token comment"># 今天是一周的第几天，可换成具体数字如 date_stat="echo 5" 以实现统计几天前代码的功能</span>\n\n  <span class="token comment"># if [ $date_stat -eq 0 ]; then</span>\n  <span class="token comment">#   date_stat=7</span>\n  <span class="token comment"># fi</span>\n\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入项目名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n  <span class="token builtin class-name">echo</span> <span class="token string">"输入分支名，以英文逗号分隔，不能有空格"</span>\n  <span class="token builtin class-name">read</span> input\n  <span class="token assign-left variable">branches</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span>to_array $input<span class="token variable">)</span></span><span class="token punctuation">)</span>\n\n  <span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable">${branches<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n  <span class="token keyword">do</span>\n    <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n    <span class="token keyword">do</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n        <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n      <span class="token keyword">fi</span>\n      <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n      <span class="token function">git</span> checkout <span class="token variable">$branch</span> -q <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token comment"># 重定向错误信息，即屏蔽错误信息</span>\n      <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n        <span class="token assign-left variable">exist_branch_projects</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span>\n        <span class="token comment"># git pull origin $branch -q</span>\n      <span class="token comment"># else</span>\n      <span class="token comment">#   # echo -e "\\n$file 切换分支到 $branch 失败，可能不存在此分支"</span>\n      <span class="token keyword">fi</span>\n    <span class="token keyword">done</span>\n    <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token entity" title="\\n">\\n</span>分支 <span class="token variable">$branch</span> 上的代码统计："</span>\n    <span class="token punctuation">{</span>\n      <span class="token builtin class-name">echo</span> -e <span class="token string">"按日期统计："</span>\n      <span class="token comment"># 或 i=$(($($date_stat)-1))</span>\n      <span class="token comment"># $(($a+$b)) 用于整数运算，相当于 `expr $a + $b`</span>\n      <span class="token comment"># $() 与 `` 相当于命令替换，执行结果替换</span>\n      <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">expr</span> <span class="token punctuation">$(</span>$date_stat<span class="token punctuation">)</span> - <span class="token number">1</span><span class="token variable">`</span></span>\n      <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">0</span> <span class="token punctuation">]</span>\n      <span class="token keyword">do</span>\n        <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token number">0</span>\n        <span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable">${exist_branch_projects<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>\n        <span class="token keyword">do</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 目录不存在。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>/.git"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>\n            <span class="token builtin class-name">echo</span> -e <span class="token string">"<span class="token variable">$file</span> 不是git仓库。"</span>\n            <span class="token builtin class-name">continue</span><span class="token punctuation">;</span>\n          <span class="token keyword">fi</span>\n          <span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$file_path</span>/<span class="token variable">$file</span>"</span>\n          <span class="token comment"># git checkout $branch</span>\n          <span class="token assign-left variable">since_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span>\n<span class="gatsby-highlight-code-line">          <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> -ge <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span><span class="gatsby-highlight-code-line">            <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span></span><span class="gatsby-highlight-code-line">          <span class="token keyword">else</span></span><span class="gatsby-highlight-code-line">            <span class="token assign-left variable">until_date</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"+<span class="token variable"><span class="token variable">$((</span><span class="token number">0</span><span class="token operator">-</span>$i<span class="token operator">+</span><span class="token number">1</span><span class="token variable">))</span></span> day"</span> +%Y-%m-%d<span class="token variable">`</span></span></span><span class="gatsby-highlight-code-line">          <span class="token keyword">fi</span></span><span class="gatsby-highlight-code-line">          <span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> log --author<span class="token operator">=</span>$git_email --since<span class="token operator">=</span><span class="token string">"<span class="token variable">$since_date</span> 00:00:00"</span> --until<span class="token operator">=</span><span class="token string">"<span class="token variable">$until_date</span> 00:00:00"</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">awk</span> -v <span class="token assign-left variable">add</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">subs</span><span class="token operator">=</span><span class="token number">0</span> -v <span class="token assign-left variable">loc</span><span class="token operator">=</span><span class="token number">0</span> <span class="token string">\'{ add += <span class="token variable">$1</span> ; subs += <span class="token variable">$2</span> ; loc += <span class="token variable">$1</span> - <span class="token variable">$2</span> } END { printf "add=%s; subs=%s; loc=%s;", add, subs, loc }\'</span><span class="token variable">)</span></span></span>          <span class="token assign-left variable">add_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$add_sum <span class="token operator">+</span> $add<span class="token variable">))</span></span>\n          <span class="token assign-left variable">subs_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$subs_sum <span class="token operator">+</span> $subs<span class="token variable">))</span></span>\n          <span class="token assign-left variable">loc_sum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$loc_sum <span class="token operator">+</span> $loc<span class="token variable">))</span></span>\n        <span class="token keyword">done</span>\n        <span class="token assign-left variable">since_week</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> -d <span class="token string">"-<span class="token variable">$i</span> day"</span> +%A<span class="token variable">`</span></span>\n        <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">$since_date</span>（<span class="token variable">$since_week</span>） 增加行总数：<span class="token variable">$add_sum</span>，删除行总数：<span class="token variable">$subs_sum</span>，总代码行：<span class="token variable">$loc_sum</span><span class="token entity" title="\\n">\\n</span>"</span>\n        <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>$i<span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>\n      <span class="token keyword">done</span>\n\n      <span class="token comment"># echo -e "按项目统计："</span>\n      <span class="token comment"># for file in ${exist_branch_projects[@]}</span>\n      <span class="token comment"># do</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file" ]; then</span>\n      <span class="token comment">#     echo -e "$file 目录不存在。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   if [ ! -d "$file_path/$file/.git" ]; then</span>\n      <span class="token comment">#     echo -e "$file 不是git仓库。"</span>\n      <span class="token comment">#     continue;</span>\n      <span class="token comment">#   fi</span>\n      <span class="token comment">#   cd "$file_path/$file"</span>\n      <span class="token comment">#   # git checkout $branch</span>\n      <span class="token comment">#   echo "$file 代码量统计："</span>\n      <span class="token comment">#   i=$($date_stat)</span>\n      <span class="token comment">#   while [ $i -ge 1 ]</span>\n      <span class="token comment">#   do</span>\n      <span class="token comment">#     since_date=`date -d "-$i day" +%Y-%m-%d`</span>\n      <span class="token comment">#     until_date=`date -d "-$(($i-1)) day" +%Y-%m-%d`</span>\n      <span class="token comment">#     git log --author=$git_email --since=$since_date --until=$until_date --pretty=tformat: --numstat | awk -v add=0 -v subs=0 -v loc=0 \'{ add += $1 ; subs += $2 ; loc += $1 - $2 } END { printf "\'$until_date\' 增加行总数：%s，删除行总数：%s，总代码行：%s\\n", add, subs, loc }\'</span>\n      <span class="token comment">#     i=$(($i-1))</span>\n      <span class="token comment">#   done</span>\n      <span class="token comment"># done</span>\n    <span class="token punctuation">}</span>\n  <span class="token keyword">done</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行效果-4"><a href="#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行效果</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-ad786.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 457px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.57986870897156%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABpElEQVQoz3VSyXabMBQVpWDAgIQkQELMYAgeyDlOnEVynO78/5/UW9plfVcCvXcnILayd+0uaANP+0QQwgm3hCFm7/hcEiHIziNP0ded0WXbtIwykXCRCJnJOKF+EEgcc8VY8nT5dDxy8Qeet0vTVKZpURgpZRiGWquyrHD1dDnLMs55oXWaZVoXZWl0UYRhZNs26DzPc10XY5Zl/Z23NvxbljAnZVEUcUzZhjiKKKW+H/i+xygFO6Xs/8rT4TCOY1NXYRzDZxSG+/0eVinINgpkQWwQw4LrOHEM8uin4/ywbTIO4zAMW7zy8XjkCgdz+/g4n0/9MERxvF4u58vler0qrYXgy7LgBewgEWnqGlFhHs5vt3eooTVM9F1bGIPa+r4DO9yhyygK67oeh55z4TgulA+4M8ZUZfX96xtSpTHXt/fl5aXrOnBBB1zrumZZzhid53lZjqgG6UjTNFhDZ0qpr6/PJEnyPIfPcRzKst6U+2mDUhqFtE0zTTM+kOf7BL9HVVVoBeL3+11tWF9fp+nQNC3qmTccTycsJ4yhITwmnKO+32/nM82XjX3jAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 04 24 12 11 28" title="" data-src="/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-ad786.png" data-srcset="/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-aaeb0.png 200w,\n/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-4d187.png 400w,\n/static/2020-04-24-12-11-28-d32fe7d1d01c539a83e8fbfe26b04194-ad786.png 457w" data-sizes="(max-width: 457px) 100vw, 457px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>',
excerpt:"需求背景 由于每个周末放假前都要给出代码量的统计，如果是手动统计的话需要到各个开发过的项目下运行相应的脚本，太过繁琐。故写出以下第一版统计代码量的脚本 代码展示 以下是统计 G:/project/tungee/ 目录下的代码量，其中标红部分需要修改为自己的项目路径和 git…",timeToRead:11,tableOfContents:'<ul>\n<li><a href="/git-code-statistics-script/#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF">需求背景</a></li>\n<li>\n<p><a href="/git-code-statistics-script/#%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BA">代码展示</a></p>\n<ul>\n<li>\n<p><a href="/git-code-statistics-script/#%E7%AC%AC%E4%B8%80%E7%89%88">第一版</a></p>\n<ul>\n<li><a href="/git-code-statistics-script/#%E6%8C%89%E9%A1%B9%E7%9B%AE%E7%BB%9F%E8%AE%A1">按项目统计</a></li>\n<li><a href="/git-code-statistics-script/#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C">运行效果</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/git-code-statistics-script/#%E7%AC%AC%E4%BA%8C%E7%89%88">第二版</a></p>\n<ul>\n<li><a href="/git-code-statistics-script/#%E5%A2%9E%E5%8A%A0%E6%8C%89%E6%97%A5%E6%9C%9F%E7%BB%9F%E8%AE%A1%E5%92%8C-shell-%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5">增加按日期统计和 shell 参数输入</a></li>\n<li><a href="/git-code-statistics-script/#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-1">运行效果</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/git-code-statistics-script/#%E7%AC%AC%E4%B8%89%E7%89%88">第三版</a></p>\n<ul>\n<li><a href="/git-code-statistics-script/#%E5%A2%9E%E5%8A%A0%E6%8C%89%E5%88%86%E6%94%AF%E7%BB%9F%E8%AE%A1%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8E%BB%E6%8E%89-shell-%E5%8F%82%E6%95%B0%E8%BE%93%E5%85%A5%EF%BC%88%E6%9A%82%E6%97%B6%E4%B8%8D%E6%94%AF%E6%8C%81%EF%BC%89">增加按分支统计的功能，去掉 shell 参数输入（暂时不支持）</a></li>\n<li><a href="/git-code-statistics-script/#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-2">运行效果</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/git-code-statistics-script/#%E7%AC%AC%E5%9B%9B%E7%89%88">第四版</a></p>\n<ul>\n<li><a href="/git-code-statistics-script/#%E4%BF%AE%E5%A4%8D%E4%BB%A3%E7%A0%81%E7%BB%9F%E8%AE%A1%E5%AF%B9%E5%BA%94%E4%B8%8D%E4%B8%8A%E9%94%99%E8%AF%AF%E7%9A%84%E6%97%B6%E9%97%B4%E4%BB%A5%E5%8F%8A%E6%B7%BB%E5%8A%A0%E6%98%9F%E6%9C%9F%E5%87%A0%E7%9A%84%E6%8F%90%E7%A4%BA">修复代码统计对应不上错误的时间以及添加星期几的提示</a></li>\n<li><a href="/git-code-statistics-script/#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-3">运行效果</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/git-code-statistics-script/#%E7%AC%AC%E4%BA%94%E7%89%88">第五版</a></p>\n<ul>\n<li><a href="/git-code-statistics-script/#%E4%BF%AE%E5%A4%8D%E7%BB%9F%E8%AE%A1%E4%BB%8A%E5%A4%A9%E4%BB%A3%E7%A0%81">修复统计今天代码</a></li>\n<li><a href="/git-code-statistics-script/#%E8%BF%90%E8%A1%8C%E6%95%88%E6%9E%9C-4">运行效果</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>',wordCount:{words:73},frontmatter:{date:"2020-04-24 11:17:09",path:"/git-code-statistics-script/",tags:"Git, git 代码统计, 预研",title:"git代码统计脚本",draft:null,catalog_number:null}},nextPost:{html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>如下图所示，由于多个产品共存，当初设计产品架构时，侧边栏、打电话组件是存在于每个项目的子模块中的。迫于产品越来越多，需要动到侧边栏的时候越来越频繁，随着产品的不断增加导致了需要编译每个项目的工作越来越重，急需一种新的架构来分离侧边栏与各自产品端。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-04-01-11-05-14-5b7b03e10126de2c72c19892be04c611-8b0e1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 294px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 117.68707482993197%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsSAAALEgHS3X78AAADMklEQVQ4y5WUzU8TQRTAB7iYKDGoCSQgIhDCh6CAhZYvCRAEQQOBk5h40It4IgQvCh5Q/xkNfhCUKgWLaPBYDxhavtpC+r3tbtvd2Z3ZHd92MZGvpL68THZm9vfem/feDCoz3TB13i6ua12wf2eMUUpZ2oLGJ1/8XneNPZuetdqwmNza1GVjY2MHxO0OBAKapp0ITzx/ubG5M/Z0enbeRmS8tbUFFPCABoMhjotomnoiXFLXUmXpLKy2WJdWYK5Q1XAEI0AwgZV/FRN9pKquqPhaU2lda0Gl6c38sqCy3Sje44k7Srwx4hN09QvUUJ9Ag3HqDBM3R1RKsUKR5ebg/dHx5p6h15++8oz98FJXlNm9zLrN4CMisZC4r0GRcRJzRjQvr4dFFAVVN3ffufugpqV7xrqMGfPwNCgxUL/IwhLjsA4YCoZimO3ENF9cA1aWMSq62lRwpTGv/LptWS8VIQqlRJIk2CNUT4B2UGGJUA3+0eH69r6BkYe17b2fl5YBDgaDfCzmXHdCzv0Bv6IohzIMldNUjRKoDEYtt4ZHn0zByedt9nSaRGf/FgRdrjFXNbblV9Qv2L/BgiiKGGNBEOIggnDUFsBJESclOSFilJWZlXnqLEJobm4O9tzQVX7/L4dj3elcW1tLJBKHYHDLxRIJUcKygjJyijLL+9Dp/Nl3M+mEDXCUT+hNQglCZ3IzLlSgrOwP79/CHs/zkOpoNCqk5KitlOc4pD0Wi6KcvIJzeQXZ53OtCzY9bI8nHA67XK7t7W2v13s024ZnkjKKatv77z0ab+odti7a/yNsaG9CkKV74PHEpKmj34AjkYiYFDmOg8hDoZAsyyfBBOCSutYKc0dhtXkx1WG7u3uAQcBwkyHzULkTwlah3qjM1N7QdedSjcVmX0kzbI6PQ5tAI6LmnsGJqVddgyMfvyzCXqqrZWgQ8Hk02zBVVdXwDN+oytLVPTRSae5cSHmGJIdDYRh9Pp/H4zl0ZrBICN0/M1zJ4toWOHZ+VYNxq9LMNtEjoAiekdL6tovVZgOGNagtBJxMJrEkwfR4mFDjDTsAg0Cef66uOhwOeAahHsfCSSxjhfwBPCrGF6a/cTQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 04 01 11 05 14" title="" data-src="/static/2020-04-01-11-05-14-5b7b03e10126de2c72c19892be04c611-8b0e1.png" data-srcset="/static/2020-04-01-11-05-14-5b7b03e10126de2c72c19892be04c611-2d2ea.png 200w,\n/static/2020-04-01-11-05-14-5b7b03e10126de2c72c19892be04c611-8b0e1.png 294w" data-sizes="(max-width: 294px) 100vw, 294px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="技术方案"><a href="#%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术方案</h1>\n<p>基本原理类似于之前的文章 <a href="/components-pack-as-library/">记一次组件打包为链接的实践</a>，也就是主框架也就是侧边栏项目提前设定好元素的位置，再用 ReactDOM.render 方法去渲染结点，当然还有许多其他要注意的地方，比如链接的缓存规则、路由之间的跳转、子框架应用间的通信、样式和脚本的隔离等等。</p>\n<p>参考市面上已有的解决的方案，发现比较符合微前端框架的适用场景，于是开始用以下微前端框架来做出一个 demo 级别的应用</p>\n<ol>\n<li><a href="https://github.com/ice-lab/icestark" target="_blank" rel="nofollow noreferrer noopener">ice-stark</a></li>\n<li><a href="https://github.com/single-spa/single-spa" target="_blank" rel="nofollow noreferrer noopener">single-spa</a></li>\n<li><a href="https://github.com/umijs/qiankun" target="_blank" rel="nofollow noreferrer noopener">qiankun</a></li>\n</ol>\n<h1 id="具体实施"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E6%96%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实施</h1>\n<h2 id="ice-stark"><a href="#ice-stark" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ice-stark</h2>\n<h3 id="主框架"><a href="#%E4%B8%BB%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主框架</h3>\n<p>以路径作为识别子应用的方式，子应用需要配置 publicPath，否则访问不到</p>\n<p>这里假设产品 1 是采用了旧框架的子应用，产品 2 采用了新的</p>\n<p>以下是在 ice/stark 1.4.1 的版本上开始做的，需要添加代码如下：</p>\n<p>src\\platform\\layout\\index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13418865157760162000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { AppRouter, AppRoute } from \'@ice/stark\';\n<AppRouter\n  NotFoundComponent={<div>未找到</div>}\n  LoadingComponent={<div>加载中</div>}\n  onRouteChange={this.handleRouteChange}\n>\n  <AppRoute path=\'/product1\' basename=\'/product1\' title=\'产品1\' entry=\'产品1的域名/index.html\' />\n  <AppRoute path=\'/product2\' basename=\'/product2\' title=\'产品2\' entry=\'产品2的域名/index.html\' />\n</AppRouter>;`, `13418865157760162000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> AppRouter<span class="token punctuation">,</span> AppRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ice/stark\'</span><span class="token punctuation">;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppRouter</span></span>\n  <span class="token attr-name">NotFoundComponent</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">未找到</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span></span>\n  <span class="token attr-name">LoadingComponent</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">加载中</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span></span>\n  <span class="token attr-name">onRouteChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleRouteChange<span class="token punctuation">}</span></span>\n<span class="token punctuation">></span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppRoute</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/product1<span class="token punctuation">\'</span></span> <span class="token attr-name">basename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/product1<span class="token punctuation">\'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品1<span class="token punctuation">\'</span></span> <span class="token attr-name">entry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品1的域名/index.html<span class="token punctuation">\'</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppRoute</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/product2<span class="token punctuation">\'</span></span> <span class="token attr-name">basename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/product2<span class="token punctuation">\'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品2<span class="token punctuation">\'</span></span> <span class="token attr-name">entry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品2的域名/index.html<span class="token punctuation">\'</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AppRouter</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结合公司实际的应用场景，不同产品对应着不同的域名，这就不能用路径的方式来识别子应用的加载，需要作出如下改动</p>\n<p>当然对应的子应用就不需要路径别名的配置了，这样实现的缺点是 onRouteChange 这个函数不再起作用，而且不能控制子应用的缓存，这些不同域名的缓存全部交给对应的 nginx 来做了</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53897725570808430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { AppRouter, AppRoute } from \'@ice/stark\';\n<AppRouter\n  NotFoundComponent={<div>未找到</div>}\n  LoadingComponent={<div>加载中</div>}\n  onRouteChange={this.handleRouteChange}\n>\n  {产品1的域名 ? <AppRoute path=\'/\' basename=\'/\' title=\'产品1\' entry=\'产品1的域名/index.html\' /> : null}\n\n  {产品2的域名 ? <AppRoute path=\'/\' basename=\'/\' title=\'产品2\' entry=\'产品2的域名/index.html\' /> : null}\n</AppRouter>;`, `53897725570808430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx"\n              >\n                <span class="gatsby-code-button-language">jsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> AppRouter<span class="token punctuation">,</span> AppRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ice/stark\'</span><span class="token punctuation">;</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppRouter</span></span>\n  <span class="token attr-name">NotFoundComponent</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">未找到</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span></span>\n  <span class="token attr-name">LoadingComponent</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">加载中</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span></span>\n  <span class="token attr-name">onRouteChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleRouteChange<span class="token punctuation">}</span></span>\n<span class="token punctuation">></span></span><span class="token plain-text">\n  </span><span class="token punctuation">{</span>产品<span class="token number">1</span>的域名 <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppRoute</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/<span class="token punctuation">\'</span></span> <span class="token attr-name">basename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/<span class="token punctuation">\'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品1<span class="token punctuation">\'</span></span> <span class="token attr-name">entry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品1的域名/index.html<span class="token punctuation">\'</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">\n\n  </span><span class="token punctuation">{</span>产品<span class="token number">2</span>的域名 <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AppRoute</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/<span class="token punctuation">\'</span></span> <span class="token attr-name">basename</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>/<span class="token punctuation">\'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品2<span class="token punctuation">\'</span></span> <span class="token attr-name">entry</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>产品2的域名/index.html<span class="token punctuation">\'</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token plain-text">\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AppRouter</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="子框架"><a href="#%E5%AD%90%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>子框架</h3>\n<h4 id="老项目"><a href="#%E8%80%81%E9%A1%B9%E7%9B%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>老项目</h4>\n<p>老项目采用了 react-router 3.2.1，区别于新项目</p>\n<p>以下是在 ice/stark-app 1.2.0 的版本上开始做的，需要添加代码如下：</p>\n<h5 id="入口文件"><a href="#%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>入口文件</h5>\n<p>app\\app.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69908626737846370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { applyRouterMiddleware, Router, browserHistory, useRouterHistory } from \'react-router\';\nimport { createHistory } from \'history\';\nimport { isInIcestark, getMountNode, registerAppEnter, registerAppLeave, getBasename } from \'@ice/stark-app\';\n\nconst baseHistory = useRouterHistory(createHistory)({\n  basename: getBasename()\n});\n\nconst isIE9 = utils.getBrowserInfo().msie && utils.getBrowserInfo().version === \'9.0\';\n\nconst history = syncHistoryWithStore(baseHistory, store, {\n  selectLocationState: makeSelectLocationState(),\n  adjustUrlOnReplay: isIE9 ? false : undefined\n});\n\nconst router = () => (\n  <ConfigProvider locale={zhCN}>\n    <Provider store={store}>\n      <Router\n        history={history}\n        routes={rootRoute}\n        render={\n          // Scroll to top when going to a new page, imitating default browser behaviour\n          applyRouterMiddleware(useScroll())\n        }\n      />\n    </Provider>\n  </ConfigProvider>\n);\n// 判断是否是开发环境\nif (isInIcestark()) {\n  registerAppEnter(() => {\n    ReactDOM.render(router(), getMountNode());\n  });\n  registerAppLeave(() => {\n    ReactDOM.unmountComponentAtNode(getMountNode());\n  });\n} else {\n  ReactDOM.render(router(), document.getElementById(\'app\'));\n}`, `69908626737846370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="jsx{1-3,5-7,11,16-38}"\n              >\n                <span class="gatsby-code-button-language">jsx{1-3,5-7,11,16-38}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> applyRouterMiddleware<span class="token punctuation">,</span> Router<span class="token punctuation">,</span> browserHistory<span class="token punctuation">,</span> useRouterHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-router\'</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createHistory <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'history\'</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> isInIcestark<span class="token punctuation">,</span> getMountNode<span class="token punctuation">,</span> registerAppEnter<span class="token punctuation">,</span> registerAppLeave<span class="token punctuation">,</span> getBasename <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ice/stark-app\'</span><span class="token punctuation">;</span></span>\n<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> baseHistory <span class="token operator">=</span> <span class="token function">useRouterHistory</span><span class="token punctuation">(</span>createHistory<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  basename<span class="token punctuation">:</span> <span class="token function">getBasename</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token keyword">const</span> isIE9 <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getBrowserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>msie <span class="token operator">&amp;&amp;</span> utils<span class="token punctuation">.</span><span class="token function">getBrowserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version <span class="token operator">===</span> <span class="token string">\'9.0\'</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">syncHistoryWithStore</span><span class="token punctuation">(</span>baseHistory<span class="token punctuation">,</span> store<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>  selectLocationState<span class="token punctuation">:</span> <span class="token function">makeSelectLocationState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  adjustUrlOnReplay<span class="token punctuation">:</span> isIE9 <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token punctuation">:</span> <span class="token keyword">undefined</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">const</span> <span class="token function-variable function">router</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigProvider</span></span> <span class="token attr-name">locale</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>zhCN<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span></span><span class="gatsby-highlight-code-line">        <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">        <span class="token attr-name">routes</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>rootRoute<span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">        <span class="token attr-name">render</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">          <span class="token comment">// Scroll to top when going to a new page, imitating default browser behaviour</span></span><span class="gatsby-highlight-code-line">          <span class="token function">applyRouterMiddleware</span><span class="token punctuation">(</span><span class="token function">useScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">}</span></span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">/></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConfigProvider</span></span><span class="token punctuation">></span></span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// 判断是否是开发环境</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInIcestark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  <span class="token function">registerAppEnter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getMountNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token function">registerAppLeave</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span><span class="token function">getMountNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'app\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="网络请求"><a href="#%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>网络请求</h5>\n<p>网络请求、资源都需要绝对路径，这就涉及到资源的跨域，需要处理</p>\n<p>app\\utils\\httpFetch.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31635023611996217000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export default function httpFetch(url, options) {\n  const newUrl = __COMMON_VARS__.robots + url;\n  // already forced sign out and has shown modal, cancel fetch\n  if (hasShownForcedSignOutModal) {\n    return new Promise((resolve, reject) => {\n      const error = new Error();\n      error.status = 401;\n      reject(error);\n    });\n  }\n  // eslint-disable-next-line no-param-reassign\n  options = {\n    ...options,\n    credentials: \'include\'\n  };\n  return runFetch(newUrl, options).then((response) => checkStatus(response, newUrl, options));\n}`, `31635023611996217000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2,12-17}"\n              >\n                <span class="gatsby-code-button-language">js{2,12-17}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">httpFetch</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> newUrl <span class="token operator">=</span> __COMMON_VARS__<span class="token punctuation">.</span>robots <span class="token operator">+</span> url<span class="token punctuation">;</span></span>  <span class="token comment">// already forced sign out and has shown modal, cancel fetch</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>hasShownForcedSignOutModal<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      error<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// eslint-disable-next-line no-param-reassign</span>\n<span class="gatsby-highlight-code-line">  options <span class="token operator">=</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token operator">...</span>options<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    credentials<span class="token punctuation">:</span> <span class="token string">\'include\'</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token keyword">return</span> <span class="token function">runFetch</span><span class="token punctuation">(</span>newUrl<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">checkStatus</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> newUrl<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="webpack-配置"><a href="#webpack-%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 配置</h5>\n<p>internals\\webpack\\webpack.base.babel.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21247345693472330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`output: Object.assign({ // Compile into js/build.js\n  path: path.resolve(process.cwd(), \'build\'),\n  publicPath: \\`\\${globalVars.robots}/product1/\\`,\n}, options.output), // Merge with env dependent settings`, `21247345693472330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{3}"\n              >\n                <span class="gatsby-code-button-language">js{3}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">output<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// Compile into js/build.js</span>\n  path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="gatsby-highlight-code-line">  publicPath<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>globalVars<span class="token punctuation">.</span>robots<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/product1/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span></span><span class="token punctuation">}</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Merge with env dependent settings</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h5 id="nodejs-服务器配置"><a href="#nodejs-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>nodejs 服务器配置</h5>\n<p>server\\index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96706677315242310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 设置允许资源文件跨域访问该服务\napp.all(\'*\', (req, res, next) => {\n  res.header(\'Access-Control-Allow-Origin\', \'*\');\n  next();\n});\n\n// Copy proxy.config.example.json to proxy.config.json to setup proxy\nconst proxy = require(\'http-proxy-middleware\');\nconfig.proxies.forEach((item) => {\n  app.use(\n    item.match,\n    proxy({\n      target: item.host,\n      changeOrigin: true,\n      // 修改响应头信息，实现跨域并允许带cookie\n      onProxyRes(proxyRes, req, res) {\n        res.header(\'Access-Control-Allow-Origin\', req.headers.origin);\n        res.header(\'Access-Control-Allow-Credentials\', \'true\');\n        res.header(\n          \'Access-Control-Allow-Headers\',\n          \'Content-Type, Content-Length, Authorization, Accept, X-Requested-With, Pragma, Cache-Control\'\n        );\n      }\n      // 修改响应信息中的cookie域名\n      // cookieDomainRewrite: \'www.domain1.com\', // 可以为false，表示不修改\n    })\n  );\n});\n\n// In production we need to pass these values in instead of relying on webpack\nsetup(app, {\n  outputPath: resolve(process.cwd(), \'build\'),\n  publicPath: \'/product1\'\n});`, `96706677315242310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2-5,13-23}"\n              >\n                <span class="gatsby-code-button-language">js{2-5,13-23}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 设置允许资源文件跨域访问该服务</span>\n<span class="gatsby-highlight-code-line">app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">\'*\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">\'Access-Control-Allow-Origin\'</span><span class="token punctuation">,</span> <span class="token string">\'*\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="token comment">// Copy proxy.config.example.json to proxy.config.json to setup proxy</span>\n<span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'http-proxy-middleware\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconfig<span class="token punctuation">.</span>proxies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>\n    item<span class="token punctuation">.</span>match<span class="token punctuation">,</span>\n    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">      target<span class="token punctuation">:</span> item<span class="token punctuation">.</span>host<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      changeOrigin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token comment">// 修改响应头信息，实现跨域并允许带cookie</span></span><span class="gatsby-highlight-code-line">      <span class="token function">onProxyRes</span><span class="token punctuation">(</span><span class="token parameter">proxyRes<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">\'Access-Control-Allow-Origin\'</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">        res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">\'Access-Control-Allow-Credentials\'</span><span class="token punctuation">,</span> <span class="token string">\'true\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">        res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">          <span class="token string">\'Access-Control-Allow-Headers\'</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">          <span class="token string">\'Content-Type, Content-Length, Authorization, Accept, X-Requested-With, Pragma, Cache-Control\'</span></span><span class="gatsby-highlight-code-line">        <span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span></span>      <span class="token comment">// 修改响应信息中的cookie域名</span>\n      <span class="token comment">// cookieDomainRewrite: \'www.domain1.com\', // 可以为false，表示不修改</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// In production we need to pass these values in instead of relying on webpack</span>\n<span class="token function">setup</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  outputPath<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  publicPath<span class="token punctuation">:</span> <span class="token string">\'/product1\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="新项目"><a href="#%E6%96%B0%E9%A1%B9%E7%9B%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新项目</h4>\n<p>新项目采用了 react-router 3.2.1，相同的部分不再阐述，只有入口文件不同于老项目</p>\n<h5 id="入口文件-1"><a href="#%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>入口文件</h5>\n<p>src\\index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30026502009619005000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { BrowserRouter, Router } from \'react-router-dom\';\nimport { isInIcestark, getMountNode, registerAppEnter, registerAppLeave, getBasename } from \'@ice/stark-app\';\n\nconst router = () => (\n  <Provider {...stores}>\n    <Router history={history}>\n      <BrowserRouter basename={getBasename()}>\n        <ConfigProvider locale={zhCN}>\n          <App />\n        </ConfigProvider>\n      </BrowserRouter>\n    </Router>\n  </Provider>\n);\n\nif (isInIcestark()) {\n  registerAppEnter(() => {\n    ReactDOM.render(router(), getMountNode());\n  });\n  registerAppLeave(() => {\n    ReactDOM.unmountComponentAtNode(getMountNode());\n  });\n} else {\n  ReactDOM.render(router(), document.getElementById(\'app\'), renderCallback);\n}`, `30026502009619005000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter<span class="token punctuation">,</span> Router <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-router-dom\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> isInIcestark<span class="token punctuation">,</span> getMountNode<span class="token punctuation">,</span> registerAppEnter<span class="token punctuation">,</span> registerAppLeave<span class="token punctuation">,</span> getBasename <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ice/stark-app\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">router</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>Provider <span class="token punctuation">{</span><span class="token operator">...</span>stores<span class="token punctuation">}</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span>Router history<span class="token operator">=</span><span class="token punctuation">{</span>history<span class="token punctuation">}</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>BrowserRouter basename<span class="token operator">=</span><span class="token punctuation">{</span><span class="token function">getBasename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span>ConfigProvider locale<span class="token operator">=</span><span class="token punctuation">{</span>zhCN<span class="token punctuation">}</span><span class="token operator">></span>\n          <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>ConfigProvider<span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>Router<span class="token operator">></span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInIcestark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">registerAppEnter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getMountNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">registerAppLeave</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    ReactDOM<span class="token punctuation">.</span><span class="token function">unmountComponentAtNode</span><span class="token punctuation">(</span><span class="token function">getMountNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'app\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> renderCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="single-spa"><a href="#single-spa" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>single-spa</h2>\n<p>待研究，不过这个框架只兼容 IE 10</p>\n<h2 id="qiankun"><a href="#qiankun" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>qiankun</h2>\n<p>待研究，不过这个框架不兼容 IE</p>\n<h1 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-04-01-15-21-23-50e18ed9e8a58190e1d4f5b2a5c08911-a54b5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 590px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.7457627118644%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAAB00lEQVQoz5VSyW4UMRD1n3ADKRFwASkjgRAJgp/hwAUO0QSkRBOisHwCNyTEgQM/BN0zvczSbbvddns3b2YEDAocKD2VS6569iuXiVLKOaeU5ryTUs3KOi/K79ksmxZFNS+qGr6sF4tVA98yrrQRcgDkoImVnNHWm5a1VT1fGTnvWD0rF6qrWFNV1dKoBVJZXqq+xk6x2dGK1vWSHJ9dfPry1TsjpRC9jMEF76xzMTrvLYIUPQJtLFLIGGNDsGETkacvTj58/EzbdrVc0LZJ/2Pk2s2DZ+MJ92nGQyUCVaFVYSVDQY0QquuHf0OR/dHR89PLxqZvNOQ8Mp2oTs2QskYzLlre/wEGiI1fg+yNjk7O30JDL7jsRfwpSQ2G8h6tmh1Y650Pxjpj1iDX7zw4PrtEdUvROA0h7JLxVt79NswVRVrrlKINidy+/2Q8eYNqShmlV8kBHLsxBMMwcM61MSA7kG/cfTierGVzxrquizHukgdtoDPE5FxYt2AxRQ/Bm3YcuXXv8cvzd+CAyRmHzF9kvM2gLaMsz3LoQg2EAFvDSvYODrc3y14Cu7IbkI2Fomk+xbl/mfP+6NGr1+9xIBpGxZYML5XGMPCTjdFCCCnlVfIPo4/KRMQNvrAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 04 01 15 21 23" title="" data-src="/static/2020-04-01-15-21-23-50e18ed9e8a58190e1d4f5b2a5c08911-a54b5.png" data-srcset="/static/2020-04-01-15-21-23-50e18ed9e8a58190e1d4f5b2a5c08911-33798.png 200w,\n/static/2020-04-01-15-21-23-50e18ed9e8a58190e1d4f5b2a5c08911-27c47.png 400w,\n/static/2020-04-01-15-21-23-50e18ed9e8a58190e1d4f5b2a5c08911-a54b5.png 590w" data-sizes="(max-width: 590px) 100vw, 590px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-04-01-15-20-24-b013eed670ea4a9ca82aace57e88cb55-b3c03.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 534px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.5243445692884%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACVElEQVQoz41SSWsUQRTuX+HFswb0Ii6JXjSBBBQhXgQvoqhgJqhgEj1E8SJ40Ls3vejBn6J4kRgNCDpbd3XPTK9VXXtXdflmJssMOejjo3nvVX/11Vu8khBdVVzILMeM80GctNrddqf7u9lqdoJuEHZ91PHDIOxFvX4Y9X3UK0jJuCBUeM4IDi5LRYm6XYRxZmWUZVm/H1ciSpMojGLFY06idjuAtGYBCkLQsAJ5L169effhU1WpSnPGuNa6NrKCWOnaKq2llMoaZSrJudAKfAE2Sgpv8+Xrt+8/+n4QotD3ffjDOVe7/zLvzPyVlbVNykRJOaFQgeRC7YNN+Ifhnbp4+e6jpzmm0C/4ZsUQo/Df8GZmF26truOS52QIcAqy6wMyDCHLCdsljP09eHNLy42NZ3CQYBkQ92Pg2oVLhRswlwi33cmSNNfG6spWxipVTcI7dvbSzZXHGESIyEQdERtTU6qaaies2/4TxGlOCf765fPW1ndjzFTDzi9du7+2Ccolg2mpPEs67RYt6ei0DhAaJKmo6jgvKS2NtVPkmdn5Ow+eQGGESohhgFrpIa8ezgsmmKXpr8J9iypJcYHJOL9Lnltcbqw/hw6PyYRg2IF9chAgeHaeY0Lo4fl7Jy8sjkYFykMOozSKojF/SEaon2QcVmcvM70kC1cbGwfKsI0FLmBJx8cIhWEvHgtCvVDTJLwjx09fv70KsoRJuB5jXOSFNfZAOc6kFM1mE+6x1tYT5h09ce7GvYewG6BsrIFugbjd6yrUPEhyePbOz51Wq2Wnu/0XEL9jDgSxE6cAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 04 01 15 20 24" title="" data-src="/static/2020-04-01-15-20-24-b013eed670ea4a9ca82aace57e88cb55-b3c03.png" data-srcset="/static/2020-04-01-15-20-24-b013eed670ea4a9ca82aace57e88cb55-52a8d.png 200w,\n/static/2020-04-01-15-20-24-b013eed670ea4a9ca82aace57e88cb55-3dc4b.png 400w,\n/static/2020-04-01-15-20-24-b013eed670ea4a9ca82aace57e88cb55-b3c03.png 534w" data-sizes="(max-width: 534px) 100vw, 534px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>',
excerpt:"…",frontmatter:{date:"2020-04-01 09:59:12",path:"/micro-front-end-demo-practice/",tags:"前端, 微前端, 预研",title:"微前端适配demo的实践",draft:null}},prePost:{html:'<h1 id="fiber-的数据结构"><a href="#fiber-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fiber 的数据结构</h1>\n<p>此小节会通过两个 <code class="language-text">demo</code> 来展示 <code class="language-text">Stack Reconciler</code> 以及 <code class="language-text">Fiber Reconciler</code> 的数据结构。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-05-28-14-50-48-ed5ac9996e46248250e5f99038b2dd04-7027d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 300px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 133.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAAsSAAALEgHS3X78AAAB00lEQVQ4y5WU246CQBBE/f8PMn6B8cEHffCOF7wraryjqLBnqezEsANiJ5oZpmu6urqgEEVRGIa+718ul+fzGcYR5YsCP2D9fn8+ny8Wi+ib+AWfz+fpdLrf7xuNxmg0mkwm34GbzeZwOHRd9/F4cBH884LVtonlcvl6vd6ffACb8DyP/tfrNfi8lU19kMjW7XZpnotY73a7vODxeAwGzVarFVocj0fWaSwstNF8NpuZVuv1ehAEucAENdFc6+12WyqV0oZnAdOnSt3vdyhcr1dGyC3qAkdlgZFalbmC4eO8drvNLV4cCMmldjD24Jhq2iK1MJKT/3K5LP3ZJsGDwQDBHccx+HcXYb5arYYdZcHkqNAGhzHtXq8HVTcO1QTAk9PpRI6YJyvDGYcANuOBiOpwBRKQ0Gq17GD8QCleb2WzLRaLVNMpQgLebDZZaqssBSkFC9Q27xkzu91uqWB6Fpgk5kQ2TZouKpVKqtoCa85qQcVlb46q1Spqa5sFFp61UmHOqCDCOMU8y2FWLWmBcdjVBkZGwiEmMDafusPhoMknwXgLVp1Ox0ia90sCMVihMMZIK571SsIZVVD4/wcAwbjR/wsatDgMMayC0Se9cBrEQeYPUp4fsX4q2tYAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 05 28 14 50 48" title="" data-src="/static/2020-05-28-14-50-48-ed5ac9996e46248250e5f99038b2dd04-7027d.png" data-srcset="/static/2020-05-28-14-50-48-ed5ac9996e46248250e5f99038b2dd04-55fa9.png 200w,\n/static/2020-05-28-14-50-48-ed5ac9996e46248250e5f99038b2dd04-7027d.png 300w" data-sizes="(max-width: 300px) 100vw, 300px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>首先用代码表示上图节点间的关系。比如 <code class="language-text">a1 节点</code>下有 <code class="language-text">b1、b2、b3 节点</code>, 就可以把它们间的关系写成 <code class="language-text">a1.render = () =&gt; [b1, b2, b3]</code>;</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20876284144622346000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var a1 = { name: \'a1\', render = () => [b1, b2, b3] }\nvar b1 = { name: \'b1\', render = () => [c1] }\nvar b2 = { name: \'b2\', render = () => [c2] }\nvar b3 = { name: \'b3\', render = () => [] }\nvar c1 = { name: \'c1\', render = () => [d1] }\nvar c2 = { name: \'c2\', render = () => [] }\nvar d1 = { name: \'d1\', render = () => [d2] }\nvar d2 = { name: \'d2\', render = () => [] }`, `20876284144622346000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'a1\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">,</span> b3<span class="token punctuation">]</span> <span class="token punctuation">}</span>\n<span class="token keyword">var</span> b1 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'b1\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>c1<span class="token punctuation">]</span> <span class="token punctuation">}</span>\n<span class="token keyword">var</span> b2 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'b2\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>c2<span class="token punctuation">]</span> <span class="token punctuation">}</span>\n<span class="token keyword">var</span> b3 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'b3\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>\n<span class="token keyword">var</span> c1 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'c1\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>d1<span class="token punctuation">]</span> <span class="token punctuation">}</span>\n<span class="token keyword">var</span> c2 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'c2\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>\n<span class="token keyword">var</span> d1 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'d1\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>d2<span class="token punctuation">]</span> <span class="token punctuation">}</span>\n<span class="token keyword">var</span> d2 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'d2\'</span><span class="token punctuation">,</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="stack-reconciler"><a href="#stack-reconciler" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stack Reconciler</h2>\n<p>在 <code class="language-text">React 16</code> 之前，节点之间的关系可以用数据结构中 <code class="language-text">树的深度遍历</code> 来表示。</p>\n<p>如下实现 <code class="language-text">walk</code> 函数, 将深度遍历的节点打印出来。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73382013299985530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`walk(a1);\n\nfunction walk(instance) {\n  if (!instance) return;\n  console.log(instance.name);\n  instance.render().map(walk);\n}`, `73382013299985530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">walk</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">walk</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>walk<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>输出结果为: <code class="language-text">a1 b1 c1 d1 d2 b2 c2 b3</code></p>\n<h2 id="fiber-reconciler"><a href="#fiber-reconciler" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fiber Reconciler</h2>\n<p>在 <code class="language-text">React 16</code> 中，节点之间的关系可以用数据结构中的 <code class="language-text">链表</code> 来表示。</p>\n<p>节点之间的链表有三种情形, 用图表示如下:</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2020-05-28-14-52-10-62a31ae4097adb3c3b9f05ed0d77f9da-7027d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 300px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 133.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADL0lEQVQ4y5VU2ZKcNhTt/89P5MFvSV5SqVT5JUulEtvjTs00PXRPL4CaHQlJSIDYBEQC3O01Ht8qiovQ0T0690grznkYhlEUIZSO4zgMw/jsWHmeByHEhByfdk1Zjt8SKwAucRQyip+2WwrcMiX9ROBZ4Jxn93v75d0Bo0TBmOfXYqr/DPxKPYcoe/G3PX8X5o78+lJjpfwqXoOZEK8Pbi07hNHe2FyMRxs4w9A/q3Im6gcAEWembSv9KOfHg439oOGsadrhy1vQ4KrpHpxEJX4YGdtNEtrf//LWOAZjLWgYlTkbvtBCDe46uQFx28teDownOLVJnruEzjPYel373mclXM2vvZ/CXIssZVUWsUpijGlREE6tV6+tN3cBQgtCLfFuldXM5xQiH+tSnSyLQm+hH2TC8reGyfKccH4+HPtKtKWQsruyWMAezewYq1R2Bef+1acny/ZcD6fwux//fTp5HcuyIGx4MU9YwCHN/DQt6z5Fx0fzp35YwDnnyvM8I3+ZzqO/MGf/vKoOx1tlBc6qcnuyT6e95zuObWmTjDeZuKhML87KEqrl12uwefDCcDX/SzkvqtYOAsuxEUL3m713dhpCRF4Ok0JN17mYoKLcHk8QQcqYcsQCVsJS0WYEb81t5J9/+M3YADTKhkMoIJ4JuKlOHABM8xE49vl8XmgrPojrVjEGk8QSVXVJ6dhrh8a//4kNQyWqnJomu47SCEJQ1+0CLusmokx3qK/VvlSCGEuUilEIDgfwdPB8v2q7AJPJVEKU+GYS7U2cyb6Xqs95PPPkVb3emoRSTKnjOLqjKZHDyBlIEuMDsJtm6ocC53k4UdCMwMVxXS8IArXDWZogIY51t9//kefVDRwSJZmqLfI8upqkrmsyRTndUGrozWZ/8bwEQi3YPKS7VeQpF2q+0m5u8EfHYPFiqNsZR5HrujcwLQtS1F1LITTev0aHKa4jaYoAAL7vqwv3RrvreyfElnX/sPmZMf5p5c+f5+uqxglYDkhTYllW27b/j9QH431wGCe73c6eommaj2ZLKYVQ9lmi67oPwOrAXYDqYaK29Om9o0aU+GrRdoq+7/8DKMcIrds8ZhQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2020 05 28 14 52 10" title="" data-src="/static/2020-05-28-14-52-10-62a31ae4097adb3c3b9f05ed0d77f9da-7027d.png" data-srcset="/static/2020-05-28-14-52-10-62a31ae4097adb3c3b9f05ed0d77f9da-55fa9.png 200w,\n/static/2020-05-28-14-52-10-62a31ae4097adb3c3b9f05ed0d77f9da-7027d.png 300w" data-sizes="(max-width: 300px) 100vw, 300px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ol>\n<li>父节点到子节点(红色虚线)</li>\n<li>同层节点(黄色虚线)</li>\n<li>子节点到父节点(蓝色虚线)</li>\n</ol>\n<blockquote>\n<p>父节点指向第一个子节点, 每个子节点都指向父节点，同层节点间是单向链表。</p>\n</blockquote>\n<p>首先, 构建节点的数据结构, 如下所示:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14652137532908860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var FiberNode = function(instance) {\n  this.instance = instance;\n  this.parent = null;\n  this.sibling = null;\n  this.child = null;\n};`, `14652137532908860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">FiberNode</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> instance<span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>sibling <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后创建一个将节点串联起来的 <code class="language-text">connect</code> 函数:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48650998870938040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var connect = function(parent, childList) {\n  parent.child = childList.reduceRight((prev, current) => {\n    const fiberNode = new FiberNode(current);\n    fiberNode.parent = parent;\n    fiberNode.sibling = prev;\n    return fiberNode;\n  }, null);\n\n  return parent.child;\n};`, `48650998870938040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">connect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> childList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  parent<span class="token punctuation">.</span>child <span class="token operator">=</span> childList<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> current</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> fiberNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FiberNode</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    fiberNode<span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>\n    fiberNode<span class="token punctuation">.</span>sibling <span class="token operator">=</span> prev<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> fiberNode<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> parent<span class="token punctuation">.</span>child<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>在 JavaScript 中实现链表的数据结构可以巧用 reduceRight</p>\n</blockquote>\n<p><code class="language-text">connect</code> 函数中实现了上述链表关系。可以像这样使用它:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56209025306441940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var parent = new FiberNode(a1);\nvar childFirst = connect(\n  parent,\n  a1.render()\n);`, `56209025306441940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FiberNode</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> childFirst <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>\n  parent<span class="token punctuation">,</span>\n  a1<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样子便完成了 <code class="language-text">a1 节点</code>指向 <code class="language-text">b1 节点</code>的链表、<code class="language-text">b1、b2、b3 节点间</code>的单向链表以及 <code class="language-text">b1、b2、b3 节点</code>指向 <code class="language-text">a1 节点</code> 的链表。</p>\n<p>最后剩下 <code class="language-text">goWalk</code> 函数将全部节点给遍历完。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1703322193275758000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 打印日志以及添加列表\nvar walk = function(node) {\n  console.log(node.instance.name);\n  const childLists = node.instance.render();\n  let child = null;\n  if (childLists.length > 0) {\n    child = connect(\n      node,\n      childLists\n    );\n  }\n  return child;\n};\n\nvar goWalk = function(root) {\n  let currentNode = root;\n\n  while (true) {\n    const child = walk(currentNode);\n    // 如果有子节点\n    if (child) {\n      currentNode = child;\n      continue;\n    }\n\n    // 如果没有相邻节点, 则返回到父节点\n    while (!currentNode.sibling) {\n      currentNode = currentNode.parent;\n      if (currentNode === root) {\n        return;\n      }\n    }\n\n    // 相邻节点\n    currentNode = currentNode.sibling;\n  }\n};\n\n// 调用\ngoWalk(new FiberNode(a1));`, `1703322193275758000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 打印日志以及添加列表</span>\n<span class="token keyword">var</span> <span class="token function-variable function">walk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> childLists <span class="token operator">=</span> node<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> child <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>childLists<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    child <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>\n      node<span class="token punctuation">,</span>\n      childLists\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> child<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> <span class="token function-variable function">goWalk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> currentNode <span class="token operator">=</span> root<span class="token punctuation">;</span>\n\n  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token function">walk</span><span class="token punctuation">(</span>currentNode<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 如果有子节点</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      currentNode <span class="token operator">=</span> child<span class="token punctuation">;</span>\n      <span class="token keyword">continue</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 如果没有相邻节点, 则返回到父节点</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentNode<span class="token punctuation">.</span>sibling<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      currentNode <span class="token operator">=</span> currentNode<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentNode <span class="token operator">===</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// 相邻节点</span>\n    currentNode <span class="token operator">=</span> currentNode<span class="token punctuation">.</span>sibling<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 调用</span>\n<span class="token function">goWalk</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FiberNode</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>打印结果为 <code class="language-text">a1 b1 c1 d1 d2 b2 c2 b3</code></p>\n<p><code class="language-text">Fiber</code> 在一个节点上的执行流程总结如下:</p>\n<ul>\n<li>\n<p>在当前节点下寻找是否有子节点</p>\n<ul>\n<li>若有, 则进入子节点</li>\n<li>\n<p>若没有, 则在当前节点下寻找是否有下一个相邻节点</p>\n<ul>\n<li>若有, 则进入下一个相邻节点</li>\n<li>若没有, 则返回它的父节点</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id="fiber-reconciler-的优势"><a href="#fiber-reconciler-%E7%9A%84%E4%BC%98%E5%8A%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fiber Reconciler 的优势</h1>\n<p>通过分析上述两种数据结构实现的代码，可以得出下面结论:</p>\n<ul>\n<li>基于树的深度遍历实现的 Reconciler: 一旦进入调用栈便无法暂停;</li>\n<li>基于链表实现的 Reconciler: 在 <code class="language-text">while(true) {}</code> 的循环中, 可以通过 <code class="language-text">currentNode</code> 的赋值重新得到需要操作的节点，而在赋值之前便可以’暂停’来执行其它逻辑, 这也是 <code class="language-text">requestIdleCallback</code> 能得以在 <code class="language-text">Fiber Reconciler</code> 的原因。</li>\n</ul>\n<h1 id="相关链接"><a href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>相关链接</h1>\n<ul>\n<li><a href="https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7" target="_blank" rel="nofollow noreferrer noopener">The how and why on React’s usage of linked list in Fiber to walk the component’s tree</a></li>\n<li><a href="https://github.com/facebook/react/issues/7942" target="_blank" rel="nofollow noreferrer noopener">Fiber Principles: Contributing To Fiber</a>: Fiber 设计思想相关 issue, 推荐。</li>\n</ul>',
excerpt:"Fiber 的数据结构 此小节会通过两个   来展示   以及   的数据结构。 首先用代码表示上图节点间的关系。比如  下有  , 就可以把它们间的关系写成  ; Stack Reconciler…",frontmatter:{date:"2020-05-28 14:32:24",path:"/react-fiber-data-struct/",tags:"前端, React Fiber, 数据结构",title:"React Fiber 数据结构",draft:null}}},pathContext:{mainPostPath:"/git-code-statistics-script/",nextPostPath:"/micro-front-end-demo-practice/",prePostPath:"/react-fiber-data-struct/"}}}});