webpackJsonp([72835731821973],{1338:function(n,a){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"canvas 实现弹幕性能较好 从技术实现成本角度讲，要实现弹幕效果，最简单的方法就是 DOM+CSS3 控制，如果我们的弹幕效果比较简单，使用 CSS3 动画实现也不失为一个好的方法。 但是如果我们的弹幕数据量比较大，就像下面这种： 使用 DOM 来实现很容易卡成了 80 年代的拖拉机——一顿一顿的。 很显然，面对这种多元素的复杂动画，使用 canvas 实现是更加合适的，动画会流畅很多。 本文就将展示两个案例，使用 canvas…",html:'<h1 id="canvas-实现弹幕性能较好"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E5%BC%B9%E5%B9%95%E6%80%A7%E8%83%BD%E8%BE%83%E5%A5%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现弹幕性能较好</h1>\n<p>从技术实现成本角度讲，要实现弹幕效果，最简单的方法就是 DOM+CSS3 控制，如果我们的弹幕效果比较简单，使用 CSS3 动画实现也不失为一个好的方法。</p>\n<p>但是如果我们的弹幕数据量比较大，就像下面这种：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 400px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 62.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACpklEQVQozxXG2U/aAACA8T4sc1OuQi+EXlBoKUcptlBqscVSrGgRaWGoBDxBPMiM25PbMs2yzOxhyZLtZU/7T8eSX758gLq5m9Fc7eBtffpYGn1aO30SBg+prXnx8Itx+7M8+8F1H2H9I7//LA1/mdd/ymd/k+63lez2Eq0Djcsb6Wgi9A7XTia50a0wuaO7V5h5Snbec95D7uw51/uMNz+E60+o/dWY/9am3xOt80DeeklqgOKd8d44sT9Nvbml3DnZv6PNMa92GWPMV4fl3rvazkRqTOT6laBfFzv35YO5Nr4zB7NN5whQGy3F3qUlE8trMbEhmp6t2of6tqe3j6TNU8Nxy812rTMw+0NVN+pGaXtXc7re6bh3PATOZzfucCzvn4jOON8+4ZyLtDXKWh7X6CebQ6E3SztT3p0r7n2ldSHuXwp7U8YcVSWnmLcAp9vrH4zMzmBwceMMz6Wmq9heVt1CuTIuGpRsJRSbkK2cbpcMe63ZEa02p+1Iaq2oaECCLRA0y7AFLlsik3xGkPmizAkKxZYYXmYLykI6J1uO3e7t7nmtnY6tGBu2u2Pt2QDOZGJUik4Xkqzwv5xIpYQkK7LFCltU6WyJ4sVUXlEV19g41s1JrX4mVrvr1aNK9RDA0xzJ8nSaT7DZFJ9PZQSKySc4gSmUyIyAp7M4yxOZPMMU0rxK60NyvU9UnIzUzNpjAI5G0VgcXiXQOIHE8QUUpxCCROJxNE6h+GJwGCdhnIBwMkImwgS9kOBzcs0AfCEwEIoEQDgYhv0gFAjDwQgCQigBQesQYkAoHiNAZDWCxkJINIjEQIyAopQ/HPWHMODF8sqSz+cPgcuB4Cuf77U/tBwIrIDhIIxBESSKxUF4NRhBkRgZgjAfCAciGIThyCrpC0L/ALPSm2eZ8M8uAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 21 16 34 45" title="" data-src="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png" data-srcset="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-01f55.png 200w,\n/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png 400w" data-sizes="(max-width: 400px) 100vw, 400px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>使用 DOM 来实现很容易卡成了 80 年代的拖拉机——一顿一顿的。</p>\n<p>很显然，面对这种多元素的复杂动画，使用 canvas 实现是更加合适的，动画会流畅很多。</p>\n<p>本文就将展示两个案例，使用 canvas 实现弹幕效果。其中一个效果是静态的弹幕数据固定的无限循环的效果，适合在个人博客或者运营页面，这种非视频场景使用；另外一个效果是动态的弹幕数据可变的和真实 HTML5 <code class="language-text">&lt;video&gt;</code> 交互的弹幕效果，也就是真视频弹幕效果。</p>\n<p>两个高保真 demo 的源代码都是可以免费使用的，使用 MIT 许可，也就是需要保留源代码中的版权声明。</p>\n<p>好，下面我们一个人来看一下。</p>\n<h1 id="canvas-实现的静态循环滚动播放弹幕"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%9D%99%E6%80%81%E5%BE%AA%E7%8E%AF%E6%BB%9A%E5%8A%A8%E6%92%AD%E6%94%BE%E5%BC%B9%E5%B9%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现的静态循环滚动播放弹幕</h1>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 50%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/html5-canvas-video-barrage/static-barrage.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.canvas-barrage</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-placeholder</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> bgColor 10s infinite alternate<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token atrule"><span class="token rule">@keyframes</span> bgColor</span> <span class="token punctuation">{</span>\n      <span class="token selector">25%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkred<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">50%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkgreen<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">75%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkblue<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">100%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> sliver<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  &lt;/head>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-x<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvasBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas-barrage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-placeholder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token comment">// 弹幕数据</span>\n    <span class="token keyword">var</span> dataBarrage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'使用的是静态死数据\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'随机循环播放\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以控制区域和垂直分布范围\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'字体大小和速度在方法内设置\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'适合用在一些静态页面上\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'基于canvas实现\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'因此IE9+浏览器才支持\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以设置边框颜色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'文字颜色默认都是白色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'若文字颜色不想白色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'需要自己调整下JS\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'如果需要的是真实和视频交互的弹幕\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以回到原文\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'查看另外一个demo\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'下面就是占位弹幕了\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 弹幕方法</span>\n    <span class="token keyword">var</span> <span class="token function-variable function">canvasBarrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvas <span class="token operator">||</span> <span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> canvas <span class="token operator">==</span> <span class="token string">\'string\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">canvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n\n      <span class="token comment">// 存储实例</span>\n      <span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 字号大小</span>\n      <span class="token keyword">var</span> fontSize <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 实例方法</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">Barrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 随机x坐标也就是横坐标，对于y纵坐标，以及变化量moveX</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> index <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">36</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>moveX <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> obj<span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">;</span>\n          <span class="token comment">// 根据此时x位置绘制文本</span>\n          context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> params<span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">\'bold \'</span> <span class="token operator">+</span> fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">\'rgba(255,255,255,\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span><span class="token function">strokeText</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 绘制弹幕文本</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n          <span class="token comment">// 位置变化</span>\n          barrage<span class="token punctuation">.</span>x <span class="token operator">-=</span> barrage<span class="token punctuation">.</span>moveX<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 移动到画布外部时候从左侧开始继续位移</span>\n            barrage<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> index <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n            barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span>moveX <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token comment">// 根据新位置绘制圆圈圈</span>\n          store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 画布渲染</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 清除画布</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 绘制画布上所有的圆圈圈</span>\n        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 继续渲染</span>\n        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">canvasBarrage</span><span class="token punctuation">(</span><span class="token string">\'#canvasBarrage\'</span><span class="token punctuation">,</span> dataBarrage<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<h2 id="使用方法和-api"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C-api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方法和 API</h2>\n<p>语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74347176938398880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`canvasBarrage(canvas, data);`, `74347176938398880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">canvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>\n<p>canvas<br>\ncanvas 表示我们的<code class="language-text">&lt;canvas&gt;</code>画布元素，可以直接是 DOM 元素，也可以是<code class="language-text">&lt;canvas&gt;</code>画布元素的选择器。</p>\n</li>\n<li>\n<p>data<br>\ndata 表示弹幕数据，是一个数组。例如下面：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19644535280996700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[\n{\n  value: \'弹幕1\',\n  color: \'blue\',\n  range: [0, 0.5]\n},\n{\n  value: \'弹幕2\',\n  color: \'red\',\n  range: [0.5, 1]\n}\n];`, `19644535280996700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">[</span>\n<span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'弹幕1\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n  range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'弹幕2\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'red\'</span><span class="token punctuation">,</span>\n  range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<p>可以看到数组中的每一个值表示一个弹幕的信息对象。其中 value 表示弹幕的文字内容；color 表示弹幕描边的颜色（弹幕文字本身默认是白色）；range 表示弹幕在画布中的区域范围，例如[0, 0.5]表示弹幕在画布中的上半区域显示，[0.5, 1]表示弹幕在画布中的下半区域显示。</p>\n<p>然后就可以看到无限滚动的弹幕效果了。</p>\n<h3 id="补充说明"><a href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>补充说明</h3>\n<p>此弹幕效果默认文字大小是 28px，并且文字加粗，如果这个效果不符合您的需求，需要在 canvasBarrage()方法中修改源代码。因为本来就是个简单静态效果，因此没有专门设计成 API。</p>\n<p>此弹幕效果默认是白色文字加可变颜色描边，同样的，如果这个效果不符合您的需求，需要在 canvasBarrage()方法中修改源代码。跟真实的弹幕效果有所不同，这里的弹幕出现的速度和时机不是基于特定时间，而是随机产生。所以看到有些文字好像开飞机，而有些文字好像坐着拖拉机。因为是死数据，这样设计会看上去更真实写。</p>\n<h1 id="canvas-实现的-video-真实交互的弹幕"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E7%9A%84-video-%E7%9C%9F%E5%AE%9E%E4%BA%A4%E4%BA%92%E7%9A%84%E5%BC%B9%E5%B9%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现的 video 真实交互的弹幕</h1>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 75%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/html5-canvas-video-barrage/interactive-barrage.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x video</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>\n      <span class="token property">outline</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.canvas-barrage</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n      <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n      <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">input[type="range"]</span> <span class="token punctuation">{</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.ui-radio + label</span> <span class="token punctuation">{</span>\n      <span class="token property">margin-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">input[type="submit"]</span> <span class="token punctuation">{</span>\n      <span class="token property">margin-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">[disabled]</span> <span class="token punctuation">{</span>\n      <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> .4<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.last</span> <span class="token punctuation">{</span>\n      <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>\n      <span class="token property">margin-top</span><span class="token punctuation">:</span> 1.5em<span class="token punctuation">;</span>\n      <span class="token property">padding-top</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-x<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvasBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas-barrage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>videoBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>384<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./video.mp4<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>barrageForm<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>barrage.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>透明度(0-100)：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>opacity<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 文字大小(16-32)：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fontSize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>32<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>弹幕位置：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0,1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>全部位置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0,0.3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>顶部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.7,1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>底部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>last<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-input<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-button ui-button-primary<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>发送弹幕<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span><span class="token punctuation">></span></span>\n        颜色：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ff0000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> <span class="token function-variable function">CanvasBarrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvas <span class="token operator">||</span> <span class="token operator">!</span>video<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> defaults <span class="token operator">=</span> <span class="token punctuation">{</span>\n        opacity<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>\n        fontSize<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>\n        speed<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n        range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        color<span class="token punctuation">:</span> <span class="token string">\'white\'</span><span class="token punctuation">,</span>\n        data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> defaults<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> defaults<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> data <span class="token operator">=</span> top<span class="token punctuation">.</span>data<span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> isPause <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> fontSize <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">Barrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> obj<span class="token punctuation">.</span>time<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> speed <span class="token operator">=</span> top<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">\'speed\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            speed <span class="token operator">=</span> obj<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            speed <span class="token operator">=</span> speed <span class="token operator">+</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">var</span> fontSize <span class="token operator">=</span> obj<span class="token punctuation">.</span>fontSize <span class="token operator">||</span> top<span class="token punctuation">.</span>fontSize<span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> color <span class="token operator">=</span> obj<span class="token punctuation">.</span>color <span class="token operator">||</span> top<span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> color<span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">var</span> c <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span>backgroundColor<span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span> c<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> range <span class="token operator">=</span> obj<span class="token punctuation">.</span>range <span class="token operator">||</span> top<span class="token punctuation">.</span>range<span class="token punctuation">;</span>\n          <span class="token keyword">var</span> opacity <span class="token operator">=</span> obj<span class="token punctuation">.</span>opacity <span class="token operator">||</span> top<span class="token punctuation">.</span>opacity<span class="token punctuation">;</span>\n          opacity <span class="token operator">=</span> opacity <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'span\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">\'absolute\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>whiteSpace <span class="token operator">=</span> <span class="token string">\'nowrap\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">\'bold \'</span> <span class="token operator">+</span> fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>innerText <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> span<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>x\t<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>actualX <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token punctuation">(</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n\n          <span class="token keyword">this</span><span class="token punctuation">.</span>moveX <span class="token operator">=</span> speed<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">=</span> opacity<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>range <span class="token operator">=</span> range<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          context<span class="token punctuation">.</span>shadowColor <span class="token operator">=</span> <span class="token string">\'rgba(0,0,0,\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>shadowBlur <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/rgb\\(/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">\'rgba(\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'(\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\')\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token string">\',\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>barrage<span class="token punctuation">.</span>disabled <span class="token operator">&amp;&amp;</span> time <span class="token operator">>=</span> barrage<span class="token punctuation">.</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>barrage<span class="token punctuation">.</span>inited<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              barrage<span class="token punctuation">.</span>inited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span>x <span class="token operator">-=</span> barrage<span class="token punctuation">.</span>moveX<span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>moveX <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>actualX <span class="token operator">-=</span> top<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>actualX <span class="token operator">=</span> barrage<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>actualX <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> barrage<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>x <span class="token operator">=</span> barrage<span class="token punctuation">.</span>actualX<span class="token punctuation">;</span>\n              barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>isPause <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'play\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        isPause <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'pause\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        isPause <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'seeked\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        top<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> barrage<span class="token punctuation">.</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>inited <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token comment">// 弹幕数据</span>\n    <span class="token keyword">var</span> dataBarrage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'speed设为0为非滚动\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>\n      speed<span class="token punctuation">:</span> <span class="token number">0</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'time控制弹幕时间，单位秒\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频共21秒\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">3.2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频背景为白色\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">4.5</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频为录制\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">5.0</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频内容简单\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">6.3</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'是为了让视频尺寸不至于过大\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">7.8</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'省流量\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">8.5</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'支持弹幕暂停（视频暂停）\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">9</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'add()方法新增弹幕\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">11</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'reset()方法重置弹幕\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">11</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'颜色，字号，透明度可全局设置\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">13</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'具体交互细节可参考页面源代码\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">14</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'内容不错哦！\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'yellow\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 初始化弹幕方法</span>\n    <span class="token keyword">var</span> eleCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'canvasBarrage\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> eleVideo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'videoBarrage\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">var</span> demoBarrage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>eleCanvas<span class="token punctuation">,</span> eleVideo<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      data<span class="token punctuation">:</span> dataBarrage\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 下面是交互处理，与弹幕方法本身无关，旨在演示如何修改全局设置，新增弹幕等</span>\n    <span class="token comment">// 1. 全局的弹幕大小，位置和透明度处理</span>\n    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'.range\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'change\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 改变弹幕的透明度和字号大小</span>\n        demoBarrage<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'input[name="range"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 改变弹幕在视频显示的区域范围</span>\n        demoBarrage<span class="token punctuation">[</span><span class="token string">\'range\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 发送弹幕</span>\n      <span class="token keyword">var</span> elForm <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#barrageForm\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> elInput <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      elForm<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 新增弹幕</span>\n        demoBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          value<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          color<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#color\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          time<span class="token punctuation">:</span> eleVideo<span class="token punctuation">.</span>currentTime\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        elInput<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 提交按钮</span>\n      <span class="token keyword">var</span> elSubmit <span class="token operator">=</span> elForm<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">\'input[type="submit"]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 输入框和禁用按钮</span>\n      elInput<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          elSubmit<span class="token punctuation">.</span><span class="token function">removeAttr</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          elSubmit<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">,</span> <span class="token string">\'disabled\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./lulu.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'.range\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#color\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>这个原型就有点厉害了，市面上估计很难找到这么负责任的原型页面了。实现的动机完全兴趣使然，上面实现了个简单的，就想着要不实现一个真实的，万一以后用得到呢？</p>\n<h2 id="使用方法和-api-1"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C-api-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方法和 API</h2>\n<p>语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88875880201858550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new CanvasBarrage(canvas, video, options);`, `88875880201858550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>canvas<br>\ncanvas 表示我们的<code class="language-text">&lt;canvas&gt;</code>画布元素，只能是 DOM 元素。</li>\n<li>video<br>\nvideo 表示我们播放的视频元素，只能是 DOM 元素。</li>\n<li>options<br>\noptions 为可选参数，包括：</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-23-01-49-36-71c235a986b80da64a981808d2330f5f-5ee9d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 95.21103896103897%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAACPklEQVQ4y31Ta4+bMBDk//+3SpXuU3pJgBhsMH6/IV86htyVO7VFE2vkeD27O+vm/d7/unb3blAmKhuNL9YXbRM4CJ3Ej59vQoeQni5ugD+hUVpbF0LM/YOMlM58WRZB2SSVNsYpZax1zvtte35iXbdSVqAZGV+ksSH1hFK2UMaxI5TVNmB1IWNdhJbacaEBcOdTKs+Ut0ZW4YRDbUfa7tH1hAx0pBP4ME4zFz0Zb20/jGyacfVMdoJ98EZI3O+RoxCSc/w9jfjNvOt6rM4H5FwLcB7cGJwNMaUQo4+xcT6iYGP9gIrZhACI4FZwIeUw0AcZCBmhobVBhdq4gpp3NNu2oQHrtiETpZGF1UYtQtqqEZDLwWOMr25tWy7lQLOua9kh7cplXlQep1QNC8X47NLq4mpD1j5pF3ekA8anGnzEw9j31nckEBqEeR1SLh74jPl7MALoHGcZCQvKpir1X7yCyys4Xe++ffhDWZ1kK2zFd+WCbw/WrvhYQq4AcTHva8UHyWYXPIC5amBAql/mHPYwzEd7b6dpIg9yu14ppbfb/XK59HV6iBACx7TWUkq+8JdV6DuMtBbDAF8MhgEzvVtrMD+LUPUJWJdLzTHvgw1yqllltqRZpIEhqwyrzjAhA//odoGZ6db5lqBhvnb7uze7yeduh1O3FwXNyHiCPpT1Bw6+N/8LvvisTcD7wthjLo0LxnnrwYO2HpPvYwopnxFT/pO2lOgk10qh1Quvn1IKm4yxeZ5zTlt9ASes629PXi8vgAQc5wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 23 01 49 36" title="" data-src="/static/2019-12-23-01-49-36-71c235a986b80da64a981808d2330f5f-fee1c.png" data-srcset="/static/2019-12-23-01-49-36-71c235a986b80da64a981808d2330f5f-a67b7.png 200w,\n/static/2019-12-23-01-49-36-71c235a986b80da64a981808d2330f5f-0b187.png 400w,\n/static/2019-12-23-01-49-36-71c235a986b80da64a981808d2330f5f-fee1c.png 800w,\n/static/2019-12-23-01-49-36-71c235a986b80da64a981808d2330f5f-b1a91.png 1200w,\n/static/2019-12-23-01-49-36-71c235a986b80da64a981808d2330f5f-5ee9d.png 1232w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="如何修改全局设置和添加弹幕？"><a href="#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E5%BC%B9%E5%B9%95%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何修改全局设置和添加弹幕？</h2>\n<p>当我们使用 new CanvasBarrage()构造完我们的弹幕方法后，会返回一个弹幕对象，通过调用这个对象暴露的属性和方法，就可以进行全局的设置和添加弹幕等。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36809954910272080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var myBarrage = new CanvasBarrage(canvas, video, options);`, `36809954910272080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> myBarrage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果我们想把弹幕透明度改成 50%透明，可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32874928820525940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.opacity = 50;`, `32874928820525940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就这么简单，于是新出现的弹幕都会以 50%透明显示，类似的，弹幕文字大小和颜色，弹幕显示的区域范围都可以通过这样设置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53348786279045690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.fontSize = 20;`, `53348786279045690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就是把弹幕文字颜色改成 20px 大小。</p>\n<p>如果我们想动态添加弹幕，可以使用暴露的 add()方法，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12992299189160761000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.add(obj);`, `12992299189160761000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中 obj 的参数类型和支持属性和 options-data 数组中对象一模一样。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71214617807407010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.add({\n  value: \'new CanvasBarrage()\',\n  color: \'#ff0000\',\n  time: 0\n});`, `71214617807407010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'new CanvasBarrage()\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'#ff0000\'</span><span class="token punctuation">,</span>\n  time<span class="token punctuation">:</span> <span class="token number">0</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>myBarrage 还暴露了一个名为 reset()方法，可以清除屏幕上所有的弹幕，并重新根据视频时间开始运动与显示。视频点击跳转时候的弹幕处理就是调用的此方法。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/使用canvas实现和HTML5 video交互的弹幕效果/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2019-12-21 16:33:45",path:"/html5-canvas-video-barrage/",tags:"前端, JS, JS知识点",title:"使用canvas实现和HTML5 video交互的弹幕效果",draft:null}},{excerpt:"简介 Pointer Lock API 可以让你的鼠标无限移动，脱离浏览器窗体的限制！ API 3 个属性\nDocument.pointerLockElement\nDocument.onpointerlockchange\nDocument.onpointerlockerror 2 个方法\nElement.requestPointerLock()\nDocument.exitPointerLock() 2 个事件\npointerlockchange\npointerlockerror 其中，…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>Pointer Lock API 可以让你的鼠标无限移动，脱离浏览器窗体的限制！</p>\n<h1 id="api"><a href="#api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API</h1>\n<ul>\n<li>3 个属性\nDocument.pointerLockElement\nDocument.onpointerlockchange\nDocument.onpointerlockerror</li>\n<li>2 个方法\nElement.requestPointerLock()\nDocument.exitPointerLock()</li>\n<li>2 个事件\npointerlockchange\npointerlockerror</li>\n</ul>\n<p>其中，2 个事件和其中 2 个属性是一一对应的，因此，我们实际上需要了解的知识点是下面这些： Document.pointerLockElement，以及 Element.requestPointerLock()，Document.exitPointerLock()以及 pointerlockchange 和 pointerlockerror 事件。</p>\n<h2 id="documentpointerlockelement"><a href="#documentpointerlockelement" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Document.pointerLockElement</h2>\n<p>指当前页面触发鼠标无限滚动的元素，通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55120117504286320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var element = document.pointerLockElement;`, `55120117504286320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span>pointerLockElement<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>返回的是一个 DOM 元素对象，如果当前页面是非鼠标锁定状态，则返回值是 null。</p>\n<h2 id="elementrequestpointerlock"><a href="#elementrequestpointerlock" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Element.requestPointerLock()</h2>\n<p>可以让页面进入鼠标锁定状态（鼠标直接消失），鼠标无限滚动，坐标无限变化。通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66012978416757040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var element.requestPointerLock();`, `66012978416757040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> element<span class="token punctuation">.</span><span class="token function">requestPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="documentexitpointerlock"><a href="#documentexitpointerlock" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Document.exitPointerLock()</h2>\n<p>让页面从鼠标锁定状态退出，通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69482971826263065000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.exitPointerLock();`, `69482971826263065000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="j"\n              >\n                <span class="gatsby-code-button-language">j</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="j"><pre style="counter-reset: linenumber NaN" class="language-j line-numbers"><code class="language-j">documen<span class="token adverb builtin">t.</span>exitPointerLock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>浏览器默认支持按下 ESC 键退出鼠标锁定状态，但是用户有时候更习惯于点击取消等，此时就可以使用 document.exitPointerLock()进行设置。</p>\n<h2 id="pointerlockchange-事件"><a href="#pointerlockchange-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointerlockchange 事件</h2>\n<p>当页面鼠标锁定状态改变的时候触发。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31598404374668497000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\n  \'pointerlockchange\',\n  function() {\n    // ...\n  },\n  false\n);`, `31598404374668497000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n  <span class="token string">\'pointerlockchange\'</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token boolean">false</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="pointerlockerror-事件"><a href="#pointerlockerror-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointerlockerror 事件</h2>\n<p>当页面鼠标锁定失败的时候触发。例如当你试图同时锁定同一个页面的多个<code class="language-text">&lt;iframe&gt;</code>时候，就会触发这个出错事件。</p>\n<h2 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h2>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/js-api-pointer-lock/demo.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>\n      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">perspective</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box img</span> <span class="token punctuation">{</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./avatar.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> eleImage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'image\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 起始值</span>\n      <span class="token keyword">var</span> moveX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> moveY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token comment">// 图片无限变换的方法</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">rotate3D</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        moveX <span class="token operator">=</span> moveX <span class="token operator">+</span> event<span class="token punctuation">.</span>movementX<span class="token punctuation">;</span>\n        moveY <span class="token operator">=</span> moveY <span class="token operator">+</span> event<span class="token punctuation">.</span>movementY<span class="token punctuation">;</span>\n\n        eleImage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">\'rotateX(\'</span> <span class="token operator">+</span> moveY <span class="token operator">+</span> <span class="token string">\'deg) rotateY(\'</span> <span class="token operator">+</span> moveX <span class="token operator">+</span> <span class="token string">\'deg)\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 触发鼠标锁定</span>\n      eleImage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        eleImage<span class="token punctuation">.</span><span class="token function">requestPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 再次点击页面，取消鼠标锁定处理</span>\n      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>pointerLockElement <span class="token operator">==</span> eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">exitPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 检测鼠标锁定状态变化</span>\n      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'pointerlockchange\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>pointerLockElement <span class="token operator">==</span> eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> rotate3D<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> rotate3D<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>原理大致如下：</p>\n<p>点击图片，执行 eleImage.requestPointerLock()让页面进入鼠标锁定状态，此时会触发 pointerlockchange 事件，于是，给页面绑定鼠标移动改变图片旋转的方法，为了避免重复绑定，我们借助 document.pointerLockElement 判断页面的锁定状态。最后，为了方便取消页面的锁定状态，我们在页面上绑定了点击事件，通过 document.exitPointerLock()取消页面的锁定状态。</p>\n<p>需要说明的：</p>\n<p>event.movementX 和 event.movementY 表示每次 mousemove 事件触发时候，距离上次移动的水平和垂直位置大小，而不是具体的某个坐标值。因此，需要和初始坐标不断的累加确定当前移动位置。</p>\n<h1 id="兼容性"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h1>\n<p>最后说下 Pointer Lock API 的兼容性。</p>\n<p>由于 Pointer Lock API 是与鼠标相关的 API，因此所有移动端都不支持，因为没有必要支持。</p>\n<p>对于桌面浏览器，Chrome，Firefox 以及 Edge 浏览器都是支持的，并且现在使用可以不加私有前缀，直接走起。IE 并不支持，但这并不妨碍我们进行增强使用 Pointer Lock API。</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/鼠标无限移动 JS API Pointer Lock简介/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-21 15:57:19",path:"/js-api-pointer-lock/",tags:"前端, JS, JS知识点",title:"鼠标无限移动 JS API Pointer Lock简介",draft:null}},{excerpt:"纯 CSS 实现数据上报 举个例子，要跟踪并统计某个按钮的点击事件： 此时，当我们点击按钮的时候，相关行为数据就会上报给服务器，这种上报，就算把 JS 禁掉也无法阻止。 点击页面的两个按钮，可以看到发出了如下的请求： 当然，我们可以统计的不仅仅是单击行为，hover 行为，focus 行为都可以统计，当然，还有很多其他方面的。例如： 不支持 CSS3 浏览器比例统计 例如，我的 Chrome 发出的图片请求地址就是： 类似的，我们可以检测支持其他一些 CSS…",html:'<h1 id="纯-css-实现数据上报"><a href="#%E7%BA%AF-css-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纯 CSS 实现数据上报</h1>\n<p>举个例子，要跟踪并统计某个按钮的点击事件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87558809381544660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.button-1:active::after {\n  content: url(./pixel.gif?action=click&id=button1);\n  display: none;\n}\n.button-2:active::after {\n  content: url(./pixel.gif?action=click&id=button2);\n  display: none;\n}`, `87558809381544660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.button-1:active::after</span> <span class="token punctuation">{</span>\n  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?action=click&amp;id=button1<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">.button-2:active::after</span> <span class="token punctuation">{</span>\n  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?action=click&amp;id=button2<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，当我们点击按钮的时候，相关行为数据就会上报给服务器，这种上报，就算把 JS 禁掉也无法阻止。</p>\n<p>点击页面的两个按钮，可以看到发出了如下的请求：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-16-22-57-12-f8bf9b06aba8469ce99acedee846de4b-4b0e9.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 571px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.78283712784589%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABdklEQVQoz3VRaYvbMBT0//89PWh3oVBKC4WyZJM4TuxkreNJti5bh+PEOdqXLOyn7vAYzZuRQHrKjJSd984Yb3QIoeuc73vX9T4m4cJOdaqPHq2+96/LXeBOpVRWFxuiLaOgKOfGNdpSUu8oMHkzKMiaUGMMIaSqKnEHcGCMzWazTDjvx6nbTzqN/eEsTGetAc6xnLVtIy1y226326IopJRaazzvnMvzPEspHRDjIcY0nU4pxvP5jMbxeDxhm9L1ekVGPU3TOI6Yxhgvl0tZldnfd4Bn/tu+ibIssx5g0GpQLU4AJxFjCMghDCn5u9gPA1qHcTweb1dMMeC79vths9lkz9++5z9+Fr9+Lz99Xs+XBJqXmhEKOLlqR7hote1BKtsFIdumNRXAC+XadqtinbGarhc5I0z8edotlq2xQkjORdMqIZu3AiEZR2oIgMRMmdVqlT19/LB4fJh//TJ/fKB1zW/Aj2BI/LWhFAsFANwibO8Rzv8f/c3urbIy5MEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 16 22 57 12" title="" data-src="/static/2019-12-16-22-57-12-f8bf9b06aba8469ce99acedee846de4b-4b0e9.png" data-srcset="/static/2019-12-16-22-57-12-f8bf9b06aba8469ce99acedee846de4b-b8aee.png 200w,\n/static/2019-12-16-22-57-12-f8bf9b06aba8469ce99acedee846de4b-fe23d.png 400w,\n/static/2019-12-16-22-57-12-f8bf9b06aba8469ce99acedee846de4b-4b0e9.png 571w" data-sizes="(max-width: 571px) 100vw, 571px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>当然，我们可以统计的不仅仅是单击行为，hover 行为，focus 行为都可以统计，当然，还有很多其他方面的。例如：</p>\n<h2 id="不支持-css3-浏览器比例统计"><a href="#%E4%B8%8D%E6%94%AF%E6%8C%81-css3-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%AF%94%E4%BE%8B%E7%BB%9F%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不支持 CSS3 浏览器比例统计</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14442885004231543000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.any-element {\n  background: url(./pixel.gif?css=2);\n  background-image: url(./pixel.gif?css=3), none;\n}`, `14442885004231543000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.any-element</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?css=2<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?css=3<span class="token punctuation">)</span></span><span class="token punctuation">,</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>例如，我的 Chrome 发出的图片请求地址就是：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-16-22-58-08-275466aaec057ebf28f3695437115412-b97a5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 458px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 22.052401746724893%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArElEQVQI10WM2w6CMAyGef+3MzHxSoXBYAjrtnYH2CBY9IIvbdPD37/KpTgKYMk4Do8+zQYprNxTXC0Gn7KjNIPThjCszkdH0WLUYKs1Z/Lp3cjb/TFOxlKcNAsy27H0M9uQCn++6rYWPVjP1rNhI3y+6qqUchzHvu9CCCm7YRiklEI0fS//tEJ0bcsnrpxKqa1s/KLUWC3LEn8gIpgTANBwwRt9cs0hBNaz7xf979+lL1hrmQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 16 22 58 08" title="" data-src="/static/2019-12-16-22-58-08-275466aaec057ebf28f3695437115412-b97a5.png" data-srcset="/static/2019-12-16-22-58-08-275466aaec057ebf28f3695437115412-6163a.png 200w,\n/static/2019-12-16-22-58-08-275466aaec057ebf28f3695437115412-da3aa.png 400w,\n/static/2019-12-16-22-58-08-275466aaec057ebf28f3695437115412-b97a5.png 458w" data-sizes="(max-width: 458px) 100vw, 458px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>类似的，我们可以检测支持其他一些 CSS 属性的比例，要比单纯看浏览器的占比要精准的多。因为同样是 Chrome 浏览器，不同用户版本可能不一样，要想准确知道某些 CSS 新特性支持情况，这种 CSS 上报方法要更准确。</p>\n<p>可以使用@supports 规则。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45807839256595950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.any-element {\n  background: url(./pixel.gif?grid=0);\n}\n\n@supports (display: grid) {\n  .any-element {\n    background: url(./pixel.gif?grid=1);\n  }\n}`, `45807839256595950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.any-element</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?grid=0<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@supports</span> <span class="token punctuation">(</span><span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token selector">.any-element</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?grid=1<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="retina-屏幕占比统计"><a href="#retina-%E5%B1%8F%E5%B9%95%E5%8D%A0%E6%AF%94%E7%BB%9F%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>retina 屏幕占比统计</h2>\n<p>要么上报 0，要么上报 1，最后可以知道 retina 屏幕的比例。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74328606635466770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.any-element {\n  background: url(./pixel.gif?retina=0);\n}\n\n@media screen and (-webkit-min-device-pixel-ratio: 2) {\n  .any-element {\n    background: url(./pixel.gif?retina=1);\n  }\n}`, `74328606635466770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.any-element</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?retina=0<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token atrule"><span class="token rule">@media</span> screen and <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 2<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token selector">.any-element</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?retina=1<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>例如，我家里的 window 普通显示屏：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-17-01-15-29-de9c45895e4736b242c400cd0f2cb559-69f72.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 464px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.586206896551722%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA/UlEQVQY0zWPTW+DMAyG+f/H7difsol7p05IiGlsBUpCAoFgHEJI2GHtwsceWdbz2vLBgVLKWrtsOOd8nCatxxVjJh+dtd5X8TbPCtHZeXH+xAXfWVHxpgdsu14C7pFUPCtII+Q1LwH1raSfX1cf+0EVrJZq6rXpcQy6HrMbe4+SKP6Acaa8VeZHgsbRAho56Hn59cOiZAXhA5o6zWmSlknK6y7QWsMAUkrGOKW0qirOOdkQQrCVijNGCeFCZJfL29Nz8vIanU51HAf3x/2x4R8GgP294Z/dEXH1cewYK8KQnM95GBqAgNcHjUcIX2Lvbbv7QdseXcpVus5v/wA5SEZ1y9c+SwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 17 01 15 29" title="" data-src="/static/2019-12-17-01-15-29-de9c45895e4736b242c400cd0f2cb559-69f72.png" data-srcset="/static/2019-12-17-01-15-29-de9c45895e4736b242c400cd0f2cb559-c0897.png 200w,\n/static/2019-12-17-01-15-29-de9c45895e4736b242c400cd0f2cb559-d12a6.png 400w,\n/static/2019-12-17-01-15-29-de9c45895e4736b242c400cd0f2cb559-69f72.png 464w" data-sizes="(max-width: 464px) 100vw, 464px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>类似的，可以检测宽屏设备比例等。</p>\n<h2 id="是否支持某字体"><a href="#%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E6%9F%90%E5%AD%97%E4%BD%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>是否支持某字体</h2>\n<p>例如，用户是否电脑是否安装了思源黑体：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65104569704077345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@font-face {\n  font-family: anyFontName;\n  src: url(../image/pixel.gif?font=unmatch&id=s_h_s);\n}\n\n.element-with-text {\n  font-family: \'Source Han Sans CN\', \'anyFontName\';\n}`, `65104569704077345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@font-face</span></span> <span class="token punctuation">{</span>\n  <span class="token property">font-family</span><span class="token punctuation">:</span> anyFontName<span class="token punctuation">;</span>\n  <span class="token property">src</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>../image/pixel.gif?font=unmatch&amp;id=s_h_s<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.element-with-text</span> <span class="token punctuation">{</span>\n  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">\'Source Han Sans CN\'</span><span class="token punctuation">,</span> <span class="token string">\'anyFontName\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个要看 font 请求，如果你的浏览器没有安装思源黑体，则会尝试加载 anyFontName 这个字体，于是发起了请求，如下图所示：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-17-01-16-50-e4c09adfa7c56fd3d88fc37e380fe6eb-15ae1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 551px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 27.223230490018146%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwklEQVQY022OzW6DMBCE/f4v11yqVg2KVArrtXfjNWADipDogJJb5jD+1uOfcUPORLQsyzwvZtkzSxRmjlHMDE7kSynMYRzHWutUCvZ7osvlw021th1/fl1vv33Q3LOymI8JoDYBMA71kYZ5KA+10nkRyZbr98/Nbdu27/s4lVpnEY2IREPAl+ATosAD/MgUFTx5dGzbP4fCKLOuKzy8xOzP5k/wRFjjoSOlrsdLTdM43FHV+yl7Kef8lp9jSpYM5/8B0I4U5M+cIe4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 17 01 16 50" title="" data-src="/static/2019-12-17-01-16-50-e4c09adfa7c56fd3d88fc37e380fe6eb-15ae1.png" data-srcset="/static/2019-12-17-01-16-50-e4c09adfa7c56fd3d88fc37e380fe6eb-73206.png 200w,\n/static/2019-12-17-01-16-50-e4c09adfa7c56fd3d88fc37e380fe6eb-cbb5b.png 400w,\n/static/2019-12-17-01-16-50-e4c09adfa7c56fd3d88fc37e380fe6eb-15ae1.png 551w" data-sizes="(max-width: 551px) 100vw, 551px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果安装，则没有上报。</p>\n<p>我们还可以借助浏览器原生行为简化我们上报成本，比方说表单验证出错，用来统计用户注册或者其他重要表单操作的成功率。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29827191173954360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.track:invalid {\n  background: url(./pixel.gif?action=regist&status=invalid);\n}\n\n.track:valid {\n  background: url(./pixel.gif?action=regist&status=valid);\n}`, `29827191173954360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.track:invalid</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?action=regist&amp;status=invalid<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.track:valid</span> <span class="token punctuation">{</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>./pixel.gif?action=regist&amp;status=valid<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>每当表单提交的时候，我们给 form 元素添加类名.track，此时，其会自动上报表单是否填写完全成功，:invalid 和:valid 都是标准的原生的 CSS 伪类选择器，我们无需自己写验证逻辑。</p>\n<p>JS 如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30174561256766230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`forms.addEventListener(\'submit\', function(event) {\n  event.preventDefault();\n  // 上报成功与否\n  this.classList.add(\'track\');\n  // 这个是不影响原生表单的提交行为，实际开发多走Ajax\n  if (this.reportValidity()) {\n    this.submit();\n  }\n  setTimeout(\n    function() {\n      this.classList.remove(\'track\');\n    }.bind(this),\n    0\n  );\n});`, `30174561256766230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">forms<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 上报成功与否</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'track\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 这个是不影响原生表单的提交行为，实际开发多走Ajax</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reportValidity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span>\n    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'track\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token number">0</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>HTML 这里也需要 novalidate 属性配合下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70568235724121320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<form novalidate></form>`, `70568235724121320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">novalidate</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>不过，这种方法有个缺陷，无论成功与失败，只能上报一次。</p>\n<p>表单的 reportValidity()方法虽然很省力，但是会呼起浏览器原生的提示，过不了设计师那一关的，因此，恩，大家 high 一下即可。</p>\n<h1 id="纯-css-实现-html-验证与提示"><a href="#%E7%BA%AF-css-%E5%AE%9E%E7%8E%B0-html-%E9%AA%8C%E8%AF%81%E4%B8%8E%E6%8F%90%E7%A4%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>纯 CSS 实现 HTML 验证与提示</h1>\n<p>再说说另外一个纯 CSS 应该，那就是进行 HTML 验证，并且直接在页面上输出来。</p>\n<p>举个简单例子，图片如果空 alt 属性，则高亮这个图片：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68903280137503646000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img[alt=\'\'] {\n  outline: 2px solid red;\n}`, `68903280137503646000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">img[alt=\'\']</span> <span class="token punctuation">{</span>\n  <span class="token property">outline</span><span class="token punctuation">:</span> 2px solid red<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>又或者_blank 链接的 rel 属性没有加 noopener 和 noreferrer。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13315203142431953000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a[target=\'_blank\']:not([rel=\'noopener noreferrer\']) {\n  outline: 2px solid red;\n}`, `13315203142431953000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">a[target=\'_blank\']:not([rel=\'noopener noreferrer\'])</span> <span class="token punctuation">{</span>\n  <span class="token property">outline</span><span class="token punctuation">:</span> 2px solid red<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后配合伪元素在页面上显示提示的文字：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43569433328418030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`script[src]:not([async]) {\n  display: block;\n}\nscript[src]:not([async])::after {\n  content: \'试试给带有[src=&quot;…&quot;]的<script>元素添加[async]属性\';\n}`, `43569433328418030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">script[src]:not([async])</span> <span class="token punctuation">{</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token selector">script[src]:not([async])::after</span> <span class="token punctuation">{</span>\n  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'试试给带有[src="…"]的&lt;script>元素添加[async]属性\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后，就有清闲的有志之士还专门搞了个通过 CSS 验证检测 HTML 合法性的 CSS 库，名为 construct.css，项目地址为：<a href="https://github.com/t7/construct.css" target="_blank" rel="nofollow noreferrer noopener">https://github.com/t7/construct.css</a></p>\n<p>这里有个 demo，有兴趣的可以进去瞅瞅。</p>\n<p>使用很简单，你的项目引入这个 CSS，那些使用有问题的 HTML 就会标记并提示，类似下面截图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-17-01-24-23-1c07fabdc090b42e2829aa8bab396c17-e5a09.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 91.79046129788897%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAACHklEQVQ4y41Sv2sUQRTeJiAoaKe1CipBEBRMkbtCRGyEqIWNCrGzEK0VbOxsAtraRUH8GwSJKQ5SKAE1cuKZO2+VXMxmZ+fXm5/PmduNyf2A8+NjmDe737z3vnmJ68N777yzexBCXwL9KBARABIAxbkAqQKLguXbhOS0IEyB6f8zBuG6sJKcJAiI1KDSFQG8BLQeCMnS7p9f6Waabvzs9rpput7utNY7rXar+Z3nrPe7l6D2tv1BfVsSzeXi61K29n5j9W3z3eKLh9fvzp25cfHUldrx+unDtZOHjh2ZOrAvObh/KkmS5wsLBmwUsx8fs7Xl3pdG91Oj83ml8ebp4pNbzx7NP75/+8GduXs3L89frV+7NHOhdm525mx99vz0iaOvX70MlQcxOoKWeCudVc6HTrVHh+h3WxwDi1roBBU67oBDCMLqjItKO0gzGGpEWYo1SiYFE7wIDmurjOkzXrGXFodOdsWMMkooCBWVEDksHrkriuMsGF/WExs23mlXrlbbSOXCvjz8xyhWOhFCbmVbeZFTziTIgFAEKOCCx3OSB1BKwxQOWaZ1KFsibiIW0YNgXpwZuUMYDOXAp6pnR50sZLBaclm5PanhkKYSG2GUVFpqzbUFGx9mIkux0z7LcpIRVjBa0O0sj+/kcWL+KrMvvMmNFTakjeP1/5ljz9IFk6Hv9air46H7YgvOMue4L2l5DCtyNxzu7J3wgsm/JjbsM6vgz7IAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 17 01 24 23" title="" data-src="/static/2019-12-17-01-24-23-1c07fabdc090b42e2829aa8bab396c17-fee1c.png" data-srcset="/static/2019-12-17-01-24-23-1c07fabdc090b42e2829aa8bab396c17-a67b7.png 200w,\n/static/2019-12-17-01-24-23-1c07fabdc090b42e2829aa8bab396c17-0b187.png 400w,\n/static/2019-12-17-01-24-23-1c07fabdc090b42e2829aa8bab396c17-fee1c.png 800w,\n/static/2019-12-17-01-24-23-1c07fabdc090b42e2829aa8bab396c17-b1a91.png 1200w,\n/static/2019-12-17-01-24-23-1c07fabdc090b42e2829aa8bab396c17-e5a09.png 1279w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h1>\n<p>本文提到的两个 CSS 的新奇应用，怎么说呢，有点像手工耿哥的的各种手工作品，很有新意，很有特色，可惜，并不实用。</p>\n<p>比方说一开始的数据上报，局限很大，很多行为你无法统计；另外维护非常不方便，把一大堆 URL 地址塞到 CSS 中，回头要是改个什么东西，很啰嗦的。CSS 是偏前前端的玩具，而数据上报偏后的前端更合适，实际开发肯定不会这么玩的，人力资源利用完全没有最大化嘛。</p>\n<p>还有那个 HTML 验证，这年头，还有谁关心 HTML 语义，结构啥的嘛，小程序，Vue 这种 HTML 结构都是自定义的，和标准越走越远了，没有市场，就没有价值。而且里面很多验证，有些想得太多，空 div 为什么就不能存在呢？我就想不通了。</p>\n<p>因此看来，本文介绍的这两个 CSS 应用，只适合远观，不适合亵玩。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/CSS数据上报和HTML验证/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-12-16 22:55:12",path:"/css-data-report-html-validate/",tags:"前端, CSS, CSS知识点",title:"CSS数据上报和HTML验证",draft:null}},{excerpt:"pointer-events:none 和覆盖层方法的问题 经常会遇到需求，需要禁用 div 中或者 form 元素中一堆表单控件元素，如 ， ， 元素。 很多人用的下面这两种方法实现： 设置 pointer-events:none，例如： 使用::before 伪元素创建一个浮层该在所有的表单元素上，例如： 以上两个方向虽然可以让点击无效，但是并没有阻止键盘访问，也就是 Tab 键索引，或者回车都能触发表单行为，使用 new FormData(form…",html:'<h1 id="pointer-eventsnone-和覆盖层方法的问题"><a href="#pointer-eventsnone-%E5%92%8C%E8%A6%86%E7%9B%96%E5%B1%82%E6%96%B9%E6%B3%95%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointer-events:none 和覆盖层方法的问题</h1>\n<p>经常会遇到需求，需要禁用 div 中或者 form 元素中一堆表单控件元素，如<code class="language-text">&lt;input&gt;</code>，<code class="language-text">&lt;select&gt;</code>，<code class="language-text">&lt;textarea&gt;</code>元素。</p>\n<p>很多人用的下面这两种方法实现：</p>\n<ol>\n<li>\n<p>设置 pointer-events:none，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41303001391411360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`form {\n pointer-events: none;\n}`, `41303001391411360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>\n <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>使用::before 伪元素创建一个浮层该在所有的表单元素上，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53784664593650320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`form {\n position: relative;\n}\n\nform::before {\n content: \'\';\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n background-color: rgba(0, 0, 0, 0.001);\n}`, `53784664593650320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>\n <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">form::before</span> <span class="token punctuation">{</span>\n <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.001<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>以上两个方向虽然可以让点击无效，但是并没有阻止键盘访问，也就是 Tab 键索引，或者回车都能触发表单行为，使用 new FormData(form)也能获取表单控件值，并不是真正意义上禁用，问题很大。</p>\n<p>那有没有什么简单方法轻松禁用所有表单元素呢？难道真要遍历所有的控件元素再设置<code class="language-text">[disabled]</code>属性吗？</p>\n<h1 id="fieldset-元素轻松实现"><a href="#fieldset-%E5%85%83%E7%B4%A0%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fieldset 元素轻松实现</h1>\n<p>其实，要真正意义上禁用所有的表单元素很简单，嵌套在<code class="language-text">&lt;fieldset&gt;</code>元素中，然后设置<code class="language-text">&lt;fieldset&gt;</code>元素 disabled 就可以了，代码示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95322539779914150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<form>\n  <fieldset disabled>\n    <legend>表单标题</legend>\n    <...>\n  </fieldset>\n</form>`, `95322539779914150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">disabled</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span>表单标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>...</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下图是 Chrome 浏览器下的效果：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-230f0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 408px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 129.9019607843137%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACoElEQVQ4y41UiW6cMBDN/39SlSZSumqqqk3VzaEsSVkWWE5z2fjg7jPOuSFpRyNkzDzG8+aNj+qaXf2+XJ2uzs++fvl89uPbz+0fRynFORcfGgKOGGNt20ohlFSzNbBuyfoXNgyDBud5vtlsyjSdZmvbhpDwradpwHk9vTAppc7M50NMfY+tvu8oLd96VRVNow7BlFLf9/eeNyj9DRGEBEURZ1mERZaFeR7hmaY+52wpM+cVpUqIaRyHcVRKEkLqukZt4IAxijjUjDoXMnuet91uS0IAxu7QD7Zt53kxH6TBV8RgPc5fX4HLEmSlO9cNfR9bqlFZFtc16iyGoZ/eNw2uqgqEB0GQhKFhuyxS7MEPzrkMjsIIZyuTdBpG1BmGEf4lpdL9lxKMvAtGPeAMyfEyt6rP88y8omA5mxHGcmbHcW5vb6+vr/Gjrmtd13ace8u6se0NmgSFJImPzi2wjZYgg5HrOPcpinZR5MaxmyQe2ju7tww+KAngGabBehE/LpLg32CIgbFSCCZELWXNOYWwsFOW+UKfD8CIQBUJEgWB63ogDzjsLLP9thPAE5KGYYj+FXkG5cr3wCBMdT1XjWha2XZMyCgmeUkTkqVZkVeUlbSmrBJSti1ijCMSBB+hy1ktkoqllV54UXJyuvp+cfnp+PT4ZHX+89L+deVcrC0vzE0YreGEcfChM+th0POkD9wPmhbDzDiXMDw6Pj05gvWxi6K4u7vDGDnbrbvbQZIgfPoPe5hnJIe2cAysur6TUih9oWnH3QDHtIyzodVm8SxP3GHr9RrJIdKyLO7vb4w7jgV5QSGQFyagmA2yNzp/YFvX/PhLLOZZALnCpH3KbGLM8xX4yVCzZVn7/f7jYX4eSf7C8Ap5xHFs7rYPDAF/AXmB0349KztQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 21 05 19" title="" data-src="/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-230f0.png" data-srcset="/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-132f8.png 200w,\n/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-274bb.png 400w,\n/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-230f0.png 408w" data-sizes="(max-width: 408px) 100vw, 408px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Firefox 浏览器下：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-65498.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 409px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 133.74083129584352%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACm0lEQVQ4y41UXVfbMAzl//+dnQ14GIyHnT0NKKOUtSVl+f50GtuJEztNdx3TUErKdo/bo6qSJV3JOhFVNZ3ef724vMTn4tv19Y1lWW3b1nXdfAgYnOCjlJR13SrV7rA5gu0elFInZcknk0kWRC8qKckR5HmOewdnyDpyVZZVVXX9H1CVR6Btuu6NM1Su6zxbz21ZQSWlXK/XjDFKKYSiKAYZeB9Z4FbKWC3EttMAGUiSMW5ogycMIKPI/ZpN5HK1shbLReIH282m67XL5SIMNQuyaWzHzgiBvJ/zq3MYho7jBK6rrZVCqkKggxXnXJcqBMrN3+a85xwEtm17tjPUXPKSFq+AJknTkbQRIoljz/dolm37ZkZR6LougkOGBSjYjqF3FhXoiaIInEIF+zAMXM9D2ghlJqnnsRtxxpBY1mo+n89mj/m66LpNnq8JycIoiuOY7mCIeB9ZoJOYHpITzCdqzrIsTdMkTSCgWvxlvkHeofNBSYawfaoM4IxCDp1RkvlhqmrGZlvnRci/I0OF9g7vEYLpOcoewhx1RnyYBr63Wq3mi4Xv+yTLcN14q8ba2KVJArKNZ0EL0dRH+ownKVXZSH2kYpXwwwgeSUYSQmKS84KyghWVeDXrD9jRrSKsTCnHIbzy4vTz6dnV9x9fzs4/nZ6fXl4939wuft4++dGai7TgGS3NEXUDthuwvMFw9Kftd83+NOGh6YPRe3v0GuKM/X58BDfL5RNWn+j53f4HXias5BydYJwVlGILokFyB1xlXuLR2X6Y/rqb3CHyw2yG6cLr/2Pbjud5gX8/vcewYkowsHi53MxJf9GuVai2bc3d2CVS6ZjDDh5ijmySg7kBsJLwyOD/cc2asH7p61hqB70uGUNG6kPA4C9wjBOL0nL2kAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 21 05 37" title="" data-src="/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-65498.png" data-srcset="/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-67408.png 200w,\n/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-5cbc3.png 400w,\n/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-65498.png 409w" data-sizes="(max-width: 409px) 100vw, 409px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Edge 浏览器下：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-bb574.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 410px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 127.3170731707317%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACXklEQVQ4y42UWY+qQBSE/f//RuOTz9fk7tfMg6CggAou7C3IFuF+0DPGGXEyFULo011dhzqneyCEmEwm4/F4NBoNh8PpdHo8Hpumqeu6uUPdh0FVVb7vn04nv8P5fC6Kond18x4t2fN8dT6/FrkMJUlyeMB+v79cLj1kdMg8Z67bm+G5A7uc71CWZQ8ZprXZBIdDc70SYogUf4GalMUCx3H6ldlS6lRZRggLGIZhSAp5nqdpKmWv3dYfycwZhoF4JgSha10HQaDrOqvh8L3ZbJo+tGQ0SdK2beQIIRWGkejw6HAP2XVd07Ii1yVEIr6PXhBFUfMpXsnb7Za0kzAgFEaRqiiGabYb+D6GseApmR9DBE6Vt6WORWwahuPsow6u5/IjrMOCx54bxHGsKMpisVBVlUkRi/V6RSJEMNLzPBxBn1+Tu7wjUxtqyISsJEUyTROH5Xu329kdKPUHC1vybSw/SBXO9gHwybGffGt99BHHc3TkOxaCCJvSM0+VJaR/q9WKtJfLpee6eP7U7cdOwIXuVCRRGOZZlpVl3dT95KKqxCWXT5KX2/1RNy3sVjV9vdlathPbjk3l0uy2jCdO80tRDvKqCtOMuTC5iKxYGtbPP/9+z16+ff/x6+/sRVm46kJbrlyRsCB4e/xzmmRFWyp5gADfPel90p5cPZqmGcYa0Alyo+YLaMkshYPD7EJJGAYBhYmJYFv6BqpAXmUHebZfz/N8PqcwlmXRCRwHbUkihqbrGHW7w1gmux2NrLs2ekolb5LsC5m3ZHlcrh3aUxVFs9mM/uy9d+7vYD7+A/xZmnZbr4E6AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 21 05 58" title="" data-src="/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-bb574.png" data-srcset="/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-0fa18.png 200w,\n/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-c3228.png 400w,\n/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-bb574.png 410w" data-sizes="(max-width: 410px) 100vw, 410px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="ie-浏览器的瑕疵和解决"><a href="#ie-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E7%91%95%E7%96%B5%E5%92%8C%E8%A7%A3%E5%86%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE 浏览器的瑕疵和解决</h1>\n<p>然后，IE 浏览器（包括 Edge）下有个瑕疵，那就是 UI 样式上虽然禁用了，键盘也无法响应，但是，输入框内容居然可以输入，而且表单的提交行为居然也可以点击触发，有些不完美，怎么办呢？</p>\n<p>可以再辅助下面的 CSS：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97883899014184570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fieldset[disabled] {\n  -ms-pointer-events: none;\n  pointer-events: none;\n}`, `97883899014184570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">fieldset[disabled]</span> <span class="token punctuation">{</span>\n  <span class="token property">-ms-pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n  <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>IE10+浏览器都可以完美禁用。</p>\n<p>如果兼容 IE8，IE9 浏览器的话，那使用伪元素创建一个浮层覆盖在所有表单元素上面，就是一开始提到的覆盖方法</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/如何disabled禁用所有表单input输入框元素/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 21:00:30",path:"/disabled-all-form-elements/",tags:"前端, DOM, DOM知识点",title:"如何disabled禁用所有表单input输入框元素",draft:null}},{excerpt:"图片服务器需要配置 Access-Control-Allow-Origin 一般团队都会有一个专门域名放置静态资源，例如腾讯是 gtimg.com，百度是 bdimg.com；或者很多团队使用的是腾讯云或者阿里云的服务。 而主页面所在域名往往不一样，当需要需要对 canvas 图片进行 getImageData()或 toDataURL()操作的时候，跨域问题就出来了，而且跨域问题还不止一层。 首先，第一步，图片服务器需要配置 Access-Control-Allow-Origin…",html:'<h1 id="图片服务器需要配置-access-control-allow-origin"><a href="#%E5%9B%BE%E7%89%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE-access-control-allow-origin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图片服务器需要配置 Access-Control-Allow-Origin</h1>\n<p>一般团队都会有一个专门域名放置静态资源，例如腾讯是 gtimg.com，百度是 bdimg.com；或者很多团队使用的是腾讯云或者阿里云的服务。</p>\n<p>而主页面所在域名往往不一样，当需要需要对 canvas 图片进行 getImageData()或 toDataURL()操作的时候，跨域问题就出来了，而且跨域问题还不止一层。</p>\n<p>首先，第一步，图片服务器需要配置 Access-Control-Allow-Origin 信息，例如：</p>\n<p>如 PHP 添加响应头信息，*通配符表示允许任意域名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46231646300695495000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(&quot;Access-Control-Allow-Origin: *&quot;);`, `46231646300695495000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="php"\n              >\n                <span class="gatsby-code-button-language">php</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Access-Control-Allow-Origin: *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或者指定域名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21981051282476870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(&quot;Access-Control-Allow-Origin: 你的网站域名&quot;);`, `21981051282476870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="php"\n              >\n                <span class="gatsby-code-button-language">php</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Access-Control-Allow-Origin: 你的网站域名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时，Chrome 浏览器就不会有 Access-Control-Allow-Origin 相关的错误信息了，但是，还会有其他的跨域错误信息。</p>\n<h1 id="canvas-图片-getimagedata-cross-origin-跨域问题"><a href="#canvas-%E5%9B%BE%E7%89%87-getimagedata-cross-origin-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 图片 getImageData cross-origin 跨域问题</h1>\n<p>对于跨域的图片，只要能够在网页中正常显示出来，就可以使用 canvas 的 drawImage() API 绘制出来。但是如果你想更进一步，通过 getImageData()方法获取图片的完整的像素信息，则多半会出错。</p>\n<p>举例来说，使用下面代码获取 github 上的自己头像图片信息：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91013931634367370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.createElement(\'canvas\');\nvar context = canvas.getContext(\'2d\');\n\nvar img = new Image();\nimg.onload = function() {\n  context.drawImage(this, 0, 0);\n  context.getImageData(0, 0, this.width, this.height);\n};\nimg.src = \'https://avatars3.githubusercontent.com/u/496048?s=120&v=4\';`, `91013931634367370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'https://avatars3.githubusercontent.com/u/496048?s=120&amp;v=4\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果在 Chrome 浏览器下显示如下错误：</p>\n<blockquote>\n<p>Uncaught DOMException: Failed to execute ‘getImageData’ on ‘CanvasRenderingContext2D’: The canvas has been tainted by cross-origin data.</p>\n</blockquote>\n<p>Firefox 浏览器错误为：</p>\n<blockquote>\n<p>SecurityError: The operation is insecure.</p>\n</blockquote>\n<p>如果使用的是 canvas.toDataURL()方法，则会报：</p>\n<blockquote>\n<p>Failed to execute ‘toDataURL’ on 　’HTMLCanvasElement’: Tainted canvased may not be exported</p>\n</blockquote>\n<p>原因其实都是一样的，跨域导致。</p>\n<p>那有没有什么办法可以解决这个问题呢？</p>\n<p>可以试试 crossOrigin 属性。</p>\n<h1 id="html-crossorigin-属性解决资源跨域问题"><a href="#html-crossorigin-%E5%B1%9E%E6%80%A7%E8%A7%A3%E5%86%B3%E8%B5%84%E6%BA%90%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML crossOrigin 属性解决资源跨域问题</h1>\n<p>在 HTML5 中，有些元素提供了支持 CORS(Cross-Origin Resource Sharing)（跨域资源共享）的属性，这些元素包括<code class="language-text">&lt;img&gt;</code>，<code class="language-text">&lt;video&gt;</code>，<code class="language-text">&lt;script&gt;</code>等，而提供的属性名就是 crossOrigin 属性。</p>\n<p>因此，上面的跨域问题可以这么处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57028083054452064000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.createElement(\'canvas\');\nvar context = canvas.getContext(\'2d\');\n\nvar img = new Image();\nimg.crossOrigin = \'\';\nimg.onload = function() {\n  context.drawImage(this, 0, 0);\n  context.getImageData(0, 0, this.width, this.height);\n};\nimg.src = \'https://avatars3.githubusercontent.com/u/496048?s=120&v=4\';`, `57028083054452064000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'https://avatars3.githubusercontent.com/u/496048?s=120&amp;v=4\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>增加一个 img.crossOrigin = ”即可，虽然 JS 代码这里设置的是空字符串，实际上起作用的属性值是 anonymous。</p>\n<p>crossOrigin 可以有下面两个值：</p>\n<ul>\n<li>anonymous：元素的跨域资源请求不需要凭证标志设置。</li>\n<li>use-credentials：元素的跨域资源请求需要凭证标志设置，意味着该请求需要提供凭证。</li>\n</ul>\n<p>其中，只要 crossOrigin 的属性值不是 use-credentials，全部都会解析为 anonymous，包括空字符串，包括类似’abc’这样的字符。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25225240428799676000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img.crossOrigin = \'abc\';\nconsole.log(img.crossOrigin); // 结果是\'anonymous\'`, `25225240428799676000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">\'abc\'</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>crossOrigin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结果是\'anonymous\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 269px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.12267657992565%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVQoz4VS24rCMBTs//+OeEGhUPTNF8FtLUitG2ua9KLWNml6SbvTyrILi+wQwuQkc2Y4xMiy7PF4NE1TlmVVVc0ftG0rikIphVu8qesaFdRBjOOIvu8JIbfbDaTrun4ESKs1SJKmQog8z33fj+MYdXThnBtDB6VkUaAtdlWW8JFSCinrqmrHSBpuY4SXIQgeMMYMhMmV+vC88H4PksSjNIhj/3w+HA6yeOpaleQiCMmfTyj1GARACw5xD8Ptlq5Wl8XiMp9nm81pNiO+bztOEASMcUQ9fw7Y7/eUUphBjH0UH4+FZTHXTR0n3O1Sz6tMU1+vsEC8/hv6F37E3ekkJpNovY5MM1wuI8uqp9M+SV4T699giI2BlUIUhHDbZrYdu25k2xK2Wg/zeQPcYtosDA0ahlfGrpzTKMICGY7/AePAB/kCMM34H+DOrC8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 20 51 41" title="" data-src="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png" data-srcset="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-b37f7.png 200w,\n/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png 269w" data-sizes="(max-width: 269px) 100vw, 269px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>另外还有一点需要注意，那就是虽然没有 crossOrigin 属性，和设置 crossOrigin=“use-credentials”在默认情况下都会报跨域出错，但是性质上却不一样，两者有较大区别。</p>\n<h2 id="crossorigin-兼容性"><a href="#crossorigin-%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>crossOrigin 兼容性</h2>\n<p>IE11+(IE Edge)，Safari，Chrome，Firefox 浏览器均支持，IE9 和 IE10 会报 SecurityError 安全错误，如下截图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 356px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 29.213483146067414%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABBElEQVQY02VN2WrDMBDM/39ZoXlIE9qASxxbkQ/JOlZaWVdst3LpQ6HDsMwMM+zhlTkNM53cY3ICJyJq7eS1e5+93dZ1W5dyn8vyl8u6ppxTSoc6bQ33ElOvY831uWM3gZ9SjJhM2riJyuWvfwghgIaDOZ7OzFcULgTqEQXhgjDbT6btYeBSWoUh5uxTCql8y6GI/FTG7mP6cjo+bEX1W6M+iGpvXXNtuhulFRnuD9IJKl0z2UFiy23NLBWo0I9C6TLW8dlMjoPv5NxyrJi7y9DbOJjIMJewV3OvvTB+UHOxTPs5ZgV2H4NSaMGAtgbQgNupsdgflqTkRfwWStNAgRDCe/8N9W9QOYlOEfoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 20 52 38" title="" data-src="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png" data-srcset="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-8eb8a.png 200w,\n/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png 356w" data-sizes="(max-width: 356px) 100vw, 356px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="crossorigin-属性为什么可以解决资源跨域问题？"><a href="#crossorigin-%E5%B1%9E%E6%80%A7%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E8%A7%A3%E5%86%B3%E8%B5%84%E6%BA%90%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>crossOrigin 属性为什么可以解决资源跨域问题？</h1>\n<p>crossOrigin=anonymous 相对于告诉对方服务器，你不需要带任何非匿名信息过来。例如 cookie，因此，当前浏览器肯定是安全的。</p>\n<p>就好比你要去别人家里拿一件衣服，crossOrigin=anonymous 相对于告诉对方，我只要衣服，其他都不要。如果不说，可能对方在衣服里放个窃听器什么的，就不安全了，浏览器就会阻止。</p>\n<h1 id="ie10-浏览器不支持-crossorigin-怎么办？"><a href="#ie10-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E6%94%AF%E6%8C%81-crossorigin-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE10 浏览器不支持 crossOrigin 怎么办？</h1>\n<p>我们请求图片的时候，不是直接通过 new Image()，而是借助 ajax 和 URL.createObjectURL()方法曲线救国。</p>\n<p>代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20524912602667110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var xhr = new XMLHttpRequest();\nxhr.onload = function() {\n  var url = URL.createObjectURL(this.response);\n  var img = new Image();\n  img.onload = function() {\n    // 此时你就可以使用canvas对img为所欲为了\n    // ... code ...\n    // 图片用完后记得释放内存\n    URL.revokeObjectURL(url);\n  };\n  img.src = url;\n};\nxhr.open(\'GET\', url, true);\nxhr.responseType = \'blob\';\nxhr.send();`, `20524912602667110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 此时你就可以使用canvas对img为所欲为了</span>\n    <span class="token comment">// ... code ...</span>\n    <span class="token comment">// 图片用完后记得释放内存</span>\n    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  img<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">\'GET\'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">\'blob\'</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此方法不仅 IE10 浏览器 OK，原本支持 crossOrigin 的诸位浏览器也是支持的。</p>\n<p>也就多走一个 ajax 请求，还可以！</p>\n<p>根据，根据实践发现，在 IE 浏览器下，如果请求的图片过大，几千像素那种，图片会加载失败，我猜是超过了 blob 尺寸限制。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/解决canvas图片getImageData,toDataURL跨域问题/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-12-15 20:32:54",path:"/crossorigin-canvas-getimagedata-cors/",tags:"前端, DOM, DOM知识点",title:"解决canvas图片getImageData,toDataURL跨域问题",draft:null}}],page:26,pagesSum:46,length:229,prevPath:"/page/25",nextPath:"/page/27"}}}});