webpackJsonp([0xf6623daae6dd],{1201:function(n,s){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlElEQVRIx12We2xT5xXAbcI2Vmn7o1I1uhVYRxL8tuPn9bXv0+/4/YgdOyYkkATCCEEYsqVNC2wCIYQWShmUBFh4hMAWECot0BUtlI4yAS1oKqJQXimsDBgTU8codnLO7r0uUPpJn87Rp+/8vvOdc75zr8xmZmTieI1NykU5yxOfxDncz3NUjAlyDXMjXGMhys+cG+FzGQ8VU4t7XuV8z8m+GUkrJclSqVReYJ0ZWQ8Tl2AdTPhnq9ns2QKd+crDZiHha8NsYCE21HZiXphpb3sxxTf99Tdsw51ldHqFaLOXXyzvYqOyZ0YPk5soylfouuUbvHOxh56JbiqJfi4/FnE1lxKetrGUZ954nbcdU/752ORpxWVsc6mZjPxctFtApeVtra1lmIPwTxClgeCqvGTsX/WWOEbtyTGWSoGbToOPzUHQ1QghVxOEhRniZ5U8XB4TzvTdgj1ZJdq2OOrkGhVRBnrYFum6TiK0l2fr0emMlVxcBhlnEniqDjlBuqg0CnD0MPWiDrwzhR4u+5B3x3WiLUNHJjxzZYvR8ZKTCP+Xo1JoM/nBYvSB1egHuyUIrCOBPj4LtD0KlD2K4h7SGip62aygxzaK9rHA3Aqt2vw0MRYjnyJtYaQdsXG9hgWFwgmVlXZUKUjUqmm0CgfwhA80Kgr1Wg40Sue4SuFEnZq+YjMbJ0kh0zmfemjQ0j2EJYh2a23RVOODIBvHmCsBUaoWLDoWKIsP50bTApxC5QwH1Ghp0Gk4MBk8aDLQEslooCc88VClsK+zGANI2mqLer0XFuea8PSuN+DM7o3QWyhAR7IBfj+vDbyOICS9aSjkZo8nvSlUKuxXLDUOKdN6LSl/AlRUE+vNAnD50l8XeTIEPiYEzXYG5mlNeGz7BvjPpY/g5snDcHxwE+zs7oCh1zvHCrNm48u/ML8j2muVQblBZ3t6ZY2KXKtQcDiwdk1xx9rV0BlqghEuD4fNUTy1Zwhw7Cbioxu461fdsOgFDa5pbh3zu6NifE9f+XCPlGHS5nuaFI3K8brJ4EUHES4WFiyEP2/dCPc2vYH/3NIHePcywP1LWLp3Ec4tWQa3FvbAu7294yqVA801rju5utYfiQyKDD4DnC8GWEhMafJPtBALxuHjo3+C8bufIn59DfHBFcDiDcQvzyF+/iEsbWuDadNMaDW5H7nY6Iyyh165zfLNtdUqIqLTsEJSQqBVUTD1JQPqdRT8sf9NuH7kMHy0fRg+O3EUzp96H/Zs2SBklxFKxwFmowtdTCIoPQx7oKLzl32PPTRPVSudDwQgCrUGL0+twdzsDjjSdwD2J1fh/q7N0N+1EtykB178qVY4lAahRktWkw95JrG4DAxPvHU3Wwb+rlcsHfK0WNxCoMdUCgdUaxnMBPKw7dVe2LyhDw4MboORA4NQOd2CaiUFaqWjZJGAyQGRUeubP8FqElqZspquEBeUM2zrnEQUa3R8USVcp2qGDZV6ErqXL4PfrlwFhSU9cPL4MejfshOsZq90sCg5KvHZ5MnPfa+cmFrxukRFuRZNcYqIoNngHheeFmiF11ClIDBdPwfqG9qhc1E3rF25GnrX90M204JqBfWItPrP8lTqa7vFpSw3GJ9cZjI4pW5TXaWezpKxh4Q5gEY9LwApVOtZMApxVWhd2DKvC7K5FjTUsFCj45Ah4yXaHuz1MBlgyHCb1HXISIXMTcekOJqN1h/72Mx92h5DwuwHjeChWseBQsNgJJ6H944eB5oNgaLajnaL/07E24wuKr7Cz+XuuenUsMioCxYmyHhnSPLQTYVVYVfjI46Mo80WBLMgLY4E1FhCOENBAsfHQG/0juuNPqGguU8ywXas5XNbg6783wJ8w781GtUPJc+irkap/Ufdje0JXytStnDJbA2D1Z4EKxEHsyUMRmsIdcZaNFpCYBYqwWQLPhD3Btn6t2Pe5uF0cD7Sdr/xmSab8racFaDooOvuk0wDEs40EFQGbVQGbEKXJoTPgZ3JoJGIgULvR6M1jE67rzvpae5ojC7GEJ9rfgILc7lC3NV0T6flTtjoPLK+VuD8rcD65gDtaQInPxOtzoxQRrXgD8/BdW/+YezYByfxvfdHvnxl+ZLKCDfzUMIze60Ey+brJukrqcjA1u3tBw8dfZiZuRQFaNFory/WEPUlE5kFK5WDQKRtbFPfUOnChUvFL27cwKuj/8CBHXv2iQw/k/KGuNwyCYiIkhw+sO/569eu7b1+ffR/H5z4BAcG38X1m/biyjX9ODR8GC9dHsXLV0fx5KlzePDIyFd7ht9ZJZhJrcvLhV/wMuUPljQWtC6Z+FjfuWPHlPMXLq64Onpz3d8/Pf9WX//OW2vWbITBof3n3tqya9fbh/7SvW1gZ9Xj/V1dr8kf614qIZONjBwrezi8Ty54K5d9ZzTmF+xe1LnioaD+4Nvrn4/ermif3yHp8UCDLMCky7Z+n192+/YdST9z5mPZ7t1D8ouXv6gQ4S9WTplks7mut8xZijxbKz2vvi2D39/cPyB/HC5xOm2czPvd35F8rkGCS0+I4WXV1QbJaMq06XqbNXCQJIILpH8hOic3GghZMpl62qG/Nf4PRzaQ862MzO4AAAAASUVORK5CYII=",aspectRatio:.6666666666666666,src:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png",srcSet:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-8a97b.png 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-0fdf3.png 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png 600w",srcWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp",srcSetWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-5d70e.webp 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-d1677.webp 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<p>之前，CSS 世界中除受限诸多的表格布局之外是没有专门的布局属性的，随着 Web 应用越来越复杂，显示设备越来越多样，原有的 CSS 特性已经无法满足现代 Web 开发需求了。于是，CSS 定义了很多全新的布局方式，这些新的布局 CSS 使用简单，效果精美，是所有前端开发者必学必会的技能。</p>\n<h1 id="分栏布局"><a href="#%E5%88%86%E6%A0%8F%E5%B8%83%E5%B1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分栏布局</h1>\n<p>分栏布局也被称为多列布局、多栏布局，这种布局可以将内容布局到多个列框中，类似报纸上的排版。</p>\n<p>分栏布局比较特殊，有别于传统布局，它将子元素在内的所有内容拆分为列，这与打印网页的时候将网页内容分成多个页面的方式类似。分栏布局主要针对图文排版布局，应用在横向排版场景中，文档流是倒 N 方向。有个别布局只能使用分栏布局实现，分栏布局虽然在日常开发中用得不多，但是遇到合适的场景时是一种非常有用的布局方式。</p>\n<p>IE10+ 浏览器都可以使用分栏布局，API 稳定，在移动端的兼容性比弹性布局要好，可以放心使用。例如，有一段无序列表，HTML 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96075345984633470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<ul>\n   <li>重庆市</li>\n   <li>哈尔滨市</li>\n   <li>长春市</li>\n   <li>兰州市</li>\n   <li>北京市</li>\n   <li>杭州市</li>\n   <li>长沙市</li>\n   <li>沈阳市</li>\n   <li>成都市</li>\n   <li>合肥市</li>\n   <li>天津市</li>\n   <li>西安市</li>\n</ul>`, `96075345984633470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>重庆市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>哈尔滨市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>长春市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>兰州市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>北京市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>杭州市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>长沙市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>沈阳市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>成都市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>合肥市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>天津市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>西安市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到每一个列表项的内容很少，如果容器的宽度足够，则可以使用 columns 属性实现分栏布局，让排版更舒服，代码超级简单：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83890649356669760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`ul {\n   columns: 2;\n}`, `83890649356669760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">ul</span> <span class="token punctuation">{</span>\n   <span class="token property">columns</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 6-1 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-04-01-00-09-57-4cccb1966e86df0d70574a6cbeeef636-a36d1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 604px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 68.87417218543047%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAAB9ElEQVQoz6WRW4+aQBzF+f7foe17k6bbNF2ji/Wy4q3tKgLLLkqFGWa4XwXlIto/NWnaGJ96HiYzwxzO/M4wpmWFrvXu7ZsnfrXg+a2un8/n0+l0/kuX5W63C8PQti1Zljeb9ZLnmTTLDvuM53nDIKZl+r5f1/84/6goijzPkzgmhmGCbIshhCRhNJvOFFWVBIHjxrwgVMf6OjlJEt/3XNeZjKZzbs6LIpMXRZkXGGHbdeFHBqXZPqvr+jq5+q1dHG+3GtKQadsMQihN0/VaabXuuemMmuYt5iiOPc+lBD+wnXaPXUkSU5ZlVZaB7wEJJiSMomvzRcdGVZbuNE1X1hvLcZrkfZYKK0AQl6JkGMbN5CjyPN+kePB1wA0moiwz0CEke56DdF3HOAjDW8kADNFRGGiatlFVuCaDMd4f9qr6ulgunl9eCL3JHMcJdB0E7rMk9h9HsqIwB9A+/blVgVlDyPW8W8lNO1VpmURq6AhCGJhxEgfLp++CKKxkmVAC5+CpwH8ZLxPYDMMIHhmj7eNwOP/243WtMOf/UGO2bNt23PyQN+VVR+iMWrDnUNMKwshxPd8PPD+g1IKpQShcAb7D2JjZbr/VZhHGgA+HOmzvge2PuOnd5/vhaDyZzkeTWbc3/PjpCyzff7gbT2btTnfJC78A77gIHRn20q0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 04 01 00 09 57" title="" data-src="/static/2022-04-01-00-09-57-4cccb1966e86df0d70574a6cbeeef636-a36d1.png" data-srcset="/static/2022-04-01-00-09-57-4cccb1966e86df0d70574a6cbeeef636-765e7.png 200w,\n/static/2022-04-01-00-09-57-4cccb1966e86df0d70574a6cbeeef636-c9f48.png 400w,\n/static/2022-04-01-00-09-57-4cccb1966e86df0d70574a6cbeeef636-a36d1.png 604w" data-sizes="(max-width: 604px) 100vw, 604px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/1x8rly?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>相比其他布局方法，分栏布局最大的优点是不会改变元素原本的 display 计算值。例如，在默认状态下，<code class="language-text">&lt;li&gt;</code> 元素会出现项目符号，如圆点或数字序号。此时，如果对 <code class="language-text">&lt;li&gt;</code> 元素使用弹性布局或网格布局，则项目符号就会消失，因为 display: flex 或 display: grid 会重置 <code class="language-text">&lt;li&gt;</code> 元素内置的 display: list-item 声明。</p>\n<p>我通过以上内容带大家初步了解了分栏布局的特性和使用方法，接下来，我们开始详细了解与分栏布局相关的 CSS 属性。与分栏布局相关的 CSS 属性共有以下 10 个：</p>\n<ul>\n<li>columns</li>\n<li>column-width</li>\n<li>column-count</li>\n<li>column-rule</li>\n<li>column-rule-color</li>\n<li>column-rule-style</li>\n<li>column-rule-width</li>\n<li>column-span</li>\n<li>column-fill</li>\n<li>column-gap</li>\n</ul>\n<p>虽然这 10 个 CSS 属性都有各自的作用，但是在实用程度上却有明显的差异。根据我的开发经验，超过 80% 的分栏布局只需要使用 columns 属性就足够，因此，大家的学习重心可以放在 columns 属性上，column-gap 属性有时候也会用到，所以也可以关注下，至于剩下的属性，大家了解一下基本作用即可。</p>\n<h2 id="重点关注-columns-属性"><a href="#%E9%87%8D%E7%82%B9%E5%85%B3%E6%B3%A8-columns-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重点关注 columns 属性</h2>\n<p>columns 属性是 column-width 和 column-count 属性的缩写，举几个使用 columns 属性的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33059960285787150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*栏目宽度*/\ncolumns: 18em;\n\n/*栏目数目*/\ncolumns: auto;\ncolumns: 2;\n\n/*同时定义宽度和数目，顺序任意*/\ncolumns: 2 auto;\ncolumns: auto 2;\ncolumns: auto 12em;\ncolumns: auto auto;`, `33059960285787150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/*栏目宽度*/</span>\n<span class="token property">columns</span><span class="token punctuation">:</span> 18em<span class="token punctuation">;</span>\n\n<span class="token comment">/*栏目数目*/</span>\n<span class="token property">columns</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n<span class="token property">columns</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n\n<span class="token comment">/*同时定义宽度和数目，顺序任意*/</span>\n<span class="token property">columns</span><span class="token punctuation">:</span> 2 auto<span class="token punctuation">;</span>\n<span class="token property">columns</span><span class="token punctuation">:</span> auto 2<span class="token punctuation">;</span>\n<span class="token property">columns</span><span class="token punctuation">:</span> auto 12em<span class="token punctuation">;</span>\n<span class="token property">columns</span><span class="token punctuation">:</span> auto auto<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="关于-column-width"><a href="#%E5%85%B3%E4%BA%8E-column-width" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 column-width</h3>\n<p>column-width 表示每一栏/列的最佳宽度，注意，是“最佳宽度”，实际渲染宽度多半和指定的宽度是有出入的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21248528024148140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   width: 300px;\n   column-width: 200px;\n}`, `21248528024148140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n   <span class="token property">column-width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里容器宽度为 300px，设定每一栏的宽度是 200px，不足以分栏，此时容器里面的内容会无视 column-width: 200px 声明，并按照容器的 300px 宽度排版。又如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21923781347559410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   width: 200px;\n   column-width: 300px;\n}`, `21923781347559410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n   <span class="token property">column-width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里容器宽度为 200px，设定的每一栏宽度是 300px，比容器宽度还要宽，此时容器里面的内容会无视 column-width: 300px 声明，并按照容器的 200px 宽度排版。</p>\n<p>那么，什么情况下 column-width 设置的宽度值和实际渲染的宽度值一致呢？这个问题的答案可能会出乎大家的意料：几乎不存在分栏布局的栏目宽度就是 column-width 设置的宽度这样的场景。</p>\n<p>因为 column-width 和传统的 width 属性不同，column-width 更像是一个期望尺寸，浏览器会根据这个期望尺寸确定分栏数目，一旦分栏数目确定了，column-width 属性的使命也就完成了，接下来根据分栏数目对容器进行的分栏布局就和 column-width 属性没有任何关系了。</p>\n<p>没错，column-width 属性在分栏布局中就是一个工具属性。而且 column-width 相比 width 属性在语法上还有很多限制，例如 column-width 不支持百分比值，即下面的语句是不合法的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59054605229528590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 不合法 */\ncolumn-width: 30%;`, `59054605229528590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 不合法 */</span>\n<span class="token property">column-width</span><span class="token punctuation">:</span> 30%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="关于-column-count"><a href="#%E5%85%B3%E4%BA%8E-column-count" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关于 column-count</h3>\n<p>column-count 表示理想的分栏数目，又出现了很微妙的词——“理想的”，也就是意味着最终的分栏数目可能不受 column-count 属性值的控制。</p>\n<p>没错，在分栏布局中，最终分栏的数量是由 column-count 与 column-width 属性共同决定的，不对，不能称为“共同决定”，应该叫作“互相制约”。也就是说，在分栏布局中，最终分栏的数量要么由 column-count 属性决定，要么由 column-width 属性决定，这两个 CSS 属性都可能有更高的决定权，至于哪个 CSS 属性的决定权更高，是要看具体场景的。</p>\n<p>决定权优先级的计算诀窍可以用一句话概括：统一转换 column-count 值，哪个值小就使用哪一个。例如，下面的 CSS 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57813581490704966000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container-1 {\n   width: 360px;\n   column-count: 2;\n   column-width: 100px;\n}\n\n.container-2 {\n   width: 360px;\n   column-count: 4;\n   column-width: 100px;\n}`, `57813581490704966000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container-1</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n   <span class="token property">column-count</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n   <span class="token property">column-width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.container-2</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n   <span class="token property">column-count</span><span class="token punctuation">:</span> 4<span class="token punctuation">;</span>\n   <span class="token property">column-width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 .container-1 是 2 栏显示，而 .container-2 是 3 栏显示。效果如图 6-2 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-26-11-12-13-b39ca39ea6d0e9f56d6a3f3f6e0d6ef7-19c9a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 343px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.63265306122447%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACrElEQVQoz01S6W7TQBDug4KqlAdAgnIJ8RL84A8SlZDoQdVS1LulgKAHLeVQmjRx7PhKansdr2PHt9e7yzitU0bfjmZW82lnvtkpzvn7paXa9PSzp09mHz6YqdVURYZLSikvjXHGSj8JSn9jU3AOT3++mnv7bmVtbnH55es3+sAhnIcFCwoeMx5znlSIKAMfUpbSimxzjghzCRtS7lJ+FSQKHplx7hZc80LBwm3LERFuXdm6H0q2exXnelaRrbRQda3VuJA6HVFoy5LYajZVWSkKih1bU1VkGpoiy12pr/fEdmuALKeoyEZMBEmGouZFQ2iDCXK3q+i9oefZllmv14VOB1koDMM4TtI4iuPIyivyCIbhHFIYL+UcJ5kTZzgt3JTglAzCFODlbFQwmDagfEQ5ytkNudFoLK+ube7sbWzvrH5cx54Hl4SxovQcPB0HgJyya7CJ2vMLC3dqM4+fv7g/++juzD2hW64qoyxjAF6ijDmsgIwbTBmnbKJ2znpBagSxGaZWlDk5AxjQbUpQQlCcY8LthMAW+n4EKWzSmrRtE26CgMh0B7bR74VhAKq0LhsQa5omdgRGqYMQJIooBCMfKGZWkc2USpouK0pXli8FwcbDnOSiKImS1FHUvmEwxkBoVv0tkOD2ZSspoFQS2qos//117vsjeAo+qdqVdFW1TaMgOf/PgHerdj9lbYQVx9OGQbNvWQkxo0yyh93BUMV+xxr0/BjGBiEwKTHImZ5W5Hy8XkgTWraUjW+KSls6DrLrmjGSsfIl2UK27/usKKDVPMtG0LTvu9jFjjN03SgIbIQgdjEO/FEEnwwQhUBxsDu1vXewu//595+650GOj45Pvx2ebGzvLS5/WFvfql805xdXNrZ21zd3dj992T/4enb++/jH2fejE2D9AzTMbcodpPWEAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 26 11 12 13" title="" data-src="/static/2022-07-26-11-12-13-b39ca39ea6d0e9f56d6a3f3f6e0d6ef7-19c9a.png" data-srcset="/static/2022-07-26-11-12-13-b39ca39ea6d0e9f56d6a3f3f6e0d6ef7-11dc8.png 200w,\n/static/2022-07-26-11-12-13-b39ca39ea6d0e9f56d6a3f3f6e0d6ef7-19c9a.png 343w" data-sizes="(max-width: 343px) 100vw, 343px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>具体解析过程如下。</p>\n<ol>\n<li>.container-1 元素宽度为 360px，因此 column-width: 100px 换算成 column-count 的值是 3.6，而.container-1 元素已经设定了 column-count: 2，遵循“哪个值小哪个优先级高”的规则，最终 .container-1 元素的内容分成了 2 栏。</li>\n<li>.container-2 元素设置的是 column-count: 4，比 column-width: 100px 换算成的 column-count 值大，因此，最终 .container-2 元素的内容分成了 3 栏（3.6 栏向下取整）。</li>\n</ol>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/5kznl4?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>另外，从图 6-2 所示的 .container-2 的效果可以看出，分栏布局的每一栏的高度并不总是相等的，内容的分割也不总是均匀的，浏览器有一套自己的算法。</p>\n<h2 id="column-gap-和-gap-属性的关系"><a href="#column-gap-%E5%92%8C-gap-%E5%B1%9E%E6%80%A7%E7%9A%84%E5%85%B3%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>column-gap 和 gap 属性的关系</h2>\n<p>column-gap 属性表示每一栏之间的空白间隙的大小，可以是长度值，也可以是百分比值，语法示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55429846704144370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 关键字属性值 */\ncolumn-gap: normal;\n\n/* 长度值 */\ncolumn-gap: 3px;\ncolumn-gap: 3em;\n\n/* 百分比值 */\ncolumn-gap: 3%;`, `55429846704144370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 关键字属性值 */</span>\n<span class="token property">column-gap</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>\n\n<span class="token comment">/* 长度值 */</span>\n<span class="token property">column-gap</span><span class="token punctuation">:</span> 3px<span class="token punctuation">;</span>\n<span class="token property">column-gap</span><span class="token punctuation">:</span> 3em<span class="token punctuation">;</span>\n\n<span class="token comment">/* 百分比值 */</span>\n<span class="token property">column-gap</span><span class="token punctuation">:</span> 3%<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>column-gap 属性本身没什么好说的，但是 column-gap 属性和 gap 属性之间的关系值得一提。实际上，在分栏布局中，如果不考虑 IE 浏览器，我们可以直接使用 gap 属性设置分栏间隙大小，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23741766398462970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   columns: 2;\n   gap: 1rem;\n}`, `23741766398462970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">columns</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n   <span class="token property">gap</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>至于原因，用一句话解释就是：column-gap 是 gap 属性的子属性。</p>\n<p>在网格布局规范制定之后的一段时间，CSS 世界中的行与列之间的间隙使用了 gap 属性进行了统一，也就是分栏布局、弹性布局和网格布局的间隙都全部统一使用 gap 属性表示，而 gap 属性实际上是 column-gap 属性和 row-gap 属性的缩写。</p>\n<h2 id="了解-column-rule、column-span-和-column-fill-属性"><a href="#%E4%BA%86%E8%A7%A3-column-rule%E3%80%81column-span-%E5%92%8C-column-fill-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 column-rule、column-span 和 column-fill 属性</h2>\n<p>本节介绍的 3 个分栏布局属性都有各自独特的作用，平常不太用得到，多出现在对分栏布局效果要求更高的场景中。</p>\n<h3 id="了解-column-rule-属性"><a href="#%E4%BA%86%E8%A7%A3-column-rule-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 column-rule 属性</h3>\n<p>column-rule 属性是 column-rule-width、column-rule-style 和 column-rule-color 这 3 个 CSS 属性的缩写，正如 border 是 border-style、border-width 和 border-color 的缩写一样。</p>\n<p>column-rule 属性和 border 属性的语法和规则是一模一样的，只是 column-rule 是设置各个分栏的分隔线样式，border 是设置元素的边框样式。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15537864203637230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.container {\n   width: 320px;\n   border: solid deepskyblue;\n   padding: 10px;\n   column-count: 2;\n   column-rule: dashed deepskyblue;\n}`, `15537864203637230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.container</span> <span class="token punctuation">{</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span>\n   <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n   <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n   <span class="token property">column-count</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n   <span class="token property">column-rule</span><span class="token punctuation">:</span> dashed deepskyblue<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如图 6-3 所示，2 栏文字内容的中间出现了 3px 宽的虚线分隔线。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-26-11-25-30-890d4bca4aa72f86514d43bbd7e17f01-b4e45.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 32.16957605985037%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABT0lEQVQY002QzZLaMBCEef9nySmHrco1h6Rq4wBbwDoLGBtkA/7H9mZly0hfBieHTKmrNTM9PSrNPheWdTvy8zayaEbmgh+F5rnUUjOs3h3zzvHcWJbSW7b3CYuJLXPRPGZXjeFTZpmtbgPtRXGNFV1VkiWKzWLOi+dxVYpHGAdRUXONDqRJTJ1eJq7SM9fTkfgY0pcpL50YetVAek6IVExWVpyShHOasQ9D8qqeDJs7/Mobtm8+X799Z+2/4j2WrjfowWCsm3Re65gtq578FBIFe/LLBRWF0/bjYUcY7HBDjxZ91luwRs4AoxH8Yyx/w8kLxfBLeSdoNJtas+1G3pqBbWvwJfdvmsOHZdeDr0GNcBSP03+IpLf/cMS946kUw0KKpQhrWaRazfm3Ie766Z4NllTfiaqOIK/Z5zfC+p2gaCbsJI87TSHzuXz0A38A2X/CspI62McAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 26 11 25 30" title="" data-src="/static/2022-07-26-11-25-30-890d4bca4aa72f86514d43bbd7e17f01-fee1c.png" data-srcset="/static/2022-07-26-11-25-30-890d4bca4aa72f86514d43bbd7e17f01-a67b7.png 200w,\n/static/2022-07-26-11-25-30-890d4bca4aa72f86514d43bbd7e17f01-0b187.png 400w,\n/static/2022-07-26-11-25-30-890d4bca4aa72f86514d43bbd7e17f01-fee1c.png 800w,\n/static/2022-07-26-11-25-30-890d4bca4aa72f86514d43bbd7e17f01-b4e45.png 802w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/quonzj?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="了解-column-span-属性"><a href="#%E4%BA%86%E8%A7%A3-column-span-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 column-span 属性</h3>\n<p>column-span 属性有点类似表格布局中的 HTML 属性 colspan，表示某一个内容是否跨多栏显示。这个 CSS 属性是作用在分栏布局的子元素上的。语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36378485597980246000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`column-span: none;\ncolumn-span: all;`, `36378485597980246000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">column-span</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token property">column-span</span><span class="token punctuation">:</span> all<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>none 表示不横跨多栏，默认值。</li>\n<li>all 表示横跨所有垂直列。</li>\n</ul>\n<p>我们一起来看一个例子，就知道这个属性是做什么的了，HTML 和 CSS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70079404133945380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;container&quot;>\n   <p>第1段</p>\n   <p>第2段</p>\n   <p>第3段</p>\n   <p class=&quot;span-all&quot;>第4段</p>\n   <p>第5段</p>\n</div>\n<style>\n   .container {\n      width: 320px;\n      border: solid deepskyblue;\n      padding: 10px;\n      column-count: 3;\n   }\n\n   .container p {\n      background: deepskyblue;\n   }\n\n   .span-all {\n      column-span: all;\n      color: white;\n   }\n</style>`, `70079404133945380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html{21}"\n              >\n                <span class="gatsby-code-button-language">html{21}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>第1段<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>第2段<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>第3段<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>span-all<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>第4段<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>第5段<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.container</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token property">column-count</span><span class="token punctuation">:</span> 3<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.container p</span> <span class="token punctuation">{</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> deepskyblue<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.span-all</span> <span class="token punctuation">{</span>\n<span class="gatsby-highlight-code-line">      <span class="token property">column-span</span><span class="token punctuation">:</span> all<span class="token punctuation">;</span></span>      <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果如图 6-4 所示，对比图中左侧的默认效果，可以看到，设置了 column-span: all 的“第 4 段”文字所在的 <code class="language-text">&lt;p&gt;</code> 元素几乎贯穿了整个容器元素。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-26-11-31-15-7ce4d7dcee191864c66ac821e0ea0ada-96dff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 494px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 33.198380566801625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABa0lEQVQY0z2Ou04CURCG9/ksjI2FlQ9gbYgajYWFhRZ0mhASqbSxMAYxNCAJ4SIXgQUiFxXWBYGFsxfO4ezZM+OChslffJn5k28USwCVOOaybgt1Dm0KqsmLtizPUaduXRt2Bz+tvl6bsRwReQdVx3slbsaEBgUl2DKDOt7rbDcz2Kh6Zz15WR/vNXngA98ZRjrkoufeGPiokUDdOul40QE9b0yPPvF2BMpObrLdwIjGg03jsOvdjQBXwyT2FxDW+EFH7Le9kIHxav+h1AuPMDTEax2ep6CkpiJpQpPCRODIBT86B30B2mIJVzoEuvL0C46b1lbe3FT9jXyZQcyAnAXKn+dft4I1+/I4wegUExZWiBsb8yeCPQYClidDoCIB5apq2w5jTAJwzmfEnFPKGBXUkdTxqEMdGxbUZ7/vreLD0gywlGXyhVyhTCyrr30nUulyVS2VK/lSJZUtJNPZeCJVqNSyxTe5fgzxF7a/dn887+SeAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 26 11 31 15" title="" data-src="/static/2022-07-26-11-31-15-7ce4d7dcee191864c66ac821e0ea0ada-96dff.png" data-srcset="/static/2022-07-26-11-31-15-7ce4d7dcee191864c66ac821e0ea0ada-1a6e9.png 200w,\n/static/2022-07-26-11-31-15-7ce4d7dcee191864c66ac821e0ea0ada-b9533.png 400w,\n/static/2022-07-26-11-31-15-7ce4d7dcee191864c66ac821e0ea0ada-96dff.png 494w" data-sizes="(max-width: 494px) 100vw, 494px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/n7x8y0?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>图 6-4 所示的“第 1 段”内容之所以偏下，是因为第一个 <code class="language-text">&lt;p&gt;</code> 元素默认的 margin-top 无法参与分栏计算。</p>\n<p>想要在分栏布局中插入广告，可以使用 column-span: all 声明。</p>\n<h3 id="了解-column-fill-属性"><a href="#%E4%BA%86%E8%A7%A3-column-fill-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>了解 column-fill 属性</h3>\n<p>column-fill 的作用是当内容分栏的时候平衡每一栏填充的内容。语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22690250076693475000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`column-fill: auto;\ncolumn-fill: balance;\ncolumn-fill: balance-all;`, `22690250076693475000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">column-fill</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n<span class="token property">column-fill</span><span class="token punctuation">:</span> balance<span class="token punctuation">;</span>\n<span class="token property">column-fill</span><span class="token punctuation">:</span> balance-all<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>先讲一下这一语法中的几个关键点。</p>\n<ul>\n<li>auto 的作用是按顺序填充每一列，内容只占用它需要的空间。</li>\n<li>balance 是默认值，作用是尽可能在列之间平衡内容。在分隔断开的上下文中，只有最后一个片段是平衡的。例如，有多个 <code class="language-text">&lt;p&gt;</code> 元素，正好最后一个 <code class="language-text">&lt;p&gt;</code> 换行了，那这个 <code class="language-text">&lt;p&gt;</code> 元素的内容前后等分，保持平衡。这会造成最后一栏内容较少的问题。</li>\n<li>balance-all 的作用是尽可能在列之间平衡内容。在分隔断开的上下文中，所有片段都是平衡的。该属性值目前没有任何浏览器支持，可以忽略。</li>\n</ul>\n<p>我们测试一下各个属性值的渲染表现，假设代码如下（这里给容器设置了 80px 的高度）</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51884223112911030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n   .container {\n      width: 300px;\n      height: 80px;\n      border: solid deepskyblue;\n      padding: 10px;\n      column-count: 2;\n   }\n</style>\n<div class=&quot;container&quot; style=&quot;column-fil: auto&quot;>内容略</div>\n<div class=&quot;container&quot; style=&quot;column-fill: balance&quot;>内容略</div>\n<div class=&quot;container&quot; style=&quot;column-fill: balance-all&quot;>内容略</div>`, `51884223112911030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.container</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token property">column-count</span><span class="token punctuation">:</span> 2<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">column-fil</span><span class="token punctuation">:</span> auto</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>内容略<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">column-fill</span><span class="token punctuation">:</span> balance</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>内容略<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">column-fill</span><span class="token punctuation">:</span> balance-all</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>内容略<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后的渲染效果如图 6-5 所示，可以看到容器元素应用 column-fill: auto 声明的时候，里面的文字内容会优先填充第一列，而不是尽可能让两列内容平衡。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-07-26-11-39-05-3383e1c216b61c71a6c2f8e4ccc35232-d5813.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 443px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 76.2979683972912%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAAB70lEQVQoz31SS2/aQBDmZ1fqIZdWqUJ7a5NjVUVVL33k0IjmECUhKaElPGqCIQUDxtg8jM3u2sZe78MdEyVUkfCnkWd3Zkcz3/jLJQ8QQsD36OuXnefP9nZf5HdfLhYLiEjA+sGD3yD3/wWSc0QM09T6Q3MyiYRYIGRY1txxrenMxn5WMbS2l8tW/ab1p6Z1WthdeBjZ04ngsWTUp7HMKpaJz4SNiOsHQRxTKQMuQ5EGwZYRezL4pvieUrl0dfjh/dG3z58+Hp6fnT5yFqkTW8e+L64ryvHx98KPApjSbFLGsOcFYRTFccTl1s4AniQkjMzRUO9r9mwKEXtmKY2qPtAsQ3e9IIszl4kXc4wRJtjz/ZBGCOHpfEY5T0eIshaWpoam2Wx32t2e2u0qattGiCVJwPiKC7DtnNciOTkp5POv9vffHhy8e/N6T22rEA1ZTIVgIlMkkCUhteczQ9dd14EIXrqDQd8cGxNrjFeRzBaJg4mu/bVGQ1gbQe7SsUf9nkdQQBBehVmcuZCEsiBmKyZWTPrpmQNh6EjX+nn6qwRUbMT/OL/kACFjxsAxLuj6BHsBMMZSxQiRKxavFPXOcVyMiXKr3nW1ntavN5TeYDQyxqfnl5Vq4+Lyulpr/L6plX5VSuVKuVK9VTtnxZ//ALa/T0Z8DMlkAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 07 26 11 39 05" title="" data-src="/static/2022-07-26-11-39-05-3383e1c216b61c71a6c2f8e4ccc35232-d5813.png" data-srcset="/static/2022-07-26-11-39-05-3383e1c216b61c71a6c2f8e4ccc35232-bf07a.png 200w,\n/static/2022-07-26-11-39-05-3383e1c216b61c71a6c2f8e4ccc35232-250cd.png 400w,\n/static/2022-07-26-11-39-05-3383e1c216b61c71a6c2f8e4ccc35232-d5813.png 443w" data-sizes="(max-width: 443px) 100vw, 443px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/uickhu?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>经过仔细地对比测试可以发现以下几点。</p>\n<ol>\n<li>所有浏览器都能识别 column-fill: auto，但是，需要容器有固定的高度才能准确渲染。如果容器没有设置具体的高度值，则仅在 Firefox 浏览器中有比较符合预期的渲染。因此，在实际开发的时候，column-fill: auto 声明的使用一定要配合容器元素的 height 属性。</li>\n<li>所有浏览器都不能识别 column-fill: balance-all，我在 W3C 官方的规范文档 CSS Multi-column layout Module level1 中也没有找到任何的示例，因此，column-fill: balance-all 声明大家可以忽略。</li>\n</ol>\n<h2 id="分栏布局实现两端对齐布局"><a href="#%E5%88%86%E6%A0%8F%E5%B8%83%E5%B1%80%E5%AE%9E%E7%8E%B0%E4%B8%A4%E7%AB%AF%E5%AF%B9%E9%BD%90%E5%B8%83%E5%B1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分栏布局实现两端对齐布局</h2>\n<p>分栏布局非常适合实现单行的两端对齐布局效果，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6990089637183728000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div class=&quot;container&quot;>\n   <div class=&quot;list&quot;></div>\n   <div class=&quot;list&quot;></div>\n   <div class=&quot;list&quot;></div>\n</div>\n<style>\n   .container {\n      width: 300px;\n      border: solid deepskyblue;\n      column-count: 3;\n      column-gap: 5%;\n   }\n\n   .list {\n      height: 100px;\n      background-color: deeppink;\n   }\n</style>`, `6990089637183728000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n   <span class="token selector">.container</span> <span class="token punctuation">{</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> solid deepskyblue<span class="token punctuation">;</span>\n      <span class="token property">column-count</span><span class="token punctuation">:</span> 3<span class="token punctuation">;</span>\n      <span class="token property">column-gap</span><span class="token punctuation">:</span> 5%<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token selector">.list</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> deeppink<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>不需要改变元素的 display 属性，也不需要定位，只需要设置好 column-count 属性的值，然后使用 column-gap 属性设置想要的间隙就好了，这个时候，列表元素就会自动两端对齐，效果如图 6-6 所示。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-05-14-05-01-f32f79fe69366421070b6d1dbd2dcbd4-d55d3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.935483870967744%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABzklEQVQY0zWP3UtTYRzHz12YSjKn5st2ulP/gaCC8mXpEjVCKdpdeNVNRF127dRtR3cO5FUUvlB7aWu2QC8khFC72BO4sXPwFKVB0NLltoMFnj3Pt+cRgs/N83l+v9+Xr/TmyXZ2LJXxvSN30+TOW3JvleRL5OF7Mp4ivrRgLEUebxDTEgOnZHzpndsrrx59kD4NxFDrp00hOINomIGsIvsTF5+hbgrOELg/68eVFzAP4QgKGoOU+3PTHy8tSZmbSTSH7AsalVXaPke752muQHsWaYtCZY1y36TQ68v0c5G6VIFbtWUNbbObfVGJjCR4JldwhdE6i86nyBVwdUFkulRw3xhE/xLMItrDgo4wP4HzylZvRMqMJvlcVdaYW2Vtc6xrnuUK7NoCa1aYW2PcOxXmWWZmkXWoApdadWs8ZrMvIpGBKGomKS/sCKB+WuTvnHau9YtMzplJXH6O3UM0BASOAOWyfmqbd155sGH2vsx64/kbcWMwrt9K6fmSPrGm90f14YQxnDQ8MeP+uv7FMoYSxtDrvDee88Z2PZHoxLpUAY6AMnBwYv/48/fXib1fsg7sapEy/vxWquxVrK9H5f3flb2y9d065l/l/yv/AMQzN5NJPlVNAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 05 14 05 01" title="" data-src="/static/2022-09-05-14-05-01-f32f79fe69366421070b6d1dbd2dcbd4-fee1c.png" data-srcset="/static/2022-09-05-14-05-01-f32f79fe69366421070b6d1dbd2dcbd4-a67b7.png 200w,\n/static/2022-09-05-14-05-01-f32f79fe69366421070b6d1dbd2dcbd4-0b187.png 400w,\n/static/2022-09-05-14-05-01-f32f79fe69366421070b6d1dbd2dcbd4-fee1c.png 800w,\n/static/2022-09-05-14-05-01-f32f79fe69366421070b6d1dbd2dcbd4-d55d3.png 806w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/lg1096?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>// TODO CSS 新世界全新的布局方式待完成</p>',
excerpt:"之前，CSS 世界中除受限诸多的表格布局之外是没有专门的布局属性的，随着 Web 应用越来越复杂，显示设备越来越多样，原有的 CSS 特性已经无法满足现代 Web 开发需求了。于是，CSS 定义了很多全新的布局方式，这些新的布局 CSS…",timeToRead:7,tableOfContents:'<ul>\n<li>\n<p><a href="/css-new-world-new-layout/#%E5%88%86%E6%A0%8F%E5%B8%83%E5%B1%80">分栏布局</a></p>\n<ul>\n<li>\n<p><a href="/css-new-world-new-layout/#%E9%87%8D%E7%82%B9%E5%85%B3%E6%B3%A8-columns-%E5%B1%9E%E6%80%A7">重点关注 columns 属性</a></p>\n<ul>\n<li><a href="/css-new-world-new-layout/#%E5%85%B3%E4%BA%8E-column-width">关于 column-width</a></li>\n<li><a href="/css-new-world-new-layout/#%E5%85%B3%E4%BA%8E-column-count">关于 column-count</a></li>\n</ul>\n</li>\n<li><a href="/css-new-world-new-layout/#column-gap-%E5%92%8C-gap-%E5%B1%9E%E6%80%A7%E7%9A%84%E5%85%B3%E7%B3%BB">column-gap 和 gap 属性的关系</a></li>\n<li>\n<p><a href="/css-new-world-new-layout/#%E4%BA%86%E8%A7%A3-column-rule%E3%80%81column-span-%E5%92%8C-column-fill-%E5%B1%9E%E6%80%A7">了解 column-rule、column-span 和 column-fill 属性</a></p>\n<ul>\n<li><a href="/css-new-world-new-layout/#%E4%BA%86%E8%A7%A3-column-rule-%E5%B1%9E%E6%80%A7">了解 column-rule 属性</a></li>\n<li><a href="/css-new-world-new-layout/#%E4%BA%86%E8%A7%A3-column-span-%E5%B1%9E%E6%80%A7">了解 column-span 属性</a></li>\n<li><a href="/css-new-world-new-layout/#%E4%BA%86%E8%A7%A3-column-fill-%E5%B1%9E%E6%80%A7">了解 column-fill 属性</a></li>\n</ul>\n</li>\n<li><a href="/css-new-world-new-layout/#%E5%88%86%E6%A0%8F%E5%B8%83%E5%B1%80%E5%AE%9E%E7%8E%B0%E4%B8%A4%E7%AB%AF%E5%AF%B9%E9%BD%90%E5%B8%83%E5%B1%80">分栏布局实现两端对齐布局</a></li>\n</ul>\n</li>\n</ul>',wordCount:{words:578},frontmatter:{date:"2022-09-05 14:17:23",path:"/css-new-world-new-layout/",tags:"前端, CSS, CSS新世界, 读书笔记",title:"CSS新世界全新的布局方式",draft:null,catalog_number:null}},nextPost:{html:'<h1 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h1>\n<p><a href="https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md" target="_blank" rel="nofollow noreferrer noopener">系统设计</a></p>\n<h1 id="系统设计主题：从这里开始"><a href="#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%BB%E9%A2%98%EF%BC%9A%E4%BB%8E%E8%BF%99%E9%87%8C%E5%BC%80%E5%A7%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>系统设计主题：从这里开始</h1>\n<p>认识以下一般性原则</p>\n<h2 id="可扩展性视频讲座"><a href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E8%A7%86%E9%A2%91%E8%AE%B2%E5%BA%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可扩展性视频讲座</h2>\n<p><a href="https://www.youtube.com/watch?v=-W9F__D3oY4" target="_blank" rel="nofollow noreferrer noopener">哈佛大学可扩展性讲座</a></p>\n<ul>\n<li>垂直扩展（Vertical scaling）</li>\n<li>水平扩展（Horizontal scaling）</li>\n<li>缓存</li>\n<li>负载均衡</li>\n<li>数据库复制</li>\n<li>数据库分区</li>\n</ul>\n<h2 id="可扩展性文章"><a href="#%E5%8F%AF%E6%89%A9%E5%B1%95%E6%80%A7%E6%96%87%E7%AB%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可扩展性文章</h2>\n<ul>\n<li><a href="http://www.lecloud.net/post/7295452622/scalability-for-dummies-part-1-clones" target="_blank" rel="nofollow noreferrer noopener">Clones</a></li>\n<li><a href="http://www.lecloud.net/post/7994751381/scalability-for-dummies-part-2-database" target="_blank" rel="nofollow noreferrer noopener">数据库</a></li>\n<li><a href="http://www.lecloud.net/post/9246290032/scalability-for-dummies-part-3-cache" target="_blank" rel="nofollow noreferrer noopener">缓存</a></li>\n<li><a href="http://www.lecloud.net/post/9699762917/scalability-for-dummies-part-4-asynchronism" target="_blank" rel="nofollow noreferrer noopener">异步</a></li>\n</ul>\n<h2 id="接下来的步骤"><a href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E6%AD%A5%E9%AA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>接下来的步骤</h2>\n<p>接下来，我们将看看高阶的权衡和取舍:</p>\n<ul>\n<li>性能与可扩展性</li>\n<li>延迟与吞吐量</li>\n<li>可用性与一致性</li>\n</ul>\n<p>记住每个方面都面临取舍和权衡。</p>\n<p>然后，我们将深入更具体的主题，如 DNS、CDN 和负载均衡器。</p>\n<h1 id="性能与拓展性"><a href="#%E6%80%A7%E8%83%BD%E4%B8%8E%E6%8B%93%E5%B1%95%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>性能与拓展性</h1>\n<p>如果服务性能的增长与资源的增加是成比例的，服务就是可扩展的。通常，提高性能意味着服务于更多的工作单元，另一方面，当数据集增长时，同样也可以处理更大的工作单位。</p>\n<p>另一个角度来看待性能与可扩展性:</p>\n<ul>\n<li>如果你的系统有性能问题，对于单个用户来说是缓慢的。</li>\n<li>如果你的系统有可扩展性问题，单个用户较快但在高负载下会变慢。</li>\n</ul>\n<h1 id="延迟与吞吐量"><a href="#%E5%BB%B6%E8%BF%9F%E4%B8%8E%E5%90%9E%E5%90%90%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>延迟与吞吐量</h1>\n<p>延迟是执行操作或运算结果所花费的时间。</p>\n<p>吞吐量是单位时间内（执行）此类操作或运算的数量。</p>\n<p>通常，你应该以可接受级延迟下最大化吞吐量为目标。</p>\n<h1 id="可用性与一致性"><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E4%B8%8E%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可用性与一致性</h1>\n<h2 id="cap-理论"><a href="#cap-%E7%90%86%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CAP 理论</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-24-16-55-19-9a02d4dfaa4c704d2855b643a765986e-28759.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 500px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.6%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABw0lEQVQoz41T2W7iQBD0//8SL1xCiOMhC8qCiWMOM9j4tsf4wHZt90RJYEHZHak17bampruqRmvbFs/WXZ3yIMrg+glcN0R1rb9+XfISZz/F2XaQphk0IQRGoxEGgwE6nQ56vR6Wy+UdaF03ONohXnULkfECcysQpzn8MMX+6GFl2Ni9/kLgetDquoaUEnEcq4iiSMUtYNO0OAgfxu4McfKoW6lqfBF3bR5c7CwPRXmFhh8WA/5NSfsPerSfwG73vKhUZJfiDuBKfH7US5QVdcjjGYaBzWajQtd15Hl+z2HTwLIDrN5OcIMUwgmVGDIrVP77TWBLY/uhhOZ5HubzOabTqYrJZPLAIQPuicO1cVKcsUAX6iglQOsUYGM6ikO+5L9HliSYtNaIZUW15ntkSqUrIH1H8avxgYY64GDFef8U40GUtnp+e12SFa4fojyo+MToXPOIOzYw85TRaLXMUFcV+fEC202I41BxqpmmiX6/j263i/F4jMVigeFwiNlspnZdXytQY+dgvjAh6KBx8BBtLfjnAO+UL1cH5VMG1yq6JUkSejapEqMoCvXNJg/DUJmee2byGYzj9umxyfdHX6nN9T+typkv/8jZMwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 24 16 55 19" title="" data-src="/static/2022-08-24-16-55-19-9a02d4dfaa4c704d2855b643a765986e-28759.png" data-srcset="/static/2022-08-24-16-55-19-9a02d4dfaa4c704d2855b643a765986e-6ac48.png 200w,\n/static/2022-08-24-16-55-19-9a02d4dfaa4c704d2855b643a765986e-4b8bf.png 400w,\n/static/2022-08-24-16-55-19-9a02d4dfaa4c704d2855b643a765986e-28759.png 500w" data-sizes="(max-width: 500px) 100vw, 500px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在一个分布式计算系统中，只能同时满足下列的两点:</p>\n<ul>\n<li>一致性 ─ 每次访问都能获得最新数据但可能会收到错误响应</li>\n<li>可用性 ─ 每次访问都能收到非错响应，但不保证获取到最新数据</li>\n<li>分区容错性 ─ 在任意分区网络故障的情况下系统仍能继续运行</li>\n</ul>\n<p>网络并不可靠，所以你应要支持分区容错性，并需要在软件可用性和一致性间做出取舍。</p>\n<h3 id="cp---一致性和分区容错性"><a href="#cp---%E4%B8%80%E8%87%B4%E6%80%A7%E5%92%8C%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CP - 一致性和分区容错性</h3>\n<p>等待分区节点的响应可能会导致延时错误。如果你的业务需求需要原子读写，CP 是一个不错的选择。</p>\n<h3 id="ap---可用性和分区容错性"><a href="#ap---%E5%8F%AF%E7%94%A8%E6%80%A7%E5%92%8C%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AP - 可用性和分区容错性</h3>\n<p>响应节点上可用数据的最近版本可能并不是最新的。当分区解析完后，写入（操作）可能需要一些时间来传播。</p>\n<p>如果业务需求允许最终一致性，或当有外部故障时要求系统继续运行，AP 是一个不错的选择。</p>\n<h1 id="一致模式"><a href="#%E4%B8%80%E8%87%B4%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一致模式</h1>\n<p>有同一份数据的多份副本，我们面临着怎样同步它们的选择，以便让客户端有一致的显示数据。回想 CAP 理论中的一致性定义 ─ 每次访问都能获得最新数据但可能会收到错误响应</p>\n<h2 id="弱一致性"><a href="#%E5%BC%B1%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>弱一致性</h2>\n<p>在写入之后，访问可能看到，也可能看不到（写入数据）。尽力优化之让其能访问最新数据。</p>\n<p>这种方式可以在 memcached 等系统中看到。弱一致性在 VoIP，视频聊天和实时多人游戏等真实用例中表现不错。打个比方，如果你在通话中丢失信号几秒钟时间，当重新连接时你是听不到这几秒钟所说的话的。</p>\n<h2 id="最终一致性"><a href="#%E6%9C%80%E7%BB%88%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最终一致性</h2>\n<p>在写入后，访问最终能看到写入数据（通常在数毫秒内）。数据被异步复制。</p>\n<p>DNS 和 email 等系统使用的是此种方式。最终一致性在高可用性系统中效果不错。</p>\n<h2 id="强一致性"><a href="#%E5%BC%BA%E4%B8%80%E8%87%B4%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>强一致性</h2>\n<p>在写入后，访问立即可见。数据被同步复制。</p>\n<p>文件系统和关系型数据库（RDBMS）中使用的是此种方式。强一致性在需要记录的系统中运作良好。</p>\n<h1 id="可用性模式"><a href="#%E5%8F%AF%E7%94%A8%E6%80%A7%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可用性模式</h1>\n<p>有两种支持高可用性的模式: 故障切换（fail-over）和复制（replication）。</p>\n<h2 id="故障切换"><a href="#%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>故障切换</h2>\n<h3 id="工作到备用切换（active-passive）"><a href="#%E5%B7%A5%E4%BD%9C%E5%88%B0%E5%A4%87%E7%94%A8%E5%88%87%E6%8D%A2%EF%BC%88active-passive%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工作到备用切换（Active-passive）</h3>\n<p>关于工作到备用的故障切换流程是，工作服务器发送周期信号给待机中的备用服务器。如果周期信号中断，备用服务器切换成工作服务器的 IP 地址并恢复服务。</p>\n<p>宕机时间取决于备用服务器处于“热”待机状态还是需要从“冷”待机状态进行启动。只有工作服务器处理流量。</p>\n<p>工作到备用的故障切换也被称为主从切换。</p>\n<h3 id="双工作切换（active-active）"><a href="#%E5%8F%8C%E5%B7%A5%E4%BD%9C%E5%88%87%E6%8D%A2%EF%BC%88active-active%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>双工作切换（Active-active）</h3>\n<p>在双工作切换中，双方都在管控流量，在它们之间分散负载。</p>\n<p>如果是外网服务器，DNS 将需要对两方都了解。如果是内网服务器，应用程序逻辑将需要对两方都了解。</p>\n<p>双工作切换也可以称为主主切换。</p>\n<h3 id="缺点"><a href="#%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>故障切换需要添加额外硬件并增加复杂性。</li>\n<li>如果新写入数据在能被复制到备用系统之前，工作系统出现了故障，则有可能会丢失数据。</li>\n</ul>\n<h2 id="复制"><a href="#%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复制</h2>\n<h3 id="主-─-从复制和主-─-主复制"><a href="#%E4%B8%BB-%E2%94%80-%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%92%8C%E4%B8%BB-%E2%94%80-%E4%B8%BB%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主 ─ 从复制和主 ─ 主复制</h3>\n<p>这个主题进一步探讨了数据库部分:</p>\n<ul>\n<li>主 ─ 从复制</li>\n<li>主 ─ 主复制</li>\n</ul>\n<h1 id="域名系统"><a href="#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>域名系统</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-82fb5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 638px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.37617554858933%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACVklEQVQoz3WTz2/SYBjHuXjy5tmTif4ZXox/gRcvJiZejAdNiFs86KKJiTGabUxDDGbIlMUZs4MG9TCNY7ARNn4M6AotPzoptF2B0pbSH7Tv+9oXxoIZPnkPzfs+n+f5Pj/q6ff7giBIktRoNGS5U68fVqtljmuwLMvzvGVZCCEIIZpmHheLx+MEQWxv7+zt7bsnFkuQJB2LxYrFomEYIz/HcTqdjtRpy92u+6HrOoYnAtkQCAAICElyt+KSFEVBAEZvuqEVCDJbrKYIejeTa7daGHYlAWC7PgDkJOkcQVyo1c4qypWNn79y+YLrAaADEUBD4f6lpdc+P750nJPMuCiIVNPcUtWU2gtb1vq16zfW10LIBg7E8VtGpqqHgu98kS/fMTxU5EHTDVQqrConzOwnScqXtQ+sujGwtVEmNO4fhnW7zasZQUtz6o5iMlgpwoF7qEkyc9XoojlQjwUiNNl3DNO90ELW83Lz/EL6TEKccW8Mp0SLD/LNO0fKZ4F4CKgDW1H6fw6NOmvU63A8AgybtphmgixfaEklDZE1fZMznzPsJYq6XCpdlLWrhvhDCKwkb95K3vMW7noHFD2sDHicYd8Cy+GZF6FnH7993XrUFV5ZYkSg3zdLYbVx32wFb3tnVxd9qFJTOU7neGCax5lxDYZBR3+v+QOrb5Yjb1es8q56sCUXkjKR1Iopmdyfn/clU+nTq4ZlW7l8zTtLPnnKzD22otGRpBNX4Uh0V5VhGF3rj7s2AbsTt9ptV7+DF8bdh38Pgv8Z5+ScIUTTfgA4ttNPfwFNM/CdeOepqAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 24 17 52 24" title="" data-src="/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-82fb5.png" data-srcset="/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-38c7c.png 200w,\n/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-c00bc.png 400w,\n/static/2022-08-24-17-52-24-07f6446dc7a772c3b39f2fa37edc918b-82fb5.png 638w" data-sizes="(max-width: 638px) 100vw, 638px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>域名系统是把 www.example.com 等域名转换成 IP 地址。</p>\n<p>域名系统是分层次的，一些 DNS 服务器位于顶层。当查询（域名）IP 时，路由或 ISP 提供连接 DNS 服务器的信息。较底层的 DNS 服务器缓存映射，它可能会因为 DNS 传播延时而失效。DNS 结果可以缓存在浏览器或操作系统中一段时间，时间长短取决于存活时间 TTL。</p>\n<ul>\n<li>NS 记录（域名服务）─ 指定解析域名或子域名的 DNS 服务器。</li>\n<li>MX 记录（邮件交换）─ 指定接收信息的邮件服务器。</li>\n<li>A 记录（地址）─ 指定域名对应的 IP 地址记录。</li>\n<li>CNAME（规范）─ 一个域名映射到另一个域名或 CNAME 记录（example.com 指向 www.example.com）或映射到一个 A 记录。</li>\n</ul>\n<p>CloudFlare 和 Route 53 等平台提供管理 DNS 的功能。某些 DNS 服务通过集中方式来路由流量:</p>\n<ul>\n<li>\n<p>加权轮询调度</p>\n<ul>\n<li>防止流量进入维护中的服务器</li>\n<li>在不同大小集群间负载均衡</li>\n<li>A/B 测试</li>\n</ul>\n</li>\n<li>基于延迟路由</li>\n<li>基于地理位置路由</li>\n</ul>\n<h2 id="dns-缺点"><a href="#dns-%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DNS 缺点</h2>\n<ul>\n<li>虽说缓存可以减轻 DNS 延迟，但连接 DNS 服务器还是带来了轻微的延迟。</li>\n<li>虽然它们通常由政府，网络服务提供商和大公司管理，但 DNS 服务管理仍可能是复杂的。</li>\n<li>DNS 服务最近遭受 DDoS 攻击，阻止不知道 Twitter IP 地址的用户访问 Twitter。</li>\n</ul>\n<h1 id="cdn"><a href="#cdn" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-25-16-41-38-f58e676fc57a9b0a2df241542fb55127-00a75.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 710px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 60.70422535211269%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAAB70lEQVQoz4VSa5OaMBT13/dT/0an037pqNPafbijdnV9oFAEeQkICwoCBsIjQKJF6a72U88kM5mbe+49OTeN0xviNAUQBlHIrXhBVupghrK8KNIMYUKOx2N1Pt2gQS7Roix3rgMisPX9ZrP13Ou5UUYwhjEsyqIkJEwzydDtrREncVWi4pzJ/sHbGIq9NTVTlXQtjCNRljhZhlnuwiyII816FRWle3/3qfOwUlaGqVT51tYA4aGRJJBRlOfFXBJZiuMDENh+YPkhRIXB87N2c/ab6Y+G3Z8/RuOhbq63tm7vTHtnpVnaOF4E+IHPjwfjQY9asqbrYUy2UTb58vnh4weKZpayOF2yw/lck/nBgvIAwOQiu346Jrg//PW93WKks1UBTBwAXccS19VbdFbg7kYvnQrt5kJWU5T/Nazal94nQdvYrpMilJelB7N9CGbUZDodS2tx7znKRp/QzGAyDcLoQrnpfKynhRAtCE+Pj47j7A+H5Wo1Gzz1+r0C4yo7RjmnGi6IKqvryTVu54aKkllyk25H36h1uTFNVwuVZZ2Q5gU1p2mWhXnxD7lWkkZg9DLMcVnrYdcqiK86vRC2Op2v31p+FF9l1ygIEWRp73undyfeaO+dPZhor1ZlzbVzfZ+gnFZUQvDpf0DF+dv9AZZHlm2YDREyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 25 16 41 38" title="" data-src="/static/2022-08-25-16-41-38-f58e676fc57a9b0a2df241542fb55127-00a75.png" data-srcset="/static/2022-08-25-16-41-38-f58e676fc57a9b0a2df241542fb55127-139c8.png 200w,\n/static/2022-08-25-16-41-38-f58e676fc57a9b0a2df241542fb55127-08302.png 400w,\n/static/2022-08-25-16-41-38-f58e676fc57a9b0a2df241542fb55127-00a75.png 710w" data-sizes="(max-width: 710px) 100vw, 710px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>内容分发网络（CDN）是一个全球性的代理服务器分布式网络，它从靠近用户的位置提供内容。通常 HTML/CSS/JS，图片和视频等静态内容由 CDN 提供，虽然亚马逊 CloudFront 等也支持动态内容。CDN 的 DNS 解析会告知客户端连接哪台服务器。</p>\n<p>将内容存储在 CDN 上可以从两个方面来提供性能:</p>\n<ul>\n<li>从靠近用户的数据中心提供资源</li>\n<li>通过 CDN 你的服务器不必真的处理请求</li>\n</ul>\n<h2 id="cdn-推送"><a href="#cdn-%E6%8E%A8%E9%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 推送</h2>\n<p>当你服务器上内容发生变动时，推送 CDN 接受新内容。直接推送给 CDN 并重写 URL 地址以指向你的内容的 CDN 地址。你可以配置内容到期时间及何时更新。内容只有在更改或新增时才推送，流量最小化，但储存最大化。</p>\n<h2 id="cdn-拉取"><a href="#cdn-%E6%8B%89%E5%8F%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 拉取</h2>\n<p>CDN 拉取是当第一个用户请求该资源时，从服务器上拉取资源。你将内容留在自己的服务器上并重写 URL 指向 CDN 地址。直到内容被缓存在 CDN 上为止，这样请求只会更慢。</p>\n<p>存活时间（TTL）决定缓存多久时间。CDN 拉取方式最小化 CDN 上的储存空间，但如果过期文件没有在实际更改之前被拉取，则会导致冗余的流量。</p>\n<p>高流量站点使用 CDN 拉取效果不错，因为只有最近请求的内容保存在 CDN 中，流量才能更平衡地分散。</p>\n<h2 id="缺点-1"><a href="#%E7%BC%BA%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>CDN 成本可能因流量而异，可能在权衡之后你将不会使用 CDN。</li>\n<li>如果在 TTL 过期之前更新内容，CDN 缓存内容可能会过时。</li>\n<li>CDN 需要更改静态内容的 URL 地址以指向 CDN。</li>\n</ul>\n<h1 id="负载均衡器"><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>负载均衡器</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-25-16-56-03-0e090268f58bb51071e9393269b28a4d-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 67.08542713567839%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACSUlEQVQoz31Sy27TQBT1N7FhyQfwE6yQQGLTNUKIXTew66JdVK0qqrYIKlG1FaEVTorzcJOQxHLiOG7cpEmTycNvx56XuUlaYAFY46u5x3PmXt9zhLrR1VrtclWtqpqqGRDlchVSWD1kUcqSfz/C2HLjaDZCqJDPFy9l2ASB7/teFIaOH2JCl+copZwxiIz9vk6wvBBQy7Jq1Zr0XTJNE1DOOUTHn8UYOBxjUpAvxfSFlM0Xyz9mUcwWB+bkhDPbtmVZliRJVVW9qedyOc91gQvF4YIoxiEwoojgmJIY6gezGHChjya2ZRmGodRqxVIJmm9o2tXVFcV44gReGC0amTdZaVtfKoNUZdgeeJCGERaURkvXdVFMZ7O5fL7wTRQ7netr00QIDSYeVLj/C755Zjx7d7KyntnPtA6PTts3Q8EOSUh4QBI/ZjPCAkz9GXFDagds6hO8mDa8jLOChg7z3c+XvVLz9uu5eHM7Eiyjcp3aus3s231zOhqh4dRUz9Xj58bJk87R41FtfTrxB416u1xcO64/fXv6Yi39KWvKpWofTYVe5oOysaLtvERF0VNUp9VBjVRz76Hy/pG++wDJq67aJmOUYKx2nbNyN6MMynp/e/dAN3sCKBc4k9BzGb9TjzFOCU448cMgxvhPV4DSoPVyH2EiwCSWCUwFBJ8vfofMVQZv8CXC9y7MV1vZN7slURnYzlxJIVmw+d/ctyCz5P7rx1zn9fbF6kHpUGptbO7UjY7wH+sSykDMXw2BMymHsSdgmHrTGNvuT+SkwTT2Eu86AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 25 16 56 03" title="" data-src="/static/2022-08-25-16-56-03-0e090268f58bb51071e9393269b28a4d-f1168.png" data-srcset="/static/2022-08-25-16-56-03-0e090268f58bb51071e9393269b28a4d-ad772.png 200w,\n/static/2022-08-25-16-56-03-0e090268f58bb51071e9393269b28a4d-4f4c3.png 400w,\n/static/2022-08-25-16-56-03-0e090268f58bb51071e9393269b28a4d-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>负载均衡器将传入的请求分发到应用服务器和数据库等计算资源。无论哪种情况，负载均衡器将从计算资源来的响应返回给恰当的客户端。负载均衡器的效用在于:</p>\n<ul>\n<li>防止请求进入不好的服务器</li>\n<li>防止资源过载</li>\n<li>帮助消除单一的故障点</li>\n</ul>\n<p>负载均衡器可以通过硬件（昂贵）或 HAProxy 等软件来实现。增加的好处包括:</p>\n<ul>\n<li>SSL 终结 ─ 解密传入的请求并加密服务器响应，这样的话后端服务器就不必再执行这些潜在高消耗运算了。不需要在每台服务器上安装 X.509 证书。</li>\n<li>Session 留存 ─ 如果 Web 应用程序不追踪会话，发出 cookie 并将特定客户端的请求路由到同一实例。</li>\n</ul>\n<p>通常会设置采用工作 ─ 备用或双工作模式的多个负载均衡器，以免发生故障。</p>\n<p>负载均衡器能基于多种方式来路由流量:</p>\n<ul>\n<li>随机</li>\n<li>最少负载</li>\n<li>Session / Cookie</li>\n<li>轮询调度或加权轮询调度算法</li>\n<li>四层负载均衡</li>\n<li>七层负载均衡</li>\n</ul>\n<h2 id="四层负载均衡"><a href="#%E5%9B%9B%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>四层负载均衡</h2>\n<p>四层负载均衡根据传输层的信息来决定如何分发请求。通常，这会涉及来源，目标 IP 地址和请求头中的端口，但不包括数据包（报文）内容。四层负载均衡执行网络地址转换（NAT）来向上游服务器转发网络数据包。</p>\n<h2 id="七层负载均衡"><a href="#%E4%B8%83%E5%B1%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>七层负载均衡</h2>\n<p>七层负载均衡器根据监控应用层来决定怎样分发请求。这会涉及请求头的内容，消息和 cookie。七层负载均衡器终结网络流量，读取消息，做出负载均衡判定，然后传送给特定服务器。比如，一个七层负载均衡器能直接将视频流量连接到托管视频的服务器，同时将更敏感的用户账单流量引导到安全性更强的服务器。</p>\n<p>以损失灵活性为代价，四层负载均衡比七层负载均衡花费更少时间和计算资源，虽然这对现代商用硬件的性能影响甚微。</p>\n<h2 id="水平扩展"><a href="#%E6%B0%B4%E5%B9%B3%E6%89%A9%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>水平扩展</h2>\n<p>负载均衡器还能帮助水平扩展，提高性能和可用性。使用商业硬件的性价比更高，并且比在单台硬件上垂直扩展更贵的硬件具有更高的可用性。相比招聘特定企业系统人才，招聘商业硬件方面的人才更加容易。</p>\n<h3 id="缺点-2"><a href="#%E7%BC%BA%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>\n<p>水平扩展引入了复杂度并涉及服务器复制</p>\n<ul>\n<li>服务器应该是无状态的，它们也不该包含像 session 或资料图片等与用户关联的数据。</li>\n<li>session 可以集中存储在数据库或持久化缓存（Redis、Memcached）的数据存储区中。</li>\n</ul>\n</li>\n<li>缓存和数据库等下游服务器需要随着上游服务器进行扩展，以处理更多的并发连接。</li>\n</ul>\n<h2 id="缺点-3"><a href="#%E7%BC%BA%E7%82%B9-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>如果没有足够的资源配置或配置错误，负载均衡器会变成一个性能瓶颈。</li>\n<li>引入负载均衡器以帮助消除单点故障但导致了额外的复杂性。</li>\n<li>单个负载均衡器会导致单点故障，但配置多个负载均衡器会进一步增加复杂性。</li>\n</ul>\n<h1 id="反向代理（web-服务器）"><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%EF%BC%88web-%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>反向代理（web 服务器）</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-05-39-5bda4e308605b8d7840341f8b88c1707-58792.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 385px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.103896103896105%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABdElEQVQoz21R207CUBDk6/Q79FGjJPqi0e8hUUh49A0fTAiFlHIv0BYRyj3cCr1QCuPuGjUmbrI5ye6e2ZnZGCiiKMJms8F/YZkmskoeiqKg2mzB933sdjsEQYAwDLFarbBYLKTOODH+VKlUkcspaDR0WFYHy+VKhgMaWmy3aCUSaF9eoE2vu9/Dd10BnU6nKBQKyOfzsG1bajHDMASw2/0QME0rIZvNSnNLrO3RCNr9HebnZ9AfHzBmNp6HkPr1eh2qqkLXdck9LYspJMc0LQHkLBY1ZDKvIslxHNjDId5ub/ByeoJMPI7JfA6XWLNEBkmn00gmk6jVal+ALtEvqkXa1hDJzWaTpMzEvz3J9mjISKVQvr5C6/kJEdUPUSR9XsjesqLxePzrYa/XEx8mk8mfg/AAezmazaCWyggPx5/e8XhEp/MOg47GZFzPF1UCyFQ9zxUZ38OcHAzIXjrrNfr9vuRgMIRNL/s/J0+XdGnH2cjsJwJ+AGC7H7nrAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 05 39" title="" data-src="/static/2022-08-26-14-05-39-5bda4e308605b8d7840341f8b88c1707-58792.png" data-srcset="/static/2022-08-26-14-05-39-5bda4e308605b8d7840341f8b88c1707-f436a.png 200w,\n/static/2022-08-26-14-05-39-5bda4e308605b8d7840341f8b88c1707-58792.png 385w" data-sizes="(max-width: 385px) 100vw, 385px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>反向代理是一种可以集中地调用内部服务，并提供统一接口给公共客户的 web 服务器。来自客户端的请求先被反向代理服务器转发到可响应请求的服务器，然后代理再把服务器的响应结果返回给客户端。</p>\n<p>带来的好处包括：</p>\n<ul>\n<li>增加安全性 - 隐藏后端服务器的信息，屏蔽黑名单中的 IP，限制每个客户端的连接数。</li>\n<li>提高可扩展性和灵活性 - 客户端只能看到反向代理服务器的 IP，这使你可以增减服务器或者修改它们的配置。</li>\n<li>\n<p>本地终结 SSL 会话 - 解密传入请求，加密服务器响应，这样后端服务器就不必完成这些潜在的高成本的操作。</p>\n<ul>\n<li>免除了在每个服务器上安装 X.509 证书的需要</li>\n</ul>\n</li>\n<li>压缩 - 压缩服务器响应</li>\n<li>缓存 - 直接返回命中的缓存结果</li>\n<li>\n<p>静态内容 - 直接提供静态内容</p>\n<ul>\n<li>HTML/CSS/JS</li>\n<li>图片</li>\n<li>视频</li>\n<li>等等</li>\n</ul>\n</li>\n</ul>\n<h2 id="负载均衡与反向代理"><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%8E%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>负载均衡与反向代理</h2>\n<ul>\n<li>当你有多个服务器时，部署负载均衡器非常有用。通常，负载均衡器将流量路由给一组功能相同的服务器上。</li>\n<li>即使只有一台 web 服务器或者应用服务器时，反向代理也有用，可以参考上一节介绍的好处。</li>\n<li>NGINX 和 HAProxy 等解决方案可以同时支持第七层反向代理和负载均衡。</li>\n</ul>\n<h2 id="缺点-4"><a href="#%E7%BC%BA%E7%82%B9-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>引入反向代理会增加系统的复杂度。</li>\n<li>单独一个反向代理服务器仍可能发生单点故障，配置多台反向代理服务器（如故障转移）会进一步增加复杂度。</li>\n</ul>\n<h1 id="应用层"><a href="#%E5%BA%94%E7%94%A8%E5%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用层</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-07-56-285902d2becc1057ed28ca5d12ebe3a3-c05da.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 772px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 28.238341968911918%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsSAAALEgHS3X78AAABQUlEQVQY012Q226CQABE+f/PaKwx0drWVlRYaVFESOW2IOKyFhHREi8IitaotPvUh85M5m2Sk6F+/pTnpFYIpf3+DiN/vqWb+EOZXa/nqf/VaDmCOFsuo5Wm7lWFJNZU6na55cTXW365kXGMUG7oiTvWICoUeRYox+NBkrX7kkA3Dcu0Y01J+2Lc7X5DgxqfsLo2YGLj7HN92s11PaDpUNdMe1JvOLwwCsOZKA4en5X2O7IsW3198QDALIPagGp5XMV4qo3oFgbDYIwl2XupzTUVWm6xJAJOD4Ipz0vlqtJkbTJGb9yi2wk7/FwQqHSXrjebzXaT7TOCnWCcm3CHXQf5dXoo9JzskA4GsFKVmbbtOCiBeiZLqdg7Wyb177DQhEuWiYam50d3hR7gYJ5fXDcoP+jks8Uiwp3OhGEnABDsXxIrMJkvE5QKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 07 56" title="" data-src="/static/2022-08-26-14-07-56-285902d2becc1057ed28ca5d12ebe3a3-c05da.png" data-srcset="/static/2022-08-26-14-07-56-285902d2becc1057ed28ca5d12ebe3a3-fc8a7.png 200w,\n/static/2022-08-26-14-07-56-285902d2becc1057ed28ca5d12ebe3a3-51a5a.png 400w,\n/static/2022-08-26-14-07-56-285902d2becc1057ed28ca5d12ebe3a3-c05da.png 772w" data-sizes="(max-width: 772px) 100vw, 772px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>将 Web 服务层与应用层（也被称作平台层）分离，可以独立缩放和配置这两层。添加新的 API 只需要添加应用服务器，而不必添加额外的 web 服务器。</p>\n<p>单一职责原则提倡小型的，自治的服务共同合作。小团队通过提供小型的服务，可以更激进地计划增长。</p>\n<p>应用层中的工作进程也有可以实现异步化。</p>\n<h2 id="微服务"><a href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微服务</h2>\n<p>与此讨论相关的话题是微服务，可以被描述为一系列可以独立部署的小型的，模块化服务。每个服务运行在一个独立的线程中，通过明确定义的轻量级机制通讯，共同实现业务目标。</p>\n<p>例如，Pinterest 可能有这些微服务： 用户资料、关注者、Feed 流、搜索、照片上传等。</p>\n<h2 id="服务发现"><a href="#%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>服务发现</h2>\n<p>像 Consul，Etcd 和 Zookeeper 这样的系统可以通过追踪注册名、地址、端口等信息来帮助服务互相发现对方。Health checks 可以帮助确认服务的完整性和是否经常使用一个 HTTP 路径。Consul 和 Etcd 都有一个内建的 key-value 存储用来存储配置信息和其他的共享信息。</p>\n<h2 id="缺点-5"><a href="#%E7%BC%BA%E7%82%B9-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>添加由多个松耦合服务组成的应用层，从架构、运营、流程等层面来讲将非常不同（相对于单体系统）。</li>\n<li>微服务会增加部署和运营的复杂度。</li>\n</ul>\n<h1 id="数据库"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据库</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-09-39-9d058efca6cfd154a846cb42bc8bdad4-23829.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 773px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.33376455368693%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAC7UlEQVQozy2TS28bZRiF5w+w6poFUPUPsGOFBEJcNhULWKAuUBUoVGxQkEBqF1RKuQWpJRJUhXJRoyY4pAk0Na6TpsZO7GQyviW1Pa4TT2xPZsbx+G7P2M7l4YthcRbfq6PzvdJ5XunJwm20L98hf2MU3axQlAPkv3kXbeIjSmoavdxA81xjZ+xttJnr6DUHfdFD/PO3iHz3MZVyhXa3T7Pl0Gq5SPnrF7Fel7DOP407gMbSJNZZif1zp2g92aR7AJUrb2C+JmZjZ+kBtV8+oyze5sgzmLohAgcisDsMlQq3r1K/cBr90xcp2hb26iz2h2fY++QFjGyMVu8Qa+ICtZFnsX74AKMPhamvsUeeo3DpZXS9hOMeUW90aTS7SEWtQGo1hC8o8yC9gz8ZZ/avafzBvwmqCv5UjHBylXsLHh4qMQLZFIGkgs83R3h9BbWQwrANBoND+kJSLPmYQCjCUjhOYtfmj4jKXX+InxeWmNtIs6Kq/PZomW9n7jC9/CdzMYV/EmGmvR6mfPNktITwLfDFZJgJj4xklauYxj5a0UTJ7rKayhPLFnkU3+a+kiO4tctsJMNiPMtkKEEwnREbyqyn1vEqATRrC084yEuXZd68qiC1Oz0cp0+16XJv02I+URIq4kvt4U8bLGds1vNVVnJltq02ke0KnqjOHbnAZrFKtW4QSm9xZa7C+P0qUr3pMHB7PEhUOf+9ys2HBupejcJ+g+XHNhd/ynHNq9MQDTri827X5e6ayfs3d5gO7eM6A5zuIa22M5R00g6HR9zy5Tn1/DnGZ9IM+oKVgwO8ssnpV0Z57ysvHfcYu9aCY/hxPs5TZ15ldHyWE2u90f6fQxHYEBv23T7KdodLvyZYTNZxewfDTdRSh7GpDL+HTHr9Y068PeGN5hpcvrHEoqKLZo+GuDQF1EMOO4LyYkkUokRJp7OEwxFyOQ3TstnY+G8mywrJzRTtTh9DXFM0GiOjbrO2JpPXSnSdwTDsRP8CJSHk/QNZ/AAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 09 39" title="" data-src="/static/2022-08-26-14-09-39-9d058efca6cfd154a846cb42bc8bdad4-23829.png" data-srcset="/static/2022-08-26-14-09-39-9d058efca6cfd154a846cb42bc8bdad4-a6bd7.png 200w,\n/static/2022-08-26-14-09-39-9d058efca6cfd154a846cb42bc8bdad4-ee980.png 400w,\n/static/2022-08-26-14-09-39-9d058efca6cfd154a846cb42bc8bdad4-23829.png 773w" data-sizes="(max-width: 773px) 100vw, 773px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="关系型数据库管理系统（rdbms）"><a href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%EF%BC%88rdbms%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>关系型数据库管理系统（RDBMS）</h2>\n<p>像 SQL 这样的关系型数据库是一系列以表的形式组织的数据项集合。</p>\n<p>ACID 用来描述关系型数据库事务的特性。</p>\n<ul>\n<li>原子性 - 每个事务内部所有操作要么全部完成，要么全部不完成。</li>\n<li>一致性 - 任何事务都使数据库从一个有效的状态转换到另一个有效状态。</li>\n<li>隔离性 - 并发执行事务的结果与顺序执行事务的结果相同。</li>\n<li>持久性 - 事务提交后，对系统的影响是永久的。</li>\n</ul>\n<p>关系型数据库扩展包括许多技术：主从复制、主主复制、联合、分片、非规范化和 SQL 调优。</p>\n<h3 id="主从复制"><a href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主从复制</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-10-32-1e6a43bb70e362edf1a20f6e51bba906-c1ca4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 752px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 64.76063829787235%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAABjUlEQVQoz3WSS4+CQBCE5///Cj35Jzxw8aKuxmgIiu834gMUXEHZ2Y9pMzGbbB8640xXdVWh+jH1fD7loLUuioKe5/n9fn88HlmWvV4vDt+m5EBP01Rtt9sgCI7HI73f7w8GA/p4PI7jmAlIQV4uF8/zZrPZZDKJokibgl31ej0Aw+GQt+v1ejqdIlMA6NxAMZ1Oq9VqpVKp1Wrr9RqkiFVQAnZdFyb9Ufxkp7hAV6PRcBynXq/vdjsZKMGfgMKUnLEqdLfbDUcYWSwW+/0eOWTxlq3/KcCSopi0cYLByxucJElqimnCw7NVxQ1ICc8qooSulE2Aq9UKJ/P53Pd9YuNLIAxSYucJRkJCvOynw8Wh3PxlqtvtHg4HsW0/I0Q8NZvNVqsFl/0LyOYSDCsLCQORm83mUzZpkzMh0W2iIEejEUKYVwiTZ2Rzi4vE1Pl8Zg76zBTTaJEB9glEoardbiNPZLNNcgaPcwvmgE9gzHc6HeKAXaGTSMIw/POpmMY8MPwLBQfolsslWaAXIb/PUtohsA8mEgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 10 32" title="" data-src="/static/2022-08-26-14-10-32-1e6a43bb70e362edf1a20f6e51bba906-c1ca4.png" data-srcset="/static/2022-08-26-14-10-32-1e6a43bb70e362edf1a20f6e51bba906-d3808.png 200w,\n/static/2022-08-26-14-10-32-1e6a43bb70e362edf1a20f6e51bba906-471e5.png 400w,\n/static/2022-08-26-14-10-32-1e6a43bb70e362edf1a20f6e51bba906-c1ca4.png 752w" data-sizes="(max-width: 752px) 100vw, 752px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>主库同时负责读取和写入操作，并复制写入到一个或多个从库中，从库只负责读操作。树状形式的从库再将写入复制到更多的从库中去。如果主库离线，系统可以以只读模式运行，直到某个从库被提升为主库或有新的主库出现。</p>\n<h4 id="缺点-6"><a href="#%E7%BC%BA%E7%82%B9-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>将从库提升为主库需要额外的逻辑。</li>\n<li>主从复制和主主复制共同的问题。</li>\n</ul>\n<h3 id="主主复制"><a href="#%E4%B8%BB%E4%B8%BB%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主主复制</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-13-53-b29f7e77c781de59dcbfaf06d57bae70-d985b.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 740px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.62162162162162%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABaklEQVQoz32SSYvCQBCF+///BPUgOXjUgycvQgQRURGjGDVuMQpuSYyaxC1xPmxmMgRm6lD08urVq9ct3v/G7XbzPI98v99lJoIgCMPwdDoJ27Yvl4v3Cd/31+v1ZrNZrVbL5ZKr5/MZRRFo1tfrlQxM8gIWpmnO53PzEyw6nU673dY0rdvtDgaD4/G43+9rtVq1WlVVtV6vj0ajpBjQeDyeTCa9Xo99SjYnj8ej1WplMpl8Pp/L5ZrNJudxHCNE6LrOvtFozGYzeZqaGdmMR9tCoYCEw+GQdE61in+FLMYhFlCcz2cEDofDfr/PXLAIQK/XC2NSPX86y2LEG4aBW1BgMJrJwrKs3W4HzXa7dRwHVrixCm4MpxJqbulJsQRLXp5A4DCGMfB0OsVwCsCRF4sFW6CQViqVYrFYKpXK5TKkycxYhc/yhdCWks1nIKMFtxVFyWazwJJi13XlIzPMX4aRre+gBvO4ZeYvHpdcQivuQjAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 13 53" title="" data-src="/static/2022-08-26-14-13-53-b29f7e77c781de59dcbfaf06d57bae70-d985b.png" data-srcset="/static/2022-08-26-14-13-53-b29f7e77c781de59dcbfaf06d57bae70-7a5d1.png 200w,\n/static/2022-08-26-14-13-53-b29f7e77c781de59dcbfaf06d57bae70-99472.png 400w,\n/static/2022-08-26-14-13-53-b29f7e77c781de59dcbfaf06d57bae70-d985b.png 740w" data-sizes="(max-width: 740px) 100vw, 740px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>两个主库都负责读操作和写操作，写入操作时互相协调。如果其中一个主库挂机，系统可以继续读取和写入。</p>\n<h4 id="缺点-7"><a href="#%E7%BC%BA%E7%82%B9-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>你需要添加负载均衡器或者在应用逻辑中做改动，来确定写入哪一个数据库。</li>\n<li>多数主-主系统要么不能保证一致性（违反 ACID），要么因为同步产生了写入延迟。</li>\n<li>随着更多写入节点的加入和延迟的提高，如何解决冲突显得越发重要。</li>\n<li>主从复制和主主复制共同的问题。</li>\n</ul>\n<h3 id="缺点-8"><a href="#%E7%BC%BA%E7%82%B9-8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>如果主库在将新写入的数据复制到其他节点前挂掉，则有数据丢失的可能。</li>\n<li>写入会被重放到负责读取操作的副本。副本可能因为过多写操作阻塞住，导致读取功能异常。</li>\n<li>读取从库越多，需要复制的写入数据就越多，导致更严重的复制延迟。</li>\n<li>在某些数据库系统中，写入主库的操作可以用多个线程并行写入，但读取副本只支持单线程顺序地写入。</li>\n<li>复制意味着更多的硬件和额外的复杂度。</li>\n</ul>\n<h3 id="联合"><a href="#%E8%81%94%E5%90%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>联合</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-17-09-bf010bef31f17e2c4d4343bc2bd5f310-24f57.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 471px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 148.83227176220808%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAAsSAAALEgHS3X78AAAEcUlEQVQ4y41Ua0xbZRg+f/3nH7dsy1xi9McUnRqnWZjReAevU5Ytw8hC2AQtM2M/dCROE3fJvAQnKvM2BcrGuLUgg7KuLZTeS3taCr1AuThoWcspbU9LT8/1821P6Qgx0pMvX77vy3ne7znP85wXS9N8flBpDmaaEcQFyyJY/2YhTvTe/kK5tBhjEEKteKS2P3BaEfATFMbzSEC5gbIzx+dmnkPRFDrWbHn/j7H3fhrV+yNknJR0T799tuONRp1qJokNKpS4Y9w14R53uUe0etzhgkVnZ4/RYOFYPs6jF2rOb32kePv+g0p3eNLjOfDD6I5n3nqo4uLQLIVZLLZRnVFvMKtUGrVmZOimyjXhkcn7tKMGjhVIGpV9I7+/tOaJ49+6w2mgJunyPnjws901Teq5FAZ7YJ4hn+UNs0gbFgybGdMrnNIX73Msdrpil03E71ZCPZs0L9IxisdEhWhGnIW1bWaIYKiLOEZpch1t85RfwSXyuXiag2tATkx8439GihaggC+OnpY07nzq5de/Hw6lMsg0UwA4zQjwGZOE8Hhdy66y+he/VhFUxgi6EDBFC4APJ1ipnWg0hK87iATFi4ebgwUe/efDcQjL67ReKljn1OKQa2lV5iQGPSshkhE45A1Rclds0BMPkyzGcrls5eplbYNHBEOhc5pglSxQ2bOg8sfgvEEfrrg6daTN2++OYctEbFRnMBjNWp3eZB6bmPRphrUtrVIykQJikOaj33U/dvjThw/Xt474/pnxf9iKFx2o3VN9qc0ZxVaiiZtK9cCA4u/+AY1GC/Eyma2dXT0xclUEH7rQfs/Oovv2lXWY55HASjrc216q2lp64k8bkaGNNtAWcrTBDNhetQYlzeb6LqdpngzGmRYbcbLVeKrdZllMYXm1MoLRGwWDMIAkgiA4J6e/vLXw0UD4K3UokuLEaza3KknxLMN5lxLvXFIXV19480ed+06KZXhI3uZgIC+w/BKD9p789d6i55481TK1AoFFBYUEwOB2eBUdkzpKGobLr9gXohCAwuJJZ/+NNC1EKeF2QiBSmTshnlSedj5bG/7HjGbr7ICo3k2rkL2ZF3KdYO1wzapsPCOr3DV85RfjnUFvDE5Iiu8aj142RRTeGEYmKJmsD+Kh0xtvDAxZrXbFkPKWSsNlJYEqeCB1RDp1tGOupmc6QXFTy+nya76yJn2tfBZLJCn/zNzEpBe6FwyAqdUj0MwybjMZGmNB5oGSqt2llc9Wn5sJEHLdRPHptl373y1r1GZpZzOF487evhs2uyPbyYRcG0DIGqR3vFa9bW/p83U/w4GPSO87I9tSfOjV872YqBb8SXZ8HNqwze6EUtD0898cTrJ/WUMXFf7reMgRWNXMkE2GYINyutsVuWuVmGqossEqls3cT5FRqXq8qm+pUhZoxpfFPrvOZwatd2iDz/B2m3350Yqzez448/nQPNxBFRJPsY0BuHlseUvJJ9tfqa7rdsOWZgoDi8oZ5pMfd3qPt7ulthC4APH8FzPOG8dqv0rwAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 17 09" title="" data-src="/static/2022-08-26-14-17-09-bf010bef31f17e2c4d4343bc2bd5f310-24f57.png" data-srcset="/static/2022-08-26-14-17-09-bf010bef31f17e2c4d4343bc2bd5f310-ea629.png 200w,\n/static/2022-08-26-14-17-09-bf010bef31f17e2c4d4343bc2bd5f310-c47ea.png 400w,\n/static/2022-08-26-14-17-09-bf010bef31f17e2c4d4343bc2bd5f310-24f57.png 471w" data-sizes="(max-width: 471px) 100vw, 471px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>联合（或按功能划分）将数据库按对应功能分割。例如，你可以有三个数据库：论坛、用户和产品，而不仅是一个单体数据库，从而减少每个数据库的读取和写入流量，减少复制延迟。较小的数据库意味着更多适合放入内存的数据，进而意味着更高的缓存命中几率。没有只能串行写入的中心化主库，你可以并行写入，提高负载能力。</p>\n<h4 id="缺点-9"><a href="#%E7%BC%BA%E7%82%B9-9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>如果你的数据库模式需要大量的功能和数据表，联合的效率并不好。</li>\n<li>你需要更新应用程序的逻辑来确定要读取和写入哪个数据库。</li>\n<li>用 server link 从两个库联结数据更复杂。</li>\n<li>联合需要更多的硬件和额外的复杂度。</li>\n</ul>\n<h3 id="分片"><a href="#%E5%88%86%E7%89%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分片</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-18-22-1c3db2aadf180c667214441f0893a5db-0f51d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 586px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.45733788395904%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAACFklEQVQ4y5VV147CQAzc//+wnJAQTyA6pBEgDQKEDr6M7xyZBXSHpWibPTsu6xi6E/GH4X6vx6IoaLVa0Xq9pu12y3P5LpdLrSc2IkYA9WGWZVSsC14fDgcqy5LKXclnuCiKos8AF4sFzedznkfziLrdHk2nbm3kuu6DN4+ASjTD4XDIbDAXydKM+v1+BT79m6GwhNxuN2bRbrep0+lQo9GgVqtFvV6vZv6K3RPDd0qbzYYZ+75PnufRbrf7jCFGsMQHSdOUXUfGMZ7P5/8B2uUDOZ1ONJuFXDovPbm/cVluE0WUy3g8Js/1KIkTmoUhDQbDOkm2/gOg3tSJGY1G5DgOJ+Try6Fms8k1abur7Y3e1GDH4/HX3RkDAhyskRCc2QRkNDb1/X7PwccIY2QYgkQgjtfrlUfZt+0fXAaADj6MwFbOsZYMw3VdPk8u48HjZYgASNZaR1+IczDWTGtA3CixkTrUbonbwgoCfZul0e5IIQsbW1niqPfAUifmLSCMdYnYDLVnyH4NiAniYBuDoVaUvVd6mrWRW5IkebpZty6Jmd4TXdjKRSYIAi7eyWTCI9iiwUpnCcKAazKOY4IuChwdG3sAxBytzvd/cAyaZZ7j37GisHqviCUO8jyvvoz7H8BgKP8UrNMs5Zj61SXQxWPAhQYs0qoTZ5UCjBAPgMAN7C2XS56DNdxF18YaIAAEibhaAxD231PUrx6d0pRQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 18 22" title="" data-src="/static/2022-08-26-14-18-22-1c3db2aadf180c667214441f0893a5db-0f51d.png" data-srcset="/static/2022-08-26-14-18-22-1c3db2aadf180c667214441f0893a5db-e7e34.png 200w,\n/static/2022-08-26-14-18-22-1c3db2aadf180c667214441f0893a5db-15827.png 400w,\n/static/2022-08-26-14-18-22-1c3db2aadf180c667214441f0893a5db-0f51d.png 586w" data-sizes="(max-width: 586px) 100vw, 586px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>分片将数据分配在不同的数据库上，使得每个数据库仅管理整个数据集的一个子集。以用户数据库为例，随着用户数量的增加，越来越多的分片会被添加到集群中。</p>\n<p>类似联合的优点，分片可以减少读取和写入流量，减少复制并提高缓存命中率。也减少了索引，通常意味着查询更快，性能更好。如果一个分片出问题，其他的仍能运行，你可以使用某种形式的冗余来防止数据丢失。类似联合，没有只能串行写入的中心化主库，你可以并行写入，提高负载能力。</p>\n<p>常见的做法是用户姓氏的首字母或者用户的地理位置来分隔用户表。</p>\n<h4 id="缺点-10"><a href="#%E7%BC%BA%E7%82%B9-10" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>你需要修改应用程序的逻辑来实现分片，这会带来复杂的 SQL 查询。</li>\n<li>\n<p>分片不合理可能导致数据负载不均衡。例如，被频繁访问的用户数据会导致其所在分片的负载相对其他分片高。</p>\n<ul>\n<li>再平衡会引入额外的复杂度。基于一致性哈希的分片算法可以减少这种情况。</li>\n</ul>\n</li>\n<li>联结多个分片的数据操作更复杂。</li>\n<li>分片需要更多的硬件和额外的复杂度。</li>\n</ul>\n<h3 id="非规范化"><a href="#%E9%9D%9E%E8%A7%84%E8%8C%83%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>非规范化</h3>\n<p>非规范化试图以写入性能为代价来换取读取性能。在多个表中冗余数据副本，以避免高成本的联结操作。一些关系型数据库，比如 PostgreSQL 和 Oracle 支持物化视图，可以处理冗余信息存储和保证冗余副本一致。</p>\n<p>当数据使用诸如联合和分片等技术被分割，进一步提高了处理跨数据中心的联结操作复杂度。非规范化可以规避这种复杂的联结操作。</p>\n<p>在多数系统中，读取操作的频率远高于写入操作，比例可达到 100:1，甚至 1000:1。需要复杂的数据库联结的读取操作成本非常高，在磁盘操作上消耗了大量时间。</p>\n<h4 id="缺点-11"><a href="#%E7%BC%BA%E7%82%B9-11" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>数据会冗余。</li>\n<li>约束可以帮助冗余的信息副本保持同步，但这样会增加数据库设计的复杂度。</li>\n<li>非规范化的数据库在高写入负载下性能可能比规范化的数据库差。</li>\n</ul>\n<h3 id="sql-调优"><a href="#sql-%E8%B0%83%E4%BC%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQL 调优</h3>\n<p>SQL 调优是一个范围很广的话题，有很多相关的书可以作为参考。</p>\n<p>利用基准测试和性能分析来模拟和发现系统瓶颈很重要。</p>\n<ul>\n<li>基准测试 - 用 ab 等工具模拟高负载情况。</li>\n<li>性能分析 - 通过启用如慢查询日志等工具来辅助追踪性能问题。</li>\n</ul>\n<p>基准测试和性能分析可能会指引你到以下优化方案。</p>\n<h4 id="改进模式"><a href="#%E6%94%B9%E8%BF%9B%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>改进模式</h4>\n<ul>\n<li>为了实现快速访问，MySQL 在磁盘上用连续的块存储数据。</li>\n<li>\n<p>使用 CHAR 类型存储固定长度的字段，不要用 VARCHAR。</p>\n<ul>\n<li>CHAR 在快速、随机访问时效率很高。如果使用 VARCHAR，如果你想读取下一个字符串，不得不先读取到当前字符串的末尾。</li>\n</ul>\n</li>\n<li>使用 TEXT 类型存储大块的文本，例如博客正文。TEXT 还允许布尔搜索。使用 TEXT 字段需要在磁盘上存储一个用于定位文本块的指针。</li>\n<li>使用 INT 类型存储高达 2^32 或 40 亿的较大数字。</li>\n<li>使用 DECIMAL 类型存储货币可以避免浮点数表示错误。</li>\n<li>避免使用 BLOBS 存储实际对象，而是用来存储存放对象的位置。</li>\n<li>VARCHAR(255) 是以 8 位数字存储的最大字符数，在某些关系型数据库中，最大限度地利用字节。</li>\n<li>在适用场景中设置 NOT NULL 约束来提高搜索性能。</li>\n</ul>\n<h4 id="使用正确的索引"><a href="#%E4%BD%BF%E7%94%A8%E6%AD%A3%E7%A1%AE%E7%9A%84%E7%B4%A2%E5%BC%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用正确的索引</h4>\n<ul>\n<li>你正查询（SELECT、GROUP BY、ORDER BY、JOIN）的列如果用了索引会更快。</li>\n<li>索引通常表示为自平衡的 B 树，可以保持数据有序，并允许在对数时间内进行搜索，顺序访问，插入，删除操作。</li>\n<li>设置索引，会将数据存在内存中，占用了更多内存空间。</li>\n<li>写入操作会变慢，因为索引需要被更新。</li>\n<li>加载大量数据时，禁用索引再加载数据，然后重建索引，这样也许会更快。</li>\n</ul>\n<h4 id="避免高成本的联结操作"><a href="#%E9%81%BF%E5%85%8D%E9%AB%98%E6%88%90%E6%9C%AC%E7%9A%84%E8%81%94%E7%BB%93%E6%93%8D%E4%BD%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>避免高成本的联结操作</h4>\n<ul>\n<li>有性能需要，可以进行非规范化。</li>\n</ul>\n<h4 id="分割数据表"><a href="#%E5%88%86%E5%89%B2%E6%95%B0%E6%8D%AE%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分割数据表</h4>\n<ul>\n<li>将热点数据拆分到单独的数据表中，可以有助于缓存。</li>\n</ul>\n<h4 id="调优查询缓存"><a href="#%E8%B0%83%E4%BC%98%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调优查询缓存</h4>\n<ul>\n<li>在某些情况下，查询缓存可能会导致性能问题。</li>\n</ul>\n<h2 id="nosql"><a href="#nosql" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NoSQL</h2>\n<p>NoSQL 是键-值数据库、文档型数据库、列型数据库或图数据库的统称。数据库是非规范化的，表联结大多在应用程序代码中完成。大多数 NoSQL 无法实现真正符合 ACID 的事务，支持最终一致。</p>\n<p>BASE 通常被用于描述 NoSQL 数据库的特性。相比 CAP 理论，BASE 强调可用性超过一致性。</p>\n<ul>\n<li>基本可用 - 系统保证可用性。</li>\n<li>软状态 - 即使没有输入，系统状态也可能随着时间变化。</li>\n<li>最终一致性 - 经过一段时间之后，系统最终会变一致，因为系统在此期间没有收到任何输入。</li>\n</ul>\n<p>除了在 SQL 还是 NoSQL 之间做选择，了解哪种类型的 NoSQL 数据库最适合你的用例也是非常有帮助的。我们将在下一节中快速了解下键-值存储、文档型存储、列型存储和图存储数据库。</p>\n<h3 id="键-值存储"><a href="#%E9%94%AE-%E5%80%BC%E5%AD%98%E5%82%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>键-值存储</h3>\n<blockquote>\n<p>抽象模型：哈希表</p>\n</blockquote>\n<p>键-值存储通常可以实现 O(1) 时间读写，用内存或 SSD 存储数据。数据存储可以按字典顺序维护键，从而实现键的高效检索。键-值存储可以用于存储元数据。</p>\n<p>键-值存储性能很高，通常用于存储简单数据模型或频繁修改的数据，如存放在内存中的缓存。键-值存储提供的操作有限，如果需要更多操作，复杂度将转嫁到应用程序层面。</p>\n<p>键-值存储是如文档存储，在某些情况下，甚至是图存储等更复杂的存储系统的基础。</p>\n<h3 id="文档存储"><a href="#%E6%96%87%E6%A1%A3%E5%AD%98%E5%82%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>文档存储</h3>\n<blockquote>\n<p>抽象模型：将文档作为值的键-值存储</p>\n</blockquote>\n<p>文档类型存储以文档（XML、JSON、二进制文件等）为中心，文档存储了指定对象的全部信息。文档存储根据文档自身的内部结构提供 API 或查询语句来实现查询。请注意，许多键-值存储数据库有用值存储元数据的特性，这也模糊了这两种存储类型的界限。</p>\n<p>基于底层实现，文档可以根据集合、标签、元数据或者文件夹组织。尽管不同文档可以被组织在一起或者分成一组，但相互之间可能具有完全不同的字段。</p>\n<p>MongoDB 和 CouchDB 等一些文档类型存储还提供了类似 SQL 语言的查询语句来实现复杂查询。DynamoDB 同时支持键-值存储和文档类型存储。</p>\n<p>文档类型存储具备高度的灵活性，常用于处理偶尔变化的数据。</p>\n<h3 id="列型存储"><a href="#%E5%88%97%E5%9E%8B%E5%AD%98%E5%82%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列型存储</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-23-39-66cf9374ef5294eb9c59cf548d8d891f-49396.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 526px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.06463878326996%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABwklEQVQY00WO62+aABTF+a/3aVm2Ls2sXdEs2ersQ9v1JbOFGp/YYqU+UEFUFBBaWBUzFURh2mwfvKMfliW/nJycc29yEHh+BtMEy/rPdAK1GjAMNLkX5TigKHh4gLkN5hQs8x8WAradLjOb8QRKpD/iqZ3rLErkAgTpx5LvI7GNw4uNIwzFsx4B3MvzXoV6Bs+Op97zzCok81/juegVGcUyoW9RFDsInod9e35f2Le1v7W9+yGARYL48U7sYPv0M4qFgpd7wVjo56OKeLP1ltIdLntPC1mxRfqsJ4ZKpUicOMndXdEsydHxNvuF74TL1dD3xGmByVTahWKdnFtTBHRdEfWKNi+KBq85WuHQ6fk1FifT7ZtU/e5G6lO1we07jXo7qu5S17X6bbdT1vii7NguAjwviT+Y4ao+cLlHV6X2jcabPhPD4/f5VIXjRn0ioydeDanXZuVT5iR3j9M8ybM5diEpCKjqUJDFviGrRl/QDfpy3LsYdGm2JLQYQRFHo2R2VD0yWuczMcUWOU3QPdSOthJlBNZrcF1YzMFZgD2DuQPaE7BNkCVoNEASYTIBdwXOct3sQIuHyRiWv16O//z+C38Pfw1Tkt1KAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 23 39" title="" data-src="/static/2022-08-26-14-23-39-66cf9374ef5294eb9c59cf548d8d891f-49396.png" data-srcset="/static/2022-08-26-14-23-39-66cf9374ef5294eb9c59cf548d8d891f-68c83.png 200w,\n/static/2022-08-26-14-23-39-66cf9374ef5294eb9c59cf548d8d891f-d339c.png 400w,\n/static/2022-08-26-14-23-39-66cf9374ef5294eb9c59cf548d8d891f-49396.png 526w" data-sizes="(max-width: 526px) 100vw, 526px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<blockquote>\n<p>抽象模型：嵌套的 <code class="language-text">ColumnFamily&lt;RowKey, Columns&lt;ColKey, Value, Timestamp&gt;&gt;</code> 映射</p>\n</blockquote>\n<p>类型存储的基本数据单元是列（名/值对）。列可以在列族（类似于 SQL 的数据表）中被分组。超级列族再分组普通列族。你可以使用行键独立访问每一列，具有相同行键值的列组成一行。每个值都包含版本的时间戳用于解决版本冲突。</p>\n<p>Google 发布了第一个列型存储数据库 Bigtable，它影响了 Hadoop 生态系统中活跃的开源数据库 HBase 和 Facebook 的 Cassandra。像 BigTable，HBase 和 Cassandra 这样的存储系统将键以字母顺序存储，可以高效地读取键列。</p>\n<p>列型存储具备高可用性和高可扩展性。通常被用于大数据相关存储。</p>\n<h3 id="图数据库"><a href="#%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图数据库</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-24-30-3321c91fe6cde7df533e1a2035aaeafa-571e1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 584px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.34931506849314%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACU0lEQVQoz32SfU/aUBTG+dr7BG5/LFNcIhpm5pQpy7RgBSulrjCpFmzBSilIqbTSQl9ErEhbSuturSNLNneS3tx7c3/nOT3niTy9Er7v/3XjgVWVJRxOYOnNG6EZefpvgBSe54Vb8Lmum099KeZSZ4WjfGrj3/BsNtN13bKs8Dgej8FRHajQ3vet2DsM2c/nstlv8UiYfl5kqKNpGkVRGIYVi8VKpVKv1xmGyaE5KA0fpZOZndVMcg1H9iJz7LnAgLRtG2AQBAHMMAxQqqIoNE23uMZEU7pMdT++3LigHMcJlKeO8zh+CFOYpgneASnAgLyDwYAkSZZlzdHI1vt8CWvTZZm/CgUjel/+mU0WDhJc9bTBcSiKXjKMJEnn5+flchlBEKAvy7JrW0aHaxL4yDD4CvFoaAGc29tA4SRRzMPbseXF99ULpitJYq/nuO7w7g78aqfT0XTdse0b+rR3xaldvk38mE7GAZxOrBwfQqcnOLy9iibW1Gve1NX7nnjfu+7zrcfJZD5zc2i0K4TYYG5F3vdmAcxQZ7ufl+CvK+j+Tq1UqJdwRWhLrUajdMximX6TCcmRqtSyu/l49FbtA9J/bm3QMEWW+CsunOpQG3RZRpOurfEDaFK3ybZpkqfIk43lKrRJJmIcjoSzCeA/RhVsJreaIbTaZ4VOjRIYWmyyl0QBji6QWzHxosLlD/BPS479Yp5IaAwQIWzdj0zlZig0QW+9mRteCiyTefuGO4KI9Q/Y+kfvt+tfsefUmVrWi7F933Vn5GHqILqAxKOKKMzL/AVTGuayMlHZvwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 24 30" title="" data-src="/static/2022-08-26-14-24-30-3321c91fe6cde7df533e1a2035aaeafa-571e1.png" data-srcset="/static/2022-08-26-14-24-30-3321c91fe6cde7df533e1a2035aaeafa-2fa92.png 200w,\n/static/2022-08-26-14-24-30-3321c91fe6cde7df533e1a2035aaeafa-52932.png 400w,\n/static/2022-08-26-14-24-30-3321c91fe6cde7df533e1a2035aaeafa-571e1.png 584w" data-sizes="(max-width: 584px) 100vw, 584px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<blockquote>\n<p>抽象模型： 图</p>\n</blockquote>\n<p>在图数据库中，一个节点对应一条记录，一个弧对应两个节点之间的关系。图数据库被优化用于表示外键繁多的复杂关系或多对多关系。</p>\n<p>图数据库为存储复杂关系的数据模型，如社交网络，提供了很高的性能。它们相对较新，尚未广泛应用，查找开发工具或者资源相对较难。许多图只能通过 REST API 访问。</p>\n<h2 id="sql-还是-nosql"><a href="#sql-%E8%BF%98%E6%98%AF-nosql" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQL 还是 NoSQL</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-25-39-d66605e9c8cbaaf782d68b7a3c261a0e-9c82e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 495px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.93939393939393%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB2UlEQVQoz12RW6+aQBSF+f+/oU996VvTtD1J+1L1iHhAFBQCAzMMF2XAS/Ewg2gPit1Km9iu7NnZ2ck3a2VGatvLnH6dkU9m8MUkn+f0SUUfdmV4vV4v7aVt2+tfOWkJRdbihezGeAcbCQ6mCxcbUAibiJiWq5W86GBQR/q50OlPIFHGP06Wsrf91Vxu8CpN4iSKkzBZRlBhRKpDBXuw7WB+bOim6mI8mcyIC5yL49v5BsdJQENMQx96GGFMHCH4I1ydGpSWiHE3Le3Vq59zyH/q4GQFbkEYkyimUIR6VSUeYTDRw+K9HL7r02+LLN4dXMb/OC/TW+Y4oV1s8P8P5vXJY2WwEXQj2L52mND8ddPc4SiBqK6HbQ87fuDAIKp/Yme712B9u66sG2spekbgkbBp3qRjfczzLGVpksQgxtIsZ/v9/hF+LYUTMgPRwcT+PrZsF21yVlWVRCn90etrqjaZ6JqmLeaL6XQmyyN4WYDP5/Pthx1nor2MFVkdK6oynM/N4VDWdV0iBFuWjZDn+b53l2Vbruse7r91uQuWLkKr1RJ5PsbYh0YCGKTtdpvn6+ls2hv0e72+PBplGcvXeX2sAe6cOeeGYYwV5fl5OBj0ldFIVdWiKH4DmKFQttR1YQEAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 25 39" title="" data-src="/static/2022-08-26-14-25-39-d66605e9c8cbaaf782d68b7a3c261a0e-9c82e.png" data-srcset="/static/2022-08-26-14-25-39-d66605e9c8cbaaf782d68b7a3c261a0e-84a0c.png 200w,\n/static/2022-08-26-14-25-39-d66605e9c8cbaaf782d68b7a3c261a0e-afbfd.png 400w,\n/static/2022-08-26-14-25-39-d66605e9c8cbaaf782d68b7a3c261a0e-9c82e.png 495w" data-sizes="(max-width: 495px) 100vw, 495px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>选取 SQL 的原因:</p>\n<ul>\n<li>结构化数据</li>\n<li>严格的模式</li>\n<li>关系型数据</li>\n<li>需要复杂的联结操作</li>\n<li>事务</li>\n<li>清晰的扩展模式</li>\n<li>既有资源更丰富：开发者、社区、代码库、工具等</li>\n<li>通过索引进行查询非常快</li>\n</ul>\n<p>选取 NoSQL 的原因：</p>\n<ul>\n<li>半结构化数据</li>\n<li>动态或灵活的模式</li>\n<li>非关系型数据</li>\n<li>不需要复杂的联结操作</li>\n<li>存储 TB （甚至 PB）级别的数据</li>\n<li>高数据密集的工作负载</li>\n<li>IOPS 高吞吐量</li>\n</ul>\n<p>适合 NoSQL 的示例数据：</p>\n<ul>\n<li>埋点数据和日志数据</li>\n<li>排行榜或者得分数据</li>\n<li>临时数据，如购物车</li>\n<li>频繁访问的（“热”）表</li>\n<li>元数据/查找表</li>\n</ul>\n<h1 id="缓存"><a href="#%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缓存</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-27-15-a497207c3365eb2fe3401c24cee9a38f-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 55.904522613065325%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACJUlEQVQoz1VSy27TQBT1B7HkD+AXQGLBng0bRBcsYVUkhISqCLFAkRCFFEiKaJtQkpQKo8RtgtzaTtK4dl6OceL4NX6NPX4xUSDAWdzFnTNzzpx7CWmmqzpQFoaiGgvD9oLY8RGuhg0N4GVZFsVJnCQnp6f1o+NGk2q12kEYJkmKQXR58ZLnq9Xad5I8o+npEhLu6IYB3MAPkAcRDFGa/QWKYh+G+IgYTRVpMqaoJk3TDMM0Gw2e5xnm3LIszXIRijAbi1i2U/kxfXPMF8jhzPRx04eIWJiOPFv0eJHr9fvCkO3yng+xVR3AmeFiUhwn1nyuiKOtg969XPXh27M9ktt+t2vaHhGlWRxF+O21K9tx5bnqecDzdN91TUEMTdOxnUNaft+Qdk/kjii3acb2IKHSR2LxiXSQ0wTOUBRZ1qbsh4vtq5fFa4PCFY1+4Qiyr6mSMNwssneeljfyrQrFf65/Ay4k5nS9t7M53M+ZF+c+L9hjRRO+jis3xL3bg/JNnSkEP/UsCrG1iepyo8Vo4XeFcWn/cKkc4/RQiINZ+V7513XgdiY4YuS4tigCTY/j2IWRZkPgIZwC5uARENmf36ZrZGl/xPZYcg7UJS9NEwAEtvu4xN7dqm3k282OLA6GeCWI9bW1rGxNHtVu3f94Pdd44Afx79kGqNKWXn3plCipTnHPX75epv3P8DOsiSuA1icuv9N+Rg7KeNtW4tn/S6KZOK/wF7CUSOaqh63aAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 27 15" title="" data-src="/static/2022-08-26-14-27-15-a497207c3365eb2fe3401c24cee9a38f-f1168.png" data-srcset="/static/2022-08-26-14-27-15-a497207c3365eb2fe3401c24cee9a38f-ad772.png 200w,\n/static/2022-08-26-14-27-15-a497207c3365eb2fe3401c24cee9a38f-4f4c3.png 400w,\n/static/2022-08-26-14-27-15-a497207c3365eb2fe3401c24cee9a38f-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>缓存可以提高页面加载速度，并可以减少服务器和数据库的负载。在这个模型中，分发器先查看请求之前是否被响应过，如果有则将之前的结果直接返回，来省掉真正的处理。</p>\n<p>数据库分片均匀分布的读取是最好的。但是热门数据会让读取分布不均匀，这样就会造成瓶颈，如果在数据库前加个缓存，就会抹平不均匀的负载和突发流量对数据库的影响。</p>\n<h2 id="客户端缓存"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端缓存</h2>\n<p>缓存可以位于客户端（操作系统或者浏览器），服务端或者不同的缓存层。</p>\n<h2 id="cdn-缓存"><a href="#cdn-%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 缓存</h2>\n<p>CDN 也被视为一种缓存。</p>\n<h2 id="web-服务器缓存"><a href="#web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web 服务器缓存</h2>\n<p>反向代理和缓存（比如 Varnish）可以直接提供静态和动态内容。Web 服务器同样也可以缓存请求，返回相应结果而不必连接应用服务器。</p>\n<h2 id="数据库缓存"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据库缓存</h2>\n<p>数据库的默认配置中通常包含缓存级别，针对一般用例进行了优化。调整配置，在不同情况下使用不同的模式可以进一步提高性能。</p>\n<h2 id="应用缓存"><a href="#%E5%BA%94%E7%94%A8%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用缓存</h2>\n<p>基于内存的缓存比如 Memcached 和 Redis 是应用程序和数据存储之间的一种键值存储。由于数据保存在 RAM 中，它比存储在磁盘上的典型数据库要快多了。RAM 比磁盘限制更多，所以例如 Least Recently Used (LRU) 的缓存无效算法可以将「热门数据」放在 RAM 中，而对一些比较「冷门」的数据不做处理。</p>\n<p>Redis 有下列附加功能：</p>\n<ul>\n<li>持久性选项</li>\n<li>内置数据结构比如有序集合和列表</li>\n</ul>\n<p>有多个缓存级别，分为两大类：数据库查询和对象：</p>\n<ul>\n<li>行级别</li>\n<li>查询级别</li>\n<li>完整的可序列化对象</li>\n<li>完全渲染的 HTML</li>\n</ul>\n<p>一般来说，你应该尽量避免基于文件的缓存，因为这使得复制和自动缩放很困难。</p>\n<h2 id="数据库查询级别的缓存"><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据库查询级别的缓存</h2>\n<p>当你查询数据库的时候，将查询语句的哈希值与查询结果存储到缓存中。这种方法会遇到以下问题：</p>\n<ul>\n<li>很难用复杂的查询删除已缓存结果。</li>\n<li>如果一条数据比如表中某条数据的一项被改变，则需要删除所有可能包含已更改项的缓存结果。</li>\n</ul>\n<h2 id="对象级别的缓存"><a href="#%E5%AF%B9%E8%B1%A1%E7%BA%A7%E5%88%AB%E7%9A%84%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对象级别的缓存</h2>\n<p>将您的数据视为对象，就像对待你的应用代码一样。让应用程序将数据从数据库中组合到类实例或数据结构中：</p>\n<ul>\n<li>如果对象的基础数据已经更改了，那么从缓存中删掉这个对象。</li>\n<li>允许异步处理：workers 通过使用最新的缓存对象来组装对象。</li>\n</ul>\n<p>建议缓存的内容：</p>\n<ul>\n<li>用户会话</li>\n<li>完全渲染的 Web 页面</li>\n<li>活动流</li>\n<li>用户图数据</li>\n</ul>\n<h2 id="何时更新缓存"><a href="#%E4%BD%95%E6%97%B6%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>何时更新缓存</h2>\n<p>由于你只能在缓存中存储有限的数据，所以你需要选择一个适用于你用例的缓存更新策略。</p>\n<h3 id="缓存模式"><a href="#%E7%BC%93%E5%AD%98%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缓存模式</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-29-42-addd9d63e15912d596be8190abb9e78b-a2e9a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 687px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.174672489082965%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABW0lEQVQY042R60+CUBjGz///va2yrZzMzdtULgoSyRRoRglICaEoyZZQkMaaF252pqvVl9Zv786ene3ZeZ73gN2fpF9AHQQBQRAURdE0jWGYaZogiqL1b6Iw/DYcCMMQ3nMcV6/Xi8UigiAoiuI4DkhJxh40yhhTjyN4ovdaU5KTJInjBBp833ccx3Vd3/dEUaxUKrkcks/nS6UyTAGqstqw7KNm66zdOWVYfPJUuO1LkjSfzz3PW61WcRynaQLf32zWotjj+S7PdwShu1i8gXJfwSz7hGGPGTbDdmvjaeFONgzjZQ/sud1uDxVm9nNfGisDW1Fmsmyp6gjwQ+1KNzhzup9JG+qhliYJNMCqy+XSdR2YwvdfqVavWpNatH7JjEhKazQGYAcjwWBRtJ8Y6t2PDR+AKwjeFxyvl8rX2SyZOcPOL5qq+gHSf3/VULNISqFpDSdkFL0RBP0T33mkP+wvTAgAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 29 42" title="" data-src="/static/2022-08-26-14-29-42-addd9d63e15912d596be8190abb9e78b-a2e9a.png" data-srcset="/static/2022-08-26-14-29-42-addd9d63e15912d596be8190abb9e78b-b5b37.png 200w,\n/static/2022-08-26-14-29-42-addd9d63e15912d596be8190abb9e78b-68786.png 400w,\n/static/2022-08-26-14-29-42-addd9d63e15912d596be8190abb9e78b-a2e9a.png 687w" data-sizes="(max-width: 687px) 100vw, 687px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>应用从存储器读写。缓存不和存储器直接交互，应用执行以下操作：</p>\n<ul>\n<li>在缓存中查找记录，如果所需数据不在缓存中</li>\n<li>从数据库中加载所需内容</li>\n<li>将查找到的结果存储到缓存中</li>\n<li>返回所需内容</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47584986430875700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def get_user(self, user_id):\n    user = cache.get(&quot;user.{0}&quot;, user_id)\n    if user is None:\n        user = db.query(&quot;SELECT * FROM users WHERE user_id = {0}&quot;, user_id)\n        if user is not None:\n            key = &quot;user.{0}&quot;.format(user_id)\n            cache.set(key, json.dumps(user))\n    return user`, `47584986430875700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    user <span class="token operator">=</span> cache<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"user.{0}"</span><span class="token punctuation">,</span> user_id<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n        user <span class="token operator">=</span> db<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"SELECT * FROM users WHERE user_id = {0}"</span><span class="token punctuation">,</span> user_id<span class="token punctuation">)</span>\n        <span class="token keyword">if</span> user <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>\n            key <span class="token operator">=</span> <span class="token string">"user.{0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span>\n            cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> user</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Memcached 通常用这种方式使用。</p>\n<p>添加到缓存中的数据读取速度很快。缓存模式也称为延迟加载。只缓存所请求的数据，这避免了没有被请求的数据占满了缓存空间。</p>\n<h4 id="缺点-12"><a href="#%E7%BC%BA%E7%82%B9-12" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>请求的数据如果不在缓存中就需要经过三个步骤来获取数据，这会导致明显的延迟。</li>\n<li>如果数据库中的数据更新了会导致缓存中的数据过时。这个问题需要通过设置 TTL 强制更新缓存或者直写模式来缓解这种情况。</li>\n<li>当一个节点出现故障的时候，它将会被一个新的节点替代，这增加了延迟的时间。</li>\n</ul>\n<h3 id="直写模式"><a href="#%E7%9B%B4%E5%86%99%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直写模式</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-31-34-22e84307a8e3c77040649a89854130ef-8c2fd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 381px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 182.41469816272968%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsSAAALEgHS3X78AAADB0lEQVRIx4WWWVPiQBSF+f8/Yx6gtJCy3J5QkLFAcGUR3IIm7DtOAIWAzCdXmh4mmFtWqu3k3OXcc7vxzZc2m82Gw+H7+3uz2TRNs7S0SqXCTr1ebzQatm1/LkwgPlkBsyyr3uCbervTnmvW7/ff3t7Gk/FoNKpWq3y2AkvMYrHIOwXQ3eubPLvdLrnIv1/gdrv9+PgoXhRsPB4PR0MCsqmDU6nUw8PDCuxMncPDw1wup8es1Wv7+/vh4+PpdKrHf3l5eX19/afmfD6fzWaVe0nBcSYKOVuYuL66uoLX75r54vr6ei2COBKMvhmPx8/Ozr7TllCJRCK4E3x+fqYZMHd/f096KhGet7e30Wh0e3v76OhoMpmsapYVNYdCoV8LCwaDfr9/a2sLLg4ODgKBAK9iv2O6x++0dSNJyZ/On5+fExAuaMfczXybevvx8YGwdApx+rk04cI332DwWavV9CRdIuueVDNkDRg9IYlkMglPFxcXhULh8vLSMIxYLAbH7pElGsyXy+VOp8MTOo2iQSEyKhBBa3yNZgNtRiIRXOYLedTz9PR0c3PD61arpZftknav37NKFo4BkBX+EAwCTmfSIElbVISpojwIUwOUTqeF6s2EzT5VeyGZChcHQAudnZyc4ALmmGSK/6nPPKmZY8RxHNv+gyFVaMPjYDAgi7Xi18GcChw3LIAlU8l4ImFaJckc8Fr+LuBMJgO+XC6ZlsmfZZnVaoUO0W2PtJF0OBze3d1lHnZCO/6An9nY29tjRx0gLuD/jczX+qyfU6uRXOuTvIakTfKWHY/ItE1awCTTNsSTyWYQH3Jk2jeCxTftZTZpNfmj4i+FGwZHN/xBvgeYJv8gbw8wZTMeOlWKLXfCdM7sgS1g1ztkY2T0zhPBwNPXYM2m3mmLe/goFPKwxYRAOA1jyEUkHpEZLw5NmSR0CmGyYODh76ejV664u7s75YgJkzUTynXrAeZCQAYy3rlsNhKJyj73mTdYj6yLmci9Xs8DzDvuChjiMLCXBm2np6fyA0CB/wKMCgCPMPqd7gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 31 34" title="" data-src="/static/2022-08-26-14-31-34-22e84307a8e3c77040649a89854130ef-8c2fd.png" data-srcset="/static/2022-08-26-14-31-34-22e84307a8e3c77040649a89854130ef-65055.png 200w,\n/static/2022-08-26-14-31-34-22e84307a8e3c77040649a89854130ef-8c2fd.png 381w" data-sizes="(max-width: 381px) 100vw, 381px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>应用使用缓存作为主要的数据存储，将数据读写到缓存中，而缓存负责从数据库中读写数据。</p>\n<ul>\n<li>应用向缓存中添加/更新数据</li>\n<li>缓存同步地写入数据存储</li>\n<li>返回所需内容</li>\n</ul>\n<p>应用代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12241128725036333000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`set_user(12345, {&quot;foo&quot;:&quot;bar&quot;})`, `12241128725036333000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py">set_user<span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">"foo"</span><span class="token punctuation">:</span><span class="token string">"bar"</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>缓存代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36360617798661067000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`def set_user(user_id, values):\n    user = db.query(&quot;UPDATE Users WHERE id = {0}&quot;, user_id, values)\n    cache.set(user_id, user)`, `36360617798661067000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="py"\n              >\n                <span class="gatsby-code-button-language">py</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="py"><pre style="counter-reset: linenumber NaN" class="language-py line-numbers"><code class="language-py"><span class="token keyword">def</span> <span class="token function">set_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">:</span>\n    user <span class="token operator">=</span> db<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"UPDATE Users WHERE id = {0}"</span><span class="token punctuation">,</span> user_id<span class="token punctuation">,</span> values<span class="token punctuation">)</span>\n    cache<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> user<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>由于存写操作所以直写模式整体是一种很慢的操作，但是读取刚写入的数据很快。相比读取数据，用户通常比较能接受更新数据时速度较慢。缓存中的数据不会过时。</p>\n<h4 id="缺点-13"><a href="#%E7%BC%BA%E7%82%B9-13" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>由于故障或者缩放而创建的新的节点，新的节点不会缓存，直到数据库更新为止。缓存应用直写模式可以缓解这个问题。</li>\n<li>写入的大多数数据可能永远都不会被读取，用 TTL 可以最小化这种情况的出现。</li>\n</ul>\n<h3 id="回写模式"><a href="#%E5%9B%9E%E5%86%99%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>回写模式</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-33-01-754358f23e2983e6d3a374268eabc4df-4d589.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 713px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 96.07293127629733%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsSAAALEgHS3X78AAABm0lEQVQ4y42UC2+CQBCE+f8/zaREm0gFKi/f4KMeCCoI/co2lqIBN/G8O5zZ2dlFraqqNE2/6kiSRDbH47Esy6ovtDRL1+v17Xbj14Cv1yu3YRiCZ9NNoZ1OJ9d15RBFYZZlbOI4Xq1W/eA8zy3LWiwWvu9vt9vdbmfb9ng8RkU/mA/ZgiCYz+eGYaCCmouiqF4IrXmgBIgOh4NSar/fSwldYIzBHrKhGRh7VERRtFwu4eoBA0Awv57NZpvNhrZxCxFHWKiClXacz2eEXC6XJ7LB0CQwSEAz+XEORm5YoaibpxzHIcHdSE2+4P4x7MMgj+d5FCyk8tQ0zeFwOHof0ReopRF/YCRNp1MysMIil2UdbFCLNQyejBBTwFC13X4MpgCAzN+95xiJBf/AZSM4gsFLBob5CQLfcdzJZBLXgfKuzFQhhTE2uv6m6/pgMMCX1sy1wfIMVSpW5LQ/bUyyTAsvsNpvBL4+B2MPmaFAZJZmrPSSGzb3lcq1x5x0kpx4Ts3d70Yb/PtnUDcTlmbPWvEczFTLi8GEdjfyG3a9SGVkzKPNAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 33 01" title="" data-src="/static/2022-08-26-14-33-01-754358f23e2983e6d3a374268eabc4df-4d589.png" data-srcset="/static/2022-08-26-14-33-01-754358f23e2983e6d3a374268eabc4df-b9753.png 200w,\n/static/2022-08-26-14-33-01-754358f23e2983e6d3a374268eabc4df-7c7b5.png 400w,\n/static/2022-08-26-14-33-01-754358f23e2983e6d3a374268eabc4df-4d589.png 713w" data-sizes="(max-width: 713px) 100vw, 713px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在回写模式中，应用执行以下操作：</p>\n<ul>\n<li>在缓存中增加或者更新条目</li>\n<li>异步写入数据，提高写入性能。</li>\n</ul>\n<h4 id="缺点-14"><a href="#%E7%BC%BA%E7%82%B9-14" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>缓存可能在其内容成功存储之前丢失数据。</li>\n<li>执行直写模式比缓存或者回写模式更复杂。</li>\n</ul>\n<h3 id="刷新"><a href="#%E5%88%B7%E6%96%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>刷新</h3>\n<p>你可以将缓存配置成在到期之前自动刷新最近访问过的内容。</p>\n<p>如果缓存可以准确预测将来可能请求哪些数据，那么刷新可能会导致延迟与读取时间的降低。</p>\n<h4 id="缺点-15"><a href="#%E7%BC%BA%E7%82%B9-15" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h4>\n<ul>\n<li>不能准确预测到未来需要用到的数据可能会导致性能不如不使用刷新。</li>\n</ul>\n<h3 id="缺点-16"><a href="#%E7%BC%BA%E7%82%B9-16" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>需要保持缓存和真实数据源之间的一致性，比如数据库根据缓存无效。</li>\n<li>需要改变应用程序比如增加 Redis 或者 memcached。</li>\n<li>无效缓存是个难题，什么时候更新缓存是与之相关的复杂问题。</li>\n</ul>\n<h1 id="异步"><a href="#%E5%BC%82%E6%AD%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-35-21-6be55c68282d45b4b838d6f43841ea15-82c98.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 781px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 20.614596670934702%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5ElEQVQI1w2Oy3KCMAAA+f9/0QOXjtMq1BFBTYgRApVA24ECBqE8LMQWIWX2sntbSQgx9qOYeIzjMNXDdnKIOLb4Af5EXzW/1Rk4OItFAUCRRGeaa/plpfoQldJnHbrc210gbght34uSWeTbAJ2xr8Hxj/rsytKzqm7nc6ooOUuQHc5kcybvV+tAggFaBuocyk/u8yvdhPHHyco3eqmskx1oPT+7pjEjpKJe5jiF50XIZLbVBH5KLGm6vXd33nHedv3vtN4Tt8K2IG8C4SGMmxtLO8MQJzwgM12+VJo2ucDHSt/+A6hX0EIEoJ/cAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 35 21" title="" data-src="/static/2022-08-26-14-35-21-6be55c68282d45b4b838d6f43841ea15-82c98.png" data-srcset="/static/2022-08-26-14-35-21-6be55c68282d45b4b838d6f43841ea15-ee9e5.png 200w,\n/static/2022-08-26-14-35-21-6be55c68282d45b4b838d6f43841ea15-b8c14.png 400w,\n/static/2022-08-26-14-35-21-6be55c68282d45b4b838d6f43841ea15-82c98.png 781w" data-sizes="(max-width: 781px) 100vw, 781px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>异步工作流有助于减少那些原本顺序执行的请求时间。它们可以通过提前进行一些耗时的工作来帮助减少请求时间，比如定期汇总数据。</p>\n<h2 id="消息队列"><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息队列</h2>\n<p>消息队列接收，保留和传递消息。如果按顺序执行操作太慢的话，你可以使用有以下工作流的消息队列：</p>\n<ul>\n<li>应用程序将作业发布到队列，然后通知用户作业状态</li>\n<li>一个 worker 从队列中取出该作业，对其进行处理，然后显示该作业完成</li>\n</ul>\n<p>不去阻塞用户操作，作业在后台处理。在此期间，客户端可能会进行一些处理使得看上去像是任务已经完成了。例如，如果要发送一条推文，推文可能会马上出现在你的时间线上，但是可能需要一些时间才能将你的推文推送到你的所有关注者那里去。</p>\n<p>Redis 是一个令人满意的简单的消息代理，但是消息有可能会丢失。</p>\n<p>RabbitMQ 很受欢迎但是要求你适应「AMQP」协议并且管理你自己的节点。</p>\n<p>Amazon SQS 是被托管的，但可能具有高延迟，并且消息可能会被传送两次。</p>\n<h2 id="任务队列"><a href="#%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>任务队列</h2>\n<p>任务队列接收任务及其相关数据，运行它们，然后传递其结果。它们可以支持调度，并可用于在后台运行计算密集型作业。</p>\n<p>Celery 支持调度，主要是用 Python 开发的。</p>\n<h2 id="背压"><a href="#%E8%83%8C%E5%8E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背压</h2>\n<p>如果队列开始明显增长，那么队列大小可能会超过内存大小，导致高速缓存未命中，磁盘读取，甚至性能更慢。背压可以通过限制队列大小来帮助我们，从而为队列中的作业保持高吞吐率和良好的响应时间。一旦队列填满，客户端将得到服务器忙或者 HTTP 503 状态码，以便稍后重试。客户端可以在稍后时间重试该请求，也许是指数退避。</p>\n<h2 id="缺点-17"><a href="#%E7%BC%BA%E7%82%B9-17" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h2>\n<ul>\n<li>简单的计算和实时工作流等用例可能更适用于同步操作，因为引入队列可能会增加延迟和复杂性。</li>\n</ul>\n<h1 id="通讯"><a href="#%E9%80%9A%E8%AE%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>通讯</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-38-49-8daa6531ec9f505e6c3c6af824116e27-b03fa.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.61538461538461%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAAD+0lEQVQ4yzVTWU8bVxSe/9D/ULUvfehDpKK2aprUpKCG5CEvhVKpi+imVm2EQF1UqYkJ0MbU4AABEkwjSinUAYMxYzObxzOe8awee+xZvIENMaaYxRjMJnodqVfnHh1dXX3fPd/5LnR0eFQqlSoHByfHJ8XNoiAI8XhcFMXw/4thGE3TYrEYOFxdXd3Z2dnd3QW5UqlAh9VD3dRLO6Wj46Nypby/v39xcXF+fp7L5fL5/Pp6fmNjo1qtXjxf29vbAAVFUQAEKCHrYLfN2X9vuLdn7P4I7FzAPRzDkWQAELIsq+u6oiiRSCSqKKZhpFKpdDoNwzA4B0BQr8veM9vXPW37bc5h8z6YRucXFv3znmWXe2n6n/nZucWn7iUYIVZwSlDimpkpFArRaLRYLNaYOx798u3Aj1//2vHDRFfnVNe4ZwpDiRUMx/AAL0gUzfCCGImq0XiCF+VYPFEulzc3N0F3W1tb0MeD7W0jnW0PO9uGOj593DFFueOqIcdUUY7GdRPsWEIHhWamVM1IZddM0wQqgry3twfduP9FU9+XTfavbji+qZ/87i48ThPMMoIFKMbrQ1CcXFr2c5IS0wwFoGiGqqo0TYMM+KEX77S80v3Ry/daX3V8/sJQ623caUgqI/CiJIFnC6LM8UJUVWVFUXXjWfFfoDZQCyhXE8wy1lw//kH9WHPDaMvlx7es3iGWklaIIEaGCIpFAzQeZFCCIllBJGmVDkUURZLkRCJR63losMnhaOqzNU44b07/ZeE5ezSaTqZMMJNkKp1MpkBkM9nyydn6lDM/0Ht8enp2dgomX1N75o+rTx7Wj9otf469C7vqMMQKozyM4Ct4jdzjQxe8flDIqTV+cCBj79koFIDhgNVqz37y8+W/77wz13UF62/URy9lkS5WNrgwa5gmuAFUNQwzk8kkczlpeCBp79kulYB/wZyBQ6GY7RJprSPuvib1vb7a/1LGbw3J6RDL0WEhLCogGE6mGJ6OxJOPhtbsPQeVQwBa3Nra29+H4N63Qg/exuwWdsiSm6xTlu64l0kf7CMCQQQIRTNkkCYIEg1QotejI74gRYmCIEsSEByC7VepEQs+eI0caYhPvqnjVjdM4YEAFggGqBCCE1SIVaJxgqQCLG/m1l0uF8dxsijpmgaxv1/Duq67f3pPtF/POt7gZ61ePIzihA/BvDDiR2vFMnALYFZUVTNFUQIOeepyRWQZGm9tGG5tHP2wceazm/gnVyITtiAvU8Eg8EYItB7mwTfQND27urbxrLC7V7M08BaGoOCfQfT3zf72Fvj2+3B7i9B5i3T2Ty/6Zl1zrnnPjMv9POZXAlTMzCQy+ZiRqh5VD8oHPMcBA/wHgfokDf2ovUIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 38 49" title="" data-src="/static/2022-08-26-14-38-49-8daa6531ec9f505e6c3c6af824116e27-b03fa.png" data-srcset="/static/2022-08-26-14-38-49-8daa6531ec9f505e6c3c6af824116e27-6fb5f.png 200w,\n/static/2022-08-26-14-38-49-8daa6531ec9f505e6c3c6af824116e27-d11a1.png 400w,\n/static/2022-08-26-14-38-49-8daa6531ec9f505e6c3c6af824116e27-b03fa.png 650w" data-sizes="(max-width: 650px) 100vw, 650px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="超文本传输协议（http）"><a href="#%E8%B6%85%E6%96%87%E6%9C%AC%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE%EF%BC%88http%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>超文本传输协议（HTTP）</h2>\n<p>HTTP 是一种在客户端和服务器之间编码和传输数据的方法。它是一个请求/响应协议：客户端和服务端针对相关内容和完成状态信息的请求和响应。HTTP 是独立的，允许请求和响应流经许多执行负载均衡，缓存，加密和压缩的中间路由器和服务器。</p>\n<p>一个基本的 HTTP 请求由一个动词（方法）和一个资源（端点）组成。 以下是常见的 HTTP 动词：</p>\n<table>\n<thead>\n<tr>\n<th align="left">动词</th>\n<th align="left">描述</th>\n<th align="left">*\n幂等</th>\n<th align="left">安全性</th>\n<th align="left">可缓存</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">GET</td>\n<td align="left">读取资源</td>\n<td align="left">Yes</td>\n<td align="left">Yes</td>\n<td align="left">Yes</td>\n</tr>\n<tr>\n<td align="left">POST</td>\n<td align="left">创建资源或触发处理数据的进程</td>\n<td align="left">No</td>\n<td align="left">No</td>\n<td align="left">Yes，如果回应包含刷新信息</td>\n</tr>\n<tr>\n<td align="left">PUT</td>\n<td align="left">创建或替换资源</td>\n<td align="left">Yes</td>\n<td align="left">No</td>\n<td align="left">No</td>\n</tr>\n<tr>\n<td align="left">PATCH</td>\n<td align="left">部分更新资源</td>\n<td align="left">No</td>\n<td align="left">No</td>\n<td align="left">Yes，如果回应包含刷新信息</td>\n</tr>\n<tr>\n<td align="left">DELETE</td>\n<td align="left">删除资源</td>\n<td align="left">Yes</td>\n<td align="left">No</td>\n<td align="left">No</td>\n</tr>\n</tbody>\n</table>\n<p>多次执行不会产生不同的结果。</p>\n<p>HTTP 是依赖于较低级协议（如 TCP 和 UDP）的应用层协议。</p>\n<h2 id="传输控制协议（tcp）"><a href="#%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE%EF%BC%88tcp%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>传输控制协议（TCP）</h2>\n<p>TCP 是通过 IP 网络的面向连接的协议。 使用握手建立和断开连接。 发送的所有数据包保证以原始顺序到达目的地，用以下措施保证数据包不被损坏：</p>\n<ul>\n<li>每个数据包的序列号和校验码。</li>\n<li>确认包和自动重传</li>\n</ul>\n<p>如果发送者没有收到正确的响应，它将重新发送数据包。如果多次超时，连接就会断开。TCP 实行流量控制和拥塞控制。这些确保措施会导致延迟，而且通常导致传输效率比 UDP 低。</p>\n<p>为了确保高吞吐量，Web 服务器可以保持大量的 TCP 连接，从而导致高内存使用。在 Web 服务器线程间拥有大量开放连接可能开销巨大，消耗资源过多，也就是说，一个 memcached 服务器。连接池可以帮助除了在适用的情况下切换到 UDP。</p>\n<p>TCP 对于需要高可靠性但时间紧迫的应用程序很有用。比如包括 Web 服务器，数据库信息，SMTP，FTP 和 SSH。</p>\n<p>以下情况使用 TCP 代替 UDP：</p>\n<ul>\n<li>你需要数据完好无损。</li>\n<li>你想对网络吞吐量自动进行最佳评估。</li>\n</ul>\n<h2 id="用户数据报协议（udp）"><a href="#%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE%EF%BC%88udp%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用户数据报协议（UDP）</h2>\n<p>UDP 是无连接的。数据报（类似于数据包）只在数据报级别有保证。数据报可能会无序的到达目的地，也有可能会遗失。UDP 不支持拥塞控制。虽然不如 TCP 那样有保证，但 UDP 通常效率更高。</p>\n<p>UDP 可以通过广播将数据报发送至子网内的所有设备。这对 DHCP 很有用，因为子网内的设备还没有分配 IP 地址，而 IP 对于 TCP 是必须的。</p>\n<p>UDP 可靠性更低但适合用在网络电话、视频聊天，流媒体和实时多人游戏上。</p>\n<p>以下情况使用 UDP 代替 TCP：</p>\n<ul>\n<li>你需要低延迟</li>\n<li>相对于数据丢失更糟的是数据延迟</li>\n<li>你想实现自己的错误校正方法</li>\n</ul>\n<h2 id="远程控制调用协议（rpc）"><a href="#%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%B0%83%E7%94%A8%E5%8D%8F%E8%AE%AE%EF%BC%88rpc%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>远程控制调用协议（RPC）</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-26-14-42-55-16cc41b9dad820238ad81f76110f6e09-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 34.599728629579374%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABnklEQVQozz2RbY/SQBSF+///gyb6WddI3Lgas9mIrgHWFYHCtlAK1JZSWgrLdAqF9vHSGCc5mQ9z7j0vY/hBRbjKGZg2T082pmkRLJWgoiypzyaFP37FwlPEsWI+9+j1BgwGpsxZRGslbxo/KDHW65zjMSdNU8IwJIljDgfNavWMZc8Yj+160XgSodRzLbDf70mShCiK6rmyPJNlGfPFDkPrHK11TSzFUlVV9aM7m9EfDBkOTXHj0u32yPOcoihE8MD5fP6Pyw6oRCjH2G4VOlPkQkrTrbjIZCBnMnHp9Uc406kgwXU9Edr/W6BrXJxebqWUmDkRJwpj4qQcDwWjkcmH62ts2xKikjgFm00m/SXsJOl8oVku4zrFJbptjWg03tP81mQnBNcNpJoDxturW1odB8/bSclTHh6G/Oou+N0PyfSprsJ1N/TNNfc/bPkEnyDY4/s77HGA46xFTPHxpsXtXQ+j3XakH59leHFxxBzG3Hx64MXLN0Txtl74tfnIq9cNOj9ntDsuV+/u+Pyly9w7sYoQZwWt1oTv9xZ/AaMoBE+YgL0LAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 26 14 42 55" title="" data-src="/static/2022-08-26-14-42-55-16cc41b9dad820238ad81f76110f6e09-160dc.png" data-srcset="/static/2022-08-26-14-42-55-16cc41b9dad820238ad81f76110f6e09-fc7b9.png 200w,\n/static/2022-08-26-14-42-55-16cc41b9dad820238ad81f76110f6e09-cea17.png 400w,\n/static/2022-08-26-14-42-55-16cc41b9dad820238ad81f76110f6e09-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>在 RPC 中，客户端会去调用另一个地址空间（通常是一个远程服务器）里的方法。调用代码看起来就像是调用的是一个本地方法，客户端和服务器交互的具体过程被抽象。远程调用相对于本地调用一般较慢而且可靠性更差，因此区分两者是有帮助的。热门的 RPC 框架包括 Protobuf、Thrift 和 Avro。</p>\n<p>RPC 是一个“请求-响应”协议：</p>\n<ul>\n<li>客户端程序 ── 调用客户端存根程序。就像调用本地方法一样，参数会被压入栈中。</li>\n<li>客户端 stub 程序 ── 将请求过程的 id 和参数打包进请求信息中。</li>\n<li>客户端通信模块 ── 将信息从客户端发送至服务端。</li>\n<li>服务端通信模块 ── 将接受的包传给服务端存根程序。</li>\n<li>服务端 stub 程序 ── 将结果解包，依据过程 id 调用服务端方法并将参数传递过去。</li>\n</ul>\n<p>RPC 调用示例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90896439916744230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`GET /someoperation?data=anId\n\nPOST /anotheroperation\n{\n  &quot;data&quot;:&quot;anId&quot;;\n  &quot;anotherdata&quot;: &quot;another value&quot;\n}`, `90896439916744230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">GET /someoperation?data=anId\n\nPOST /anotheroperation\n{\n  &quot;data&quot;:&quot;anId&quot;;\n  &quot;anotherdata&quot;: &quot;another value&quot;\n}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>RPC 专注于暴露方法。RPC 通常用于处理内部通讯的性能问题，这样你可以手动处理本地调用以更好的适应你的情况。</p>\n<p>当以下情况时选择本地库（也就是 SDK）：</p>\n<ul>\n<li>你知道你的目标平台。</li>\n<li>你想控制如何访问你的“逻辑”。</li>\n<li>你想对发生在你的库中的错误进行控制。</li>\n<li>性能和终端用户体验是你最关心的事。</li>\n</ul>\n<p>遵循 REST 的 HTTP API 往往更适用于公共 API。</p>\n<h3 id="缺点-18"><a href="#%E7%BC%BA%E7%82%B9-18" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>RPC 客户端与服务实现捆绑地很紧密。</li>\n<li>一个新的 API 必须在每一个操作或者用例中定义。</li>\n<li>RPC 很难调试。</li>\n<li>你可能没办法很方便的去修改现有的技术。举个例子，如果你希望在 Squid 这样的缓存服务器上确保 RPC 被正确缓存的话可能需要一些额外的努力了。</li>\n</ul>\n<h2 id="表述性状态转移（rest）"><a href="#%E8%A1%A8%E8%BF%B0%E6%80%A7%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%EF%BC%88rest%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>表述性状态转移（REST）</h2>\n<p>REST 是一种强制的客户端/服务端架构设计模型，客户端基于服务端管理的一系列资源操作。服务端提供修改或获取资源的接口。所有的通信必须是无状态和可缓存的。</p>\n<p>RESTful 接口有四条规则：</p>\n<ul>\n<li>标志资源（HTTP 里的 URI） ── 无论什么操作都使用同一个 URI。</li>\n<li>表示的改变（HTTP 的动作） ── 使用动作, headers 和 body。</li>\n<li>可自我描述的错误信息（HTTP 中的 status code） ── 使用状态码，不要重新造轮子。</li>\n<li>HATEOAS（HTTP 中的 HTML 接口） ── 你的 web 服务器应该能够通过浏览器访问。</li>\n</ul>\n<p>REST 请求的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23237052094607356000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`GET /someresources/anId\n\nPUT /someresources/anId\n{&quot;anotherdata&quot;: &quot;another value&quot;}`, `23237052094607356000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">GET /someresources/anId\n\nPUT /someresources/anId\n{&quot;anotherdata&quot;: &quot;another value&quot;}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>REST 关注于暴露数据。它减少了客户端/服务端的耦合程度，经常用于公共 HTTP API 接口设计。REST 使用更通常与规范化的方法来通过 URI 暴露资源，通过 header 来表述并通过 GET、POST、PUT、DELETE 和 PATCH 这些动作来进行操作。因为无状态的特性，REST 易于横向扩展和隔离。</p>\n<h3 id="缺点-19"><a href="#%E7%BC%BA%E7%82%B9-19" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>由于 REST 将重点放在暴露数据，所以当资源不是自然组织的或者结构复杂的时候它可能无法很好的适应。举个例子，返回过去一小时中与特定事件集匹配的更新记录这种操作就很难表示为路径。使用 REST，可能会使用 URI 路径，查询参数和可能的请求体来实现。</li>\n<li>REST 一般依赖几个动作（GET、POST、PUT、DELETE 和 PATCH），但有时候仅仅这些没法满足你的需要。举个例子，将过期的文档移动到归档文件夹里去，这样的操作可能没法简单的用上面这几个 verbs 表达。</li>\n<li>为了渲染单个页面，获取被嵌套在层级结构中的复杂资源需要客户端，服务器之间多次往返通信。例如，获取博客内容及其关联评论。对于使用不确定网络环境的移动应用来说，这些多次往返通信是非常麻烦的。</li>\n<li>随着时间的推移，更多的字段可能会被添加到 API 响应中，较旧的客户端将会接收到所有新的数据字段，即使是那些它们不需要的字段，结果它会增加负载大小并引起更大的延迟。</li>\n</ul>\n<h2 id="rpc-与-rest-比较"><a href="#rpc-%E4%B8%8E-rest-%E6%AF%94%E8%BE%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RPC 与 REST 比较</h2>\n<table>\n<thead>\n<tr>\n<th>操作</th>\n<th>RPC</th>\n<th>REST</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>注册</td>\n<td><strong>POST</strong>\n /signup</td>\n<td><strong>POST</strong>\n /persons</td>\n</tr>\n<tr>\n<td>注销</td>\n<td><strong>POST</strong>\n /resign\n<br/>\n{\n<br/>\n“personid”: “1234”\n<br/>\n}</td>\n<td><strong>DELETE</strong>\n /persons/1234</td>\n</tr>\n<tr>\n<td>读取用户信息</td>\n<td><strong>GET</strong>\n /readPerson?personid=1234</td>\n<td><strong>GET</strong>\n /persons/1234</td>\n</tr>\n<tr>\n<td>读取用户物品列表</td>\n<td><strong>GET</strong>\n /readUsersItemsList?personid=1234</td>\n<td><strong>GET</strong>\n /persons/1234/items</td>\n</tr>\n<tr>\n<td>向用户物品列表添加一项</td>\n<td><strong>POST</strong>\n /addItemToUsersItemsList\n<br/>\n{\n<br/>\n“personid”: “1234”;\n<br/>\n“itemid”: “456”\n<br/>\n}</td>\n<td><strong>POST</strong>\n /persons/1234/items\n<br/>\n{\n<br/>\n“itemid”: “456”\n<br/>\n}</td>\n</tr>\n<tr>\n<td>更新一个物品</td>\n<td><strong>POST</strong>\n /modifyItem\n<br/>\n{\n<br/>\n“itemid”: “456”;\n<br/>\n“key”: “value”\n<br/>\n}</td>\n<td><strong>PUT</strong>\n /items/456\n<br/>\n{\n<br/>\n“key”: “value”\n<br/>\n}</td>\n</tr>\n<tr>\n<td>删除一个物品</td>\n<td><strong>POST</strong>\n /removeItem\n<br/>\n{\n<br/>\n“itemid”: “456”\n<br/>\n}</td>\n<td><strong>DELETE</strong>\n /items/456</td>\n</tr>\n</tbody>\n</table>\n<h1 id="安全"><a href="#%E5%AE%89%E5%85%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安全</h1>\n<ul>\n<li>在运输和等待过程中加密</li>\n<li>对所有的用户输入和从用户那里发来的参数进行处理以防止 XSS 和 SQL 注入。</li>\n<li>使用参数化的查询来防止 SQL 注入。</li>\n<li>使用最小权限原则。</li>\n</ul>',
excerpt:"背景知识 系统设计 系统设计主题：从这里开始 认识以下一般性原则 可扩展性视频讲座 哈佛大学可扩展性讲座 垂直扩展（Vertical scaling） 水平扩展（Horizontal scaling） 缓存 负载均衡 数据库复制 数据库分区 可扩展性文章 Clones…",frontmatter:{date:"2022-08-26 15:07:36",path:"/system-design-practice-learn/",tags:"后端, 系统设计, 读书笔记",title:"系统设计入门学习",draft:null}},prePost:{html:'<h1 id="快速入门"><a href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>快速入门</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-09-14-26-57-a4b4c499dc474ad1d7eb16b3d483f0d4-74e39.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 763px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 69.46264744429882%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABvklEQVQoz4WS6XKbQBCEef8Xy89EjpEtW+La5YZluSVA4A/h2KqUUqlqqYaZ6Z3enjWuiwKXKekv8TTn2+dfmJdimFJVOEXplo3IlNX2AUmD2nDN4vQo/ZeuD0k9JF/GxHafgugQRgfL3intLos2KMxzwWEi2J+HhNSa+YONuUFXQmmnaiTNCKFk1K1Pqm5lWQugK7eqRdWIsvIQOUwZ3eTrRvbnyBW/n80fuvSWpbzOygjCgydMDpPBi/D3QfhqOU9CmnHyTpxkxyQ7hfGbKmxPPkfJ29H6mSmbeQw32j7UlTeM6bgOEUho2qDpAhQxk8lN56/JzsfRqpXE/SVquwAXjE8ntcMRAMNRDnJlk6eDEvopcUnE59rWtZdmp3UyE6il+QmdeK60jUjb3XnSRDAcx93hM5fiFDi288uVJhccr/lKRjOqANvD7e4cxuk7NETRseVJUkI5MZeCsu4ZMrddtzKrFYs6DzGjcPh+58TTks9fy7913iZP6VcfAT5heF7YD1/bPYxmk91+yx7GjA213arzP2Qm8+KKm6X8l7Xnh6+e3LPMfz31bzI/bMDqLLfAuo/WRzbePnzn9/gABjsUkdQdm6YAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 09 14 26 57" title="" data-src="/static/2022-08-09-14-26-57-a4b4c499dc474ad1d7eb16b3d483f0d4-74e39.png" data-srcset="/static/2022-08-09-14-26-57-a4b4c499dc474ad1d7eb16b3d483f0d4-5eda4.png 200w,\n/static/2022-08-09-14-26-57-a4b4c499dc474ad1d7eb16b3d483f0d4-73d63.png 400w,\n/static/2022-08-09-14-26-57-a4b4c499dc474ad1d7eb16b3d483f0d4-74e39.png 763w" data-sizes="(max-width: 763px) 100vw, 763px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="绘制一个点"><a href="#%E7%BB%98%E5%88%B6%E4%B8%80%E4%B8%AA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>绘制一个点</h2>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/3c2kgh?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="着色器代码放在-script-标签中"><a href="#%E7%9D%80%E8%89%B2%E5%99%A8%E4%BB%A3%E7%A0%81%E6%94%BE%E5%9C%A8-script-%E6%A0%87%E7%AD%BE%E4%B8%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>着色器代码放在 script 标签中</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88650216521530330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!-- 顶点着色器源码 -->\n<script id=&quot;vertexShader&quot; type=&quot;x-shader/x-vertex&quot;>\n   void main() {\n     // 给内置变量 gl_PointSize 赋值像素大小\n     gl_PointSize = 20.0;\n     // 顶点位置，位于坐标原点\n     gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n   }\n</script>\n<!-- 片元着色器源码 -->\n<script id=&quot;fragmentShader&quot; type=&quot;x-shader/x-fragment&quot;>\n   void main() {\n     gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n   }\n</script>`, `88650216521530330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token comment">&lt;!-- 顶点着色器源码 --></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>vertexShader<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>x-shader/x-vertex<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n     <span class="token comment">// 给内置变量 gl_PointSize 赋值像素大小</span>\n     gl_PointSize <span class="token operator">=</span> <span class="token number">20.0</span><span class="token punctuation">;</span>\n     <span class="token comment">// 顶点位置，位于坐标原点</span>\n     gl_Position <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token comment">&lt;!-- 片元着色器源码 --></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fragmentShader<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>x-shader/x-fragment<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n   <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n     gl_FragColor <span class="token operator">=</span> <span class="token function">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10613274274889472000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 顶点着色器源码\nvar vertexShaderSource = document.getElementById(\'vertexShader\').innerText;\n// 片元着色器源码\nvar fragShaderSource = document.getElementById(\'fragmentShader\').innerText;\n// 初始化着色器\nvar program = initShader(gl, vertexShaderSource, fragShaderSource);`, `10613274274889472000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 顶点着色器源码</span>\n<span class="token keyword">var</span> vertexShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'vertexShader\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>\n<span class="token comment">// 片元着色器源码</span>\n<span class="token keyword">var</span> fragShaderSource <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'fragmentShader\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>\n<span class="token comment">// 初始化着色器</span>\n<span class="token keyword">var</span> program <span class="token operator">=</span> <span class="token function">initShader</span><span class="token punctuation">(</span>gl<span class="token punctuation">,</span> vertexShaderSource<span class="token punctuation">,</span> fragShaderSource<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="绘制一个矩形"><a href="#%E7%BB%98%E5%88%B6%E4%B8%80%E4%B8%AA%E7%9F%A9%E5%BD%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>绘制一个矩形</h2>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/q3r5b7?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="attribute-关键字"><a href="#attribute-%E5%85%B3%E9%94%AE%E5%AD%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>attribute 关键字</h3>\n<p>声明顶点相关数据的时候需要用到 attribute 关键字，目的是为了 js 可以调用相关的 WebGL API 把顶点相关数据从 js 传递给顶点着色器 attribute 声明的变量。</p>\n<h3 id="drawarrays-整体执行顺序"><a href="#drawarrays-%E6%95%B4%E4%BD%93%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>drawArrays 整体执行顺序</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-09-16-51-11-90d5cb08b12e22656c560628d22a7c47-50b07.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 15.501519756838904%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAwklEQVQI1wG3AEj/AFad306X3/P57b3a6DaJ25fD5f//72qo4UWS3ev17Mvi6jGG3Iy85P//8G6r4kCQ3eby7NDk6j2O33604wASb9AHZ83l7uWUu9gAU8lsqN719eEpfNAAYc3c6ueoxtoATshdn9z//+QsfdAAX8/V5uWtydkAWs5KktkAOonYMYHU7/brsNDlFXLThrjh///tUJbZJ3zU5vLrwNrnD23PeK/f///vVZjZIHnU4O7qxd3oG3nYaKffYaF6lQgy0RIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 09 16 51 11" title="" data-src="/static/2022-08-09-16-51-11-90d5cb08b12e22656c560628d22a7c47-fee1c.png" data-srcset="/static/2022-08-09-16-51-11-90d5cb08b12e22656c560628d22a7c47-a67b7.png 200w,\n/static/2022-08-09-16-51-11-90d5cb08b12e22656c560628d22a7c47-0b187.png 400w,\n/static/2022-08-09-16-51-11-90d5cb08b12e22656c560628d22a7c47-fee1c.png 800w,\n/static/2022-08-09-16-51-11-90d5cb08b12e22656c560628d22a7c47-50b07.png 987w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="硬件相关"><a href="#%E7%A1%AC%E4%BB%B6%E7%9B%B8%E5%85%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>硬件相关</h3>\n<ul>\n<li>\n<p>着色器语言编写的程序称为着色器程序(shader program)，在 GPU 顶点着色器单元上执行的是顶点着色器程序，在 GPU 片元着色器单元上执行的是片元着色器程序。</p>\n<p>顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50711422701505310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// attribute 声明 vec4 类型变量 apos\nattribute vec4 apos;\nvoid main() {\n   // 顶点坐标 apos 赋值给内置变量 gl_Position\n   // 逐顶点处理数据\n   gl_Position = apos;\n}`, `50711422701505310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// attribute 声明 vec4 类型变量 apos</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> apos<span class="token punctuation">;</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 顶点坐标 apos 赋值给内置变量 gl_Position</span>\n   <span class="token comment">// 逐顶点处理数据</span>\n   gl_Position <span class="token operator">=</span> apos<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>片元着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34438956373447983000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void main() {\n   // 逐片元处理数据，所有片元(像素)设置为红色\n   gl_FragColor = vec4(1.0,0.0,0.0,1.0);\n}`, `34438956373447983000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 逐片元处理数据，所有片元(像素)设置为红色</span>\n   gl_FragColor <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>可编程顶点处理器(Programmable Vertex Processor)又称为顶点着色器，用来执行顶点着色器程序</p>\n</li>\n<li>\n<p>可编程片元处理器(Programmable Fragment Processor)又称为片元着色器，用来执行片元着色器程序</p>\n</li>\n<li>\n<p>GPU 中有各种专门的寄存器，比如用来接收顶点坐标数据的寄存器是输入寄存器，从数据类型的角度看属于浮点寄存器，用来临时存储浮点数；存储输出到显示器像素的帧缓存是输出寄存器，从处理速度的角度看是数据缓冲寄存器，GPU 处理数据的速度要比显示器扫描帧缓存中像素数据的速度要快得多</p>\n</li>\n<li>\n<p>显示器像素是显示器可以通过 RGB 值控制的最小单位，一幅图像是由大量像素点累积显示。着色器中的颜色定义会反映在显示器中</p>\n</li>\n<li>\n<p>显示器的分辨率就是显示器长度方向像素点的个数 X 显示器宽度方向像素点的个数</p>\n</li>\n<li>\n<p>屏幕相邻的两个像素单元的距离就是点距，点距越小显示效果越好，一般现在显示器 0.2mm~0.4mm 之间</p>\n</li>\n</ul>\n<h2 id="webgl-坐标系投影"><a href="#webgl-%E5%9D%90%E6%A0%87%E7%B3%BB%E6%8A%95%E5%BD%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 坐标系—投影</h2>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/tf4psj?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<ol>\n<li>canvas 画布宽高采用的是像素值定义，以显示器为准，WebGL 中顶点坐标的表示方法采用的是相对坐标，相对于 canvas 而言 WebGL 坐标系统，X 轴水平向右，也就是 canvas 画布的 width 表示的宽度方向，x 等于 -1 表示 canvas 画布的左边界，x 等于 1 表示 canvas 画布的右边界，x 等于 0 对应的是画布宽度方向的中间。</li>\n<li>WebGL 坐标系统，Y 轴竖直向上，也就是 canvas 画布的 height 表示的高度方向，y 等于 -1 表示 canvas 画布的下边界，y 等于 1 表示 canvas 画布的上边界，y 等于 0 对应的是画布高度方向的中间。</li>\n<li>WebGL 坐标系统，Z 轴垂直 canvas 画布朝外，Z 值 -1 和 1 是 Z 方向的极限值，GPU 成像默认的沿着 Z 轴投影，你也可以抽象出一个概念，人眼睛位于 z 轴上，沿着 z 轴方向去观察物体，如果你在其他的书上看到视图坐标系等其它各类坐标系都是抽象出的概念都是建立在本节课所说的 WebGL 坐标系统之上，例如无人机导航中的所说的机体坐标系、地球坐标系都是直接对现实中事物的描述，三维场景中的各类坐标系与无人机中坐标系没什么区别，但是要显示在屏幕上，就要经过一些处理，这里不再详述，后面的教程后为大家引入各类坐标系概念，正射投影和透射投影概念。</li>\n</ol>\n<h2 id="webgl-平移变换"><a href="#webgl-%E5%B9%B3%E7%A7%BB%E5%8F%98%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 平移变换</h2>\n<p>有以下几种方式可以做到沿 X 轴平移 -0.4</p>\n<h3 id="方法一"><a href="#%E6%96%B9%E6%B3%95%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法一</h3>\n<p>提前在顶点中计算</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3176928667110856700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var data = new Float32Array([\n   // 三角形顶点 1 坐标\n   0.0,\n   0.0,\n   1.0,\n\n   // 三角形顶点 2 坐标\n   0.0,\n   1.0,\n   0.0,\n\n   // 三角形顶点 3 坐标\n   1.0,\n   0.0,\n   0.0\n]);\n\n// x 坐标分别减少 0.4\n\nvar data = new Float32Array([\n   // 三角形顶点 1 坐标\n   -0.4,\n   0.0,\n   1.0,\n\n   // 三角形顶点 2 坐标\n   -0.4,\n   1.0,\n   0.0,\n\n   // 三角形顶点 3 坐标\n   0.6,\n   0.0,\n   0.0\n]);`, `3176928667110856700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token comment">// 三角形顶点 1 坐标</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n   <span class="token number">1.0</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 三角形顶点 2 坐标</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n   <span class="token number">1.0</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 三角形顶点 3 坐标</span>\n   <span class="token number">1.0</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// x 坐标分别减少 0.4</span>\n\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token comment">// 三角形顶点 1 坐标</span>\n   <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n   <span class="token number">1.0</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 三角形顶点 2 坐标</span>\n   <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span>\n   <span class="token number">1.0</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 三角形顶点 3 坐标</span>\n   <span class="token number">0.6</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span><span class="token punctuation">,</span>\n   <span class="token number">0.0</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="方法二"><a href="#%E6%96%B9%E6%B3%95%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法二</h3>\n<p>循环修改数组 <code class="language-text">data=new Float32Array([..</code> 的顶点数据，把顶点坐标平移的数学计算任务交给 CPU</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57551564317458250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`for (var i = 0; i < 9; i += 3) {\n   data[i] += -0.4;\n}`, `57551564317458250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="方法三"><a href="#%E6%96%B9%E6%B3%95%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法三</h3>\n<p>替换掉原来的代码 <code class="language-text">gl_Position = vec4(apos.x, apos.y, apos.z, 1)</code>，把顶点平移的数学运算任务交给了 GPU</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57902146292916540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 在顶点着色器中逐顶点沿着 x 轴平移 -0.4\ngl_Position = vec4(apos.x - 0.4, apos.y, apos.z, 1);`, `57902146292916540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 在顶点着色器中逐顶点沿着 x 轴平移 -0.4</span>\ngl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>apos<span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token number">0.4</span><span class="token punctuation">,</span> apos<span class="token punctuation">.</span>y<span class="token punctuation">,</span> apos<span class="token punctuation">.</span>z<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="方法四"><a href="#%E6%96%B9%E6%B3%95%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法四</h3>\n<p>在原来的顶点着色器代码中，声明一个 4 x 4 矩阵 m4，然后通过矩阵和表示顶点坐标的列向量相乘 <code class="language-text">m4 * apos</code>，实现对顶点 apos 的平移变换，和方法三一样把数学计算任务交给 GPU 处理器，具体说是顶点着色器单元（Vertex Processor），顶点着色器单元能够完成矩阵的乘法运算。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50671714575308770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// attribute 声明 vec4 类型变量 apos\nattribute vec4 apos;\nvoid main() {\n  // 创建平移矩阵（沿 x 轴平移 -0.4）\n  // 1   0   0  -0.4\n  // 0   1   0    0\n  // 0   0   1    0\n  // 0   0   0    1\n  mat4 m4 = mat4(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, -0.4, 0, 0, 1);\n  // 平移矩阵 m4 左乘顶点坐标（vec4 类型数据可以理解为线性代数中的 nx1 矩阵，即列向量）\n  // 逐顶点进行矩阵变换\n  gl_Position = m4 * apos;\n}`, `50671714575308770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// attribute 声明 vec4 类型变量 apos</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> apos<span class="token punctuation">;</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建平移矩阵（沿 x 轴平移 -0.4）</span>\n  <span class="token comment">// 1   0   0  -0.4</span>\n  <span class="token comment">// 0   1   0    0</span>\n  <span class="token comment">// 0   0   1    0</span>\n  <span class="token comment">// 0   0   0    1</span>\n  <span class="token keyword">mat4</span> m4 <span class="token operator">=</span> <span class="token keyword">mat4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 平移矩阵 m4 左乘顶点坐标（vec4 类型数据可以理解为线性代数中的 nx1 矩阵，即列向量）</span>\n  <span class="token comment">// 逐顶点进行矩阵变换</span>\n  gl_Position <span class="token operator">=</span> m4 <span class="token operator">*</span> apos<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>mat4 关键字和 vec4 关键字一样用来声明 WebGL 着色器变量的数据类型，和 vec4 一样也具有构造数据的功能。</p>\n<p>vec4 是 4 x 1 矩阵，就是列向量，有四个元素，mat4 表示 4 x 4 矩阵，mat4() 函数括号中的 16 个数据，每四个为一组，以列为准，前四个数就是 mat4 矩阵的第一列，后面的按顺序依次排列。</p>\n<h4 id="平移矩阵解析"><a href="#%E5%B9%B3%E7%A7%BB%E7%9F%A9%E9%98%B5%E8%A7%A3%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>平移矩阵解析</h4>\n<p>一个点的坐标是 (x, y, z)，假设沿着 X、Y、Z 轴分别平移 Tx、Ty、Tz，平移后的坐标是 <code class="language-text">(x + Tx, y + Ty, z + Tz)</code>。</p>\n<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>T</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>T</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>T</mi><mi>z</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi><mo>+</mo><mi>T</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi><mo>+</mo><mi>T</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi><mo>+</mo><mi>T</mi><mi>z</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">   \\begin{bmatrix}\n   1 &amp; 0 &amp; 0 &amp; Tx \\\\\n   0 &amp; 1 &amp; 0 &amp; Ty \\\\\n   0 &amp; 0 &amp; 1 &amp; Tz \\\\\n   0 &amp; 0 &amp; 0 &amp; 1 \\\\\n   \\end{bmatrix}\n\n   \\begin{bmatrix}\n   x \\\\\n   y \\\\\n   z \\\\\n   1 \\\\\n   \\end{bmatrix}\n\n   =\n\n   \\begin{bmatrix}\n   x + Tx \\\\\n   y + Ty \\\\\n   z + Tz \\\\\n   1 \\\\\n   \\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.6520099999999998em;"></span><span class="strut bottom" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="base"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit">x</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit">x</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span></span></span></span></span>\n<h3 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>上面计算式的巧妙之处就是把三维坐标，增加一个元素 1.0，用 4 x 1 矩阵表示，n x 1 矩阵也称为列向量，对应的数据类型就是 vec4</li>\n<li>n 维向量增加一个维度用 n + 1 维向量表示就是齐次坐标。</li>\n<li>上面的 4 x 4 矩阵，就是平移矩阵，平移矩阵左乘顶点的齐次坐标，结果仍然是一个齐次坐标，也就是平移后的坐标。</li>\n<li>矩阵的乘法满足结合律，如果多次平移，可以把所有的平移矩阵先进行乘法运算，然后左乘要平移顶点的齐次坐标。</li>\n</ol>\n<h2 id="webgl-旋转变换"><a href="#webgl-%E6%97%8B%E8%BD%AC%E5%8F%98%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 旋转变换</h2>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/5g67mm?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="着色器内置函数"><a href="#%E7%9D%80%E8%89%B2%E5%99%A8%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>着色器内置函数</h3>\n<p>WebGL 着色器提供了一系列可以内置函数，也就是说不用声明可以直接调用的函数。</p>\n<p>radians() 函数：角度值转化为弧度制，参数是浮点数 float，比如 30 度时，要写成 30.0</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68691900294334005000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 旋转角度 30 度转化为弧度值\nfloat radian = radians(30.0);`, `68691900294334005000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 旋转角度 30 度转化为弧度值</span>\n<span class="token keyword">float</span> radian <span class="token operator">=</span> <span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>cos() 是余弦函数，参数要求是弧度值且是浮点数</p>\n<p>sin() 是正弦函数，参数要求是弧度值且是浮点数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38481216862902400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 求解旋转角度余弦值\nfloat cos = cos(radian);\n// 求解旋转角度正弦值\nfloat sin = sin(radian);`, `38481216862902400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 求解旋转角度余弦值</span>\n<span class="token keyword">float</span> cos <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 求解旋转角度正弦值</span>\n<span class="token keyword">float</span> sin <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="流程简述"><a href="#%E6%B5%81%E7%A8%8B%E7%AE%80%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>流程简述</h3>\n<p>多次调用了绘制命令 <code class="language-text">gl.drawArrays</code>，data 变量定义的顶点数据初始化时，会存入内存中，执行代码 <code class="language-text">gl.bindBuffer(gl.ARRAY_BUFFER, buffer);</code> 内存中的数据一次性传入显存缓冲区中，传入缓冲区中的顶点数据可以通过 drawArrays 方法多次调用，每次 drawArrays 方法调用，顶点经过渲染管线得到的像素相关数据都会存入帧缓存中，后一次调用，前一次调用生成的像素数据不会清空，最终形成一幅完整的立方体线框图。</p>\n<h3 id="旋转矩阵解析"><a href="#%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5%E8%A7%A3%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>旋转矩阵解析</h3>\n<p>假设一个点的坐标是 (x, y, z)，经过旋转变换后的坐标为 (X, Y, Z)</p>\n<h4 id="绕-z-轴旋转-γ-角度"><a href="#%E7%BB%95-z-%E8%BD%B4%E6%97%8B%E8%BD%AC-%CE%B3-%E8%A7%92%E5%BA%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>绕 Z 轴旋转 γ 角度</h4>\n<p>z 的坐标不变，x、y 的坐标发生变化，在笛卡尔坐标系下通过简单的数学计算就可以知道结果 <code class="language-text">X = xcosγ - ysinγ, Y = xsinγ + ycosγ</code></p>\n<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>γ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>γ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mi>γ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>γ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>γ</mi><mo>−</mo><mi>y</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>γ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>γ</mi><mo>+</mo><mi>y</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>γ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">   \\begin{bmatrix}\n   cosγ &amp; -sinγ &amp; 0 &amp; 0 \\\\\n   sinγ &amp; cosγ &amp; 0 &amp; 0 \\\\\n   0 &amp; 0 &amp; 1 &amp; 0 \\\\\n   0 &amp; 0 &amp; 0 &amp; 1 \\\\\n   \\end{bmatrix}\n\n   \\begin{bmatrix}\n   x \\\\\n   y \\\\\n   z \\\\\n   1 \\\\\n   \\end{bmatrix}\n\n   =\n\n   \\begin{bmatrix}\n   xcosγ - ysinγ \\\\\n   xsinγ + ycosγ \\\\\n   z \\\\\n   1 \\\\\n   \\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.6520099999999998em;"></span><span class="strut bottom" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="base"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05556em;">γ</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span></span></span></span></span>\n<h4 id="绕-x-轴旋转-α-角度"><a href="#%E7%BB%95-x-%E8%BD%B4%E6%97%8B%E8%BD%AC-%CE%B1-%E8%A7%92%E5%BA%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>绕 X 轴旋转 α 角度</h4>\n<p>x 的坐标不变，y、z 的坐标发生变化 <code class="language-text">Y = ycosα - zsinα, Z = ysinα + zcosα</code></p>\n<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>α</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>α</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mi>α</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>α</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>α</mi><mo>−</mo><mi>z</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>α</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>α</mi><mo>+</mo><mi>z</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>α</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">   \\begin{bmatrix}\n   1 &amp; 0 &amp; 0 &amp; 0 \\\\\n   0 &amp; cosα &amp; -sinα &amp; 0 \\\\\n   0 &amp; sinα &amp; cosα &amp; 0 \\\\\n   0 &amp; 0 &amp; 0 &amp; 1 \\\\\n   \\end{bmatrix}\n\n   \\begin{bmatrix}\n   x \\\\\n   y \\\\\n   z \\\\\n   1 \\\\\n   \\end{bmatrix}\n\n   =\n\n   \\begin{bmatrix}\n   x \\\\\n   ycosα - zsinα \\\\\n   ysinα + zcosα \\\\\n   1 \\\\\n   \\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.6520099999999998em;"></span><span class="strut bottom" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="base"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.0037em;">α</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.0037em;">α</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.0037em;">α</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.0037em;">α</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.0037em;">α</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.0037em;">α</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.0037em;">α</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.0037em;">α</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span></span></span></span></span>\n<h4 id="绕-y-轴旋转-β-角度"><a href="#%E7%BB%95-y-%E8%BD%B4%E6%97%8B%E8%BD%AC-%CE%B2-%E8%A7%92%E5%BA%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>绕 Y 轴旋转 β 角度</h4>\n<p>y 的坐标不变，x、z 的坐标发生变化 <code class="language-text">X = zsinβ + xcosβ, Z = zcosβ - xsinβ</code></p>\n<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>β</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mi>β</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>β</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>β</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>β</mi><mo>+</mo><mi>x</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>β</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>z</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>β</mi><mo>−</mo><mi>x</mi><mi>s</mi><mi>i</mi><mi>n</mi><mi>β</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">   \\begin{bmatrix}\n   cosβ &amp; 0 &amp; sinβ &amp; 0 \\\\\n   0 &amp; 1 &amp; 0 &amp; 0 \\\\\n   -sinβ &amp; 0 &amp; cosβ &amp; 0 \\\\\n   0 &amp; 0 &amp; 0 &amp; 1 \\\\\n   \\end{bmatrix}\n\n   \\begin{bmatrix}\n   x \\\\\n   y \\\\\n   z \\\\\n   1 \\\\\n   \\end{bmatrix}\n\n   =\n\n   \\begin{bmatrix}\n   zsinβ + xcosβ \\\\\n   y \\\\\n   zcosβ - xsinβ \\\\\n   1 \\\\\n   \\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.6520099999999998em;"></span><span class="strut bottom" style="height:4.80204em;vertical-align:-2.15003em;"></span><span class="base"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05278em;">β</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05278em;">β</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05278em;">β</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05278em;">β</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05278em;">β</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit">x</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05278em;">β</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.05278em;">β</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit">x</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit" style="margin-right:0.05278em;">β</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6520099999999998em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.80499em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.40599em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.65201em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"></span></span></span></span></span></span></span></span></span></span>\n<h3 id="总结-1"><a href="#%E6%80%BB%E7%BB%93-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<ol>\n<li>如果几何体经过多次旋转可以把每一次的旋转矩阵，连续进行乘法运算，最后再左乘顶点的齐次坐标</li>\n<li>旋转变换和平移变换同时存在，旋转矩阵和平移矩阵一样都是四阶矩阵，因此同样可以先进行乘法运算得到的仍是四阶矩阵，最后再左乘顶点的齐次坐标，这种情况也就是复合变换</li>\n</ol>\n<h2 id="webgl-顶点索引绘制"><a href="#webgl-%E9%A1%B6%E7%82%B9%E7%B4%A2%E5%BC%95%E7%BB%98%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 顶点索引绘制</h2>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/eep0sn?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>WebGL 为了复用顶点数据新引入了一个新的绘制函数 gl.drawElements()，gl.drawElements() 和 gl.drawArrays() 方法一样都是命令浏览器 WebGL 图形系统开始处理顶点绘制渲染出像素并显示在屏幕 Canvas 画布上。区别是 gl.drawArrays() 方法直接调用顶点数组数据，gl.drawElements() 是通过一个索引数组访问使用顶点数组中的顶点数据。</p>\n<p>可以在上面旋转变换的基础上进行修改</p>\n<h3 id="顶点列举"><a href="#%E9%A1%B6%E7%82%B9%E5%88%97%E4%B8%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点列举</h3>\n<p>只需要把所有的顶点列举一次即可，不用重复枚举。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94408223286927150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 8 个顶点坐标数组\nvar data = new Float32Array([\n   // 顶点 0\n   0.5,\n   0.5,\n   0.5,\n\n   // 顶点 1\n   -0.5,\n   0.5,\n   0.5,\n\n   // 顶点 2\n   -0.5,\n   -0.5,\n   0.5,\n\n   // 顶点 3\n   0.5,\n   -0.5,\n   0.5,\n\n   // 顶点 4\n   0.5,\n   0.5,\n   -0.5,\n\n   // 顶点 5\n   -0.5,\n   0.5,\n   -0.5,\n\n   // 顶点 6\n   -0.5,\n   -0.5,\n   -0.5,\n\n   // 顶点 7\n   0.5,\n   -0.5,\n   -0.5\n]);`, `94408223286927150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 8 个顶点坐标数组</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token comment">// 顶点 0</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 顶点 1</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 顶点 2</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 顶点 3</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 顶点 4</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 顶点 5</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 顶点 6</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 顶点 7</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="顶点的索引数组"><a href="#%E9%A1%B6%E7%82%B9%E7%9A%84%E7%B4%A2%E5%BC%95%E6%95%B0%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点的索引数组</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-10-17-15-53-6b64f1ed429fee18498ed7b461b50ae3-28759.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 500px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 31.6%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABcUlEQVQY002QPS9EQRSG3zkzc++dXXu/7L277N5NJLKUEoQQKgWloBCl4A8oNHr/AMlSSRT+AI2KKESh85GQSCSiURIhY8ZFnOQ9eWbO18wBmIa1dnGvfH6ejhjOUBOReEgm/Dxmbdbdz6FNSxR0Fd5jJ9yzCM6JY7gO9ZFK9RpDS98IDAh8hSQyJdyoErDlGD+HZ/6N0BziUg4XV+VSktF41uRT/hylcS/19wyrW88MktACfImJqsn3jQobxJMWUfX3Zcpcf/KctXAKL4SOFkNzASivA/EdR3bDkOl8tvUdXAJuKE7agWY0CoTTjAXge2X8sx3elYP3UYJ7kcA9rIHPl0GTPtyjGtRb7KjXwGQ0yDhZ4ruVEhss2i0ZhTEtWoYNDnmnf43JPSuQWEuZ3Cx30VjYYI20U6xkVfVShHr3cM3hLjBRt01twQyjyjZRaHnLdNPBADT9fllETxz1FqHvCnCOCekBodvstqIZhM35Aov2RJ2XPGJ1AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 10 17 15 53" title="" data-src="/static/2022-08-10-17-15-53-6b64f1ed429fee18498ed7b461b50ae3-28759.png" data-srcset="/static/2022-08-10-17-15-53-6b64f1ed429fee18498ed7b461b50ae3-6ac48.png 200w,\n/static/2022-08-10-17-15-53-6b64f1ed429fee18498ed7b461b50ae3-4b8bf.png 400w,\n/static/2022-08-10-17-15-53-6b64f1ed429fee18498ed7b461b50ae3-28759.png 500w" data-sizes="(max-width: 500px) 100vw, 500px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<table>\n<thead>\n<tr>\n<th align="left">索引值</th>\n<th align="left">索引值对应顶点坐标</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">0</td>\n<td align="left">(0.5, 0.5, 0.5)</td>\n</tr>\n<tr>\n<td align="left">1</td>\n<td align="left">(-0.5, 0.5, 0.5)</td>\n</tr>\n<tr>\n<td align="left">2</td>\n<td align="left">(-0.5, -0.5, 0.5)</td>\n</tr>\n<tr>\n<td align="left">3</td>\n<td align="left">(0.5, -0.5, 0.5)</td>\n</tr>\n<tr>\n<td align="left">4</td>\n<td align="left">(0.5, 0.5, -0.5)</td>\n</tr>\n<tr>\n<td align="left">5</td>\n<td align="left">(-0.5, 0.5, -0.5)</td>\n</tr>\n<tr>\n<td align="left">6</td>\n<td align="left">(-0.5, -0.5, -0.5)</td>\n</tr>\n<tr>\n<td align="left">7</td>\n<td align="left">(0.5, -0.5, -0.5)</td>\n</tr>\n</tbody>\n</table>\n<p>下面代码中表示的顶点索引如上图所示。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86048011051657740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 顶点索引数组\nvar indexes = new Uint8Array([\n   // 前四个点对应索引值\n   0,\n   1,\n   2,\n   3, // gl.LINE_LOOP 模式四个点绘制一个矩形框\n\n   // 后四个顶点对应索引值\n   4,\n   5,\n   6,\n   7, // gl.LINE_LOOP 模式四个点绘制一个矩形框\n\n   // 前后对应点对应索引值\n   0,\n   4, // 两个点绘制一条直线\n   1,\n   5, // 两个点绘制一条直线\n   2,\n   6, // 两个点绘制一条直线\n   3,\n   7 // 两个点绘制一条直线\n]);`, `86048011051657740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 顶点索引数组</span>\n<span class="token keyword">var</span> indexes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token comment">// 前四个点对应索引值</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">2</span><span class="token punctuation">,</span>\n   <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// gl.LINE_LOOP 模式四个点绘制一个矩形框</span>\n\n   <span class="token comment">// 后四个顶点对应索引值</span>\n   <span class="token number">4</span><span class="token punctuation">,</span>\n   <span class="token number">5</span><span class="token punctuation">,</span>\n   <span class="token number">6</span><span class="token punctuation">,</span>\n   <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// gl.LINE_LOOP 模式四个点绘制一个矩形框</span>\n\n   <span class="token comment">// 前后对应点对应索引值</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 两个点绘制一条直线</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 两个点绘制一条直线</span>\n   <span class="token number">2</span><span class="token punctuation">,</span>\n   <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 两个点绘制一条直线</span>\n   <span class="token number">3</span><span class="token punctuation">,</span>\n   <span class="token number">7</span> <span class="token comment">// 两个点绘制一条直线</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol>\n<li>\n<p>索引数组的数据传入显存缓冲区，注意与顶点数据传入缓冲区方法参数的对比，传入索引数据时，bindBuffer() 和 bufferData() 方法的第一个参数是 <code class="language-text">gl.ELEMENT_ARRAY_BUFFER</code>，传入顶点数据时是 <code class="language-text">gl.ARRAY_BUFFER</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32641058046765070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建缓冲区对象\nvar indexesBuffer = gl.createBuffer();\n// 绑定缓冲区对象\ngl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexesBuffer);\n// 索引数组 indexes 数据传入缓冲区\ngl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indexes, gl.STATIC_DRAW);`, `32641058046765070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建缓冲区对象</span>\n<span class="token keyword">var</span> indexesBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 绑定缓冲区对象</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indexesBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 索引数组 indexes 数据传入缓冲区</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ELEMENT_ARRAY_BUFFER</span><span class="token punctuation">,</span> indexes<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>使用方法 drawElements() 替换 drawArrays() 方法，参数设置基本一致，方法 drawElements() 只是新增了一个数据类型设置参数 <code class="language-text">gl.UNSIGNED_BYTE</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33751951399222514000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// LINE_LOOP 模式绘制前四个点\ngl.drawElements(gl.LINE_LOOP, 4, gl.UNSIGNED_BYTE, 0);\n// LINE_LOOP 模式从第五个点开始绘制四个点\ngl.drawElements(gl.LINE_LOOP, 4, gl.UNSIGNED_BYTE, 4);\n// LINES 模式绘制后 8 个点\ngl.drawElements(gl.LINES, 8, gl.UNSIGNED_BYTE, 8);`, `33751951399222514000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// LINE_LOOP 模式绘制前四个点</span>\ngl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINE_LOOP</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// LINE_LOOP 模式从第五个点开始绘制四个点</span>\ngl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINE_LOOP</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// LINES 模式绘制后 8 个点</span>\ngl<span class="token punctuation">.</span><span class="token function">drawElements</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">LINES</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">UNSIGNED_BYTE</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h3 id="gldrawelements"><a href="#gldrawelements" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gl.drawElements()</h3>\n<p>参数格式：drawElements(mode, count, type, offset)</p>\n<table>\n<thead>\n<tr>\n<th align="left">参数</th>\n<th align="left">含义</th>\n<th align="left">值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">mode</td>\n<td align="left">绘制模式</td>\n<td align="left">gl.LINE_LOOP、gl.LINES、gl.TRIANGLES 等</td>\n</tr>\n<tr>\n<td align="left">count</td>\n<td align="left">绘制顶点个数</td>\n<td align="left">整型数</td>\n</tr>\n<tr>\n<td align="left">type</td>\n<td align="left">数据类型</td>\n<td align="left"><code class="language-text">gl.UNSIGNED_BYTE</code>\n 对应 Uint8Array，\n<code class="language-text">gl.UNSIGNED_SHORT</code>\n 对应 Uint16Array</td>\n</tr>\n<tr>\n<td align="left">offset</td>\n<td align="left">从第几个点开始绘制</td>\n<td align="left">整型数，以字节为单位</td>\n</tr>\n</tbody>\n</table>\n<p>count 和 offset 组合可以确定绘制众多顶点中的连续一段，通过顶点索引关联顶点数据，count 和 offset 指的是顶点的索引数组。</p>\n<h2 id="varying-变量和颜色插值"><a href="#varying-%E5%8F%98%E9%87%8F%E5%92%8C%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>varying 变量和颜色插值</h2>\n<p>使用关键字 varying 实现颜色插值计算</p>\n<h3 id="颜色线性插值"><a href="#%E9%A2%9C%E8%89%B2%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>颜色线性插值</h3>\n<p>顶点着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49383371887421300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// attribute 声明 vec4 类型变量 apos\nattribute vec4 apos;\n// attribute 声明顶点颜色变量\nattribute vec4 a_color;\n// varying 声明顶点颜色插值后变量，使用 varying 可以插值计算\nvarying vec4 v_color;\nvoid main() {\n  // 顶点坐标 apos 赋值给内置变量 gl_Position\n  gl_Position = apos;\n  // 顶点颜色插值计算\n  v_color = a_color;\n}`, `49383371887421300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// attribute 声明 vec4 类型变量 apos</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> apos<span class="token punctuation">;</span>\n<span class="token comment">// attribute 声明顶点颜色变量</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_color<span class="token punctuation">;</span>\n<span class="token comment">// varying 声明顶点颜色插值后变量，使用 varying 可以插值计算</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 顶点坐标 apos 赋值给内置变量 gl_Position</span>\n  gl_Position <span class="token operator">=</span> apos<span class="token punctuation">;</span>\n  <span class="token comment">// 顶点颜色插值计算</span>\n  v_color <span class="token operator">=</span> a_color<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>片元着色器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57323057504433210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 所有 float 类型数据的精度是 lowp\n// lowp 是精度限定字表示低精度，计算机资源有限，设置数据精度是为了提高执行效率\n// 除了片元着色器中的浮点类型 float 数据，其它所有类型数据浏览器都有默认的精度，因此要设定片元着色器中浮点类型 float 数据精度，否则会报错\nprecision lowp float;\n// 接收顶点着色器中 v_color 数据\nvarying vec4 v_color;\nvoid main() {\n  // 插值后颜色数据赋值给对应的片元\n  gl_FragColor = v_color;\n}`, `57323057504433210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 所有 float 类型数据的精度是 lowp</span>\n<span class="token comment">// lowp 是精度限定字表示低精度，计算机资源有限，设置数据精度是为了提高执行效率</span>\n<span class="token comment">// 除了片元着色器中的浮点类型 float 数据，其它所有类型数据浏览器都有默认的精度，因此要设定片元着色器中浮点类型 float 数据精度，否则会报错</span>\n<span class="token keyword">precision</span> <span class="token keyword">lowp</span> <span class="token keyword">float</span><span class="token punctuation">;</span>\n<span class="token comment">// 接收顶点着色器中 v_color 数据</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span>\n<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 插值后颜色数据赋值给对应的片元</span>\n  gl_FragColor <span class="token operator">=</span> v_color<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/do2n1z?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="获取顶点变量"><a href="#%E8%8E%B7%E5%8F%96%E9%A1%B6%E7%82%B9%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取顶点变量</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76639344396582190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 获取顶点着色器的位置变量 apos\nvar aposLocation = gl.getAttribLocation(program, \'apos\');\nvar a_color = gl.getAttribLocation(program, \'a_color\');`, `76639344396582190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 获取顶点着色器的位置变量 apos</span>\n<span class="token keyword">var</span> aposLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'apos\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> a_color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="设置顶点颜色、位置数据"><a href="#%E8%AE%BE%E7%BD%AE%E9%A1%B6%E7%82%B9%E9%A2%9C%E8%89%B2%E3%80%81%E4%BD%8D%E7%BD%AE%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置顶点颜色、位置数据</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43859162900787590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n  创建顶点位置数据数组 data，存储两个顶点 (-0.5, 0.5)、(0.5, 0.5)\n  创建顶点颜色数组 colorData，存储两个顶点对应 RGB 颜色值 (0, 0, 1)、(1, 0, 0)\n **/\nvar data = new Float32Array([-0.5, 0.5, 0.5, 0.5]);\nvar colorData = new Float32Array([0, 0, 1, 1, 0, 0]);`, `43859162900787590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n  创建顶点位置数据数组 data，存储两个顶点 (-0.5, 0.5)、(0.5, 0.5)\n  创建顶点颜色数组 colorData，存储两个顶点对应 RGB 颜色值 (0, 0, 1)、(1, 0, 0)\n **/</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> colorData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="创建顶点缓冲区、传递数据"><a href="#%E5%88%9B%E5%BB%BA%E9%A1%B6%E7%82%B9%E7%BC%93%E5%86%B2%E5%8C%BA%E3%80%81%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建顶点缓冲区、传递数据</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62217905439901090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n  创建缓冲区 buffer，传入顶点位置数据 data\n **/\nvar buffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, buffer);\ngl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\ngl.vertexAttribPointer(aposLocation, 2, gl.FLOAT, false, 0, 0);\ngl.enableVertexAttribArray(aposLocation);\n\n/**\n  创建缓冲区 colorBuffer，传入顶点颜色数据 colorData\n **/\nvar colorBuffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\ngl.bufferData(gl.ARRAY_BUFFER, colorData, gl.STATIC_DRAW);\ngl.vertexAttribPointer(a_color, 3, gl.FLOAT, false, 0, 0);\ngl.enableVertexAttribArray(a_color);`, `62217905439901090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n  创建缓冲区 buffer，传入顶点位置数据 data\n **/</span>\n<span class="token keyword">var</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>aposLocation<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>aposLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n  创建缓冲区 colorBuffer，传入顶点颜色数据 colorData\n **/</span>\n<span class="token keyword">var</span> colorBuffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> colorData<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_color<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_color<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="创建一个彩色三角形"><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BD%A9%E8%89%B2%E4%B8%89%E8%A7%92%E5%BD%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建一个彩色三角形</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69676977351645440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n  创建顶点位置数据数组 data，存储 3 个顶点 (-0.5, 0.5)、(0.5, 0.5)、(0.5, -0.5)\n  创建顶点颜色数组 colorData，存储 3 个顶点对应 RGB 颜色值 (1, 0, 0)、(0, 1, 0)、(0, 0, 1)\n**/\nvar data = new Float32Array([-0.5, 0.5, 0.5, 0.5, 0.5, -0.5]);\nvar colorData = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);\n\n/** 执行绘制命令 **/\ngl.drawArrays(gl.TRIANGLES, 0, 3);`, `69676977351645440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n  创建顶点位置数据数组 data，存储 3 个顶点 (-0.5, 0.5)、(0.5, 0.5)、(0.5, -0.5)\n  创建顶点颜色数组 colorData，存储 3 个顶点对应 RGB 颜色值 (1, 0, 0)、(0, 1, 0)、(0, 0, 1)\n**/</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> colorData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/** 执行绘制命令 **/</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/x1ef94?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="两个单色三角面（不同颜色）"><a href="#%E4%B8%A4%E4%B8%AA%E5%8D%95%E8%89%B2%E4%B8%89%E8%A7%92%E9%9D%A2%EF%BC%88%E4%B8%8D%E5%90%8C%E9%A2%9C%E8%89%B2%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>两个单色三角面（不同颜色）</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3313766566926812000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n  创建顶点位置数据数组 data，存储 6 个顶点\n  创建顶点颜色数组 colorData，存储 6 个顶点对应 RGB 颜色值\n **/\nvar data = new Float32Array([\n   // 第一个三角形的三个点\n   -0.5,\n   0.5,\n   0.5,\n   0.5,\n   0.5,\n   -0.5,\n\n   // 第二个三角形的三个点\n   -0.5,\n   0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   -0.5\n]);\n\nvar colorData = new Float32Array([\n   // 三个红色点\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n\n   // 三个蓝色点\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1\n]);`, `3313766566926812000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n  创建顶点位置数据数组 data，存储 6 个顶点\n  创建顶点颜色数组 colorData，存储 6 个顶点对应 RGB 颜色值\n **/</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token comment">// 第一个三角形的三个点</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 第二个三角形的三个点</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> colorData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token comment">// 三个红色点</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n\n   <span class="token comment">// 三个蓝色点</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/xnbwdw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="颜色插值（顶点位置、颜色使用一个缓冲区存储）"><a href="#%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC%EF%BC%88%E9%A1%B6%E7%82%B9%E4%BD%8D%E7%BD%AE%E3%80%81%E9%A2%9C%E8%89%B2%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E7%BC%93%E5%86%B2%E5%8C%BA%E5%AD%98%E5%82%A8%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>颜色插值（顶点位置、颜色使用一个缓冲区存储）</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70963628508451190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n 创建顶点位置数据数组 data，存储两个顶点 (-0.5, 0.5)、(0.5, 0.5)\n 存储两个顶点对应 RGB 颜色值 (0, 0, 1)、(1, 0, 0)\n **/\nvar data = new Float32Array([-0.5, 0.5, 0, 0, 1, 0.5, 0.5, 1, 0, 0]);\n/**\n 创建缓冲区 buffer，传入顶点颜色、位置数据 data\n **/\nvar buffer = gl.createBuffer();\ngl.bindBuffer(gl.ARRAY_BUFFER, buffer);\ngl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n// 4 表示 data 数组一个元素占据的字节数\n// 倒数第二个参数 4 * 5 表示每 5 个元素是一个选择单元\n// 第 2 个参数 2 表示从 5 元素组成的一个选择单元中选择前 2 个作为顶点位置数据\ngl.vertexAttribPointer(aposLocation, 2, gl.FLOAT, false, 4 * 5, 0);\n// 最后一个参数 4 * 2 表示 5 元素组成的一个选择单元中偏移 2 个元素\n// 第 2 个参数 3 表示从 5 元素组成的一个选择单元中选择后三个作为顶点颜色数据\ngl.vertexAttribPointer(a_color, 3, gl.FLOAT, false, 4 * 5, 4 * 2);\ngl.enableVertexAttribArray(aposLocation);\ngl.enableVertexAttribArray(a_color);`, `70963628508451190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n 创建顶点位置数据数组 data，存储两个顶点 (-0.5, 0.5)、(0.5, 0.5)\n 存储两个顶点对应 RGB 颜色值 (0, 0, 1)、(1, 0, 0)\n **/</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/**\n 创建缓冲区 buffer，传入顶点颜色、位置数据 data\n **/</span>\n<span class="token keyword">var</span> buffer <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">createBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bindBuffer</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">bufferData</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">ARRAY_BUFFER</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">STATIC_DRAW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 4 表示 data 数组一个元素占据的字节数</span>\n<span class="token comment">// 倒数第二个参数 4 * 5 表示每 5 个元素是一个选择单元</span>\n<span class="token comment">// 第 2 个参数 2 表示从 5 元素组成的一个选择单元中选择前 2 个作为顶点位置数据</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>aposLocation<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 最后一个参数 4 * 2 表示 5 元素组成的一个选择单元中偏移 2 个元素</span>\n<span class="token comment">// 第 2 个参数 3 表示从 5 元素组成的一个选择单元中选择后三个作为顶点颜色数据</span>\ngl<span class="token punctuation">.</span><span class="token function">vertexAttribPointer</span><span class="token punctuation">(</span>a_color<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> gl<span class="token punctuation">.</span><span class="token constant">FLOAT</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>aposLocation<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">enableVertexAttribArray</span><span class="token punctuation">(</span>a_color<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/gtg0fg?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="立方体-每个面一种颜色"><a href="#%E7%AB%8B%E6%96%B9%E4%BD%93-%E6%AF%8F%E4%B8%AA%E9%9D%A2%E4%B8%80%E7%A7%8D%E9%A2%9C%E8%89%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>立方体-每个面一种颜色</h2>\n<p>思路很简单，在线框模式的立方体源码基础上直接进行更改，添加 varying 变量，引入顶点数据颜色，立方体 6 个面，每个面可以分为两个三角面绘制出来，也就是说每个面需要定义 6 个点，6 个点需要定义 36 个顶点。</p>\n<h3 id="着色器程序"><a href="#%E7%9D%80%E8%89%B2%E5%99%A8%E7%A8%8B%E5%BA%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>着色器程序</h3>\n<p>着色器程序参考颜色插值 varying 的使用方法添加即可，就不再列出。</p>\n<h3 id="顶点数据"><a href="#%E9%A1%B6%E7%82%B9%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点数据</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87086384681357460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n 创建顶点位置数据数组 data，js 中小数点前面的 0 可以省略\n **/\nvar data = new Float32Array([\n   0.5,\n   0.5,\n   0.5,\n   -0.5,\n   0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   0.5,\n   0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   0.5,\n   -0.5,\n   0.5, // 面1\n\n   0.5,\n   0.5,\n   0.5,\n   0.5,\n   -0.5,\n   0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   0.5,\n   0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   0.5,\n   -0.5, // 面 2\n\n   0.5,\n   0.5,\n   0.5,\n   0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   0.5,\n   0.5,\n   0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   0.5, // 面 3\n\n   -0.5,\n   0.5,\n   0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   0.5, // 面 4\n\n   -0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   0.5, // 面 5\n\n   0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   -0.5,\n   -0.5,\n   0.5,\n   -0.5,\n   0.5,\n   0.5,\n   -0.5 // 面 6\n]);\n\n/**\n 创建顶点颜色数组colorData\n **/\nvar colorData = new Float32Array([\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 1\n\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0, // 绿色——面 2\n\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1, // 蓝色——面 3\n\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0, // 黄色——面 4\n\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0, // 黑色——面 5\n\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1,\n   1 // 白色——面 6\n]);`, `87086384681357460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n 创建顶点位置数据数组 data，js 中小数点前面的 0 可以省略\n **/</span>\n<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// 面1</span>\n\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// 面 2</span>\n\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// 面 3</span>\n\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// 面 4</span>\n\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token comment">// 面 5</span>\n\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token number">0.5</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.5</span> <span class="token comment">// 面 6</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n 创建顶点颜色数组colorData\n **/</span>\n<span class="token keyword">var</span> colorData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 1</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 绿色——面 2</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 蓝色——面 3</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 黄色——面 4</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 黑色——面 5</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span> <span class="token comment">// 白色——面 6</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="深度测试"><a href="#%E6%B7%B1%E5%BA%A6%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深度测试</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20665051778458034000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** 执行绘制之前，一定要开启深度测试，以免颜色混乱 **/\ngl.enable(gl.DEPTH_TEST);`, `20665051778458034000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/** 执行绘制之前，一定要开启深度测试，以免颜色混乱 **/</span>\ngl<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">DEPTH_TEST</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/wt39uk?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h3 id="测试"><a href="#%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>测试</h3>\n<p>可以把所有的颜色都改为红色，发现没有立体的视觉效果，白、蓝、绿处于其他三个面的前面，是可见面。可以把三个面设置为红色 R 分别为 1、0.9、0.8 来测试效果。你可以发现 R 值差异了 0.1，你会有很强的立体感，其实你可以继续使用更小的差值，来测试你的眼睛视觉变化。这其实相当于手动编写颜色值，模拟自然界光场，如果有兴趣可以学习下一节课程，如何模拟真实自然界的太阳光、灯光等各种类型光线在物体表面反射光场的分布，不仅不同的面会出现 R 值不同，一个面上的 R 值也会不同，呈现某种规律的变化，比如金属在阳光下会有局部高光现象。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51934651169011520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n 创建顶点颜色数组 colorData\n **/\nvar colorData = new Float32Array([\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 1\n\n   0.9,\n   0,\n   0,\n   0.9,\n   0,\n   0,\n   0.9,\n   0,\n   0,\n   0.9,\n   0,\n   0,\n   0.9,\n   0,\n   0,\n   0.9,\n   0,\n   0, // R = 0.9——面 2\n\n   0.8,\n   0,\n   0,\n   0.8,\n   0,\n   0,\n   0.8,\n   0,\n   0,\n   0.8,\n   0,\n   0,\n   0.8,\n   0,\n   0,\n   0.8,\n   0,\n   0, // R = 0.8——面 3\n\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0,\n   1,\n   1,\n   0, // 黄色——面 4\n\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0,\n   0, // 黑色——面 5\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0 // R = 1——面 6\n]);`, `51934651169011520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n 创建顶点颜色数组 colorData\n **/</span>\n<span class="token keyword">var</span> colorData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 1</span>\n\n   <span class="token number">0.9</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.9</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.9</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.9</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.9</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.9</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// R = 0.9——面 2</span>\n\n   <span class="token number">0.8</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.8</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.8</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.8</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.8</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0.8</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// R = 0.8——面 3</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 黄色——面 4</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 黑色——面 5</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span> <span class="token comment">// R = 1——面 6</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/kmys42?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h2 id="webgl-光照渲染立方体"><a href="#webgl-%E5%85%89%E7%85%A7%E6%B8%B2%E6%9F%93%E7%AB%8B%E6%96%B9%E4%BD%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 光照渲染立方体</h2>\n<h3 id="光照模型"><a href="#%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>光照模型</h3>\n<h4 id="漫反射"><a href="#%E6%BC%AB%E5%8F%8D%E5%B0%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>漫反射</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-16-11-20-33-b8d969a2ff1d468417f54263ef69babf-49396.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 526px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.59315589353612%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABAklEQVQoz22R3W6DMAyFef93602n7WLTelPUrVMLQyH/IWe2ISXQRcQRzqdj57jBsjKHaZq3JDJ9kqVURojAhk1pw5bVtO0Fxug5H6OAWZgsXBE1JkJrS9dxZf8TPJ3OBJq1K65cQUWw73scDkc5JR+CCOaKEUEOXMwHD6PUU4e1KNeKcUkyt7DFHt4NB0/F3j8+8fpyfAjkXYfzmeEcMCgNN6rV04ppys/vYDF03eYZNVgEucv7eYBuO/hvjcmnDdMUMATajo1en4GdP2JPZ6GvHvZm4W4G7osGmnYePiY5JqSQnp49UdeBhhDJbNdr2NHh5+0OdRlhqYBXFpGmn+j+D46Tdfyug7P4AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 16 11 20 33" title="" data-src="/static/2022-08-16-11-20-33-b8d969a2ff1d468417f54263ef69babf-49396.png" data-srcset="/static/2022-08-16-11-20-33-b8d969a2ff1d468417f54263ef69babf-68c83.png 200w,\n/static/2022-08-16-11-20-33-b8d969a2ff1d468417f54263ef69babf-d339c.png 400w,\n/static/2022-08-16-11-20-33-b8d969a2ff1d468417f54263ef69babf-49396.png 526w" data-sizes="(max-width: 526px) 100vw, 526px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>平行光漫反射简单数学模型：漫反射光的颜色 = 几何体表面基色 x 光线颜色 x 光线入射角余弦值</p>\n<p>几何体表面基色简单的说就是不考虑光照物体自身的颜色。</p>\n<h4 id="漫反射模型：光线入射角余弦值"><a href="#%E6%BC%AB%E5%8F%8D%E5%B0%84%E6%A8%A1%E5%9E%8B%EF%BC%9A%E5%85%89%E7%BA%BF%E5%85%A5%E5%B0%84%E8%A7%92%E4%BD%99%E5%BC%A6%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>漫反射模型：光线入射角余弦值</h4>\n<p>这个数学模型没有考虑镜面反射描述的就是理想的漫反射体，并不能完整的描述物体表面的光场，既然是数学模型，自然就是可以修正的，比如添加一个系数，更改指数等等，这里不再详述。比如普通的桌子桌面它的粗糙度是微米 um 级，相比人的脸它是平的，光的波长是纳米 nm 级，这时候桌子表面相比光线是凹凸不平的，宏观来看一束光线照射到物体的表面，对于理想的漫反射而言，因为表面无规则随机分布凹凸不平的反射面，光线的反射是不定向的，换句话说任何角度的反射光都是一样的，这也就是说物体反射到眼睛中的光与人的观察位置无关，反射效果展示如上图所示。</p>\n<p>关于漫反射光照数学模型中物体的漫反射光强度与光线的入射角有关如何解释，这个其实很简单，比如两块纸板面积相同，如下图所示，两个边长为 L 的方形板，一个垂直太阳光线放置，一个不垂直太阳光线也就是入射角不是 90 度，同样强度的光照条件下，垂直太阳光的纸板的光通量肯定比斜着放的纸板接收的光量大，这时候就有必要给数学模型引入一个入射角的因数。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-16-11-26-01-cd2c8410d1be99e277093288725e043b-f4a80.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 631px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 33.914421553090335%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABH0lEQVQoz11R7VKDMBDk/d+jY3Kh76GjbS0Famnr3446VqqtfAismwAF/bFz3O2yuWw8f32BHw8wq69Rfya+YTYl/JDz6PxHe/3HzsmbpICn4x/oqEeFm6CARKMZedlU0KsSKixH2hZWq8hZXpIansRWxKaDCnJI3Bn1cIYFdMjD/ultr+yc/GB4NaigljmMNX3kVeYnqFnaGeatYTQY9lXZw3pDHdIoyGjArGafEJrIIqUxwXwmzNAKJeyuuK6uC7gl2NsoLC/bBt50ceAmB8jyhcGmxAlmx7C3mcP0mcIwg759hTwcIbMjDKuZc/P5Rzu7f4e+e6Puwg03vMquguwbmH1Ns3qo7ruBeiow4etrVgceIIxAEj7IOneznv8FXFfkPauXNDMAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 16 11 26 01" title="" data-src="/static/2022-08-16-11-26-01-cd2c8410d1be99e277093288725e043b-f4a80.png" data-srcset="/static/2022-08-16-11-26-01-cd2c8410d1be99e277093288725e043b-0de09.png 200w,\n/static/2022-08-16-11-26-01-cd2c8410d1be99e277093288725e043b-e7891.png 400w,\n/static/2022-08-16-11-26-01-cd2c8410d1be99e277093288725e043b-f4a80.png 631w" data-sizes="(max-width: 631px) 100vw, 631px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="rgb-分量表示颜色"><a href="#rgb-%E5%88%86%E9%87%8F%E8%A1%A8%E7%A4%BA%E9%A2%9C%E8%89%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RGB 分量表示颜色</h4>\n<p>光的颜色可以使用多种模型来表示，把上面的文字公式使用 RGB 具体参数来表示形式如下，比如物体表面的颜色是纯红色 (1, 0, 0)，入射光是纯白色 (1, 1, 1)，光线入射角是 60 度，余弦值就是 0.5，代入下面公式，可以得出结果是 (0.5, 0, 0), 结果仍然是红色，这是符合实际生活的，白色太阳光照在常见的红色物体上，反射的颜色是红色，只是太阳光线照射在物体表面的角度不同，反射的光强度不同。入射光垂直物体表面，也就是入射角是 0 对应的余弦值是 1，光线垂直表面受光量最大，反射光自然最大，和 1 对应；入射光线平行物体表面，此时的入射角是 90 度，物体表面自然没什么光可以反射。</p>\n<p>漫反射数学模型 RGB 分量表示：<code class="language-text">(R2, G2, B2) = (R1, G1, B1) x (R0, G0, B0) x cosθ</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51457353514067436000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`R2 = R1 * R0 * cosθ\nG2 = G1 * G0 * cosθ\nB2 = B1 * B0 * cosθ`, `51457353514067436000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">R2 = R1 * R0 * cosθ\nG2 = G1 * G0 * cosθ\nB2 = B1 * B0 * cosθ</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>WebGL 着色器语言表示</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68976215045550890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 角度值转化为弧度值\nfloat radian = radians(60.0);\n// reflectedLight 的结果是 (0.5, 0, 0)\nvec3 reflectedLight = vec3(1.0, 0.0, 0.0) * vec3(1.0, 1.0, 1.0) * cos(radian)`, `68976215045550890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 角度值转化为弧度值</span>\n<span class="token keyword">float</span> radian <span class="token operator">=</span> <span class="token function">radians</span><span class="token punctuation">(</span><span class="token number">60.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// reflectedLight 的结果是 (0.5, 0, 0)</span>\n<span class="token keyword">vec3</span> reflectedLight <span class="token operator">=</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">vec3</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">cos</span><span class="token punctuation">(</span>radian<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="镜面反射"><a href="#%E9%95%9C%E9%9D%A2%E5%8F%8D%E5%B0%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>镜面反射</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-16-11-30-26-c68e7abd5fc0f8a3312fdcdb675ab470-7027d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 300px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 71.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACQUlEQVQ4y3VTS2tTQRg988p95HHbNJomaSmlgkWLGxURBBeKUlwoFXFREXGjCxFR3CoFFdqmUVBBf4Eb7boiVbArLbXQJOCj0DZpVxpE3AXTcTL35ubZA5dvvuHOmXPOzAAKlFZsTsukOp6+eA0/Jruw+cTANlyoytUnvLEGXSFuzfrVUh/XTSpa5P3R9WB1PHHuDn4+BTbSFuQOhDRLW8mY2sBGTZELSdCCX+OiIyHziVxitkJtRUr9hVuPRd962r7w6d6eE8WMcbSYMc8WMmYEdYWszXJdXUARG41zWJ1yrNIz9L27eyj16vpo/+/nSOYexkWN8A9CvEyJ7icuhcHfx2pkRFnVUfGcR7YxY7UYlT6RvOJVpVB6ChvBstQ/CF9dFYUZE4v3B4lUq44MLbC4s6V3HcFHICHpA+OmKaEUyr0k9ibGxewQpTkwlZ3V6cQhuJsMIdu+SjO01h108odFd/5MAt9OD0+O7CPzvWPibfKkmEucYktGBJv1PJsUumQVcBU9EyXXDiungK9mPFXaf7wnn5S31NT8rgHnddcwlh2bLwZM/d+yqNlvJqR1dV5fUacsAwOD/5LHdt/u/QAEaDrSE50LJvEXOjf22Wq6Pm0waI30u9uztWqWzigQOR+yomocYuOICGkwTZRrfjVtUE9QK2RkWvchPGJgX8LyAIgEJ5CMmRka1upmaWerreCs4lle8iakuIwXQcmVzYJl+5lLurPVNqWY0vUlDuo6hoXw1RspR4l379xqyzVpwH82rKZz3D2/swAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 16 11 30 26" title="" data-src="/static/2022-08-16-11-30-26-c68e7abd5fc0f8a3312fdcdb675ab470-7027d.png" data-srcset="/static/2022-08-16-11-30-26-c68e7abd5fc0f8a3312fdcdb675ab470-55fa9.png 200w,\n/static/2022-08-16-11-30-26-c68e7abd5fc0f8a3312fdcdb675ab470-7027d.png 300w" data-sizes="(max-width: 300px) 100vw, 300px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>上面的漫反射数学模型没有考虑镜面反射，描述的就是理想的漫反射体，并不能完整的描述物体表面的光场。漫反射是因为几何体表面粗糙度尺寸相对光波长尺寸而言是凹凸不平的，这种凹凸不平又是随机的，所以说漫反射的光线各个方向是均匀的。镜面反射也就是说光照在物体上的反射光线具有方向性，具体点说就是光线的反射角等于入射角。生活中的镜子它的表面粗糙度很小，和光的波长是一个数量级，当光线照在上面的时候，反射光线就会表现出方向性。</p>\n<p>实际的生活中所有的物体没有绝对的漫反射或者镜面反射，往往都是同时存在，只是表现的倾向性不同，镜子的镜面反射更明显，粗糙的树皮漫反射更明显。光照射到物体上一部分会被吸收，透明的话一部分会被折射，除去吸收和折射的光剩余的会被反射，反射的时候根据表面的粗糙度不同，镜面反射和漫反射分配的比例不同可以使用两个系数 k1、k2 去描述。</p>\n<p>在室外停放着一辆车，你观察车的时候，你会发现车的外表面会在某个局部出现高光，这很好理解，车的外壳是曲面的，曲面上如果某个区域的的光线反射角刚好是你的视线方向，自然会呈现出局部高亮的现象，其他的部位是漫反射为主。镜面反射的公式仍然可以写成上面的形式，只是角度不再是光线入射角度而是眼睛视线与反射光线的夹角，n 角度余弦值的指数，实际编程的时候你可以自由定义，没有绝对完美的模型，都可以进行修正。</p>\n<p>镜面反射光的颜色 = 几何体表面基色 x 光线颜色 x 视线与反射光线的夹角余弦值<sup>n</sup></p>\n<h4 id="环境光照"><a href="#%E7%8E%AF%E5%A2%83%E5%85%89%E7%85%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>环境光照</h4>\n<p>在暗的环境下，物体比较暗，光亮的环境下，物体比较光亮，描述这个现象可以使用环境光照模型。光线在自然环境中会在不同的物体之间来回反射，单束的光线具有方向性，所有方向的光线随机分布，形成一个没有特殊的光线方向的的环境光照。多数情况下室内室外环境光颜色通常都是 RGB 相同的白色到黑色之间的值，(1, 1, 1) 表示最强的环境光照颜色，(0, 0, 0) 相当于处于完全的没有光照的黑色环境中。</p>\n<p>环境反射光颜色 = 几何体表面基色 x 环境光颜色</p>\n<h4 id="复合光照"><a href="#%E5%A4%8D%E5%90%88%E5%85%89%E7%85%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>复合光照</h4>\n<p>使用光照渲染模型的时候往往会使用多种光照模型，然后把每个光照模型颜色相乘的结果 RGB 分别相加，这时候要注意，多种模型的光照颜色相加后 RGB 的值要保证在区间 [0, 1]，因为 WebGL 的 RGB 颜色模型默认 RGB 分量的最大值是 1，注意分配比例即可。</p>\n<p>总反射光线 = 漫反射光线 + 镜面反射光线 + 环境反射光线</p>\n<h4 id="法向量"><a href="#%E6%B3%95%E5%90%91%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>法向量</h4>\n<p>有基本的数学知识应该都有法线的概念，垂直与面的直线就是面的法线，对于平面而言面上所有位置的法线方向是相同的，对于曲面而言不同的位置法线的方向是变化的。在三维笛卡尔坐标系中，可以使用向量 (x, y, z) 来表示法向量，根据几何体表面的法向量和光线的方向，就可以求解出光线入射角的余弦值，法向量的点积计算满足下面的公式，为了方便计算，着色器语言内置了一个方法 dot() 用来求解两个向量之间的余弦值，已知向量 a1(x1, y1, z1)、a2(x2, y2, z2) 执行 dot(a1, a2) 可以求出两个向量 a1、a2 的余弦值。</p>\n<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><mi mathvariant="normal">∣</mi><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi mathvariant="normal">∣</mi><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mi mathvariant="normal">∣</mi><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow><annotation encoding="application/x-tex">\\vec a \\cdot \\vec b = \\vert \\vec a \\vert \\vert \\vec b \\vert cosθ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9774399999999999em;"></span><span class="strut bottom" style="height:1.2274399999999999em;vertical-align:-0.25em;"></span><span class="base"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathit">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width=\'0.471em\' height=\'0.714em\' style=\'width:0.471em\' viewBox=\'0 0 471 714\' preserveAspectRatio=\'xMinYMin\'><path d=\'M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\'/></svg></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774399999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathit">b</span></span><span style="top:-3.26344em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width=\'0.471em\' height=\'0.714em\' style=\'width:0.471em\' viewBox=\'0 0 471 714\' preserveAspectRatio=\'xMinYMin\'><path d=\'M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\'/></svg></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathit">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width=\'0.471em\' height=\'0.714em\' style=\'width:0.471em\' viewBox=\'0 0 471 714\' preserveAspectRatio=\'xMinYMin\'><path d=\'M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\'/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord">∣</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774399999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathit">b</span></span><span style="top:-3.26344em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width=\'0.471em\' height=\'0.714em\' style=\'width:0.471em\' viewBox=\'0 0 471 714\' preserveAspectRatio=\'xMinYMin\'><path d=\'M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\'/></svg></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span></span></span></span></span>\n<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mi>a</mi><mo>⃗</mo></mover><mo>⋅</mo><mover accent="true"><mi>b</mi><mo>⃗</mo></mover><mo>=</mo><msub><mi>x</mi><mn>1</mn></msub><msub><mi>x</mi><mn>2</mn></msub><mo>+</mo><msub><mi>y</mi><mn>1</mn></msub><msub><mi>y</mi><mn>2</mn></msub><mo>+</mo><msub><mi>z</mi><mn>1</mn></msub><msub><mi>z</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\\vec a \\cdot \\vec b = x_1x_2 + y_1y_2 + z_1z_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.9774399999999999em;"></span><span class="strut bottom" style="height:1.1718799999999998em;vertical-align:-0.19444em;"></span><span class="base"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathit">a</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width=\'0.471em\' height=\'0.714em\' style=\'width:0.471em\' viewBox=\'0 0 471 714\' preserveAspectRatio=\'xMinYMin\'><path d=\'M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\'/></svg></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9774399999999999em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathit">b</span></span><span style="top:-3.26344em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg width=\'0.471em\' height=\'0.714em\' style=\'width:0.471em\' viewBox=\'0 0 471 714\' preserveAspectRatio=\'xMinYMin\'><path d=\'M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\'/></svg></span></span></span></span></span></span></span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mord rule" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"></span></span></span></span></span></span></span></span></span>\n<h3 id="立方体添加平行光"><a href="#%E7%AB%8B%E6%96%B9%E4%BD%93%E6%B7%BB%E5%8A%A0%E5%B9%B3%E8%A1%8C%E5%85%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>立方体添加平行光</h3>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/ffujml?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>该 WebGL 案例源码是通过给一个单色的立方体添加平行光进行渲染，通过这样一个简单的 WebGL 光照计算案例，来体会光照模型在物体渲染中的应用，在学习下面的代码之前确保你有逐顶点和颜色插值计算的概念，了解顶点位置数据、顶点颜色数据，本节课在这两种顶点数据的基础之上在引入一种新的顶点数据：定点法向量。</p>\n<p>平行光照射在立方体上，与不同的平面夹角不同，自然反射的颜色 RGB 值强弱不同，实际绘图的时候你不可能手动计算去定义每一个像素的值，前面课程中讲解颜色插值计算的知识，应该对你有一定的启发，你只需要计算出每一个顶点在光照下的颜色，然后利用插值计算就可以得到三个顶点之间区域的像素值，这时候顶点法向量数据就派上了用场，每一个顶点都有位置数据、颜色数据、法向量数据，法向量和颜色数据先进行计算得出新的顶点颜色数据，然后渲染管线对顶点进行装配光栅化的过程中，新的顶点颜色数据进行插值计算。这时候提示一下大家，不要去从宏观思考法向量问题，要从逐顶点、插值计算的角度理解问题，下面的问题可能大家会有一个疑问，为什么立方体的一个顶点会有三个方向，从实际的物体来看，立方体的一个顶点就是一个顶点，但是从绘图的角度来看，每一次是通过三个顶点绘制一个三角形面，只不过恰好三个三角形面共顶点，会有顶点位置重复而已，但是每一组的三个顶点是一个装配光栅化和插值计算的独立单元，两组的三个顶点位置有重复也不会影响他们各自的渲染得到的像素结果。</p>\n<h4 id="顶点着色器：声明变量"><a href="#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%EF%BC%9A%E5%A3%B0%E6%98%8E%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点着色器：声明变量</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10566460646059327000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`attribute vec4 apos; // attribute 声明 vec4 类型变量 apos\nattribute vec4 a_color; // attribute 声明顶点颜色变量\nattribute vec4 a_normal; // 顶点法向量变量\nuniform vec3 u_lightColor; // uniform 声明平行光颜色变量\nuniform vec3 u_lightPosition; // uniform 声明平行光颜色变量\nvarying vec4 v_color; // varying 声明顶点颜色插值后变量`, `10566460646059327000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token keyword">attribute</span> <span class="token keyword">vec4</span> apos<span class="token punctuation">;</span> <span class="token comment">// attribute 声明 vec4 类型变量 apos</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_color<span class="token punctuation">;</span> <span class="token comment">// attribute 声明顶点颜色变量</span>\n<span class="token keyword">attribute</span> <span class="token keyword">vec4</span> a_normal<span class="token punctuation">;</span> <span class="token comment">// 顶点法向量变量</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightColor<span class="token punctuation">;</span> <span class="token comment">// uniform 声明平行光颜色变量</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightPosition<span class="token punctuation">;</span> <span class="token comment">// uniform 声明平行光颜色变量</span>\n<span class="token keyword">varying</span> <span class="token keyword">vec4</span> v_color<span class="token punctuation">;</span> <span class="token comment">// varying 声明顶点颜色插值后变量</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>查看上面的代码大家可以发现一个新的关键字 uniform，uniform 关键字和 attribute 关键字的都是为了 js 可以向 WebGL 着色器传递数据而出现。区别在于如果一个变量表示顶点相关的数据并且需要从 js 代码中获取顶点数据，需要使用 attribute 关键字声明该变量，比如上面代码 attribute 关键字声明的顶点位置变量 apos、顶点颜色变量 <code class="language-text">a_color</code>、顶点法向量变量 <code class="language-text">a_normal</code>。如果一个变量是非顶点相关的数据并且需要 js 传递该变量相关的数据，需要使用 uniform 关键字声明该变量，比如上面代码通过 uniform 关键字声明的光源位置变量 <code class="language-text">u_lightPosition</code>、光源颜色变量 <code class="language-text">u_lightColor</code>。更多关于 uniform 关键字和 attribute 关键字的内容可以查看第二章着色器介绍三种变量类型 attribute、uniform、varying</p>\n<p>在上面代码中涉及 WebGL 着色器三维向量 vec3 和四维向量 vec4 两种数据类型，比如光线的方向需要 xyz 三个分量描述，可以使用关键字 vec3 声明，比如顶点位置的齐次坐标 (x, y, z, w)，包含透明度的 RGB 颜色模型 RGBA(r, g, b, a) 都需要四个分量描述，可以使用关键字 vec4 声明。</p>\n<p><code class="language-text">attribute vec4 a_normal;</code> 中变量 <code class="language-text">a_normal</code> 定义的是 vec4 类型，第四个参数默认是 1.0 主要是为了凑成齐次坐标用于矩阵计算，表示法向量方向的是前三个参数，所以执行 <code class="language-text">a_normal.xyz</code> 就相当于访问法向量的 xyz 值，返回的结果是一个 vec3 数据，如果执行 vec3.xy 相当于返回一个 vec2 数据，如果一个顶点的 <code class="language-text">a_normal</code> 数据是 (1.0, 1.0, 1.0, 1.0)，那么它的模长就不是 1，而是 3 的平方根，这时候需要把前三个 1 全部除以 3 的平方根才可以把非单位向量转化为单位向量。</p>\n<h4 id="顶点着色器：光照计算"><a href="#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8%EF%BC%9A%E5%85%89%E7%85%A7%E8%AE%A1%E7%AE%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点着色器：光照计算</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20590099540354003000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 顶点法向量进行矩阵变换，然后归一化\nvec3 normal = normalize((mx * my * a_normal).xyz);\n// 计算点光源照射顶点的方向并归一化\nvec3 lightDirection = normalize(vec3(gl_Position) - u_lightPosition);\n// 计算平行光方向向量和顶点法向量的点积\nfloat dot = max(dot(lightDirection, normal), 0.0);\n// 计算反射后的颜色\nvec3 reflectedLight = u_lightColor * a_color.rgb * dot;\n// 颜色插值计算\nv_color = vec4(reflectedLight, a_color.a);`, `20590099540354003000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 顶点法向量进行矩阵变换，然后归一化</span>\n<span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mx <span class="token operator">*</span> my <span class="token operator">*</span> a_normal<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 计算点光源照射顶点的方向并归一化</span>\n<span class="token keyword">vec3</span> lightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token keyword">vec3</span><span class="token punctuation">(</span>gl_Position<span class="token punctuation">)</span> <span class="token operator">-</span> u_lightPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 计算平行光方向向量和顶点法向量的点积</span>\n<span class="token keyword">float</span> dot <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>lightDirection<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 计算反射后的颜色</span>\n<span class="token keyword">vec3</span> reflectedLight <span class="token operator">=</span> u_lightColor <span class="token operator">*</span> a_color<span class="token punctuation">.</span>rgb <span class="token operator">*</span> dot<span class="token punctuation">;</span>\n<span class="token comment">// 颜色插值计算</span>\nv_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>reflectedLight<span class="token punctuation">,</span> a_color<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>dot() 是 WebGL 着色器语言的一个内置函数，可以直接使用，它的参数是两个向量，执行结果是两个向量的点积，如果光线方向向量和顶点法向量两个向量都是单位向量，求解的结果就是平行光线与物体表面法线夹角的余弦值。内置函数 normalize() 和 dot() 一样是 WebGL 着色器语言提供的用于数学计算的函数，normalize() 的作用就是把向量归一化，具体点说就是如果向量的模长不是 1，不改变向量方向，把模长变为 1，也就是把向量转化为单位向量。</p>\n<p><code class="language-text">max(dot(lightDirection, normal), 0.0)</code> 在 dot 代码的外面嵌套了一个函数 max()，dot() 的计算结果作为 max() 的第一个参数，dot 的计算结果可能是 [-1, 1] 之间，颜色不存在负值要舍去 [-1, 0)，这时候就是内置函数 max() 派上用场的时候，<code class="language-text">max(dot(lightDirection, normal), 0.0)</code> 中 max() 函数的第二个参数是 0，dot() 方法的计算结果会和 0 进行比较运算，返回一个较大的值，着色器语言内置提供了 max() 函数，自然也有对应的求较小值的函数 min()。余弦值是负值的物理意义就是光线无法照的地方，临界点是余弦值 0，入射角是 90 度，也就是说入射光线平行平面，平行平面相当于光线没有照射到平面上，平面没有收到光自然无法反射光，你可以尝试改变立方体顶点的旋转矩阵可以看到一些面的颜色是黑色，就是因为没有光线照射，这是符合实际生活和物理规律的，不管本身是什么颜色，没有外界光源，那就表现为黑色。</p>\n<p><code class="language-text">u_lightColor * a_color.rgb * dot;</code> 是套用理想漫反射光照模型的一个公式进行计算，顶点颜色变量 <code class="language-text">a_color</code> 是 vec4 类型包含透明度，计算式中光源颜色变量 <code class="language-text">u_lightColor</code> 没有透明度分量 A，所以使用 <code class="language-text">a_color.rgb</code> 语句返回 <code class="language-text">a_color</code> 变量的 RGB 三个分量，也就是返回一个 vec3 类型数据。</p>\n<p><code class="language-text">v_color = vec4(reflectedLight, a_color.a);</code> 通过把反射颜色 reflectedLight 赋值给 varying 声明的一个变量实现颜色的插值计算，关于插值计算之前讲过，不再多谈，这里说一下着色器语言数据类型的相关转化、构造、访问相关问题，vec4、vec3 和 float、int 一样是数据类型的标识关键字，float、int 在 C 语言中都是常见的类型，着色器语言为了实现大规模的顶点运算增加了 vec4、vec3、mat4 等数据类型，vec4()、vec3() 这时候相当于一个 vec4、vec3 数据的构造函数，<code class="language-text">vec4(reflectedLight, a_color.a)</code> 中把一个 vec3 类型数据和一个 vec4 类型数据的一个分量 a 作为构造函数 vec4 的两个参数，来实现创建一个 vec4 类型数据。访问多元素数据的分量可使用点符号 <code class="language-text">.</code> ，从面对象的角度来看， 一个 vec4 数据是一个对象，数据的一个元素就是数据的一个分量，比如 <code class="language-text">a_color.a</code> 表示 vec4 类型变量 <code class="language-text">a_color</code> 的透明度分量 a。关于 vec4、vec3 等向量数据类型的介绍可以查看第二章 WebGL 着色器。</p>\n<h5 id="获取着色器变量"><a href="#%E8%8E%B7%E5%8F%96%E7%9D%80%E8%89%B2%E5%99%A8%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取着色器变量</h5>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64886112003039820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * 从 program 对象获取相关的变量\n * attribute 变量声明的方法使用 getAttribLocation() 方法\n * uniform 变量声明的方法使用 getUniformLocation() 方法\n **/\nvar aposLocation = gl.getAttribLocation(program, \'apos\');\nvar a_color = gl.getAttribLocation(program, \'a_color\');\nvar a_normal = gl.getAttribLocation(program, \'a_normal\');\nvar u_lightColor = gl.getUniformLocation(program, \'u_lightColor\');\nvar u_lightPosition = gl.getUniformLocation(program, \'u_lightPosition\');`, `64886112003039820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * 从 program 对象获取相关的变量\n * attribute 变量声明的方法使用 getAttribLocation() 方法\n * uniform 变量声明的方法使用 getUniformLocation() 方法\n **/</span>\n<span class="token keyword">var</span> aposLocation <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'apos\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> a_color <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> a_normal <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getAttribLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'a_normal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> u_lightColor <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightColor\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> u_lightPosition <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'u_lightPosition\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>要想给着色器程序中声明的变量传递数据，首先要获取数据的地址，然后通过指针地址传递给变量。要想获取变量地址，不可能像普通 CPU 变成一样，要考虑 GPU 的特殊性，首先要通过调用初始化着色器函数 initShader()，把着色器程序处理后通过 CPU 与 GPU 的通信传递给 GPU 配置渲染管线，执行初始化着色器函数 initShader() 的同时会返回一个 program 对象，通过对象 program 可以获取着色器程序中的变量索引地址，通过 WebGL API gl.getAttribLocation() 用来获取 attribute 关键字声明的顶点变量地址，通过 WebGL API gl.getUniformLocation() 获取 uniform 关键字声明的非顶点变量地址。</p>\n<h5 id="传递数据"><a href="#%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>传递数据</h5>\n<p>对于简单的数据，不像顶点有大批量数据，不需要在显存上开辟缓冲区上传数据，可以直接使用 WebGL API gl.uniform3f() 把数据传递给 GPU，uniform3f(变量地址, x, y, z) 表示传递三个浮点数 x, y, z，接收这个数据的变量是 vec3 类型，uniform2f(变量地址, x, y) 表示传递 2 个浮点数，接收数据的变量是 vec2 数据类型，以此类推还有方法 uniform4f()、uniform1f()，命名的特点是数字表示传递的数据有多少分量，f 是关键字 float 的缩写表示浮点数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59945281270832990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * 给平行光传入颜色和方向数据 RGB(1, 1, 1)，单位向量 (x, y, z)\n **/\ngl.uniform3f(u_lightColor, 1.0, 1.0, 1.0);\n// 保证向量 (x, y, -z) 的长度为 1，即单位向量\n// 如果不是单位向量，也可以再来着色器代码中进行归一化\nvar x = 1 / Math.sqrt(14),\n   y = 2 / Math.sqrt(14),\n   z = 3 / Math.sqrt(14);\ngl.uniform3f(u_lightDirection, x, y, -z);`, `59945281270832990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * 给平行光传入颜色和方向数据 RGB(1, 1, 1)，单位向量 (x, y, z)\n **/</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>u_lightColor<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 保证向量 (x, y, -z) 的长度为 1，即单位向量</span>\n<span class="token comment">// 如果不是单位向量，也可以再来着色器代码中进行归一化</span>\n<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   z <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>u_lightDirection<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>传递 uniform 变量的 WebGL API 对应的着色器 uniform 变量数据类型</p>\n<table>\n<thead>\n<tr>\n<th align="left">WebGL API</th>\n<th align="left">数据类型</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">uniform1f()</td>\n<td align="left">float</td>\n</tr>\n<tr>\n<td align="left">uniform2f()</td>\n<td align="left">vec2</td>\n</tr>\n<tr>\n<td align="left">uniform3f()</td>\n<td align="left">vec3</td>\n</tr>\n<tr>\n<td align="left">uniform4f()</td>\n<td align="left">vec4</td>\n</tr>\n</tbody>\n</table>\n<h5 id="顶点法向量"><a href="#%E9%A1%B6%E7%82%B9%E6%B3%95%E5%90%91%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点法向量</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-08-23-14-21-42-ee38b526abf06f4f6eabc9dcc0d79c18-997dd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 195px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 87.17948717948718%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAADOUlEQVQ4y4VUzYsUVxD/VdXr6Z6e751vV9cdd6KO66CrySa7iVEUEcKy7EE0US/qRRDEQ5CYnATRkARJhAQMJJeEXLwISf4AQXLak7mqgehF2YMiSWZd3Ge97unsrB4s+lHVr+r9ql59PGCApL/qxkb/9YLN12DnzEIrx3cxx3/JO3yfu3KP9ydnqt7yhor5d8zJFdOjV8AceVgTKTwZKYc41ZFxb5i/xj7+mN7k8zTJn9G0yRZqalIrm/sfVM3y5P+AixLD9ETIGjPggPNM2OFEvoKSfEv1vmMT8+KQwH9bxZT7T9OVleieiAzeHAyoMerqox7iOItlX+5wKdEX8whVXxT+JRA82V1FL3T73+HUSoRPRdrW9533UF3W+8BV1RJWk0Hx3E5p/KfR2z0Qm1mlVcDogBXpniEaVXE8iCMs6RpX0IbycgF+1QX3Fa07eMl8cgTGHvXx+7t/auosqLQIamoph1aBa2QjyrIKEnro6LXMmMoFRjHTZvjAoY0X+eSMZepqCJkpLcptYLcC7X0OzC4DU1hkTj8jmtDN6ufANuVrLPLpvoOyhxmzktsvOoqfUhvSVf4e6P6E5qZnNNRdoigYQFG7urarwWwP+OgRwrzbbxjbDel0J4ayni6X4EKqX+U+BVmZnx6Vpa1xdhVFv+KSGiof/QHYeguNwOlqxh7O8eW9KpYIP48zzVQ0l28IpGlchZHNavJbBb7aMr6NKvslf4qXSRM/zE7wZbZsaEcb+GOScKOrICmG13btpHIQF4s6ycEpPo/kyto/Gqk2dRlYG+cqk5MQTbPh8bRqDiBlR+J9qrTCPOn9jAIOJ2AZOhvxivTijR+ZE105r2D6W6MxG2iPHVPALVoFYZvKpcAFBFFrND8konhiKBkGN3rRyKHfh6MniKZBtLnhJgnf5IBbE1mtKE9iKH1V1qvZ8AlDu9TWjSSuMxMG3oBkhhPA934z3HZ9mH3LNPgadsk5NPmCNyHXeE94HK7pw4VAWs9F3u+fIcHqsuMfz4vn2Zic3elH6HrFNN+VA/x3tqXP1QTfoTl5yC5CHPlVCK+jBwOvzFSBXjnANyngearFV4kLOP/Sg5LQC/vnoLDNgz0GAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 08 23 14 21 42" title="" data-src="/static/2022-08-23-14-21-42-ee38b526abf06f4f6eabc9dcc0d79c18-997dd.png" data-srcset="/static/2022-08-23-14-21-42-ee38b526abf06f4f6eabc9dcc0d79c18-997dd.png 195w" data-sizes="(max-width: 195px) 100vw, 195px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82377113331352470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * 顶点法向量数组 normalData\n **/\nvar normalData = new Float32Array([\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1, // z 轴正方向——面 1\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // x 轴正方向——面 2\n\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0, // y 轴正方向——面 3\n\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0, // x 轴负方向——面 4\n\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0, // y 轴负方向——面 5\n\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1 // z 轴负方向——面 6\n]);`, `82377113331352470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * 顶点法向量数组 normalData\n **/</span>\n<span class="token keyword">var</span> normalData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// z 轴正方向——面 1</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x 轴正方向——面 2</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y 轴正方向——面 3</span>\n\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x 轴负方向——面 4</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y 轴负方向——面 5</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">// z 轴负方向——面 6</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于立方体而言六个平面也就是有六个不同的平面法向量，但是这里要注意思考如何表达一个面的法向量，你不能说直接告诉 GPU 一个平面的法向量是 (x, y, z)，对于立方体而言而言这样比较简单，符合人的思维，但是如果是复杂的曲面这样并不合适，而且顶点着色器是逐顶点处理，为了表示面的法向量，往往是通过顶点，具体点说是每个顶点对应一个法向量，三个顶点确定一个三角面，三角面的不同位置的法向量相当于通过他的三个顶点的法向量插值得出，或者换个说法就是三个顶点的法向量分别与各自颜色数据进行乘法运算，得到新的顶点颜色，然后渲染管线利用新的顶点颜色进行插值计算，这就是通过顶点法向量表示面法向量的方法，通过这样的巧妙设计还可以实现法向量的插值计算，只不过插值是通过颜色插值完成的，对于平滑的曲面，过每一个顶点存在一个法平面，也就是有一个法向量，往往在不同三角面中同一位置的顶点法向量是相同的，对于规则的长方体而言，每个顶点法向量往往在各自平面中有不同的值。</p>\n<h4 id="顶点法向量矩阵变换"><a href="#%E9%A1%B6%E7%82%B9%E6%B3%95%E5%90%91%E9%87%8F%E7%9F%A9%E9%98%B5%E5%8F%98%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>顶点法向量矩阵变换</h4>\n<p>执行代码 <code class="language-text">gl_Position = mx * my * apos;</code> 意味着通过旋转矩阵 mx 和 my 对立方体顶点数据 apos 进行旋转变换，也就是说立方体在三维空间中进行了旋转，如果立方体进行了旋转，也就是说立方体表面的法线方向变化了，立方体表面的法线是通过顶点法向量表示的，所以说顶点法向量数据要和顶点位置数据一样执行矩阵变换 <code class="language-text">mx * my * a_normal</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11351235000938732000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 两个旋转矩阵、顶点齐次坐标连乘\ngl_Position = mx * my * apos;\n// 顶点法向量进行矩阵变换，然后归一化\nvec3 normal = normalize((mx * my * a_normal).xyz);`, `11351235000938732000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 两个旋转矩阵、顶点齐次坐标连乘</span>\ngl_Position <span class="token operator">=</span> mx <span class="token operator">*</span> my <span class="token operator">*</span> apos<span class="token punctuation">;</span>\n<span class="token comment">// 顶点法向量进行矩阵变换，然后归一化</span>\n<span class="token keyword">vec3</span> normal <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mx <span class="token operator">*</span> my <span class="token operator">*</span> a_normal<span class="token punctuation">)</span><span class="token punctuation">.</span>xyz<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="视线"><a href="#%E8%A7%86%E7%BA%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视线</h4>\n<p>通过下面的代码测试，来体会 WebGL 投影的规律。</p>\n<p>WebGL 图形系统默认的投影方向，或者说人的眼睛观察几何体的方向，或者说照相机拍照的方向。代码中的灯光方向的向量数据，第三个参数是负数，也就是说从 z 轴的角度看，平行光照射物体的方向，就是人眼睛看物体的方向，如果把灯光方向的向量数据 z 参数更改为正数，刷新浏览器看到的是一个漆黑的立方体投影，这时候相当于黑暗的环境中，人站在物体的背光面，而不是向光面，对于 WebGL 图形系统，你可以形象的理解为把光源从屏幕前面放到了屏幕的后面，人的观察方向是沿着 z 轴负方向，从屏幕外向里观察，光线自然被立方体遮挡住了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1986647093061311200"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var x = 1 / Math.sqrt(15),\n   y = 2 / Math.sqrt(15),\n   z = 3 / Math.sqrt(15);\ngl.uniform3f(u_lightDirection, x, y, -z);`, `1986647093061311200`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   y <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   z <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>u_lightDirection<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">-</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>更改 -z 为 z，立方体显示为黑色效果。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65227964529032080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gl.uniform3f(u_lightDirection, x, y, z);`, `65227964529032080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>u_lightDirection<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="立方体添加点光源"><a href="#%E7%AB%8B%E6%96%B9%E4%BD%93%E6%B7%BB%E5%8A%A0%E7%82%B9%E5%85%89%E6%BA%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>立方体添加点光源</h3>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/yvjixk?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>添加平行光是直接定义光线照射物体的方向，点光源的光线是发散的，无法直接定义它的光线方向，不过只要定义好点光源的位置坐标，然后与某个顶点的位置坐标进行减法运算，计算结果就是光源射到该顶点的方向。这很好理解，在三维空间中两个点确定一条直线，几何体顶点代表一个点，点光源的位置代表一个点，直线所在的方向就是光线的方向，在三维笛卡尔坐标系中，把两个顶点的 xyz 三个分量相减就可以得到一个表示直线方向的向量，把该向量和顶点法向量作为 dot() 点积函数的参数，可以计算出光线入射角余弦值然后代入漫反射光照模型公式可以得到新的顶点颜色，渲染管线利用新的顶点颜色进行插值计算可以得到立方体表面每一个像素的值。</p>\n<h4 id="添加点光源位置、颜色数据"><a href="#%E6%B7%BB%E5%8A%A0%E7%82%B9%E5%85%89%E6%BA%90%E4%BD%8D%E7%BD%AE%E3%80%81%E9%A2%9C%E8%89%B2%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>添加点光源位置、颜色数据</h4>\n<p>WebGL 顶点着色器声明两个变量 <code class="language-text">u_lightPosition</code>、<code class="language-text">u_lightColor</code> 分别表示点光源的位置和颜色。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61954701170948190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// uniform 声明点光源颜色变量\nuniform vec3 u_lightColor;\n// uniform 声明点光源位置变量\nuniform vec3 u_lightPosition;`, `61954701170948190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// uniform 声明点光源颜色变量</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightColor<span class="token punctuation">;</span>\n<span class="token comment">// uniform 声明点光源位置变量</span>\n<span class="token keyword">uniform</span> <span class="token keyword">vec3</span> u_lightPosition<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>给点光源颜色变量 <code class="language-text">u_lightColor</code>、位置变量 <code class="language-text">u_lightPosition</code> 传递数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76483568319184320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 传入点光源颜色数据、位置数据\ngl.uniform3f(u_lightColor, 1.0, 1.0, 1.0);\ngl.uniform3f(u_lightPosition, 2.0, 3.0, 4.0);`, `76483568319184320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 传入点光源颜色数据、位置数据</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>u_lightColor<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniform3f</span><span class="token punctuation">(</span>u_lightPosition<span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h4 id="点光源与顶点方向计算"><a href="#%E7%82%B9%E5%85%89%E6%BA%90%E4%B8%8E%E9%A1%B6%E7%82%B9%E6%96%B9%E5%90%91%E8%AE%A1%E7%AE%97" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>点光源与顶点方向计算</h4>\n<p>点光源的光线是发散的，点光源与每一顶点连线的方向都需要单独计算。</p>\n<p><code class="language-text">vec3(gl_Position) - u_lightPosition</code> 用来计算光线方向，然后利用内置函数 normalize() 归一化向量数据，<code class="language-text">vec3(gl_Position)</code> 和 <code class="language-text">gl_Position.xyz</code> 的写法是等效的，都是为了提取 vec4 类型顶点数据前三个分量，返回的数据类型是 vec3，比如 vec2(vec4) 就是提取 vec4 的前两个分量。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15667950733993873000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 计算点光源照射顶点的方向并归一化\nvec3 lightDirection = normalize(vec3(gl_Position) - u_lightPosition);\n// 计算平行光方向向量和顶点法向量的点积\nfloat dot = max(dot(lightDirection, normal), 0.0);`, `15667950733993873000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 计算点光源照射顶点的方向并归一化</span>\n<span class="token keyword">vec3</span> lightDirection <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token keyword">vec3</span><span class="token punctuation">(</span>gl_Position<span class="token punctuation">)</span> <span class="token operator">-</span> u_lightPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 计算平行光方向向量和顶点法向量的点积</span>\n<span class="token keyword">float</span> dot <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token function">dot</span><span class="token punctuation">(</span>lightDirection<span class="token punctuation">,</span> normal<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="立方体旋转动画"><a href="#%E7%AB%8B%E6%96%B9%E4%BD%93%E6%97%8B%E8%BD%AC%E5%8A%A8%E7%94%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>立方体旋转动画</h2>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/5ebtu4?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>要通过 WebGL 渲染出立方体旋转的动画效果，你首要了解“帧”这个概念，比如你观看的视频其实就是一帧一帧的图片连续播放的效果，只要图片刷新的频率的不是太低，人的眼睛都不会察觉，一般 30~60FPS 就可以。WebGL 如何产生一帧一帧的图片，这个很简单，执行一次绘制函数 gl.drawArrays()，WebGL 图形系统就会通知 GPU 渲染管线处理顶点数据生成一帧 RGB 像素数据显示在屏幕 canvas 画布上。只要周期性保持一定的频率调用 gl.drawArrays() 就可以生成一帧一帧的图片，在这个过程中同时要利用 JS 程序更新顶点的旋转矩阵，如果顶点的位置不变化，渲染出来的都是一样的图片，自然也没有动画的效果。</p>\n<p>浏览器提供了一个方法 requestAnimationFrame() 可以实现周期性调用某个函数，主要用于动画。</p>\n<p>在光照立方体的基础上进行更改，一方面是周期性执行绘制方法 gl.drawArrays()，另一方面以一定的旋转速度更新立方体的旋转矩阵，原来使用着色器语言定义的旋转矩阵更改为使用 JS 语句创建好再传递给顶点着色器，gl.drawArrays() 每次执行的时候，都会重新传入着色器顶点旋转矩阵数据并渲染出来。</p>\n<h3 id="声明矩阵变量"><a href="#%E5%A3%B0%E6%98%8E%E7%9F%A9%E9%98%B5%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>声明矩阵变量</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50745506752797790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** uniform 声明旋转矩阵变量 mx、my **/\nuniform mat4 mx; // 绕 x 轴旋转矩阵\nuniform mat4 my; // 绕 y 轴旋转矩阵`, `50745506752797790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">/** uniform 声明旋转矩阵变量 mx、my **/</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> mx<span class="token punctuation">;</span> <span class="token comment">// 绕 x 轴旋转矩阵</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> my<span class="token punctuation">;</span> <span class="token comment">// 绕 y 轴旋转矩阵</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>在顶点着色器代码中使用关键字 uniform 声明两个旋转矩阵变量 mx 和 my，分别表示绕 x 轴、y 轴的旋转矩阵。旋转矩阵数据和光照数据一样适用于所有的非顶点数据，使用关键字 uniform 声明，不能使用 attribute 关键字声明。</p>\n<h3 id="传入-mx-矩阵数据"><a href="#%E4%BC%A0%E5%85%A5-mx-%E7%9F%A9%E9%98%B5%E6%95%B0%E6%8D%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>传入 mx 矩阵数据</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63444767068559570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** 从 program 对象获得旋转矩阵变量 mx、my 地址 **/\nvar mx = gl.getUniformLocation(program, \'mx\');\nvar my = gl.getUniformLocation(program, \'my\');`, `63444767068559570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/** 从 program 对象获得旋转矩阵变量 mx、my 地址 **/</span>\n<span class="token keyword">var</span> mx <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'mx\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> my <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'my\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23807253113722160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** 绕 x 轴旋转 45 度 **/\nvar mxArr = new Float32Array([\n   1,\n   0,\n   0,\n   0,\n\n   0,\n   Math.cos(Math.PI / 4),\n   -Math.sin(Math.PI / 4),\n   0,\n\n   0,\n   Math.sin(Math.PI / 4),\n   Math.cos(Math.PI / 4),\n   0,\n\n   0,\n   0,\n   0,\n   1\n]);\n\n// 把数据 mxArr 传递给着色器旋转矩阵变量 mx\ngl.uniformMatrix4fv(mx, false, mxArr);`, `23807253113722160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/** 绕 x 轴旋转 45 度 **/</span>\n<span class="token keyword">var</span> mxArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 把数据 mxArr 传递给着色器旋转矩阵变量 mx</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>mx<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> mxArr<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上节课定义顶点旋转矩阵使用的着色器语言，下面的案例是先在 JS 程序中使用类型数组 Float32Array() 创建旋转矩阵的数据，然后使用 WebGL API gl.uniformMatrix4fv() 把数据传递给着色器。WebGL 中给着色器中不同关键字声明的不同类型变量传递数据，要使用不同的 WebGL API，uniform 关键字声明的 mat4 类型变量使用 WebGL API gl.uniformMatrix4fv()，uniform 关键字声明的 mat2 类型变量使用 WebGL API uniformMatrix2fv()，uniform 关键字声明的一个浮点数使用 gl.uniform1f() 传递，uniform 关键字声明的 vec4 类型变量和 mat4 一样使用 uniform4fv（变量地址名，<code class="language-text">new Float32Array([a, b, c, d])</code>）传递，也可以使用 uniform4f（变量地址名，a, b, c, d）传递，attribute 关键字声明的变量使用 WebGL API gl.vertexAttribPointer() 传递。</p>\n<h3 id="绘制函数-draw"><a href="#%E7%BB%98%E5%88%B6%E5%87%BD%E6%95%B0-draw" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>绘制函数 draw()</h3>\n<p>该绘制函数 draw() 可以使用 requestAnimationFrame(draw) 代码实现 draw() 函数的循环调用，因为要实现立方体绕 y 轴旋转，所以要在 draw 函数中更新 my 旋转矩阵的数据，同时利用 WebGL API gl.uniformMatrix4fv() 把新的矩阵数据传递给着色器矩阵变量 my，在函数重复调用 gl.drawArrays(gl.TRIANGLES, 0, 36) 不停绘制旋转后的顶点数据，所有需要更新的数据都要写在 draw 函数中，不需要反复执行的代码写在 draw 函数外，比如 mx 旋转矩阵只需要执行传入一次不再改变。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32422969314083150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * 定义绘制函数 draw()，定时更新旋转矩阵数据，并调用 WebGL 绘制 API\n ***/\nvar angle = Math.PI / 4; // 起始角度\nfunction draw() {\n   // gl.clear(gl.COLOR_BUFFER_BIT); // 清空画布上一帧图像\n   /**\n    * 立方体绕 y 轴旋转\n    ***/\n   angle += 0.01; // 每次渲染角度递增，每次渲染不同的角度\n   var sin = Math.sin(angle); // 旋转角度正弦值\n   var cos = Math.cos(angle); // 旋转角度余弦值\n   var myArr = new Float32Array([cos, 0, -sin, 0, 0, 1, 0, 0, sin, 0, cos, 0, 0, 0, 0, 1]);\n   gl.uniformMatrix4fv(my, false, myArr);\n   requestAnimationFrame(draw);\n   /** 执行绘制命令 **/\n   gl.drawArrays(gl.TRIANGLES, 0, 36);\n}\ndraw();`, `32422969314083150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * 定义绘制函数 draw()，定时更新旋转矩阵数据，并调用 WebGL 绘制 API\n ***/</span>\n<span class="token keyword">var</span> angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 起始角度</span>\n<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// gl.clear(gl.COLOR_BUFFER_BIT); // 清空画布上一帧图像</span>\n   <span class="token comment">/**\n    * 立方体绕 y 轴旋转\n    ***/</span>\n   angle <span class="token operator">+=</span> <span class="token number">0.01</span><span class="token punctuation">;</span> <span class="token comment">// 每次渲染角度递增，每次渲染不同的角度</span>\n   <span class="token keyword">var</span> sin <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 旋转角度正弦值</span>\n   <span class="token keyword">var</span> cos <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 旋转角度余弦值</span>\n   <span class="token keyword">var</span> myArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>cos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>sin<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sin<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   gl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>my<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> myArr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">/** 执行绘制命令 **/</span>\n   gl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="webgl-绘制多个几何体"><a href="#webgl-%E7%BB%98%E5%88%B6%E5%A4%9A%E4%B8%AA%E5%87%A0%E4%BD%95%E4%BD%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 绘制多个几何体</h2>\n<p>利用 WebGL 重现三维场景的时候，往往不仅仅有一个几何体，比如像机器人是由多个子零件构成的装配体，可能同一个零件出现在不同的位置，可能两个零件的形状一样颜色不一样，也有颜色形状完全不同的零件。阅读下面的讲解内容，一方面可以学习如何利用 WebGL 创建多几何体场景，同时借助实际的问题进一步加深对渲染管线这个硬件黑箱的认知，只有更好的认知渲染管线才能更好的应用与它紧密关联的 API 接口，学习精力是有限的，毕竟 GPU 的数字电路不是每个人都有时间学习明白，只能通过简单的案例程序学习如何利用 WebGL API 操作渲染管线的相关功能。</p>\n<p>绘制多个几何体你首先会想到应该是每个几何体都有自己的顶点数据，要创建多个几何体自然要先利用类型数据创建这些顶点数据，除此外还要学习绘制函数的多次调用与帧缓存的知识，学习如何切换使用多组着色器程序。</p>\n<p>为了绘制两个相同的立方体效果，下面给出了两种方式。</p>\n<h3 id="方式一"><a href="#%E6%96%B9%E5%BC%8F%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式一</h3>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/phgtl1?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>最简单思路，增加一个几何体就把几何体的顶点添加到顶点数据中，在光照立方体代码的基础上更改即可，把立方体原来数据复制一份，为了把两个立方体的位置错开，可以使用 for 循环批量修改顶点数据，把某个坐标值加或减。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62474806149750250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var data = new Float32Array([\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3, // 面 1\n\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3, // 面 2\n\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3, // 面 3\n\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3, // 面 4\n\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3, // 面 3\n\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3, // 面 6\n\n   // 立方体 2 的顶点坐标数据\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3, // 面 1\n\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3, // 面 2\n\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3, // 面 3\n\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3, // 面 4\n\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   0.3, // 面 3\n\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   -0.3,\n   -0.3,\n   0.3,\n   -0.3,\n   0.3,\n   0.3,\n   -0.3 // 面 6\n]);\n// 立方体 1 顶点数据 x 坐标批量加 0.5\nfor (var i = 0; i < 36 * 3; i += 3) {\n   data[i] += 0.5;\n}\n// 立方体 2 顶点数据 x 坐标批量减 0.5\nfor (var i = 36 * 3; i < 72 * 3; i += 3) {\n   data[i] -= 0.5;\n}`, `62474806149750250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 1</span>\n\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 2</span>\n\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 3</span>\n\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 4</span>\n\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 3</span>\n\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 6</span>\n\n   <span class="token comment">// 立方体 2 的顶点坐标数据</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 1</span>\n\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 2</span>\n\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 3</span>\n\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 4</span>\n\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token comment">// 面 3</span>\n\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token number">0.3</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">0.3</span> <span class="token comment">// 面 6</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 立方体 1 顶点数据 x 坐标批量加 0.5</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">36</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 立方体 2 顶点数据 x 坐标批量减 0.5</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">36</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">72</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>顶点的法向量数据、颜色数据重新复制一份即可，和原来相同。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77627832137588870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n 创建顶点颜色数组 colorData\n **/\nvar colorData = new Float32Array([\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 1\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 2\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 3\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 4\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 5\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 6\n\n   // 立方体 2 的顶点颜色数据\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 1\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 2\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 3\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 4\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // 红色——面 5\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0 // 红色——面 6\n]);\n/**\n *顶点法向量数组 normalData\n **/\nvar normalData = new Float32Array([\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1, // z 轴正方向——面 1\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // x 轴正方向——面 2\n\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0, // y 轴正方向——面 3\n\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0, // x 轴负方向——面 4\n\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0, // y 轴负方向——面 5\n\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1, // z 轴负方向——面 6\n\n   // 立方体 2 的顶点法向量数据\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1, // z 轴正方向——面 1\n\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0, // x 轴正方向——面 2\n\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0,\n   0,\n   1,\n   0, // y 轴正方向——面 3\n\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0, // x 轴负方向——面 4\n\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0, // y 轴负方向——面 5\n\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1,\n   0,\n   0,\n   -1 // z 轴负方向——面 6\n]);`, `77627832137588870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n 创建顶点颜色数组 colorData\n **/</span>\n<span class="token keyword">var</span> colorData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 1</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 2</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 3</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 4</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 5</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 6</span>\n\n   <span class="token comment">// 立方体 2 的顶点颜色数据</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 1</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 2</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 3</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 4</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 红色——面 5</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span> <span class="token comment">// 红色——面 6</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">/**\n *顶点法向量数组 normalData\n **/</span>\n<span class="token keyword">var</span> normalData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// z 轴正方向——面 1</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x 轴正方向——面 2</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y 轴正方向——面 3</span>\n\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x 轴负方向——面 4</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y 轴负方向——面 5</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// z 轴负方向——面 6</span>\n\n   <span class="token comment">// 立方体 2 的顶点法向量数据</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// z 轴正方向——面 1</span>\n\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x 轴正方向——面 2</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y 轴正方向——面 3</span>\n\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x 轴负方向——面 4</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y 轴负方向——面 5</span>\n\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token number">0</span><span class="token punctuation">,</span>\n   <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">// z 轴负方向——面 6</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>绘制的顶点数量增加了，drawArrays 方法的参数要从 36 变为 72.</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58064832263813890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** 执行绘制命令 **/\ngl.drawArrays(gl.TRIANGLES, 0, 36);`, `58064832263813890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/** 执行绘制命令 **/</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67507864685621110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** 执行绘制命令 **/\ngl.drawArrays(gl.TRIANGLES, 0, 72);`, `67507864685621110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/** 执行绘制命令 **/</span>\ngl<span class="token punctuation">.</span><span class="token function">drawArrays</span><span class="token punctuation">(</span>gl<span class="token punctuation">.</span><span class="token constant">TRIANGLES</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="方式二（重用数据）"><a href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%88%E9%87%8D%E7%94%A8%E6%95%B0%E6%8D%AE%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方式二（重用数据）</h3>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/nml4xw?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<p>两个几何体颜色、形状完全相同，没有必要在创建一组顶点数据，可以使用 WebGL API 绘制函数 gl.drawArrays() 多次调用同一组顶点数据，执行平移变换即可，第一次调用 WebGL API 绘制函数 gl.drawArrays() 把立方体整体向右平移（x 轴正方向），第二次调用立方体整体向左平移（x 轴负方向）。</p>\n<p>在着色器声明旋转矩阵 mx、my 和平移矩阵 Tx，旋转矩阵传入一次数据不再改变，平移矩阵的数据每次调用 WebGL API 绘制函数 gl.drawArrays()，都会重新传入着色器新的数据，在新的位置渲染出来几何体。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33748885839364640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** uniform 声明旋转矩阵变量 mx、my，平移矩阵 Tx **/\nuniform mat4 mx; // 绕 x 轴旋转矩阵\nuniform mat4 my; // 绕 y 轴旋转矩阵\nuniform mat4 Tx; // 沿着 x 轴平移矩阵`, `33748885839364640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">/** uniform 声明旋转矩阵变量 mx、my，平移矩阵 Tx **/</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> mx<span class="token punctuation">;</span> <span class="token comment">// 绕 x 轴旋转矩阵</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> my<span class="token punctuation">;</span> <span class="token comment">// 绕 y 轴旋转矩阵</span>\n<span class="token keyword">uniform</span> <span class="token keyword">mat4</span> Tx<span class="token punctuation">;</span> <span class="token comment">// 沿着 x 轴平移矩阵</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在着色器声明旋转矩阵 mx、my 和平移矩阵 Tx，旋转矩阵传入一次数据不再改变，平移矩阵的数据每次调用 WebGL API 绘制函数 gl.drawArrays()，都会重新传入着色器新的数据，在新的位置渲染出来几何体。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49272606202038530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/** 从 program 对象获得旋转矩阵变量 mx、my、Tx 地址 **/\nvar mx = gl.getUniformLocation(program, \'mx\');\nvar my = gl.getUniformLocation(program, \'my\');\nvar Tx = gl.getUniformLocation(program, \'Tx\');`, `49272606202038530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/** 从 program 对象获得旋转矩阵变量 mx、my、Tx 地址 **/</span>\n<span class="token keyword">var</span> mx <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'mx\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> my <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'my\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> Tx <span class="token operator">=</span> gl<span class="token punctuation">.</span><span class="token function">getUniformLocation</span><span class="token punctuation">(</span>program<span class="token punctuation">,</span> <span class="token string">\'Tx\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>通过 WebGL API gl.uniformMatrix4fv() 把类型数据创建的旋转矩阵数据传递给着色器。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79757468253293410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * 传入旋转矩阵数据\n ***/\nvar angle = Math.PI / 4; // 旋转角度\nvar sin = Math.sin(angle);\nvar cos = Math.cos(angle);\n// 旋转矩阵数据\nvar mxArr = new Float32Array([1, 0, 0, 0, 0, cos, -sin, 0, 0, sin, cos, 0, 0, 0, 0, 1]);\nvar myArr = new Float32Array([cos, 0, -sin, 0, 0, 1, 0, 0, sin, 0, cos, 0, 0, 0, 0, 1]);\n// 类型数组传入矩阵\ngl.uniformMatrix4fv(mx, false, mxArr);\ngl.uniformMatrix4fv(my, false, myArr);`, `79757468253293410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * 传入旋转矩阵数据\n ***/</span>\n<span class="token keyword">var</span> angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 旋转角度</span>\n<span class="token keyword">var</span> sin <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> cos <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 旋转矩阵数据</span>\n<span class="token keyword">var</span> mxArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cos<span class="token punctuation">,</span> <span class="token operator">-</span>sin<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sin<span class="token punctuation">,</span> cos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> myArr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span>cos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>sin<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sin<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 类型数组传入矩阵</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>mx<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> mxArr<span class="token punctuation">)</span><span class="token punctuation">;</span>\ngl<span class="token punctuation">.</span><span class="token function">uniformMatrix4fv</span><span class="token punctuation">(</span>my<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> myArr<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>声明一个绘制函数 draw(x)，参数 x 是平移矩阵的一个元素，表示沿 x 轴平移距离，每次调用 draw() 函数都会传入新的 x 值。调用 draw 函数，执行 gl.drawArrays(gl.TRIANGLES, 0, 36) 语句的时候，渲染管线会生成立方体图像的像素值，像素值存储在帧缓冲区的颜色缓冲区中，你可以把帧缓冲区当成一个 RGB 像素值仓库，每执行一次 gl.drawArrays(gl.TRIANGLES, 0, 36) 生成一组 RGB 值，这些数据会被送进帧缓冲去中，默认不会覆盖前面的 RGB 数据，显示系统会不停的循环扫描帧缓冲区中的颜色数据显示在屏幕上。</p>\n<p>你可以执行注释掉的代码 <code class="language-text">gl.clear(gl.COLOR_BUFFER_BIT)</code>，然后刷新浏览器可以发现，网页上只有一个立方的图像， 这句代码 <code class="language-text">gl.clear(gl.COLOR_BUFFER_BIT)</code> 的作用就是清除帧缓冲区中颜色缓冲区存储的颜色数据，clear() 是一个 WebGL API，参数 <code class="language-text">COLOR_BUFFER_BIT</code> 表示帧缓冲区的颜色缓冲区，当然你也可以清除其它显存区域中的数据，比如参数是 <code class="language-text">gl.DEPTH_BUFFER_BIT</code> 就表示帧缓冲区的深度缓冲区像素深度数据，深度缓冲区和颜色缓冲区一样都是帧缓存的子缓冲区。</p>\n<p>立方体的所有面的像素值都存储在颜色缓冲区中，这些像素的深度值都保存在深度缓冲区中，深度缓冲区中数据表征像素距离人眼睛的长度，执行 <code class="language-text">gl.enable(gl.DEPTH_TEST)</code> 可以开启深度检测功能，离眼睛近的像素才会显示出来，离眼睛远的像素值会被覆盖，对应生活中就是正常情况下你的眼睛不可能不可能看到立方体的背面，你只能看到离你眼睛近的正面。</p>\n<h3 id="webgl-坐标系"><a href="#webgl-%E5%9D%90%E6%A0%87%E7%B3%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 坐标系</h3>\n<p>第一个 WebGL 程序创建了两个立方体的顶点数据，两个立方体一左一右，然后执行了绕 x 轴和 y 轴两个旋转变换，查看效果图你可以知道绕 y 旋转的时候是 WebGL 默认坐标系的 y 轴，不是过立方体几何中心的的 y 轴，查看立方体的顶点坐标可以看出来，两个立方体自身的几何中心是在 x 轴上的，所以立方体绕 WebGL 坐标系 x 轴的旋转相当于绕自身过几何中心的 x 轴旋转。复杂的场景往往牵扯到各种各样抽象出来的坐标系，比如视图坐标系、世界坐标系等，他们都是基于 WebGL 默认的坐标系抽象出来的，这里不再多说，先有一个简单的印象，一个几何体变换是相对于谁而言。</p>\n<p>对比上面方法一和方法二两个 WebGL 程序，你可以发现他们稍有区别。第二个 WebGL 程序的运行结果和第一个之所以不一样是因为平移和旋转的先后顺序不一样，第一个 WebGL 程序中虽然没有平移变换，但是两个几何体一左一右关于 y 轴对称，相当于从中间平移过去，然后经过两次旋转。查看下面第二个 WebGL 程序的着色器程序矩阵相乘的顺序，可以知道着色器处理器先对顶点进行旋转变换再进行平移变换。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51636722194886390000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 平移矩阵 Tx、旋转矩阵 mx、旋转矩阵 my 连乘、顶点齐次坐标连乘\ngl_Position = Tx * mx * my * apos;`, `51636722194886390000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 平移矩阵 Tx、旋转矩阵 mx、旋转矩阵 my 连乘、顶点齐次坐标连乘</span>\ngl_Position <span class="token operator">=</span> Tx <span class="token operator">*</span> mx <span class="token operator">*</span> my <span class="token operator">*</span> apos<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>矩阵的乘法运算中，矩阵的左乘和右乘是不一样的，是有顺序性的，离 apos 列向量近的矩阵就是先执行的变换，如果把平移矩阵 Tx 靠近 apos 列向量，运行程序你会发现和第一个 WebGL 程序的运算结果是一样的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34894518350811144000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 平移矩阵 Tx、旋转矩阵 mx、旋转矩阵 my 连乘、顶点齐次坐标连乘\ngl_Position = mx * my * Tx * apos;`, `34894518350811144000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="glsl"\n              >\n                <span class="gatsby-code-button-language">glsl</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="glsl"><pre style="counter-reset: linenumber NaN" class="language-glsl line-numbers"><code class="language-glsl"><span class="token comment">// 平移矩阵 Tx、旋转矩阵 mx、旋转矩阵 my 连乘、顶点齐次坐标连乘</span>\ngl_Position <span class="token operator">=</span> mx <span class="token operator">*</span> my <span class="token operator">*</span> Tx <span class="token operator">*</span> apos<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="webgl-纹理贴图"><a href="#webgl-%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebGL 纹理贴图</h2>\n<p>把 png、jpg 等格式图片显示在 WebGL 三维场景中，比如一个产品的三维模型上贴一个商标。一张图片从数据结构的角度看，文件中包含的信息就是和颜色缓冲区中的 RGB 或 RGBA 数据一样，.jpg 格式图片数据包含 RGB 红绿蓝三个颜色分量，.png 格式图片的数据除了 RGB 三个分量还包含透明度 A 分量，在 WebGL 中可以通过调节透明度 A 分量的值可以实现颜色叠加，模拟透明、半透明的玻璃效果。</p>\n<p>前面学习过顶点位置坐标、顶点颜色、顶点法向量三种顶点数据，本节课要引入新的顶点数据纹理坐标。图片称为纹理图像，图片上的一个像素称为纹素，一个纹素就是一个 RGB 或 RGBA 值。把整个图片看成一个平面区域，用一个二维 UV 坐标系可以描述每一个纹素的位置。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2022-09-14-18-25-57-e8028b15e764424c07cd9767fc6b20aa-fee1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACmUlEQVQoz41SXUhTcRQ/997ddj92793mdt2cm3MfLmZSrUkfEEVRUE89RJb2EPQSBBJFhVCJGNKLpaSBGJQmJqFlWGo0iZCkVFQiU/sAEcWM3vrArHE6d3Ov4YHf/3/On3N+//MFACCBNxKSEQUHoiTeGpY9iDy/72hQ1XN2W1k+Zub4YuD4GGEr+UcgLUFCVlpleONIqQigbWp6Uau2T/yQbg/OaSPJBUvn1LxY9+Rb+NGnROeGssC1wnJ92+GXarR0Wvb4DjjyI8dVxrbe5wkd0bx63G4DyO4H4JAxpfldj2ca5YY+FC7UozZJaTb2o3DuOqqJpTFAZJYBhKSoZS9xgqvPJPl/Cg4nCA57Na/4TrPr4gsAOiWmz5FfilBOfLlh6ZpE8eq939o4JuW7Q3+Ey82oJBZfG4SGz45wkC2g9kQpiKKK6GmvSLm4AdQt9FaYITNE7Z6ps3TPoKVteEUbWUGld/av0vMZ1Vff3wSTyKaccgp4YDjqGWNf7d8esklnnKQrBOKEeMpXfDZfK1a3onDx5i9tAlek+p5l86kqVHtnhzKfUkkmAwcB7GdoGCEiIZt7SFkjMGwT3blpUgD//bE7SscEym2jaP2IqDxfRLF9DOWBr9PQjmJF+KzlbaTE2eqM+UtM4uaE2RrMU4OBcmsk0Czq0XH6gMidaGzMe5rQzhMVJ20d72qk1tErlq4PVfKDqcpQ82BDtGHgfCwrsh3sG/0QOeYAybULCsrUdFlOG8QvcfAfMXolrt6mXgDbUyqvhm6yi/wAZooupsUIWalcmpSXdDdNQqcldJZSMzHDtL+yhWXdfj/jcIdZV16AcfnygWzQvblwqAVcZnt6MKxJorgAgdoFBrwEH8HDZhZ7rcKt0e8f5em9YZN/LOQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2022 09 14 18 25 57" title="" data-src="/static/2022-09-14-18-25-57-e8028b15e764424c07cd9767fc6b20aa-fee1c.png" data-srcset="/static/2022-09-14-18-25-57-e8028b15e764424c07cd9767fc6b20aa-a67b7.png 200w,\n/static/2022-09-14-18-25-57-e8028b15e764424c07cd9767fc6b20aa-0b187.png 400w,\n/static/2022-09-14-18-25-57-e8028b15e764424c07cd9767fc6b20aa-fee1c.png 800w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>// TODO <a href="http://www.yanhuangxueyuan.com/WebGL/" target="_blank" rel="nofollow noreferrer noopener">http://www.yanhuangxueyuan.com/WebGL/</a></p>',
excerpt:"快速入门 绘制一个点 着色器代码放在 script 标签中 绘制一个矩形 attribute 关键字 声明顶点相关数据的时候需要用到 attribute 关键字，目的是为了 js 可以调用相关的 WebGL API 把顶点相关数据从 js 传递给顶点着色器 attribute…",frontmatter:{date:"2022-09-14 18:27:05",path:"/webgl-zero-based-practice-learn/",tags:"前端, 可视化, WebGL, 读书笔记",title:"WebGL 零基础入门学习",draft:null}}},pathContext:{mainPostPath:"/css-new-world-new-layout/",nextPostPath:"/system-design-practice-learn/",prePostPath:"/webgl-zero-based-practice-learn/"}}}});