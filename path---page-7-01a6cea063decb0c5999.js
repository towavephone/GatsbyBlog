webpackJsonp([0xf43d0bd70d6],{1366:function(n,a){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"需求背景 针对本博客现有的 Gatsby 框架实现代码复制、代码实时查看编辑的功能 技术选型 以下都是采用最后一种方案，由于插件功能不满足，所以对其源码做出改动 代码复制 技术选型 语法 优点 缺点 项目代码自实现 未实现 定制化程度高 实现难度大； 拓展较差 gatsby-remark-code-buttons 不需特定语法，只要是代码块默认具有复制功能 已具有代码复制功能 有多复制一行的 bug； UI 不符合博客主题 代码实时查看编辑 技术选型 语法 优点 缺点 样例页面 iframe…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>针对本博客现有的 Gatsby 框架实现代码复制、代码实时查看编辑的功能</p>\n<h1 id="技术选型"><a href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术选型</h1>\n<p>以下都是采用最后一种方案，由于插件功能不满足，所以对其源码做出改动</p>\n<h2 id="代码复制"><a href="#%E4%BB%A3%E7%A0%81%E5%A4%8D%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码复制</h2>\n<table>\n<thead>\n<tr>\n<th align="left">技术选型</th>\n<th align="left">语法</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">项目代码自实现</td>\n<td align="left">未实现</td>\n<td align="left">定制化程度高</td>\n<td align="left"><ol>\n<li>\n实现难度大；\n</li>\n<li>\n拓展较差\n</li>\n</ol></td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/iamskok/gatsby-remark-code-buttons" target="_blank" rel="nofollow noreferrer noopener">gatsby-remark-code-buttons</a></td>\n<td align="left">不需特定语法，只要是代码块默认具有复制功能</td>\n<td align="left">已具有代码复制功能</td>\n<td align="left"><ol>\n<li>\n有多复制一行的 bug；\n</li>\n<li>\nUI 不符合博客主题\n</li>\n</ol></td>\n</tr>\n</tbody>\n</table>\n<h2 id="代码实时查看编辑"><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BC%96%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码实时查看编辑</h2>\n<table>\n<thead>\n<tr>\n<th align="left">技术选型</th>\n<th align="left">语法</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n<th>样例页面</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left">iframe + \n<a href="https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-remark-embed-snippet" target="_blank" rel="nofollow noreferrer noopener">gatsby-remark-embed-snippet</a></td>\n<td align="left"><code class="language-text">&lt;iframe src=&quot;/examples/snow.html&quot; width=&quot;800&quot; height=&quot;400&quot;&gt;&lt;/iframe&gt;</code>\n \n<br />\n \n<code class="language-text">`embed:snow.html`</code></td>\n<td align="left">实现最为简单，容易出效果</td>\n<td align="left"><ol>\n<li>\n没有实时编辑功能；\n<li>\n嵌入的代码往往需要将其写成一个 html 文件且一般情况下只支持静态页面的展示；\n</li>\n<li>\n需要 iframe、embed 标签声明两次\n</li>\n</ol></td>\n<td><a href="/snow-css/">下雪特效</a></td>\n</tr>\n<tr>\n<td align="left">iframe + code-editor.html 传参</td>\n<td align="left"><code class="language-text">&lt;iframe src=&quot;/examples/code-editor.html?html=转义字符串&amp;css=转义字符串&amp;js=转义字符串</code></td>\n<td align="left">基本实现代码的实时查看编辑</td>\n<td align="left"><ol>\n<li>\n嵌入的代码只支持静态的 html 页面；\n</li>\n<li>\n需要明确拆分出 js、css、html 三个结构；\n</li>\n<li>\n嵌入的 js、css、html 分别需要手动 escape 加密\n</li>\n</ol></td>\n<td><a href="/css-world-four-kinds-of-box/#border-%E7%AD%89%E9%AB%98%E5%B8%83%E5%B1%80%E6%8A%80%E6%9C%AF">CSS 世界四大盒尺寸</a></td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/elboman/gatsby-remark-embedded-codesandbox" target="_blank" rel="nofollow noreferrer noopener">gatsby-remark-embedded-codesandbox</a></td>\n<td align="left"><code class="language-text">[pms-example](embedded-codesandbox://gantt-component-optimization/pms-example)</code></td>\n<td align="left">借助 codesandbox 实现了较为丰富的代码实时查看编辑功能</td>\n<td align="left"><ol>\n<li>\n借助第三方实现的功能，不够稳定；\n</li>\n<li>\n不支持带目录的文件夹；\n</li>\n<li>\n单次请求过大（即上传代码过多）会报请求体过大错误；\n</li>\n<li>\n会上传 node_modules 等等大文件\n</li>\n</ol></td>\n<td>需实现</td>\n</tr>\n</tbody>\n</table>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<h2 id="代码复制-1"><a href="#%E4%BB%A3%E7%A0%81%E5%A4%8D%E5%88%B6-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码复制</h2>\n<h3 id="修复复制多一行-bug"><a href="#%E4%BF%AE%E5%A4%8D%E5%A4%8D%E5%88%B6%E5%A4%9A%E4%B8%80%E8%A1%8C-bug" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修复复制多一行 bug</h3>\n<p>代码在<a href="https://github.com/towavephone/gatsby-remark-code-buttons/commit/d95bb194d74182a3c5b8118102b3826695c2ff6d" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<p>src/gatsby-browser.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3926464099277127000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@@ -7,19 +7,9 @@ exports.onClientEntry = () => {\n    el.innerHTML = str;\n    document.body.appendChild(el);\n\n-   const range = document.createRange();\n-   range.selectNode(el);\n-   window.getSelection().removeAllRanges();\n-   window.getSelection().addRange(range);\n-   document.execCommand(\\`copy\\`);\n-   document.activeElement.blur();\n-   setTimeout(() => {\n-     document.getSelection().removeAllRanges();\n-     document.body.removeChild(el);\n-   }, 100);\n+   el.select();\n+   document.execCommand(&quot;copy&quot;);\n+   document.body.removeChild(el);\n    if (toasterId) {\n      window.showClipboardToaster(toasterId);\n    }`, `3926464099277127000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff">@@ -7,19 +7,9 @@ exports.onClientEntry = () => {\n<span class="token unchanged"><span class="token prefix unchanged"> </span>   el.innerHTML = str;\n<span class="token prefix unchanged"> </span>   document.body.appendChild(el);\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   const range = document.createRange();\n<span class="token prefix deleted">-</span>   range.selectNode(el);\n<span class="token prefix deleted">-</span>   window.getSelection().removeAllRanges();\n<span class="token prefix deleted">-</span>   window.getSelection().addRange(range);\n<span class="token prefix deleted">-</span>   document.execCommand(`copy`);\n<span class="token prefix deleted">-</span>   document.activeElement.blur();\n<span class="token prefix deleted">-</span>   setTimeout(() => {\n<span class="token prefix deleted">-</span>     document.getSelection().removeAllRanges();\n<span class="token prefix deleted">-</span>     document.body.removeChild(el);\n<span class="token prefix deleted">-</span>   }, 100);\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   el.select();\n<span class="token prefix inserted">+</span>   document.execCommand("copy");\n<span class="token prefix inserted">+</span>   document.body.removeChild(el);\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   if (toasterId) {\n<span class="token prefix unchanged"> </span>     window.showClipboardToaster(toasterId);\n<span class="token prefix unchanged"> </span>   }</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="增加显示语言类型的功能；改变按钮文本显示逻辑；任何语言都可以显示复制按钮"><a href="#%E5%A2%9E%E5%8A%A0%E6%98%BE%E7%A4%BA%E8%AF%AD%E8%A8%80%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%9B%E6%94%B9%E5%8F%98%E6%8C%89%E9%92%AE%E6%96%87%E6%9C%AC%E6%98%BE%E7%A4%BA%E9%80%BB%E8%BE%91%EF%BC%9B%E4%BB%BB%E4%BD%95%E8%AF%AD%E8%A8%80%E9%83%BD%E5%8F%AF%E4%BB%A5%E6%98%BE%E7%A4%BA%E5%A4%8D%E5%88%B6%E6%8C%89%E9%92%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>增加显示语言类型的功能；改变按钮文本显示逻辑；任何语言都可以显示复制按钮</h3>\n<p>主要针对原插件做出的一些 UI、功能上的适配，代码在<a href="https://github.com/towavephone/gatsby-remark-code-buttons/commit/90094cd1c6a4a6fa7253f61e898f8a832173d6a9" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<p>src/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70002068874308380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@@ -21,10 +21,6 @@ module.exports = function gatsbyRemarkCodeButtons(\n    const actions = qs.parse(params);\n    const { clipboard } = actions;\n\n-   if (!language) {\n-     return;\n-   }\n-\n    if (clipboard === \'false\') {\n      delete actions[\'clipboard\'];\n    } else {\n@@ -57,12 +53,12 @@ module.exports = function gatsbyRemarkCodeButtons(\n            >\n              <div\n                class=&quot;\\${buttonClass}&quot;\n-               data-tooltip=&quot;\\${tooltipText}&quot;\n+               \\${tooltipText ? \\`data-tooltip=&quot;\\${tooltipText}&quot;\\` : \'\'}\n              >\n-               \\${buttonText}\\${svgIcon}\n+               \\${[language, buttonText || svgIcon].filter((item) => item).join(\' \')}\n              </div>\n            </div>\n-           \\`.trim()\n+         \\`.trim()\n      };\n\n      parent.children.splice(index, 0, buttonNode);`, `70002068874308380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff">@@ -21,10 +21,6 @@ module.exports = function gatsbyRemarkCodeButtons(\n<span class="token unchanged"><span class="token prefix unchanged"> </span>   const actions = qs.parse(params);\n<span class="token prefix unchanged"> </span>   const { clipboard } = actions;\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   if (!language) {\n<span class="token prefix deleted">-</span>     return;\n<span class="token prefix deleted">-</span>   }\n<span class="token prefix deleted">-</span>\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   if (clipboard === \'false\') {\n<span class="token prefix unchanged"> </span>     delete actions[\'clipboard\'];\n<span class="token prefix unchanged"> </span>   } else {\n</span>@@ -57,12 +53,12 @@ module.exports = function gatsbyRemarkCodeButtons(\n<span class="token unchanged"><span class="token prefix unchanged"> </span>           >\n<span class="token prefix unchanged"> </span>             &lt;div\n<span class="token prefix unchanged"> </span>               class="${buttonClass}"\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>               data-tooltip="${tooltipText}"\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>               ${tooltipText ? `data-tooltip="${tooltipText}"` : \'\'}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>             >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>               ${buttonText}${svgIcon}\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>               ${[language, buttonText || svgIcon].filter((item) => item).join(\' \')}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>             &lt;/div>\n<span class="token prefix unchanged"> </span>           &lt;/div>\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>           `.trim()\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>         `.trim()\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     };\n</span>\n<span class="token unchanged"><span class="token prefix unchanged"> </span>     parent.children.splice(index, 0, buttonNode);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4858712853248592000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 测试代码复制功能，这个代码块应该具有复制代码功能`, `4858712853248592000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 测试代码复制功能，这个代码块应该具有复制代码功能</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="代码实时查看编辑-1"><a href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BC%96%E8%BE%91-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码实时查看编辑</h2>\n<p>代码在<a href="https://github.com/towavephone/gatsby-remark-embedded-codesandbox/commit/6a1947c22566c6ad5baae33dabf99edd16f4c8eb" target="_blank" rel="nofollow noreferrer noopener">这里</a></p>\n<h3 id="递归遍历文件夹；增加忽略文件功能"><a href="#%E9%80%92%E5%BD%92%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%9B%E5%A2%9E%E5%8A%A0%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>递归遍历文件夹；增加忽略文件功能</h3>\n<p>原插件不支持目录的读取，这里拓展了目录下也能递归读取的功能，同时也实现了默认忽略文件的功能</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91702241676345440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const DEFAULT_IGNORED_FILES = [\'node_modules\', \'package-lock.json\', \'yarn.lock\'];\n\nconst ignoredFilesSet = new Set(ignoredFiles);\n\nconst getAllFiles = (dirPath) =>\n   fs.readdirSync(dirPath).reduce((acc, file) => {\n      // 过滤文件立即跳出下一个\n      if (ignoredFilesSet.has(file)) return acc;\n      const relativePath = path.join(dirPath, file);\n      const isDirectory = fs.statSync(relativePath).isDirectory();\n      // 判断是目录继续递归遍历\n      const additions = isDirectory ? getAllFiles(relativePath) : [relativePath.replace(\\`\\${directory}/\\`, \'\')];\n      return [...acc, ...additions];\n   }, []);`, `91702241676345440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">DEFAULT_IGNORED_FILES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'node_modules\'</span><span class="token punctuation">,</span> <span class="token string">\'package-lock.json\'</span><span class="token punctuation">,</span> <span class="token string">\'yarn.lock\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> ignoredFilesSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>ignoredFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getAllFiles</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dirPath</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 过滤文件立即跳出下一个</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>ignoredFilesSet<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> acc<span class="token punctuation">;</span>\n      <span class="token keyword">const</span> relativePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirPath<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> isDirectory <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 判断是目录继续递归遍历</span>\n      <span class="token keyword">const</span> additions <span class="token operator">=</span> isDirectory <span class="token operator">?</span> <span class="token function">getAllFiles</span><span class="token punctuation">(</span>relativePath<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>relativePath<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>directory<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>acc<span class="token punctuation">,</span> <span class="token operator">...</span>additions<span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="默认模式为静态服务器"><a href="#%E9%BB%98%E8%AE%A4%E6%A8%A1%E5%BC%8F%E4%B8%BA%E9%9D%99%E6%80%81%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>默认模式为静态服务器</h3>\n<p>因为 codesandbox 需要明确模板类型，这里默认为静态模板，否则静态文件不能正常运行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25008194520045080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const getFileExist = (fileList, filename = \'package.json\') => {\n   const found = fileList.filter((name) => name === filename);\n   return found.length > null;\n};\n\nif (!getFileExist(folderFiles, \'sandbox.config.json\')) {\n   sandboxFiles.push({\n      name: \'sandbox.config.json\',\n      content: \'{ &quot;template&quot;: &quot;static&quot; }\'\n   });\n}`, `25008194520045080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> getFileExist <span class="token operator">=</span> <span class="token punctuation">(</span>fileList<span class="token punctuation">,</span> filename <span class="token operator">=</span> <span class="token string">\'package.json\'</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> found <span class="token operator">=</span> fileList<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> name <span class="token operator">===</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> found<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getFileExist</span><span class="token punctuation">(</span>folderFiles<span class="token punctuation">,</span> <span class="token string">\'sandbox.config.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   sandboxFiles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'sandbox.config.json\'</span><span class="token punctuation">,</span>\n      content<span class="token punctuation">:</span> <span class="token string">\'{ "template": "static" }\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="codesandbox-请求方式改为-post-异步化"><a href="#codesandbox-%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%E6%94%B9%E4%B8%BA-post-%E5%BC%82%E6%AD%A5%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>codesandbox 请求方式改为 post 异步化</h3>\n<p>原插件是基于 get 请求的，一旦上传文件过多就会报错，这里改为 post 请求就不再有请求体大小的限制，同时也要注意 post 的异步</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47725472764916120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const convertNodeToEmbedded = async (node, params, options = {}) => {\n   delete node.children;\n   delete node.position;\n   delete node.title;\n   delete node.url;\n\n   // merge the overriding options with the plugin one\n   const mergedOptions = { ...embedOptions, ...options };\n   const encodedEmbedOptions = queryString.stringify(mergedOptions);\n\n   const { sandbox_id } = await fetch(\'https://codesandbox.io/api/v1/sandboxes/define?json=1\', {\n      method: \'POST\',\n      headers: {\n         \'Content-Type\': \'application/json\',\n         Accept: \'application/json\'\n      },\n      body: params\n   }).then((x) => x.json());\n\n   const sandboxUrl = \\`https://codesandbox.io/embed/\\${sandbox_id}?\\${encodedEmbedOptions}\\`;\n   const embedded = getIframe(sandboxUrl);\n   node.type = \'html\';\n   node.value = embedded;\n\n   return node;\n};\n\nconst nodes = [];\nmap(markdownAST, (node, index, parent) => {\n   if (node.type === \'link\' && node.url.startsWith(protocol)) {\n      // split the url in base and query to allow user\n      // to customise embedding options on a per-node basis\n      const url = getUrlParts(node.url);\n      // get all files in the folder and generate\n      // the embeddeing parameters\n      const dir = getDirectoryPath(url.base);\n      const files = getFilesList(dir);\n      const params = createParams(files);\n      convertNodeToEmbedded(node, params, url.query);\n      const currentNode = convertNodeToEmbedded(node, params, url.query);\n      nodes.push(currentNode);\n   }\n\n   return node;\n});\n\n// 注意这里的异步化，必须等所有的请求成功响应才可继续遍历\nawait Promise.all(nodes);`, `47725472764916120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">convertNodeToEmbedded</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> params<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>position<span class="token punctuation">;</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>title<span class="token punctuation">;</span>\n   <span class="token keyword">delete</span> node<span class="token punctuation">.</span>url<span class="token punctuation">;</span>\n\n   <span class="token comment">// merge the overriding options with the plugin one</span>\n   <span class="token keyword">const</span> mergedOptions <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>embedOptions<span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> encodedEmbedOptions <span class="token operator">=</span> queryString<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>mergedOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> sandbox_id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">\'https://codesandbox.io/api/v1/sandboxes/define?json=1\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      method<span class="token punctuation">:</span> <span class="token string">\'POST\'</span><span class="token punctuation">,</span>\n      headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n         <span class="token string">\'Content-Type\'</span><span class="token punctuation">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n         Accept<span class="token punctuation">:</span> <span class="token string">\'application/json\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      body<span class="token punctuation">:</span> params\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> sandboxUrl <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://codesandbox.io/embed/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sandbox_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>encodedEmbedOptions<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> embedded <span class="token operator">=</span> <span class="token function">getIframe</span><span class="token punctuation">(</span>sandboxUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   node<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">\'html\'</span><span class="token punctuation">;</span>\n   node<span class="token punctuation">.</span>value <span class="token operator">=</span> embedded<span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> node<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token function">map</span><span class="token punctuation">(</span>markdownAST<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> index<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'link\'</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>protocol<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// split the url in base and query to allow user</span>\n      <span class="token comment">// to customise embedding options on a per-node basis</span>\n      <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">getUrlParts</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// get all files in the folder and generate</span>\n      <span class="token comment">// the embeddeing parameters</span>\n      <span class="token keyword">const</span> dir <span class="token operator">=</span> <span class="token function">getDirectoryPath</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token function">getFilesList</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token function">createParams</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">convertNodeToEmbedded</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> params<span class="token punctuation">,</span> url<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> currentNode <span class="token operator">=</span> <span class="token function">convertNodeToEmbedded</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> params<span class="token punctuation">,</span> url<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>currentNode<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   <span class="token keyword">return</span> node<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 注意这里的异步化，必须等所有的请求成功响应才可继续遍历</span>\n<span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="实现效果-1"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h3>\n<p><a href="/gantt-component-optimization/#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C">甘特图组件源码优化</a></p>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<ol>\n<li>复制功能需考虑兼容性、复制性能，可参考<a href="https://www.zhangxinxu.com/wordpress/2021/10/js-copy-paste-clipboard/" target="_blank" rel="nofollow noreferrer noopener">JS 复制文字到剪切板的极简实现及扩展</a></li>\n<li>代码实时查看编辑借助于第三方服务不够稳定，可自行搭建第三方服务或者参照 <a href="https://github.com/gfxfundamentals/live-editor" target="_blank" rel="nofollow noreferrer noopener">live-editor</a> 自建本地编辑器，必要时具有分享功能</li>\n</ol>\n<p>// TODO</p>\n<ol>\n<li>博客 sanbox 插件忽略文件实现，支持 post 上传文件</li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/博客 Gatsby 插件改造/index.md absPath of file >>> MarkdownRemark",timeToRead:7,frontmatter:{date:"2021-11-15 11:52:04",path:"/gatsby-plugin-transformation/",tags:"前端, 源码优化, 预研",title:"博客 Gatsby 插件改造",draft:null}},{excerpt:"需求背景 由于 PMS 项目需要开发如下图所示的甘特图，需要选择合适的组件来实现此功能 技术选型 选型 优点 缺点 gantt-schedule-timeline-calendar 功能丰富 与 UI 相差较大，定制化代码较多 react-timeline-gantt 功能丰富 与 UI 相差较大，定制化代码较多 gantt 与 UI 相差不大 在 react 使用需要封装；缺失左侧文字描述功能 gantt-for-react 与 UI 相差不大，可直接在 react…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于 PMS 项目需要开发如下图所示的甘特图，需要选择合适的组件来实现此功能</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-9c1be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 26.041666666666668%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAu0lEQVQY002Pa07DQAyEc/+LcQNQSwX8iBBKm0KJ7V2/cRJUdTS7Gln+1t5BRC/z/IudxSq3zu7pkaLKzKqad0UCYlNRs4iowuAeCwmQds3yQnj5Pt+WHxInyaUFcGC5O3Yjjiar99eGOsICgFYTM8+36/PbaZo/K/cO8/SqgmEt1sG1UZT3zn9Ytw1jUz6IJJ6O48v7gWFsHZCu5usv7m0rbGbF77BuWeuqqnuTJPYJ8jh+HT5O0OgR/gP6ZSPIPL6biwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="pms-example" title="" data-src="/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-fee1c.png" data-srcset="/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-a67b7.png 200w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-0b187.png 400w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-fee1c.png 800w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-b1a91.png 1200w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-9c1be.png 1440w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="技术选型"><a href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术选型</h1>\n<table>\n<thead>\n<tr>\n<th align="left">选型</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><a href="https://github.com/neuronetio/gantt-schedule-timeline-calendar" target="_blank" rel="nofollow noreferrer noopener">gantt-schedule-timeline-calendar</a></td>\n<td align="left">功能丰富</td>\n<td align="left">与 UI 相差较大，定制化代码较多</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/guiqui/react-timeline-gantt" target="_blank" rel="nofollow noreferrer noopener">react-timeline-gantt</a></td>\n<td align="left">功能丰富</td>\n<td align="left">与 UI 相差较大，定制化代码较多</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/frappe/gantt" target="_blank" rel="nofollow noreferrer noopener">gantt</a></td>\n<td align="left">与 UI 相差不大</td>\n<td align="left">在 react 使用需要封装；缺失左侧文字描述功能</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/hustcc/gantt-for-react" target="_blank" rel="nofollow noreferrer noopener">gantt-for-react</a></td>\n<td align="left">与 UI 相差不大，可直接在 react 中使用</td>\n<td align="left">缺失左侧文字描述功能</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/MaTeMaTuK/gantt-task-react" target="_blank" rel="nofollow noreferrer noopener">gantt-task-react</a></td>\n<td align="left">与 UI 最为接近</td>\n<td align="left">左侧文字展示功能较弱，只能展示固定的几个字段；关键样式没有暴露，不好做定制化</td>\n</tr>\n</tbody>\n</table>\n<h1 id="技术难点"><a href="#%E6%8A%80%E6%9C%AF%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术难点</h1>\n<p>需要针对 gantt-task-react 的源码做功能的增强：</p>\n<ol>\n<li>左侧文字展示功能增强</li>\n<li>样式属性暴露</li>\n</ol>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<p>所有代码在<a href="https://github.com/towavephone/gantt-task-react/commit/01ef13b7623e2f1bc2fe0b483093d4b84f5edb2f" target="_blank" rel="nofollow noreferrer noopener">这里</a>，这里只展示核心逻辑</p>\n<h2 id="左侧文字展示功能"><a href="#%E5%B7%A6%E4%BE%A7%E6%96%87%E5%AD%97%E5%B1%95%E7%A4%BA%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>左侧文字展示功能</h2>\n<p>左侧文字展示的功能和 antd 的列表渲染 API 一致</p>\n<h3 id="表头渲染"><a href="#%E8%A1%A8%E5%A4%B4%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>表头渲染</h3>\n<p>主要功能如下：</p>\n<ol>\n<li>表头的宽度</li>\n<li>标题渲染</li>\n</ol>\n<p>src/components/task-list/task-list-header.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31124831894145590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from &quot;react&quot;;\n+ import { ListColumn } from &quot;../../types/public-types&quot;;\nimport styles from &quot;./task-list-header.module.css&quot;;\n\nexport const TaskListHeaderDefault: React.FC<{\n  headerHeight: number;\n  rowWidth: string;\n  fontFamily: string;\n  fontSize: string;\n- }> = ({ headerHeight, fontFamily, fontSize, rowWidth }) => {\n+ listColumns: ListColumn[];\n+ }> = ({ headerHeight, fontFamily, fontSize, listColumns, rowWidth }) => {\n  return (\n    <div\n      className={styles.ganttTable}\n      style={{\n        fontFamily: fontFamily,\n        fontSize: fontSize,\n+       width: rowWidth,\n      }}\n    >\n      <div\n@@ -21,44 +24,17 @@ export const TaskListHeaderDefault: React.FC<{\n          height: headerHeight - 2,\n        }}\n      >\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;Name\n-       </div>\n-       <div\n-         className={styles.ganttTable_HeaderSeparator}\n-         style={{\n-           height: headerHeight * 0.5,\n-           marginTop: headerHeight * 0.2,\n-         }}\n-       />\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;From\n-       </div>\n-       <div\n-         className={styles.ganttTable_HeaderSeparator}\n-         style={{\n-           height: headerHeight * 0.5,\n-           marginTop: headerHeight * 0.25,\n-         }}\n-       />\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;To\n-       </div>\n+       {listColumns.map(item => (\n+         <div\n+           key={item.key || item.dataIndex}\n+           className={styles.ganttTable_HeaderItem}\n+           style={{\n+             width: item.width || &quot;auto&quot;,\n+           }}\n+         >\n+           {item.title}\n+         </div>\n+       ))}\n      </div>\n    </div>\n  );`, `31124831894145590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff">import React from "react";\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import { ListColumn } from "../../types/public-types";\n</span>import styles from "./task-list-header.module.css";\n\nexport const TaskListHeaderDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> headerHeight: number;\n<span class="token prefix unchanged"> </span> rowWidth: string;\n<span class="token prefix unchanged"> </span> fontFamily: string;\n<span class="token prefix unchanged"> </span> fontSize: string;\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> }> = ({ headerHeight, fontFamily, fontSize, rowWidth }) => {\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns: ListColumn[];\n<span class="token prefix inserted">+</span> }> = ({ headerHeight, fontFamily, fontSize, listColumns, rowWidth }) => {\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> return (\n<span class="token prefix unchanged"> </span>   &lt;div\n<span class="token prefix unchanged"> </span>     className={styles.ganttTable}\n<span class="token prefix unchanged"> </span>     style={{\n<span class="token prefix unchanged"> </span>       fontFamily: fontFamily,\n<span class="token prefix unchanged"> </span>       fontSize: fontSize,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       width: rowWidth,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     }}\n<span class="token prefix unchanged"> </span>   >\n<span class="token prefix unchanged"> </span>     &lt;div\n</span>@@ -21,44 +24,17 @@ export const TaskListHeaderDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span>         height: headerHeight - 2,\n<span class="token prefix unchanged"> </span>       }}\n<span class="token prefix unchanged"> </span>     >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;Name\n<span class="token prefix deleted">-</span>       &lt;/div>\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderSeparator}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           height: headerHeight * 0.5,\n<span class="token prefix deleted">-</span>           marginTop: headerHeight * 0.2,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       />\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;From\n<span class="token prefix deleted">-</span>       &lt;/div>\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderSeparator}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           height: headerHeight * 0.5,\n<span class="token prefix deleted">-</span>           marginTop: headerHeight * 0.25,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       />\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;To\n<span class="token prefix deleted">-</span>       &lt;/div>\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       {listColumns.map(item => (\n<span class="token prefix inserted">+</span>         &lt;div\n<span class="token prefix inserted">+</span>           key={item.key || item.dataIndex}\n<span class="token prefix inserted">+</span>           className={styles.ganttTable_HeaderItem}\n<span class="token prefix inserted">+</span>           style={{\n<span class="token prefix inserted">+</span>             width: item.width || "auto",\n<span class="token prefix inserted">+</span>           }}\n<span class="token prefix inserted">+</span>         >\n<span class="token prefix inserted">+</span>           {item.title}\n<span class="token prefix inserted">+</span>         &lt;/div>\n<span class="token prefix inserted">+</span>       ))}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     &lt;/div>\n<span class="token prefix unchanged"> </span>   &lt;/div>\n<span class="token prefix unchanged"> </span> );</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="列表内容渲染"><a href="#%E5%88%97%E8%A1%A8%E5%86%85%E5%AE%B9%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表内容渲染</h3>\n<p>主要功能如下：</p>\n<ol>\n<li>表格宽度</li>\n<li>列表内容渲染</li>\n<li>表格行、列单元格合并</li>\n<li>表格长标题过长时省略</li>\n</ol>\n<p>src/components/task-list/task-list-table.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54239180507085890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`- import React, { useMemo } from &quot;react&quot;;\n+ import React from &quot;react&quot;;\n+ import classnames from &quot;classnames&quot;;\n+\nimport styles from &quot;./task-list-table.module.css&quot;;\n- import { Task } from &quot;../../types/public-types&quot;;\n+ import { Task, ListColumn } from &quot;../../types/public-types&quot;;\n+ import { getPathValue } from &quot;../../helpers/other-helper&quot;;\n\n- const localeDateStringCache = {};\n- const toLocaleDateStringFactory = (locale: string) => (\n-   date: Date,\n-   dateTimeOptions: Intl.DateTimeFormatOptions\n- ) => {\n-   const key = date.toString();\n-   let lds = localeDateStringCache[key];\n-   if (!lds) {\n-     lds = date.toLocaleDateString(locale, dateTimeOptions);\n-     localeDateStringCache[key] = lds;\n-   }\n-   return lds;\n- };\n- const dateTimeOptions: Intl.DateTimeFormatOptions = {\n-   weekday: &quot;short&quot;,\n-   year: &quot;numeric&quot;,\n-   month: &quot;long&quot;,\n-   day: &quot;numeric&quot;,\n- };\n\n+ function isRenderCell(data: any) {\n+   return (\n+     data &&\n+     typeof data === &quot;object&quot; &&\n+     !Array.isArray(data) &&\n+     !React.isValidElement(data)\n+   );\n+ }\n\nexport const TaskListTableDefault: React.FC<{\n  rowHeight: number;\n@@ -32,84 +44,153 @@ export const TaskListTableDefault: React.FC<{\n  selectedTaskId: string;\n  setSelectedTask: (taskId: string) => void;\n  onExpanderClick: (task: Task) => void;\n+ listColumns: ListColumn[];\n}> = ({\n  rowHeight,\n  rowWidth,\n  tasks,\n  fontFamily,\n  fontSize,\n- locale,\n  onExpanderClick,\n+ listColumns,\n}) => {\n- const toLocaleDateString = useMemo(() => toLocaleDateStringFactory(locale), [\n-   locale,\n- ]);\n\n  return (\n-   <div\n+   <table\n      className={styles.taskListWrapper}\n      style={{\n        fontFamily: fontFamily,\n        fontSize: fontSize,\n+       width: rowWidth,\n      }}\n    >\n-     {tasks.map(t => {\n-       let expanderSymbol = &quot;&quot;;\n-       if (t.hideChildren === false) {\n-         expanderSymbol = &quot;▼&quot;;\n-       } else if (t.hideChildren === true) {\n-         expanderSymbol = &quot;▶&quot;;\n-       }\n+     <tbody>\n+       {tasks.map((t, index) => {\n+         let expanderSymbol = &quot;&quot;;\n+         if (t.hideChildren === false) {\n+           expanderSymbol = &quot;▼&quot;;\n+         } else if (t.hideChildren === true) {\n+           expanderSymbol = &quot;▶&quot;;\n+         }\n\n-       return (\n-         <div\n-           className={styles.taskListTableRow}\n-           style={{ height: rowHeight }}\n-           key={\\`\\${t.id}row\\`}\n-         >\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-             title={t.name}\n+         return (\n+           <tr\n+             className={styles.taskListTableRow}\n+             style={{ height: rowHeight }}\n+             key={\\`\\${t.id}row\\`}\n            >\n-             <div className={styles.taskListNameWrapper}>\n-               <div\n-                 className={\n-                   expanderSymbol\n-                     ? styles.taskListExpander\n-                     : styles.taskListEmptyExpander\n+             {listColumns.map(item => {\n+               let childNode: any;\n+               let cellProps;\n+               if (item.children) {\n+                 childNode = item.children;\n+               } else {\n+                 const value = getPathValue(t, item.dataIndex);\n+                 childNode = value;\n+                 if (item.render) {\n+                   const renderData = item.render(value, t, index);\n+                   if (isRenderCell(renderData)) {\n+                     childNode = renderData.children;\n+                     cellProps = renderData.props;\n+                   } else {\n+                     childNode = renderData;\n+                   }\n                  }\n-                 onClick={() => onExpanderClick(t)}\n-               >\n-                 {expanderSymbol}\n-               </div>\n-               <div>{t.name}</div>\n-             </div>\n-           </div>\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-           >\n-             &nbsp;{toLocaleDateString(t.start, dateTimeOptions)}\n-           </div>\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-           >\n-             &nbsp;{toLocaleDateString(t.end, dateTimeOptions)}\n-           </div>\n-         </div>\n-       );\n-     })}\n-   </div>\n+               }\n+               if (\n+                 typeof childNode === &quot;object&quot; &&\n+                 !Array.isArray(childNode) &&\n+                 !React.isValidElement(childNode)\n+               ) {\n+                 childNode = null;\n+               }\n+               const { colSpan: cellColSpan, rowSpan: cellRowSpan } =\n+                 cellProps || {};\n+               const mergedColSpan =\n+                 cellColSpan !== undefined ? cellColSpan : item.colSpan;\n+               const mergedRowSpan =\n+                 cellRowSpan !== undefined ? cellRowSpan : item.rowSpan;\n+               if (mergedColSpan === 0 || mergedRowSpan === 0) {\n+                 return null;\n+               }\n+               let title;\n+               const ellipsisConfig =\n+                 item.ellipsis === true\n+                   ? {\n+                       showTitle: true,\n+                     }\n+                   : item.ellipsis;\n+               if (ellipsisConfig && ellipsisConfig.showTitle) {\n+                 if (\n+                   typeof childNode === &quot;string&quot; ||\n+                   typeof childNode === &quot;number&quot;\n+                 ) {\n+                   title = childNode.toString();\n+                 } else if (\n+                   React.isValidElement(childNode) &&\n+                   // @ts-ignore\n+                   typeof childNode.props.children === &quot;string&quot;\n+                 ) {\n+                   // @ts-ignore\n+                   title = childNode.props.children;\n+                 }\n+               }\n+               return (\n+                 <td\n+                   key={item.key || item.dataIndex}\n+                   className={classnames(\n+                     styles.taskListCell,\n+                     item.ellipsis ? styles.ellipsis : &quot;&quot;\n+                   )}\n+                   style={{\n+                     width: item.width || &quot;auto&quot;,\n+                   }}\n+                   colSpan={\n+                     mergedColSpan && mergedColSpan !== 1\n+                       ? mergedColSpan\n+                       : null\n+                   }\n+                   rowSpan={\n+                     mergedRowSpan && mergedRowSpan !== 1\n+                       ? mergedRowSpan\n+                       : null\n+                   }\n+                 >\n+                   <div className={styles.taskListNameWrapper}>\n+                     <div\n+                       className={\n+                         expanderSymbol\n+                           ? styles.taskListExpander\n+                           : styles.taskListEmptyExpander\n+                       }\n+                       onClick={() => onExpanderClick(t)}\n+                     >\n+                       {expanderSymbol}\n+                     </div>\n+                     <div title={title} className={styles.ellipsis}>\n+                       {childNode}\n+                     </div>\n+                   </div>\n+                 </td>\n+               );\n+             })}\n+           </tr>\n+         );\n+       })}\n+     </tbody>\n+   </table>\n  );\n};`, `54239180507085890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> import React, { useMemo } from "react";\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import React from "react";\n<span class="token prefix inserted">+</span> import classnames from "classnames";\n<span class="token prefix inserted">+</span>\n</span>import styles from "./task-list-table.module.css";\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> import { Task } from "../../types/public-types";\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import { Task, ListColumn } from "../../types/public-types";\n<span class="token prefix inserted">+</span> import { getPathValue } from "../../helpers/other-helper";\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> const localeDateStringCache = {};\n<span class="token prefix deleted">-</span> const toLocaleDateStringFactory = (locale: string) => (\n<span class="token prefix deleted">-</span>   date: Date,\n<span class="token prefix deleted">-</span>   dateTimeOptions: Intl.DateTimeFormatOptions\n<span class="token prefix deleted">-</span> ) => {\n<span class="token prefix deleted">-</span>   const key = date.toString();\n<span class="token prefix deleted">-</span>   let lds = localeDateStringCache[key];\n<span class="token prefix deleted">-</span>   if (!lds) {\n<span class="token prefix deleted">-</span>     lds = date.toLocaleDateString(locale, dateTimeOptions);\n<span class="token prefix deleted">-</span>     localeDateStringCache[key] = lds;\n<span class="token prefix deleted">-</span>   }\n<span class="token prefix deleted">-</span>   return lds;\n<span class="token prefix deleted">-</span> };\n<span class="token prefix deleted">-</span> const dateTimeOptions: Intl.DateTimeFormatOptions = {\n<span class="token prefix deleted">-</span>   weekday: "short",\n<span class="token prefix deleted">-</span>   year: "numeric",\n<span class="token prefix deleted">-</span>   month: "long",\n<span class="token prefix deleted">-</span>   day: "numeric",\n<span class="token prefix deleted">-</span> };\n</span>\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> function isRenderCell(data: any) {\n<span class="token prefix inserted">+</span>   return (\n<span class="token prefix inserted">+</span>     data &amp;&amp;\n<span class="token prefix inserted">+</span>     typeof data === "object" &amp;&amp;\n<span class="token prefix inserted">+</span>     !Array.isArray(data) &amp;&amp;\n<span class="token prefix inserted">+</span>     !React.isValidElement(data)\n<span class="token prefix inserted">+</span>   );\n<span class="token prefix inserted">+</span> }\n</span>\nexport const TaskListTableDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> rowHeight: number;\n</span>@@ -32,84 +44,153 @@ export const TaskListTableDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> selectedTaskId: string;\n<span class="token prefix unchanged"> </span> setSelectedTask: (taskId: string) => void;\n<span class="token prefix unchanged"> </span> onExpanderClick: (task: Task) => void;\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns: ListColumn[];\n</span>}> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> rowHeight,\n<span class="token prefix unchanged"> </span> rowWidth,\n<span class="token prefix unchanged"> </span> tasks,\n<span class="token prefix unchanged"> </span> fontFamily,\n<span class="token prefix unchanged"> </span> fontSize,\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> locale,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> onExpanderClick,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns,\n</span>}) => {\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> const toLocaleDateString = useMemo(() => toLocaleDateStringFactory(locale), [\n<span class="token prefix deleted">-</span>   locale,\n<span class="token prefix deleted">-</span> ]);\n</span>\n<span class="token unchanged"><span class="token prefix unchanged"> </span> return (\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   &lt;div\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   &lt;table\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     className={styles.taskListWrapper}\n<span class="token prefix unchanged"> </span>     style={{\n<span class="token prefix unchanged"> </span>       fontFamily: fontFamily,\n<span class="token prefix unchanged"> </span>       fontSize: fontSize,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       width: rowWidth,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     }}\n<span class="token prefix unchanged"> </span>   >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>     {tasks.map(t => {\n<span class="token prefix deleted">-</span>       let expanderSymbol = "";\n<span class="token prefix deleted">-</span>       if (t.hideChildren === false) {\n<span class="token prefix deleted">-</span>         expanderSymbol = "▼";\n<span class="token prefix deleted">-</span>       } else if (t.hideChildren === true) {\n<span class="token prefix deleted">-</span>         expanderSymbol = "▶";\n<span class="token prefix deleted">-</span>       }\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>     &lt;tbody>\n<span class="token prefix inserted">+</span>       {tasks.map((t, index) => {\n<span class="token prefix inserted">+</span>         let expanderSymbol = "";\n<span class="token prefix inserted">+</span>         if (t.hideChildren === false) {\n<span class="token prefix inserted">+</span>           expanderSymbol = "▼";\n<span class="token prefix inserted">+</span>         } else if (t.hideChildren === true) {\n<span class="token prefix inserted">+</span>           expanderSymbol = "▶";\n<span class="token prefix inserted">+</span>         }\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>       return (\n<span class="token prefix deleted">-</span>         &lt;div\n<span class="token prefix deleted">-</span>           className={styles.taskListTableRow}\n<span class="token prefix deleted">-</span>           style={{ height: rowHeight }}\n<span class="token prefix deleted">-</span>           key={`${t.id}row`}\n<span class="token prefix deleted">-</span>         >\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>             title={t.name}\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>         return (\n<span class="token prefix inserted">+</span>           &lt;tr\n<span class="token prefix inserted">+</span>             className={styles.taskListTableRow}\n<span class="token prefix inserted">+</span>             style={{ height: rowHeight }}\n<span class="token prefix inserted">+</span>             key={`${t.id}row`}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>           >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>             &lt;div className={styles.taskListNameWrapper}>\n<span class="token prefix deleted">-</span>               &lt;div\n<span class="token prefix deleted">-</span>                 className={\n<span class="token prefix deleted">-</span>                   expanderSymbol\n<span class="token prefix deleted">-</span>                     ? styles.taskListExpander\n<span class="token prefix deleted">-</span>                     : styles.taskListEmptyExpander\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>             {listColumns.map(item => {\n<span class="token prefix inserted">+</span>               let childNode: any;\n<span class="token prefix inserted">+</span>               let cellProps;\n<span class="token prefix inserted">+</span>               if (item.children) {\n<span class="token prefix inserted">+</span>                 childNode = item.children;\n<span class="token prefix inserted">+</span>               } else {\n<span class="token prefix inserted">+</span>                 const value = getPathValue(t, item.dataIndex);\n<span class="token prefix inserted">+</span>                 childNode = value;\n<span class="token prefix inserted">+</span>                 if (item.render) {\n<span class="token prefix inserted">+</span>                   const renderData = item.render(value, t, index);\n<span class="token prefix inserted">+</span>                   if (isRenderCell(renderData)) {\n<span class="token prefix inserted">+</span>                     childNode = renderData.children;\n<span class="token prefix inserted">+</span>                     cellProps = renderData.props;\n<span class="token prefix inserted">+</span>                   } else {\n<span class="token prefix inserted">+</span>                     childNode = renderData;\n<span class="token prefix inserted">+</span>                   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>                 }\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>                 onClick={() => onExpanderClick(t)}\n<span class="token prefix deleted">-</span>               >\n<span class="token prefix deleted">-</span>                 {expanderSymbol}\n<span class="token prefix deleted">-</span>               &lt;/div>\n<span class="token prefix deleted">-</span>               &lt;div>{t.name}&lt;/div>\n<span class="token prefix deleted">-</span>             &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>           >\n<span class="token prefix deleted">-</span>             &amp;nbsp;{toLocaleDateString(t.start, dateTimeOptions)}\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>           >\n<span class="token prefix deleted">-</span>             &amp;nbsp;{toLocaleDateString(t.end, dateTimeOptions)}\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>         &lt;/div>\n<span class="token prefix deleted">-</span>       );\n<span class="token prefix deleted">-</span>     })}\n<span class="token prefix deleted">-</span>   &lt;/div>\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               if (\n<span class="token prefix inserted">+</span>                 typeof childNode === "object" &amp;&amp;\n<span class="token prefix inserted">+</span>                 !Array.isArray(childNode) &amp;&amp;\n<span class="token prefix inserted">+</span>                 !React.isValidElement(childNode)\n<span class="token prefix inserted">+</span>               ) {\n<span class="token prefix inserted">+</span>                 childNode = null;\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               const { colSpan: cellColSpan, rowSpan: cellRowSpan } =\n<span class="token prefix inserted">+</span>                 cellProps || {};\n<span class="token prefix inserted">+</span>               const mergedColSpan =\n<span class="token prefix inserted">+</span>                 cellColSpan !== undefined ? cellColSpan : item.colSpan;\n<span class="token prefix inserted">+</span>               const mergedRowSpan =\n<span class="token prefix inserted">+</span>                 cellRowSpan !== undefined ? cellRowSpan : item.rowSpan;\n<span class="token prefix inserted">+</span>               if (mergedColSpan === 0 || mergedRowSpan === 0) {\n<span class="token prefix inserted">+</span>                 return null;\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               let title;\n<span class="token prefix inserted">+</span>               const ellipsisConfig =\n<span class="token prefix inserted">+</span>                 item.ellipsis === true\n<span class="token prefix inserted">+</span>                   ? {\n<span class="token prefix inserted">+</span>                       showTitle: true,\n<span class="token prefix inserted">+</span>                     }\n<span class="token prefix inserted">+</span>                   : item.ellipsis;\n<span class="token prefix inserted">+</span>               if (ellipsisConfig &amp;&amp; ellipsisConfig.showTitle) {\n<span class="token prefix inserted">+</span>                 if (\n<span class="token prefix inserted">+</span>                   typeof childNode === "string" ||\n<span class="token prefix inserted">+</span>                   typeof childNode === "number"\n<span class="token prefix inserted">+</span>                 ) {\n<span class="token prefix inserted">+</span>                   title = childNode.toString();\n<span class="token prefix inserted">+</span>                 } else if (\n<span class="token prefix inserted">+</span>                   React.isValidElement(childNode) &amp;&amp;\n<span class="token prefix inserted">+</span>                   // @ts-ignore\n<span class="token prefix inserted">+</span>                   typeof childNode.props.children === "string"\n<span class="token prefix inserted">+</span>                 ) {\n<span class="token prefix inserted">+</span>                   // @ts-ignore\n<span class="token prefix inserted">+</span>                   title = childNode.props.children;\n<span class="token prefix inserted">+</span>                 }\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               return (\n<span class="token prefix inserted">+</span>                 &lt;td\n<span class="token prefix inserted">+</span>                   key={item.key || item.dataIndex}\n<span class="token prefix inserted">+</span>                   className={classnames(\n<span class="token prefix inserted">+</span>                     styles.taskListCell,\n<span class="token prefix inserted">+</span>                     item.ellipsis ? styles.ellipsis : ""\n<span class="token prefix inserted">+</span>                   )}\n<span class="token prefix inserted">+</span>                   style={{\n<span class="token prefix inserted">+</span>                     width: item.width || "auto",\n<span class="token prefix inserted">+</span>                   }}\n<span class="token prefix inserted">+</span>                   colSpan={\n<span class="token prefix inserted">+</span>                     mergedColSpan &amp;&amp; mergedColSpan !== 1\n<span class="token prefix inserted">+</span>                       ? mergedColSpan\n<span class="token prefix inserted">+</span>                       : null\n<span class="token prefix inserted">+</span>                   }\n<span class="token prefix inserted">+</span>                   rowSpan={\n<span class="token prefix inserted">+</span>                     mergedRowSpan &amp;&amp; mergedRowSpan !== 1\n<span class="token prefix inserted">+</span>                       ? mergedRowSpan\n<span class="token prefix inserted">+</span>                       : null\n<span class="token prefix inserted">+</span>                   }\n<span class="token prefix inserted">+</span>                 >\n<span class="token prefix inserted">+</span>                   &lt;div className={styles.taskListNameWrapper}>\n<span class="token prefix inserted">+</span>                     &lt;div\n<span class="token prefix inserted">+</span>                       className={\n<span class="token prefix inserted">+</span>                         expanderSymbol\n<span class="token prefix inserted">+</span>                           ? styles.taskListExpander\n<span class="token prefix inserted">+</span>                           : styles.taskListEmptyExpander\n<span class="token prefix inserted">+</span>                       }\n<span class="token prefix inserted">+</span>                       onClick={() => onExpanderClick(t)}\n<span class="token prefix inserted">+</span>                     >\n<span class="token prefix inserted">+</span>                       {expanderSymbol}\n<span class="token prefix inserted">+</span>                     &lt;/div>\n<span class="token prefix inserted">+</span>                     &lt;div title={title} className={styles.ellipsis}>\n<span class="token prefix inserted">+</span>                       {childNode}\n<span class="token prefix inserted">+</span>                     &lt;/div>\n<span class="token prefix inserted">+</span>                   &lt;/div>\n<span class="token prefix inserted">+</span>                 &lt;/td>\n<span class="token prefix inserted">+</span>               );\n<span class="token prefix inserted">+</span>             })}\n<span class="token prefix inserted">+</span>           &lt;/tr>\n<span class="token prefix inserted">+</span>         );\n<span class="token prefix inserted">+</span>       })}\n<span class="token prefix inserted">+</span>     &lt;/tbody>\n<span class="token prefix inserted">+</span>   &lt;/table>\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> );\n</span>};</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="样式属性暴露"><a href="#%E6%A0%B7%E5%BC%8F%E5%B1%9E%E6%80%A7%E6%9A%B4%E9%9C%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>样式属性暴露</h2>\n<p>主要功能如下：</p>\n<ol>\n<li>行级斑马线显示</li>\n<li>日期分隔线显示</li>\n<li>行级分隔线显示</li>\n</ol>\n<p>src/components/grid/grid-body.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68674334598012084000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  columnWidth: number;\n  todayColor: string;\n  rtl: boolean;\n+  hasCrosswalk: boolean;\n+  hasDateLine: boolean;\n+  renderRowLines: (index: number) => boolean;\n};\n+\nexport const GridBody: React.FC<GridBodyProps> = ({\n  tasks,\n  dates,\n@@ -20,6 +24,9 @@ export const GridBody: React.FC<GridBodyProps> = ({\n  columnWidth,\n  todayColor,\n  rtl,\n+ hasCrosswalk,\n+ hasDateLine,\n+ renderRowLines,\n}) => {\n  let y = 0;\n  const gridRows: ReactChild[] = [];\n@@ -33,27 +40,33 @@ export const GridBody: React.FC<GridBodyProps> = ({\n      className={styles.gridRowLine}\n    />,\n  ];\n- for (const task of tasks) {\n-   gridRows.push(\n-     <rect\n-       key={&quot;Row&quot; + task.id}\n-       x=&quot;0&quot;\n-       y={y}\n-       width={svgWidth}\n-       height={rowHeight}\n-       className={styles.gridRow}\n-     />\n-   );\n-   rowLines.push(\n-     <line\n-       key={&quot;RowLine&quot; + task.id}\n-       x=&quot;0&quot;\n-       y1={y + rowHeight}\n-       x2={svgWidth}\n-       y2={y + rowHeight}\n-       className={styles.gridRowLine}\n-     />\n-   );\n+ for (let i = 0; i < tasks.length; i++) {\n+   const task = tasks[i];\n+   if (hasCrosswalk) {\n+     gridRows.push(\n+       <rect\n+         key={&quot;Row&quot; + task.id}\n+         x=&quot;0&quot;\n+         y={y}\n+         width={svgWidth}\n+         height={rowHeight}\n+         className={styles.gridRow}\n+       />\n+     );\n+   }\n+   const isRenderRowLines = renderRowLines(i);\n+   if (isRenderRowLines) {\n+     rowLines.push(\n+       <line\n+         key={&quot;RowLine&quot; + task.id}\n+         x=&quot;0&quot;\n+         y1={y + rowHeight}\n+         x2={svgWidth}\n+         y2={y + rowHeight}\n+         className={styles.gridRowLine}\n+       />\n+     );\n+   }\n    y += rowHeight;\n  }\n\n@@ -63,16 +76,18 @@ export const GridBody: React.FC<GridBodyProps> = ({\n  let today: ReactChild = <rect />;\n  for (let i = 0; i < dates.length; i++) {\n    const date = dates[i];\n-   ticks.push(\n-     <line\n-       key={date.getTime()}\n-       x1={tickX}\n-       y1={0}\n-       x2={tickX}\n-       y2={y}\n-       className={styles.gridTick}\n-     />\n-   );\n+   if (hasDateLine) {\n+     ticks.push(\n+       <line\n+         key={date.getTime()}\n+         x1={tickX}\n+         y1={0}\n+         x2={tickX}\n+         y2={y}\n+         className={styles.gridTick}\n+       />\n+     );\n+   }\n    if (\n      (i + 1 !== dates.length &&\n        date.getTime() < now.getTime() &&`, `68674334598012084000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span> columnWidth: number;\n<span class="token prefix unchanged"> </span> todayColor: string;\n<span class="token prefix unchanged"> </span> rtl: boolean;\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>  hasCrosswalk: boolean;\n<span class="token prefix inserted">+</span>  hasDateLine: boolean;\n<span class="token prefix inserted">+</span>  renderRowLines: (index: number) => boolean;\n</span>};\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>\n</span>export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> tasks,\n<span class="token prefix unchanged"> </span> dates,\n</span>@@ -20,6 +24,9 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> columnWidth,\n<span class="token prefix unchanged"> </span> todayColor,\n<span class="token prefix unchanged"> </span> rtl,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> hasCrosswalk,\n<span class="token prefix inserted">+</span> hasDateLine,\n<span class="token prefix inserted">+</span> renderRowLines,\n</span>}) => {\n<span class="token unchanged"><span class="token prefix unchanged"> </span> let y = 0;\n<span class="token prefix unchanged"> </span> const gridRows: ReactChild[] = [];\n</span>@@ -33,27 +40,33 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span>     className={styles.gridRowLine}\n<span class="token prefix unchanged"> </span>   />,\n<span class="token prefix unchanged"> </span> ];\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> for (const task of tasks) {\n<span class="token prefix deleted">-</span>   gridRows.push(\n<span class="token prefix deleted">-</span>     &lt;rect\n<span class="token prefix deleted">-</span>       key={"Row" + task.id}\n<span class="token prefix deleted">-</span>       x="0"\n<span class="token prefix deleted">-</span>       y={y}\n<span class="token prefix deleted">-</span>       width={svgWidth}\n<span class="token prefix deleted">-</span>       height={rowHeight}\n<span class="token prefix deleted">-</span>       className={styles.gridRow}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n<span class="token prefix deleted">-</span>   rowLines.push(\n<span class="token prefix deleted">-</span>     &lt;line\n<span class="token prefix deleted">-</span>       key={"RowLine" + task.id}\n<span class="token prefix deleted">-</span>       x="0"\n<span class="token prefix deleted">-</span>       y1={y + rowHeight}\n<span class="token prefix deleted">-</span>       x2={svgWidth}\n<span class="token prefix deleted">-</span>       y2={y + rowHeight}\n<span class="token prefix deleted">-</span>       className={styles.gridRowLine}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> for (let i = 0; i &lt; tasks.length; i++) {\n<span class="token prefix inserted">+</span>   const task = tasks[i];\n<span class="token prefix inserted">+</span>   if (hasCrosswalk) {\n<span class="token prefix inserted">+</span>     gridRows.push(\n<span class="token prefix inserted">+</span>       &lt;rect\n<span class="token prefix inserted">+</span>         key={"Row" + task.id}\n<span class="token prefix inserted">+</span>         x="0"\n<span class="token prefix inserted">+</span>         y={y}\n<span class="token prefix inserted">+</span>         width={svgWidth}\n<span class="token prefix inserted">+</span>         height={rowHeight}\n<span class="token prefix inserted">+</span>         className={styles.gridRow}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n<span class="token prefix inserted">+</span>   const isRenderRowLines = renderRowLines(i);\n<span class="token prefix inserted">+</span>   if (isRenderRowLines) {\n<span class="token prefix inserted">+</span>     rowLines.push(\n<span class="token prefix inserted">+</span>       &lt;line\n<span class="token prefix inserted">+</span>         key={"RowLine" + task.id}\n<span class="token prefix inserted">+</span>         x="0"\n<span class="token prefix inserted">+</span>         y1={y + rowHeight}\n<span class="token prefix inserted">+</span>         x2={svgWidth}\n<span class="token prefix inserted">+</span>         y2={y + rowHeight}\n<span class="token prefix inserted">+</span>         className={styles.gridRowLine}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   y += rowHeight;\n<span class="token prefix unchanged"> </span> }\n</span>\n@@ -63,16 +76,18 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> let today: ReactChild = &lt;rect />;\n<span class="token prefix unchanged"> </span> for (let i = 0; i &lt; dates.length; i++) {\n<span class="token prefix unchanged"> </span>   const date = dates[i];\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   ticks.push(\n<span class="token prefix deleted">-</span>     &lt;line\n<span class="token prefix deleted">-</span>       key={date.getTime()}\n<span class="token prefix deleted">-</span>       x1={tickX}\n<span class="token prefix deleted">-</span>       y1={0}\n<span class="token prefix deleted">-</span>       x2={tickX}\n<span class="token prefix deleted">-</span>       y2={y}\n<span class="token prefix deleted">-</span>       className={styles.gridTick}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   if (hasDateLine) {\n<span class="token prefix inserted">+</span>     ticks.push(\n<span class="token prefix inserted">+</span>       &lt;line\n<span class="token prefix inserted">+</span>         key={date.getTime()}\n<span class="token prefix inserted">+</span>         x1={tickX}\n<span class="token prefix inserted">+</span>         y1={0}\n<span class="token prefix inserted">+</span>         x2={tickX}\n<span class="token prefix inserted">+</span>         y2={y}\n<span class="token prefix inserted">+</span>         className={styles.gridTick}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   if (\n<span class="token prefix unchanged"> </span>     (i + 1 !== dates.length &amp;&amp;\n<span class="token prefix unchanged"> </span>       date.getTime() &lt; now.getTime() &amp;&amp;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h1>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vtuj8t?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<ol>\n<li>ts 写的不够熟练且精简，需要加强</li>\n<li>对于样式属性暴露应该用固定类名去控制，原作者包含很多的 className 属性，非常冗余</li>\n<li>本地源码优化很少涉及到 svg 的优化，需要加强 svg 的学习</li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/甘特图组件源码优化/index.md absPath of file >>> MarkdownRemark",timeToRead:8,frontmatter:{date:"2021-11-15 11:48:33",path:"/gantt-component-optimization/",tags:"前端, 源码优化, 预研",title:"甘特图组件源码优化",draft:null}},{excerpt:"需求背景 由于 C 端营销线新建项目需要模板化，需要代码模板的生成功能，以便统一技术栈 一期 一期代码生成需要在 lerna 工程下去做改造，除了带有代码模板的功能，还封装了执行脚本的入口 参考链接： react-boilerplate 这里的代码模板包含项目级别的代码模板、页面级别的代码模板，目前只完成了项目的代码模板生成 目录结构 脚本主入口 package.json 模板代码生成 模板代码执行主入口 internals/generators/index.js 检测 packages…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于 C 端营销线新建项目需要模板化，需要代码模板的生成功能，以便统一技术栈</p>\n<h1 id="一期"><a href="#%E4%B8%80%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一期</h1>\n<p>一期代码生成需要在 lerna 工程下去做改造，除了带有代码模板的功能，还封装了执行脚本的入口</p>\n<p>参考链接：<a href="https://github.com/react-boilerplate/react-boilerplate" target="_blank" rel="nofollow noreferrer noopener">react-boilerplate</a></p>\n<blockquote>\n<p>这里的代码模板包含项目级别的代码模板、页面级别的代码模板，目前只完成了项目的代码模板生成</p>\n</blockquote>\n<h2 id="目录结构"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26130991147791405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── index.html\n├── internals\n│   ├── generators\n│   │   ├── index.js // 模板代码执行主入口\n│   │   ├── package // 模板文件夹，带有模板变量的文件后缀名为 hbs\n│   │   │   ├── config.js.hbs\n│   │   │   ├── index.js // 项目级别的代码模板命令执行入口\n│   │   │   ├── package-lock.json.hbs\n│   │   │   ├── package.json.hbs // 带模板变量的模板文件\n│   │   │   └── template // 不带模板变量的模板文件\n│   │   ├── page\n│   │   │   └── index.js // 页面级别的代码模板命令执行入口\n│   │   └── utils\n│   │       ├── directoryExists.js // 检测 packages 文件夹存在性\n│   │       └── fileKeyExists.js // 检测 packages 下面文件里面某种属性是否存在，主要为了实现端口占用检测功能\n│   └── scripts\n│       ├── helpers\n│       │   └── argv.js // 命令行参数封装\n│       └── run.js // 脚本执行主入口\n├── packages // 项目源代码，即代码模板生成后的结果文件夹\n|   ├── demo1\n│   └── demo2\n├── lerna.json\n├── package-lock.json\n├── package.json // 命令主入口\n└── readme.md`, `26130991147791405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">.</span>\n├── index<span class="token punctuation">.</span>html\n├── internals\n│   ├── generators\n│   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 模板代码执行主入口</span>\n│   │   ├── <span class="token keyword">package</span> <span class="token comment">// 模板文件夹，带有模板变量的文件后缀名为 hbs</span>\n│   │   │   ├── config<span class="token punctuation">.</span>js<span class="token punctuation">.</span>hbs\n│   │   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 项目级别的代码模板命令执行入口</span>\n│   │   │   ├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   ├── <span class="token keyword">package</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs <span class="token comment">// 带模板变量的模板文件</span>\n│   │   │   └── template <span class="token comment">// 不带模板变量的模板文件</span>\n│   │   ├── page\n│   │   │   └── index<span class="token punctuation">.</span>js <span class="token comment">// 页面级别的代码模板命令执行入口</span>\n│   │   └── utils\n│   │       ├── directoryExists<span class="token punctuation">.</span>js <span class="token comment">// 检测 packages 文件夹存在性</span>\n│   │       └── fileKeyExists<span class="token punctuation">.</span>js <span class="token comment">// 检测 packages 下面文件里面某种属性是否存在，主要为了实现端口占用检测功能</span>\n│   └── scripts\n│       ├── helpers\n│       │   └── argv<span class="token punctuation">.</span>js <span class="token comment">// 命令行参数封装</span>\n│       └── run<span class="token punctuation">.</span>js <span class="token comment">// 脚本执行主入口</span>\n├── packages <span class="token comment">// 项目源代码，即代码模板生成后的结果文件夹</span>\n<span class="token operator">|</span>   ├── demo1\n│   └── demo2\n├── lerna<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token punctuation">.</span>json <span class="token comment">// 命令主入口</span>\n└── readme<span class="token punctuation">.</span>md</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="脚本主入口"><a href="#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本主入口</h2>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68097916930228990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;name&quot;: &quot;root&quot;,\n   &quot;private&quot;: true,\n   &quot;devDependencies&quot;: {\n      &quot;cross-env&quot;: &quot;^7.0.3&quot;,\n      &quot;lerna&quot;: &quot;^4.0.0&quot;,\n      &quot;minimist&quot;: &quot;^1.2.5&quot;,\n      &quot;plop&quot;: &quot;^2.7.4&quot;,\n      &quot;shelljs&quot;: &quot;^0.8.4&quot;\n   },\n   &quot;scripts&quot;: {\n      &quot;postinstall&quot;: &quot;lerna bootstrap&quot;,\n      &quot;start&quot;: &quot;node internals/scripts/run --cmd=start&quot;,\n      &quot;build&quot;: &quot;node internals/scripts/run --cmd=build&quot;,\n      &quot;generate&quot;: &quot;plop --plopfile internals/generators/index.js&quot;\n   }\n}`, `68097916930228990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>\n   <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"cross-env"</span><span class="token operator">:</span> <span class="token string">"^7.0.3"</span><span class="token punctuation">,</span>\n      <span class="token property">"lerna"</span><span class="token operator">:</span> <span class="token string">"^4.0.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token string">"^1.2.5"</span><span class="token punctuation">,</span>\n      <span class="token property">"plop"</span><span class="token operator">:</span> <span class="token string">"^2.7.4"</span><span class="token punctuation">,</span>\n      <span class="token property">"shelljs"</span><span class="token operator">:</span> <span class="token string">"^0.8.4"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"postinstall"</span><span class="token operator">:</span> <span class="token string">"lerna bootstrap"</span><span class="token punctuation">,</span>\n      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=start"</span><span class="token punctuation">,</span>\n      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=build"</span><span class="token punctuation">,</span>\n      <span class="token property">"generate"</span><span class="token operator">:</span> <span class="token string">"plop --plopfile internals/generators/index.js"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模板代码生成"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码生成</h2>\n<h3 id="模板代码执行主入口"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码执行主入口</h3>\n<p>internals/generators/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="897188517210656400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shell = require(\'shelljs\');\n\nconst packageGenerator = require(\'./package/index.js\');\n\nmodule.exports = (plop) => {\n   plop.setGenerator(\'package\', packageGenerator); // 注册 package 下的命令\n   // plop.setGenerator(&quot;page&quot;, containerGenerator);\n   plop.setDefaultInclude({ actionTypes: true });\n   // 拓展 plop 复制功能\n   plop.setActionType(\'copy\', (answers, config, plop) => {\n      const src = plop.renderString(config.src, answers);\n      const dest = plop.renderString(config.dest, answers);\n      shell.cp(\'-r\', src, dest);\n   });\n};`, `897188517210656400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">\'package\'</span><span class="token punctuation">,</span> packageGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册 package 下的命令</span>\n   <span class="token comment">// plop.setGenerator("page", containerGenerator);</span>\n   plop<span class="token punctuation">.</span><span class="token function">setDefaultInclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span> actionTypes<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// 拓展 plop 复制功能</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> src <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>src<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> dest <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dest<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      shell<span class="token punctuation">.</span><span class="token function">cp</span><span class="token punctuation">(</span><span class="token string">\'-r\'</span><span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="检测-packages-文件夹存在性"><a href="#%E6%A3%80%E6%B5%8B-packages-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%AD%98%E5%9C%A8%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检测 packages 文件夹存在性</h3>\n<p>internals/generators/utils/directoryExists.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98021190119840200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fs = require(\'fs\');\nconst path = require(\'path\');\n\n/**\n *\n * @param {*} directoryPath 文件夹路径\n * @param {*} value 输入的值\n * @returns\n */\nfunction directoryExists(directoryPath, value) {\n   const directoryFullPath = path.join(\n      process.cwd(),\n      ...(Array.isArray(directoryPath) ? directoryPath : [directoryPath])\n   );\n   if (fs.existsSync(directoryFullPath) && fs.statSync(directoryFullPath).isDirectory()) {\n      const packages = fs.readdirSync(directoryFullPath);\n      return packages.indexOf(value) >= 0;\n   }\n   return false;\n}\n\nmodule.exports = directoryExists;`, `98021190119840200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n *\n * @param {*} directoryPath 文件夹路径\n * @param {*} value 输入的值\n * @returns\n */</span>\n<span class="token keyword">function</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token parameter">directoryPath<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> directoryFullPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>\n      process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token operator">...</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">)</span> <span class="token operator">?</span> directoryPath <span class="token punctuation">:</span> <span class="token punctuation">[</span>directoryPath<span class="token punctuation">]</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> packages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> packages<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> directoryExists<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="检测-packages-下面文件里面某种属性是否存在"><a href="#%E6%A3%80%E6%B5%8B-packages-%E4%B8%8B%E9%9D%A2%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E6%9F%90%E7%A7%8D%E5%B1%9E%E6%80%A7%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检测 packages 下面文件里面某种属性是否存在</h3>\n<p>主要为了实现端口占用检测功能</p>\n<p>internals/generators/utils/fileKeyExists.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="295889072654320640"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fs = require(\'fs\');\nconst path = require(\'path\');\nconst packagesPath = path.join(process.cwd(), \'packages\');\nconst packages = fs.readdirSync(packagesPath);\nconst lodash = require(\'lodash\');\n\n/**\n * 检测 packages 下面文件里面某种属性是否存在\n * @param {*} filePath 文件路径\n * @param {*} key 文件的属性\n * @param {*} defaultValue 属性不存在时的默认值\n * @param {*} value 输入的值\n * @returns\n */\nfunction fileKeyExists(filePath, key, defaultValue, value) {\n   const values = [];\n   packages.forEach((item) => {\n      if (item !== \'js-bridge\') {\n         const fileFullPath = path.join(packagesPath, item, ...(Array.isArray(filePath) ? filePath : [filePath]));\n         if (fs.existsSync(fileFullPath) && fs.statSync(fileFullPath).isFile()) {\n            const fileResult = require(fileFullPath);\n            const fileKeyValue = lodash.get(fileResult, key);\n            if (fileKeyValue) {\n               values.push(fileKeyValue);\n            } else {\n               values.push(defaultValue);\n            }\n         } else {\n            values.push(defaultValue);\n         }\n      }\n   });\n   return values.map((item) => \\`\\${item}\\`).indexOf(value) >= 0;\n}\n\nmodule.exports = fileKeyExists;`, `295889072654320640`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> packagesPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'packages\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> packages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>packagesPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * 检测 packages 下面文件里面某种属性是否存在\n * @param {*} filePath 文件路径\n * @param {*} key 文件的属性\n * @param {*} defaultValue 属性不存在时的默认值\n * @param {*} value 输入的值\n * @returns\n */</span>\n<span class="token keyword">function</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token parameter">filePath<span class="token punctuation">,</span> key<span class="token punctuation">,</span> defaultValue<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   packages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!==</span> <span class="token string">\'js-bridge\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> fileFullPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>packagesPath<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">?</span> filePath <span class="token punctuation">:</span> <span class="token punctuation">[</span>filePath<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> fileResult <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">const</span> fileKeyValue <span class="token operator">=</span> lodash<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fileResult<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>fileKeyValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fileKeyValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n               values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> fileKeyExists<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="项目级别的代码模板命令执行入口"><a href="#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目级别的代码模板命令执行入口</h3>\n<p>internals/generators/package/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20355794599721100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const directoryExists = require(\'../utils/directoryExists\');\nconst fileKeyExists = require(\'../utils/fileKeyExists\');\n\nconst portExists = (value) =>\n   fileKeyExists(\'config.js\', \'serverPort\', 3000, value) || fileKeyExists(\'config.js\', \'fePort\', 8888, value);\n\nmodule.exports = {\n   description: \'生成 package\',\n   prompts: [\n      {\n         type: \'input\',\n         name: \'name\',\n         message: \'package 叫什么名字？\',\n         default: \'demo\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return directoryExists(\'packages\', value) ? \'package 名字已存在\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'serverPort\',\n         message: \'package 的 Node.js 服务端口？\',\n         default: \'8001\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 Node.js 服务端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'fePort\',\n         message: \'package 的 webpack-dev-server 端口？\',\n         default: \'8002\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 webpack-dev-server 端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      }\n   ],\n   actions: (data) => {\n      const actions = [\n         {\n            type: \'copy\',\n            src: \'internals/generators/package/template\',\n            dest: \'packages/{{ dashCase name }}\'\n         },\n         {\n            type: \'addMany\',\n            templateFiles: \'package/*.hbs\',\n            destination: \'../../packages/{{ dashCase name }}/\'\n         }\n      ];\n\n      return actions;\n   }\n};`, `20355794599721100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> directoryExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/directoryExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fileKeyExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/fileKeyExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">portExists</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   description<span class="token punctuation">:</span> <span class="token string">\'生成 package\'</span><span class="token punctuation">,</span>\n   prompts<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'name\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 叫什么名字？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'demo\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token string">\'packages\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'package 名字已存在\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 Node.js 服务端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8001\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 Node.js 服务端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 webpack-dev-server 端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8002\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 webpack-dev-server 端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">actions</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'copy\'</span><span class="token punctuation">,</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'internals/generators/package/template\'</span><span class="token punctuation">,</span>\n            dest<span class="token punctuation">:</span> <span class="token string">\'packages/{{ dashCase name }}\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'addMany\'</span><span class="token punctuation">,</span>\n            templateFiles<span class="token punctuation">:</span> <span class="token string">\'package/*.hbs\'</span><span class="token punctuation">,</span>\n            destination<span class="token punctuation">:</span> <span class="token string">\'../../packages/{{ dashCase name }}/\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> actions<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="带模板变量的模板文件"><a href="#%E5%B8%A6%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E7%9A%84%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>带模板变量的模板文件</h3>\n<p>hbs 文件为模板文件，所有需要替换的地方用 <code class="language-text">{{}}</code> 模板变量，详情请查看 <a href="https://github.com/plopjs/plop" target="_blank" rel="nofollow noreferrer noopener">plop</a>，其他模板文件不再举例</p>\n<p>internals/generators/package/config.js.hbs</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53346541782727480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n  prefix: \'page\',\n  serverPort: {{ serverPort }},\n  fePort: {{ fePort }}\n}`, `53346541782727480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="hbs"\n              >\n                <span class="gatsby-code-button-language">hbs</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="hbs"><pre style="counter-reset: linenumber NaN" class="language-hbs line-numbers"><code class="language-hbs">module.exports = {\n  prefix: &#39;page&#39;,\n  serverPort: {{ serverPort }},\n  fePort: {{ fePort }}\n}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行结果"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h3>\n<p>以下是检测存在冲突的情况</p>\n<p><img src="/static/code-generation-addfae6d6b5126e00ca2c25e4c38dd96.gif" alt="代码生成冲突检测"></p>\n<h2 id="脚本执行封装"><a href="#%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本执行封装</h2>\n<p>封装 lerna 脚本，以实现脚本的并行执行</p>\n<p>internals/scripts/helpers/argv.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54241154229019790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = require(\'minimist\')(process.argv.slice(2));`, `54241154229019790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'minimist\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>internals/scripts/run.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10935306257899313000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env node\n\nconst shelljs = require(\'shelljs\');\nconst argv = require(\'./helpers/argv\');\n\nlet scopeParams = [];\nconst arguments = argv._;\n\nif (arguments && arguments.length > 0) {\n   scopeParams = arguments.map((item) => \\`--scope=\\${item}\\`);\n}\n\nshelljs.exec(\\`\n  cross-env FORCE_COLOR=1 lerna run \\${argv.cmd} --stream --parallel \\${scopeParams.join(\' \')}\n\\`);`, `10935306257899313000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node\n\n<span class="token keyword">const</span> shelljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./helpers/argv\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> scopeParams <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> arguments <span class="token operator">=</span> argv<span class="token punctuation">.</span>_<span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>arguments <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   scopeParams <span class="token operator">=</span> arguments<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">--scope=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nshelljs<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n  cross-env FORCE_COLOR=1 lerna run </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argv<span class="token punctuation">.</span>cmd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --stream --parallel </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scopeParams<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用说明"><a href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用说明</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61348534041477890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`npm i # 安装依赖\n\n# 启动\nnpm start # 并行启动所有 package\nnpm start website # 启动 website 项目\nnpm start website demo # 并行启动 website,demo 项目\n\n# 编译\nnpm run build # 并行编译所有 package\nnpm run build website # 编译 package 项目\nnpm run build website demo # 并行编译 website,demo 项目\n\n# 模板代码生成\nnpm run generate`, `61348534041477890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> i <span class="token comment"># 安装依赖</span>\n\n<span class="token comment"># 启动</span>\n<span class="token function">npm</span> start <span class="token comment"># 并行启动所有 package</span>\n<span class="token function">npm</span> start website <span class="token comment"># 启动 website 项目</span>\n<span class="token function">npm</span> start website demo <span class="token comment"># 并行启动 website,demo 项目</span>\n\n<span class="token comment"># 编译</span>\n<span class="token function">npm</span> run build <span class="token comment"># 并行编译所有 package</span>\n<span class="token function">npm</span> run build website <span class="token comment"># 编译 package 项目</span>\n<span class="token function">npm</span> run build website demo <span class="token comment"># 并行编译 website,demo 项目</span>\n\n<span class="token comment"># 模板代码生成</span>\n<span class="token function">npm</span> run generate</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="二期"><a href="#%E4%BA%8C%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>二期</h1>\n<p>由于项目代码需要分离，不再使用 lerna 管理各个产品线的包，所以二期主要工作在于封装成可用的命令行，以便直接使用它来新建项目</p>\n<p>参考链接：<a href="https://juejin.cn/post/6919308174151385096" target="_blank" rel="nofollow noreferrer noopener">从 0-1 搭建 react，ts 脚手架</a></p>\n<h2 id="目录结构-1"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40752448426982020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── bin\n│   └── cli.js // 脚本主入口\n├── internals\n│   ├── generators\n│   │   ├── index.js // 模板代码生成\n│   │   ├── package\n│   │   │   ├── config.js.hbs\n│   │   │   ├── index.js\n│   │   │   ├── package-lock.json.hbs\n│   │   │   ├── package.json.hbs\n│   │   │   └── template\n│   │   ├── page\n│   │   │   └── index.js\n│   │   └── utils\n│   │       ├── directoryExists.js\n│   │       └── fileKeyExists.js\n│   └── scripts\n│       ├── helpers\n│       │   └── argv.js\n│       └── run.js\n├── package-lock.json\n├── package.json\n├── src\n│   ├── create.js // 模板代码生成主入口\n│   └── start.js\n└── utils\n    └── index.js`, `40752448426982020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">.</span>\n├── bin\n│   └── cli<span class="token punctuation">.</span>js <span class="token comment">// 脚本主入口</span>\n├── internals\n│   ├── generators\n│   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 模板代码生成</span>\n│   │   ├── <span class="token keyword">package</span>\n│   │   │   ├── config<span class="token punctuation">.</span>js<span class="token punctuation">.</span>hbs\n│   │   │   ├── index<span class="token punctuation">.</span>js\n│   │   │   ├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   ├── <span class="token keyword">package</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   └── template\n│   │   ├── page\n│   │   │   └── index<span class="token punctuation">.</span>js\n│   │   └── utils\n│   │       ├── directoryExists<span class="token punctuation">.</span>js\n│   │       └── fileKeyExists<span class="token punctuation">.</span>js\n│   └── scripts\n│       ├── helpers\n│       │   └── argv<span class="token punctuation">.</span>js\n│       └── run<span class="token punctuation">.</span>js\n├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token punctuation">.</span>json\n├── src\n│   ├── create<span class="token punctuation">.</span>js <span class="token comment">// 模板代码生成主入口</span>\n│   └── start<span class="token punctuation">.</span>js\n└── utils\n    └── index<span class="token punctuation">.</span>js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="脚本主入口-1"><a href="#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本主入口</h2>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4782095332116998000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;name&quot;: &quot;cli&quot;,\n   &quot;version&quot;: &quot;1.0.0&quot;,\n   &quot;description&quot;: &quot;销服C端脚手架&quot;,\n   &quot;main&quot;: &quot;index.js&quot;,\n   &quot;scripts&quot;: {\n      &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; && exit 1&quot;,\n      &quot;start&quot;: &quot;node internals/scripts/run --cmd=start&quot;,\n      &quot;build&quot;: &quot;node internals/scripts/run --cmd=build&quot;\n   },\n   &quot;bin&quot;: {\n      &quot;cli&quot;: &quot;./bin/cli.js&quot;\n   },\n   &quot;author&quot;: &quot;&quot;,\n   &quot;license&quot;: &quot;ISC&quot;,\n   &quot;dependencies&quot;: {\n      &quot;commander&quot;: &quot;^8.2.0&quot;,\n      &quot;cross-env&quot;: &quot;^7.0.3&quot;,\n      &quot;minimist&quot;: &quot;^1.2.5&quot;,\n      &quot;plop&quot;: &quot;^2.7.4&quot;,\n      &quot;shelljs&quot;: &quot;^0.8.4&quot;\n   }\n}`, `4782095332116998000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"cli"</span><span class="token punctuation">,</span>\n   <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>\n   <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"销服C端脚手架"</span><span class="token punctuation">,</span>\n   <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \\"Error: no test specified\\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>\n      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=start"</span><span class="token punctuation">,</span>\n      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=build"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"bin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"cli"</span><span class="token operator">:</span> <span class="token string">"./bin/cli.js"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n   <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>\n   <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"commander"</span><span class="token operator">:</span> <span class="token string">"^8.2.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"cross-env"</span><span class="token operator">:</span> <span class="token string">"^7.0.3"</span><span class="token punctuation">,</span>\n      <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token string">"^1.2.5"</span><span class="token punctuation">,</span>\n      <span class="token property">"plop"</span><span class="token operator">:</span> <span class="token string">"^2.7.4"</span><span class="token punctuation">,</span>\n      <span class="token property">"shelljs"</span><span class="token operator">:</span> <span class="token string">"^0.8.4"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模板代码生成-1"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码生成</h2>\n<p>以下仅列出和一期的不同点</p>\n<h3 id="模板代码执行主入口-1"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码执行主入口</h3>\n<p>相比一期主要多了新建项目后 <code class="language-text">npm install</code> 的功能</p>\n<p>bin/cli.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54207460525646730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env node\nconst program = require(\'commander\');\nconst create = require(\'../src/create\');\n// const start = require(&quot;../src/start&quot;);\n\nconst { green } = require(\'../utils\');\n\nprogram.version(\'1.0.0\');\n\n/* create a project */\nprogram\n   .command(\'create\')\n   .description(\'create a project \')\n   .action(function() {\n      green(\'👽 👽 👽 \' + \'欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\');\n      create();\n   });\n\n/* start project */\nprogram\n   .command(\'start\')\n   .description(\'start a project\')\n   .action(function() {\n      green(\'--------运行项目-------\');\n      start(\'start\').then(() => {\n         green(\'-------✅  ✅运行完成-------\');\n      });\n   });\n\nprogram.parse(process.argv);`, `54207460525646730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node\n<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'commander\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> create <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../src/create\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// const start = require("../src/start");</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> green <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nprogram<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">\'1.0.0\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/* create a project */</span>\nprogram\n   <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">\'create\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">\'create a project \'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'👽 👽 👽 \'</span> <span class="token operator">+</span> <span class="token string">\'欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/* start project */</span>\nprogram\n   <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">\'start a project\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'--------运行项目-------\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">start</span><span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'-------✅  ✅运行完成-------\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nprogram<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>internals/generators/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51936352658363875000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shell = require(\'shelljs\');\nconst { spawn } = require(\'child_process\');\n\nconst packageGenerator = require(\'./package/index.js\');\n\nconst didSucceed = (code) => \\`\\${code}\\` === \'0\';\n\nfunction npmInstall(answers, config, plop) {\n   const path = plop.renderString(config.path, answers);\n   const spawnOptions = config.verbose\n      ? {\n           cwd: path,\n           shell: true,\n           stdio: \'inherit\'\n        }\n      : {\n           cwd: path\n        };\n\n   return new Promise((resolve, reject) => {\n      const npmI = spawn(\'npm\', [\'install\'], spawnOptions);\n\n      npmI.on(\'close\', (code) => {\n         if (didSucceed(code)) {\n            resolve(\\`npm install ran correctly\\`);\n         } else {\n            reject(\\`npm install exited with \\${code}\\`);\n         }\n      });\n   });\n}\n\nmodule.exports = (plop) => {\n   plop.setGenerator(\'package\', packageGenerator);\n   // plop.setGenerator(&quot;page&quot;, containerGenerator);\n   plop.setDefaultInclude({ actionTypes: true });\n   plop.setActionType(\'copy\', (answers, config, plop) => {\n      const src = plop.renderString(config.src, answers);\n      const dest = plop.renderString(config.dest, answers);\n      shell.cp(\'-r\', src, dest);\n   });\n   plop.setActionType(\'npmInstall\', npmInstall);\n};`, `51936352658363875000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'child_process\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">didSucceed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">===</span> <span class="token string">\'0\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">npmInstall</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> path <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>path<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> spawnOptions <span class="token operator">=</span> config<span class="token punctuation">.</span>verbose\n      <span class="token operator">?</span> <span class="token punctuation">{</span>\n           cwd<span class="token punctuation">:</span> path<span class="token punctuation">,</span>\n           shell<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n           stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">:</span> <span class="token punctuation">{</span>\n           cwd<span class="token punctuation">:</span> path\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> npmI <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">\'npm\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'install\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> spawnOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      npmI<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'close\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">didSucceed</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm install ran correctly</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm install exited with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">\'package\'</span><span class="token punctuation">,</span> packageGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// plop.setGenerator("page", containerGenerator);</span>\n   plop<span class="token punctuation">.</span><span class="token function">setDefaultInclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span> actionTypes<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> src <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>src<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> dest <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dest<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      shell<span class="token punctuation">.</span><span class="token function">cp</span><span class="token punctuation">(</span><span class="token string">\'-r\'</span><span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'npmInstall\'</span><span class="token punctuation">,</span> npmInstall<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="项目级别的代码模板命令执行入口-1"><a href="#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目级别的代码模板命令执行入口</h3>\n<p>相比一期增加 <code class="language-text">npm install</code> 逻辑</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43015605420245140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const directoryExists = require(\'../utils/directoryExists\');\nconst fileKeyExists = require(\'../utils/fileKeyExists\');\n\nconst portExists = (value) =>\n   fileKeyExists(\'config.js\', \'serverPort\', 3000, value) || fileKeyExists(\'config.js\', \'fePort\', 8888, value);\n\nmodule.exports = {\n   description: \'生成 package\',\n   prompts: [\n      {\n         type: \'input\',\n         name: \'name\',\n         message: \'package 叫什么名字？\',\n         default: \'demo\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return directoryExists(\'packages\', value) ? \'package 名字已存在\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'serverPort\',\n         message: \'package 的 Node.js 服务端口？\',\n         default: \'8001\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 Node.js 服务端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'fePort\',\n         message: \'package 的 webpack-dev-server 端口？\',\n         default: \'8002\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 webpack-dev-server 端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      }\n   ],\n   actions: (data) => {\n      const actions = [\n         {\n            type: \'copy\',\n            src: \'internals/generators/package/template\',\n            dest: \'packages/{{ dashCase name }}\'\n         },\n         {\n            type: \'addMany\',\n            templateFiles: \'package/*.hbs\',\n            destination: \'../../packages/{{ dashCase name }}/\'\n         },\n         {\n            type: \'npmInstall\',\n            path: \\`packages/{{ dashCase name }}/\\`\n         }\n      ];\n\n      return actions;\n   }\n};`, `43015605420245140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> directoryExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/directoryExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fileKeyExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/fileKeyExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">portExists</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   description<span class="token punctuation">:</span> <span class="token string">\'生成 package\'</span><span class="token punctuation">,</span>\n   prompts<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'name\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 叫什么名字？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'demo\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token string">\'packages\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'package 名字已存在\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 Node.js 服务端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8001\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 Node.js 服务端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 webpack-dev-server 端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8002\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 webpack-dev-server 端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">actions</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'copy\'</span><span class="token punctuation">,</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'internals/generators/package/template\'</span><span class="token punctuation">,</span>\n            dest<span class="token punctuation">:</span> <span class="token string">\'packages/{{ dashCase name }}\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'addMany\'</span><span class="token punctuation">,</span>\n            templateFiles<span class="token punctuation">:</span> <span class="token string">\'package/*.hbs\'</span><span class="token punctuation">,</span>\n            destination<span class="token punctuation">:</span> <span class="token string">\'../../packages/{{ dashCase name }}/\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'npmInstall\'</span><span class="token punctuation">,</span>\n            path<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">packages/{{ dashCase name }}/</span><span class="token template-punctuation string">`</span></span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> actions<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行结果-1"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90455007977490100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ cli create\n👽 👽 👽 欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\n? package 叫什么名字？ (demo) 项目路径/packages\n? package 叫什么名字？ demo\n? package 的 Node.js 服务端口？ 8001\n? package 的 webpack-dev-server 端口？ 8002\n✔  copy\n✔  +! 3 files added\n -> 项目路径/packages/demo/config.js\n -> 项目路径/packages/demo/package-lock.json\n -> 项目路径/packages/demo/package.json\n✔  npmInstall npm install ran correctly`, `90455007977490100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ cli create\n👽 👽 👽 欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\n? package 叫什么名字？ <span class="token punctuation">(</span>demo<span class="token punctuation">)</span> 项目路径/packages\n? package 叫什么名字？ demo\n? package 的 Node.js 服务端口？ <span class="token number">8001</span>\n? package 的 webpack-dev-server 端口？ <span class="token number">8002</span>\n✔  copy\n✔  +<span class="token operator">!</span> <span class="token number">3</span> files added\n -<span class="token operator">></span> 项目路径/packages/demo/config.js\n -<span class="token operator">></span> 项目路径/packages/demo/package-lock.json\n -<span class="token operator">></span> 项目路径/packages/demo/package.json\n✔  npmInstall <span class="token function">npm</span> <span class="token function">install</span> ran correctly</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO 代码生成脚手架还在完成中</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/代码生成脚手架搭建/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2021-11-15 11:43:19",path:"/code-generation-scaffolding/",tags:"前端, 前端工程化, 预研",title:"代码生成脚手架搭建",draft:null}},{excerpt:"以下是本次参加 Tweb conf 2021 的学习笔记 目录 主会场 Flutter 音视频开发实践 腾讯文档渲染优化之路 远程办公下开发测试协同如何提效 如何创造一门上万人使用的语言 分会场（看过） Node.js & 大前端 Kubernetes 应用的 BFF 便捷开发 跨端开发，也可以这样玩 低代码 & 可视化 基于 serverless 的低代码平台实践 编辑器 & 研发效能 稿定视频编辑器背后的故事 在线文档冲突——OT…",html:'<p>以下是本次参加 Tweb conf 2021 的学习笔记</p>\n<h1 id="目录"><a href="#%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录</h1>\n<h2 id="主会场"><a href="#%E4%B8%BB%E4%BC%9A%E5%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主会场</h2>\n<ul>\n<li><a href="#flutter-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5">Flutter 音视频开发实践</a></li>\n<li><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF">腾讯文档渲染优化之路</a></li>\n<li><a href="#%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%AC%E4%B8%8B%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88">远程办公下开发测试协同如何提效</a></li>\n<li>如何创造一门上万人使用的语言</li>\n</ul>\n<h2 id="分会场（看过）"><a href="#%E5%88%86%E4%BC%9A%E5%9C%BA%EF%BC%88%E7%9C%8B%E8%BF%87%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分会场（看过）</h2>\n<h3 id="nodejs--大前端"><a href="#nodejs--%E5%A4%A7%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node.js &#x26; 大前端</h3>\n<ul>\n<li>Kubernetes 应用的 BFF 便捷开发</li>\n<li>跨端开发，也可以这样玩</li>\n</ul>\n<h3 id="低代码--可视化"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81--%E5%8F%AF%E8%A7%86%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码 &#x26; 可视化</h3>\n<ul>\n<li>基于 serverless 的低代码平台实践</li>\n</ul>\n<h3 id="编辑器--研发效能"><a href="#%E7%BC%96%E8%BE%91%E5%99%A8--%E7%A0%94%E5%8F%91%E6%95%88%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑器 &#x26; 研发效能</h3>\n<ul>\n<li>稿定视频编辑器背后的故事</li>\n<li>在线文档冲突——OT 算法</li>\n</ul>\n<p>以上是本次大会看过的，下面是本次大会未看过的，仅做记录</p>\n<h2 id="分会场（未看）"><a href="#%E5%88%86%E4%BC%9A%E5%9C%BA%EF%BC%88%E6%9C%AA%E7%9C%8B%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分会场（未看）</h2>\n<h3 id="nodejs--大前端-1"><a href="#nodejs--%E5%A4%A7%E5%89%8D%E7%AB%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node.js &#x26; 大前端</h3>\n<ul>\n<li>从 0 开始，打造腾讯自研的跨端&#x26;动态化框架</li>\n<li>Puerts-UnityUE 下的 Typescript 框架</li>\n<li>云时代的前端开发</li>\n</ul>\n<h3 id="低代码--可视化-1"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81--%E5%8F%AF%E8%A7%86%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码 &#x26; 可视化</h3>\n<ul>\n<li>WebAssembly 在哔哩哔哩创作中心的实践</li>\n<li>厘米秀 3D 形象 DIY 渲染技术揭秘</li>\n<li>信息流运营场景中的低代码探索与实践</li>\n<li>低代码页面编辑器的设计和实现</li>\n</ul>\n<h3 id="编辑器--研发效能-1"><a href="#%E7%BC%96%E8%BE%91%E5%99%A8--%E7%A0%94%E5%8F%91%E6%95%88%E8%83%BD-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑器 &#x26; 研发效能</h3>\n<ul>\n<li>腾讯文档工程实践</li>\n<li>微信小程序真机调试</li>\n<li>CDN 版本化解决方案</li>\n<li>由兴趣驱动开源 Cherry Markdown 成长之路</li>\n</ul>\n<h1 id="flutter-音视频开发实践"><a href="#flutter-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 音视频开发实践</h1>\n<h2 id="flutter-简介"><a href="#flutter-%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 简介</h2>\n<h3 id="跨平台技术发展趋势"><a href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨平台技术发展趋势</h3>\n<p>跨平台框架优势：一次开发，多端运行，组件复用，提升效率</p>\n<ul>\n<li>\n<p>Hybrid App（2011 年）</p>\n<ul>\n<li>页面运行在 webviwe</li>\n<li>开发迭代快</li>\n<li>受限于桥接层，拓展性能差</li>\n<li>webview 渲染性能差</li>\n</ul>\n</li>\n<li>\n<p>ReactNative（2015 年）</p>\n<ul>\n<li>原生控件渲染</li>\n<li>性能好于 webview</li>\n<li>渲染时要和 Native 通信</li>\n<li>JIT 编译</li>\n</ul>\n</li>\n<li>\n<p>Flutter（2018 年）</p>\n<ul>\n<li>dart 语言</li>\n<li>同时支持 JIT 和 AOT 编译</li>\n<li>自渲染引擎</li>\n<li>性能接近原生</li>\n</ul>\n</li>\n</ul>\n<h3 id="flutter-架构"><a href="#flutter-%E6%9E%B6%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 架构</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-d7327.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.6416584402764%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACbUlEQVQozwFiAp39AKbCsKrHtbnXw2O8jjGobjmrc0GueVCzgj6tdjercjmrc1CzgjusdTeqcjysdU+0gkawfDmrczKpblm3hwC42cS63Ma+3chPs4EVn1wdomIdoWEgomQdomEcoWEmpWc/rncopmgcoWEcoWEgo2QdoWEdoWIVnl1Er3sAutvHudrFvtzJVraHH6JkNalyMqlwJKNoNqpzKKVpMahwR7B9M6lxJqRoNapyJ6VpMqlwNqlyIaJmTbOBALjcxLfawbvbxFS4fx6kWzWsajKraCSmXzOsaCanYDGrZ0uzeDWsaiWnXzOsaSioYjOsaTetbCKlXky0egDG2djL397R5OOYxtF9uceDvMeCvMeBusiAuseCu8mDu8qIvsuGvcp/ucmCu8eEvMiCvMeCvMd+uceVxM8AxMve0dnv4en9fqj7XZL7dqL7cZ/7ZJf6YJT8aJj8YJT7e6X6cJ76W5D8bZz8ZJb8dqL7dKD8Zpj7gKn8ANnl+tfj+Nrl+JK39Hem8oGs8oKt8n6r8nal816W8mOZ8Wqd8G6g8F2V8mGY81qT8mic8W2f8ViS8nqo9QDe5/fe5/bc5fXd5vbf5/ff5/fg5/fh6PbX4veVuPWZu/Sev/ehwPaTt/CYufGRtfOZuvKfvvKPs/OkwvQA6t/I69/H9OrX9Nyb8sxf881l8s1l8s1n885o+9Ji+dFj+cpN+M5d+9Vw+tVv+9Bc+cxP+eCe/vDX/O3PANvOs9nLr+XZw/PVhvTGSPPJUvPEP/PCPPTIUPLGSfLHTfLEQfPIVPTiufThtPTgsvXgsPXkvvTmx/XmxvQof41u5NlVAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 15 50 32" title="" data-src="/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-fee1c.png" data-srcset="/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-a67b7.png 200w,\n/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-0b187.png 400w,\n/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-fee1c.png 800w,\n/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-d7327.png 1013w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>FrameWork: 是一个 Dart 实现的 UI SDK，从上到下包括了两大组件库、基础组件库、图形绘制、手势识别、动画等功能</li>\n<li>Engine: 实现 Flutter 渲染引擎、Dart 虚拟机、Platform 通信通道、事件通知、插件架构等功能</li>\n<li>Embedder: 操作系统适配层</li>\n</ul>\n<h3 id="flutter--web-开发的差异"><a href="#flutter--web-%E5%BC%80%E5%8F%91%E7%9A%84%E5%B7%AE%E5%BC%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter &#x26; Web 开发的差异</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-7f6f5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.05726872246696%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB20lEQVQoz42Rz2sTQRSA9+R/Id78K7x4E7x48OTNIoIHtUdBxJO9iKJY0dI2WFBbYoWEWMSKqbEmbcQixUo1WROzddM2G5Ps7uzOzHszO76QUIOnPoY3v/ge75ux1CFCSskY6/V6vu9HUQQAg3PrMDDnPAgC13U9z6Mq/8MShEQBSJmDGt5JVBEo2scSIwFSAiIekP9gMwjVHwoVF1wIoVEaA0YLk/QXnMd0SAqUh7DWCZdsufJgafvO6+/3M1sTP/aLmqokkKuzs8utS4XWWL514b3XjQEEZywKw5CaJ3kr0YaJ3lT5/MO1c1Plsbsfz6w30iahNvDepn9k2jk+7x576h595u4xQB77QT+Ip2yhojbRj1vtcMcLdjpRk0OolNZKBQJqvqz+4dWO+B2SsBo4H4SllSZDBBLUktNkQGKiNACSndFSiVgDNyhx5KmGztlvE/Nfrr2pTKY3r899vvrOnin/ms3a9omMd3qpeWW1fTK7e+rVbqoav3TouZUehQu1J5mtW3l7Ord9e/HrzbydKtZnN/aaF1eD8bXOjY3gcqk7Xuo+rvCcC4kmxxHYbn96W31UaiysOy9WfqaKjeeF+hz9cdrBBQdmanLRwbQDkxXxYR/oJ2GE/gu7w1Ief7LcKwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 15 52 08" title="" data-src="/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-fee1c.png" data-srcset="/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-a67b7.png 200w,\n/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-0b187.png 400w,\n/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-fee1c.png 800w,\n/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-7f6f5.png 908w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>StatelessWidget(无状态)：内部没有保存状态，UI 界面创建后不会发生改变。</li>\n<li>StatefulWidget(有状态)：内部有保存状态，当状态发生改变，调用 <code class="language-text">setState()</code> 方法会触发 UI 发生更新。</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15443973167417190"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.grey {\n   background: #e0e0e0;\n   width: 320px;\n   height: 240px;\n   font: 900 24px Roboto;\n   display: flex;\n   align-items: center;\n   justify-content: center;\n}`, `15443973167417190`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css{6-8}"\n              >\n                <span class="gatsby-code-button-language">css{6-8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.grey</span> <span class="token punctuation">{</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> #e0e0e0<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 240px<span class="token punctuation">;</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> 900 24px Roboto<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">   <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71227734749266210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var container = Container(\n   child: Center(\n      child: Text(\n         &quot;Lorem ipsum&quot;,\n         style: bold24Roboto\n      ),\n   ),\n   width: 320,\n   height: 240,\n   color: Colors.grey[300]\n);`, `71227734749266210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2}"\n              >\n                <span class="gatsby-code-button-language">js{2}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> container <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>\n<span class="gatsby-highlight-code-line">   child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span></span>      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>\n         <span class="token string">"Lorem ipsum"</span><span class="token punctuation">,</span>\n         style<span class="token punctuation">:</span> bold24Roboto\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n   <span class="token punctuation">)</span><span class="token punctuation">,</span>\n   width<span class="token punctuation">:</span> <span class="token number">320</span><span class="token punctuation">,</span>\n   height<span class="token punctuation">:</span> <span class="token number">240</span><span class="token punctuation">,</span>\n   color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="trtc-简介"><a href="#trtc-%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TRTC 简介</h2>\n<p>腾讯实时音视频致力于帮助开发者快速搭建低成本、低延时、高品质的音视频互动解决方案：</p>\n<ul>\n<li>适用于视频会议、在线教育、互动直播等场景</li>\n<li>客户有腾讯会议、企业微信、陌陌、贝壳找房等</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-19de3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 84.22198041349293%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACLElEQVQ4y1VTiZbcIAzL/39ld3a2k5uAMZc5Kkhnu/UjvASwJUtk2jl+kCwux1y8ZMm5vKO12vDUWn4EvtsIEZmUNvOyKHUF76XUgrNj10j71EErFULEJ2piTqWuPhtjvPc558lYPo7TWsZwITofkgiwjI87OTLaOQeQgdkkl916MuRxLKVJGZrnBR/GkEVqTLlHYXYxeMzsHHDKoISiIIjFlKQnc4jI0Npg+JR6x7nUd2M4d9Ouf3M7+ZgSW+ci92ScIHYGEEneye3lMrEnohjjd1oq7cViycbYsSeTMuVWasOm1C4MoEDyZeVQ5ro0tEAmqKP5mOsXxfNUo2eZdsO/fq+9XzQschuFpmM/jKVgmQGOikgAAayjXBoBte2+rlCLe38RNZA5eFa8pMH5jrfnVSThpft8XPrj8QmfiSxcAr1vtRDQGQjt/4CX4Nx9djFBUMw4FYB5CzsuF3QD7TwWfwbEwiKyp92lI1Wo1QUD1a50wyz3qH0rjXc0o6I8uJD0aj4BWcpz3q7L3H5CjP04y21OzjwCzKV0JTT7r0Mvx4lFXKcJDC6l+g3xAWJYa49ToSeOsjlZDK/kN04aLrXaK1EP+MDOTxHIz69t25k92Bzn+Xg+g/Onl9nG134ocsqn2Ql4veZl3VbqvjptaIo5kzb4LW6m31KjT52qSZVyvWJh6bJt+6HVBUdCCB3ZxqSJYFT/TYbF9yj1X6Bov/StLduOcShcPKMt/wFa490YfBAwSgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 01 10" title="" data-src="/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-fee1c.png" data-srcset="/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-a67b7.png 200w,\n/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-0b187.png 400w,\n/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-fee1c.png 800w,\n/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-19de3.png 919w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="sdk-设计"><a href="#sdk-%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SDK 设计</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-8afa6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 73.08120133481646%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADU0lEQVQozy1RWW8bVRQe3uAJwQuviEXiBSH1BQE/oA8IIbEVsVUCpUUsogW1D0AgtKLgQiChEZVAaRYldpS6bkMqN3EWO3a8e9zGju04tsdL7IzHnvGMZ71z584M12mvzj06+o6+7xydj/jOs9/mVVkF0f1uoSmIihYvscWWwEtaimLzB7wK9GyjlyizJbrf5GTcxbggayZCxPv/7tK8JijQ4aVukm1ehqMr1O17DCfpV/11D0kDw5yNtMZ8Vd9uN0EJv61QExs1WtBs2yY+mswe8lq9q0yFDu5kO0Vamgk3vTsdf4Gbj7amw817DTFY7GFwNtLMNkVPmpmLHioADshnXPuspJcZaTJYxwNzLfFaqLaUPlzJMLPhxj9btVilh4Vmtg8mgwd3a8L1JD0dbknaERl/vD0OXNiWaSLDfvCso8DJskwMmvf7toUGDMPAQYxufs5w9cXU2PDyCWd8FEGUqKwH95aKrfROfXsj746XV7HI6u7898snJsMj1U7h0p1P5uKXkaIR33herTPFK4Hzpxde+cv/NZZeybnc5NVULRDYvzUTddzOTOOZrtSfp1wv/+IbKtDkOc9rE4HzSB2Qj1fbe1f85065Xhr3n8U7+vLOG+m/U/UNsubHxVredZ885Hzx0urHBTp51n18bPPMYPIfW9+22MZ1cuIn74eL5LiBkC/nvpWeSlCbiYp/6e61jfwNvPZ6YXHEe3Iq5qhzZcfaF87UuKkCwuglezzL8wCoNtRtVbW7LOJ5g+vbojI4GT6aDi0IkKHKUGGh3IEyq8s9Q9cJFHwE9IuA8aPsm3rhU5h9B1EXdJlBufeM3bdBfghm30C5D5Blm9SwHXjIjD1jhR+zYk9ZeoeA2deB2FQYUtkbVkqXlb0f1dqMJvdAxaGVLmqV30Hpgl5xQNM2qj+j7ceN5Aso9qSRPGbpXQIBHUKEsJdHVppH5gLTgtYDowcgri3bUPtarwm4OuAaQGhjzwnRO6r1WdCpqrEFJf2fEl8AxRDk20pkTk26FfKmGp1Xc+v44JRzJPTuo7GvjkWGnk58+TwQOkR/+VcocoCnpcyaVAhJmXW1tqOLrJRZlXN+Kb8lZ3xyOYnJlfkfAm89HDn97PbJJ2KfPacLnf8BfMPfNgB0rAkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 09 19" title="" data-src="/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-fee1c.png" data-srcset="/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-a67b7.png 200w,\n/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-0b187.png 400w,\n/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-fee1c.png 800w,\n/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-8afa6.png 899w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>业务层：提供给开发者调用的 API，如进退房、推拉音视频流等近 100 个接口</li>\n<li>实现层：管理 API 的核心类，可扩展、易用、性能好</li>\n<li>通信层：通过 MethodChannel 消息通道连接 Flutter 和原生 sdk，数据通讯能力升级</li>\n<li>原生层：底层是 Android 和 iOS 原生 sdk</li>\n</ul>\n<h3 id="挑战点-1-如何实现复杂的类结构体传输？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-1-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%8D%E6%9D%82%E7%9A%84%E7%B1%BB%E7%BB%93%E6%9E%84%E4%BD%93%E4%BC%A0%E8%BE%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 1-如何实现复杂的类结构体传输？</h3>\n<h4 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<ul>\n<li>flutter 本质是 dart 调用 native 的接口，并异步返回 native 的数据</li>\n<li>原生 sdk 存在着大量类结构体的类型定义，原有消息通道不支持传递此类型</li>\n</ul>\n<h4 id="方案"><a href="#%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p>Flutter 类结构体 -> Flutter 类结构体转 Map 对象 -> Flutter JSON 序列化 -> 通信层 JSON 反序列化 -> Android 类结构体</p>\n<p>同时可以对参数进行约束，类型校验，提升易用性</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-c3000.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 775px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 18.322580645161292%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwUlEQVQI1zWM7Y6DIBREfYzdkBotFFCBslfkXvlQ06bv/0pLNtnJyeRkfkzX9z1jTOsJMaVUQ4jbhgAhRkLcUypECbE5xYhtqfWo9bT2Oc+mG279jTGl9HVeR6k1l5xybVJqzoWQUsr7non2xrqG1u3dewBYuy8tv8UoJ+PwpaBoyGY7f/BYtsOGoj0ZB9Y8rfUN5/yyWCm11rNSUxffL3pf+fq49AGI24qjsoOYBu1GOY/KcKH4f+53Lv7CuXg85C+O5i1gCZ1L7gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 22 25" title="" data-src="/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-c3000.png" data-srcset="/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-84db6.png 200w,\n/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-07229.png 400w,\n/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-c3000.png 775w" data-sizes="(max-width: 775px) 100vw, 775px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="挑战点-2-图片怎么高效在-flutter-和原生-sdk-之间传输？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-2-%E5%9B%BE%E7%89%87%E6%80%8E%E4%B9%88%E9%AB%98%E6%95%88%E5%9C%A8-flutter-%E5%92%8C%E5%8E%9F%E7%94%9F-sdk-%E4%B9%8B%E9%97%B4%E4%BC%A0%E8%BE%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 2-图片怎么高效在 Flutter 和原生 sdk 之间传输？</h3>\n<h4 id="背景-1"><a href="#%E8%83%8C%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>直播过程中给视频设置水印等接口需要把 flutter 项目定义的图片资源传给原生 sdk，但是 flutter 没有 bitmap 这种数据类型，如何把 flutter 项目的图片资源转成原生 sdk 需要的 bitmap？</p>\n<h4 id="方案-1"><a href="#%E6%96%B9%E6%A1%88-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p>利用文档目录实现图片传输，通过文档目录（android 和 flutter 都可访问）传递文件路径的方式来实现共享</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-b043c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 539px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.05936920222635%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADTUlEQVQ4y42S7VPbRhDG9T9n2o+dNG3aNP3StBiKU1IwHlw3ARtIMBDSlgIpL7YlbL1ZtmxZlixL1p3uTjaySWL1ZAcGHKbTnWdu9mae3+3e3jFbR+azV3oiF2lpK1qfvdTzgkWwBwCkIhie8Z2V18bvb4zUbiv12kjv0dzM/dNm0m/MWMaczRgza8Zc1lh41Y5vtg+5to8j0gWwR+DOW/OLBW02ayzvWIs566fV1sNEM76hM/SwH543Z1b1H1/oM2v6XKb15IV+wJo+8a7h3WPjwWKDGn5eb82vR/5HSW3hZZNRGjYnW2Wlw0oGJ7dLFYuTLN10kAcBjESTRsspim1Wap/x5mmpxcoWK1lircP4BAUXftD3aaleDw1ofuEjz4M3AiMY9Mlw0L/oYZ/AYdAbBNSPmLZlCYKoKFXu/FwUJZ4X6Eob9m4ErS/LFY47p85SqUwNdLVth7EsS5blWq3GU04QyuUyL/C203G69mSdSFEUjuMmnkqlIoqi4zgMPRhfBe0w2noEusgD2DJtx+oigKPtuJXoChiTcdAtQ/fgKmjqQcQZh4fNzbf61l9qdr++TpOD5kbV4umh1043MkPm5mDop8CQ7KgrCfnhujqf0xapsurckvhVXt/3UZ9SUXHvo+6Ad9VUUv42U5vdUOOb6tO1WmxZ+qYwgenDA1A3uqrhUt2CJ23X2kK5dULFNg7ZxlG5dUql23XkIerodl2u6uSrsFAFU3B0f+IHhukWi3Ty1XyBDlhBOPAQGX+ZKNyrmK4MIEIm72nHUDu2lX1b+Rs0TlDzBHbqMKoMxi/yUdOwC/0B/0t49nnIfR2Wvg9Lj0P2y/D0M6LuAnwBxwO7jjvgofA0PL0Xnj8K5fhIjIXF++HJPf//wABiUt0eiImhkg6k5EBOXVafD6Sk1yxA5EMA/gOOcA/5umlLSl2qqAWWz7NlUVYR8sFt8i44GggyO526polyRZBkSVFUTfPG7zQNg9tlXYTJUW64tfhu77cglxjsJN//kb7cXvL4M0g+aTv68hB61zD2g+3lcOnBKBMbbcyPNuOj1Scffr1P8n8Cvz89sLzumg7ouKDrRj+ki0l/L/0h9fgyM3uZnXtHtRZ7v/IdLh58Cv8LBY18GnwwtfoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 26 16" title="" data-src="/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-b043c.png" data-srcset="/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-e7723.png 200w,\n/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-61f03.png 400w,\n/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-b043c.png 539w" data-sizes="(max-width: 539px) 100vw, 539px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>带来的问题：拷贝文件会导致比较高的耗时，如何解决？</p>\n<h4 id="优化"><a href="#%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<p>图片传输优化-平台共享 asset：Flutter 的 asset 资源被打包在原生资源包下面，通过 AssetManager 可直接访问，节省中间层拷贝耗时。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-6a7be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 524px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.97709923664124%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADVUlEQVQ4y4WUC1PTWBTH8513v4DKoo4PUMYVh10ELE5RsJTS1kVnLEvaLVKakBaSNEnTNu8muTePPpxBmj1JRwcUhzP/ydw79/+7955zkhDr/yjpj4k+xFor9khaD3zkurF8D0s9e3tf3d7Xtj6pm5/Ud6V4vHOg6aZNLLxTF7Pqk03lWUZdymlLOeN9RQ+8mHRcFAaY4c3bK/KjDWU5r68UjcWsdjfVvZfqdFWLeJjuAfl4o/d0U1nYUubeKLuk9v3kKXxntf0g3fszo77Y0cAzm+rcWwe4T1RorcroZUoBHTI6SamcZHkYuSiGYaDoTuXEqNAGSRulmkJSBkyrjGH1HWI8DMajIPQR6MsoHA/9wMfoUmCMhgP/yygA+dgBA/iHAw+WCFGSOp0uz7f4ltBuyyDHcdBVWlU1luMlUeLhKbUFUVI1HWNM0DTNcVy9Xj8+PqYoqlarmabpuq6ThG3HG8kdmSTJqYdhGPCIouh5HhEEge/7MHKTwMh3bQ/ZXt+wTc3CjudaGDlwDI5XMQ6SAH98bfdbQIEw8tomx6j/NfXPNXn/qF1q6ocNtSoYTbj9NInEOc0GE99Tg9YEOCx386+4P7aEp1lpcUd6sS0+T3GzH6Q07BtbkoBspvoRJru7K+ztjPCsKK8U5OWctLTGzexJrwEGA1TetGxatGkJga7AHvab2lGpnako+X87WVC5ly/JmXrvACfXBrhvO6zcZzsOiLjSFeT6Xogcv8mwPCs26LPTBg/TwBtcNsGbM9UPcJyRZRmi2Gq1OJZtCgJvmjo0Dl0Xl2FoRTgQC+f1uxfNhXNm/iszHw+o+wN2w71UsOtgaII3GAtb0effInomar2M+L+ik/vR0e/j079vgpOTR0JuUr81YR5eMHOTxlzUeAQbjdj1G+GknLaGNL6vcLbCKgKtSozebmCre2POydnBULXxCStQp3z5iAIdUg3bC/GNBUPYwx0hPKsNeBoxVcQcjoSTIUd5Eusi/EvYnRYsCEfl3cnana9v5y82n4DO385PXs2M9l67+Bc5Q7vh+8fx/y4cVwpRamaSfR4VX04Ky5PdpWh9dvQxfT3M6i5vuGe6Y/QdC/u4fjDOr6JCqp9bxfm1oJgaFFaD6l78Wv8U/wNv0rF+PKeJuAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 28 34" title="" data-src="/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-6a7be.png" data-srcset="/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-88dc0.png 200w,\n/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-98f22.png 400w,\n/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-6a7be.png 524w" data-sizes="(max-width: 524px) 100vw, 524px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="挑战点-3-视频在-flutter-里面如何渲染？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-3-%E8%A7%86%E9%A2%91%E5%9C%A8-flutter-%E9%87%8C%E9%9D%A2%E5%A6%82%E4%BD%95%E6%B8%B2%E6%9F%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 3-视频在 Flutter 里面如何渲染？</h3>\n<h4 id="背景-2"><a href="#%E8%83%8C%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>采集视频流 -> 云服务 -> Android 原生 -> Flutter</p>\n<p>将摄像头采集的每一帧数据通过 MethodChanne 传递到 Flutter 中，性能消耗大</p>\n<h4 id="方案-2"><a href="#%E6%96%B9%E6%A1%88-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<ul>\n<li>外接纹理：可以将原生端 opengl 图像数据共享给 Flutter 进行渲染。需要原生 sdk 提供视频帧图像数据回调接口，实现较为复杂。</li>\n<li>PlatformView：主要适用于 Flutter 中不太容易实现的组件，如 WebView、视频播放器、地图等。给 Flutter 提供了嵌入 Android 和 iOS 平台原生 view 的能力。</li>\n</ul>\n<p>最后采用 PlatformView 方案</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-c7bf1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.51643192488264%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADVUlEQVQoz02Q+U8TaRjH56/ZHzVrNGuy6q7XqlFwN6DimdVVVuMBUQQWYSnHGlGjrusJitYgSlC5jLuIdKQt04PS1tJzSlvoDO3MtDOdztFjOtPuW7rZkHzy5pvv837f53le6B9P36D9Lkra4jzxzvFwxNm9kjHX0zHXE8Coq2eF3/Nu7oHGNwi9cfzVY2qeixooDu81t6ktf6zg6ivbzde2WwP2O/22G//7LyxXe82q4bluaNj5uM/a9SWiLxQKFB+NC2RcIACxEnwUZ7FFZh5PhEC1ZJYuMEIMGpp7pLZ0OiKIlMt4SQtK2fyUzUdZveQswE3MBONu8G5OlvyUw0NavKQVLV6YDcXd0Gv7rYeGBhAmOOyBob7b1Pxspv35TId6prPX3H4fqX/ruA/CQjYJpu02XgE+EI+MjYP2P6EQ7fJRFkYk05I4H7cHaEeQdqCUHZwhxgkcnPWDsKxIYdYTZBz+WJEA/WWR8UKZTCGdLuRyBUUpAF1CTBWSfD6WUEoizmYYLksxcpxVBLFYXU7loZNdpq218JAW82Pc3ib9vt+RZaYrW6YrWvRVKuRIh+Foh/FAq6Fi2QGl/a1I+W/6S/esUEUzsvrEp/6JMBrmttRod9bpd13+jx8uassap/e1IgdUhvLG6R2XdDvrdMDfXa/fXKM9c3MWAn3WnJx8/iEEFgsTwlJMxEkxFOVDEd4XTiwQQrAouMASh2IsMAELUQGnRIIWoSqV4dszmr6PCySTan3q7FS7r/d7rr103+j3dPV5VL2uu4NoTlbEtHx7wAeqwAe0PXM9HvFDh9qMG8/BAxrMGWRX/Tyxrnpy03n4u/Pw9xfgDWc1q49P7KrTCekczWW2X9SuPTW5uQbeVguvOj4BukKVLcjXJ0pj59HFZBDn5rGkdyGBhpMBnAtg3GKEl2UFNAdLBZeKKwCAwEgeOthmXH8aVhfDcoxJMWyRGCPSy4JOpBLJlCxJSj7PClmWl2guC6ZI8BLLZ6Dd9bqvDo+/+DvkCtBrqzUbzn3e06D7sUlX1gh+XruuWrO3CRGENMNl9jTov/lV89OVYnXNL5+OdZqgj+bom88YGJJmhKGp8IgOG13B0BQ2blrKZrJZSRk3E6N6/D0SAQzrcNhK/AsAutU/l93RMAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 37 14" title="" data-src="/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-fee1c.png" data-srcset="/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-a67b7.png 200w,\n/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-0b187.png 400w,\n/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-fee1c.png 800w,\n/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-c7bf1.png 852w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 748px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 13.903743315508022%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAiUlEQVQI112NXQ6CQAwGuYURoe1uf3QRdFcJEQm8cP87WROfTCbNfH2ZivpnXfKx5MNY0iMrcwsAoSVGJBfAAICAEb6fgBh/+KyoLN245Nd6n5Zt2/Z9n9/zMPWXUdNk/ZocyxKMZGBOkbuoV3bXG1fEHuOzqqmoqoiYmYvXSCgo+fV4c2r+qZsP0NIajIijYeQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 37 41" title="" data-src="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png" data-srcset="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-24e67.png 200w,\n/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-f22f2.png 400w,\n/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png 748w" data-sizes="(max-width: 748px) 100vw, 748px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="优化-1"><a href="#%E4%BC%98%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<p>用 oppo 的一个低端机进行测试，房间有 6 个用户的时候，第二屏画面渲染异常，使用 PerfDog 性能狗，分析出 GPU 占用过高</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-e0b49.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 21.508588498879764%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAmElEQVQI122P2w6CMAyG90SyMjbaKQE5bGAB5dYbff+nsBkebky+NM33N22qDI3gZ+1Z/+rs6q0K94YfZ36a6pqJJ05pGjjOgCOUvbKejV8BA2BMjALWN2y2DOPBdlqkHNjTT6PpomlS9rQaWsC14PqdvByEzLayG8rh69+IdB34i6sWVXguiHMMOcZEMBTll2T+EvfG0PQCNms4TQPiK4EAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 39 51" title="" data-src="/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-fee1c.png" data-srcset="/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-a67b7.png 200w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-0b187.png 400w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-fee1c.png 800w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-b1a91.png 1200w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-e0b49.png 1339w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h5 id="列表懒加载与回收"><a href="#%E5%88%97%E8%A1%A8%E6%87%92%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%9B%9E%E6%94%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表懒加载与回收</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-29486.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoElEQVQY0xWQXUvbUBzG82FkH0LwbrBbX+682mDgjbd6p4zhN9iFIiiKOhzD6qZYcJhCM6qNbanWujTvpzl5adJ4kiYnaRubs1P43fwfeHj+z8Ms/9Tn9qT5E2XhuzK7K30sAEII3Pktb+6rW0cU5ctB91uBTMhC7Wrm9uBDpTBb/vGOPXx/V2A2/sCVC32tCNaL4PM5+Mpa1Oyclbvbv4y9a2P/2ti9tE9ZkpP1F26xernaZD81bpb4q9WnEoPiUYDfEJ74UeYPxvTM8zwbJBMqhVPeUDwOcZ6TME3QEPtDjEZJQEkxA5xAUO2WAFToQxfrdpATElquJSiOpNmi6slgYLo02UTeC5A7hvYPqC2lo7k20+0F9SeR5fjKQ0vQHO81om+bklply42/d48VvsndOwBOh3jt8+3Hcu2eq1e5Oq97DtOPMt0K2iJ8Fg3dQjedsG5ibPeMtkjDe5IGBdks1RLJ7I9TxYFtXRagrvRML40YN0i9MPPjyZQoO254RSkgMe0c57Qzikk8RKVm+NDxx4mbDPwR7g9jN4lcHP4H6A9hYe8NPHsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 42 26" title="" data-src="/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-fee1c.png" data-srcset="/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-a67b7.png 200w,\n/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-0b187.png 400w,\n/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-fee1c.png 800w,\n/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-29486.png 1106w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>列表优化后 GPU 占用从 72% 下降到了 53%，视频画面正常渲染显示，优化完成后的性能检测如下</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-1ef31.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.72275054864668%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAzklEQVQY011QCW7DMAzz/785bMWWpmnWyIcuj7LTYhshGDIZmVTSuq6q6u79L3BvLK1WqGb2X/UOMqGDzMxoMtGyfNVSpuwBG71dl6U8+XF6ay2G8QaGRe3I9Xq7H1SYFVeOcvjXJrf7fuQi6qVyE6iBhDGfFmZ+RnIknSQYdGrTPxA72Pl92rbttbOIEGWcr91seEAkot/8xLlza7EzPfbLx1um7+Gj3cWNUd3k8/J+PPZhLz0qsqQZBq+a6fjHMzbcbBZ44BkbFxm5I/0POimc6lSDSiwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 45 55" title="" data-src="/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-fee1c.png" data-srcset="/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-a67b7.png 200w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-0b187.png 400w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-fee1c.png 800w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-b1a91.png 1200w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-1ef31.png 1367w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-ef045.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.60795454545454%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoklEQVQozz2Q307iQBjF52nMblsKrcCIVCnVdlqUP7aFMqYluopSvfDaR1yowJqs9UKNiQpqIYHwAs4UNPnl5OScL/mSA6IoensbWc7JllKVkU1RTaqaVVBNo+JV66eo4qKyu2M4Bc2StdWNgixwfx8+PD6pe5hJq8kNg4c6Dw0+tx+zl4AGl0VJqEOlIUpVnhxQSgmoC/l9MJ/PR6Mx+fOL3+JEmcAKMicUOLHIUmSWhtQwQoEluUBvGEFO5UpgNpuNx+/H7auDxomNz6xm22qeUnDbJsSemPrhGWntZYjbpvOHVGA6nU4mk8Hwttvr94JBTL/Xo6Yb9G8Gt8N//4P+8G/3ZlUFq6obDMBisSCb1epHAtyFkpHN65m8no1JbyJJqamlQ63SyhdrP3nmW0EYhnd3YdlssendVE4n2yQ3iCKqZJusxkOU2a6lpUocou9KT22WweTz4/XlFZXxWkJi1xVGLDLiUldw6wrJfwvysmJpS9hJZBB4jmajj+jy6ppMglu+4/lN7wJ7PqaGQn3rokFNp+l1TNe3XR+7Hcc9/wJJQNFIrRGrWwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 46 25" title="" data-src="/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-fee1c.png" data-srcset="/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-a67b7.png 200w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-0b187.png 400w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-fee1c.png 800w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-b1a91.png 1200w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-ef045.png 1408w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由上图可看出，cpu、内存跟 Android 原生的占用差不多，GPU 比 Android 原生性能还差约 15%</p>\n<h5 id="视频帧直出"><a href="#%E8%A7%86%E9%A2%91%E5%B8%A7%E7%9B%B4%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视频帧直出</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-0204f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.8478513356562%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADL0lEQVQoz21RWUwTURSdaDTGDxJj/DLRD+OXMYoa/RCXaNCgMYIhQqGKIpGgttqigksUUCOBUFoWFYwRMCoYo8ZEwc7Q6QJiqV0U2s50ujADbadobTt0w077nFHjly8nJ/edm3PvffdBolbjfqnmrW7G6g4drtUV3Rw7euPjb/CBoG5M2DBWUv9P5HVOzLuo7Rt0Q4L6T+tPwP0IZSFC2yqHd4s1u0RqjneK1Dln1fuqtYev6A5e1nLXHefUHO8Sa/Ze0Gwsh++/dkLCW/otFUjfoAeADE5FXF7GOcNgVMQ+FZ5wBR3TEdtU+KsrPOkOTbiDOBnBpsLEDENMR76FE7x50ynkKUz6v8dv99ianmGtA3hLv51jWT9+q8f2DCYBACQda3xil/VjsgFM/gKvf2xFjQHenF2ODKgoMx7MPjGYU6Xcdx7JPY/slyB7RcjGssHTjWMApA1WemvF0J5zcJ4UyZMOrxO+63iJQaUN+uxTw7382ADzsc4A6/Cz1pmfdl8K96cwb5IMprhUbD6D+1mc5lOcjtPp2XAKKrujzzmD9MK+DPUZby50KUrccoFLISBaiwhFqbOz3NFWNtEitLaUOmRFRGuxU17sbhMSjYcCql7evL0KfqKajZrffjgAoQULVfkLOEY5LlyiKV2mFmRphcs1xVlowSK0YDF6ZDFauFSZC+GPLv0d+/F7D8gko7Q/MUtziNPeGO3j4fOGKE/IM8mQ1jnKHqHszLQ97sXnSGt81ssvbHMF3DvkzTCTNrXIoZMQI9VOfR0+WoPpJDa0ivzSyb85lWFSIMaCWBokMoDldvgz9eerlH3KQNyrRNpXaLpWartXj/Rs0D1aq+1epepYZn6Tn86AH8zc93A0xMTCc7FINJ5IzKeSSej4nfGtlaqe926uFptOAJDkkGYZrtmfGIB58L/Dcp3zr46uKR7izAQVOnbbcLrZJFaYqzst0nbLGZm5pGFc/oIg6ejJu+Mn7xrEcqO0w1TZ/LmoTj8Au6Hm55hYYdGYA7gneLbFIG0z1t4zXe82X+8y1XSaqprGu145KB8jURglbaZrDyw3Hlqq282VTYbXqOcX4CtIago4HQQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 47 42" title="" data-src="/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-fee1c.png" data-srcset="/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-a67b7.png 200w,\n/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-0b187.png 400w,\n/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-fee1c.png 800w,\n/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-0204f.png 861w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>性能消耗点：视频 view 的每一个像素流经附加的中间图形缓冲区，显著浪费显存和绘图性能</p>\n<p>优化方案：将视频帧数据直接输出到 SurfaceTexture 上</p>\n<h5 id="图像纹理共享"><a href="#%E5%9B%BE%E5%83%8F%E7%BA%B9%E7%90%86%E5%85%B1%E4%BA%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图像纹理共享</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-7e9bc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 74.94089834515367%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACt0lEQVQoz31S7UtTURi//0cQRP9BBEEUZvWpPiRhSPRChBUSakFaabpejGb5wcIyRIUgbepwvSi56abztc1YGTa1NbfrTffSnLt39+3cc849nbMRWVQPzz339zyc33OeN84XcTV7LnVM32qftnRO36b43bJT1sWnEzXtUxbqbx2/LqS/EkKMbEqd6VZm7Yq/T515ATNxzr3YV+U40ugsu+8qezB8scpRNLzQI6lpy+DJe87zVueF+oETi7E5SgaZuDT0UHS3ie5W0fkIpASOEJMqwjCjKAAaedMkJsYmRBBAaFJADdNkHyHYJIj+GDA5RHnQ1AFKiZqiIwRNhMzcNRYD5QCiZHoaGoyHQCykrYUoQLrCdbmi+yu9pxp8pVb/6Qbfwcvjba/DucCUTDPCEGFFBwATI72W7asVX94RXzVI9jqQiHDeD4n6js9NtqXGrmCTbdHSGXT5Y5QMEU0bA4gyspbcyKazGtRVXfgs81TnNSGINJnDGBNWIV6XVAMiliyzcmX9FFYt64OpE7KOmBq5vLjOwfCO0pGimsniuqmjtZM7z7lb+kPAgN0jfI9nxebmbSMrQlJmuWgyiAa0SEBdDlAAVYnzB1PN9lDH4HLbmzA9m+1ffAspISEXVowdqvIervYWlo/OzCcpWV9flXprxP6bTHtvsJp1AGXVyKpGWgKiYlBMnwUGEpJqNCZHYrKQUGXNoG3XNU2JR5V4RE9G9e88pN1+4ghtK3m7r2L0QKWnoNyz/fiQtWuB1fl72XkPbQ/ObwJhU+Q+hTeeu3jH+GrvmNDv/dY9zAeW0vlRYTaqXKd+RTA3KeHy+/CH5J10ThqA5N/CrXmezV7ZNWct/thYMmc99r56Nz/wmPExklSdDvl/5JWBlokzW/zVe/zXCvxX906d3RrquUvfhXRp/5bUZvkBmdwGtUM7JlcAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 49 34" title="" data-src="/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-fee1c.png" data-srcset="/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-a67b7.png 200w,\n/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-0b187.png 400w,\n/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-fee1c.png 800w,\n/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-7e9bc.png 846w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Flutter 与 Android 原生共享图像纹理数据，优化后性能检测如下</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-35f69.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 736px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.82608695652174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByElEQVQoz12Q3U/aUBiHz5/hFgO1sFIYChX6pbanfmTeaCnsbhdiYDizRYpQCzUQpZ1EY8LNXLaLXWzXkyIBvV52tT9r7yl+ZEuevPm9z+8kJ3lRsVx12mdHrW5lv17aOyzv1YBSxdz/0Kzbbs06ffuuXib+CTDF0sFl/zOiWVnZKCyvG4k0ZhcUNqWyKcymcYLDyexGMrNOViIVNq0FGcfTGp1Y2q3UECe94rGRUXQB50QtL2JD1AqiZsAqqIAuQlgtCKuvQRJwTtKMrJo3Gx00E05F49JcTKBiPMUIFMM/8F9+WuHxbCSzUzbRz8H42p/AHAwnw9Hd8Aa49Ud3/s3EH04G/hgmkaPbxxbCtT/+9fsPqtsnXq/v9vqd0wu71bUdF4D7dbqXZxdXH88/Oe3eVBIfzOax17BPvn77gZ7PcTLeWlnLpfi10ItsmOGnUDGBjsvz/CZAs1KY+ad6RnFviu/RgrCZVfTFle2Msg2X49UcrxqPCMTogdTvWwwyv6jmq3CwEM0xyeVoQo7EJTog8gDk6MulqYTPpwSVHGLE3coh2jlom03PtN1Gy7UIXq3pmna3Gpgjx7PuvWs5xEBLptW5+vL9LwSfyvEc/AauAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 50 37" title="" data-src="/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-35f69.png" data-srcset="/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-0149d.png 200w,\n/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-cfc3c.png 400w,\n/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-35f69.png 736w" data-sizes="(max-width: 736px) 100vw, 736px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-0506a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 470px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 94.46808510638297%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADHElEQVQ4y42U20/TUBzH+1eZaAy3iFwU5WI0CiKJ8YEHwTc1XMQxLiPAYNwiPBnjCxhlAzUx0WgMAwYGMkbb08J6OT1tt65rtzIefPLXbSKJ8fLLL92ynu/5fs7v9zujBFGMRqOapukJ4yQTSSP1H0EVPgghjm0eZ9O5fGbtdMr8dxTFmqa+31RefsKLX/CLj/LanuZk0qaZ/ntQoiTFYjFZltpnuZIutqafPfuIGVk6PM4aWsJIGsX8PVxs2MDOZFSVPFjgL3pQgw+V9zITy8L3nGWlXf5CwnfgAJaTdJ2TyaQKQZTOBb7yKaofRmU9rvjYSfOycYjdPMBGwjAztuVkipm1LVcsyzLDMLIkdsxzBXFpDxsIxgVZvzXO3xzjW/x8k4/7uosx0eG5saeEo0pkX4GOUJZtHx0dQcE65/mfYmZmRZSIUetFNf3o8gAq62UjtPp2g1T0Mk0+dMmL2gIc0Q0KkAVBIAoG8YU+tm7QFU+HBFFJXhlEdQOofgjB71v7ZGVdKe9hGodRbT+6M8kpWpJSCOH5A4zl+8+4Gi/XFjgo62GnQoKAE+AJJrBFxRN2M6aEwri0m20YRtUedNvPYTVB2YCdy+ma2jHP13q5u9OH5b3s9IooqykQAzmYg3ib0VY3SEk3A2hVHrZ1glP1FIUxRggpv7DZ0m4XW1CSYHtjjG+ddLeL7BNwBnGz/6BugGvx57FhqiVJUrBcKFjDcPHMBeyrQ9y1ER6cI7GCmL03G2/08c3jebFlWY7juNX+2WdwnjmNPfhnbLgSNO32ufNUn6eC8bisny7Yxh4OrsnFgvXnC0YSFEwpkAM2jGeVBzXmx3Mmj33Sqso+OLOyEsZw+GKrJvLY7mzbtqaS9jnufBdT7WHPPKQng6KkpqB+MBWVfcy5x0yE1oJhAq9gAaBdH4UhSbnONE1Dn59/EEZfS1MhaWgp/m5dEmUy/kaYCIqBkOR7JcQ4vB7FQ4vC5DIsE+ZWBUXVwdkEPdzs4yM7ztPra5+xyOfgn8E0nUxqZ2f721bYNnW4CNmMlVDF6M4WE9t17BQg/wCMamBe8+qm8wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 50 56" title="" data-src="/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-0506a.png" data-srcset="/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-8fcc1.png 200w,\n/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-a271d.png 400w,\n/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-0506a.png 470w" data-sizes="(max-width: 470px) 100vw, 470px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Flutter 优化后 GPU 性能提升了约 10%，基本能达到 Android 原生 sdk 的水平</p>\n<h3 id="挑战点-4-客户接入如何提效？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-4-%E5%AE%A2%E6%88%B7%E6%8E%A5%E5%85%A5%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 4-客户接入如何提效？</h3>\n<h4 id="背景-3"><a href="#%E8%83%8C%E6%99%AF-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>面临的问题：原始 SDK API 繁多，客户接入耗时很久</p>\n<p>场景化方案的价值：客户可以寻找契合自己业务的场景方案，参考源码实现，提升接入效率</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.404341926729984%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACBklEQVQozz2QTWsTQRjH1w/gwc8hngKKpmlIUvMqFmkRseBFvFTxYIuIRenBIp7U2tJL1Z6sIGJbwYAaKfQlbdJtNm/dNGuSJu2S3SaTZJPNJrs7s+Nsqs5hGOZ5fvxfKIyxYRjkFkSB436zLLu3lynkcxVRwL0DAGDi8WQyGWfiMYbZ2AzT9O7WVjiRSFAnGwgax0K1VgfNdgN2atlCMcGVeCB3NQh1XdM0BCFRgAhhrLc6SqvdgRBS2FTF4mHtMCdIoMXS/Mpa8yfbZvhmQWgoqk5gsqDKSmV+7tOD6StT4Mtm1TBU8kkRzwhB8qry8tzDr09vvj/ty/YNhaT1VTMRQjokeij9aCJtOffGeY9y8acC/BLdg/9nXgq+nbz9YvLW8tmhnY991/dvDKty25xiXCchrXbO65z1j525tu/qX1h8/M6EQbNYrmcqUn4hPPJydeD5zPiHwF3W7Yxe9jaTyRO4EgpFrLaE3//LPRz0jWQcl/Kjd4gh6ljKSYqoaspi9P7MZ9v6qCft8dBub+zqYKdcNrvEWDk6or1+2jFA+JTfF7ZcyE3P/rNtdogLxY21QVfMYo/YHdvnL+ZfvdZVVWu1SNdkWl5e2fUFotb+iM3Ojo2rjcZfuGfNjC3tMNzUs+zEE/FbEKTTIJWSDg50hLS2LIOqXCqJ33+A7Yje7ZqOEPoDZ6mopRlcui0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 53 24" title="" data-src="/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-160dc.png" data-srcset="/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-fc7b9.png 200w,\n/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-cea17.png 400w,\n/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="方案-3"><a href="#%E6%96%B9%E6%A1%88-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 79.78290366350068%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADNklEQVQozzWRbW/bVBiG/Rf4wA/hP/Ar+MaHwTYJoQ1p33jphBBCSGwg0U3T1nXZSui0pqtEtcI21hKapHmt391jnzhxnDi1k5xjO4l9fBxz3IqjW49uXc9zH1vP4RCen/WQYs603gwOkNZDqon0PjIszCDz0MKgzwbyFhxgzcyHWcR2MDfD0VoJXC9IN39Ti+Xh9YLy8SPx213jwdv+lcfi1SfSxjvryxfgk03xZlHdqTo3tpRrBembHb07CPLw7YvwF0X1eWX82dbZlU3lu73uxjv704J67an65Gi4VjKuFtRb22Cv7rIr2I1rJb1rs7AfidAXDCbMK1ZL7DUEkweuCNw6b+Zetfkzty70mmKPV/q8PhOgL0HftC++DPph117oPXxSq7Ua9ZNKWZAhLxmNk0qnWW80mrwMmT9tN2vVYw16XXupW3NzGHDIZ+FAt0LQ9zui3hFBW1Bl4Mhg1Ba0UxGcSvDSX7Q0rTs1Bmw46I0CjsQJiVISURLThKxoklGyInHKlJCMMEKzJMkSmqVpriRZXSomlFuE2J97Qa4JDr0JdmdB7hnxQ3cxR2E0C2NW0WyBpvNZEOEwxjlZIg7hMZxKcCKxqk+kliXxQ1H3BDgVu1PFwyPWMjy2Qb7VF1p9SXcFwxN0j7emOuf7k0P48gX/S0lcP9Ceyk51V1jfVx7v8L8Kw+MgnFXNg31l80/12d/guegc/6Fs7MsbL8X7gl3jgmD6Bmw/a/1Y7NzZkx7yw/LvzIgPiu2f2vZREE4P9dJ25+dd4f6e+LAzOCrx95jf7tztWGUOIa/rAuAoYCzBsWx5QB8JwBHAWOl5BsIe+z3jXIKubHqqjSD02GNphqcOkcWR5ZLGCxrNKSFs1QlJ84UnKYNJNE/iMFul2f9nxXwaZylhoiTikmiS+s00lOj5DoVr1PyBwtuJtZ4G/Cpor0KZjrao8VXS/Z4aX1P7URpIqd9O/RbxNS5djlfo32yhptrn9C+O/PNe8pajtQ+yoJPh42wup+JHKePl9+lrjrY+ZJMZrmR+NfFFLggnBEkEa9HkZOm8ipyDyHm1OD+MsUKwnHOvcsnz6pYZIRetCBv/ARl3L8TLq4FdAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 54 30" title="" data-src="/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-160dc.png" data-srcset="/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-fc7b9.png 200w,\n/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-cea17.png 400w,\n/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>核心目标：易接入，开箱即用，降低客户的接入门槛</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-787fb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 720px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 100.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACOklEQVQ4y3WUC5OaQBCE+f+/LVdKkIC8QUEWUUDN+Tq4fLujVZeL6arDZZme6enZPet+v0/jNH6MHwbjqBfb7VYptd/vfxucTqfz+TxN0/gFEK1hGLq+u1wucO4GRK9WK9/30zTtDbpOB3z+DfjWRqM6Ho8XA4pQFtpsNo+iCNreQMjTF1DMWq/XQRDymTiKtG2LlrqukyQhK+I3VcUrSXe7Hc93A3IRbFHzcDi8PyHtlWXpOE6WZehPU52FsCgMncViuVySkQI8rbbdNo0izfV6vd1u8ImjlO97QRjmeV4UBXEYEYbh24+3OI5RSQzdWVVV8RnZ1GcL8fwqVcdxlCYJXaClHwaekO25HQQBMWKNRVbSU3kw4AOyyeg4CwwT5XTBvPDftu3ZbIYuhGgyP2cDcZsF4mmS3lCI7Tgn0b7n2fbcdRfQHpX5IKOSOUsidjQ5ios8HwZU9UQj2PmJZYs4Th5khGEMvck82cIzdKIQ2bVSMg6iebUNsjR7kCminhFAbGfT8zxNrmvGK+RfGi4dibWaDEva/tYz3iKqaZrhoI0khuPEKwshI9Pa1Jtm21CNq8FxlRRySGgH280B7V4fT8zECZTvdjTesqBnOEZ2XKwKErH5+mLQErM9PoFCZEOmYeaUm/ODEa/JDAIOBLmlLIiDjDmIqsyt+O+VTDN9DCgolaVIVZau6+IZllKZdl6TMVDVqn+CIvw7Kcs1hwE+ZxM+Ma/J/H3+A0ZFw4xKbhVPRvgtBrf/AB+fXD7+4uBqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 55 38" title="" data-src="/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-787fb.png" data-srcset="/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-4591d.png 200w,\n/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-bf018.png 400w,\n/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-787fb.png 720w" data-sizes="(max-width: 720px) 100vw, 720px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>SDK：接口不超过 30 个，而且语义更加场景化</p>\n<h2 id="未来"><a href="#%E6%9C%AA%E6%9D%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未来</h2>\n<p>flutter 桌面端的支持不太好，未来需要支持全平台</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a166a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 30.82644628099174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABeUlEQVQY0wFuAZH+AL/Rv9Dh0Y3IjWK1Y2m4aWu5a2e3Z2u5bW26aK/I0XGa3oCl3YWp3mmW2cHQ5sG+uqeoqbe3t62traioqADJ4crV6thmuGcdlx0pnSo4pDksni0mnCcwny/F2dDX4PXV4O7Y4vDQ3O/h5uzm5eTj5OTn5+fk5OTh4eEA0OjR1uvYc710MqAzP6U/TKxNQ6hEOKM5Q6dEzt3P5uHh4eDc6efk4uHd5+jo6urr6urq6urq5ubm7e3tAM7o0tXs2l+3ZReYHymfMCifLyqfMiCbJymgMMDTxM/Mz9XW1c7Oz87Oz+7r6dra2sHCwtHR0evr6+vr6wDR4Mrb5tKex450sl59tmeHvHOAuGt4tGSBuG3R2tDX1tjf39/e3t3o6uzT3eza29vb29vj4+Pk5OTl5eUA2c2r7uK9/9OH/8Ji/8Vp/8Rm/8Ro/8ds/cVs7ebY8fL17+/u9fTz7vH3pr/j8PHy/Pz8+/v7+/v7+Pj4q2oDoKJ/umkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 57 59" title="" data-src="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-fee1c.png" data-srcset="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a67b7.png 200w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-0b187.png 400w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-fee1c.png 800w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-b1a91.png 1200w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a166a.png 1210w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-3be6a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 726px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.57851239669421%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACyklEQVQoz22NzU8TQRjG9+zNm15MNPHgzYt/gImJ4aCRC8bExHgAL4R4NEZJAINCghqNMXgQ0aCCtBQp3y1Flm1LS+mHtN3tdmfbbbvs7uzuzHZp0WjU2RKNocz88s7zPs/7ZqiN4opPmFgBrgMERHcATDVwN6d+MLkuzlLe3MjrdPfbzIPRTN8/3mR637MD49zQeG5ojB0czfT+nzYGej5ln1GsnExUmGQl1EQwWgxGCkzqkCiUqATTcozSFKjKhwB3dEkiQKjof02NABvVYQdSQAQsx3I57gD5PC8I+bxAnrzjcCzLgyxfSGUFUrO8yPM5ynQOagYhs6IYskaUM6BDsyr4atkxnHbX2Ambm9Y1SGFkWk0Q08ZkWa+ojrCQQe737MjveM/Pr89/JQd+pJ6YOqQkFUkqLmu4pOKC4lSpAXEkBRcVRxAKFb2ooLKK2AKUdgxJQWIZUgnJ9oH6glDzgzpTqC+DOmlXRcehi/Vwqb4oODDA/iLuLYFvyw0C4l5UMKmYZJ/z4RPz6OwSerG9e8yLziyillXHuRCw7mxWT86j47N4cAsT88i0eWoBHZ1Bp+dQAphUvFS9HbE6wrhzA09ydnsYd0Ws+zHrVti6G7NeblfbQ/hmCL/bxvc2cesauhHEV2ncEcJxsqzrRtU0LMOp5FQNR++3qqKXZH3XbESqapl6DRm2aRDHNnRVVSmhaAgSFksOfBERgIQEB8yJZt5pMSAR0AWiS3gfMsADSKVy+jSjfQyoHwLqWtzwbeqedY0wtwEjGeQNQ6JdtMbEtaUIdNHqFK25ac0b1BJpzVnuHBZbB3KX+rkxv9I/Xrr8kGsb4juHgTcErzzirj/lW/pYV0DuegXOd2evPeYv9rJtg1wyA6mcCJejykxQnmLkaEajE6pnXf7MyMRMsORbeSYkTzPyVlrxR+TJ1ZKHrnjo8ixT5njlDy0TD5jQ0V1BAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 59 11" title="" data-src="/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-3be6a.png" data-srcset="/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-0aa07.png 200w,\n/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-92365.png 400w,\n/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-3be6a.png 726w" data-sizes="(max-width: 726px) 100vw, 726px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="腾讯文档渲染优化之路"><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>腾讯文档渲染优化之路</h1>\n<h2 id="dom"><a href="#dom" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM</h2>\n<h3 id="方案-4"><a href="#%E6%96%B9%E6%A1%88-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h3>\n<h4 id="sheet"><a href="#sheet" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sheet</h4>\n<p>使用 <a href="https://github.com/handsontable/handsontable" target="_blank" rel="nofollow noreferrer noopener">Handsontable</a> 的 dom 渲染，主要页面构成为：</p>\n<ul>\n<li>单元格：数量多、结构类似</li>\n<li>图表、选区：数量少，结构独立</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-6f1f8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.457925636007836%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB/UlEQVQoz01QS2/TQBD2/+fCDS4ckNojl56oUCqBBKINLYU0MUkTx8+svd7H7MNerx9Z1nCA0ezoG42++b7ZoDNWS62EaqRulPJAcP+UkkqD7ITs5JwN45qwlgvNZQtSUd61JlCYaEwkZlDS8CEjWU3SGhDTdd0cj+fORFHBKLjzqJI0y9h6z55TcUipqGggq5ozgSpRnMQxph5UWKYpywpgu8g5922Trg+oG0YWo20Kq0Td7+DHXlDEAolrYFBjqErxtCr97vhI4yOhVDZxarsuy8vnQ0ZBKQ9SuAvZ92fY5Qown20DFScEeQ77fY1OgLEscqgqKaNE+8MZGK3GsRcZ2mfiKVGPB7GOBatmci24rGvpOeEG5xmPY5rEjFLlyYO14ziYxozT1JwqT16u6eOWbzOvDAGUmBNell6Zb8MSFcyfgBD4dfIQD30/TFN/9jHJHHnbT4VZFSZM5KzcUv7HtkAnsdmxOJdRRKOIoVKqY9qBpD9/VdcfeQVtmuGC7hcP8YfbPCGqIoEFqf0XI0wLEi3uYRWykpCk1FVtSQ39JG4+iRcvsR6NlNo59e6qefO2da43Jpims7W2a9rOuenyor+6ss7NrbHWdB73d8vh1Ws/tU3j2+H9dX9xaTywfeD+j9uv7svnf+35PNdw4xaLGUzTXDcbt1z+nf4G9V5dhLL1T5QAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 13 56 57" title="" data-src="/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-fee1c.png" data-srcset="/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-a67b7.png 200w,\n/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-0b187.png 400w,\n/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-fee1c.png 800w,\n/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-6f1f8.png 1022w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="doc"><a href="#doc" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>doc</h4>\n<p>使用 React 作为 dom 渲染</p>\n<h3 id="优化-2"><a href="#%E4%BC%98%E5%8C%96-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h3>\n<h4 id="渲染管道"><a href="#%E6%B8%B2%E6%9F%93%E7%AE%A1%E9%81%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染管道</h4>\n<ul>\n<li>\n<p>layout 优化</p>\n<ul>\n<li>尽量避免改变元素的几何属性（例如宽度、高度、左侧或顶部位置等）</li>\n<li>修改 paint only 属性（例如背景颜色、文字颜色等）-> repaint</li>\n</ul>\n</li>\n<li>\n<p>Paint 优化</p>\n<ul>\n<li>使用 will-change 或 translateZ 等提升元素层级</li>\n<li>使用 transform 和 opacity 属性</li>\n</ul>\n</li>\n</ul>\n<h4 id="滚动复用"><a href="#%E6%BB%9A%E5%8A%A8%E5%A4%8D%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>滚动复用</h4>\n<p>类似于长列表的虚拟滚动：复用 DOM、离屏时销毁 DOM</p>\n<h3 id="缺点"><a href="#%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<p>随着页面复杂程度、页面滚动速度的增加，重排重绘开销随之线性增长</p>\n<h2 id="canvas"><a href="#canvas" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Canvas</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-4e8bd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 788px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.34517766497462%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACBUlEQVQoz01SbW/SUBjtnzXxL/hF/aYmJkb5MuMSTRajg01gig4xUHkboRljDJCXIu0YIH0B2nt7b1so80Dj4kn6JDc553nOc54Kt/9hs9nW5XxdqZD6BT0rOd/TNPXZTqcJ55s7wh0EfOv12v0Hz/Mocajje96tqkx73aHcV3u935qmGYYxHo8JISHN933BcRxKafgAOOd4BsEaTcVsJvbxfeL48MPBu1Ih3263c7mcaZogW5aFLgIEjDEIFouFbdtsB3iBeDxbyqo+UPW+qmvGUpb73W630Wh0Oh3MAE0IlXA5mUxsy/JcDy1WqxXEL96KD55/efr6x/1HR7GUFD+ORiKRbDbbarWWO2CyxxgnhC2WxLKp43Dm+kEQQDy8Mdvyn56iN3vTyWyBtdXra8bdINg4DuPcFSjDsBV3fWU8n5nE9Xy+FW9j3Y9WMPbJXubxq9Nv4pVUPRPFn6lUqlgswvZ2Z89bUYdZNpkhT3OOlrCNICCu1JVUrnma/5XINDryZG7qM5A0DZlNp9OtmFJUgs1vRiPD0PkOoe03MenZfv7lQfnew8RXsXV1WWs2WwisWq0mk0lFUQQEGyaM60GGy6FXmLbcl2u1i3r98vy8NpDl0Wg0GAyGw2GYKMgCLgZBqERFF3je7H6lUqFwEv90Eo8fRQ8r5bIkSaIoYmHche4M/wWrDEzpnIIXxQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 13 53" title="" data-src="/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-4e8bd.png" data-srcset="/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-28bac.png 200w,\n/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-faee6.png 400w,\n/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-4e8bd.png 788w" data-sizes="(max-width: 788px) 100vw, 788px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="极端场景的全表双边框"><a href="#%E6%9E%81%E7%AB%AF%E5%9C%BA%E6%99%AF%E7%9A%84%E5%85%A8%E8%A1%A8%E5%8F%8C%E8%BE%B9%E6%A1%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>极端场景的全表双边框</h3>\n<h4 id="背景-4"><a href="#%E8%83%8C%E6%99%AF-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-6cf69.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.21802325581396%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABY0lEQVQoz02Q2Y7lIAxE8/9/2X3DDiFgvBDmYUy6R5qodFSybJfDMZBwdKFG42ZsTF1JqH6bf/r1wjDgLld1PqoORJIRBcwEN8HOETa7mijdivpd95QMxZMvD+5Tzs9lPj2GQ5MFr906knJi2YRtBN4iJoFMMZD3nDN5xylwDFKvYwwUSNKddK/Usc2f5Ga1qMnSPDoz7EkpoDXoLTpLOR0wkMclEHTFDhyFRyHlfgU1lfFiqFgypsg5aTJFT8HzVY4OQ7vnHo6beHXhWx6Yzy2zqebT56NsSJTizgxuH1+yJg96z+b3bB65MVfZA1WmblE1eepcDZGvAP4sZqvpg0EfD9eFaVFelJbcY84+13iWzsNc8OsXiPzh2qt31jlrS85HaxCDM+eXNR9ljP5Cut87/0/WShkYvf3+/vr5rLVHvXtMyRjd5qyxKeebpD8LnvX+7ZupfFZFjjFqp/dem0spfwGVQzR3gQC0lgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 17 48" title="" data-src="/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-fee1c.png" data-srcset="/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-a67b7.png 200w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-0b187.png 400w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-fee1c.png 800w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-b1a91.png 1200w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-6cf69.png 1376w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>渲染时间：单边框 6.71ms -> 双边框 14.91 ms</p>\n<ul>\n<li>绘制量：对比单边框，直接翻倍</li>\n<li>对接逻辑：需要额外的对接逻辑</li>\n</ul>\n<h4 id="产生原因"><a href="#%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>产生原因</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-64bf4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 792px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.843434343434346%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABQUlEQVQoz01S0W7CMAzs///TJNjjmMSQUNvBwwYMkaaladMkrImb7pIMxKmynNRnn+1k3vvpjtl7Y0gI27a27yznv52wNR/rehTCGe3nJ4CYTRRo/ymC7+aZvHfew9I8TzjCaj1wXl0iGGPDMCA0I6L2em3qAFyRI2edtdY5p5TGjVJKSlnkxXK5/NhsyrIsigL8QEZQVVXHw+F8PnddhyPSQQj4fd9DHoLgg3+73WARg2MoQ5Sl6EHKcRyhHkWPpxPSb7fb9Xqd5/l+vwfNGANpFWOQDQd5Axlt6s/ysnhpXhfy59SIDqp2ux1+pzqA1kF/6hYyYYUQsedpMt9ffPXWvK8UY1KpmvO2bYOQCIhE22GaRI+9JL1hYA7TjmNNssG8YoRNGGKy0IwwG+EikpPdl0Thi7vydzyv9PEcHj7sH2ROAX94eqxsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 23 17" title="" data-src="/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-64bf4.png" data-srcset="/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-ea548.png 200w,\n/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-22e6d.png 400w,\n/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-64bf4.png 792w" data-sizes="(max-width: 792px) 100vw, 792px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>上下文设置 style</p>\n<p>通过 canvas 上下文设置的 <code class="language-text">fill_style</code>、<code class="language-text">stroke_style</code> 等状态, 实际上都是 CanvasStyle 这个类的实例</p>\n</li>\n<li>\n<p>GC 逻辑低效</p>\n<p>GarbageCollected 自己实现了一套 GC 逻辑，并不会走 V8 引擎的 GC，不如 C++ GC 高效</p>\n</li>\n<li>\n<p>性能开销</p>\n<p>Canvas API 调用设置状态操作，性能开销较大</p>\n</li>\n</ul>\n<p>Canvas 在渲染过程中针对单元格需要渲染背景色、边框线、富文本，而不同的颜色、文本等又需要不同的状态，所以需要频繁切换状态机</p>\n<ul>\n<li>渲染单元格：渲染背景色、渲染边框线、渲染富文本</li>\n<li>渲染⽂本：渲染 color（black 文字）、渲染 color（red 文字）、渲染 color（blue 文字）</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 713px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.95371669004208%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABk0lEQVQY012Q2ysEYRjG589zuNGKkCuKXDiUkES5kiIpx1VLIu2yDhcWOWSyVisjrTA7s7PWfHP4ZmbNYY2Zsbsz60M5PRfvqefX2/tipV/yPO8rokSlRU58/h4i2YVinCCNV/vbj5X+yHPdkiRxUnIpcT6dvp6Bqa1X6w3REFzytzMEPiXczUrgqvi5Bfu91jD03Iv1yCRArDESKI+FyjiiX81ZTrH0dLdGH1aG5yrIgwpArhdcRLg/sGVZCEaFBFNZoim+6XvYr+JvBhQgGlmHTYaEqA8PVvNRn0CH/8Ou62qqms97EmTARTOxW39/VJc87gL3ZMHMs9TmI15zsd2QOavNPITzxY8TsX8Ps0w7m1VVhdEhpTHXGsdAlocZoMiiCpOanNJl2sxpX3bMcRzTNG3bVnIK1ETJkDjIMhTJsylZkxVdRgMKkAn6lhbSGZEXdQUaUNA45MdwHA8FQ3EiPn000uNv7Qu0+Y/H/JHxvkALakc3elfPlsb2BgaXO0Z2uhdP5if3h4dW2oeDnQunE+9yTJhRSzHYywAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 29 28" title="" data-src="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png" data-srcset="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-b9753.png 200w,\n/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-7c7b5.png 400w,\n/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png 713w" data-sizes="(max-width: 713px) 100vw, 713px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="优化-3"><a href="#%E4%BC%98%E5%8C%96-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<h5 id="切换状态机优化"><a href="#%E5%88%87%E6%8D%A2%E7%8A%B6%E6%80%81%E6%9C%BA%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切换状态机优化</h5>\n<p>通过提前收集、统一整理，减少切换状态机</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 685px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.8978102189781%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqklEQVQY012Q3VPaUBDF8/8/tFqhVLTaTsf2RaoJEgJIExJCzNe9BZLwIRhHpdg6akFMcpN7k17aPnS6T2d3z29mzzKOP+Qtjje5liuCKRRgWbDLbU8xJyZvsVWb1Uaa6rVP9KOqzYEpaDkib67ncOIw9jko8hsF9kVJO1CG0n5za6+2depWzy6UD9KbA7koj5uiV3tXL+w3cvJALHU+UfNOdUMb6kwU4STOkiRDKI0igpPs5wKZZheAvtMf6zqkQlUNUWz7/izBaxs1UySMMJOm2X8VhmR+8+Pb9fxu/nA7u7u+nE3H/uXkKngO6Tb9B2D6vscZh5xeavbqxrnF6mvdGalfr6DQ5eq9E8s3jQud/oIHx+bEktwvZaNUAZ8BzWyNQbGyWTh+eah+lD1pm3+1XclxNtsaSW8b+b3TQsMReJt7zW3u1PLySCnDo10h917Ma0ODiWOS4iwlGaGxQ4IXEXl8Th5W6P4JPyW0TRYBDjBZRlTH98v4MSBhQnAWI8z8Pf93ktVyFdgm6iiRbURdiAYugnY8cMnsJu5BBK3Y0JB5Rr7f/kF+ATiLkYxePH1FAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 31 43" title="" data-src="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png" data-srcset="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-18514.png 200w,\n/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-82fbc.png 400w,\n/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png 685w" data-sizes="(max-width: 685px) 100vw, 685px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>遍历待绘制内容</p>\n<p>遍历待绘制的所有边框线、文字等</p>\n</li>\n<li>\n<p>相同状态内容整理</p>\n<p>相同状态的绘制内容，进行合并、排序等整理</p>\n</li>\n<li>\n<p>分类渲染</p>\n<p>整理之后的内容，根据状态机进行分类渲染</p>\n</li>\n</ul>\n<h5 id="渲染复用"><a href="#%E6%B8%B2%E6%9F%93%E5%A4%8D%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染复用</h5>\n<ul>\n<li>\n<p>离屏 Canvas</p>\n<p>离屏 Canvas 缓存主 Canvas 绘制内容</p>\n</li>\n<li>\n<p>复用</p>\n<p>直接复用离屏 Canvas 缓存的内容</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-89964.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 754px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.41379310344827%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABx0lEQVQoz11Sy24bMQzc//+N9pL00rop2l9oiiK52Bf74ENQ1Eb2qQclUpQ7khZ2UmFXXsmcIWfI7lJXzmUfe/l09/rxw/nbw7D5Mjz+NL8e7dNv+3UzbD7393evP75P+XJb3ZvvQsGciXII6r2QF7MEa6Jz4n3CJbMS+RDCO7Cq5ppdkqTEqoInZ62MOeGYyk2M4Xg8nk6nBlnBnojrAmtlKURmnjgQlxqosWBHZuYoIgjucJU1IyJaE5Yl1bhCzDEYE72rYH+VllKKkQFeM6tINKaUywwwlIkxiXw9J8EfgVZLCxjhqD8W8DAMyIHyVnCgOA3uzwtbIyE0LaWcGzg1dZq0OxwO3lqo4iqDvctafVKFy7iMBexxJlFJ+QrGR/f0/BypWAIhqBc617apcgWTc2gXXHoZvQkoOXFkohCjdMZaUCEJEbl59stybbobJ7uYeV4mi6y3skukc5DdtbgsDBNh1W1g0CoPdo1JOWm7ae3VqqsOSXUCyvf7/d/TCXwtAvswjm0kSjPx6jozu91uu91679chGcex7/sFfRa5JgfRPM+o8P0I5/P5DMYyJJf/V7bWgqUJCyHCWGMMfpfFwNG3of8ATMgsDI+wSFUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 36 26" title="" data-src="/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-89964.png" data-srcset="/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-13e98.png 200w,\n/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-e13a3.png 400w,\n/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-89964.png 754w" data-sizes="(max-width: 754px) 100vw, 754px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="针对业务逻辑减少-gc"><a href="#%E9%92%88%E5%AF%B9%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%87%8F%E5%B0%91-gc" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>针对业务逻辑减少 GC</h3>\n<p>浏览器垃圾收集器会定期（周期性）找出那些不在继续使用的变量，然后释放其内存</p>\n<ul>\n<li>\n<p>频繁 GC 导致帧率不稳定</p>\n<ul>\n<li>大量创建对象会导致更频繁的 GC</li>\n<li>频繁的 GC 会导致帧率不稳定，引起卡顿</li>\n</ul>\n</li>\n<li>\n<p>对象池优化</p>\n<ul>\n<li>建立对象池缓存，从对象池获取对象</li>\n<li>减少渲染主循环过程中新建对象操作，从而减少 GC</li>\n</ul>\n</li>\n</ul>\n<h2 id="alloy-精确统计-fps"><a href="#alloy-%E7%B2%BE%E7%A1%AE%E7%BB%9F%E8%AE%A1-fps" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alloy 精确统计 FPS</h2>\n<p>如何精确、自动化统计 FPS？</p>\n<h3 id="背景-5"><a href="#%E8%83%8C%E6%99%AF-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h3>\n<p>现有 Web 前端 FPS 统计⽅式：</p>\n<ol>\n<li>\n<p>类似 Chrome devtools 的开发者⼯具</p>\n<ol>\n<li>需要人工实时监测、无法自动化</li>\n<li>更加适合开发阶段进行自测</li>\n</ol>\n</li>\n<li>\n<p>RequestAnimationFrame API</p>\n<ol>\n<li>统计的 FPS 结果不够准确，因为以两次主线程执行时间间隔作为一帧</li>\n<li>模拟交互不够真实，需要引入脚本且实现对应代码</li>\n</ol>\n</li>\n</ol>\n<p>同时由于主线程阻塞情况下浏览器的优化，即使嵌入死循环 js，滚动依然流畅，影响 FPS 的统计</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29631326681632043000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function block() {\n   while (true) {}\n}\nsetTimeout(block, 2000);`, `29631326681632043000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>Chrome 浏览器在主线程阻塞情况下，会将页面滚动处理由主线程移交给合成线程</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-2cb88.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 15.783410138248849%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAk0lEQVQI1x2J2xaCIBAA/f//K4NEBV2EZY/LxYNmD2XNmaeZZs85WlvQJ7tsgdIMlWP6FSyB1gny4jLidQuG7D0NI89wlO19HE1GQqGCVL5T0+3upaRRO/Ek1a+DZjOhEChkAstaszY7857SZY2xqVyhB9ObgCiFFK1QXXdvHzDDVSxYIkLn0CMFcs55DK/z/Pz5Ap7Xo+Nvq/KyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 52 50" title="" data-src="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-fee1c.png" data-srcset="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-a67b7.png 200w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-0b187.png 400w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-fee1c.png 800w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-2cb88.png 868w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</blockquote>\n<p>此时需要我们理解 FPS 本质是：</p>\n<ul>\n<li>\n<p>帧率</p>\n<p>浏览器渲染动画或页面每一帧的速率</p>\n</li>\n<li>\n<p>渲染管道</p>\n<p>浏览器渲染每一帧经历的固定流程</p>\n</li>\n</ul>\n<p>同时主线程阻塞情况下，页面渲染可能在其之后的合成线程、GPU 线程进行处理</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.70854271356784%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRUlEQVQY052R60vCYBTG94f3oU9F+CEo0ZqElyzKW6IYXaAoCEkTUpJwzljT3PaKl/d9N93c9p42u0H2qYfDj8PhgYdzDgdLYsyn0DaLJZwvTC4uievCHzZgHKgKaAogjSGPioOGtjYANJhKKu6o5MWni5CtIDbQXM+macyyXC+CMc6sp2k7orf2qBi3OvxDs3LQmKdqpHD4Vkz08rFuavc1F5VLSfXkuM7fBPZL68nzQPg6kLmPcmY1SRqben2LPu1YzWC1dpuo0NQdyvFiJihkQ2J626NQjEjZeDl8thrNrMRO10JXG0flCAdjzCaEYR0wBawvmgmQr9IxUPxJAwNZ2BznY20O/it/Z+a6Pep08dy/8ncBI9N5S6H98Wxpbrc1Qx7N/GTvC9KjIAvyz5cWGhv2c1/vjcxfgXRmi8iQhlOvfwelX7MZ4+qcOwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 55 39" title="" data-src="/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-f1168.png" data-srcset="/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-ad772.png 200w,\n/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-4f4c3.png 400w,\n/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="方案-5"><a href="#%E6%96%B9%E6%A1%88-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h3>\n<ul>\n<li>Chrome devtools performance：普遍常用的 Chrome devtools performance 面板</li>\n<li>Tracing view：信息更加详细、全面的的 Tracing view 工具，使用 chrome://tracing 开启</li>\n</ul>\n<h4 id="tracing-view-介绍"><a href="#tracing-view-%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tracing view 介绍</h4>\n<ul>\n<li>\n<p>进程、线程</p>\n<p>展示对应进程、线程信息</p>\n</li>\n<li>\n<p>Flow</p>\n<p>事件对应的流向</p>\n</li>\n<li>\n<p>TRACE_EVENT</p>\n<p>表示浏览器内核函数调用执行情况</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-ad164.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.2033426183844%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACKElEQVQozx1Q2W7aUBD1/z/0Lyr1JZVapVWTlChLS1JCAGOMjZfru/jutq83IMQY6nY0Gs2cozMzOlbf993x2B27/tSfz6dT3537Q53tFpNiMTHLqXn5nc0nxak7nLvDqXvvj8dBch7idLao62HXp54XzYOlLd0Zce58e7Ra3bmzm8XspxOPQfQYBler6FcI7IhAJKT643m3S8fKAWp3b+/t29Pz08X9eByZhzgbufTGRqMVuV6nH17GX1794IV5sUyoFDqTKrNjuoiopRKsTaVzI1ynxGBn8lbLXZH3h/2Q3X5b1FnTFIfDbr/fbpu2Lqpt27617ft+ZyVLVxVl02xlEA8780xrJXOtq7ouq6qqq7Zt66o2ZWXKchjL0vzDq6qsG2s9mVKh8tykQZDgBKUYpuh/xZAgSGBCIMBwoACKE5IgihOCBnBgrde7x+ncpoxzNxKBkCATkeKhFD7jG87Codci1iwUwSJGNsFOSlace1KEylr/mc6XjpJ6eFtgJpkUhCM/jJ+m4NUZLhEAWUJoghlMJeI0wqmP0ijlVFjB3N4AqDMDVy5NU6Ekl5ILyfOcYohGM/h1nEYbBhPv7nny6cfi8sq/vcb3z8nH75b2A0O5wYR5YZYZlTIOoACIL9Zs6RCP0UCVTV3td3DuX118/nY9WnqRIPLm8sHaNtt6MK5qBhdNWRR5Xuis0DqXUoFEx0BDqADQALAYxpsIOj7fhAoBEK//AnftR15ZJ7ZEAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 58 57" title="" data-src="/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-fee1c.png" data-srcset="/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-a67b7.png 200w,\n/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-0b187.png 400w,\n/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-fee1c.png 800w,\n/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-ad164.png 1077w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="分析主线程阻塞时滚动"><a href="#%E5%88%86%E6%9E%90%E4%B8%BB%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E%E6%97%B6%E6%BB%9A%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分析主线程阻塞时滚动</h4>\n<ul>\n<li>主线程 V8 执行 js 死循环</li>\n<li>合成线程处理滚动</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-316dd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.88803512623491%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADIklEQVQoz12T6W/bRhDF+b8X/RoUjVsEdd0EyNEUVmOZlnXY1kFLokiJOqibog6ey+UuL5FcUmpsp0yd9kMffngYPAwwu8AM9eVfPT199Th+7HVJlydsOxqLCdsM2VZ0lfd/eWVr2vG/tmdRlmHYFjykh4QcSEhInO6DJHCJ7xDfJ16QekGC3X0QplF8iMkhTr5BSErNS5VZ7iKASFcNVdpsFuvtVjUNU9tqK0ni+AbH1RmmwrK18g3dYCocz3S4BtupD/sc5U5m0XAcHx+gBoEGDFk1J7ItyeZEkjpD5lMxo5kvl97n3p+cfjp7V//z+v6i2MhdC7f3FDYt3wv8IPIc7GHb1VV3NvVmU2cimkx7nStvcpX1eWWdq8w/XEl/XG++JWWlUKM0A0Dk+ME+3gck8OLQz/6eHI9xHJIkSmOSxkkSZ2VGnERfk+QfyD6glsuV6/r7MHY9DyOcuee5DsbYRm4m33WyJzkIWSayADB0GwIHw8x106Cms8VK3kDLRia2NNtULNvACDiZ2zpGpgt1pK8NsDHMta7LmrUDSLOhYqmyRvG9frcroDBCbmgBF2g2hi5CLlxs7c4AVO+tWsvi+oAb6HdNOJxDE0MDQj0b5lCKMFDGE9hkoSBowx5Qdg4AwDQUaW4Zql4pGVzLWIzXA27VbW0E1pyJUJqpo64yH1L7nXqAKFnKjig6Q8Gez7CiBADYiylernxO9Mdrb7RwpxMsDkC/A/sDNJAg37V6HcpOwl2AlHS/Jd5u72T1yjYlS9t5cOujLTS3lrGDxsZSkWt/SdPHJOP4RNKnz5+pBU+38y+4wkuu8GPmncLLwtvvL998x+R/4IsnXEbpJ778c5t+IY9un28g2+7nBad649VVlS8zQrHRKzP9q1vu7XnxzUc6X2qWmH6REUqMkOX0HTeab/5/GPOb7t2v+frry8ZvdPUsf3N6Tp98oE9+L776WD+7rJ5eVM8uaq/z1dP88n4YHh+jwwOOjjIiYfpA/TXVsCjLzSZbprW2oHQ4PN4FC6jxwqhWGdxWdHagc11P3JIloMeQU8KW7L3jge4f/gZkwjTtkQ9WmgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 01 18" title="" data-src="/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-fee1c.png" data-srcset="/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-a67b7.png 200w,\n/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-0b187.png 400w,\n/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-fee1c.png 800w,\n/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-316dd.png 911w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="寻找关键-trace_event"><a href="#%E5%AF%BB%E6%89%BE%E5%85%B3%E9%94%AE-trace_event" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>寻找关键 TRACE_EVENT</h4>\n<ul>\n<li>\n<p>关键 TRACE_EVENT</p>\n<p>关键 TRACE_EVENT 出现次数 = 帧渲染次数</p>\n</li>\n<li>\n<p>排除主线程</p>\n<p>将寻找关键 TRACE_EVENT 的路径集中到主线程之后的流程</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-8f73d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.08532778355879%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTElEQVQY012QbUvDMBhF8/9/jKJMUGFTO/TL1I2hwtRVt7VpmzQvTdImTdJpujGYHi7hwn3Ol4CfI7bb/h1H1ekJOT+jFwM6GvLrKx7dVfvpH+Cv3J+Updts2hAILUI2Lyyl/ljeHgKstb7rhBRSSef90RToDqVXvLOmabRu2tZY23rvQed9x7lIoEwgy1BGVUYkYhKWMkE8lJyqnMiCyYzKFHPMFJEGVbo2FpQZzL82d7N48rZ+nS5unpbR7HOV0dHj+8PLOk7xcLKIpstvSKJZfPv8ESfo8n4+GM+XSQmsUhqTBNO85NlyDRHJEFV1k+Y4FKlqWqkcM0zCASNcNbqtlGaiIVIDJYTHWKWJhpCu0oJUBeEll2mOghyKqA2mFSwIZiJolTLKOKmt1A4wxuwe50J6vAvfQghljLc7dmO/GmPqukYYI4RaY34B62zAvGRtXBAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 03 54" title="" data-src="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-fee1c.png" data-srcset="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-a67b7.png 200w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-0b187.png 400w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-fee1c.png 800w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-8f73d.png 961w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="确定关键-trace_event"><a href="#%E7%A1%AE%E5%AE%9A%E5%85%B3%E9%94%AE-trace_event" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>确定关键 TRACE_EVENT</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-079bc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.750244857982366%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoUlEQVQoz42S22+bMBTG+f9f97LrQ7tJnZD6sqqTsiavyzRCaamSDtombMsFML5gwAaC7R1Ipe2hlfaT9fn48lnn2LbyPGeMEUKyLIOAEsKKAl1f8zAsVqsiiqjv482GcU4wRghRStlA13UWmGGWUApmOAIDjOH5nC+XRRgUDw8sCMCMKcUDhz2UUaWUZZ5EG6OMqfcGM7NX5hmsVRSFd/cIZZDYtkDbKk4alNQINN2TRKYpWqYwuc92dbopEwiSNoubJGuxFSdoF6csL7iQv9d3t2cT5+PIPb2Y2SPn5PPM/uLaF5fvTt3j8+kre/Li7deXJ+7Rp9mH8eJ8asm6FbIpKylkDZlUuQhH9/4b9+r11Le9xfvvP45n0bfop7fdzhHekbW3+uXv1gHP1sICW1kJUClrpfvyQNq8U9VQaqdN93zNWmulddfB5UGvD0Nteu1bf5RRjwyr/+jTtw3u/+HRLISABy/Kss++rpumhmcvh6EYqKrqEDCWN237N23obm788XiyuF14nudeuo7jBEEI+zjn+QB8qSHiSZwIKQ7mP3hPZjrbjzLpAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 05 04" title="" data-src="/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-fee1c.png" data-srcset="/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-a67b7.png 200w,\n/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-0b187.png 400w,\n/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-fee1c.png 800w,\n/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-079bc.png 1021w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>确定关键 <code class="language-text">TRACE_EVENT</code>，合成线程中 <code class="language-text">ProxyImpl::ScheduledActionDraw</code> 可以作为关键 <code class="language-text">TRACE_EVENT</code> 进行 FPS 统计</p>\n<h4 id="alloyperf-实现原理"><a href="#alloyperf-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AlloyPerf 实现原理</h4>\n<p>截止 <code class="language-text">2021-10-26 15:10:27</code>，AlloyPerf 未开源</p>\n<p>// TODO 查看 AlloyPref 源代码</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-04aed.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.3968253968254%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABD0lEQVQY03WQS0+FMBCF+f8/wrU7d27caXThQhMTvd6LCQgXxNvSQp/07RCMQYyzmPTMmS+nbbbb7xpUE95PWinBirJ4ujxXkg3DyDkXQjDGqqoihPToxMYB9z1MwEIIZflb/oHbQeJu4Hevbd13D89XwSjglFJSSuiw54x+qVCNRmcma53WmlKapZRihJYqos9u3+EQFr2qZXLx2N6XdL2QAepCUNZbH4gwJ2Z8DBvehxmoicTcgHThBwbhY0O1tgG8mwOJ8/YGjlTZfSePRCsbrF/B4C1J85J04G2SJxcKrI50KrE6fEqQq+QQsTC9sA2drnMCcgPHuRKM4vcXpF/JwnhpPJ88vDn9ufZ/9QWDjc4E1FrHKgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 06 48" title="" data-src="/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-fee1c.png" data-srcset="/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-a67b7.png 200w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-0b187.png 400w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-fee1c.png 800w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-b1a91.png 1200w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-04aed.png 1260w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>Docker 集成环境</p>\n<p>docker 集成 chrome、chrome driver 统一环境，支持跨平台</p>\n</li>\n<li>\n<p>自动化 CI</p>\n<p>支持自动化 CI，通过测试用例自动化测试统计对应、对应交互的页面 FPS</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-82dd7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 675px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACTklEQVQ4y5WTS28TMRSF898BoYoVCx4iICEhsQkLRIsoEjQVIERXiA2iLaUI2sl4bM/4ef0YZ8JJUrqjLclNlBnfb871Oc7IlUBDpCF1yXArdbK49EN0OeQ4nBrGk4yL7OZBUCddZ3sfsDoPPqaRy+R6j1uMxG920jnlS8ClTRRCD7ghQSWq3pyqGg06Wl/IZudiHP3S1a2DR7e/P3n88/nG0cPrh/duHjwYH01ap2Pqh7yYzvau7d8dH0/Gx8/u/Hi6cTi+sX//1em7koYRs+Jltbs9e7/D9jar6Wa1s1XtTutPBgOVoeThi/g2Odl+U398PfuAtq1q+qJ6+1l8xdIohFRCcdLJmVjgNSxr3s9jSLkMELfBa2uM0B5voRf94BJpbCv1I+/Jh2Cda5X2FGJOKIqBKCQ8IubWd9j5jDPWchudT8SpFa6NS5jQRo5IGevIn8MhRIyNx7dezUxTN6yRPPQRGcigWqeWypacCB3WGOf9vKSSc+l9ChhnDXde14ZXrBatrOoZl7yLBpktYee9cUZbrYx25NZlvaW/MJRryxlvlNMmICHfEpRXMD4xZXwvf8R8XrAr9/O1MvctYO0M5kIjol7BZYSOfxX4lWEKcQKG5nrPjZdnhl0Ar5WXsOGN4EiKckBJauWlyucw3OZSICoP8RzWUV0FLsgZhlV1raxOfV7B3X8oY881Z51VIClh7O4sZ7hyQcGwzqvGyZox5IcEYp/W/80rGYaoKt0wyYVqcTZXhnVnh+RSZe0NN7LmDY6nj4SoxMptKP8BmHv57D/rTWIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 08 35" title="" data-src="/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-82dd7.png" data-srcset="/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-b59b2.png 200w,\n/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-189f4.png 400w,\n/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-82dd7.png 675w" data-sizes="(max-width: 675px) 100vw, 675px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ul>\n<h1 id="远程办公下开发测试协同如何提效"><a href="#%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%AC%E4%B8%8B%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>远程办公下开发测试协同如何提效</h1>\n<h2 id="异地开发测试协同"><a href="#%E5%BC%82%E5%9C%B0%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异地开发测试协同</h2>\n<h3 id="背景-6"><a href="#%E8%83%8C%E6%99%AF-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h3>\n<ul>\n<li>开发联调：截图、传递抓包文件、需要同步联调信息</li>\n<li>测试：测试测出问题反馈给开发，开发需要重现步骤，然后推到测试环境才能让测试测，问题定位步骤长很低效</li>\n<li>产品体验：如果异地的老板想看测试环境的效果，需要部署外网地址才能访问</li>\n</ul>\n<h3 id="业界方案"><a href="#%E4%B8%9A%E7%95%8C%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>业界方案</h3>\n<h4 id="vpn--修改-host"><a href="#vpn--%E4%BF%AE%E6%94%B9-host" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 修改 host</h4>\n<p>实现的途径：</p>\n<ol>\n<li>手动修改</li>\n<li>借助工具修改（比如 switchhosts）</li>\n</ol>\n<p>但暴露的问题有</p>\n<ol>\n<li>功能受限</li>\n<li>不支持移动端</li>\n<li>信息同步慢</li>\n</ol>\n<p>由此开发联调、测试、产品体验效率都很差</p>\n<h4 id="vpn--代理工具"><a href="#vpn--%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 代理工具</h4>\n<p>实现途径：</p>\n<ol>\n<li>whsitle</li>\n<li>fiddler</li>\n<li>charles</li>\n</ol>\n<p>对比以上的 <code class="language-text">vpn + 修改 host</code> 分别有以下优点</p>\n<ol>\n<li>支持各种复杂规则配置</li>\n<li>支持移动端</li>\n<li>分享抓包信息</li>\n</ol>\n<p>但是通常一个代理工具需要以下步骤才能使用</p>\n<ol>\n<li>启动代理工具</li>\n<li>配置系统代理或使用浏览器插件</li>\n<li>wifi 代理</li>\n<li>手机配置 https 证书</li>\n</ol>\n<p>由此导致的问题有：</p>\n<ol>\n<li>体验前置步骤多、成本大</li>\n<li>分享抓包路径长</li>\n<li>配置不共享</li>\n<li>本地需要启动代理服务</li>\n</ol>\n<p>测试、产品的体验效率很差</p>\n<h4 id="vpn--测试域名"><a href="#vpn--%E6%B5%8B%E8%AF%95%E5%9F%9F%E5%90%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 测试域名</h4>\n<p>优点：访问方便</p>\n<p>缺点：</p>\n<ol>\n<li>无抓包，定位问题复杂</li>\n<li>配置固定，修改配置麻烦</li>\n<li>切换环境不方便</li>\n<li>安全性如何保证</li>\n</ol>\n<p>测试、产品体验很方便，但联调、定位问题的效率差</p>\n<h3 id="痛点"><a href="#%E7%97%9B%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>痛点</h3>\n<ol>\n<li>访问不方便</li>\n<li>测试环境中业务信息保密性</li>\n<li>本地启动代理服务</li>\n<li>定位问题不方便（抓包、分享不方便）</li>\n<li>多人协作修改规则不方便（配置不共享）</li>\n</ol>\n<p>// TODO Tweb 学习笔记待完成</p>\n<h2 id="如何协作提效"><a href="#%E5%A6%82%E4%BD%95%E5%8D%8F%E4%BD%9C%E6%8F%90%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何协作提效</h2>\n<h2 id="tde-的现状与未来规划"><a href="#tde-%E7%9A%84%E7%8E%B0%E7%8A%B6%E4%B8%8E%E6%9C%AA%E6%9D%A5%E8%A7%84%E5%88%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TDE 的现状与未来规划</h2>\n<h2 id="tde-的实现原理"><a href="#tde-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TDE 的实现原理</h2>\n<h1 id="如何创造一门上万人使用的语言"><a href="#%E5%A6%82%E4%BD%95%E5%88%9B%E9%80%A0%E4%B8%80%E9%97%A8%E4%B8%8A%E4%B8%87%E4%BA%BA%E4%BD%BF%E7%94%A8%E7%9A%84%E8%AF%AD%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何创造一门上万人使用的语言</h1>\n<h1 id="kubernetes-应用的-bff-便捷开发"><a href="#kubernetes-%E5%BA%94%E7%94%A8%E7%9A%84-bff-%E4%BE%BF%E6%8D%B7%E5%BC%80%E5%8F%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes 应用的 BFF 便捷开发</h1>\n<h1 id="跨端开发，也可以这样玩"><a href="#%E8%B7%A8%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E7%8E%A9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨端开发，也可以这样玩</h1>\n<h1 id="基于-serverless-的低代码平台实践-tweb"><a href="#%E5%9F%BA%E4%BA%8E-serverless-%E7%9A%84%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0%E5%AE%9E%E8%B7%B5-tweb" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基于 serverless 的低代码平台实践-TWEB</h1>\n<h1 id="稿定视频编辑器背后的故事"><a href="#%E7%A8%BF%E5%AE%9A%E8%A7%86%E9%A2%91%E7%BC%96%E8%BE%91%E5%99%A8%E8%83%8C%E5%90%8E%E7%9A%84%E6%95%85%E4%BA%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>稿定视频编辑器背后的故事</h1>\n<h1 id="在线文档冲突ot-算法"><a href="#%E5%9C%A8%E7%BA%BF%E6%96%87%E6%A1%A3%E5%86%B2%E7%AA%81ot-%E7%AE%97%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在线文档冲突——OT 算法</h1>\n<h1 id="从-0-开始，打造腾讯自研的跨端动态化框架"><a href="#%E4%BB%8E-0-%E5%BC%80%E5%A7%8B%EF%BC%8C%E6%89%93%E9%80%A0%E8%85%BE%E8%AE%AF%E8%87%AA%E7%A0%94%E7%9A%84%E8%B7%A8%E7%AB%AF%E5%8A%A8%E6%80%81%E5%8C%96%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从 0 开始，打造腾讯自研的跨端&#x26;动态化框架</h1>\n<h1 id="puerts-unityue-下的-typescript-框架"><a href="#puerts-unityue-%E4%B8%8B%E7%9A%84-typescript-%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Puerts-UnityUE 下的 Typescript 框架</h1>\n<h1 id="2021-tweb-云时代的前端开发-王伟嘉"><a href="#2021-tweb-%E4%BA%91%E6%97%B6%E4%BB%A3%E7%9A%84%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E7%8E%8B%E4%BC%9F%E5%98%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2021 Tweb 云时代的前端开发 王伟嘉</h1>\n<h1 id="webassembly-在哔哩哔哩创作中心的实践"><a href="#webassembly-%E5%9C%A8%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E5%88%9B%E4%BD%9C%E4%B8%AD%E5%BF%83%E7%9A%84%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebAssembly 在哔哩哔哩创作中心的实践</h1>\n<h1 id="厘米秀-3d-形象-diy-渲染技术揭秘"><a href="#%E5%8E%98%E7%B1%B3%E7%A7%80-3d-%E5%BD%A2%E8%B1%A1-diy-%E6%B8%B2%E6%9F%93%E6%8A%80%E6%9C%AF%E6%8F%AD%E7%A7%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>厘米秀 3D 形象 DIY 渲染技术揭秘</h1>\n<h1 id="信息流运营场景中的低代码探索与实践"><a href="#%E4%BF%A1%E6%81%AF%E6%B5%81%E8%BF%90%E8%90%A5%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84%E4%BD%8E%E4%BB%A3%E7%A0%81%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>信息流运营场景中的低代码探索与实践</h1>\n<h1 id="低代码页面编辑器的设计和实现"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81%E9%A1%B5%E9%9D%A2%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码页面编辑器的设计和实现</h1>\n<h1 id="腾讯文档工程实践"><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>腾讯文档工程实践</h1>\n<h1 id="微信小程序真机调试"><a href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微信小程序真机调试</h1>\n<h1 id="cdn-版本化解决方案"><a href="#cdn-%E7%89%88%E6%9C%AC%E5%8C%96%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 版本化解决方案</h1>\n<h1 id="由兴趣驱动开源-cherry-markdown-成长之路"><a href="#%E7%94%B1%E5%85%B4%E8%B6%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E6%BA%90-cherry-markdown-%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>由兴趣驱动开源 Cherry Markdown 成长之路</h1>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/2021Tweb学习笔记/index.md absPath of file >>> MarkdownRemark",timeToRead:22,frontmatter:{date:"2021-10-25 10:34:12",path:"/tweb-learn-note-2021/",tags:"前端, 前端大会, 前端分享",title:"2021TWeb学习笔记",draft:null}},{excerpt:"背景知识 TypeScript 入门教程 深入理解 TypeScript 一份不可多得的 TS 学习指南 React 中的用法 组件声明 类组件 类组件的定义形式有两种：  和  ，它们都是泛型接口，接收两个参数，第一个是 props 类型的定义，第二个是 state 类型的定义，这两个参数都不是必须的，没有时可以省略：  也是差不多的： 如果定义时候我们不知道组件的 props…",html:'<h1 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h1>\n<ul>\n<li><a href="https://ts.xcatliu.com/" target="_blank" rel="nofollow noreferrer noopener">TypeScript 入门教程</a></li>\n<li><a href="https://jkchao.github.io/typescript-book-chinese/" target="_blank" rel="nofollow noreferrer noopener">深入理解 TypeScript</a></li>\n<li><a href="https://juejin.cn/post/6872111128135073806" target="_blank" rel="nofollow noreferrer noopener">一份不可多得的 TS 学习指南</a></li>\n</ul>\n<h1 id="react-中的用法"><a href="#react-%E4%B8%AD%E7%9A%84%E7%94%A8%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React 中的用法</h1>\n<h2 id="组件声明"><a href="#%E7%BB%84%E4%BB%B6%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组件声明</h2>\n<h3 id="类组件"><a href="#%E7%B1%BB%E7%BB%84%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类组件</h3>\n<p>类组件的定义形式有两种：<code class="language-text">React.Component&lt;P, S={}&gt;</code> 和 <code class="language-text">React.PureComponent&lt;P, S={} SS={}&gt;</code>，它们都是泛型接口，接收两个参数，第一个是 props 类型的定义，第二个是 state 类型的定义，这两个参数都不是必须的，没有时可以省略：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36442039641897783000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IProps {\n   name: string;\n}\n\ninterface IState {\n   count: number;\n}\n\nclass App extends React.Component<IProps, IState> {\n   state = {\n      count: 0\n   };\n\n   render() {\n      return (\n         <div>\n            {this.state.count}\n            {this.props.name}\n         </div>\n      );\n   }\n}\n\nexport default App;`, `36442039641897783000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">IState</span> <span class="token punctuation">{</span>\n   count<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token operator">&lt;</span>IProps<span class="token punctuation">,</span> IState<span class="token operator">></span> <span class="token punctuation">{</span>\n   state <span class="token operator">=</span> <span class="token punctuation">{</span>\n      count<span class="token punctuation">:</span> <span class="token number">0</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>\n         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token plain-text">\n            </span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">React.PureComponent&lt;P, S={} SS={}&gt;</code> 也是差不多的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49965102715545395000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class App extends React.PureComponent<IProps, IState> {}`, `49965102715545395000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span><span class="token operator">&lt;</span>IProps<span class="token punctuation">,</span> IState<span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果定义时候我们不知道组件的 props 的类型，只有在调用时才知道组件类型，该怎么办呢？这时泛型就发挥作用了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39088686700051210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义组件\nclass MyComponent<P> extends React.Component<P> {\n   internalProp: P;\n   constructor(props: P) {\n      super(props);\n      this.internalProp = props;\n   }\n   render() {\n      return <span>hello world</span>;\n   }\n}\n\n// 使用组件\ntype IProps = { name: string; age: number };\n\n<MyComponent<IProps> name=\'React\' age={18} />; // Success\n<MyComponent<IProps> name=\'TypeScript\' age=\'hello\' />; // Error`, `39088686700051210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token comment">// 定义组件</span>\n<span class="token keyword">class</span> <span class="token class-name">MyComponent</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span><span class="token punctuation">></span></span><span class="token plain-text"> extends React.Component</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">{</span>\n   internalProp<span class="token punctuation">:</span> <span class="token constant">P</span><span class="token punctuation">;</span>\n   <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">:</span> <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>internalProp <span class="token operator">=</span> props<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token plain-text">\n\n// 使用组件\ntype IProps = </span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> age<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token plain-text">;\n\n&lt;MyComponent</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> name=\'React\' age=</span><span class="token punctuation">{</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token plain-text"> />; // Success\n&lt;MyComponent</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> name=\'TypeScript\' age=\'hello\' />; // Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="函数组件"><a href="#%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数组件</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19888398618321945000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IProps {\n   name: string;\n}\n\nconst App = (props: IProps) => {\n   const { name } = props;\n\n   return (\n      <div className=\'App\'>\n         <h1>hello world</h1>\n         <h2>{name}</h2>\n      </div>\n   );\n};\n\nexport default App;`, `19888398618321945000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">:</span> IProps</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>App<span class="token punctuation">\'</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>除此之外，函数类型还可以使用 <code class="language-text">React.FunctionComponent&lt;P={}&gt;</code> 来定义，也可以使用其简写<code class="language-text">React.FC&lt;P={}&gt;</code>，两者效果是一样的。它是一个泛型接口，可以接收一个参数，参数表示 props 的类型，这个参数不是必须的。它们就相当于这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79919266676407070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type React.FC<P = {}> = React.FunctionComponent<P>`, `79919266676407070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">type</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span> <span class="token operator">=</span> React<span class="token punctuation">.</span>FunctionComponent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>最终的定义形式如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7276111816337205000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IProps {\n   name: string;\n}\n\nconst App: React.FC<IProps> = (props) => {\n   const { name } = props;\n   return (\n      <div className=\'App\'>\n         <h1>hello world</h1>\n         <h2>{name}</h2>\n      </div>\n   );\n};\n\nexport default App;`, `7276111816337205000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> App<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = (props) => </span><span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>App<span class="token punctuation">\'</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token plain-text">;\n\nexport default App;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当使用这种形式来定义函数组件时，props 中默认会带有 children 属性，它表示该组件在调用时，其内部的元素</p>\n<p>使用 React.FC 声明函数组件和普通声明的区别如下：</p>\n<ul>\n<li>React.FC 显式地定义了返回类型，其他方式是隐式推导的；</li>\n<li>React.FC 对静态属性：displayName、propTypes、defaultProps 提供了类型检查和自动补全；</li>\n<li>React.FC 为 children 提供了隐式的类型（ReactElement | null）。</li>\n</ul>\n<p>那如果我们在定义组件时不知道 props 的类型，只有调用时才知道，那就还是用泛型来定义 props 的类型。对于使用 function 定义的函数组件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7597819478737100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 定义组件\nfunction MyComponent<P>(props: P) {\n   return <span>{props}</span>;\n}\n\n// 使用组件\ntype IProps = { name: string; age: number };\n\n<MyComponent<IProps> name=\'React\' age={18} />; // Success\n<MyComponent<IProps> name=\'TypeScript\' age=\'hello\' />; // Error`, `7597819478737100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token comment">// 定义组件</span>\n<span class="token keyword">function</span> MyComponent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span><span class="token punctuation">></span></span><span class="token plain-text">(props: P) </span><span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>props<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token plain-text">\n\n// 使用组件\ntype IProps = </span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> age<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token plain-text">;\n\n&lt;MyComponent</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> name=\'React\' age=</span><span class="token punctuation">{</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token plain-text"> />; // Success\n&lt;MyComponent</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> name=\'TypeScript\' age=\'hello\' />; // Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果使用箭头函数定义的函数组件，直接这样调用时错误的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32149062175437713000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const MyComponent = <P>(props: P) {\n  return (\n   <span>\n     {props}\n    </span>\n  );\n}`, `32149062175437713000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span><span class="token punctuation">></span></span><span class="token plain-text">(props: P) </span><span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">\n     </span><span class="token punctuation">{</span>props<span class="token punctuation">}</span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>必须使用 extends 关键字来定义泛型参数才能被成功解析：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27097618215578722000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const MyComponent = <P extends any>(props: P) {\n  return (\n   <span>\n     {props}\n    </span>\n  );\n}`, `27097618215578722000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span> <span class="token attr-name">extends</span> <span class="token attr-name">any</span><span class="token punctuation">></span></span><span class="token plain-text">(props: P) </span><span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">\n     </span><span class="token punctuation">{</span>props<span class="token punctuation">}</span><span class="token plain-text">\n    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-内置类型"><a href="#react-%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React 内置类型</h2>\n<h3 id="jsxelement"><a href="#jsxelement" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSX.Element</h3>\n<p>先来看看 JSX.Element 类型的声明：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63117156168657210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare global {\n   namespace JSX {\n      interface Element extends React.ReactElement<any, any> {}\n   }\n}`, `63117156168657210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> global <span class="token punctuation">{</span>\n   <span class="token keyword">namespace</span> <span class="token constant">JSX</span> <span class="token punctuation">{</span>\n      <span class="token keyword">interface</span> <span class="token class-name">Element</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>ReactElement</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，JSX.Element 是 ReactElement 的子类型，它没有增加属性，两者是等价的。也就是说两种类型的变量可以相互赋值。​</p>\n<p>JSX.Element 可以通过执行 React.createElement 或是转译 JSX 获得：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87769740985793070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const jsx = <div>hello</div>;\nconst ele = React.createElement(\'div\', null, \'hello\');`, `87769740985793070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> ele <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">\'hello\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="reactreactelement"><a href="#reactreactelement" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React.ReactElement</h3>\n<p>React 的类型声明文件中提供了 <code class="language-text">React.ReactElement&lt;T&gt;</code>，它可以让我们通过传入 <code class="language-text">&lt;T&gt;</code> 来注解类组件的实例化，它在声明文件中的定义如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48530418135541440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface ReactElement<P = any, T extends string | JSXElementConstructor<any> = string | JSXElementConstructor<any>> {\n   type: T;\n   props: P;\n   key: Key | null;\n}`, `48530418135541440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">ReactElement</span><span class="token operator">&lt;</span><span class="token constant">P</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span> <span class="token operator">|</span> JSXElementConstructor<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> JSXElementConstructor<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">>></span> <span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n   props<span class="token punctuation">:</span> <span class="token constant">P</span><span class="token punctuation">;</span>\n   key<span class="token punctuation">:</span> Key <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>ReactElement 是一个接口，包含 type,props,key 三个属性值。该类型的变量值只能是两种： null 和 ReactElement 实例。​</p>\n<p>通常情况下，函数组件返回 ReactElement（JSX.Element）的值。</p>\n<h3 id="reactreactnode"><a href="#reactreactnode" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React.ReactNode</h3>\n<p>ReactNode 类型的声明如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76831551381667200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ReactText = string | number;\ntype ReactChild = ReactElement | ReactText;\n\ninterface ReactNodeArray extends Array<ReactNode> {}\ntype ReactFragment = {} | ReactNodeArray;\ntype ReactNode = ReactChild | ReactFragment | ReactPortal | boolean | null | undefined;`, `76831551381667200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ReactText <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> ReactChild <span class="token operator">=</span> ReactElement <span class="token operator">|</span> ReactText<span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">ReactNodeArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token operator">&lt;</span>ReactNode<span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">type</span> ReactFragment <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">|</span> ReactNodeArray<span class="token punctuation">;</span>\n<span class="token keyword">type</span> ReactNode <span class="token operator">=</span> ReactChild <span class="token operator">|</span> ReactFragment <span class="token operator">|</span> ReactPortal <span class="token operator">|</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，ReactNode 是一个联合类型，它可以是 string、number、ReactElement、null、boolean、ReactNodeArray。由此可知。ReactElement 类型的变量可以直接赋值给 ReactNode 类型的变量，但反过来是不行的。</p>\n<p>类组件的 render 成员函数会返回 ReactNode 类型的值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55284825184764340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyComponent extends React.Component {\n   render() {\n      return <div>hello world</div>;\n   }\n}\n// 正确\nconst component: React.ReactNode<MyComponent> = <MyComponent />;\n// 错误\nconst component: React.ReactNode<MyComponent> = <OtherComponent />;`, `55284825184764340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n   <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 正确</span>\n<span class="token keyword">const</span> component<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyComponent</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyComponent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">;\n// 错误\nconst component: React.ReactNode</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyComponent</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">OtherComponent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的代码中，给 component 变量设置了类型是 Mycomponent 类型的 react 实例，这时只能给其赋值其为 MyComponent 的实例组件。​</p>\n<p>通常情况下，类组件通过 render() 返回 ReactNode 的值。</p>\n<h3 id="cssproperties"><a href="#cssproperties" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CSSProperties</h3>\n<p>先来看看 React 的声明文件中对 CSSProperties 的定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51412883153965950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export interface CSSProperties extends CSS.Properties<string | number> {\n   /**\n    * The index signature was removed to enable closed typing for style\n    * using CSSType. You\'re able to use type assertion or module augmentation\n    * to add properties or an index signature of your own.\n    *\n    * For examples and more information, visit:\n    * https://github.com/frenic/csstype#what-should-i-do-when-i-get-type-errors\n    */\n}`, `51412883153965950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">CSSProperties</span> <span class="token keyword">extends</span> <span class="token class-name">CSS<span class="token punctuation">.</span>Properties</span><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   <span class="token comment">/**\n    * The index signature was removed to enable closed typing for style\n    * using CSSType. You\'re able to use type assertion or module augmentation\n    * to add properties or an index signature of your own.\n    *\n    * For examples and more information, visit:\n    * https://github.com/frenic/csstype#what-should-i-do-when-i-get-type-errors\n    */</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>React.CSSProperties 是 React 基于 TypeScript 定义的 CSS 属性类型，可以将一个方法的返回值设置为该类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27718838349883180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import * as React from \'react\';\n\nconst classNames = require(\'./sidebar.css\');\n\ninterface Props {\n   isVisible: boolean;\n}\n\nconst divStyle = (props: Props): React.CSSProperties => ({\n   width: props.isVisible ? \'23rem\' : \'0rem\'\n});\n\nexport const SidebarComponent: React.StatelessComponent<Props> = (props) => (\n   <div id=\'mySidenav\' className={classNames.sidenav} style={divStyle(props)}>\n      {props.children}\n   </div>\n);`, `27718838349883180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> classNames <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">\'./sidebar.css\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Props</span> <span class="token punctuation">{</span>\n   isVisible<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> divStyle <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">:</span> Props<span class="token punctuation">)</span><span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token parameter">CSSProperties</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n   width<span class="token punctuation">:</span> props<span class="token punctuation">.</span>isVisible <span class="token operator">?</span> <span class="token string">\'23rem\'</span> <span class="token punctuation">:</span> <span class="token string">\'0rem\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> SidebarComponent<span class="token punctuation">:</span> React<span class="token punctuation">.</span>StatelessComponent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Props</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = (props) => (\n   </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>mySidenav<span class="token punctuation">\'</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>classNames<span class="token punctuation">.</span>sidenav<span class="token punctuation">}</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">divStyle</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token plain-text">\n   </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里 divStyle 组件的返回值就是 React.CSSProperties 类型。</p>\n<p>我们还可以定义一个 CSSProperties 类型的变量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30731372745306840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const divStyle: React.CSSProperties = {\n   width: \'11rem\',\n   height: \'7rem\',\n   backgroundColor: \\`rgb(\\${props.color.red},\\${props.color.green}, \\${props.color.blue})\\`\n};`, `30731372745306840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> divStyle<span class="token punctuation">:</span> React<span class="token punctuation">.</span>CSSProperties <span class="token operator">=</span> <span class="token punctuation">{</span>\n   width<span class="token punctuation">:</span> <span class="token string">\'11rem\'</span><span class="token punctuation">,</span>\n   height<span class="token punctuation">:</span> <span class="token string">\'7rem\'</span><span class="token punctuation">,</span>\n   backgroundColor<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rgb(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>color<span class="token punctuation">.</span>red<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>color<span class="token punctuation">.</span>green<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>color<span class="token punctuation">.</span>blue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个变量可以在 HTML 标签的 style 属性上使用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46974950090458020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div style={divStyle} />`, `46974950090458020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>divStyle<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在 React 的类型声明文件中，style 属性的类型如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49425348279266320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`style?: CSSProperties | undefined;`, `49425348279266320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts">style<span class="token operator">?</span><span class="token punctuation">:</span> CSSProperties <span class="token operator">|</span> undefined<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="react-hooks"><a href="#react-hooks" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React Hooks</h2>\n<h3 id="usestate"><a href="#usestate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useState</h3>\n<p>默认情况下，React 会为根据设置的 state 的初始值来自动推导 state 以及更新函数的类型</p>\n<p>如果已知 state 的类型，可以通过以下形式来自定义 state 的类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82071771582901960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const [count, setCount] = useState<number>(1);`, `82071771582901960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span><span class="token plain-text">(1);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果初始值为 null，需要显式地声明 state 的类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22950874511384620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const [count, setCount] = useState<number | null>(null);`, `22950874511384620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token operator">&lt;</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果 state 是一个对象，想要初始化一个空对象，可以使用断言来处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5959979615523880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const [user, setUser] = React.useState<IUser>({} as IUser);`, `5959979615523880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span>useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IUser</span></span><span class="token punctuation">></span></span><span class="token plain-text">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain-text"> as IUser);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>实际上，这里将空对象 <code class="language-text">{}</code> 断言为 IUser 接口就是欺骗了 TypeScript 的编译器，由于后面的代码可能会依赖这个对象，所以应该在使用前及时初始化 user 的值，否则就会报错。</p>\n<p>下面是声明文件中 useState 的定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35998898192724615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function useState<S>(initialState: S | (() => S)): [S, Dispatch<SetStateAction<S>>];\n// convenience overload when first argument is omitted\n/**\n * Returns a stateful value, and a function to update it.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usestate\n */\n\nfunction useState<S = undefined>(): [S | undefined, Dispatch<SetStateAction<S | undefined>>];\n/**\n * An alternative to \\`useState\\`.\n *\n * \\`useReducer\\` is usually preferable to \\`useState\\` when you have complex state logic that involves\n * multiple sub-values. It also lets you optimize performance for components that trigger deep\n * updates because you can pass \\`dispatch\\` down instead of callbacks.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usereducer\n */`, `35998898192724615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> useState<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">></span><span class="token punctuation">(</span>initialState<span class="token punctuation">:</span> <span class="token constant">S</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">S</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">S</span><span class="token punctuation">,</span> Dispatch<span class="token operator">&lt;</span>SetStateAction<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">>></span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token comment">// convenience overload when first argument is omitted</span>\n<span class="token comment">/**\n * Returns a stateful value, and a function to update it.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usestate\n */</span>\n\n<span class="token keyword">function</span> useState<span class="token operator">&lt;</span><span class="token constant">S</span> <span class="token operator">=</span> undefined<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">S</span> <span class="token operator">|</span> undefined<span class="token punctuation">,</span> Dispatch<span class="token operator">&lt;</span>SetStateAction<span class="token operator">&lt;</span><span class="token constant">S</span> <span class="token operator">|</span> undefined<span class="token operator">>></span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token comment">/**\n * An alternative to `useState`.\n *\n * `useReducer` is usually preferable to `useState` when you have complex state logic that involves\n * multiple sub-values. It also lets you optimize performance for components that trigger deep\n * updates because you can pass `dispatch` down instead of callbacks.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usereducer\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，这里定义两种形式，分别是有初始值和没有初始值的形式。</p>\n<h3 id="useeffect"><a href="#useeffect" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useEffect</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59621373407249290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`useEffect(() => {\n   const subscription = props.source.subscribe();\n   return () => {\n      subscription.unsubscribe();\n   };\n}, [props.source]);`, `59621373407249290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> subscription <span class="token operator">=</span> props<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      subscription<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>props<span class="token punctuation">.</span>source<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当函数的返回值不是函数或者 effect 函数中未定义的内容时，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13240529860971418000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`useEffect(() => {\n   subscribe();\n   return null; // Type \'null\' is not assignable to type \'void | Destructor\'\n});`, `13240529860971418000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// Type \'null\' is not assignable to type \'void | Destructor\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>来看看 useEffect 在类型声明文件中的定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69875081128054540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Destructors are only allowed to return void.\ntype Destructor = () => void | { [UNDEFINED_VOID_ONLY]: never };\n\n// NOTE: callbacks are _only_ allowed to return either void, or a destructor.\ntype EffectCallback = () => void | Destructor;\n\n// (TypeScript 3.0): ReadonlyArray<unknown>\ntype DependencyList = ReadonlyArray<any>;\n\nfunction useEffect(effect: EffectCallback, deps?: DependencyList): void;\n// NOTE: this does not accept strings, but this will have to be fixed by removing strings from type Ref<T>\n/**\n * \\`useImperativeHandle\\` customizes the instance value that is exposed to parent components when using\n * \\`ref\\`. As always, imperative code using refs should be avoided in most cases.\n *\n * \\`useImperativeHandle\\` should be used with \\`React.forwardRef\\`.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#useimperativehandle\n */`, `69875081128054540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// Destructors are only allowed to return void.</span>\n<span class="token keyword">type</span> <span class="token function-variable function">Destructor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token operator">|</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">UNDEFINED_VOID_ONLY</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">never</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// NOTE: callbacks are _only_ allowed to return either void, or a destructor.</span>\n<span class="token keyword">type</span> <span class="token function-variable function">EffectCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token operator">|</span> Destructor<span class="token punctuation">;</span>\n\n<span class="token comment">// (TypeScript 3.0): ReadonlyArray&lt;unknown></span>\n<span class="token keyword">type</span> DependencyList <span class="token operator">=</span> ReadonlyArray<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token parameter">effect<span class="token punctuation">:</span> EffectCallback<span class="token punctuation">,</span> deps<span class="token operator">?</span><span class="token punctuation">:</span> DependencyList</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token comment">// NOTE: this does not accept strings, but this will have to be fixed by removing strings from type Ref&lt;T></span>\n<span class="token comment">/**\n * `useImperativeHandle` customizes the instance value that is exposed to parent components when using\n * `ref`. As always, imperative code using refs should be avoided in most cases.\n *\n * `useImperativeHandle` should be used with `React.forwardRef`.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#useimperativehandle\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看到，useEffect 的第一个参数只允许返回一个函数。</p>\n<h3 id="useref"><a href="#useref" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useRef</h3>\n<p>当使用 useRef 时，我们可以访问一个可变的引用对象。可以将初始值传递给 useRef，它用于初始化可变 ref 对象公开的当前属性。当我们使用 useRef 时，需要给其指定类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82454231540741180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const nameInput = React.useRef<HTMLInputElement>(null);`, `82454231540741180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> nameInput <span class="token operator">=</span> React<span class="token punctuation">.</span>useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLInputElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">(null);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这里给实例的类型指定为了 input 输入框类型。​</p>\n<p>当 useRef 的初始值为 null 时，有两种创建的形式，第一种：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82715275512629500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const nameInput = React.useRef<HTMLInputElement>(null);\nnameInput.current.innerText = \'hello world\';`, `82715275512629500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> nameInput <span class="token operator">=</span> React<span class="token punctuation">.</span>useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLInputElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">(null);\nnameInput.current.innerText = \'hello world\';</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这种形式下，ref1.current 是只读的（read-only），所以当我们将它的 innerText 属性重新赋值时会报以下错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67121579831683590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Cannot assign to \'current\' because it is a read-only property.`, `67121579831683590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title=""\n              >\n                \n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Cannot assign to &#39;current&#39; because it is a read-only property.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>那该怎么将 current 属性变为动态可变得的，先来看看类型声明文件中 useRef 是如何定义的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68458509935172215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function useRef<T>(initialValue: T): MutableRefObject<T>;\n// convenience overload for refs given as a ref prop as they typically start with a null value\n/**\n * \\`useRef\\` returns a mutable ref object whose \\`.current\\` property is initialized to the passed argument\n * (\\`initialValue\\`). The returned object will persist for the full lifetime of the component.\n *\n * Note that \\`useRef()\\` is useful for more than the \\`ref\\` attribute. It’s handy for keeping any mutable\n * value around similar to how you’d use instance fields in classes.\n *\n * Usage note: if you need the result of useRef to be directly mutable, include \\`| null\\` in the type\n * of the generic argument.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#useref\n */`, `68458509935172215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> useRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>initialValue<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> MutableRefObject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token comment">// convenience overload for refs given as a ref prop as they typically start with a null value</span>\n<span class="token comment">/**\n * `useRef` returns a mutable ref object whose `.current` property is initialized to the passed argument\n * (`initialValue`). The returned object will persist for the full lifetime of the component.\n *\n * Note that `useRef()` is useful for more than the `ref` attribute. It’s handy for keeping any mutable\n * value around similar to how you’d use instance fields in classes.\n *\n * Usage note: if you need the result of useRef to be directly mutable, include `| null` in the type\n * of the generic argument.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#useref\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段代码告诉我们，如果需要 useRef 的直接可变，就需要在泛型参数中包含 <code class="language-text">| null</code>，所以这就是当初始值为 null 的第二种定义形式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28493585630132400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const nameInput = React.useRef<HTMLInputElement | null>(null);`, `28493585630132400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> nameInput <span class="token operator">=</span> React<span class="token punctuation">.</span>useRef<span class="token operator">&lt;</span>HTMLInputElement <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这种形式下，nameInput.current 就是可写的。不过两种类型在使用时都需要做类型检查：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35716422224610935000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`nameInput.current?.innerText = &quot;hello world&quot;;`, `35716422224610935000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx">nameInput<span class="token punctuation">.</span>current<span class="token operator">?</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>那么问题来了，为什么第一种写法在没有操作 current 时没有报错呢？因为 useRef 在类型定义式具有多个重载声明，第一种方式就是执行的以下函数重载：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47036318568378910000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function useRef<T>(initialValue: T | null): RefObject<T>;\n// convenience overload for potentially undefined initialValue / call with 0 arguments\n// has a default to stop it from defaulting to {} instead\n/**\n * \\`useRef\\` returns a mutable ref object whose \\`.current\\` property is initialized to the passed argument\n * (\\`initialValue\\`). The returned object will persist for the full lifetime of the component.\n *\n * Note that \\`useRef()\\` is useful for more than the \\`ref\\` attribute. It’s handy for keeping any mutable\n * value around similar to how you’d use instance fields in classes.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#useref\n */`, `47036318568378910000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> useRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>initialValue<span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">:</span> RefObject<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token comment">// convenience overload for potentially undefined initialValue / call with 0 arguments</span>\n<span class="token comment">// has a default to stop it from defaulting to {} instead</span>\n<span class="token comment">/**\n * `useRef` returns a mutable ref object whose `.current` property is initialized to the passed argument\n * (`initialValue`). The returned object will persist for the full lifetime of the component.\n *\n * Note that `useRef()` is useful for more than the `ref` attribute. It’s handy for keeping any mutable\n * value around similar to how you’d use instance fields in classes.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#useref\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>从 useRef 的声明中可以看到，function useRef 的返回值类型化是 MutableRefObject，这里面的 T 就是参数的类型 T，所以最终 nameInput 的类型就是 React.MutableRefObject。</p>\n<p>注意，上面用到了 HTMLInputElement 类型，这是一个标签类型，这个操作就是用来访问 DOM 元素的。</p>\n<h3 id="usecallback"><a href="#usecallback" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useCallback</h3>\n<p>先来看看类型声明文件中对 useCallback 的定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40489085808304860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function useCallback<T extends (...args: any[]) => any>(callback: T, deps: DependencyList): T;\n/**\n * \\`useMemo\\` will only recompute the memoized value when one of the \\`deps\\` has changed.\n *\n * Usage note: if calling \\`useMemo\\` with a referentially stable function, also give it as the input in\n * the second argument.\n *\n * \\`\\`\\`ts\n * function expensive () { ... }\n *\n * function Component () {\n *   const expensiveResult = useMemo(expensive, [expensive])\n *   return ...\n * }\n * \\`\\`\\`\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usememo\n */`, `40489085808304860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> useCallback<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">(</span>callback<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> deps<span class="token punctuation">:</span> DependencyList<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n<span class="token comment">/**\n * `useMemo` will only recompute the memoized value when one of the `deps` has changed.\n *\n * Usage note: if calling `useMemo` with a referentially stable function, also give it as the input in\n * the second argument.\n *\n * ```ts\n * function expensive () { ... }\n *\n * function Component () {\n *   const expensiveResult = useMemo(expensive, [expensive])\n *   return ...\n * }\n * ```\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usememo\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>useCallback 接收一个回调函数和一个依赖数组，只有当依赖数组中的值发生变化时才会重新执行回调函数。来看一个例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71711352797709615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const add = (a: number, b: number) => a + b;\n\nconst memoizedCallback = useCallback(\n   (a) => {\n      add(a, b);\n   },\n   [b]\n);`, `71711352797709615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>\n   <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">[</span>b<span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里我们没有给回调函数中的参数 a 定义类型，所以下面的调用方式都不会报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38653039209338250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`memoizedCallback(\'hello\');\nmemoizedCallback(5);`, `38653039209338250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token function">memoizedCallback</span><span class="token punctuation">(</span><span class="token string">\'hello\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">memoizedCallback</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>尽管 add 方法的两个参数都是 number 类型，但是上述调用都能够用执行。所以为了更加严谨，我们需要给回调函数定义具体的类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36778781336643473000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const memoizedCallback = useCallback(\n   (a: number) => {\n      add(a, b);\n   },\n   [b]\n);`, `36778781336643473000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>\n   <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">[</span>b<span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这时候如果再给回调函数传入字符串就会报错了，需要注意在使用 useCallback 时需要给回调函数的参数指定类型。</p>\n<h3 id="usememo"><a href="#usememo" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useMemo</h3>\n<p>先来看看类型声明文件中对 useMemo 的定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65388367740019290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function useMemo<T>(factory: () => T, deps: DependencyList | undefined): T;\n/**\n * \\`useDebugValue\\` can be used to display a label for custom hooks in React DevTools.\n *\n * NOTE: We don’t recommend adding debug values to every custom hook.\n * It’s most valuable for custom hooks that are part of shared libraries.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usedebugvalue\n */`, `65388367740019290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> useMemo<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token function-variable function">factory</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">,</span> deps<span class="token punctuation">:</span> DependencyList <span class="token operator">|</span> undefined<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n<span class="token comment">/**\n * `useDebugValue` can be used to display a label for custom hooks in React DevTools.\n *\n * NOTE: We don’t recommend adding debug values to every custom hook.\n * It’s most valuable for custom hooks that are part of shared libraries.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usedebugvalue\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>useMemo 和 useCallback 是非常类似的，但是它返回的是一个值，而不是函数。所以在定义 useMemo 时需要定义返回值的类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9356186644011876000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`let a = 1;\nsetTimeout(() => {\n   a += 1;\n}, 1000);\n\nconst calculatedValue = useMemo<number>(() => a ** 2, [a]);`, `9356186644011876000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   a <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> calculatedValue <span class="token operator">=</span> useMemo<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果返回值不一致，就会报错</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89005499692170180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const calculatedValue = useMemo<number>(() => a + \'hello\', [a]);\n// 类型“() => string”的参数不能赋给类型“() => number”的参数`, `89005499692170180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> calculatedValue <span class="token operator">=</span> useMemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>number</span><span class="token punctuation">></span></span><span class="token plain-text">(() => a + \'hello\', [a]);\n// 类型“() => string”的参数不能赋给类型“() => number”的参数</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="usecontext"><a href="#usecontext" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useContext</h3>\n<p>useContext 需要提供一个上下文对象，并返回所提供的上下文的值，当提供者更新上下文对象时，引用这些上下文对象的组件就会重新渲染：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9757343424155240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const ColorContext = React.createContext({ color: \'green\' });\n\nconst Welcome = () => {\n   const { color } = useContext(ColorContext);\n   return <div style={{ color }}>hello world</div>;\n};`, `9757343424155240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> ColorContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">\'green\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Welcome</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> color <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ColorContext<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在使用 useContext 时，会自动推断出提供的上下文对象的类型，所以并不需要我们手动设置 context 的类型。当前，我们也可以使用泛型来设置 context 的类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47962846721396550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IColor {\n   color: string;\n}\n\nconst ColorContext = React.createContext<IColor>({ color: \'green\' });`, `47962846721396550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">IColor</span> <span class="token punctuation">{</span>\n   color<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> ColorContext <span class="token operator">=</span> React<span class="token punctuation">.</span>createContext<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IColor</span></span><span class="token punctuation">></span></span><span class="token plain-text">(</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> <span class="token string">\'green\'</span> <span class="token punctuation">}</span><span class="token plain-text">);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下面是 useContext 在类型声明文件中的定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13329222854442314000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function useContext<T>(context: Context<T> /*, (not public API) observedBits?: number|boolean */): T;\n/**\n * Returns a stateful value, and a function to update it.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usestate\n */`, `13329222854442314000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> useContext<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>context<span class="token punctuation">:</span> Context<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token comment">/*, (not public API) observedBits?: number|boolean */</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n<span class="token comment">/**\n * Returns a stateful value, and a function to update it.\n *\n * @version 16.8.0\n * @see https://reactjs.org/docs/hooks-reference.html#usestate\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="usereducer"><a href="#usereducer" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useReducer</h3>\n<p>有时我们需要处理一些复杂的状态，并且可能取决于之前的状态。这时候就可以使用 useReducer，它接收一个函数，这个函数会根据之前的状态来计算一个新的 state。其语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76492901466212430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const [state, dispatch] = useReducer(reducer, initialArg, init);`, `76492901466212430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialArg<span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>来看下面的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84783672005665460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const reducer = (state, action) => {\n   switch (action.type) {\n      case \'increment\':\n         return { count: state.count + 1 };\n      case \'decrement\':\n         return { count: state.count - 1 };\n      default:\n         throw new Error();\n   }\n};\n\nconst Counter = () => {\n   const initialState = { count: 0 };\n   const [state, dispatch] = useReducer(reducer, initialState);\n\n   return (\n      <>\n         Count: {state.count}\n         <button onClick={() => dispatch({ type: \'increment\' })}>+</button>\n         <button onClick={() => dispatch({ type: \'decrement\' })}>-</button>\n      </>\n   );\n};`, `84783672005665460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">case</span> <span class="token string">\'increment\'</span><span class="token punctuation">:</span>\n         <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">case</span> <span class="token string">\'decrement\'</span><span class="token punctuation">:</span>\n         <span class="token keyword">return</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">default</span><span class="token punctuation">:</span>\n         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Counter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n         Count: </span><span class="token punctuation">{</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'increment\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'decrement\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">-</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当前的状态是无法推断出来的，可以给 reducer 函数添加类型，通过给 reducer 函数定义 state 和 action 来推断 useReducer 的类型，下面来修改上面的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37481447126328615000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ActionType = {\n   type: \'increment\' | \'decrement\';\n};\n\ntype State = { count: number };\n\nconst initialState: State = { count: 0 };\nconst reducer = (state: State, action: ActionType) => {\n   // ...\n};`, `37481447126328615000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">type</span> ActionType <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'increment\'</span> <span class="token operator">|</span> <span class="token string">\'decrement\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> State <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> initialState<span class="token punctuation">:</span> State <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">:</span> State<span class="token punctuation">,</span> action<span class="token punctuation">:</span> ActionType</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样，在 Counter 函数中就可以推断出类型。当我们视图使用一个不存在的类型时，就会报错：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13864172989143620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dispatch({ type: \'reset\' });\n// Error! type \'&quot;reset&quot;\' is not assignable to type \'&quot;increment&quot; | &quot;decrement&quot;\'`, `13864172989143620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'reset\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Error! type \'"reset"\' is not assignable to type \'"increment" | "decrement"\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>除此之外，还可以使用泛型的形式来实现 reducer 函数的类型定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46819219591673210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ActionType = {\n   type: \'increment\' | \'decrement\';\n};\n\ntype State = { count: number };\n\nconst reducer: React.Reducer<State, ActionType> = (state, action) => {\n   // ...\n};`, `46819219591673210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ActionType <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'increment\'</span> <span class="token operator">|</span> <span class="token string">\'decrement\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> State <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> reducer<span class="token punctuation">:</span> React<span class="token punctuation">.</span>Reducer<span class="token operator">&lt;</span>State<span class="token punctuation">,</span> ActionType<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="事件处理"><a href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>事件处理</h2>\n<h3 id="event-事件类型"><a href="#event-%E4%BA%8B%E4%BB%B6%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Event 事件类型</h3>\n<p>常见的 Event 事件对象如下：</p>\n<ul>\n<li>剪切板事件对象：<code class="language-text">ClipboardEvent&lt;T = Element&gt;</code></li>\n<li>拖拽事件对象：<code class="language-text">DragEvent&lt;T = Element&gt;</code></li>\n<li>焦点事件对象：<code class="language-text">FocusEvent&lt;T = Element&gt;</code></li>\n<li>表单事件对象：<code class="language-text">FormEvent&lt;T = Element&gt;</code></li>\n<li>Change 事件对象：<code class="language-text">ChangeEvent&lt;T = Element&gt;</code></li>\n<li>键盘事件对象：<code class="language-text">KeyboardEvent&lt;T = Element&gt;</code></li>\n<li>鼠标事件对象：<code class="language-text">MouseEvent&lt;T = Element, E = NativeMouseEvent&gt;</code></li>\n<li>触摸事件对象：<code class="language-text">TouchEvent&lt;T = Element&gt;</code></li>\n<li>滚轮事件对象：<code class="language-text">WheelEvent&lt;T = Element&gt;</code></li>\n<li>动画事件对象：<code class="language-text">AnimationEvent&lt;T = Element&gt;</code></li>\n<li>过渡事件对象：<code class="language-text">TransitionEvent&lt;T = Element&gt;</code></li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34467518503974314000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type State = {\n   text: string;\n};\n\nconst App: React.FC = () => {\n   const [text, setText] = useState<string>(\'\');\n\n   const onChange = (e: React.FormEvent<HTMLInputElement>): void => {\n      setText(e.currentTarget.value);\n   };\n\n   return (\n      <div>\n         <input type=\'text\' value={text} onChange={this.onChange} />\n      </div>\n   );\n};`, `34467518503974314000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">type</span> State <span class="token operator">=</span> <span class="token punctuation">{</span>\n   text<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> App<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span><span class="token plain-text">(\'\');\n\n   const onChange = (e: React.FormEvent</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLInputElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">): void => </span><span class="token punctuation">{</span>\n      <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token plain-text">;\n\n   return (\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>text<span class="token punctuation">\'</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n   );\n};</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里就给 onChange 方法的事件对象定义为了 FormEvent 类型，并且作用的对象时一个 HTMLInputElement 类型的标签（input 标签） ​ 可以来看下 MouseEvent 事件对象和 ChangeEvent 事件对象的类型声明，其他事件对象的声明形似也类似：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72327838684975680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface MouseEvent<T = Element, E = NativeMouseEvent> extends UIEvent<T, E> {\n   altKey: boolean;\n   button: number;\n   buttons: number;\n   clientX: number;\n   clientY: number;\n   ctrlKey: boolean;\n   /**\n    * See [DOM Level 3 Events spec](https://www.w3.org/TR/uievents-key/#keys-modifier). for a list of valid (case-sensitive) arguments to this method.\n    */\n   getModifierState(key: string): boolean;\n   metaKey: boolean;\n   movementX: number;\n   movementY: number;\n   pageX: number;\n   pageY: number;\n   relatedTarget: EventTarget | null;\n   screenX: number;\n   screenY: number;\n   shiftKey: boolean;\n}\n\ninterface ChangeEvent<T = Element> extends SyntheticEvent<T> {\n   target: EventTarget & T;\n}`, `72327838684975680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">MouseEvent</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token punctuation">,</span> <span class="token constant">E</span> <span class="token operator">=</span> NativeMouseEvent<span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">UIEvent</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">E</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   altKey<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   button<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   buttons<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   clientX<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   clientY<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   ctrlKey<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   <span class="token comment">/**\n    * See [DOM Level 3 Events spec](https://www.w3.org/TR/uievents-key/#keys-modifier). for a list of valid (case-sensitive) arguments to this method.\n    */</span>\n   <span class="token function">getModifierState</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   metaKey<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   movementX<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   movementY<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   pageX<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   pageY<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   relatedTarget<span class="token punctuation">:</span> EventTarget <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n   screenX<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   screenY<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   shiftKey<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">ChangeEvent</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">SyntheticEvent</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   target<span class="token punctuation">:</span> EventTarget <span class="token operator">&amp;</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在很多事件对象的声明文件中都可以看到 EventTarget 的身影。这是因为 DOM 的事件操作（监听和触发）都定义在 EventTarget 接口上。EventTarget 的类型声明如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13418015779865900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface EventTarget {\n   addEventListener(\n      type: string,\n      listener: EventListenerOrEventListenerObject | null,\n      options?: boolean | AddEventListenerOptions\n   ): void;\n   dispatchEvent(evt: Event): boolean;\n   removeEventListener(\n      type: string,\n      listener?: EventListenerOrEventListenerObject | null,\n      options?: EventListenerOptions | boolean\n   ): void;\n}`, `13418015779865900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">EventTarget</span> <span class="token punctuation">{</span>\n   <span class="token function">addEventListener</span><span class="token punctuation">(</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>\n      listener<span class="token punctuation">:</span> EventListenerOrEventListenerObject <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n      options<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> AddEventListenerOptions\n   <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n   <span class="token function">dispatchEvent</span><span class="token punctuation">(</span>evt<span class="token punctuation">:</span> Event<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   <span class="token function">removeEventListener</span><span class="token punctuation">(</span>\n      <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>\n      listener<span class="token operator">?</span><span class="token punctuation">:</span> EventListenerOrEventListenerObject <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n      options<span class="token operator">?</span><span class="token punctuation">:</span> EventListenerOptions <span class="token operator">|</span> <span class="token builtin">boolean</span>\n   <span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>比如在 change 事件中，会使用的 e.target 来获取当前的值，它的的类型就是 EventTarget。来看下面的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51474346090378990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<input onChange={(e) => onSourceChange(e)} placeholder=\'最多30个字\' />;\n\nconst onSourceChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n   if (e.target.value.length > 30) {\n      message.error(\'请长度不能超过30个字，请重新输入\');\n      return;\n   }\n   setSourceInput(e.target.value);\n};`, `51474346090378990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">onSourceChange</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>最多30个字<span class="token punctuation">\'</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> onSourceChange <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ChangeEvent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLInputElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">) => </span><span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">\'请长度不能超过30个字，请重新输入\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token function">setSourceInput</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token plain-text">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="事件处理函数类型"><a href="#%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>事件处理函数类型</h3>\n<p>React 也为我们提供了贴心的提供了事件处理函数的类型声明，来看看所有的事件处理函数的类型声明：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7384338452548400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type EventHandler<E extends SyntheticEvent<any>> = { bivarianceHack(event: E): void }[\'bivarianceHack\'];\n\ntype ReactEventHandler<T = Element> = EventHandler<SyntheticEvent<T>>;\n// 剪切板事件处理函数\ntype ClipboardEventHandler<T = Element> = EventHandler<ClipboardEvent<T>>;\n// 复合事件处理函数\ntype CompositionEventHandler<T = Element> = EventHandler<CompositionEvent<T>>;\n// 拖拽事件处理函数\ntype DragEventHandler<T = Element> = EventHandler<DragEvent<T>>;\n// 焦点事件处理函数\ntype FocusEventHandler<T = Element> = EventHandler<FocusEvent<T>>;\n// 表单事件处理函数\ntype FormEventHandler<T = Element> = EventHandler<FormEvent<T>>;\n// Change事件处理函数\ntype ChangeEventHandler<T = Element> = EventHandler<ChangeEvent<T>>;\n// 键盘事件处理函数\ntype KeyboardEventHandler<T = Element> = EventHandler<KeyboardEvent<T>>;\n// 鼠标事件处理函数\ntype MouseEventHandler<T = Element> = EventHandler<MouseEvent<T>>;\n// 触屏事件处理函数\ntype TouchEventHandler<T = Element> = EventHandler<TouchEvent<T>>;\n// 指针事件处理函数\ntype PointerEventHandler<T = Element> = EventHandler<PointerEvent<T>>;\n// 界面事件处理函数\ntype UIEventHandler<T = Element> = EventHandler<UIEvent<T>>;\n// 滚轮事件处理函数\ntype WheelEventHandler<T = Element> = EventHandler<WheelEvent<T>>;\n// 动画事件处理函数\ntype AnimationEventHandler<T = Element> = EventHandler<AnimationEvent<T>>;\n// 过渡事件处理函数\ntype TransitionEventHandler<T = Element> = EventHandler<TransitionEvent<T>>;`, `7384338452548400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> EventHandler<span class="token operator">&lt;</span><span class="token constant">E</span> <span class="token keyword">extends</span> <span class="token class-name">SyntheticEvent</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">>></span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function">bivarianceHack</span><span class="token punctuation">(</span>event<span class="token punctuation">:</span> <span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token string">\'bivarianceHack\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ReactEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>SyntheticEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 剪切板事件处理函数</span>\n<span class="token keyword">type</span> ClipboardEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>ClipboardEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 复合事件处理函数</span>\n<span class="token keyword">type</span> CompositionEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>CompositionEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 拖拽事件处理函数</span>\n<span class="token keyword">type</span> DragEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>DragEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 焦点事件处理函数</span>\n<span class="token keyword">type</span> FocusEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>FocusEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 表单事件处理函数</span>\n<span class="token keyword">type</span> FormEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>FormEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// Change事件处理函数</span>\n<span class="token keyword">type</span> ChangeEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>ChangeEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 键盘事件处理函数</span>\n<span class="token keyword">type</span> KeyboardEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>KeyboardEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 鼠标事件处理函数</span>\n<span class="token keyword">type</span> MouseEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>MouseEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 触屏事件处理函数</span>\n<span class="token keyword">type</span> TouchEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>TouchEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 指针事件处理函数</span>\n<span class="token keyword">type</span> PointerEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>PointerEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 界面事件处理函数</span>\n<span class="token keyword">type</span> UIEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>UIEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 滚轮事件处理函数</span>\n<span class="token keyword">type</span> WheelEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>WheelEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 动画事件处理函数</span>\n<span class="token keyword">type</span> AnimationEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>AnimationEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n<span class="token comment">// 过渡事件处理函数</span>\n<span class="token keyword">type</span> TransitionEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> Element<span class="token operator">></span> <span class="token operator">=</span> EventHandler<span class="token operator">&lt;</span>TransitionEvent<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里面的 T 的类型也都是 Element，指的是触发该事件的 HTML 标签元素的类型</p>\n<p>EventHandler 会接收一个 E，它表示事件处理函数中 Event 对象的类型。bivarianceHack 是事件处理函数的类型定义，函数接收一个 Event 对象，并且其类型为接收到的泛型变量 E 的类型，返回值为 void。</p>\n<p>还看上面的那个例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43368886509774500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type State = {\n   text: string;\n};\n\nconst App: React.FC = () => {\n   const [text, setText] = useState<string>(\'\');\n\n   const onChange: React.ChangeEventHandler<HTMLInputElement> = (e) => {\n      setText(e.currentTarget.value);\n   };\n\n   return (\n      <div>\n         <input type=\'text\' value={text} onChange={this.onChange} />\n      </div>\n   );\n};`, `43368886509774500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">type</span> State <span class="token operator">=</span> <span class="token punctuation">{</span>\n   text<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> App<span class="token punctuation">:</span> React<span class="token punctuation">.</span><span class="token function-variable function">FC</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> useState<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span><span class="token plain-text">(\'\');\n\n   const onChange: React.ChangeEventHandler</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLInputElement</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = (e) => </span><span class="token punctuation">{</span>\n      <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token plain-text">;\n\n   return (\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>text<span class="token punctuation">\'</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n   );\n};</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里给 onChange 方法定义了方法的类型，它是一个 ChangeEventHandler 的类型，并且作用的对象时一个 HTMLImnputElement 类型的标签（input 标签）。</p>\n<h2 id="html-标签类型"><a href="#html-%E6%A0%87%E7%AD%BE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML 标签类型</h2>\n<h3 id="常见标签类型"><a href="#%E5%B8%B8%E8%A7%81%E6%A0%87%E7%AD%BE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常见标签类型</h3>\n<p>所有的 HTML 标签的类型都被定义在 intrinsicElements 接口中，常见的标签及其类型如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94808273326559080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a: HTMLAnchorElement;\nbody: HTMLBodyElement;\nbr: HTMLBRElement;\nbutton: HTMLButtonElement;\ndiv: HTMLDivElement;\nh1: HTMLHeadingElement;\nh2: HTMLHeadingElement;\nh3: HTMLHeadingElement;\nhtml: HTMLHtmlElement;\nimg: HTMLImageElement;\ninput: HTMLInputElement;\nul: HTMLUListElement;\nli: HTMLLIElement;\nlink: HTMLLinkElement;\np: HTMLParagraphElement;\nspan: HTMLSpanElement;\nstyle: HTMLStyleElement;\ntable: HTMLTableElement;\ntbody: HTMLTableSectionElement;\nvideo: HTMLVideoElement;\naudio: HTMLAudioElement;\nmeta: HTMLMetaElement;\nform: HTMLFormElement;`, `94808273326559080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts">a<span class="token punctuation">:</span> HTMLAnchorElement<span class="token punctuation">;</span>\nbody<span class="token punctuation">:</span> HTMLBodyElement<span class="token punctuation">;</span>\nbr<span class="token punctuation">:</span> HTMLBRElement<span class="token punctuation">;</span>\nbutton<span class="token punctuation">:</span> HTMLButtonElement<span class="token punctuation">;</span>\ndiv<span class="token punctuation">:</span> HTMLDivElement<span class="token punctuation">;</span>\nh1<span class="token punctuation">:</span> HTMLHeadingElement<span class="token punctuation">;</span>\nh2<span class="token punctuation">:</span> HTMLHeadingElement<span class="token punctuation">;</span>\nh3<span class="token punctuation">:</span> HTMLHeadingElement<span class="token punctuation">;</span>\nhtml<span class="token punctuation">:</span> HTMLHtmlElement<span class="token punctuation">;</span>\nimg<span class="token punctuation">:</span> HTMLImageElement<span class="token punctuation">;</span>\ninput<span class="token punctuation">:</span> HTMLInputElement<span class="token punctuation">;</span>\nul<span class="token punctuation">:</span> HTMLUListElement<span class="token punctuation">;</span>\nli<span class="token punctuation">:</span> HTMLLIElement<span class="token punctuation">;</span>\nlink<span class="token punctuation">:</span> HTMLLinkElement<span class="token punctuation">;</span>\np<span class="token punctuation">:</span> HTMLParagraphElement<span class="token punctuation">;</span>\nspan<span class="token punctuation">:</span> HTMLSpanElement<span class="token punctuation">;</span>\nstyle<span class="token punctuation">:</span> HTMLStyleElement<span class="token punctuation">;</span>\ntable<span class="token punctuation">:</span> HTMLTableElement<span class="token punctuation">;</span>\ntbody<span class="token punctuation">:</span> HTMLTableSectionElement<span class="token punctuation">;</span>\nvideo<span class="token punctuation">:</span> HTMLVideoElement<span class="token punctuation">;</span>\naudio<span class="token punctuation">:</span> HTMLAudioElement<span class="token punctuation">;</span>\nmeta<span class="token punctuation">:</span> HTMLMetaElement<span class="token punctuation">;</span>\nform<span class="token punctuation">:</span> HTMLFormElement<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那什么时候会使用到标签类型呢，上面 Event 事件类型和事件处理函数类型中都使用到了标签的类型。上面的很多的类型都需要传入一个 ELement 类型的泛型参数，这个泛型参数就是对应的标签类型值，可以根据标签来选择对应的标签类型。这些类型都继承自 HTMLElement 类型，如果使用时对类型类型要求不高，可以直接写 HTMLELement。</p>\n<p>比如下面的例子：</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="61528836118747490000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<Button\n   type=\'text\'\n   onClick={(e: React.MouseEvent<HTMLElement>) => {\n      handleOperate();\n      e.stopPropagation();\n   }}\n>\n   <img data-src={cancelChangeIcon} alt=\'\' />\n   取消修改\n</Button>`, `61528836118747490000`)">\n              <div class="gatsby-code-button" title="tsx">\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>\n   <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>text<span class="token punctuation">\'</span></span>\n   <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span>e<span class="token punctuation">:</span> React<span class="token punctuation">.</span>MouseEvent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">) => </span><span class="token punctuation">{</span>\n      <span class="token function">handleOperate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token plain-text">}</span></span>\n<span class="token punctuation">></span></span><span class="token plain-text">\n   </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>cancelChangeIcon<span class="token punctuation">}</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span><span class="token punctuation">\'</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n   取消修改\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其实，在直接操作 DOM 时也会用到标签类型，虽然我们现在通常会使用框架来开发，但是有时候也避免不了直接操作 DOM。比如项目中的某一部分组件是通过 npm 来引入的其他组的组件，而在很多时候，需要动态的去个性化这个组件的样式，最直接的办法就是通过原生 JavaScript 获取到 DOM 元素，来进行样式的修改，这时候就会用到标签类型。 ​ 来看下面的例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93932292027033700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.querySelectorAll(\'.paper\').forEach((item) => {\n   const firstPageHasAddEle = (item.firstChild as HTMLDivElement).classList.contains(\'add-ele\');\n\n   if (firstPageHasAddEle) {\n      item.removeChild(item.firstChild as ChildNode);\n   }\n});`, `93932292027033700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts">document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'.paper\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> firstPageHasAddEle <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>firstChild <span class="token keyword">as</span> HTMLDivElement<span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">\'add-ele\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>firstPageHasAddEle<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      item<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>firstChild <span class="token keyword">as</span> ChildNode<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在第一页有个 add-ele 元素的时候就删除它。这里我们将 item.firstChild 断言成了 HTMLDivElement 类型，如果不断言，item.firstChild 的类型就是 ChildNode，而 ChildNode 类型中是不存在 classList 属性的，所以就就会报错，当我们把他断言成 HTMLDivElement 类型时，就不会报错了。很多时候，标签类型可以和断言（as）一起使用。</p>\n<p>后面在 removeChild 时又使用了 as 断言，为什么呢？item.firstChild 不是已经自动识别为 ChildNode 类型了吗？因为 TS 会认为，我们可能不能获取到类名为 paper 的元素，所以 item.firstChild 的类型就被推断为 ChildNode | null，我们有时候比 TS 更懂我们定义的元素，知道页面一定存在 paper 元素，所以可以直接将 item.firstChild 断言成 ChildNode 类型。</p>\n<h3 id="标签属性类型"><a href="#%E6%A0%87%E7%AD%BE%E5%B1%9E%E6%80%A7%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>标签属性类型</h3>\n<p>每个 HTML 标签都有自己的属性，比如 Input 框就有 value、width、placeholder、max-length 等属性，下面是 Input 框的属性类型定义：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65334502818964380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface InputHTMLAttributes<T> extends HTMLAttributes<T> {\n   accept?: string | undefined;\n   alt?: string | undefined;\n   autoComplete?: string | undefined;\n   autoFocus?: boolean | undefined;\n   capture?: boolean | string | undefined;\n   checked?: boolean | undefined;\n   crossOrigin?: string | undefined;\n   disabled?: boolean | undefined;\n   enterKeyHint?: \'enter\' | \'done\' | \'go\' | \'next\' | \'previous\' | \'search\' | \'send\' | undefined;\n   form?: string | undefined;\n   formAction?: string | undefined;\n   formEncType?: string | undefined;\n   formMethod?: string | undefined;\n   formNoValidate?: boolean | undefined;\n   formTarget?: string | undefined;\n   height?: number | string | undefined;\n   list?: string | undefined;\n   max?: number | string | undefined;\n   maxLength?: number | undefined;\n   min?: number | string | undefined;\n   minLength?: number | undefined;\n   multiple?: boolean | undefined;\n   name?: string | undefined;\n   pattern?: string | undefined;\n   placeholder?: string | undefined;\n   readOnly?: boolean | undefined;\n   required?: boolean | undefined;\n   size?: number | undefined;\n   src?: string | undefined;\n   step?: number | string | undefined;\n   type?: string | undefined;\n   value?: string | ReadonlyArray<string> | number | undefined;\n   width?: number | string | undefined;\n\n   onChange?: ChangeEventHandler<T> | undefined;\n}`, `65334502818964380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">InputHTMLAttributes</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">HTMLAttributes</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   accept<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   alt<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   autoComplete<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   autoFocus<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   capture<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   checked<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   crossOrigin<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   disabled<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   enterKeyHint<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string">\'enter\'</span> <span class="token operator">|</span> <span class="token string">\'done\'</span> <span class="token operator">|</span> <span class="token string">\'go\'</span> <span class="token operator">|</span> <span class="token string">\'next\'</span> <span class="token operator">|</span> <span class="token string">\'previous\'</span> <span class="token operator">|</span> <span class="token string">\'search\'</span> <span class="token operator">|</span> <span class="token string">\'send\'</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   form<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   formAction<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   formEncType<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   formMethod<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   formNoValidate<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   formTarget<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   height<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   list<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   max<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   maxLength<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   min<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   minLength<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   multiple<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   name<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   pattern<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   placeholder<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   readOnly<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   required<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   size<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   src<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   step<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   <span class="token keyword">type</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   value<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> ReadonlyArray<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token builtin">number</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   width<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n\n   onChange<span class="token operator">?</span><span class="token punctuation">:</span> ChangeEventHandler<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果我们需要直接操作 DOM，就可能会用到元素属性类型，常见的元素属性类型如下：</p>\n<ul>\n<li>HTML 属性类型：HTMLAttributes</li>\n<li>按钮属性类型：ButtonHTMLAttributes</li>\n<li>表单属性类型：FormHTMLAttributes</li>\n<li>图片属性类型：ImgHTMLAttributes</li>\n<li>输入框属性类型：InputHTMLAttributes</li>\n<li>链接属性类型：LinkHTMLAttributes</li>\n<li>meta 属性类型：MetaHTMLAttributes</li>\n<li>选择框属性类型：SelectHTMLAttributes</li>\n<li>表格属性类型：TableHTMLAttributes</li>\n<li>输入区属性类型：TextareaHTMLAttributes</li>\n<li>视频属性类型：VideoHTMLAttributes</li>\n<li>SVG 属性类型：SVGAttributes</li>\n<li>WebView 属性类型：WebViewHTMLAttributes</li>\n</ul>\n<p>一般情况下，我们是很少需要在项目中显式的去定义标签属性的类型。如果子级去封装组件库的话，这些属性就能发挥它们的作用了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6470035288065001000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport classNames from \'classnames\';\n\nexport enum ButtonSize {\n   Large = \'lg\',\n   Small = \'sm\'\n}\n\nexport enum ButtonType {\n   Primary = \'primary\',\n   Default = \'default\',\n   Danger = \'danger\',\n   Link = \'link\'\n}\n\ninterface BaseButtonProps {\n   className?: string;\n   disabled?: boolean;\n   size?: ButtonSize;\n   btnType?: ButtonType;\n   children: React.ReactNode;\n   href?: string;\n}\n\n// 使用 交叉类型（&）获得我们自己定义的属性和原生 button 的属性\ntype NativeButtonProps = BaseButtonProps & React.ButtonHTMLAttributes<HTMLButtonElement>;\n\n// 使用 交叉类型（&）获得我们自己定义的属性和原生 a 标签的属性\ntype AnchorButtonProps = BaseButtonProps & React.AnchorHTMLAttributes<HTMLAnchorElement>;\n\n// 使用 Partial<> 使两种属性可选\nexport type ButtonProps = Partial<NativeButtonProps & AnchorButtonProps>;\n\nconst Button: React.FC<ButtonProps> = (props) => {\n   const { disabled, className, size, btnType, children, href, ...restProps } = props;\n\n   const classes = classNames(\'btn\', className, {\n      [\\`btn-\\${btnType}\\`]: btnType,\n      [\\`btn-\\${size}\\`]: size,\n      disabled: btnType === ButtonType.Link && disabled // 只有 a 标签才有 disabled 类名，button 没有\n   });\n\n   if (btnType === ButtonType.Link && href) {\n      return (\n         <a className={classes} href={href} {...restProps}>\n            {children}\n         </a>\n      );\n   } else {\n      return (\n         <button\n            className={classes}\n            disabled={disabled} // button 元素默认有 disabled 属性，所以即便没给他设置样式也会和普通 button 有一定区别\n            {...restProps}\n         >\n            {children}\n         </button>\n      );\n   }\n};\n\nButton.defaultProps = {\n   disabled: false,\n   btnType: ButtonType.Default\n};\n\nexport default Button;`, `6470035288065001000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> classNames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">enum</span> ButtonSize <span class="token punctuation">{</span>\n   Large <span class="token operator">=</span> <span class="token string">\'lg\'</span><span class="token punctuation">,</span>\n   Small <span class="token operator">=</span> <span class="token string">\'sm\'</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">enum</span> ButtonType <span class="token punctuation">{</span>\n   Primary <span class="token operator">=</span> <span class="token string">\'primary\'</span><span class="token punctuation">,</span>\n   Default <span class="token operator">=</span> <span class="token string">\'default\'</span><span class="token punctuation">,</span>\n   Danger <span class="token operator">=</span> <span class="token string">\'danger\'</span><span class="token punctuation">,</span>\n   Link <span class="token operator">=</span> <span class="token string">\'link\'</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">BaseButtonProps</span> <span class="token punctuation">{</span>\n   className<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   disabled<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   size<span class="token operator">?</span><span class="token punctuation">:</span> ButtonSize<span class="token punctuation">;</span>\n   btnType<span class="token operator">?</span><span class="token punctuation">:</span> ButtonType<span class="token punctuation">;</span>\n   children<span class="token punctuation">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span>\n   href<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 使用 交叉类型（&amp;）获得我们自己定义的属性和原生 button 的属性</span>\n<span class="token keyword">type</span> NativeButtonProps <span class="token operator">=</span> BaseButtonProps <span class="token operator">&amp;</span> React<span class="token punctuation">.</span>ButtonHTMLAttributes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLButtonElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">;\n\n// 使用 交叉类型（&amp;）获得我们自己定义的属性和原生 a 标签的属性\ntype AnchorButtonProps = BaseButtonProps &amp; React.AnchorHTMLAttributes</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLAnchorElement</span></span><span class="token punctuation">></span></span><span class="token plain-text">;\n\n// 使用 Partial&lt;> 使两种属性可选\nexport type ButtonProps = Partial&lt;NativeButtonProps &amp; AnchorButtonProps>;\n\nconst Button: React.FC</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ButtonProps</span></span><span class="token punctuation">></span></span><span class="token plain-text"> = (props) => </span><span class="token punctuation">{</span>\n   <span class="token keyword">const</span> <span class="token punctuation">{</span> disabled<span class="token punctuation">,</span> className<span class="token punctuation">,</span> size<span class="token punctuation">,</span> btnType<span class="token punctuation">,</span> children<span class="token punctuation">,</span> href<span class="token punctuation">,</span> <span class="token operator">...</span>restProps <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>\n\n   <span class="token keyword">const</span> classes <span class="token operator">=</span> <span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">\'btn\'</span><span class="token punctuation">,</span> className<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">btn-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>btnType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">:</span> btnType<span class="token punctuation">,</span>\n      <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">btn-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">:</span> size<span class="token punctuation">,</span>\n      disabled<span class="token punctuation">:</span> btnType <span class="token operator">===</span> ButtonType<span class="token punctuation">.</span>Link <span class="token operator">&amp;&amp;</span> disabled <span class="token comment">// 只有 a 标签才有 disabled 类名，button 没有</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>btnType <span class="token operator">===</span> ButtonType<span class="token punctuation">.</span>Link <span class="token operator">&amp;&amp;</span> href<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>\n         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>classes<span class="token punctuation">}</span></span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>href<span class="token punctuation">}</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token punctuation">...</span><span class="token attr-value">restProps</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">\n         </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>\n         <span class="token operator">&lt;</span>button\n            className<span class="token operator">=</span><span class="token punctuation">{</span>classes<span class="token punctuation">}</span>\n            disabled<span class="token operator">=</span><span class="token punctuation">{</span>disabled<span class="token punctuation">}</span> <span class="token comment">// button 元素默认有 disabled 属性，所以即便没给他设置样式也会和普通 button 有一定区别</span>\n            <span class="token punctuation">{</span><span class="token operator">...</span>restProps<span class="token punctuation">}</span>\n         <span class="token operator">></span>\n            <span class="token punctuation">{</span>children<span class="token punctuation">}</span>\n         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token plain-text">;\n\nButton.defaultProps = </span><span class="token punctuation">{</span>\n   disabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n   btnType<span class="token punctuation">:</span> ButtonType<span class="token punctuation">.</span>Default\n<span class="token punctuation">}</span><span class="token plain-text">;\n\nexport default Button;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="高阶组件"><a href="#%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>高阶组件</h2>\n<h3 id="类组件-1"><a href="#%E7%B1%BB%E7%BB%84%E4%BB%B6-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类组件</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92694169252304850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface WithLoadingProps {\n   loading: boolean;\n}\n\nconst withLoading = <P extends object>(Component: React.ComponentType<P>) =>\n   class WithLoading extends React.Component<P & WithLoadingProps> {\n      render() {\n         const { loading, ...props } = this.props;\n         return loading ? <LoadingSpinner /> : <Component {...(props as P)} />;\n      }\n   };`, `92694169252304850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">WithLoadingProps</span> <span class="token punctuation">{</span>\n   loading<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> withLoading <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span> <span class="token attr-name">extends</span> <span class="token attr-name">object</span><span class="token punctuation">></span></span><span class="token plain-text">(Component: React.ComponentType</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span><span class="token punctuation">></span></span><span class="token plain-text">) =>\n   class WithLoading extends React.Component&lt;P &amp; WithLoadingProps> </span><span class="token punctuation">{</span>\n      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> <span class="token punctuation">{</span> loading<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n         <span class="token keyword">return</span> loading <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LoadingSpinner</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">:</span> <span class="token operator">&lt;</span>Component <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">(</span>props <span class="token keyword">as</span> <span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token plain-text">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="函数组件-1"><a href="#%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数组件</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21945458852722210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const withLoading = <P extends object>(Component: React.ComponentType<P>): React.FC<P & WithLoadingProps> => ({\n   loading,\n   ...props\n}: WithLoadingProps) => (loading ? <LoadingSpinner /> : <Component {...(props as P)} />);`, `21945458852722210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="tsx"\n              >\n                <span class="gatsby-code-button-language">tsx</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="tsx"><pre style="counter-reset: linenumber NaN" class="language-tsx line-numbers"><code class="language-tsx"><span class="token keyword">const</span> withLoading <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span> <span class="token attr-name">extends</span> <span class="token attr-name">object</span><span class="token punctuation">></span></span><span class="token plain-text">(Component: React.ComponentType</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">P</span></span><span class="token punctuation">></span></span><span class="token plain-text">): React.FC&lt;P &amp; WithLoadingProps> => ({\n   loading,\n   ...props\n}: WithLoadingProps) => (loading ? </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LoadingSpinner</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"> : &lt;Component </span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">(</span>props <span class="token keyword">as</span> <span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"> />);</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="工具泛型的实现"><a href="#%E5%B7%A5%E5%85%B7%E6%B3%9B%E5%9E%8B%E7%9A%84%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工具泛型的实现</h1>\n<h2 id="partial"><a href="#partial" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Partial</h2>\n<p>Partial 作用是将传入的属性变为可选项</p>\n<h3 id="前置知识"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前置知识</h3>\n<p>首先我们需要理解两个关键字 keyof 和 in，keyof 可以用来取得一个对象接口的所有 key 值，比如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44663991534604270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Foo {\n   name: string;\n   age: number;\n}\ntype T = keyof Foo; // -> &quot;name&quot; | &quot;age&quot;`, `44663991534604270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">type</span> <span class="token constant">T</span> <span class="token operator">=</span> <span class="token keyword">keyof</span> Foo<span class="token punctuation">;</span> <span class="token comment">// -> "name" | "age"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>而 in 则可以遍历枚举类型， 例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67341249439542540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Keys = \'a\' | \'b\';\ntype Obj = {\n   [p in Keys]: any;\n}; // -> { a: any， b: any }`, `67341249439542540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Keys <span class="token operator">=</span> <span class="token string">\'a\'</span> <span class="token operator">|</span> <span class="token string">\'b\'</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> Obj <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span>p <span class="token keyword">in</span> Keys<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// -> { a: any， b: any }</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="源码解析"><a href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>源码解析</h3>\n<p>keyof 产生联合类型，in 则可以遍历枚举类型，所以他们经常一起使用，看下 Partial 源码</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44303276426956570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Partial<T> = {\n   [P in keyof T]?: T[P];\n};`, `44303276426956570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>上面语句的意思是 keyof T 拿到 T 所有属性名，然后 in 进行遍历，将值赋给 P，最后 <code class="language-text">T[P]</code> 取得相应属性的值</p>\n<p>结合中间的 ? 我们就明白了 Partial 的含义了</p>\n<h3 id="使用场景"><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用场景</h3>\n<p>假设我们有一个定义 user 的接口，如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45507147086952780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IUser {\n   name: string;\n   age: number;\n   department: string;\n}`, `45507147086952780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">IUser</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   department<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>经过 Partial 类型转化后得到</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13685403999779822000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type optional = Partial<IUser>;\n\n// optional的结果如下\ntype optional = {\n   name?: string | undefined;\n   age?: number | undefined;\n   department?: string | undefined;\n};`, `13685403999779822000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> optional <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>IUser<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">// optional的结果如下</span>\n<span class="token keyword">type</span> optional <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   age<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n   department<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="required"><a href="#required" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Required</h2>\n<p>Required 的作用是将传入的属性变为必选项，源码如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29816319131823608000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Required<T> = {\n   [P in keyof T]-?: T[P];\n};`, `29816319131823608000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Required<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>我们发现一个有意思的用法 -?，这里很好理解就是将可选项代表的 ? 去掉，从而让这个类型变成必选项。</p>\n<p>与之对应的还有个+? ，这个含义自然与-?之前相反，它是用来把属性变成可选项的</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34169890598320697000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IPerson {\n   name?: string;\n   age?: number;\n   height?: number;\n}\n\nconst person: Required<IPerson> = {\n   name: \'zhangsan\',\n   age: 18,\n   height: 180\n};`, `34169890598320697000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>\n   name<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   height<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> person<span class="token punctuation">:</span> Required<span class="token operator">&lt;</span>IPerson<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'zhangsan\'</span><span class="token punctuation">,</span>\n   age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>\n   height<span class="token punctuation">:</span> <span class="token number">180</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="mutable-未包含"><a href="#mutable-%E6%9C%AA%E5%8C%85%E5%90%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mutable (未包含)</h2>\n<p>类似地，其实还有对 + 和 -，这里要说的不是变量的之间的进行加减而是对 readonly 进行加减。</p>\n<p>以下代码的作用就是将 T 的所有属性的 readonly 移除，你也可以写一个相反的出来.</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66703779854338420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Mutable<T> = {\n   -readonly [P in keyof T]: T[P];\n};`, `66703779854338420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Mutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="readonly"><a href="#readonly" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Readonly</h2>\n<p>将传入的属性变为只读选项, 源码如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98127995814200750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Readonly<T> = {\n   readonly [P in keyof T]: T[P];\n};`, `98127995814200750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7696059568750080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IPerson {\n   name: string;\n   age: number;\n}\n\nconst person: Readonly<IPerson> = {\n   name: \'zhangsan\',\n   age: 18\n};\n\nperson.age = 20; //  Error: cannot reassign a readonly property`, `7696059568750080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> person<span class="token punctuation">:</span> Readonly<span class="token operator">&lt;</span>IPerson<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'zhangsan\'</span><span class="token punctuation">,</span>\n   age<span class="token punctuation">:</span> <span class="token number">18</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\nperson<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">//  Error: cannot reassign a readonly property</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="record"><a href="#record" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Record</h2>\n<h3 id="前置知识-1"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前置知识</h3>\n<p>此处注意 K extends keyof T 和直接使用 K in keyof T 的区别，keyof T 仅仅代表键的字符串文字类型，而 extends keyof T 将返回该属性相同的类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10024309307995982000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function prop<T, K extends keyof T>(obj: T, key: K) {\n   return obj[key];\n}\n\nfunction prop2<T>(obj: T, key: keyof T) {\n   return obj[key];\n}\n\nlet o = {\n   p1: 0,\n   p2: \'\'\n};\n\nlet v = prop(o, \'p1\'); // is number, K is of type \'p1\'\nlet v2 = prop2(o, \'p1\'); // is number | string, no extra info is captured`, `10024309307995982000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> prop<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token constant">K</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> prop2<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>\n   p1<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n   p2<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token function">prop</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">\'p1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// is number, K is of type \'p1\'</span>\n<span class="token keyword">let</span> v2 <span class="token operator">=</span> <span class="token function">prop2</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">\'p1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// is number | string, no extra info is captured</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="源码解析-1"><a href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>源码解析</h3>\n<p>将 K 中所有的属性的值转化为 T 类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93591083882900540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Record<K extends keyof any, T> = {\n   [P in K]: T;\n};`, `93591083882900540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Record<span class="token operator">&lt;</span><span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用场景-1"><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用场景</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73965052938228250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IPageinfo {\n   name: string;\n}\n\ntype IPage = \'home\' | \'about\' | \'contact\';\n\nconst page: Record<IPage, IPageinfo> = {\n   about: { name: \'about\' },\n   contact: { name: \'contact\' },\n   home: { name: \'home\' }\n};`, `73965052938228250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">IPageinfo</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> IPage <span class="token operator">=</span> <span class="token string">\'home\'</span> <span class="token operator">|</span> <span class="token string">\'about\'</span> <span class="token operator">|</span> <span class="token string">\'contact\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> page<span class="token punctuation">:</span> Record<span class="token operator">&lt;</span>IPage<span class="token punctuation">,</span> IPageinfo<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   about<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'about\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   contact<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'contact\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   home<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'home\'</span> <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="pick"><a href="#pick" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pick</h2>\n<p>从 T 中取出一系列 K 的属性</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10573472893141967000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Pick<T, K extends keyof T> = {\n   [P in K]: T[P];\n};`, `10573472893141967000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21538721179993313000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IPerson {\n   name: string;\n   age: number;\n   height: number;\n}\n\nconst person: Pick<IPerson, \'name\' | \'age\'> = {\n   name: \'zhangsan\',\n   age: 18\n};`, `21538721179993313000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   height<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> person<span class="token punctuation">:</span> Pick<span class="token operator">&lt;</span>IPerson<span class="token punctuation">,</span> <span class="token string">\'name\'</span> <span class="token operator">|</span> <span class="token string">\'age\'</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'zhangsan\'</span><span class="token punctuation">,</span>\n   age<span class="token punctuation">:</span> <span class="token number">18</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="exclude"><a href="#exclude" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exclude</h2>\n<h3 id="前置知识-2"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前置知识</h3>\n<p>在 ts 2.8 中引入了一个条件类型，示例如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77340529114072170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`T extends U ? X : Y`, `77340529114072170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">U</span> <span class="token operator">?</span> <span class="token constant">X</span> <span class="token punctuation">:</span> <span class="token constant">Y</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>以上语句的意思就是如果 T 是 U 的子类型的话，那么就会返回 X，否则返回 Y，甚至可以组合多个</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54379177128188310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type TypeName<T> = T extends string\n   ? \'string\'\n   : T extends number\n   ? \'number\'\n   : T extends boolean\n   ? \'boolean\'\n   : T extends undefined\n   ? \'undefined\'\n   : T extends Function\n   ? \'function\'\n   : \'object\';`, `54379177128188310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> TypeName<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span>\n   <span class="token operator">?</span> <span class="token string">\'string\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">number</span>\n   <span class="token operator">?</span> <span class="token string">\'number\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">boolean</span>\n   <span class="token operator">?</span> <span class="token string">\'boolean\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">undefined</span>\n   <span class="token operator">?</span> <span class="token string">\'undefined\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span>\n   <span class="token operator">?</span> <span class="token string">\'function\'</span>\n   <span class="token punctuation">:</span> <span class="token string">\'object\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于联合类型来说会自动分发条件，例如 T extends U ? X : Y，T 可能是 A | B 的联合类型，那实际情况就变成(A extends U ? X : Y) | (B extends U ? X : Y)</p>\n<h3 id="源码解析-2"><a href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>源码解析</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2152410023299777800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Exclude<T, U> = T extends U ? never : T;`, `2152410023299777800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Exclude<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">U</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="使用场景-2"><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用场景</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="179176365407207600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type T = Exclude<1 | 2, 1 | 3>; // -> 2`, `179176365407207600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> <span class="token constant">T</span> <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">3</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// -> 2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>很轻松地得出结果 2，据代码和示例我们可以推断出 Exclude 的作用是从 T 中找出 U 中没有的元素，换种更加贴近语义的说法其实就是从 T 中排除 U</p>\n<h2 id="extract"><a href="#extract" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extract</h2>\n<p>根据源码我们推断出 Extract 的作用是提取出 T 包含在 U 中的元素，换种更加贴近语义的说法就是从 T 中提取出 U</p>\n<p>源码如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48015481049601490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Extract<T, U> = T extends U ? T : never;`, `48015481049601490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Extract<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">U</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="omit"><a href="#omit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Omit</h2>\n<p>用之前的 Pick 和 Exclude 进行组合，实现忽略对象某些属性功能，源码如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25232032239278210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Omit<T, K> = Pick<T, Exclude<keyof T, K>>;\n\n// 使用\ntype Foo = Omit<\n   {\n      name: string;\n      age: number;\n   },\n   \'name\'\n>; // -> { age: number }\n\ninterface IPerson {\n   name: string;\n   age: number;\n   height: number;\n}\n\nconst person: Omit<IPerson, \'age\' | \'sex\'> = {\n   name: \'zhangsan\',\n   height: 180\n};`, `25232032239278210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Omit<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Exclude<span class="token operator">&lt;</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">>></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 使用</span>\n<span class="token keyword">type</span> Foo <span class="token operator">=</span> Omit<span class="token operator">&lt;</span>\n   <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n      age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token string">\'name\'</span>\n<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// -> { age: number }</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   height<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> person<span class="token punctuation">:</span> Omit<span class="token operator">&lt;</span>IPerson<span class="token punctuation">,</span> <span class="token string">\'age\'</span> <span class="token operator">|</span> <span class="token string">\'sex\'</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'zhangsan\'</span><span class="token punctuation">,</span>\n   height<span class="token punctuation">:</span> <span class="token number">180</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="returntype"><a href="#returntype" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ReturnType</h2>\n<p>在阅读源码之前我们需要了解一下 infer 这个关键字，在条件类型语句中，我们可以用 infer 声明一个类型变量并且对它进行使用，我们可以用它获取函数的返回类型，源码如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28369897617367458000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ReturnType<T> = T extends (...args: any[]) => infer R ? R : any;`, `28369897617367458000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> infer <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其实这里的 infer R 就是声明一个变量来承载传入函数签名的返回值类型，简单说就是用它取到函数返回值的类型方便之后使用</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28286591202981670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo(x: number): Array<number> {\n   return [x];\n}\ntype fn = ReturnType<typeof foo>;`, `28286591202981670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">type</span> fn <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> foo<span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="axiosreturntype-未包含"><a href="#axiosreturntype-%E6%9C%AA%E5%8C%85%E5%90%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AxiosReturnType (未包含)</h2>\n<p>开发经常使用 axios 进行封装 API 层请求，通常是一个函数返回一个 <code class="language-text">AxiosPromise&lt;Resp&gt;</code>，现在我想取到它的 Resp 类型，根据上一个工具泛型的知识我们可以这样写</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6682520285692184000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { AxiosPromise } from \'axios\'; // 导入接口\ntype AxiosReturnType<T> = T extends (...args: any[]) => AxiosPromise<infer R> ? R : any;\n\n// 使用\ntype Resp = AxiosReturnType<Api>; // 泛型参数中传入你的 Api 请求函数`, `6682520285692184000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> AxiosPromise <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'axios\'</span><span class="token punctuation">;</span> <span class="token comment">// 导入接口</span>\n<span class="token keyword">type</span> AxiosReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> AxiosPromise<span class="token operator">&lt;</span>infer <span class="token constant">R</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 使用</span>\n<span class="token keyword">type</span> Resp <span class="token operator">=</span> AxiosReturnType<span class="token operator">&lt;</span>Api<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 泛型参数中传入你的 Api 请求函数</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="巧用-typescript"><a href="#%E5%B7%A7%E7%94%A8-typescript" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>巧用 TypeScript</h1>\n<h2 id="函数重载"><a href="#%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数重载</h2>\n<p>TypeScript 提供函数重载的功能，用来处理因函数参数不同而返回类型不同的使用场景，使用时只需为同一个函数定义多个类型即可，简单使用如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89323509010852530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare function test(a: number): number;\ndeclare function test(a: string): string;\n\nconst resS = test(\'Hello World\'); // resS 被推断出类型为 string；\nconst resN = test(1234); // resN 被推断出类型为 number;`, `89323509010852530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> resS <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">\'Hello World\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// resS 被推断出类型为 string；</span>\n<span class="token keyword">const</span> resN <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// resN 被推断出类型为 number;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它也适用于参数不同，返回值类型相同的场景，我们只需要知道在哪种函数类型定义下能使用哪些参数即可。</p>\n<p>考虑如下例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68055914622917820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface User {\n   name: string;\n   age: number;\n}\n\ndeclare function test(para: User | number, flag?: boolean): number;`, `68055914622917820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">para<span class="token punctuation">:</span> User <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">,</span> flag<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在这个 test 函数里，我们的本意可能是当传入参数 para 是 User 时，不传 flag，当传入 para 是 number 时，传入 flag。TypeScript 并不知道这些，当你传入 para 为 User 时，flag 同样允许你传入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74587798584255730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const user = {\n   name: \'Jack\',\n   age: 666\n};\n\n// 没有报错，但是与想法违背\nconst res = test(user, false);`, `74587798584255730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'Jack\'</span><span class="token punctuation">,</span>\n   age<span class="token punctuation">:</span> <span class="token number">666</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 没有报错，但是与想法违背</span>\n<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用函数重载能帮助我们实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78548561959717930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface User {\n   name: string;\n   age: number;\n}\n\ndeclare function test(para: User): number;\ndeclare function test(para: number, flag: boolean): number;\n\nconst user = {\n   name: \'Jack\',\n   age: 666\n};\n\n// bingo\n// Error: 参数不匹配\nconst res = test(user, false);`, `78548561959717930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">para<span class="token punctuation">:</span> User</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">para<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> flag<span class="token punctuation">:</span> <span class="token builtin">boolean</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'Jack\'</span><span class="token punctuation">,</span>\n   age<span class="token punctuation">:</span> <span class="token number">666</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// bingo</span>\n<span class="token comment">// Error: 参数不匹配</span>\n<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">test</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实际项目中，你可能要多写几步，如在 class 中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98574352849258790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface User {\n   name: string;\n   age: number;\n}\n\nconst user = {\n   name: \'Jack\',\n   age: 123\n};\n\nclass SomeClass {\n   /**\n    * 注释 1\n    */\n   public test(para: User): number;\n   /**\n    * 注释 2\n    */\n   public test(para: number, flag: boolean): number;\n   public test(para: User | number, flag?: boolean): number {\n      // 具体实现\n      return 11;\n   }\n}\n\nconst someClass = new SomeClass();\n\n// ok\nsomeClass.test(user);\nsomeClass.test(123, false);\n\n// Error，涉及到具体实现时，这个地方报错\nsomeClass.test(123);\nsomeClass.test(user, false);`, `98574352849258790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'Jack\'</span><span class="token punctuation">,</span>\n   age<span class="token punctuation">:</span> <span class="token number">123</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n   <span class="token comment">/**\n    * 注释 1\n    */</span>\n   <span class="token keyword">public</span> <span class="token function">test</span><span class="token punctuation">(</span>para<span class="token punctuation">:</span> User<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   <span class="token comment">/**\n    * 注释 2\n    */</span>\n   <span class="token keyword">public</span> <span class="token function">test</span><span class="token punctuation">(</span>para<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> flag<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   <span class="token keyword">public</span> <span class="token function">test</span><span class="token punctuation">(</span>para<span class="token punctuation">:</span> User <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">,</span> flag<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 具体实现</span>\n      <span class="token keyword">return</span> <span class="token number">11</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> someClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ok</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Error，涉及到具体实现时，这个地方报错</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="映射类型"><a href="#%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>映射类型</h2>\n<p>自从 TypeScript 2.1 版本推出映射类型以来，它便不断被完善与增强。在 2.1 版本中，可以通过 keyof 拿到对象 key 类型，内置 Partial、Readonly、Record、Pick 映射类型；2.3 版本增加 ThisType；2.8 版本增加 Exclude、Extract、NonNullable、ReturnType、InstanceType；同时在此版本中增加条件类型与增强 keyof 的能力；3.1 版本支持对元组与数组的映射。这些无不意味着映射类型在 TypeScript 有着举足轻重的地位。</p>\n<p>其中 ThisType 并没有出现在官方文档中，它主要用来在对象字面量中键入 this：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48899337354712460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Compile with --noImplicitThis\n\ntype ObjectDescriptor<D, M> = {\n   data?: D;\n   methods?: M & ThisType<D & M>; // Type of \'this\' in methods is D & M\n};\n\nfunction makeObject<D, M>(desc: ObjectDescriptor<D, M>): D & M {\n   let data: object = desc.data || {};\n   let methods: object = desc.methods || {};\n   return { ...data, ...methods } as D & M;\n}\n\nlet obj = makeObject({\n   data: { x: 0, y: 0 },\n   methods: {\n      moveBy(dx: number, dy: number) {\n         this.x += dx; // Strongly typed this\n         this.y += dy; // Strongly typed this\n      }\n   }\n});\n\nobj.x = 10;\nobj.y = 20;\nobj.moveBy(5, 5);`, `48899337354712460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// Compile with --noImplicitThis</span>\n\n<span class="token keyword">type</span> ObjectDescriptor<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   data<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">D</span><span class="token punctuation">;</span>\n   methods<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">M</span> <span class="token operator">&amp;</span> ThisType<span class="token operator">&lt;</span><span class="token constant">D</span> <span class="token operator">&amp;</span> <span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Type of \'this\' in methods is D &amp; M</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> makeObject<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">(</span>desc<span class="token punctuation">:</span> ObjectDescriptor<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">D</span> <span class="token operator">&amp;</span> <span class="token constant">M</span> <span class="token punctuation">{</span>\n   <span class="token keyword">let</span> data<span class="token punctuation">:</span> object <span class="token operator">=</span> desc<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token keyword">let</span> methods<span class="token punctuation">:</span> object <span class="token operator">=</span> desc<span class="token punctuation">.</span>methods <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>data<span class="token punctuation">,</span> <span class="token operator">...</span>methods <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">D</span> <span class="token operator">&amp;</span> <span class="token constant">M</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">makeObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function">moveBy</span><span class="token punctuation">(</span><span class="token parameter">dx<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> dy<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> dx<span class="token punctuation">;</span> <span class="token comment">// Strongly typed this</span>\n         <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> dy<span class="token punctuation">;</span> <span class="token comment">// Strongly typed this</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nobj<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\nobj<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>\nobj<span class="token punctuation">.</span><span class="token function">moveBy</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>正是由于 ThisType 的出现，Vue 2.5 才得以增强对 TypeScript 的支持。</p>\n</blockquote>\n<p>虽已内置了很多映射类型，但在很多时候，我们需要根据自己的项目自定义映射类型：</p>\n<p>比如你可能想取出接口类型中的函数类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47710169056604815000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type FunctionPropertyNames<T> = {\n   [K in keyof T]: T[K] extends Function ? K : never;\n}[keyof T];\ntype FunctionProperties<T> = Pick<T, FunctionPropertyNames<T>>;\n\ninterface Part {\n   id: number;\n   name: string;\n   subparts: Part[];\n   updatePart(newName: string): void;\n}\n\ntype T40 = FunctionPropertyNames<Part>; // &quot;updatePart&quot;\ntype T42 = FunctionProperties<Part>; // { updatePart(newName: string): void }`, `47710169056604815000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> FunctionPropertyNames<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> FunctionProperties<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> FunctionPropertyNames<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Part</span> <span class="token punctuation">{</span>\n   id<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   subparts<span class="token punctuation">:</span> Part<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   <span class="token function">updatePart</span><span class="token punctuation">(</span>newName<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> <span class="token constant">T40</span> <span class="token operator">=</span> FunctionPropertyNames<span class="token operator">&lt;</span>Part<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "updatePart"</span>\n<span class="token keyword">type</span> <span class="token constant">T42</span> <span class="token operator">=</span> FunctionProperties<span class="token operator">&lt;</span>Part<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// { updatePart(newName: string): void }</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>比如你可能为了便捷，把本属于某个属性下的方法，通过一些方式 alias 到其他地方</p>\n<p>举个例子：SomeClass 下有个属性 value = [1, 2, 3]，你可能在 Decorators 给类添加了此种功能：在 SomeClass 里调用 this.find() 时，实际上是调用 this.value.find()，但是此时 TypeScript 并不知道这些：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44983189900120515000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class SomeClass {\n   value = [1, 2, 3];\n\n   someMethod() {\n      this.value.find(/* ... */); // ok\n      this.find(/* ... */); // Error：SomeClass 没有 find 方法。\n   }\n}`, `44983189900120515000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n   value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n   <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error：SomeClass 没有 find 方法。</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>借助于映射类型和 interface + class 的声明方式，可以实现我们的目的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15966495071481268000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ArrayMethodName = \'filter\' | \'forEach\' | \'find\';\n\ntype SelectArrayMethod<T> = {\n   [K in ArrayMethodName]: Array<T>[K];\n};\n\ninterface SomeClass extends SelectArrayMethod<number> {}\n\nclass SomeClass {\n   value = [1, 2, 3];\n\n   someMethod() {\n      this.forEach(/* ... */); // ok\n      this.find(/* ... */); // ok\n      this.filter(/* ... */); // ok\n      this.value; // ok\n      this.someMethod(); // ok\n   }\n}\n\nconst someClass = new SomeClass();\nsomeClass.forEach(/* ... */); // ok\nsomeClass.find(/* ... */); // ok\nsomeClass.filter(/* ... */); // ok\nsomeClass.value; // ok\nsomeClass.someMethod(); // ok`, `15966495071481268000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ArrayMethodName <span class="token operator">=</span> <span class="token string">\'filter\'</span> <span class="token operator">|</span> <span class="token string">\'forEach\'</span> <span class="token operator">|</span> <span class="token string">\'find\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> SelectArrayMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> ArrayMethodName<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">SomeClass</span> <span class="token keyword">extends</span> <span class="token class-name">SelectArrayMethod</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n   value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n   <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// ok</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> someClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\nsomeClass<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// ok</span>\nsomeClass<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>导出 SomeClass 类时，也能使用。</p>\n</blockquote>\n<p>可能有点不足的地方，在这段代码里 <code class="language-text">interface SomeClass extends SelectArrayMethod&lt;number&gt; {}</code> 你需要手动添加范型的具体类型（暂时没想到更好方式）。</p>\n<h2 id="类型断言"><a href="#%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类型断言</h2>\n<p>类型断言用来明确的告诉 TypeScript 值的详细类型，合理使用能减少我们的工作量。</p>\n<p>比如一个变量并没有初始值，但是我们知道它的类型信息（它可能是从后端返回）有什么办法既能正确推导类型信息，又能正常运行了？有一种网上的推荐方式是设置初始值，然后使用 typeof 拿到类型（可能会给其他地方用）。然而我可能比较懒，不喜欢设置初始值，这时候使用类型断言可以解决这类问题：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61587797412182835000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface User {\n   name: string;\n   age: number;\n}\n\nexport default class NewRoom extends Vue {\n   private user = {} as User;\n}`, `61587797412182835000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">NewRoom</span> <span class="token keyword">extends</span> <span class="token class-name">Vue</span> <span class="token punctuation">{</span>\n   <span class="token keyword">private</span> user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> User<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在设置初始化时，添加断言，我们就无须添加初始值，编辑器也能正常的给予代码提示了。如果 user 属性很多，这样就能解决大量不必要的工作了，定义的 interface 也能给其他地方使用。</p>\n<h2 id="枚举类型"><a href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>枚举类型</h2>\n<p>枚举类型分为数字类型与字符串类型，其中数字类型的枚举可以当标志使用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23115917522576777000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// https://github.com/Microsoft/TypeScript/blob/master/src/compiler/types.ts#L3859\nexport const enum ObjectFlags {\n   Class = 1 << 0, // Class\n   Interface = 1 << 1, // Interface\n   Reference = 1 << 2, // Generic type reference\n   Tuple = 1 << 3, // Synthesized generic tuple type\n   Anonymous = 1 << 4, // Anonymous\n   Mapped = 1 << 5, // Mapped\n   Instantiated = 1 << 6, // Instantiated anonymous or mapped type\n   ObjectLiteral = 1 << 7, // Originates in an object literal\n   EvolvingArray = 1 << 8, // Evolving array type\n   ObjectLiteralPatternWithComputedProperties = 1 << 9, // Object literal pattern with computed properties\n   ContainsSpread = 1 << 10, // Object literal contains spread operation\n   ReverseMapped = 1 << 11, // Object contains a property from a reverse-mapped type\n   JsxAttributes = 1 << 12, // Jsx attributes type\n   MarkerType = 1 << 13, // Marker type used for variance probing\n   JSLiteral = 1 << 14, // Object type declared in JS - disables errors on read/write of nonexisting members\n   ClassOrInterface = Class | Interface\n}`, `23115917522576777000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// https://github.com/Microsoft/TypeScript/blob/master/src/compiler/types.ts#L3859</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> ObjectFlags <span class="token punctuation">{</span>\n   Class <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// Class</span>\n   Interface <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// Interface</span>\n   Reference <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// Generic type reference</span>\n   Tuple <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// Synthesized generic tuple type</span>\n   Anonymous <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// Anonymous</span>\n   Mapped <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// Mapped</span>\n   Instantiated <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// Instantiated anonymous or mapped type</span>\n   ObjectLiteral <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// Originates in an object literal</span>\n   EvolvingArray <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// Evolving array type</span>\n   ObjectLiteralPatternWithComputedProperties <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token comment">// Object literal pattern with computed properties</span>\n   ContainsSpread <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// Object literal contains spread operation</span>\n   ReverseMapped <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token comment">// Object contains a property from a reverse-mapped type</span>\n   JsxAttributes <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token comment">// Jsx attributes type</span>\n   MarkerType <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token comment">// Marker type used for variance probing</span>\n   JSLiteral <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token comment">// Object type declared in JS - disables errors on read/write of nonexisting members</span>\n   ClassOrInterface <span class="token operator">=</span> Class <span class="token operator">|</span> Interface\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 TypeScript src/compiler/types 源码里，定义了大量如上所示的基于数字类型的常量枚举。它们是一种有效存储和表示布尔值集合的方法。</p>\n<p>在 《深入理解 TypeScript》 中有一个使用例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18397884715348201000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`enum AnimalFlags {\n   None = 0,\n   HasClaws = 1 << 0,\n   CanFly = 1 << 1,\n   HasClawsOrCanFly = HasClaws | CanFly\n}\n\ninterface Animal {\n   flags: AnimalFlags;\n   [key: string]: any;\n}\n\nfunction printAnimalAbilities(animal: Animal) {\n   var animalFlags = animal.flags;\n   if (animalFlags & AnimalFlags.HasClaws) {\n      console.log(\'animal has claws\');\n   }\n   if (animalFlags & AnimalFlags.CanFly) {\n      console.log(\'animal can fly\');\n   }\n   if (animalFlags == AnimalFlags.None) {\n      console.log(\'nothing\');\n   }\n}\n\nvar animal = { flags: AnimalFlags.None };\nprintAnimalAbilities(animal); // nothing\nanimal.flags |= AnimalFlags.HasClaws;\nprintAnimalAbilities(animal); // animal has claws\nanimal.flags &= ~AnimalFlags.HasClaws;\nprintAnimalAbilities(animal); // nothing\nanimal.flags |= AnimalFlags.HasClaws | AnimalFlags.CanFly;\nprintAnimalAbilities(animal); // animal has claws, animal can fly`, `18397884715348201000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">enum</span> AnimalFlags <span class="token punctuation">{</span>\n   None <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n   HasClaws <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span>\n   CanFly <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span>\n   HasClawsOrCanFly <span class="token operator">=</span> HasClaws <span class="token operator">|</span> CanFly\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>\n   flags<span class="token punctuation">:</span> AnimalFlags<span class="token punctuation">;</span>\n   <span class="token punctuation">[</span>key<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">printAnimalAbilities</span><span class="token punctuation">(</span><span class="token parameter">animal<span class="token punctuation">:</span> Animal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">var</span> animalFlags <span class="token operator">=</span> animal<span class="token punctuation">.</span>flags<span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>animalFlags <span class="token operator">&amp;</span> AnimalFlags<span class="token punctuation">.</span>HasClaws<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'animal has claws\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>animalFlags <span class="token operator">&amp;</span> AnimalFlags<span class="token punctuation">.</span>CanFly<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'animal can fly\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>animalFlags <span class="token operator">==</span> AnimalFlags<span class="token punctuation">.</span>None<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'nothing\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">var</span> animal <span class="token operator">=</span> <span class="token punctuation">{</span> flags<span class="token punctuation">:</span> AnimalFlags<span class="token punctuation">.</span>None <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token function">printAnimalAbilities</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// nothing</span>\nanimal<span class="token punctuation">.</span>flags <span class="token operator">|=</span> AnimalFlags<span class="token punctuation">.</span>HasClaws<span class="token punctuation">;</span>\n<span class="token function">printAnimalAbilities</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// animal has claws</span>\nanimal<span class="token punctuation">.</span>flags <span class="token operator">&amp;=</span> <span class="token operator">~</span>AnimalFlags<span class="token punctuation">.</span>HasClaws<span class="token punctuation">;</span>\n<span class="token function">printAnimalAbilities</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// nothing</span>\nanimal<span class="token punctuation">.</span>flags <span class="token operator">|=</span> AnimalFlags<span class="token punctuation">.</span>HasClaws <span class="token operator">|</span> AnimalFlags<span class="token punctuation">.</span>CanFly<span class="token punctuation">;</span>\n<span class="token function">printAnimalAbilities</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// animal has claws, animal can fly</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上例代码中 |= 用来添加一个标志，&#x26;= 和 ~ 用来删除标志，| 用来合并标志。</p>\n<h2 id="decorator"><a href="#decorator" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Decorator</h2>\n<p>Decorator 早已不是什么新鲜事物，在 TypeScript 1.5 + 的版本中，我们可以利用内置类型 ClassDecorator、PropertyDecorator、MethodDecorator 与 ParameterDecorator 更快书写 Decorator，如 MethodDecorator：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40525858151106716000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare type MethodDecorator = <T>(\n   target: Object,\n   propertyKey: string | symbol,\n   descriptor: TypedPropertyDescriptor<T>\n) => TypedPropertyDescriptor<T> | void;`, `40525858151106716000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">type</span> MethodDecorator <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>\n   <span class="token parameter">target<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>\n   propertyKey<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span>\n   descriptor<span class="token punctuation">:</span> TypedPropertyDescriptor<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span>\n<span class="token punctuation">)</span> <span class="token operator">=></span> TypedPropertyDescriptor<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用时，只需在相应地方加上类型注解，匿名函数的参数类型也就会被自动推导出来了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69056432980155000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function methodDecorator(): MethodDecorator {\n   return (target, key, descriptor) => {\n      // ...\n   };\n}`, `69056432980155000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">methodDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> MethodDecorator <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>值得一提的是，如果你在 Decorator 给目标类的 prototype 添加属性时，TypeScript 并不知道这些：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83481294857734640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function testAble(): ClassDecorator {\n   return (target) => {\n      target.prototype.someValue = true;\n   };\n}\n\n@testAble()\nclass SomeClass {}\n\nconst someClass = new SomeClass();\n\nsomeClass.someValue(); // Error: Property \'someValue\' does not exist on type \'SomeClass\'.`, `83481294857734640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">testAble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ClassDecorator <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>someValue <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n@<span class="token function">testAble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> someClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nsomeClass<span class="token punctuation">.</span><span class="token function">someValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Property \'someValue\' does not exist on type \'SomeClass\'.</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这很常见，特别是当你想用 Decorator 来扩展一个类时。</p>\n<p>GitHub 上有一个关于此问题的 issues，直至目前，也没有一个合适的方案实现它。其主要问题在于 TypeScript 并不知道目标类是否使用了 Decorator 以及 Decorator 的名称。从这个 issues 来看，建议的解决办法是使用 Mixin：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86686698916429270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Constructor<T> = new (...args: any[]) => T;\n\n// mixin 函数的声明，需要实现\ndeclare function mixin<T1, T2>(...MixIns: [Constructor<T1>, Constructor<T2>]): Constructor<T1 & T2>;\n\nclass MixInClass1 {\n   mixinMethod1() {}\n}\n\nclass MixInClass2 {\n   mixinMethod2() {}\n}\n\nclass Base extends mixin(MixInClass1, MixInClass2) {\n   baseMethod() {}\n}\n\nconst x = new Base();\n\nx.baseMethod(); // OK\nx.mixinMethod1(); // OK\nx.mixinMethod2(); // OK\nx.mixinMethod3(); // Error`, `86686698916429270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Constructor<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">;</span>\n\n<span class="token comment">// mixin 函数的声明，需要实现</span>\n<span class="token keyword">declare</span> <span class="token keyword">function</span> mixin<span class="token operator">&lt;</span><span class="token constant">T1</span><span class="token punctuation">,</span> <span class="token constant">T2</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">...</span>MixIns<span class="token punctuation">:</span> <span class="token punctuation">[</span>Constructor<span class="token operator">&lt;</span><span class="token constant">T1</span><span class="token operator">></span><span class="token punctuation">,</span> Constructor<span class="token operator">&lt;</span><span class="token constant">T2</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Constructor<span class="token operator">&lt;</span><span class="token constant">T1</span> <span class="token operator">&amp;</span> <span class="token constant">T2</span><span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">MixInClass1</span> <span class="token punctuation">{</span>\n   <span class="token function">mixinMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">MixInClass2</span> <span class="token punctuation">{</span>\n   <span class="token function">mixinMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Base</span> <span class="token keyword">extends</span> <span class="token class-name">mixin</span><span class="token punctuation">(</span>MixInClass1<span class="token punctuation">,</span> MixInClass2<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token function">baseMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nx<span class="token punctuation">.</span><span class="token function">baseMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>\nx<span class="token punctuation">.</span><span class="token function">mixinMethod1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>\nx<span class="token punctuation">.</span><span class="token function">mixinMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>\nx<span class="token punctuation">.</span><span class="token function">mixinMethod3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当把大量的 JavaScript Decorator 重构为 Mixin 时，这无疑是一件让人头大的事情。</p>\n<p>这有一些偏方，能让你顺利从 JavaScript 迁移至 TypeScript：</p>\n<ul>\n<li>\n<p>显式赋值断言修饰符，即是在类里，明确说明某些属性存在于类上：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85767542526488170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function testAble(): ClassDecorator {\n  return (target) => {\n     target.prototype.someValue = true;\n  };\n}\n\n@testAble()\nclass SomeClass {\n  public someValue!: boolean;\n}\n\nconst someClass = new SomeClass();\nsomeClass.someValue; // true`, `85767542526488170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">testAble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ClassDecorator <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n     target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>someValue <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n@<span class="token function">testAble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n  <span class="token keyword">public</span> someValue<span class="token operator">!</span><span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> someClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nsomeClass<span class="token punctuation">.</span>someValue<span class="token punctuation">;</span> <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>采用声明合并形式，单独定义一个 interface，把用 Decorator 扩展的属性的类型，放入 interface 中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53362352416607360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface SomeClass {\n  someValue: boolean;\n}\n\nfunction testAble(): ClassDecorator {\n  return (target) => {\n     target.prototype.someValue = true;\n  };\n}\n\n@testAble()\nclass SomeClass {}\n\nconst someClass = new SomeClass();\nsomeClass.someValue; // true`, `53362352416607360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n  someValue<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">testAble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ClassDecorator <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n     target<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>someValue <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n@<span class="token function">testAble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> someClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nsomeClass<span class="token punctuation">.</span>someValue<span class="token punctuation">;</span> <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h2 id="reflect-metadata"><a href="#reflect-metadata" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reflect Metadata</h2>\n<p>Reflect Metadata 是 ES7 的一个提案，它主要用来在声明的时候添加和读取元数据。TypeScript 在 1.5+ 的版本已经支持它，你只需要：</p>\n<ul>\n<li>npm i reflect-metadata —save。</li>\n<li>在 tsconfig.json 里配置 emitDecoratorMetadata 选项。</li>\n</ul>\n<p>它具有诸多使用场景。</p>\n<h3 id="获取类型信息"><a href="#%E8%8E%B7%E5%8F%96%E7%B1%BB%E5%9E%8B%E4%BF%A1%E6%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取类型信息</h3>\n<p>譬如在 vue-property-decorator 6.1 及其以下版本中，通过使用 Reflect.getMetadata API，Prop Decorator 能获取属性类型传至 Vue，简要代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65458668404873950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Prop(): PropertyDecorator {\n   return (target, key: string) => {\n      const type = Reflect.getMetadata(\'design:type\', target, key);\n      console.log(\\`\\${key} type: \\${type.name}\\`);\n      // other...\n   };\n}\n\nclass SomeClass {\n   @Prop()\n   public Aprop!: string;\n}`, `65458668404873950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">Prop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> PropertyDecorator <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token keyword">type</span> <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token string">\'design:type\'</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> type: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">type</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// other...</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n   @<span class="token function">Prop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n   <span class="token keyword">public</span> Aprop<span class="token operator">!</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行代码可在控制台看到 Aprop type: string。除能获取属性类型外，通过 Reflect.getMetadata(“design:paramtypes”, target, key) 和 Reflect.getMetadata(“design:returntype”, target, key) 可以分别获取函数参数类型和返回值类型。</p>\n<h3 id="自定义-metadatakey"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89-metadatakey" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义 metadataKey</h3>\n<p>除能获取类型信息外，常用于自定义 metadataKey，并在合适的时机获取它的值，示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83887390239883350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function classDecorator(): ClassDecorator {\n   return (target) => {\n      // 在类上定义元数据，key 为 \\`classMetaData\\`，value 为 \\`a\\`\n      Reflect.defineMetadata(\'classMetaData\', \'a\', target);\n   };\n}\n\nfunction methodDecorator(): MethodDecorator {\n   return (target, key, descriptor) => {\n      // 在类的原型属性 \'someMethod\' 上定义元数据，key 为 \\`methodMetaData\\`，value 为 \\`b\\`\n      Reflect.defineMetadata(\'methodMetaData\', \'b\', target, key);\n   };\n}\n\n@classDecorator()\nclass SomeClass {\n   @methodDecorator()\n   someMethod() {}\n}\n\nReflect.getMetadata(\'classMetaData\', SomeClass); // \'a\'\nReflect.getMetadata(\'methodMetaData\', new SomeClass(), \'someMethod\'); // \'b\'`, `83887390239883350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">classDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ClassDecorator <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 在类上定义元数据，key 为 `classMetaData`，value 为 `a`</span>\n      Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span><span class="token string">\'classMetaData\'</span><span class="token punctuation">,</span> <span class="token string">\'a\'</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">methodDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> MethodDecorator <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 在类的原型属性 \'someMethod\' 上定义元数据，key 为 `methodMetaData`，value 为 `b`</span>\n      Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span><span class="token string">\'methodMetaData\'</span><span class="token punctuation">,</span> <span class="token string">\'b\'</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n@<span class="token function">classDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n   @<span class="token function">methodDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n   <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nReflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token string">\'classMetaData\'</span><span class="token punctuation">,</span> SomeClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \'a\'</span>\nReflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token string">\'methodMetaData\'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'someMethod\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \'b\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="用例"><a href="#%E7%94%A8%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用例</h3>\n<h4 id="控制反转和依赖注入"><a href="#%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%E5%92%8C%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>控制反转和依赖注入</h4>\n<p>在 Angular 2+ 的版本中，控制反转与依赖注入便是基于此实现，现在，我们来实现一个简单版：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38905921301127550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Constructor<T = any> = new (...args: any[]) => T;\n\nconst Injectable = (): ClassDecorator => (target) => {};\n\nclass OtherService {\n   a = 1;\n}\n\n@Injectable()\nclass TestService {\n   constructor(public readonly otherService: OtherService) {}\n\n   testMethod() {\n      console.log(this.otherService.a);\n   }\n}\n\nconst Factory = <T>(target: Constructor<T>): T => {\n   // 获取所有注入的服务\n   const providers = Reflect.getMetadata(\'design:paramtypes\', target); // [OtherService]\n   const args = providers.map((provider: Constructor) => new provider());\n   return new target(...args);\n};\n\nFactory(TestService).testMethod(); // 1`, `38905921301127550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Constructor<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> Injectable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">ClassDecorator</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">OtherService</span> <span class="token punctuation">{</span>\n   a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">TestService</span> <span class="token punctuation">{</span>\n   <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> <span class="token keyword">readonly</span> otherService<span class="token punctuation">:</span> OtherService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n   <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>otherService<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> Factory <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> Constructor<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token constant">T</span></span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token comment">// 获取所有注入的服务</span>\n   <span class="token keyword">const</span> providers <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token string">\'design:paramtypes\'</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [OtherService]</span>\n   <span class="token keyword">const</span> args <span class="token operator">=</span> providers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">provider<span class="token punctuation">:</span> Constructor</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">provider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">target</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">Factory</span><span class="token punctuation">(</span>TestService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="controller-与-get-的实现"><a href="#controller-%E4%B8%8E-get-%E7%9A%84%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Controller 与 Get 的实现</h4>\n<p>如果你在使用 TypeScript 开发 Node 应用，相信你对 Controller、Get、POST 这些 Decorator，并不陌生：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41052548001303980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@Controller(\'/test\')\nclass SomeClass {\n   @Get(\'/a\')\n   someGetMethod() {\n      return \'hello world\';\n   }\n\n   @Post(\'/b\')\n   somePostMethod() {}\n}`, `41052548001303980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts">@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">\'/test\'</span><span class="token punctuation">)</span>\n<span class="token keyword">class</span> <span class="token class-name">SomeClass</span> <span class="token punctuation">{</span>\n   @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">\'/a\'</span><span class="token punctuation">)</span>\n   <span class="token function">someGetMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token string">\'hello world\'</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n\n   @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">\'/b\'</span><span class="token punctuation">)</span>\n   <span class="token function">somePostMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它们也是基于 Reflect Metadata 实现，不同的是，这次我们将 metadataKey 定义在 descriptor 的 value 上（稍后解释），简单实现如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23566714199197737000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const METHOD_METADATA = \'method\'；\nconst PATH_METADATA = \'path\'；\n\nconst Controller = (path: string): ClassDecorator => {\n  return target => {\n    Reflect.defineMetadata(PATH_METADATA, path, target);\n  }\n}\n\nconst createMappingDecorator = (method: string) => (path: string): MethodDecorator => {\n  return (target, key, descriptor) => {\n    Reflect.defineMetadata(PATH_METADATA, path, descriptor.value);\n    Reflect.defineMetadata(METHOD_METADATA, method, descriptor.value);\n  }\n}\n\nconst Get = createMappingDecorator(\'GET\');\nconst Post = createMappingDecorator(\'POST\');`, `23566714199197737000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> <span class="token constant">METHOD_METADATA</span> <span class="token operator">=</span> <span class="token string">\'method\'</span>；\n<span class="token keyword">const</span> <span class="token constant">PATH_METADATA</span> <span class="token operator">=</span> <span class="token string">\'path\'</span>；\n\n<span class="token keyword">const</span> Controller <span class="token operator">=</span> <span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">ClassDecorator</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token parameter">target</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span><span class="token constant">PATH_METADATA</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">createMappingDecorator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter">MethodDecorator</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> descriptor</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span><span class="token constant">PATH_METADATA</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> descriptor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Reflect<span class="token punctuation">.</span><span class="token function">defineMetadata</span><span class="token punctuation">(</span><span class="token constant">METHOD_METADATA</span><span class="token punctuation">,</span> method<span class="token punctuation">,</span> descriptor<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> Get <span class="token operator">=</span> <span class="token function">createMappingDecorator</span><span class="token punctuation">(</span><span class="token string">\'GET\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> Post <span class="token operator">=</span> <span class="token function">createMappingDecorator</span><span class="token punctuation">(</span><span class="token string">\'POST\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接着，创建一个函数，映射出 route：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92969845508626550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function mapRoute(instance: Object) {\n   const prototype = Object.getPrototypeOf(instance);\n\n   // 筛选出类的 methodName\n   const methodsNames = Object.getOwnPropertyNames(prototype).filter(\n      (item) => !isConstructor(item) && isFunction(prototype[item])\n   );\n   return methodsNames.map((methodName) => {\n      const fn = prototype[methodName];\n\n      // 取出定义的 metadata\n      const route = Reflect.getMetadata(PATH_METADATA, fn);\n      const method = Reflect.getMetadata(METHOD_METADATA, fn);\n      return {\n         route,\n         method,\n         fn,\n         methodName\n      };\n   });\n}`, `92969845508626550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">mapRoute</span><span class="token punctuation">(</span><span class="token parameter">instance<span class="token punctuation">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n   <span class="token comment">// 筛选出类的 methodName</span>\n   <span class="token keyword">const</span> methodsNames <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>prototype<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>\n      <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token function">isConstructor</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>prototype<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> methodsNames<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">methodName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> fn <span class="token operator">=</span> prototype<span class="token punctuation">[</span>methodName<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 取出定义的 metadata</span>\n      <span class="token keyword">const</span> route <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token constant">PATH_METADATA</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> method <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token constant">METHOD_METADATA</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> <span class="token punctuation">{</span>\n         route<span class="token punctuation">,</span>\n         method<span class="token punctuation">,</span>\n         fn<span class="token punctuation">,</span>\n         methodName\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们可以得到一些有用的信息：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11527522563372550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Reflect.getMetadata(PATH_METADATA, SomeClass); // \'/test\'\n\nmapRoute(new SomeClass());\n\n/**\n * [{\n *    route: \'/a\',\n *    method: \'GET\',\n *    fn: someGetMethod() { ... },\n *    methodName: \'someGetMethod\'\n *  },{\n *    route: \'/b\',\n *    method: \'POST\',\n *    fn: somePostMethod() { ... },\n *    methodName: \'somePostMethod\'\n * }]\n *\n */`, `11527522563372550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts">Reflect<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token constant">PATH_METADATA</span><span class="token punctuation">,</span> SomeClass<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \'/test\'</span>\n\n<span class="token function">mapRoute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SomeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * [{\n *    route: \'/a\',\n *    method: \'GET\',\n *    fn: someGetMethod() { ... },\n *    methodName: \'someGetMethod\'\n *  },{\n *    route: \'/b\',\n *    method: \'POST\',\n *    fn: somePostMethod() { ... },\n *    methodName: \'somePostMethod\'\n * }]\n *\n */</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后，只需把 route 相关信息绑在 express 或者 koa 上就 ok 了。</p>\n<p>至于为什么要定义在 descriptor 的 value 上，我们希望 mapRoute 函数的参数是一个实例，而非 class 本身（控制反转）。</p>\n<h2 id="数组与元组"><a href="#%E6%95%B0%E7%BB%84%E4%B8%8E%E5%85%83%E7%BB%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数组与元组</h2>\n<p>创建一个数组很简单：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15723395600319523000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const arr = [1];`, `15723395600319523000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时 TypeScript 将会推断 arr 类型为 number[]：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87245086975218170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`arr.push(\'1\'); // Error`, `87245086975218170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts">arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当数组元素具有其它类型时，可以通过类型注解的方式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3559117533733768700"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const arr: Array<string | number> = [1];\n\narr.push(\'1\'); // OK\narr.push(true); // Error`, `3559117533733768700`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> arr<span class="token punctuation">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\narr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>\narr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>或者你也可以通过可选元组的方式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95487133950170100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const arr: [number, string?] = [1]; // arr 的成员类型可以是: number, string, undefined\narr.push(\'1\'); // OK\narr.push(true); // Error`, `95487133950170100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">?</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// arr 的成员类型可以是: number, string, undefined</span>\narr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// OK</span>\narr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>使用元组形式，还能提供指定位置的类型检查：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12571905303455599000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`arr[0] = \'1\'; // Error\narr[1] = 1; // Error`, `12571905303455599000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts">arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'1\'</span><span class="token punctuation">;</span> <span class="token comment">// Error</span>\narr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h3 id="使用"><a href="#%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用</h3>\n<p>通常，我们使用 Promise.all 并行发出多个请求：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2329944114566440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface A {\n   name: string;\n}\n\ninterface B {\n   age: number;\n}\n\nconst [{ data: a }, { data: b }] = await Promise.all([axios.get<A>(\'http://some.1\'), axios.get<B>(\'http://some.2\')]);`, `2329944114566440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> a <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> b <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">\'http://some.1\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">\'http://some.2\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，TypeScript 能推出 a 的类型是 A, b 的类型是 B。</p>\n<p>现在，稍作改变：当满足特定条件时，才发出第二个请求：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86958527408608740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 使用类型注解\nconst requestList: [Promise<AxiosResponse<A>>, Promise<AxiosResponse<B>>?] = [axios.get<A>(\'http://some.1\')];\nif (flag) {\n   requestList[1] = axios.get<B>(\'http://some.2\');\n}\nconst [{ data: a }, response] = await Promise.all(requestList);`, `86958527408608740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 使用类型注解</span>\n<span class="token keyword">const</span> requestList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">Promise</span><span class="token operator">&lt;</span>AxiosResponse<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">>></span><span class="token punctuation">,</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>AxiosResponse<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">>></span><span class="token operator">?</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">\'http://some.1\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   requestList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">\'http://some.2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> a <span class="token punctuation">}</span><span class="token punctuation">,</span> response<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>requestList<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们期望它会如预想时那样工作，可是事与愿违 Promise.all(requestList) 会出现类型兼容性的报错，在这个 Issues 里，描述了相同的问题。</p>\n<p>现在，你可以通过断言的方式，来让程序正常运作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37589388836246380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const requestList: any[] = [axios.get<A>(\'http://some.1\')]; // 设置为 any[] 类型\nif (flag) {\n   requestList[1] = axios.get<B>(\'http://some.2\');\n}\nconst [{ data: a }, response] = (await Promise.all(requestList)) as [AxiosResponse<A>, AxiosResponse<B>?]; // 类型安全`, `37589388836246380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> requestList<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">\'http://some.1\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 设置为 any[] 类型</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   requestList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">\'http://some.2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">const</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> a <span class="token punctuation">}</span><span class="token punctuation">,</span> response<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>requestList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">[</span>AxiosResponse<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span><span class="token punctuation">,</span> AxiosResponse<span class="token operator">&lt;</span><span class="token constant">B</span><span class="token operator">></span><span class="token operator">?</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 类型安全</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="字面量类型"><a href="#%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字面量类型</h2>\n<p>在 JavaScript 基础上，TypeScript 扩展了一系列字面量类型，用来确保类型的准确性。</p>\n<p>如创建一个字符串字面量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51788520455971955000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const a = \'hello\'; // a 的类型是 \'hello\'\na = \'world\'; // Error`, `51788520455971955000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">\'hello\'</span><span class="token punctuation">;</span> <span class="token comment">// a 的类型是 \'hello\'</span>\na <span class="token operator">=</span> <span class="token string">\'world\'</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>或者你也可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73038379536971210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`let a: \'hello\' = \'hello\'; // a 的类型是 \'hello\'\na = \'world\'; // Error`, `73038379536971210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">let</span> a<span class="token punctuation">:</span> <span class="token string">\'hello\'</span> <span class="token operator">=</span> <span class="token string">\'hello\'</span><span class="token punctuation">;</span> <span class="token comment">// a 的类型是 \'hello\'</span>\na <span class="token operator">=</span> <span class="token string">\'world\'</span><span class="token punctuation">;</span> <span class="token comment">// Error</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>其它数据类型与此相似。</p>\n<p>你也可以定义交叉类型与联合类型的字面量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41087291424713330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface A {\n   name: string;\n}\n\ninterface B {\n   name: string;\n   age: number;\n}\n\ntype C = A | B;\ntype D = A & B;`, `41087291424713330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token operator">|</span> <span class="token constant">B</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> <span class="token constant">D</span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token operator">&amp;</span> <span class="token constant">B</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="对象字面量类型"><a href="#%E5%AF%B9%E8%B1%A1%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对象字面量类型</h3>\n<p>对于对象字面量的类型，TypeScript 有一个被称之为 <code class="language-text">Freshness</code> 的概念，它也被称为更严格的对象字面量检查，如下例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42677745250061230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`let someThing: { name: string };\nsomeThing = { name: \'hello\' }; // ok\nsomeThing = { name: \'hello\', age: 123 }; // Error, 对象字面量只能指定已知属性, { name: string } 类型中不存在 age 属性\n\nlet otherThing = { name: \'hello\', age: 123 };\nsomeThing = otherThing; // ok`, `42677745250061230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">let</span> someThing<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\nsomeThing <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'hello\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\nsomeThing <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'hello\'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Error, 对象字面量只能指定已知属性, { name: string } 类型中不存在 age 属性</span>\n\n<span class="token keyword">let</span> otherThing <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'hello\'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\nsomeThing <span class="token operator">=</span> otherThing<span class="token punctuation">;</span> <span class="token comment">// ok</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>TypeScript 认为创建的每个对象字面量都是 <code class="language-text">fresh</code> 状态；当一个 <code class="language-text">fresh</code> 对象字面量赋值给一个变量时，如果对象的类型与变量类型不兼容时，会出现报错（如上例子中 <code class="language-text">someThine = { name: &#39;hello&#39;, age: 123 };</code> 的错误）；当对象字面量的类型变宽，对象字面量的 <code class="language-text">fresh</code> 状态会消失（如上例子中 <code class="language-text">someThing = otherThing;</code> 赋值以后 someThing 的类型变宽）。</p>\n<p>一个更实际的用例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71750172513322980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function logName(something: { name: string }) {\n   console.log(something.name);\n}\n\nconst obj = {\n   name: \'matt\',\n   job: \'being awesome\'\n};\n\nlogName(obj); // ok\nlogName({ name: \'matt\' }); // ok\nlogName({ nama: \'matt\' }); // Error: nama 属性在 { name: string } 属性中不存在。\nlogName({ name: \'matt\', job: \'being awesome\' }); // Error: 对象字面量只能指定已知属性，\\`job\\` 属性在这里并不存在。`, `71750172513322980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">logName</span><span class="token punctuation">(</span><span class="token parameter">something<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>something<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'matt\'</span><span class="token punctuation">,</span>\n   job<span class="token punctuation">:</span> <span class="token string">\'being awesome\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">logName</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\n<span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'matt\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span>\n<span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">{</span> nama<span class="token punctuation">:</span> <span class="token string">\'matt\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: nama 属性在 { name: string } 属性中不存在。</span>\n<span class="token function">logName</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'matt\'</span><span class="token punctuation">,</span> job<span class="token punctuation">:</span> <span class="token string">\'being awesome\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: 对象字面量只能指定已知属性，`job` 属性在这里并不存在。</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>基本原理与上文中相似，当想用更严格的类型检查时，可以传一个具有 fresh 状态的对象字面量（如 <code class="language-text">logName({ name: &#39;matt&#39;, job: &#39;being awesome&#39; });</code>）。当你想多传一些属性至函数，可以将对象字面量赋值至一个新变量，然后再传至函数（如 <code class="language-text">logName(obj)</code>）。或者你也可以通过给函数形参添加多余类型的方式 <code class="language-text">function logName(someThing: { name: string; [key: string]: string })</code>。</p>\n<h2 id="用-decorator-限制类型"><a href="#%E7%94%A8-decorator-%E9%99%90%E5%88%B6%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用 Decorator 限制类型</h2>\n<p>Decorator 可用于限制类方法的返回类型，如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98553494104127640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const TestDecorator = () => {\n   return (\n      target: Object,\n      key: string | symbol,\n      descriptor: TypedPropertyDescriptor<() => number> // 函数返回值必须是 number\n   ) => {\n      // 其他代码\n   };\n};\n\nclass Test {\n   @TestDecorator()\n   testMethod() {\n      return \'123\'; // Error: Type \'string\' is not assignable to type \'number\'\n   }\n}`, `98553494104127640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> <span class="token function-variable function">TestDecorator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      target<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>\n      key<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span>\n      descriptor<span class="token punctuation">:</span> TypedPropertyDescriptor<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">number</span><span class="token operator">></span> <span class="token comment">// 函数返回值必须是 number</span>\n   <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 其他代码</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>\n   @<span class="token function">TestDecorator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n   <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token string">\'123\'</span><span class="token punctuation">;</span> <span class="token comment">// Error: Type \'string\' is not assignable to type \'number\'</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你也可以用泛型让 TestDecorator 的传入参数类型与 testMethod 的返回参数类型兼容：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32710110249667523000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const TestDecorator = <T>(para: T) => {\n   return (target: Object, key: string | symbol, descriptor: TypedPropertyDescriptor<() => T>) => {\n      // 其他代码\n   };\n};\n\nclass Test {\n   @TestDecorator(\'hello\')\n   testMethod() {\n      return 123; // Error: Type \'number\' is not assignable to type \'string\'\n   }\n}`, `32710110249667523000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> TestDecorator <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token parameter">para<span class="token punctuation">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">:</span> Object<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span><span class="token punctuation">,</span> descriptor<span class="token punctuation">:</span> TypedPropertyDescriptor<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 其他代码</span>\n   <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>\n   @<span class="token function">TestDecorator</span><span class="token punctuation">(</span><span class="token string">\'hello\'</span><span class="token punctuation">)</span>\n   <span class="token function">testMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// Error: Type \'number\' is not assignable to type \'string\'</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="泛型的类型推断"><a href="#%E6%B3%9B%E5%9E%8B%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>泛型的类型推断</h2>\n<p>在定义泛型后，有两种方式使用，一种是传入泛型类型，另一种使用类型推断，即编译器根据其他参数类型来推断泛型类型。简单示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58086541409186630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare function fn<T>(arg: T): T; // 定义一个泛型函数\n\nconst fn1 = fn<string>(\'hello\'); // 第一种方式，传入泛型类型 string\nconst fn2 = fn(1); // 第二种方式，从参数 arg 传入的类型 number，来推断出泛型 T 的类型是 number`, `58086541409186630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">function</span> fn<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> <span class="token comment">// 定义一个泛型函数</span>\n\n<span class="token keyword">const</span> fn1 <span class="token operator">=</span> fn<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">\'hello\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一种方式，传入泛型类型 string</span>\n<span class="token keyword">const</span> fn2 <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第二种方式，从参数 arg 传入的类型 number，来推断出泛型 T 的类型是 number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它通常与映射类型一起使用，用来实现一些比较复杂的功能。</p>\n<h3 id="vue-type-简单实现"><a href="#vue-type-%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Vue Type 简单实现</h3>\n<p>如下一个例子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42192792197733870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Options<T> = {\n   [P in keyof T]: T[P];\n};\n\ndeclare function test<T>(o: Options<T>): T;\n\ntest({ name: \'Hello\' }).name; // string`, `42192792197733870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> test<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>o<span class="token punctuation">:</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n\n<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'Hello\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// string</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>test 函数将传入参数的所有属性取出来，现在我们来一步一步加工，实现想要的功能。</p>\n<p>首先，更改传入参数的形式，由 <code class="language-text">{ name: &#39;Hello&#39; }</code> 的形式变更为 <code class="language-text">{ data: { name: &#39;Hello&#39; } }</code>，调用函数的返回值类型不变，即 <code class="language-text">test({ data: { name: &#39;Hello&#39; } }).name</code> 的值也是 string 类型。</p>\n<p>这并不复杂，这只需要把传入参数的 data 类型设置为 T 即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28808491087116874000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare function test<T>(o: { data: Options<T> }): T;\n\ntest({ data: { name: \'Hello\' } }).name; // string`, `28808491087116874000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">function</span> test<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>o<span class="token punctuation">:</span> <span class="token punctuation">{</span> data<span class="token punctuation">:</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n\n<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'Hello\'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// string</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当 data 对象里，含有函数时，它也能运作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60354480074153620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const param = {\n   data: {\n      name: \'Hello\',\n      someMethod() {\n         return \'hello world\';\n      }\n   }\n};\n\ntest(param).someMethod(); // string`, `60354480074153620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'Hello\'</span><span class="token punctuation">,</span>\n      <span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span> <span class="token string">\'hello world\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">test</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>接着，考虑一种特殊的函数情景，像 Vue 中 Computed 一样，不调用函数，也能取出函数的返回值类型。现在传入参数的形式变更为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96382041031693060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const param = {\n   data: {\n      name: \'Hello\'\n   },\n   computed: {\n      age() {\n         return 20;\n      }\n   }\n};`, `96382041031693060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'Hello\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>一个函数的类型可以简单的看成是 <code class="language-text">() =&gt; T</code> 的形式，对象中的方法类型，可以看成 <code class="language-text">a: () =&gt; T</code> 的形式，在反向推导时（由函数返回值，来推断类型 a 的类型）可以利用它，需要添加一个映射类型 <code class="language-text">Computed&lt;T&gt;</code>，用来处理 computed 里的函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30733229001491534000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Options<T> = {\n   [P in keyof T]: T[P];\n};\n\ntype Computed<T> = {\n   [P in keyof T]: () => T[P];\n};\n\ninterface Params<T, M> {\n   data: Options<T>;\n   computed: Computed<M>;\n}\n\ndeclare function test<T, M>(o: Params<T, M>): T & M;\n\nconst param = {\n   data: {\n      name: \'Hello\'\n   },\n   computed: {\n      age() {\n         return 20;\n      }\n   }\n};\n\ntest(param).name; // string\ntest(param).age; // number`, `30733229001491534000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Computed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Params</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>\n   computed<span class="token punctuation">:</span> Computed<span class="token operator">&lt;</span><span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> test<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">(</span>o<span class="token punctuation">:</span> Params<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token constant">M</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'Hello\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">test</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// string</span>\n<span class="token function">test</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span>age<span class="token punctuation">;</span> <span class="token comment">// number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后，结合巧用 ThisType 映射类型，可以轻松的实现在 computed age 方法下访问 data 中的数据：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90400634045523350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Options<T> = {\n   [P in keyof T]: T[P];\n};\n\ntype Computed<T> = {\n   [P in keyof T]: () => T[P];\n};\n\ninterface Params<T, M> {\n   data: Options<T>;\n   computed: Computed<M>;\n}\n\ndeclare function test<T, M>(o: Params<T, M>): T & M;\n\nconst param = {\n   data: {\n      name: \'Hello\'\n   },\n   computed: {\n      age() {\n         return 20;\n      }\n   }\n};\n\ntest(param).name; // string\ntest(param).age; // number`, `90400634045523350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Computed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Params</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">;</span>\n   computed<span class="token punctuation">:</span> Computed<span class="token operator">&lt;</span><span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> test<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">(</span>o<span class="token punctuation">:</span> Params<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token constant">M</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> param <span class="token operator">=</span> <span class="token punctuation">{</span>\n   data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'Hello\'</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">test</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// string</span>\n<span class="token function">test</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">.</span>age<span class="token punctuation">;</span> <span class="token comment">// number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="扁平数组构建树形结构"><a href="#%E6%89%81%E5%B9%B3%E6%95%B0%E7%BB%84%E6%9E%84%E5%BB%BA%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扁平数组构建树形结构</h3>\n<p>扁平数组构建树形结构即是将一组扁平数组，根据 parent_id（或者是其他）转换成树形结构：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27481443278975660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 转换前数据\nconst arr = [\n   { id: 1, parentId: 0, name: \'test1\' },\n   { id: 2, parentId: 1, name: \'test2\' },\n   { id: 3, parentId: 0, name: \'test3\' }\n];\n\n// 转化后\n[\n   {\n      id: 1,\n      parentId: 0,\n      name: \'test1\',\n      children: [\n         {\n            id: 2,\n            parentId: 1,\n            name: \'test2\',\n            children: []\n         }\n      ]\n   },\n   {\n      id: 3,\n      parentId: 0,\n      name: \'test3\',\n      children: []\n   }\n];`, `27481443278975660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 转换前数据</span>\n<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>\n   <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> parentId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'test1\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> parentId<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'test2\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> parentId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'test3\'</span> <span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 转化后</span>\n<span class="token punctuation">[</span>\n   <span class="token punctuation">{</span>\n      id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n      parentId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'test1\'</span><span class="token punctuation">,</span>\n      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n            parentId<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n            name<span class="token punctuation">:</span> <span class="token string">\'test2\'</span><span class="token punctuation">,</span>\n            children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span>\n      id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>\n      parentId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'test3\'</span><span class="token punctuation">,</span>\n      children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果 children 字段名字不变，函数的类型并不难写，它大概是如下样子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53204410211977100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Item {\n   id: number;\n   parentId: number;\n   name: string;\n}\n\ntype TreeItem = Item & { children: TreeItem[] | [] };\n\ndeclare function listToTree(list: Item[]): TreeItem[];\n\nlistToTree(arr).forEach((i) => i.children); // ok`, `53204410211977100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>\n   id<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   parentId<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> TreeItem <span class="token operator">=</span> Item <span class="token operator">&amp;</span> <span class="token punctuation">{</span> children<span class="token punctuation">:</span> TreeItem<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">listToTree</span><span class="token punctuation">(</span><span class="token parameter">list<span class="token punctuation">:</span> Item<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> TreeItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token function">listToTree</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是在很多时候，children 字段的名字并不固定，而是从参数中传进来：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84581559879078000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const options = {\n   childrenKey: \'childrenList\'\n};\n\nlistToTree(arr, options);`, `84581559879078000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>\n   childrenKey<span class="token punctuation">:</span> <span class="token string">\'childrenList\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">listToTree</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时 children 字段名称应该为 childrenList：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21700339482448937000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[\n   {\n      id: 1,\n      parentId: 0,\n      name: \'test1\',\n      childrenList: [{ id: 2, parentId: 1, name: \'test2\', childrenList: [] }]\n   },\n   {\n      id: 3,\n      parentId: 0,\n      name: \'test3\',\n      childrenList: []\n   }\n];`, `21700339482448937000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token punctuation">[</span>\n   <span class="token punctuation">{</span>\n      id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n      parentId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'test1\'</span><span class="token punctuation">,</span>\n      childrenList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> parentId<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'test2\'</span><span class="token punctuation">,</span> childrenList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span>\n      id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>\n      parentId<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'test3\'</span><span class="token punctuation">,</span>\n      childrenList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实现的思路大致是前文所说的利用泛型的类型推断，从传入的 options 参数中，得到 childrenKey 的类型，然后再传给 TreeItem，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65078285363453280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Options<T extends string> {\n   // 限制为 string 类型\n   childrenKey: T;\n}\n\ndeclare function listToTree<T extends string = \'children\'>(list: Item[], options: Options<T>): TreeItem<T>[];`, `65078285363453280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Options</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   <span class="token comment">// 限制为 string 类型</span>\n   childrenKey<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> listToTree<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span> <span class="token operator">=</span> <span class="token string">\'children\'</span><span class="token operator">></span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token punctuation">:</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> TreeItem<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当 options 为 <code class="language-text">{ childrenKey: &#39;childrenList&#39; }</code> 时，T 能被正确推导出为 childrenList，接着只需要在 TreeItem 中，把 children 修改为传入的 T 即可：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92233687566454590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Item {\n   id: number;\n   parentId: number;\n   name: string;\n}\n\ninterface Options<T extends string> {\n   childrenKey: T;\n}\n\ntype TreeItem<T extends string> = Item & { [key in T]: TreeItem<T>[] | [] };\n\ndeclare function listToTree<T extends string = \'children\'>(list: Item[], options: Options<T>): TreeItem<T>[];\n\nlistToTree(arr, { childrenKey: \'childrenList\' }).forEach((i) => i.childrenList); // ok`, `92233687566454590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Item</span> <span class="token punctuation">{</span>\n   id<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   parentId<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Options</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   childrenKey<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> TreeItem<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span><span class="token operator">></span> <span class="token operator">=</span> Item <span class="token operator">&amp;</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key <span class="token keyword">in</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> TreeItem<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">declare</span> <span class="token keyword">function</span> listToTree<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span> <span class="token operator">=</span> <span class="token string">\'children\'</span><span class="token operator">></span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> Item<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token punctuation">:</span> Options<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> TreeItem<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token function">listToTree</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token punctuation">{</span> childrenKey<span class="token punctuation">:</span> <span class="token string">\'childrenList\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i<span class="token punctuation">.</span>childrenList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有一点局限性，由于对象字面量的 Fresh 的影响，当 options 不是以对象字面量的形式传入时，需要给它断言：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58955625280609180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const options = {\n   childrenKey: \'childrenList\' as \'childrenList\'\n};\n\nlistToTree(arr, options).forEach((i) => i.childrenList); // ok`, `58955625280609180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>\n   childrenKey<span class="token punctuation">:</span> <span class="token string">\'childrenList\'</span> <span class="token keyword">as</span> <span class="token string">\'childrenList\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">listToTree</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i<span class="token punctuation">.</span>childrenList<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ok</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="infer"><a href="#infer" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>infer</h2>\n<p>infer 最早出现在此 PR 中，表示在 extends 条件语句中待推断的类型变量。</p>\n<p>简单示例如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48836960826542760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ParamType<T> = T extends (param: infer P) => any ? P : T;`, `48836960826542760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ParamType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter">param<span class="token punctuation">:</span> infer <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在这个条件语句 <code class="language-text">T extends (param: infer P) =&gt; any ? P : T</code> 中，<code class="language-text">infer P</code> 表示待推断的函数参数。</p>\n<p>整句表示为：如果 T 能赋值给 <code class="language-text">(param: infer P) =&gt; any</code>，则结果是 <code class="language-text">(param: infer P) =&gt; any</code> 类型中的参数 P，否则返回为 T。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67956068721161240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface User {\n   name: string;\n   age: number;\n}\n\ntype Func = (user: User) => void;\n\ntype Param = ParamType<Func>; // Param = User\ntype AA = ParamType<string>; // string`, `67956068721161240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   age<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> <span class="token function-variable function">Func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">:</span> User</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Param <span class="token operator">=</span> ParamType<span class="token operator">&lt;</span>Func<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Param = User</span>\n<span class="token keyword">type</span> <span class="token constant">AA</span> <span class="token operator">=</span> ParamType<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="内置类型"><a href="#%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内置类型</h3>\n<p>在 2.8 版本中，TypeScript 内置了一些与 infer 有关的映射类型：</p>\n<ul>\n<li>用于提取函数类型的返回值类型：</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4825888267658396000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ReturnType<T> = T extends (...args: any[]) => infer P ? P : any;`, `4825888267658396000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> infer <span class="token constant">P</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>相比于文章开始给出的示例，<code class="language-text">ReturnType&lt;T&gt;</code> 只是将 infer P 从参数位置移动到返回值位置，因此此时 P 即是表示待推断的返回值类型。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16985658457797204000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Func = () => User;\ntype Test = ReturnType<Func>; // Test = User`, `16985658457797204000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> <span class="token function-variable function">Func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> User<span class="token punctuation">;</span>\n<span class="token keyword">type</span> Test <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span>Func<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Test = User</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<ul>\n<li>用于提取构造函数中参数（实例）类型：</li>\n</ul>\n<p>一个构造函数可以使用 new 来实例化，因此它的类型通常表示如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74165119251272580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Constructor = new (...args: any[]) => any;`, `74165119251272580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Constructor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>当 infer 用于构造函数类型中，可用于参数位置 <code class="language-text">new (...args: infer P) =&gt; any;</code> 和返回值位置 <code class="language-text">new (...args: any[]) =&gt; infer P;</code>。</p>\n<p>因此就内置如下两个映射类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38451870712980400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 获取参数类型\ntype ConstructorParameters<T extends new (...args: any[]) => any> = T extends new (...args: infer P) => any ? P : never;\n\n// 获取实例类型\ntype InstanceType<T extends new (...args: any[]) => any> = T extends new (...args: any[]) => infer R ? R : any;\n\nclass TestClass {\n   constructor(public name: string, public string: number) {}\n}\n\ntype Params = ConstructorParameters<typeof TestClass>; // [string, number]\n\ntype Instance = InstanceType<typeof TestClass>; // TestClass`, `38451870712980400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 获取参数类型</span>\n<span class="token keyword">type</span> ConstructorParameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> infer <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 获取实例类型</span>\n<span class="token keyword">type</span> InstanceType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> infer <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">TestClass</span> <span class="token punctuation">{</span>\n   <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token keyword">public</span> <span class="token builtin">string</span><span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> Params <span class="token operator">=</span> ConstructorParameters<span class="token operator">&lt;</span><span class="token keyword">typeof</span> TestClass<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// [string, number]</span>\n\n<span class="token keyword">type</span> Instance <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> TestClass<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// TestClass</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="一些用例"><a href="#%E4%B8%80%E4%BA%9B%E7%94%A8%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一些用例</h3>\n<p>至此，相信你已经对 infer 已有基本了解，我们来看看一些使用它的「骚操作」：</p>\n<ul>\n<li>tuple 转 union ，如：<code class="language-text">[string, number] -&gt; string | number</code></li>\n</ul>\n<p>解答之前，我们需要了解 tuple 类型在一定条件下，是可以赋值给数组类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90213510503713230000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type TTuple = [string, number];\ntype TArray = Array<string | number>;\n\ntype Res = TTuple extends TArray ? true : false; // true\ntype ResO = TArray extends TTuple ? true : false; // false`, `90213510503713230000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> TTuple <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> TArray <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Res <span class="token operator">=</span> TTuple <span class="token keyword">extends</span> <span class="token class-name">TArray</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// true</span>\n<span class="token keyword">type</span> ResO <span class="token operator">=</span> TArray <span class="token keyword">extends</span> <span class="token class-name">TTuple</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// false</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因此，在配合 infer 时，很容易做到：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22787133055392460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ElementOf<T> = T extends Array<infer E> ? E : never;\n\ntype TTuple = [string, number];\n\ntype ToUnion = ElementOf<TTuple>; // string | number`, `22787133055392460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ElementOf<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token operator">&lt;</span>infer <span class="token constant">E</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">E</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> TTuple <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ToUnion <span class="token operator">=</span> ElementOf<span class="token operator">&lt;</span>TTuple<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string | number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 stackoverflow 上看到另一种解法，比较简（牛）单（逼）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97762845380725060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type TTuple = [string, number];\ntype Res = TTuple[number]; // string | number`, `97762845380725060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> TTuple <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> Res <span class="token operator">=</span> TTuple<span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// string | number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<ul>\n<li>union 转 intersection，如：<code class="language-text">string | number -&gt; string &amp; number</code></li>\n</ul>\n<p>这个可能要稍微麻烦一点，需要 infer 配合 <code class="language-text">Distributive conditional types</code> 使用。</p>\n<p><code class="language-text">Distributive conditional types</code> 是由 <code class="language-text">naked type parameter</code> 构成的条件类型。而 <code class="language-text">naked type parameter</code> 表示没有被 Wrapped 的类型（如：<code class="language-text">Array&lt;T&gt;</code>、<code class="language-text">[T]</code>、<code class="language-text">Promise&lt;T&gt;</code> 等都是不是 <code class="language-text">naked type parameter</code>）。<code class="language-text">Distributive conditional types</code> 主要用于拆分 extends 左边部分的联合类型，举个例子：在条件类型 <code class="language-text">T extends U ? X : Y</code> 中，当 T 是 <code class="language-text">A | B</code> 时，会拆分成 <code class="language-text">A extends U ? X : Y | B extends U ? X : Y</code>；</p>\n<p>有了这个前提，再利用在逆变位置上，同一类型变量的多个候选类型将会被推断为交叉类型的特性，即</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39531247391261810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Bar<T> = T extends { a: (x: infer U) => void; b: (x: infer U) => void } ? U : never;\ntype T20 = Bar<{ a: (x: string) => void; b: (x: string) => void }>; // string\ntype T21 = Bar<{ a: (x: string) => void; b: (x: number) => void }>; // string & number`, `39531247391261810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Bar<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> <span class="token function-variable function">a</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> infer <span class="token constant">U</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token function-variable function">b</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> infer <span class="token constant">U</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">}</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> <span class="token constant">T20</span> <span class="token operator">=</span> Bar<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token function-variable function">a</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token function-variable function">b</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string</span>\n<span class="token keyword">type</span> <span class="token constant">T21</span> <span class="token operator">=</span> Bar<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token function-variable function">a</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span> <span class="token function-variable function">b</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string &amp; number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>因此，综合以上几点，我们可以得到在 stackoverflow 上的一个答案：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62534114960867980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type UnionToIntersection<U> = (U extends any ? (k: U) => void : never) extends ((k: infer I) => void) ? I : never;\n\ntype Result = UnionToIntersection<string | number>; // string & number`, `62534114960867980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> UnionToIntersection<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">any</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">:</span> <span class="token constant">U</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">:</span> infer <span class="token constant">I</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token constant">I</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Result <span class="token operator">=</span> UnionToIntersection<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string &amp; number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当传入 <code class="language-text">string | number</code> 时：</p>\n<ul>\n<li>\n<p>第一步：<code class="language-text">(U extends any ? (k: U) =&gt; void : never)</code> 会把 union 拆分成 <code class="language-text">(string extends any ? (k: string) =&gt; void : never) | (number extends any ? (k: number)=&gt; void : never)</code>，即是得到 <code class="language-text">(k: string) =&gt; void | (k: number) =&gt; void</code>；</p>\n</li>\n<li>\n<p>第二步：<code class="language-text">(k: string) =&gt; void | (k: number) =&gt; void extends ((k: infer I) =&gt; void) ? I : never</code>，根据上文可以推断出 I 为 string &#x26; number。</p>\n</li>\n</ul>\n<h3 id="leetcode-的一道-typescript-面试题"><a href="#leetcode-%E7%9A%84%E4%B8%80%E9%81%93-typescript-%E9%9D%A2%E8%AF%95%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>LeetCode 的一道 TypeScript 面试题</h3>\n<p>前段时间在 GitHub 上发现一道来自 LeetCode TypeScript 的面试题，比较有意思，题目的大致意思是：</p>\n<p>假设有一个这样的类型（原题中给出的是类，这里简化为 interface）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55259077763197340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Module {\n   count: number;\n   message: string;\n   asyncMethod<T, U>(input: Promise<T>): Promise<Action<U>>;\n   syncMethod<T, U>(action: Action<T>): Action<U>;\n}`, `55259077763197340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>\n   count<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   message<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   asyncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">>></span><span class="token punctuation">;</span>\n   syncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> Action<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在经过 Connect 函数之后，返回值类型为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35223203408794145000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Result {\n  asyncMethod<T, U>(input: T): Action<U>;\n  syncMethod<T, U>(action: T): Action<U>;\n}`, `35223203408794145000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Result <span class="token punctuation">{</span>\n  asyncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span>\n  syncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 <code class="language-text">Action&lt;T&gt;</code> 的定义为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16226069448486680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Action<T> {\n   payload?: T;\n   type: string;\n}`, `16226069448486680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Action</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   payload<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里主要考察两点</p>\n<ul>\n<li>挑选出函数</li>\n<li>条件类型 + 此篇文章所提及的 infer</li>\n</ul>\n<p>接下来就比较简单了，主要是利用条件类型 + infer，如果函数可以赋值给 <code class="language-text">asyncMethod&lt;T, U&gt;(input: Promise&lt;T&gt;): Promise&lt;Action&lt;U&gt;&gt;</code>，则取值为 <code class="language-text">asyncMethod&lt;T, U&gt;(input: T): Action&lt;U&gt;</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5685153580386082000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Action<T> {\n   payload?: T;\n   type: string;\n}\n\ninterface Module {\n   count: number;\n   message: string;\n   asyncMethod<T, U>(input: Promise<T>): Promise<Action<U>>;\n   syncMethod<T, U>(action: Action<T>): Action<U>;\n}\n\ntype asyncMethod<T, U> = (input: Promise<T>) => Promise<Action<U>>; // 转换前\ntype asyncMethodConnect<T, U> = (input: T) => Action<U>; // 转换后\ntype syncMethod<T, U> = (action: Action<T>) => Action<U>; // 转换前\ntype syncMethodConnect<T, U> = (action: T) => Action<U>; // 转换后\n\ntype methodsPick<T> = {\n   [P in keyof T]: T[P] extends Function ? P : never;\n}[keyof T];\n\ntype ModuleMethodsConnect<T> = T extends asyncMethod<infer U, infer V>\n   ? asyncMethodConnect<U, V>\n   : T extends syncMethod<infer U, infer V>\n   ? syncMethodConnect<U, V>\n   : never;\n\ntype ModuleMethods = methodsPick<Module>;\n\ntype Connect = (\n   module: Module\n) => {\n   [T in ModuleMethods]: ModuleMethodsConnect<Module[T]>;\n};`, `5685153580386082000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Action</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   payload<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">Module</span> <span class="token punctuation">{</span>\n   count<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   message<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   asyncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">(</span>input<span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">>></span><span class="token punctuation">;</span>\n   syncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> Action<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> asyncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">>></span><span class="token punctuation">;</span> <span class="token comment">// 转换前</span>\n<span class="token keyword">type</span> asyncMethodConnect<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 转换后</span>\n<span class="token keyword">type</span> syncMethod<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">:</span> Action<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 转换前</span>\n<span class="token keyword">type</span> syncMethodConnect<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> Action<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// 转换后</span>\n\n<span class="token keyword">type</span> methodsPick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ModuleMethodsConnect<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">asyncMethod</span><span class="token operator">&lt;</span>infer <span class="token constant">U</span><span class="token punctuation">,</span> infer <span class="token constant">V</span><span class="token operator">></span>\n   <span class="token operator">?</span> asyncMethodConnect<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">V</span><span class="token operator">></span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">syncMethod</span><span class="token operator">&lt;</span>infer <span class="token constant">U</span><span class="token punctuation">,</span> infer <span class="token constant">V</span><span class="token operator">></span>\n   <span class="token operator">?</span> syncMethodConnect<span class="token operator">&lt;</span><span class="token constant">U</span><span class="token punctuation">,</span> <span class="token constant">V</span><span class="token operator">></span>\n   <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ModuleMethods <span class="token operator">=</span> methodsPick<span class="token operator">&lt;</span>Module<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> <span class="token function-variable function">Connect</span> <span class="token operator">=</span> <span class="token punctuation">(</span>\n   <span class="token parameter"><span class="token keyword">module</span><span class="token punctuation">:</span> Module</span>\n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">T</span> <span class="token keyword">in</span> ModuleMethods<span class="token punctuation">]</span><span class="token punctuation">:</span> ModuleMethodsConnect<span class="token operator">&lt;</span>Module<span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="类型编程"><a href="#%E7%B1%BB%E5%9E%8B%E7%BC%96%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类型编程</h1>\n<h2 id="泛型"><a href="#%E6%B3%9B%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>泛型</h2>\n<h3 id="写法"><a href="#%E5%86%99%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>写法</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57817524356287530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function foo<T>(arg: T): T {\n   return arg;\n}\n\n// 箭头函数下的书写\nconst foo = <T>(arg: T) => arg;\n\n// tsx 文件下的书写\nconst foo = <T extends {}>(arg: T) => arg;\n\nclass Foo<T, U> {\n   constructor(public arg1: T, public arg2: U) {}\n\n   public method(): T {\n      return this.arg1;\n   }\n}`, `57817524356287530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> foo<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> arg<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 箭头函数下的书写</span>\n<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> arg<span class="token punctuation">;</span>\n\n<span class="token comment">// tsx 文件下的书写</span>\n<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> arg<span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">></span> <span class="token punctuation">{</span>\n   <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> arg1<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token keyword">public</span> arg2<span class="token punctuation">:</span> <span class="token constant">U</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n   <span class="token keyword">public</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>arg1<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="函数泛型取对象的值"><a href="#%E5%87%BD%E6%95%B0%E6%B3%9B%E5%9E%8B%E5%8F%96%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>函数泛型取对象的值</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22250751161220570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 函数泛型取对象的值，第一种形式\nfunction pickSingleValue<T>(obj: T, key: keyof T): T[keyof T] {\n   return obj[key];\n}\n\n// 针对第一种形式的缺点：keyof 出现了两次，泛型 T 应该被限制为对象类型\nfunction pickSingleValue<T extends object, U extends keyof T>(obj: T, key: U): T[U] {\n   return obj[key];\n}\n\n// 换一个功能：取出一系列值\nfunction pick<T extends object, U extends keyof T>(obj: T, keys: U[]): T[U][] {\n   return keys.map((key) => obj[key]);\n}\n\n// const fooObj = { a: 1, b: &quot;1&quot; };\n// pick(fooObj, [\'a\', \'b\']) // (string | number)[]`, `22250751161220570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 函数泛型取对象的值，第一种形式</span>\n<span class="token keyword">function</span> pickSingleValue<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 针对第一种形式的缺点：keyof 出现了两次，泛型 T 应该被限制为对象类型</span>\n<span class="token keyword">function</span> pickSingleValue<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token punctuation">,</span> <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">U</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 换一个功能：取出一系列值</span>\n<span class="token keyword">function</span> pick<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token punctuation">,</span> <span class="token constant">U</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> keys<span class="token punctuation">:</span> <span class="token constant">U</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">U</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=></span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// const fooObj = { a: 1, b: "1" };</span>\n<span class="token comment">// pick(fooObj, [\'a\', \'b\']) // (string | number)[]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="索引类型"><a href="#%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>索引类型</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40555295482477310000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface Foo {\n   [keys: string]: string;\n}\n\n// 由于 JS 可以同时通过数字与字符串访问对象属性，因此 keyof Foo 的结果会是 string | number\nconst o: Foo = {\n   1: \'芜湖！\'\n};\n\no[1] === o[\'1\'];`, `40555295482477310000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span>keys<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 由于 JS 可以同时通过数字与字符串访问对象属性，因此 keyof Foo 的结果会是 string | number</span>\n<span class="token keyword">const</span> o<span class="token punctuation">:</span> Foo <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">\'芜湖！\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\no<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> o<span class="token punctuation">[</span><span class="token string">\'1\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="映射类型-1"><a href="#%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>映射类型</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89994209281578240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface A {\n   a: boolean;\n   b: string;\n   c: number;\n   d: () => void;\n}\n\ntype StringifyA<T> = {\n   [K in keyof T]: string;\n};\n\ntype Clone<T> = {\n   [K in keyof T]: T[K];\n};`, `89994209281578240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>\n   a<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   b<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   c<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   <span class="token function-variable function">d</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> StringifyA<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Clone<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="条件类型"><a href="#%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>条件类型</h2>\n<h3 id="写法-1"><a href="#%E5%86%99%E6%B3%95-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>写法</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49534440199949840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 在这种情况下，条件类型的推导就会被延迟\ndeclare function strOrnum<T extends boolean>(x: T): T extends true ? string : number;\n\ntype TypeName<T> = T extends string\n   ? \'string\'\n   : T extends number\n   ? \'number\'\n   : T extends boolean\n   ? \'boolean\'\n   : T extends undefined\n   ? \'undefined\'\n   : T extends Function\n   ? \'function\'\n   : \'object\';`, `49534440199949840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 在这种情况下，条件类型的推导就会被延迟</span>\n<span class="token keyword">declare</span> <span class="token keyword">function</span> strOrnum<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">boolean</span><span class="token operator">></span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">true</span> <span class="token operator">?</span> <span class="token builtin">string</span> <span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> TypeName<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span>\n   <span class="token operator">?</span> <span class="token string">\'string\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">number</span>\n   <span class="token operator">?</span> <span class="token string">\'number\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">boolean</span>\n   <span class="token operator">?</span> <span class="token string">\'boolean\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">undefined</span>\n   <span class="token operator">?</span> <span class="token string">\'undefined\'</span>\n   <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span>\n   <span class="token operator">?</span> <span class="token string">\'function\'</span>\n   <span class="token punctuation">:</span> <span class="token string">\'object\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="分布式条件类型"><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分布式条件类型</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6723791172345561000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 对于属于裸类型参数的检查类型，条件类型会在实例化时自动分发到联合类型上\n// 使用上面的TypeName类型别名\ntype T1 = TypeName<string | (() => void)>; // &quot;string&quot; | &quot;function&quot;\n\ntype T2 = TypeName<string | string[]>; // &quot;string&quot; | &quot;object&quot;\n\ntype T3 = TypeName<string[] | number[]>; // &quot;object&quot;\n\ntype Naked<T> = T extends boolean ? \'Y\' : \'N\';\ntype Wrapped<T> = [T] extends [boolean] ? \'Y\' : \'N\';\n\n/*\n * 先分发到 Naked<number> | Naked<boolean>\n * 然后到 &quot;N&quot; | &quot;Y&quot;\n */\ntype Distributed = Naked<number | boolean>;\n\n/*\n * 不会分发，因为这里不是裸类型参数，直接是 [number | boolean] extends [boolean]\n * 然后是 &quot;N&quot;\n */\ntype NotDistributed = Wrapped<number | boolean>;`, `6723791172345561000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 对于属于裸类型参数的检查类型，条件类型会在实例化时自动分发到联合类型上</span>\n<span class="token comment">// 使用上面的TypeName类型别名</span>\n<span class="token keyword">type</span> <span class="token constant">T1</span> <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "string" | "function"</span>\n\n<span class="token keyword">type</span> <span class="token constant">T2</span> <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "string" | "object"</span>\n\n<span class="token keyword">type</span> <span class="token constant">T3</span> <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "object"</span>\n\n<span class="token keyword">type</span> Naked<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">boolean</span> <span class="token operator">?</span> <span class="token string">\'Y\'</span> <span class="token punctuation">:</span> <span class="token string">\'N\'</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> Wrapped<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token punctuation">[</span><span class="token builtin">boolean</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token string">\'Y\'</span> <span class="token punctuation">:</span> <span class="token string">\'N\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">/*\n * 先分发到 Naked&lt;number> | Naked&lt;boolean>\n * 然后到 "N" | "Y"\n */</span>\n<span class="token keyword">type</span> Distributed <span class="token operator">=</span> Naked<span class="token operator">&lt;</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">boolean</span><span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">/*\n * 不会分发，因为这里不是裸类型参数，直接是 [number | boolean] extends [boolean]\n * 然后是 "N"\n */</span>\n<span class="token keyword">type</span> NotDistributed <span class="token operator">=</span> Wrapped<span class="token operator">&lt;</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">boolean</span><span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>没有被额外包装的联合类型参数，在条件类型进行判定时会将联合类型分发，分别进行判断。</p>\n<h2 id="infer-1"><a href="#infer-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>infer</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22018365698888507000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const foo = (): string => {\n   return \'linbudu\';\n};\n\n// string\ntype FooReturnType = ReturnType<typeof foo>;\n\ntype ReturnType<T extends (...args: any) => any> = T extends (...args: any) => infer R ? R : any;\n\ntype Parameters<T extends (...args: any) => any> = T extends (...args: infer P) => any ? P : never;`, `22018365698888507000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">string</span></span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token string">\'linbudu\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// string</span>\n<span class="token keyword">type</span> FooReturnType <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> foo<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> infer <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Parameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token punctuation">:</span> infer <span class="token constant">P</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>类型系统在获得足够的信息后，就能将 infer 后跟随的类型参数推导出来</p>\n<h2 id="类型守卫"><a href="#%E7%B1%BB%E5%9E%8B%E5%AE%88%E5%8D%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类型守卫</h2>\n<h3 id="写法-2"><a href="#%E5%86%99%E6%B3%95-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>写法</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36798159419956120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// numOrStrProp: number | string;\nexport const isString = (arg: unknown): boolean => typeof arg === \'string\';\n\nfunction useIt(numOrStr: number | string) {\n   if (isString(numOrStr)) {\n      console.log(numOrStr.length); // 这里类型推断依然为 number | string，并没有起到缩小类型范围的作用\n   }\n}\n\n// 改进，使用 is 关键字，起作用了\nexport const isString = (arg: unknown): arg is string => typeof arg === \'string\';\n\n// 例子\nexport type Falsy = false | \'\' | 0 | null | undefined;\n\nexport const isFalsy = (val: unknown): val is Falsy => !val;`, `36798159419956120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// numOrStrProp: number | string;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> isString <span class="token operator">=</span> <span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token parameter"><span class="token builtin">boolean</span></span> <span class="token operator">=></span> <span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">\'string\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">useIt</span><span class="token punctuation">(</span><span class="token parameter">numOrStr<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isString</span><span class="token punctuation">(</span>numOrStr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>numOrStr<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里类型推断依然为 number | string，并没有起到缩小类型范围的作用</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 改进，使用 is 关键字，起作用了</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> isString <span class="token operator">=</span> <span class="token punctuation">(</span>arg<span class="token punctuation">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token punctuation">:</span> arg <span class="token keyword">is</span> <span class="token parameter"><span class="token builtin">string</span></span> <span class="token operator">=></span> <span class="token keyword">typeof</span> arg <span class="token operator">===</span> <span class="token string">\'string\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 例子</span>\n<span class="token keyword">export</span> <span class="token keyword">type</span> Falsy <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token operator">|</span> <span class="token string">\'\'</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token operator">|</span> undefined<span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> isFalsy <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token punctuation">:</span> val <span class="token keyword">is</span> <span class="token parameter">Falsy</span> <span class="token operator">=></span> <span class="token operator">!</span>val<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="如何将-a--b-联合类型缩小到-a"><a href="#%E5%A6%82%E4%BD%95%E5%B0%86-a--b-%E8%81%94%E5%90%88%E7%B1%BB%E5%9E%8B%E7%BC%A9%E5%B0%8F%E5%88%B0-a" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何将 A | B 联合类型缩小到 A</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41461225908866030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class A {\n   public a() {}\n\n   public useA() {\n      return \'A\';\n   }\n}\n\nclass B {\n   public b() {}\n\n   public useB() {\n      return \'B\';\n   }\n}\n\nfunction useIt(arg: A | B): void {\n   if (\'a\' in arg) {\n      arg.useA();\n   } else {\n      arg.useB();\n   }\n}`, `41461225908866030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>\n   <span class="token keyword">public</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n   <span class="token keyword">public</span> <span class="token function">useA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token string">\'A\'</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>\n   <span class="token keyword">public</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n   <span class="token keyword">public</span> <span class="token function">useB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token string">\'B\'</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">useIt</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">:</span> <span class="token constant">A</span> <span class="token operator">|</span> <span class="token constant">B</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">\'a\'</span> <span class="token keyword">in</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      arg<span class="token punctuation">.</span><span class="token function">useA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      arg<span class="token punctuation">.</span><span class="token function">useB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="字面量类型作为类型守卫"><a href="#%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E4%BD%9C%E4%B8%BA%E7%B1%BB%E5%9E%8B%E5%AE%88%E5%8D%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>字面量类型作为类型守卫</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51059109268718770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`interface IBoy {\n   name: \'mike\';\n   gf: string;\n}\n\ninterface IGirl {\n   name: \'sofia\';\n   bf: string;\n}\n\nfunction getLover(child: IBoy | IGirl): string {\n   if (child.name === \'mike\') {\n      return child.gf;\n   } else {\n      return child.bf;\n   }\n}\n\n// 不同状态下的接口，这里不好判断\ninterface IUserProps {\n   isLogin: boolean;\n   name: string; // 用户名称仅在登录时有\n   from: string; // 用户来源（一般用于埋点），仅在未登录时有\n}\n\n// 分割接口\ninterface IUnLogin {\n   isLogin: false;\n   from: string; // 用户来源（一般用于埋点），仅在未登录时有\n}\n\ninterface ILogined {\n   isLogin: true;\n   name: string; // 用户名称仅在登录时有\n}\n\nfunction getUserInfo(user: IUnLogin | ILogined): string {\n   return user.isLogin === true ? user.name : user.from;\n}`, `51059109268718770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">interface</span> <span class="token class-name">IBoy</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'mike\'</span><span class="token punctuation">;</span>\n   gf<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">IGirl</span> <span class="token punctuation">{</span>\n   name<span class="token punctuation">:</span> <span class="token string">\'sofia\'</span><span class="token punctuation">;</span>\n   bf<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">getLover</span><span class="token punctuation">(</span><span class="token parameter">child<span class="token punctuation">:</span> IBoy <span class="token operator">|</span> IGirl</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'mike\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> child<span class="token punctuation">.</span>gf<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> child<span class="token punctuation">.</span>bf<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 不同状态下的接口，这里不好判断</span>\n<span class="token keyword">interface</span> <span class="token class-name">IUserProps</span> <span class="token punctuation">{</span>\n   isLogin<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 用户名称仅在登录时有</span>\n   <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 用户来源（一般用于埋点），仅在未登录时有</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 分割接口</span>\n<span class="token keyword">interface</span> <span class="token class-name">IUnLogin</span> <span class="token punctuation">{</span>\n   isLogin<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n   <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 用户来源（一般用于埋点），仅在未登录时有</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">ILogined</span> <span class="token punctuation">{</span>\n   isLogin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n   name<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// 用户名称仅在登录时有</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">:</span> IUnLogin <span class="token operator">|</span> ILogined</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> user<span class="token punctuation">.</span>isLogin <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> user<span class="token punctuation">.</span>name <span class="token punctuation">:</span> user<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="工具类型"><a href="#%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>工具类型</h2>\n<p>以上重复的工具类型不再说明，以下只说明自定义的工具类型，大部分工具类型都来自于 <a href="https://github.com/piotrwitek/utility-types" target="_blank" rel="nofollow noreferrer noopener">utility-types</a> 三方库</p>\n<h3 id="提取-promise-的类型"><a href="#%E6%8F%90%E5%8F%96-promise-%E7%9A%84%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>提取 Promise 的类型</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31165492191517143000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const foo = (): Promise<string> => {\n   return new Promise((resolve, reject) => {\n      resolve(\'linbudu\');\n   });\n};\n\ntype FooReturnType = ReturnType<typeof foo>; // Promise<string>\n\n// 使用 infer R 来等待类型系统推导出 R 的具体类型。\ntype PromiseType<T extends Promise<any>> = T extends Promise<infer R> ? R : never;\n\ntype NakedFooReturnType = PromiseType<FooReturnType>; // string`, `31165492191517143000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'linbudu\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> FooReturnType <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> foo<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// Promise&lt;string></span>\n\n<span class="token comment">// 使用 infer R 来等待类型系统推导出 R 的具体类型。</span>\n<span class="token keyword">type</span> PromiseType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">>></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Promise</span><span class="token operator">&lt;</span>infer <span class="token constant">R</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> NakedFooReturnType <span class="token operator">=</span> PromiseType<span class="token operator">&lt;</span>FooReturnType<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// string</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="递归的工具类型"><a href="#%E9%80%92%E5%BD%92%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>递归的工具类型</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71983697503653100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type DeepPartial<T> = {\n   [P in keyof T]?: T[P] extends object ? DeepPartial<T[P]> : T[P];\n};`, `71983697503653100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> DeepPartial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">object</span> <span class="token operator">?</span> DeepPartial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="返回键名的工具类型"><a href="#%E8%BF%94%E5%9B%9E%E9%94%AE%E5%90%8D%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>返回键名的工具类型</h3>\n<p>利用 <code class="language-text">{ [K in keyof T]: ... }[keyof T]</code> 形式返回键名</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65857079702176915000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type FunctTypeKeys<T extends object> = {\n   [K in keyof T]-?: T[K] extends Function ? K : never;\n}[keyof T];\n\ninterface IWithFuncKeys {\n   a: string;\n   b: number;\n   c: boolean;\n   d: () => void;\n}\n\ntype WTFIsThis<T extends object> = {\n   [K in keyof T]-?: T[K] extends Function ? K : never;\n};\n\ntype FunctTypeKeys<T extends object> = {\n   [K in keyof T]-?: T[K] extends Function ? K : never;\n}[keyof T];\n\ntype UseIt1 = WTFIsThis<IWithFuncKeys>;\n// {\n//     a: never;\n//     b: never;\n//     c: never;\n//     d: &quot;d&quot;;\n// }\n\ntype UseIt2 = FunctTypeKeys<IWithFuncKeys>; // d`, `65857079702176915000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> FunctTypeKeys<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">IWithFuncKeys</span> <span class="token punctuation">{</span>\n   a<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   b<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   c<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>\n   <span class="token function-variable function">d</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> WTFIsThis<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> FunctTypeKeys<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> UseIt1 <span class="token operator">=</span> WTFIsThis<span class="token operator">&lt;</span>IWithFuncKeys<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token comment">// {</span>\n<span class="token comment">//     a: never;</span>\n<span class="token comment">//     b: never;</span>\n<span class="token comment">//     c: never;</span>\n<span class="token comment">//     d: "d";</span>\n<span class="token comment">// }</span>\n\n<span class="token keyword">type</span> UseIt2 <span class="token operator">=</span> FunctTypeKeys<span class="token operator">&lt;</span>IWithFuncKeys<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// d</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="可选字段"><a href="#%E5%8F%AF%E9%80%89%E5%AD%97%E6%AE%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可选字段</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63958842294832595000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type WTFAMI1 = {} extends { prop: number } ? \'Y\' : \'N\';\ntype WTFAMI2 = {} extends { prop?: number } ? \'Y\' : \'N\';`, `63958842294832595000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> <span class="token constant">WTFAMI1</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> prop<span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span> <span class="token operator">?</span> <span class="token string">\'Y\'</span> <span class="token punctuation">:</span> <span class="token string">\'N\'</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> <span class="token constant">WTFAMI2</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> prop<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span> <span class="token operator">?</span> <span class="token string">\'Y\'</span> <span class="token punctuation">:</span> <span class="token string">\'N\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这里的 <code class="language-text">{} extends K</code>，只有 K 是可选的情况下才成立，使用如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16260473466215619000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export type RequiredKeys<T> = {\n   [K in keyof T]-?: {} extends Pick<T, K> ? never : K;\n}[keyof T];\n\nexport type OptionalKeys<T> = {\n   [K in keyof T]-?: {} extends Pick<T, K> ? K : never;\n}[keyof T];`, `16260473466215619000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">type</span> RequiredKeys<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">extends</span> <span class="token class-name">Pick</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token punctuation">:</span> <span class="token constant">K</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> OptionalKeys<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">extends</span> <span class="token class-name">Pick</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="可变、不可变"><a href="#%E5%8F%AF%E5%8F%98%E3%80%81%E4%B8%8D%E5%8F%AF%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>可变、不可变</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21879002278708450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * @desc 一个辅助类型，判断 X 和 Y 是否类型相同，\n * @returns 是则返回 A，否则返回 B\n */\ntype Equal<X, Y, A = X, B = never> = (<T>() => T extends X ? 1 : 2) extends <T>() => T extends Y ? 1 : 2 ? A : B;\n\nexport type MutableKeys<T extends object> = {\n   [P in keyof T]-?: Equal<{ [Q in P]: T[P] }, { -readonly [Q in P]: T[P] }, P, never>;\n}[keyof T];\n\nexport type IMmutableKeys<T extends object> = {\n   [P in keyof T]-?: Equals<{ [Q in P]: T[P] }, { -readonly [Q in P]: T[P] }, never, P>;\n}[keyof T];\n\ninterface IWithFuncKeys {\n   a: string;\n   b?: number;\n   readonly c: boolean[];\n   d?: () => void;\n}\n\ntype b = MutableKeys<IWithFuncKeys>; // &quot;a&quot; | &quot;b&quot; | &quot;d&quot;\ntype a = IMmutableKeys<IWithFuncKeys>; // &quot;c&quot;`, `21879002278708450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">/**\n * @desc 一个辅助类型，判断 X 和 Y 是否类型相同，\n * @returns 是则返回 A，否则返回 B\n */</span>\n<span class="token keyword">type</span> Equal<span class="token operator">&lt;</span><span class="token constant">X</span><span class="token punctuation">,</span> <span class="token constant">Y</span><span class="token punctuation">,</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token constant">X</span><span class="token punctuation">,</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token builtin">never</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">X</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">extends</span> <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Y</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> MutableKeys<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> Equal<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">Q</span> <span class="token keyword">in</span> <span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">Q</span> <span class="token keyword">in</span> <span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token constant">P</span><span class="token punctuation">,</span> <span class="token builtin">never</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> IMmutableKeys<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> Equals<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">Q</span> <span class="token keyword">in</span> <span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">Q</span> <span class="token keyword">in</span> <span class="token constant">P</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token builtin">never</span><span class="token punctuation">,</span> <span class="token constant">P</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token keyword">interface</span> <span class="token class-name">IWithFuncKeys</span> <span class="token punctuation">{</span>\n   a<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n   b<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   <span class="token keyword">readonly</span> c<span class="token punctuation">:</span> <span class="token builtin">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   d<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">type</span> b <span class="token operator">=</span> MutableKeys<span class="token operator">&lt;</span>IWithFuncKeys<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "a" | "b" | "d"</span>\n<span class="token keyword">type</span> a <span class="token operator">=</span> IMmutableKeys<span class="token operator">&lt;</span>IWithFuncKeys<span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "c"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="基于值类型的-pick-与-omit"><a href="#%E5%9F%BA%E4%BA%8E%E5%80%BC%E7%B1%BB%E5%9E%8B%E7%9A%84-pick-%E4%B8%8E-omit" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基于值类型的 Pick 与 Omit</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25894668501996420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export type PickByValueType<T, ValueType> = Pick<\n   T,\n   { [Key in keyof T]-?: T[Key] extends ValueType ? Key : never }[keyof T]\n>;\n\nexport type OmitByValueType<T, ValueType> = Pick<\n   T,\n   { [Key in keyof T]-?: T[Key] extends ValueType ? never : Key }[keyof T]\n>;`, `25894668501996420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">type</span> PickByValueType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> ValueType<span class="token operator">></span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span>\n   <span class="token constant">T</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span> <span class="token punctuation">[</span>Key <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">ValueType</span> <span class="token operator">?</span> Key <span class="token punctuation">:</span> <span class="token builtin">never</span> <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span>\n<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">type</span> OmitByValueType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> ValueType<span class="token operator">></span> <span class="token operator">=</span> Pick<span class="token operator">&lt;</span>\n   <span class="token constant">T</span><span class="token punctuation">,</span>\n   <span class="token punctuation">{</span> <span class="token punctuation">[</span>Key <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">ValueType</span> <span class="token operator">?</span> <span class="token builtin">never</span> <span class="token punctuation">:</span> Key <span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span>\n<span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="实战"><a href="#%E5%AE%9E%E6%88%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实战</h1>\n<h2 id="参数简化"><a href="#%E5%8F%82%E6%95%B0%E7%AE%80%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参数简化</h2>\n<p>通过一个简单的功能把</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96985363043931050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`distribute({\n   type: \'LOGIN\',\n   email: string\n});`, `96985363043931050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token function">distribute</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOGIN\'</span><span class="token punctuation">,</span>\n   email<span class="token punctuation">:</span> <span class="token builtin">string</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样的函数调用方式给简化为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10609120515382452000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`distribute(\'LOGIN\', {\n   email: string\n});`, `10609120515382452000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token function">distribute</span><span class="token punctuation">(</span><span class="token string">\'LOGIN\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n   email<span class="token punctuation">:</span> <span class="token builtin">string</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="分布条件类型的真实用例"><a href="#%E5%88%86%E5%B8%83%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%9C%9F%E5%AE%9E%E7%94%A8%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分布条件类型的真实用例</h3>\n<p>举一个类似 redux 中的 dispatch 的例子。</p>\n<p>首先，我们有一个联合类型 Action，用来表示所有可以被 dispatch 接受的参数类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7590828029620189000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Action =\n   | {\n        type: \'INIT\';\n     }\n   | {\n        type: \'SYNC\';\n     }\n   | {\n        type: \'LOG_IN\';\n        emailAddress: string;\n     }\n   | {\n        type: \'LOG_IN_SUCCESS\';\n        accessToken: string;\n     };`, `7590828029620189000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Action <span class="token operator">=</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'INIT\'</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'SYNC\'</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN\'</span><span class="token punctuation">;</span>\n        emailAddress<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN_SUCCESS\'</span><span class="token punctuation">;</span>\n        accessToken<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后我们定义这个 dispatch 方法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78475321047166140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare function dispatch(action: Action): void;\n\n// ok\ndispatch({\n   type: \'INIT\'\n});\n\n// ok\ndispatch({\n   type: \'LOG_IN\',\n   emailAddress: \'david.sheldrick@artsy.net\'\n});\n\n// ok\ndispatch({\n   type: \'LOG_IN_SUCCESS\',\n   accessToken: \'038fh239h923908h\'\n});`, `78475321047166140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">:</span> Action</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ok</span>\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'INIT\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ok</span>\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN\'</span><span class="token punctuation">,</span>\n   emailAddress<span class="token punctuation">:</span> <span class="token string">\'david.sheldrick@artsy.net\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ok</span>\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN_SUCCESS\'</span><span class="token punctuation">,</span>\n   accessToken<span class="token punctuation">:</span> <span class="token string">\'038fh239h923908h\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个 API 是类型安全的，当 TS 识别到 type 为 LOG_IN 的时候，它会要求你在参数中传入 emailAddress 这个参数，这样才能完全满足联合类型中的其中一项。</p>\n<p>等等，我们好像可以让这个 api 变得更简单一点：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35431727956653502000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dispatch(\'LOG_IN_SUCCESS\', {\n   accessToken: \'038fh239h923908h\'\n});`, `35431727956653502000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">\'LOG_IN_SUCCESS\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n   accessToken<span class="token punctuation">:</span> <span class="token string">\'038fh239h923908h\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="参数简化实现"><a href="#%E5%8F%82%E6%95%B0%E7%AE%80%E5%8C%96%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>参数简化实现</h3>\n<p>首先，利用方括号选择出 Action 中的所有 type，这个技巧很有用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48110286574876900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ActionType = Action[\'type\'];\n// => &quot;INIT&quot; | &quot;SYNC&quot; | &quot;LOG_IN&quot; | &quot;LOG_IN_SUCCESS&quot;`, `48110286574876900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ActionType <span class="token operator">=</span> Action<span class="token punctuation">[</span><span class="token string">\'type\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token comment">// => "INIT" | "SYNC" | "LOG_IN" | "LOG_IN_SUCCESS"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是第二个参数的类型取决于第一个参数，我们可以使用类型变量来对该依赖关系建模。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42290993831969040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare function dispatch<T extends ActionType>(type: T, args: ExtractActionParameters<Action, T>): void;`, `42290993831969040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">ActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> ExtractActionParameters<span class="token operator">&lt;</span>Action<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>注意，这里就用到了 extends 语法，规定了我们的入参 type 必须是 ActionType 中一部分。</p>\n<p>注意这里的第二个参数 args 用 <code class="language-text">ExtractActionParameters&lt;Action, T&gt;</code> 这个类型来把 type 和 args 做了关联</p>\n<p>来看看 ExtractActionParameters 是如何实现的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62359016256828735000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ExtractActionParameters<A, T> = A extends { type: T } ? A : never;`, `62359016256828735000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ExtractActionParameters<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在这次实战中，我们第一次运用到了条件类型，<code class="language-text">ExtractActionParameters&lt;Action, T&gt;</code> 会按照我们上文提到的分布条件类型，把 Action 中的 4 项依次去和 <code class="language-text">{ type: T }</code> 进行比对，找出符合的那一项。</p>\n<p>来看看如何使用它：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56699804800962970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Test = ExtractActionParameters<Action, \'LOG_IN\'>;\n// => { type: &quot;LOG_IN&quot;, emailAddress: string }`, `56699804800962970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Test <span class="token operator">=</span> ExtractActionParameters<span class="token operator">&lt;</span>Action<span class="token punctuation">,</span> <span class="token string">\'LOG_IN\'</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token comment">// => { type: "LOG_IN", emailAddress: string }</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这样就筛选出了 type 匹配的一项。</p>\n<p>接下来我们要把 type 去掉，第一个参数已经是 type 了，因此我们不想再额外声明 type 了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17632064295159933000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 把类型中key为&quot;type&quot;去掉\ntype ExcludeTypeField<A> = { [K in Exclude<keyof A, \'type\'>]: A[K] };`, `17632064295159933000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 把类型中key为"type"去掉</span>\n<span class="token keyword">type</span> ExcludeTypeField<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> Exclude<span class="token operator">&lt;</span><span class="token keyword">keyof</span> <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token string">\'type\'</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这里利用了 keyof 语法，并且利用内置类型 Exclude 把 type 这个 key 去掉，因此只会留下额外的参数。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19490844413942776000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Test = ExcludeTypeField<{ type: \'LOG_IN\'; emailAddress: string }>;\n// { emailAddress: string }`, `19490844413942776000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Test <span class="token operator">=</span> ExcludeTypeField<span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN\'</span><span class="token punctuation">;</span> emailAddress<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token comment">// { emailAddress: string }</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后用它来剔除参数中的 type</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6735921596105898000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 把参数对象中的type去掉\ntype ExtractActionParametersWithoutType<A, T> = ExcludeTypeField<ExtractActionParameters<A, T>>;`, `6735921596105898000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 把参数对象中的type去掉</span>\n<span class="token keyword">type</span> ExtractActionParametersWithoutType<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> ExcludeTypeField<span class="token operator">&lt;</span>ExtractActionParameters<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36369031575334797000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`declare function dispatch<T extends ActionType>(type: T, args: ExtractActionParametersWithoutType<Action, T>): void;`, `36369031575334797000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">ActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> ExtractActionParametersWithoutType<span class="token operator">&lt;</span>Action<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>到此为止，我们就可以实现上文中提到的参数简化功能：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30953716672852804000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ok\ndispatch({\n   type: \'LOG_IN\',\n   emailAddress: \'david.sheldrick@artsy.net\'\n});`, `30953716672852804000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// ok</span>\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN\'</span><span class="token punctuation">,</span>\n   emailAddress<span class="token punctuation">:</span> <span class="token string">\'david.sheldrick@artsy.net\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="利用重载进一步优化"><a href="#%E5%88%A9%E7%94%A8%E9%87%8D%E8%BD%BD%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>利用重载进一步优化</h3>\n<p>到了这一步为止，虽然带参数的 Action 可以完美支持了，但是对于 “INIT” 这种不需要传参的 Action，我们依然要写下面这样代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81034062700418800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`dispatch(\'INIT\', {});`, `81034062700418800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">\'INIT\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这肯定是不能接受的！所以我们要利用 TypeScript 的函数重载功能。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20343270087490617000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 简单参数类型\nfunction dispatch<T extends SimpleActionType>(type: T): void;\n\n// 复杂参数类型\nfunction dispatch<T extends ComplexActionType>(type: T, args: ExtractActionParametersWithoutType<Action, T>): void;\n\n// 实现\nfunction dispatch(arg: any, payload?: any) {}`, `20343270087490617000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 简单参数类型</span>\n<span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 复杂参数类型</span>\n<span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">ComplexActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> ExtractActionParametersWithoutType<span class="token operator">&lt;</span>Action<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 实现</span>\n<span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> payload<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么关键点就在于 SimpleActionType 和 ComplexActionType 要如何实现了</p>\n<p>SimpleActionType 顾名思义就是除了 type 以外不需要额外参数的 Action 类型</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53402988138223080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type SimpleAction = ExtractSimpleAction<Action>;`, `53402988138223080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> SimpleAction <span class="token operator">=</span> ExtractSimpleAction<span class="token operator">&lt;</span>Action<span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们如何定义这个 ExtractSimpleAction 条件类型？如果我们从这个 Action 中删除 type 字段，并且结果是一个空的接口，那么这就是一个 SimpleAction，所以我们可能会凭直觉写出这样的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42044506467621990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ExtractSimpleAction<A> = ExcludeTypeField<A> extends {} ? A : never;`, `42044506467621990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ExtractSimpleAction<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">=</span> ExcludeTypeField<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但这样是行不通的，几乎所有的类型都可以 <code class="language-text">extends {}</code>，因为 <code class="language-text">{}</code> 太宽泛了。</p>\n<p>我们应该反过来写：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31196413578351833000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ExtractSimpleAction<A> = {} extends ExcludeTypeField<A> ? A : never;`, `31196413578351833000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ExtractSimpleAction<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">extends</span> <span class="token class-name">ExcludeTypeField</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>现在如果 <code class="language-text">ExcludeTypeField &lt;A&gt;</code> 为空，则 extends 表达式为 true，否则为 false。</p>\n<p>但这仍然行不通！因为分布条件类型仅在 extends 关键字的前面是类型变量时发生。</p>\n<p>分布条件类型仅发生在如下场景：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99387864962892450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Blah<Var> = Var extends Whatever ? A : B;`, `99387864962892450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Blah<span class="token operator">&lt;</span>Var<span class="token operator">></span> <span class="token operator">=</span> Var <span class="token keyword">extends</span> <span class="token class-name">Whatever</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>而不是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62985206486875420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Blah<Var> = Foo<Var> extends Whatever ? A : B;\ntype Blah<Var> = Whatever extends Var ? A : B;`, `62985206486875420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Blah<span class="token operator">&lt;</span>Var<span class="token operator">></span> <span class="token operator">=</span> Foo<span class="token operator">&lt;</span>Var<span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">Whatever</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> Blah<span class="token operator">&lt;</span>Var<span class="token operator">></span> <span class="token operator">=</span> Whatever <span class="token keyword">extends</span> <span class="token class-name">Var</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token constant">B</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>但是我们可以通过一些小技巧绕过这个限制：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75954224081492200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type ExtractSimpleAction<A> = A extends any ? ({} extends ExcludeTypeField<A> ? A : never) : never;`, `75954224081492200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> ExtractSimpleAction<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">any</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">extends</span> <span class="token class-name">ExcludeTypeField</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><code class="language-text">A extends any</code> 是一定成立的，这只是用来绕过 ts 对于分布条件类型的限制，没错啊，我们的 A 确实是在 extends 的前面了，就是骗你 TS，这里是分布条件类型。</p>\n<p>而我们真正想要做的条件判断被放在了中间，因此 Action 联合类型中的每一项又能够分布的去匹配了。</p>\n<p>那么我们就可以简单的筛选出所有不需要额外参数的 type</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41351756179316950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type SimpleAction = ExtractSimpleAction<Action>;\ntype SimpleActionType = SimpleAction[\'type\'];`, `41351756179316950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> SimpleAction <span class="token operator">=</span> ExtractSimpleAction<span class="token operator">&lt;</span>Action<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> SimpleActionType <span class="token operator">=</span> SimpleAction<span class="token punctuation">[</span><span class="token string">\'type\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>再利用 Exclude 取反，找到复杂类型：</p>\n<p>type ComplexActionType = Exclude&#x3C;ActionType, SimpleActionType></p>\n<p>到此为止，我们所需要的功能就完美实现了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12163706855486400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 简单参数类型\nfunction dispatch<T extends SimpleActionType>(type: T): void;\n// 复杂参数类型\nfunction dispatch<T extends ComplexActionType>(type: T, args: ExtractActionParameters<Action, T>): void;\n// 实现\nfunction dispatch(arg: any, payload?: any) {}\n\n// ok\ndispatch(\'SYNC\');\n\n// ok\ndispatch({\n   type: \'LOG_IN\',\n   emailAddress: \'david.sheldrick@artsy.net\'\n});`, `12163706855486400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token comment">// 简单参数类型</span>\n<span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token comment">// 复杂参数类型</span>\n<span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">ComplexActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> ExtractActionParameters<span class="token operator">&lt;</span>Action<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token comment">// 实现</span>\n<span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> payload<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token comment">// ok</span>\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">\'SYNC\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// ok</span>\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n   <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN\'</span><span class="token punctuation">,</span>\n   emailAddress<span class="token punctuation">:</span> <span class="token string">\'david.sheldrick@artsy.net\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="完整代码"><a href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>完整代码</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26302631738626770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Action =\n   | {\n        type: \'INIT\';\n     }\n   | {\n        type: \'SYNC\';\n     }\n   | {\n        type: \'LOG_IN\';\n        emailAddress: string;\n     }\n   | {\n        type: \'LOG_IN_SUCCESS\';\n        accessToken: string;\n     };\n\n// 用类型查询查出 Action 中所有 type 的联合类型\ntype ActionType = Action[\'type\'];\n\n// 把类型中 key 为 type 去掉\ntype ExcludeTypeField<A> = { [K in Exclude<keyof A, \'type\'>]: A[K] };\n\ntype ExtractActionParameters<A, T> = A extends { type: T } ? A : never;\n\n// 把参数对象中的 type 去掉\n// Extract<A, { type: T } 会挑选出能 extend { type: T } 这个结构的 Action 中的类型\ntype ExtractActionParametersWithoutType<A, T> = ExcludeTypeField<ExtractActionParameters<A, T>>;\n\ntype ExtractSimpleAction<A> = A extends any ? ({} extends ExcludeTypeField<A> ? A : never) : never;\n\ntype SimpleActionType = ExtractSimpleAction<Action>[\'type\'];\ntype ComplexActionType = Exclude<ActionType, SimpleActionType>;\n\n// 简单参数类型\nfunction dispatch<T extends SimpleActionType>(type: T): void;\n// 复杂参数类型\nfunction dispatch<T extends ComplexActionType>(type: T, args: ExtractActionParametersWithoutType<Action, T>): void;\n// 实现\nfunction dispatch(arg: any, payload?: any) {}\n\ndispatch(\'SYNC\');\n\ndispatch(\'LOG_IN\', {\n   emailAddress: \'ssh@qq.com\'\n});`, `26302631738626770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Action <span class="token operator">=</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'INIT\'</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'SYNC\'</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN\'</span><span class="token punctuation">;</span>\n        emailAddress<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span>\n   <span class="token operator">|</span> <span class="token punctuation">{</span>\n        <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">\'LOG_IN_SUCCESS\'</span><span class="token punctuation">;</span>\n        accessToken<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n     <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 用类型查询查出 Action 中所有 type 的联合类型</span>\n<span class="token keyword">type</span> ActionType <span class="token operator">=</span> Action<span class="token punctuation">[</span><span class="token string">\'type\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 把类型中 key 为 type 去掉</span>\n<span class="token keyword">type</span> ExcludeTypeField<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> Exclude<span class="token operator">&lt;</span><span class="token keyword">keyof</span> <span class="token constant">A</span><span class="token punctuation">,</span> <span class="token string">\'type\'</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token constant">A</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ExtractActionParameters<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 把参数对象中的 type 去掉</span>\n<span class="token comment">// Extract&lt;A, { type: T } 会挑选出能 extend { type: T } 这个结构的 Action 中的类型</span>\n<span class="token keyword">type</span> ExtractActionParametersWithoutType<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> ExcludeTypeField<span class="token operator">&lt;</span>ExtractActionParameters<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">>></span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> ExtractSimpleAction<span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name">any</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">extends</span> <span class="token class-name">ExcludeTypeField</span><span class="token operator">&lt;</span><span class="token constant">A</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">A</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> SimpleActionType <span class="token operator">=</span> ExtractSimpleAction<span class="token operator">&lt;</span>Action<span class="token operator">></span><span class="token punctuation">[</span><span class="token string">\'type\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">type</span> ComplexActionType <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span>ActionType<span class="token punctuation">,</span> SimpleActionType<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 简单参数类型</span>\n<span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">SimpleActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token comment">// 复杂参数类型</span>\n<span class="token keyword">function</span> dispatch<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">ComplexActionType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> ExtractActionParametersWithoutType<span class="token operator">&lt;</span>Action<span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n<span class="token comment">// 实现</span>\n<span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> payload<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">\'SYNC\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">\'LOG_IN\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n   emailAddress<span class="token punctuation">:</span> <span class="token string">\'ssh@qq.com\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="ref-类型从零实现"><a href="#ref-%E7%B1%BB%E5%9E%8B%E4%BB%8E%E9%9B%B6%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Ref 类型从零实现</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85681913015370200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const count = ref(ref(ref(ref(2))));`, `85681913015370200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>需要支持嵌套后解包，最后只会剩下 { value: number } 这个类型。</p>\n<h3 id="泛型的反向推导"><a href="#%E6%B3%9B%E5%9E%8B%E7%9A%84%E5%8F%8D%E5%90%91%E6%8E%A8%E5%AF%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>泛型的反向推导</h3>\n<p>泛型的正向用法很多人都知道了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37818703638874940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Value<T> = T;\n\ntype NumberValue = Value<number>;`, `37818703638874940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Value<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> NumberValue <span class="token operator">=</span> Value<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这样，NumberValue 解析出的类型就是 number，其实就类似于类型系统里的传参。</p>\n<p>那么反向推导呢？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85192172669965630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function create<T>(val: T): T;\n\nlet num: number;\n\nconst c = create(num);`, `85192172669965630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> create<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>val<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> num<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里泛型没有传入，居然也能推断出 value 的类型是 number。</p>\n<p>因为 <code class="language-text">create&lt;T&gt;</code> 这里的泛型 T 被分配给了传入的参数 <code class="language-text">value: T</code>，然后又用这个 T 直接作为返回的类型，</p>\n<p>简单来说，这里的三个 T 被关联起来了，并且在传入 create(2) 的那一刻，这个 T 被统一推断成了 number。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9895248625091013000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function create<2>(value: 2): 2`, `9895248625091013000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">function</span> create<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">></span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h3 id="索引签名"><a href="#%E7%B4%A2%E5%BC%95%E7%AD%BE%E5%90%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>索引签名</h3>\n<p>假设我们有一个这样的类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6056406475469100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Test = {\n   foo: number;\n   bar: string;\n};\n\ntype N = Test[\'foo\']; // number`, `6056406475469100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Test <span class="token operator">=</span> <span class="token punctuation">{</span>\n   foo<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   bar<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> <span class="token constant">N</span> <span class="token operator">=</span> Test<span class="token punctuation">[</span><span class="token string">\'foo\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以通过类似 JavaScript 中的对象属性查找的语法来找出对应的类型。</p>\n<h3 id="条件类型-1"><a href="#%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>条件类型</h3>\n<p>假设我们有一个这样的类型：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85316647458087730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type IsNumber<T> = T extends number ? \'yes\' : \'no\';\n\ntype A = IsNumber<2>; // yes\ntype B = isNumber<\'3\'>; // no`, `85316647458087730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> IsNumber<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">number</span> <span class="token operator">?</span> <span class="token string">\'yes\'</span> <span class="token punctuation">:</span> <span class="token string">\'no\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> <span class="token constant">A</span> <span class="token operator">=</span> IsNumber<span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// yes</span>\n<span class="token keyword">type</span> <span class="token constant">B</span> <span class="token operator">=</span> isNumber<span class="token operator">&lt;</span><span class="token string">\'3\'</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// no</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这就是一个典型的条件类型，用 extends 关键字配合三元运算符来判断传入的泛型是否可分配给 extends 后面的类型。</p>\n<p>同时也支持多层的三元运算符（后面会用到）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74557435091141430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type TypeName<T> = T extends string ? \'string\' : T extends boolean ? \'boolean\' : \'object\';\n\ntype T0 = TypeName<string>; // &quot;string&quot;\ntype T1 = TypeName<\'a\'>; // &quot;string&quot;\ntype T2 = TypeName<true>; // &quot;boolean&quot;`, `74557435091141430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> TypeName<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span> <span class="token operator">?</span> <span class="token string">\'string\'</span> <span class="token punctuation">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">boolean</span> <span class="token operator">?</span> <span class="token string">\'boolean\'</span> <span class="token punctuation">:</span> <span class="token string">\'object\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> <span class="token constant">T0</span> <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "string"</span>\n<span class="token keyword">type</span> <span class="token constant">T1</span> <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token string">\'a\'</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "string"</span>\n<span class="token keyword">type</span> <span class="token constant">T2</span> <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token boolean">true</span><span class="token operator">></span><span class="token punctuation">;</span> <span class="token comment">// "boolean"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="keyof"><a href="#keyof" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>keyof</h3>\n<p>keyof 操作符是 TS 中用来获取对象的 key 值集合的，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37139505480763170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Obj = {\n   foo: number;\n   bar: string;\n};\n\ntype Keys = keyof Obj; // &quot;foo&quot; | &quot;bar&quot;`, `37139505480763170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Obj <span class="token operator">=</span> <span class="token punctuation">{</span>\n   foo<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   bar<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Keys <span class="token operator">=</span> <span class="token keyword">keyof</span> Obj<span class="token punctuation">;</span> <span class="token comment">// "foo" | "bar"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样就轻松获取到了对象 key 值的联合类型：“foo” | “bar”。</p>\n<p>它也可以用在遍历中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89948460134729120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Obj = {\n   foo: number;\n   bar: string;\n};\n\ntype Copy = {\n   [K in keyof Obj]: Obj[K];\n};\n\n// Copy 得到和 Obj 一模一样的类型`, `89948460134729120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Obj <span class="token operator">=</span> <span class="token punctuation">{</span>\n   foo<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>\n   bar<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">type</span> Copy <span class="token operator">=</span> <span class="token punctuation">{</span>\n   <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> Obj<span class="token punctuation">]</span><span class="token punctuation">:</span> Obj<span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Copy 得到和 Obj 一模一样的类型</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>可以看出，遍历的过程中右侧也可以通过索引直接访问到原类型 Obj 中对应 key 的类型。</p>\n<h3 id="infer-2"><a href="#infer-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>infer</h3>\n<p>这是一个比较难的点，文档中对它的描述是条件类型中的类型推断。</p>\n<p>它的出现使得 ReturnType、 Parameters 等一众工具类型的支持都成为可能，是 TypeScript 进阶必须掌握的一个知识点了。</p>\n<p>注意前置条件，它一定是出现在条件类型中的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51601576683452960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Get<T> = T extends infer R ? R : never;`, `51601576683452960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Get<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>注意，infer R 的位置代表了一个未知的类型，可以理解为在条件类型中给了它一个占位符，然后就可以在后面的三元运算符中使用它。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83217595026006490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type T = Get<number>;\n\n// 经过计算\ntype Get<number> = number extends infer number ? number : never;\n\n// 得到\nnumber;`, `83217595026006490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> <span class="token constant">T</span> <span class="token operator">=</span> Get<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token comment">// 经过计算</span>\n<span class="token keyword">type</span> Get<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token keyword">extends</span> <span class="token class-name">infer</span> <span class="token builtin">number</span> <span class="token operator">?</span> <span class="token builtin">number</span> <span class="token punctuation">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 得到</span>\n<span class="token builtin">number</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它的使用非常灵活，它也可以出现在泛型位置：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2561839967885637600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type Unpack<T> = T extends Array<infer R> ? R : T;`, `2561839967885637600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> Unpack<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token operator">&lt;</span>infer <span class="token constant">R</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33808301623978300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`type NumArr = Array<number>\ntype U = Unpack<NumArr>\n\n// 经过计算\ntype Unpack<Array<number>> = Array<number> extends Array<infer R> ? R : T\n\n// 得到\nnumber`, `33808301623978300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="ts"\n              >\n                <span class="gatsby-code-button-language">ts</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="ts"><pre style="counter-reset: linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">type</span> NumArr <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span>\n<span class="token keyword">type</span> <span class="token constant">U</span> <span class="token operator">=</span> Unpack<span class="token operator">&lt;</span>NumArr<span class="token operator">></span>\n\n<span class="token comment">// 经过计算</span>\n<span class="token keyword">type</span> Unpack<span class="token operator">&lt;</span><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">>></span> <span class="token operator">=</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token operator">&lt;</span>infer <span class="token constant">R</span><span class="token operator">></span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token punctuation">:</span> <span class="token constant">T</span>\n\n<span class="token comment">// 得到</span>\n<span class="token builtin">number</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>仔细看看，是不是有那么点感觉了，它就是对于 extends 后面未知的某些类型进行一个占位 infer R，后续就可以使用推断出来的 R 这个类型。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/TypeScript入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:62,frontmatter:{date:"2021-10-22 13:47:44",path:"/typescript-introduce-learn/",tags:"前端, TypeScript, ts",title:"TypeScript 入门学习",draft:null}}],page:7,pagesSum:47,length:231,prevPath:"/page/6",nextPath:"/page/8"}}}});