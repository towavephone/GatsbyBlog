webpackJsonp([0x9235cf0bf1c0],{1185:function(n,a){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlElEQVRIx12We2xT5xXAbcI2Vmn7o1I1uhVYRxL8tuPn9bXv0+/4/YgdOyYkkATCCEEYsqVNC2wCIYQWShmUBFh4hMAWECot0BUtlI4yAS1oKqJQXimsDBgTU8codnLO7r0uUPpJn87Rp+/8vvOdc75zr8xmZmTieI1NykU5yxOfxDncz3NUjAlyDXMjXGMhys+cG+FzGQ8VU4t7XuV8z8m+GUkrJclSqVReYJ0ZWQ8Tl2AdTPhnq9ns2QKd+crDZiHha8NsYCE21HZiXphpb3sxxTf99Tdsw51ldHqFaLOXXyzvYqOyZ0YPk5soylfouuUbvHOxh56JbiqJfi4/FnE1lxKetrGUZ954nbcdU/752ORpxWVsc6mZjPxctFtApeVtra1lmIPwTxClgeCqvGTsX/WWOEbtyTGWSoGbToOPzUHQ1QghVxOEhRniZ5U8XB4TzvTdgj1ZJdq2OOrkGhVRBnrYFum6TiK0l2fr0emMlVxcBhlnEniqDjlBuqg0CnD0MPWiDrwzhR4u+5B3x3WiLUNHJjxzZYvR8ZKTCP+Xo1JoM/nBYvSB1egHuyUIrCOBPj4LtD0KlD2K4h7SGip62aygxzaK9rHA3Aqt2vw0MRYjnyJtYaQdsXG9hgWFwgmVlXZUKUjUqmm0CgfwhA80Kgr1Wg40Sue4SuFEnZq+YjMbJ0kh0zmfemjQ0j2EJYh2a23RVOODIBvHmCsBUaoWLDoWKIsP50bTApxC5QwH1Ghp0Gk4MBk8aDLQEslooCc88VClsK+zGANI2mqLer0XFuea8PSuN+DM7o3QWyhAR7IBfj+vDbyOICS9aSjkZo8nvSlUKuxXLDUOKdN6LSl/AlRUE+vNAnD50l8XeTIEPiYEzXYG5mlNeGz7BvjPpY/g5snDcHxwE+zs7oCh1zvHCrNm48u/ML8j2muVQblBZ3t6ZY2KXKtQcDiwdk1xx9rV0BlqghEuD4fNUTy1Zwhw7Cbioxu461fdsOgFDa5pbh3zu6NifE9f+XCPlGHS5nuaFI3K8brJ4EUHES4WFiyEP2/dCPc2vYH/3NIHePcywP1LWLp3Ec4tWQa3FvbAu7294yqVA801rju5utYfiQyKDD4DnC8GWEhMafJPtBALxuHjo3+C8bufIn59DfHBFcDiDcQvzyF+/iEsbWuDadNMaDW5H7nY6Iyyh165zfLNtdUqIqLTsEJSQqBVUTD1JQPqdRT8sf9NuH7kMHy0fRg+O3EUzp96H/Zs2SBklxFKxwFmowtdTCIoPQx7oKLzl32PPTRPVSudDwQgCrUGL0+twdzsDjjSdwD2J1fh/q7N0N+1EtykB178qVY4lAahRktWkw95JrG4DAxPvHU3Wwb+rlcsHfK0WNxCoMdUCgdUaxnMBPKw7dVe2LyhDw4MboORA4NQOd2CaiUFaqWjZJGAyQGRUeubP8FqElqZspquEBeUM2zrnEQUa3R8USVcp2qGDZV6ErqXL4PfrlwFhSU9cPL4MejfshOsZq90sCg5KvHZ5MnPfa+cmFrxukRFuRZNcYqIoNngHheeFmiF11ClIDBdPwfqG9qhc1E3rF25GnrX90M204JqBfWItPrP8lTqa7vFpSw3GJ9cZjI4pW5TXaWezpKxh4Q5gEY9LwApVOtZMApxVWhd2DKvC7K5FjTUsFCj45Ah4yXaHuz1MBlgyHCb1HXISIXMTcekOJqN1h/72Mx92h5DwuwHjeChWseBQsNgJJ6H944eB5oNgaLajnaL/07E24wuKr7Cz+XuuenUsMioCxYmyHhnSPLQTYVVYVfjI46Mo80WBLMgLY4E1FhCOENBAsfHQG/0juuNPqGguU8ywXas5XNbg6783wJ8w781GtUPJc+irkap/Ufdje0JXytStnDJbA2D1Z4EKxEHsyUMRmsIdcZaNFpCYBYqwWQLPhD3Btn6t2Pe5uF0cD7Sdr/xmSab8racFaDooOvuk0wDEs40EFQGbVQGbEKXJoTPgZ3JoJGIgULvR6M1jE67rzvpae5ojC7GEJ9rfgILc7lC3NV0T6flTtjoPLK+VuD8rcD65gDtaQInPxOtzoxQRrXgD8/BdW/+YezYByfxvfdHvnxl+ZLKCDfzUMIze60Ey+brJukrqcjA1u3tBw8dfZiZuRQFaNFory/WEPUlE5kFK5WDQKRtbFPfUOnChUvFL27cwKuj/8CBHXv2iQw/k/KGuNwyCYiIkhw+sO/569eu7b1+ffR/H5z4BAcG38X1m/biyjX9ODR8GC9dHsXLV0fx5KlzePDIyFd7ht9ZJZhJrcvLhV/wMuUPljQWtC6Z+FjfuWPHlPMXLq64Onpz3d8/Pf9WX//OW2vWbITBof3n3tqya9fbh/7SvW1gZ9Xj/V1dr8kf614qIZONjBwrezi8Ty54K5d9ZzTmF+xe1LnioaD+4Nvrn4/ermif3yHp8UCDLMCky7Z+n192+/YdST9z5mPZ7t1D8ouXv6gQ4S9WTplks7mut8xZijxbKz2vvi2D39/cPyB/HC5xOm2czPvd35F8rkGCS0+I4WXV1QbJaMq06XqbNXCQJIILpH8hOic3GghZMpl62qG/Nf4PRzaQ862MzO4AAAAASUVORK5CYII=",aspectRatio:.6666666666666666,src:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png",srcSet:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-8a97b.png 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-0fdf3.png 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-25c91.png 600w",srcWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp",srcSetWebp:"/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-5d70e.webp 200w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-d1677.webp 400w,\n/static/avatar-dc7bc85837bf005ae32d2a37dfdfa8a2-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于 C 端营销线新建项目需要模板化，需要代码模板的生成功能，以便统一技术栈</p>\n<h1 id="一期"><a href="#%E4%B8%80%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一期</h1>\n<p>一期代码生成需要在 lerna 工程下去做改造，除了带有代码模板的功能，还封装了执行脚本的入口</p>\n<p>参考链接：<a href="https://github.com/react-boilerplate/react-boilerplate" target="_blank" rel="nofollow noreferrer noopener">react-boilerplate</a></p>\n<blockquote>\n<p>这里的代码模板包含项目级别的代码模板、页面级别的代码模板，目前只完成了项目的代码模板生成</p>\n</blockquote>\n<h2 id="目录结构"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26130991147791405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── index.html\n├── internals\n│   ├── generators\n│   │   ├── index.js // 模板代码执行主入口\n│   │   ├── package // 模板文件夹，带有模板变量的文件后缀名为 hbs\n│   │   │   ├── config.js.hbs\n│   │   │   ├── index.js // 项目级别的代码模板命令执行入口\n│   │   │   ├── package-lock.json.hbs\n│   │   │   ├── package.json.hbs // 带模板变量的模板文件\n│   │   │   └── template // 不带模板变量的模板文件\n│   │   ├── page\n│   │   │   └── index.js // 页面级别的代码模板命令执行入口\n│   │   └── utils\n│   │       ├── directoryExists.js // 检测 packages 文件夹存在性\n│   │       └── fileKeyExists.js // 检测 packages 下面文件里面某种属性是否存在，主要为了实现端口占用检测功能\n│   └── scripts\n│       ├── helpers\n│       │   └── argv.js // 命令行参数封装\n│       └── run.js // 脚本执行主入口\n├── packages // 项目源代码，即代码模板生成后的结果文件夹\n|   ├── demo1\n│   └── demo2\n├── lerna.json\n├── package-lock.json\n├── package.json // 命令主入口\n└── readme.md`, `26130991147791405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">.</span>\n├── index<span class="token punctuation">.</span>html\n├── internals\n│   ├── generators\n│   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 模板代码执行主入口</span>\n│   │   ├── <span class="token keyword">package</span> <span class="token comment">// 模板文件夹，带有模板变量的文件后缀名为 hbs</span>\n│   │   │   ├── config<span class="token punctuation">.</span>js<span class="token punctuation">.</span>hbs\n│   │   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 项目级别的代码模板命令执行入口</span>\n│   │   │   ├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   ├── <span class="token keyword">package</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs <span class="token comment">// 带模板变量的模板文件</span>\n│   │   │   └── template <span class="token comment">// 不带模板变量的模板文件</span>\n│   │   ├── page\n│   │   │   └── index<span class="token punctuation">.</span>js <span class="token comment">// 页面级别的代码模板命令执行入口</span>\n│   │   └── utils\n│   │       ├── directoryExists<span class="token punctuation">.</span>js <span class="token comment">// 检测 packages 文件夹存在性</span>\n│   │       └── fileKeyExists<span class="token punctuation">.</span>js <span class="token comment">// 检测 packages 下面文件里面某种属性是否存在，主要为了实现端口占用检测功能</span>\n│   └── scripts\n│       ├── helpers\n│       │   └── argv<span class="token punctuation">.</span>js <span class="token comment">// 命令行参数封装</span>\n│       └── run<span class="token punctuation">.</span>js <span class="token comment">// 脚本执行主入口</span>\n├── packages <span class="token comment">// 项目源代码，即代码模板生成后的结果文件夹</span>\n<span class="token operator">|</span>   ├── demo1\n│   └── demo2\n├── lerna<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token punctuation">.</span>json <span class="token comment">// 命令主入口</span>\n└── readme<span class="token punctuation">.</span>md</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="脚本主入口"><a href="#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本主入口</h2>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68097916930228990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;name&quot;: &quot;root&quot;,\n   &quot;private&quot;: true,\n   &quot;devDependencies&quot;: {\n      &quot;cross-env&quot;: &quot;^7.0.3&quot;,\n      &quot;lerna&quot;: &quot;^4.0.0&quot;,\n      &quot;minimist&quot;: &quot;^1.2.5&quot;,\n      &quot;plop&quot;: &quot;^2.7.4&quot;,\n      &quot;shelljs&quot;: &quot;^0.8.4&quot;\n   },\n   &quot;scripts&quot;: {\n      &quot;postinstall&quot;: &quot;lerna bootstrap&quot;,\n      &quot;start&quot;: &quot;node internals/scripts/run --cmd=start&quot;,\n      &quot;build&quot;: &quot;node internals/scripts/run --cmd=build&quot;,\n      &quot;generate&quot;: &quot;plop --plopfile internals/generators/index.js&quot;\n   }\n}`, `68097916930228990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"root"</span><span class="token punctuation">,</span>\n   <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n   <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"cross-env"</span><span class="token operator">:</span> <span class="token string">"^7.0.3"</span><span class="token punctuation">,</span>\n      <span class="token property">"lerna"</span><span class="token operator">:</span> <span class="token string">"^4.0.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token string">"^1.2.5"</span><span class="token punctuation">,</span>\n      <span class="token property">"plop"</span><span class="token operator">:</span> <span class="token string">"^2.7.4"</span><span class="token punctuation">,</span>\n      <span class="token property">"shelljs"</span><span class="token operator">:</span> <span class="token string">"^0.8.4"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"postinstall"</span><span class="token operator">:</span> <span class="token string">"lerna bootstrap"</span><span class="token punctuation">,</span>\n      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=start"</span><span class="token punctuation">,</span>\n      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=build"</span><span class="token punctuation">,</span>\n      <span class="token property">"generate"</span><span class="token operator">:</span> <span class="token string">"plop --plopfile internals/generators/index.js"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模板代码生成"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码生成</h2>\n<h3 id="模板代码执行主入口"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码执行主入口</h3>\n<p>internals/generators/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="897188517210656400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shell = require(\'shelljs\');\n\nconst packageGenerator = require(\'./package/index.js\');\n\nmodule.exports = (plop) => {\n   plop.setGenerator(\'package\', packageGenerator); // 注册 package 下的命令\n   // plop.setGenerator(&quot;page&quot;, containerGenerator);\n   plop.setDefaultInclude({ actionTypes: true });\n   // 拓展 plop 复制功能\n   plop.setActionType(\'copy\', (answers, config, plop) => {\n      const src = plop.renderString(config.src, answers);\n      const dest = plop.renderString(config.dest, answers);\n      shell.cp(\'-r\', src, dest);\n   });\n};`, `897188517210656400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">\'package\'</span><span class="token punctuation">,</span> packageGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册 package 下的命令</span>\n   <span class="token comment">// plop.setGenerator("page", containerGenerator);</span>\n   plop<span class="token punctuation">.</span><span class="token function">setDefaultInclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span> actionTypes<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// 拓展 plop 复制功能</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> src <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>src<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> dest <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dest<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      shell<span class="token punctuation">.</span><span class="token function">cp</span><span class="token punctuation">(</span><span class="token string">\'-r\'</span><span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="检测-packages-文件夹存在性"><a href="#%E6%A3%80%E6%B5%8B-packages-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%AD%98%E5%9C%A8%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检测 packages 文件夹存在性</h3>\n<p>internals/generators/utils/directoryExists.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98021190119840200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fs = require(\'fs\');\nconst path = require(\'path\');\n\n/**\n *\n * @param {*} directoryPath 文件夹路径\n * @param {*} value 输入的值\n * @returns\n */\nfunction directoryExists(directoryPath, value) {\n   const directoryFullPath = path.join(\n      process.cwd(),\n      ...(Array.isArray(directoryPath) ? directoryPath : [directoryPath])\n   );\n   if (fs.existsSync(directoryFullPath) && fs.statSync(directoryFullPath).isDirectory()) {\n      const packages = fs.readdirSync(directoryFullPath);\n      return packages.indexOf(value) >= 0;\n   }\n   return false;\n}\n\nmodule.exports = directoryExists;`, `98021190119840200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n *\n * @param {*} directoryPath 文件夹路径\n * @param {*} value 输入的值\n * @returns\n */</span>\n<span class="token keyword">function</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token parameter">directoryPath<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> directoryFullPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>\n      process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token operator">...</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">)</span> <span class="token operator">?</span> directoryPath <span class="token punctuation">:</span> <span class="token punctuation">[</span>directoryPath<span class="token punctuation">]</span><span class="token punctuation">)</span>\n   <span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> packages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>directoryFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> packages<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n   <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> directoryExists<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="检测-packages-下面文件里面某种属性是否存在"><a href="#%E6%A3%80%E6%B5%8B-packages-%E4%B8%8B%E9%9D%A2%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E6%9F%90%E7%A7%8D%E5%B1%9E%E6%80%A7%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>检测 packages 下面文件里面某种属性是否存在</h3>\n<p>主要为了实现端口占用检测功能</p>\n<p>internals/generators/utils/fileKeyExists.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="295889072654320640"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fs = require(\'fs\');\nconst path = require(\'path\');\nconst packagesPath = path.join(process.cwd(), \'packages\');\nconst packages = fs.readdirSync(packagesPath);\nconst lodash = require(\'lodash\');\n\n/**\n * 检测 packages 下面文件里面某种属性是否存在\n * @param {*} filePath 文件路径\n * @param {*} key 文件的属性\n * @param {*} defaultValue 属性不存在时的默认值\n * @param {*} value 输入的值\n * @returns\n */\nfunction fileKeyExists(filePath, key, defaultValue, value) {\n   const values = [];\n   packages.forEach((item) => {\n      if (item !== \'js-bridge\') {\n         const fileFullPath = path.join(packagesPath, item, ...(Array.isArray(filePath) ? filePath : [filePath]));\n         if (fs.existsSync(fileFullPath) && fs.statSync(fileFullPath).isFile()) {\n            const fileResult = require(fileFullPath);\n            const fileKeyValue = lodash.get(fileResult, key);\n            if (fileKeyValue) {\n               values.push(fileKeyValue);\n            } else {\n               values.push(defaultValue);\n            }\n         } else {\n            values.push(defaultValue);\n         }\n      }\n   });\n   return values.map((item) => \\`\\${item}\\`).indexOf(value) >= 0;\n}\n\nmodule.exports = fileKeyExists;`, `295889072654320640`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> packagesPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'packages\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> packages <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span>packagesPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * 检测 packages 下面文件里面某种属性是否存在\n * @param {*} filePath 文件路径\n * @param {*} key 文件的属性\n * @param {*} defaultValue 属性不存在时的默认值\n * @param {*} value 输入的值\n * @returns\n */</span>\n<span class="token keyword">function</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token parameter">filePath<span class="token punctuation">,</span> key<span class="token punctuation">,</span> defaultValue<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n   packages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">!==</span> <span class="token string">\'js-bridge\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n         <span class="token keyword">const</span> fileFullPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>packagesPath<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">?</span> filePath <span class="token punctuation">:</span> <span class="token punctuation">[</span>filePath<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">const</span> fileResult <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>fileFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">const</span> fileKeyValue <span class="token operator">=</span> lodash<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fileResult<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>fileKeyValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fileKeyValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n               values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">return</span> values<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> fileKeyExists<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="项目级别的代码模板命令执行入口"><a href="#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目级别的代码模板命令执行入口</h3>\n<p>internals/generators/package/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20355794599721100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const directoryExists = require(\'../utils/directoryExists\');\nconst fileKeyExists = require(\'../utils/fileKeyExists\');\n\nconst portExists = (value) =>\n   fileKeyExists(\'config.js\', \'serverPort\', 3000, value) || fileKeyExists(\'config.js\', \'fePort\', 8888, value);\n\nmodule.exports = {\n   description: \'生成 package\',\n   prompts: [\n      {\n         type: \'input\',\n         name: \'name\',\n         message: \'package 叫什么名字？\',\n         default: \'demo\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return directoryExists(\'packages\', value) ? \'package 名字已存在\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'serverPort\',\n         message: \'package 的 Node.js 服务端口？\',\n         default: \'8001\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 Node.js 服务端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'fePort\',\n         message: \'package 的 webpack-dev-server 端口？\',\n         default: \'8002\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 webpack-dev-server 端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      }\n   ],\n   actions: (data) => {\n      const actions = [\n         {\n            type: \'copy\',\n            src: \'internals/generators/package/template\',\n            dest: \'packages/{{ dashCase name }}\'\n         },\n         {\n            type: \'addMany\',\n            templateFiles: \'package/*.hbs\',\n            destination: \'../../packages/{{ dashCase name }}/\'\n         }\n      ];\n\n      return actions;\n   }\n};`, `20355794599721100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> directoryExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/directoryExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fileKeyExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/fileKeyExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">portExists</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   description<span class="token punctuation">:</span> <span class="token string">\'生成 package\'</span><span class="token punctuation">,</span>\n   prompts<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'name\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 叫什么名字？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'demo\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token string">\'packages\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'package 名字已存在\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 Node.js 服务端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8001\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 Node.js 服务端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 webpack-dev-server 端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8002\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 webpack-dev-server 端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">actions</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'copy\'</span><span class="token punctuation">,</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'internals/generators/package/template\'</span><span class="token punctuation">,</span>\n            dest<span class="token punctuation">:</span> <span class="token string">\'packages/{{ dashCase name }}\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'addMany\'</span><span class="token punctuation">,</span>\n            templateFiles<span class="token punctuation">:</span> <span class="token string">\'package/*.hbs\'</span><span class="token punctuation">,</span>\n            destination<span class="token punctuation">:</span> <span class="token string">\'../../packages/{{ dashCase name }}/\'</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> actions<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="带模板变量的模板文件"><a href="#%E5%B8%A6%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E7%9A%84%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>带模板变量的模板文件</h3>\n<p>hbs 文件为模板文件，所有需要替换的地方用 <code class="language-text">{{}}</code> 模板变量，详情请查看 <a href="https://github.com/plopjs/plop" target="_blank" rel="nofollow noreferrer noopener">plop</a>，其他模板文件不再举例</p>\n<p>internals/generators/package/config.js.hbs</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53346541782727480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n  prefix: \'page\',\n  serverPort: {{ serverPort }},\n  fePort: {{ fePort }}\n}`, `53346541782727480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="hbs"\n              >\n                <span class="gatsby-code-button-language">hbs</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="hbs"><pre style="counter-reset: linenumber NaN" class="language-hbs line-numbers"><code class="language-hbs">module.exports = {\n  prefix: &#39;page&#39;,\n  serverPort: {{ serverPort }},\n  fePort: {{ fePort }}\n}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行结果"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h3>\n<p>以下是检测存在冲突的情况</p>\n<p><img src="/static/code-generation-addfae6d6b5126e00ca2c25e4c38dd96.gif" alt="代码生成冲突检测"></p>\n<h2 id="脚本执行封装"><a href="#%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E5%B0%81%E8%A3%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本执行封装</h2>\n<p>封装 lerna 脚本，以实现脚本的并行执行</p>\n<p>internals/scripts/helpers/argv.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54241154229019790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = require(\'minimist\')(process.argv.slice(2));`, `54241154229019790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'minimist\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>internals/scripts/run.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10935306257899313000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env node\n\nconst shelljs = require(\'shelljs\');\nconst argv = require(\'./helpers/argv\');\n\nlet scopeParams = [];\nconst arguments = argv._;\n\nif (arguments && arguments.length > 0) {\n   scopeParams = arguments.map((item) => \\`--scope=\\${item}\\`);\n}\n\nshelljs.exec(\\`\n  cross-env FORCE_COLOR=1 lerna run \\${argv.cmd} --stream --parallel \\${scopeParams.join(\' \')}\n\\`);`, `10935306257899313000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node\n\n<span class="token keyword">const</span> shelljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./helpers/argv\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> scopeParams <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> arguments <span class="token operator">=</span> argv<span class="token punctuation">.</span>_<span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>arguments <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   scopeParams <span class="token operator">=</span> arguments<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">--scope=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nshelljs<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n  cross-env FORCE_COLOR=1 lerna run </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argv<span class="token punctuation">.</span>cmd<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> --stream --parallel </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scopeParams<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="使用说明"><a href="#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用说明</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61348534041477890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`npm i # 安装依赖\n\n# 启动\nnpm start # 并行启动所有 package\nnpm start website # 启动 website 项目\nnpm start website demo # 并行启动 website,demo 项目\n\n# 编译\nnpm run build # 并行编译所有 package\nnpm run build website # 编译 package 项目\nnpm run build website demo # 并行编译 website,demo 项目\n\n# 模板代码生成\nnpm run generate`, `61348534041477890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token function">npm</span> i <span class="token comment"># 安装依赖</span>\n\n<span class="token comment"># 启动</span>\n<span class="token function">npm</span> start <span class="token comment"># 并行启动所有 package</span>\n<span class="token function">npm</span> start website <span class="token comment"># 启动 website 项目</span>\n<span class="token function">npm</span> start website demo <span class="token comment"># 并行启动 website,demo 项目</span>\n\n<span class="token comment"># 编译</span>\n<span class="token function">npm</span> run build <span class="token comment"># 并行编译所有 package</span>\n<span class="token function">npm</span> run build website <span class="token comment"># 编译 package 项目</span>\n<span class="token function">npm</span> run build website demo <span class="token comment"># 并行编译 website,demo 项目</span>\n\n<span class="token comment"># 模板代码生成</span>\n<span class="token function">npm</span> run generate</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="二期"><a href="#%E4%BA%8C%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>二期</h1>\n<p>由于项目代码需要分离，不再使用 lerna 管理各个产品线的包，所以二期主要工作在于封装成可用的命令行，以便直接使用它来新建项目</p>\n<p>参考链接：<a href="https://juejin.cn/post/6919308174151385096" target="_blank" rel="nofollow noreferrer noopener">从 0-1 搭建 react，ts 脚手架</a></p>\n<h2 id="目录结构-1"><a href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录结构</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40752448426982020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.\n├── bin\n│   └── cli.js // 脚本主入口\n├── internals\n│   ├── generators\n│   │   ├── index.js // 模板代码生成\n│   │   ├── package\n│   │   │   ├── config.js.hbs\n│   │   │   ├── index.js\n│   │   │   ├── package-lock.json.hbs\n│   │   │   ├── package.json.hbs\n│   │   │   └── template\n│   │   ├── page\n│   │   │   └── index.js\n│   │   └── utils\n│   │       ├── directoryExists.js\n│   │       └── fileKeyExists.js\n│   └── scripts\n│       ├── helpers\n│       │   └── argv.js\n│       └── run.js\n├── package-lock.json\n├── package.json\n├── src\n│   ├── create.js // 模板代码生成主入口\n│   └── start.js\n└── utils\n    └── index.js`, `40752448426982020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">.</span>\n├── bin\n│   └── cli<span class="token punctuation">.</span>js <span class="token comment">// 脚本主入口</span>\n├── internals\n│   ├── generators\n│   │   ├── index<span class="token punctuation">.</span>js <span class="token comment">// 模板代码生成</span>\n│   │   ├── <span class="token keyword">package</span>\n│   │   │   ├── config<span class="token punctuation">.</span>js<span class="token punctuation">.</span>hbs\n│   │   │   ├── index<span class="token punctuation">.</span>js\n│   │   │   ├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   ├── <span class="token keyword">package</span><span class="token punctuation">.</span>json<span class="token punctuation">.</span>hbs\n│   │   │   └── template\n│   │   ├── page\n│   │   │   └── index<span class="token punctuation">.</span>js\n│   │   └── utils\n│   │       ├── directoryExists<span class="token punctuation">.</span>js\n│   │       └── fileKeyExists<span class="token punctuation">.</span>js\n│   └── scripts\n│       ├── helpers\n│       │   └── argv<span class="token punctuation">.</span>js\n│       └── run<span class="token punctuation">.</span>js\n├── <span class="token keyword">package</span><span class="token operator">-</span>lock<span class="token punctuation">.</span>json\n├── <span class="token keyword">package</span><span class="token punctuation">.</span>json\n├── src\n│   ├── create<span class="token punctuation">.</span>js <span class="token comment">// 模板代码生成主入口</span>\n│   └── start<span class="token punctuation">.</span>js\n└── utils\n    └── index<span class="token punctuation">.</span>js</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="脚本主入口-1"><a href="#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>脚本主入口</h2>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4782095332116998000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n   &quot;name&quot;: &quot;cli&quot;,\n   &quot;version&quot;: &quot;1.0.0&quot;,\n   &quot;description&quot;: &quot;销服C端脚手架&quot;,\n   &quot;main&quot;: &quot;index.js&quot;,\n   &quot;scripts&quot;: {\n      &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; && exit 1&quot;,\n      &quot;start&quot;: &quot;node internals/scripts/run --cmd=start&quot;,\n      &quot;build&quot;: &quot;node internals/scripts/run --cmd=build&quot;\n   },\n   &quot;bin&quot;: {\n      &quot;cli&quot;: &quot;./bin/cli.js&quot;\n   },\n   &quot;author&quot;: &quot;&quot;,\n   &quot;license&quot;: &quot;ISC&quot;,\n   &quot;dependencies&quot;: {\n      &quot;commander&quot;: &quot;^8.2.0&quot;,\n      &quot;cross-env&quot;: &quot;^7.0.3&quot;,\n      &quot;minimist&quot;: &quot;^1.2.5&quot;,\n      &quot;plop&quot;: &quot;^2.7.4&quot;,\n      &quot;shelljs&quot;: &quot;^0.8.4&quot;\n   }\n}`, `4782095332116998000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="json"\n              >\n                <span class="gatsby-code-button-language">json</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n   <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"cli"</span><span class="token punctuation">,</span>\n   <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>\n   <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"销服C端脚手架"</span><span class="token punctuation">,</span>\n   <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>\n   <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \\"Error: no test specified\\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>\n      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=start"</span><span class="token punctuation">,</span>\n      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node internals/scripts/run --cmd=build"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"bin"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"cli"</span><span class="token operator">:</span> <span class="token string">"./bin/cli.js"</span>\n   <span class="token punctuation">}</span><span class="token punctuation">,</span>\n   <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n   <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>\n   <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"commander"</span><span class="token operator">:</span> <span class="token string">"^8.2.0"</span><span class="token punctuation">,</span>\n      <span class="token property">"cross-env"</span><span class="token operator">:</span> <span class="token string">"^7.0.3"</span><span class="token punctuation">,</span>\n      <span class="token property">"minimist"</span><span class="token operator">:</span> <span class="token string">"^1.2.5"</span><span class="token punctuation">,</span>\n      <span class="token property">"plop"</span><span class="token operator">:</span> <span class="token string">"^2.7.4"</span><span class="token punctuation">,</span>\n      <span class="token property">"shelljs"</span><span class="token operator">:</span> <span class="token string">"^0.8.4"</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模板代码生成-1"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码生成</h2>\n<p>以下仅列出和一期的不同点</p>\n<h3 id="模板代码执行主入口-1"><a href="#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板代码执行主入口</h3>\n<p>相比一期主要多了新建项目后 <code class="language-text">npm install</code> 的功能</p>\n<p>bin/cli.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54207460525646730000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#!/usr/bin/env node\nconst program = require(\'commander\');\nconst create = require(\'../src/create\');\n// const start = require(&quot;../src/start&quot;);\n\nconst { green } = require(\'../utils\');\n\nprogram.version(\'1.0.0\');\n\n/* create a project */\nprogram\n   .command(\'create\')\n   .description(\'create a project \')\n   .action(function() {\n      green(\'👽 👽 👽 \' + \'欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\');\n      create();\n   });\n\n/* start project */\nprogram\n   .command(\'start\')\n   .description(\'start a project\')\n   .action(function() {\n      green(\'--------运行项目-------\');\n      start(\'start\').then(() => {\n         green(\'-------✅  ✅运行完成-------\');\n      });\n   });\n\nprogram.parse(process.argv);`, `54207460525646730000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node\n<span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'commander\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> create <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../src/create\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// const start = require("../src/start");</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> green <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nprogram<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">\'1.0.0\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/* create a project */</span>\nprogram\n   <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">\'create\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">\'create a project \'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'👽 👽 👽 \'</span> <span class="token operator">+</span> <span class="token string">\'欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/* start project */</span>\nprogram\n   <span class="token punctuation">.</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">\'start a project\'</span><span class="token punctuation">)</span>\n   <span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'--------运行项目-------\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">start</span><span class="token punctuation">(</span><span class="token string">\'start\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token function">green</span><span class="token punctuation">(</span><span class="token string">\'-------✅  ✅运行完成-------\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nprogram<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>internals/generators/index.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51936352658363875000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const shell = require(\'shelljs\');\nconst { spawn } = require(\'child_process\');\n\nconst packageGenerator = require(\'./package/index.js\');\n\nconst didSucceed = (code) => \\`\\${code}\\` === \'0\';\n\nfunction npmInstall(answers, config, plop) {\n   const path = plop.renderString(config.path, answers);\n   const spawnOptions = config.verbose\n      ? {\n           cwd: path,\n           shell: true,\n           stdio: \'inherit\'\n        }\n      : {\n           cwd: path\n        };\n\n   return new Promise((resolve, reject) => {\n      const npmI = spawn(\'npm\', [\'install\'], spawnOptions);\n\n      npmI.on(\'close\', (code) => {\n         if (didSucceed(code)) {\n            resolve(\\`npm install ran correctly\\`);\n         } else {\n            reject(\\`npm install exited with \\${code}\\`);\n         }\n      });\n   });\n}\n\nmodule.exports = (plop) => {\n   plop.setGenerator(\'package\', packageGenerator);\n   // plop.setGenerator(&quot;page&quot;, containerGenerator);\n   plop.setDefaultInclude({ actionTypes: true });\n   plop.setActionType(\'copy\', (answers, config, plop) => {\n      const src = plop.renderString(config.src, answers);\n      const dest = plop.renderString(config.dest, answers);\n      shell.cp(\'-r\', src, dest);\n   });\n   plop.setActionType(\'npmInstall\', npmInstall);\n};`, `51936352658363875000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> shell <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'shelljs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> spawn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'child_process\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageGenerator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">didSucceed</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">===</span> <span class="token string">\'0\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">npmInstall</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">const</span> path <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>path<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token keyword">const</span> spawnOptions <span class="token operator">=</span> config<span class="token punctuation">.</span>verbose\n      <span class="token operator">?</span> <span class="token punctuation">{</span>\n           cwd<span class="token punctuation">:</span> path<span class="token punctuation">,</span>\n           shell<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n           stdio<span class="token punctuation">:</span> <span class="token string">\'inherit\'</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">:</span> <span class="token punctuation">{</span>\n           cwd<span class="token punctuation">:</span> path\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> npmI <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">\'npm\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'install\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> spawnOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      npmI<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'close\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">didSucceed</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm install ran correctly</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm install exited with </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n   plop<span class="token punctuation">.</span><span class="token function">setGenerator</span><span class="token punctuation">(</span><span class="token string">\'package\'</span><span class="token punctuation">,</span> packageGenerator<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token comment">// plop.setGenerator("page", containerGenerator);</span>\n   plop<span class="token punctuation">.</span><span class="token function">setDefaultInclude</span><span class="token punctuation">(</span><span class="token punctuation">{</span> actionTypes<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'copy\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> config<span class="token punctuation">,</span> plop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> src <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>src<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> dest <span class="token operator">=</span> plop<span class="token punctuation">.</span><span class="token function">renderString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>dest<span class="token punctuation">,</span> answers<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      shell<span class="token punctuation">.</span><span class="token function">cp</span><span class="token punctuation">(</span><span class="token string">\'-r\'</span><span class="token punctuation">,</span> src<span class="token punctuation">,</span> dest<span class="token punctuation">)</span><span class="token punctuation">;</span>\n   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n   plop<span class="token punctuation">.</span><span class="token function">setActionType</span><span class="token punctuation">(</span><span class="token string">\'npmInstall\'</span><span class="token punctuation">,</span> npmInstall<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="项目级别的代码模板命令执行入口-1"><a href="#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目级别的代码模板命令执行入口</h3>\n<p>相比一期增加 <code class="language-text">npm install</code> 逻辑</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43015605420245140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const directoryExists = require(\'../utils/directoryExists\');\nconst fileKeyExists = require(\'../utils/fileKeyExists\');\n\nconst portExists = (value) =>\n   fileKeyExists(\'config.js\', \'serverPort\', 3000, value) || fileKeyExists(\'config.js\', \'fePort\', 8888, value);\n\nmodule.exports = {\n   description: \'生成 package\',\n   prompts: [\n      {\n         type: \'input\',\n         name: \'name\',\n         message: \'package 叫什么名字？\',\n         default: \'demo\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return directoryExists(\'packages\', value) ? \'package 名字已存在\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'serverPort\',\n         message: \'package 的 Node.js 服务端口？\',\n         default: \'8001\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 Node.js 服务端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      },\n      {\n         type: \'input\',\n         name: \'fePort\',\n         message: \'package 的 webpack-dev-server 端口？\',\n         default: \'8002\',\n         validate: (value) => {\n            if (/.+/.test(value)) {\n               return portExists(value) ? \'要设置 package 的 webpack-dev-server 端口已被占用\' : true;\n            }\n\n            return \'package 名字必填\';\n         }\n      }\n   ],\n   actions: (data) => {\n      const actions = [\n         {\n            type: \'copy\',\n            src: \'internals/generators/package/template\',\n            dest: \'packages/{{ dashCase name }}\'\n         },\n         {\n            type: \'addMany\',\n            templateFiles: \'package/*.hbs\',\n            destination: \'../../packages/{{ dashCase name }}/\'\n         },\n         {\n            type: \'npmInstall\',\n            path: \\`packages/{{ dashCase name }}/\\`\n         }\n      ];\n\n      return actions;\n   }\n};`, `43015605420245140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> directoryExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/directoryExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fileKeyExists <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../utils/fileKeyExists\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">portExists</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n   <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">fileKeyExists</span><span class="token punctuation">(</span><span class="token string">\'config.js\'</span><span class="token punctuation">,</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n   description<span class="token punctuation">:</span> <span class="token string">\'生成 package\'</span><span class="token punctuation">,</span>\n   prompts<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'name\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 叫什么名字？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'demo\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">directoryExists</span><span class="token punctuation">(</span><span class="token string">\'packages\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'package 名字已存在\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'serverPort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 Node.js 服务端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8001\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 Node.js 服务端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n         type<span class="token punctuation">:</span> <span class="token string">\'input\'</span><span class="token punctuation">,</span>\n         name<span class="token punctuation">:</span> <span class="token string">\'fePort\'</span><span class="token punctuation">,</span>\n         message<span class="token punctuation">:</span> <span class="token string">\'package 的 webpack-dev-server 端口？\'</span><span class="token punctuation">,</span>\n         <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token string">\'8002\'</span><span class="token punctuation">,</span>\n         <span class="token function-variable function">validate</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/.+/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n               <span class="token keyword">return</span> <span class="token function">portExists</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'要设置 package 的 webpack-dev-server 端口已被占用\'</span> <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">return</span> <span class="token string">\'package 名字必填\'</span><span class="token punctuation">;</span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n   <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   <span class="token function-variable function">actions</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> actions <span class="token operator">=</span> <span class="token punctuation">[</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'copy\'</span><span class="token punctuation">,</span>\n            src<span class="token punctuation">:</span> <span class="token string">\'internals/generators/package/template\'</span><span class="token punctuation">,</span>\n            dest<span class="token punctuation">:</span> <span class="token string">\'packages/{{ dashCase name }}\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'addMany\'</span><span class="token punctuation">,</span>\n            templateFiles<span class="token punctuation">:</span> <span class="token string">\'package/*.hbs\'</span><span class="token punctuation">,</span>\n            destination<span class="token punctuation">:</span> <span class="token string">\'../../packages/{{ dashCase name }}/\'</span>\n         <span class="token punctuation">}</span><span class="token punctuation">,</span>\n         <span class="token punctuation">{</span>\n            type<span class="token punctuation">:</span> <span class="token string">\'npmInstall\'</span><span class="token punctuation">,</span>\n            path<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">packages/{{ dashCase name }}/</span><span class="token template-punctuation string">`</span></span>\n         <span class="token punctuation">}</span>\n      <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">return</span> actions<span class="token punctuation">;</span>\n   <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="运行结果-1"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90455007977490100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ cli create\n👽 👽 👽 欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\n? package 叫什么名字？ (demo) 项目路径/packages\n? package 叫什么名字？ demo\n? package 的 Node.js 服务端口？ 8001\n? package 的 webpack-dev-server 端口？ 8002\n✔  copy\n✔  +! 3 files added\n -> 项目路径/packages/demo/config.js\n -> 项目路径/packages/demo/package-lock.json\n -> 项目路径/packages/demo/package.json\n✔  npmInstall npm install ran correctly`, `90455007977490100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="bash"\n              >\n                <span class="gatsby-code-button-language">bash</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ cli create\n👽 👽 👽 欢迎使用 rux, 轻松构建 react ts 项目～🎉🎉🎉\n? package 叫什么名字？ <span class="token punctuation">(</span>demo<span class="token punctuation">)</span> 项目路径/packages\n? package 叫什么名字？ demo\n? package 的 Node.js 服务端口？ <span class="token number">8001</span>\n? package 的 webpack-dev-server 端口？ <span class="token number">8002</span>\n✔  copy\n✔  +<span class="token operator">!</span> <span class="token number">3</span> files added\n -<span class="token operator">></span> 项目路径/packages/demo/config.js\n -<span class="token operator">></span> 项目路径/packages/demo/package-lock.json\n -<span class="token operator">></span> 项目路径/packages/demo/package.json\n✔  npmInstall <span class="token function">npm</span> <span class="token function">install</span> ran correctly</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>// TODO 代码生成脚手架还在完成中</p>',
excerpt:"需求背景 由于 C 端营销线新建项目需要模板化，需要代码模板的生成功能，以便统一技术栈 一期 一期代码生成需要在 lerna 工程下去做改造，除了带有代码模板的功能，还封装了执行脚本的入口 参考链接： react-boilerplate…",timeToRead:10,tableOfContents:'<ul>\n<li><a href="/code-generation-scaffolding/#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF">需求背景</a></li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E4%B8%80%E6%9C%9F">一期</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">目录结构</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3">脚本主入口</a></li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90">模板代码生成</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3">模板代码执行主入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E6%A3%80%E6%B5%8B-packages-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%AD%98%E5%9C%A8%E6%80%A7">检测 packages 文件夹存在性</a></li>\n<li><a href="/code-generation-scaffolding/#%E6%A3%80%E6%B5%8B-packages-%E4%B8%8B%E9%9D%A2%E6%96%87%E4%BB%B6%E9%87%8C%E9%9D%A2%E6%9F%90%E7%A7%8D%E5%B1%9E%E6%80%A7%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">检测 packages 下面文件里面某种属性是否存在</a></li>\n<li><a href="/code-generation-scaffolding/#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3">项目级别的代码模板命令执行入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E5%B8%A6%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E7%9A%84%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6">带模板变量的模板文件</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C">运行结果</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E8%84%9A%E6%9C%AC%E6%89%A7%E8%A1%8C%E5%B0%81%E8%A3%85">脚本执行封装</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E">使用说明</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E4%BA%8C%E6%9C%9F">二期</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-1">目录结构</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%84%9A%E6%9C%AC%E4%B8%BB%E5%85%A5%E5%8F%A3-1">脚本主入口</a></li>\n<li>\n<p><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90-1">模板代码生成</a></p>\n<ul>\n<li><a href="/code-generation-scaffolding/#%E6%A8%A1%E6%9D%BF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%B8%BB%E5%85%A5%E5%8F%A3-1">模板代码执行主入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E9%A1%B9%E7%9B%AE%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3-1">项目级别的代码模板命令执行入口</a></li>\n<li><a href="/code-generation-scaffolding/#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C-1">运行结果</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>',wordCount:{words:119},frontmatter:{date:"2021-11-15 11:43:19",path:"/code-generation-scaffolding/",tags:"前端, 前端工程化, 预研",title:"代码生成脚手架搭建",draft:null,catalog_number:null}},nextPost:{html:'<p>以下是本次参加 Tweb conf 2021 的学习笔记</p>\n<h1 id="目录"><a href="#%E7%9B%AE%E5%BD%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>目录</h1>\n<h2 id="主会场"><a href="#%E4%B8%BB%E4%BC%9A%E5%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>主会场</h2>\n<ul>\n<li><a href="#flutter-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5">Flutter 音视频开发实践</a></li>\n<li><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF">腾讯文档渲染优化之路</a></li>\n<li><a href="#%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%AC%E4%B8%8B%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88">远程办公下开发测试协同如何提效</a></li>\n<li>如何创造一门上万人使用的语言</li>\n</ul>\n<h2 id="分会场（看过）"><a href="#%E5%88%86%E4%BC%9A%E5%9C%BA%EF%BC%88%E7%9C%8B%E8%BF%87%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分会场（看过）</h2>\n<h3 id="nodejs--大前端"><a href="#nodejs--%E5%A4%A7%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node.js &#x26; 大前端</h3>\n<ul>\n<li>Kubernetes 应用的 BFF 便捷开发</li>\n<li>跨端开发，也可以这样玩</li>\n</ul>\n<h3 id="低代码--可视化"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81--%E5%8F%AF%E8%A7%86%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码 &#x26; 可视化</h3>\n<ul>\n<li>基于 serverless 的低代码平台实践</li>\n</ul>\n<h3 id="编辑器--研发效能"><a href="#%E7%BC%96%E8%BE%91%E5%99%A8--%E7%A0%94%E5%8F%91%E6%95%88%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑器 &#x26; 研发效能</h3>\n<ul>\n<li>稿定视频编辑器背后的故事</li>\n<li>在线文档冲突——OT 算法</li>\n</ul>\n<p>以上是本次大会看过的，下面是本次大会未看过的，仅做记录</p>\n<h2 id="分会场（未看）"><a href="#%E5%88%86%E4%BC%9A%E5%9C%BA%EF%BC%88%E6%9C%AA%E7%9C%8B%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分会场（未看）</h2>\n<h3 id="nodejs--大前端-1"><a href="#nodejs--%E5%A4%A7%E5%89%8D%E7%AB%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node.js &#x26; 大前端</h3>\n<ul>\n<li>从 0 开始，打造腾讯自研的跨端&#x26;动态化框架</li>\n<li>Puerts-UnityUE 下的 Typescript 框架</li>\n<li>云时代的前端开发</li>\n</ul>\n<h3 id="低代码--可视化-1"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81--%E5%8F%AF%E8%A7%86%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码 &#x26; 可视化</h3>\n<ul>\n<li>WebAssembly 在哔哩哔哩创作中心的实践</li>\n<li>厘米秀 3D 形象 DIY 渲染技术揭秘</li>\n<li>信息流运营场景中的低代码探索与实践</li>\n<li>低代码页面编辑器的设计和实现</li>\n</ul>\n<h3 id="编辑器--研发效能-1"><a href="#%E7%BC%96%E8%BE%91%E5%99%A8--%E7%A0%94%E5%8F%91%E6%95%88%E8%83%BD-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>编辑器 &#x26; 研发效能</h3>\n<ul>\n<li>腾讯文档工程实践</li>\n<li>微信小程序真机调试</li>\n<li>CDN 版本化解决方案</li>\n<li>由兴趣驱动开源 Cherry Markdown 成长之路</li>\n</ul>\n<h1 id="flutter-音视频开发实践"><a href="#flutter-%E9%9F%B3%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 音视频开发实践</h1>\n<h2 id="flutter-简介"><a href="#flutter-%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 简介</h2>\n<h3 id="跨平台技术发展趋势"><a href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨平台技术发展趋势</h3>\n<p>跨平台框架优势：一次开发，多端运行，组件复用，提升效率</p>\n<ul>\n<li>\n<p>Hybrid App（2011 年）</p>\n<ul>\n<li>页面运行在 webviwe</li>\n<li>开发迭代快</li>\n<li>受限于桥接层，拓展性能差</li>\n<li>webview 渲染性能差</li>\n</ul>\n</li>\n<li>\n<p>ReactNative（2015 年）</p>\n<ul>\n<li>原生控件渲染</li>\n<li>性能好于 webview</li>\n<li>渲染时要和 Native 通信</li>\n<li>JIT 编译</li>\n</ul>\n</li>\n<li>\n<p>Flutter（2018 年）</p>\n<ul>\n<li>dart 语言</li>\n<li>同时支持 JIT 和 AOT 编译</li>\n<li>自渲染引擎</li>\n<li>性能接近原生</li>\n</ul>\n</li>\n</ul>\n<h3 id="flutter-架构"><a href="#flutter-%E6%9E%B6%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter 架构</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-d7327.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.6416584402764%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACbUlEQVQozwFiAp39AKbCsKrHtbnXw2O8jjGobjmrc0GueVCzgj6tdjercjmrc1CzgjusdTeqcjysdU+0gkawfDmrczKpblm3hwC42cS63Ma+3chPs4EVn1wdomIdoWEgomQdomEcoWEmpWc/rncopmgcoWEcoWEgo2QdoWEdoWIVnl1Er3sAutvHudrFvtzJVraHH6JkNalyMqlwJKNoNqpzKKVpMahwR7B9M6lxJqRoNapyJ6VpMqlwNqlyIaJmTbOBALjcxLfawbvbxFS4fx6kWzWsajKraCSmXzOsaCanYDGrZ0uzeDWsaiWnXzOsaSioYjOsaTetbCKlXky0egDG2djL397R5OOYxtF9uceDvMeCvMeBusiAuseCu8mDu8qIvsuGvcp/ucmCu8eEvMiCvMeCvMd+uceVxM8AxMve0dnv4en9fqj7XZL7dqL7cZ/7ZJf6YJT8aJj8YJT7e6X6cJ76W5D8bZz8ZJb8dqL7dKD8Zpj7gKn8ANnl+tfj+Nrl+JK39Hem8oGs8oKt8n6r8nal816W8mOZ8Wqd8G6g8F2V8mGY81qT8mic8W2f8ViS8nqo9QDe5/fe5/bc5fXd5vbf5/ff5/fg5/fh6PbX4veVuPWZu/Sev/ehwPaTt/CYufGRtfOZuvKfvvKPs/OkwvQA6t/I69/H9OrX9Nyb8sxf881l8s1l8s1n885o+9Ji+dFj+cpN+M5d+9Vw+tVv+9Bc+cxP+eCe/vDX/O3PANvOs9nLr+XZw/PVhvTGSPPJUvPEP/PCPPTIUPLGSfLHTfLEQfPIVPTiufThtPTgsvXgsPXkvvTmx/XmxvQof41u5NlVAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 15 50 32" title="" data-src="/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-fee1c.png" data-srcset="/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-a67b7.png 200w,\n/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-0b187.png 400w,\n/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-fee1c.png 800w,\n/static/2021-10-25-15-50-32-9cceaa39247e7341a55207d0cfe6cae7-d7327.png 1013w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>FrameWork: 是一个 Dart 实现的 UI SDK，从上到下包括了两大组件库、基础组件库、图形绘制、手势识别、动画等功能</li>\n<li>Engine: 实现 Flutter 渲染引擎、Dart 虚拟机、Platform 通信通道、事件通知、插件架构等功能</li>\n<li>Embedder: 操作系统适配层</li>\n</ul>\n<h3 id="flutter--web-开发的差异"><a href="#flutter--web-%E5%BC%80%E5%8F%91%E7%9A%84%E5%B7%AE%E5%BC%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flutter &#x26; Web 开发的差异</h3>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-7f6f5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.05726872246696%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB20lEQVQoz42Rz2sTQRSA9+R/Id78K7x4E7x48OTNIoIHtUdBxJO9iKJY0dI2WFBbYoWEWMSKqbEmbcQixUo1WROzddM2G5Ps7uzOzHszO76QUIOnPoY3v/ge75ux1CFCSskY6/V6vu9HUQQAg3PrMDDnPAgC13U9z6Mq/8MShEQBSJmDGt5JVBEo2scSIwFSAiIekP9gMwjVHwoVF1wIoVEaA0YLk/QXnMd0SAqUh7DWCZdsufJgafvO6+/3M1sTP/aLmqokkKuzs8utS4XWWL514b3XjQEEZywKw5CaJ3kr0YaJ3lT5/MO1c1Plsbsfz6w30iahNvDepn9k2jk+7x576h595u4xQB77QT+Ip2yhojbRj1vtcMcLdjpRk0OolNZKBQJqvqz+4dWO+B2SsBo4H4SllSZDBBLUktNkQGKiNACSndFSiVgDNyhx5KmGztlvE/Nfrr2pTKY3r899vvrOnin/ms3a9omMd3qpeWW1fTK7e+rVbqoav3TouZUehQu1J5mtW3l7Ord9e/HrzbydKtZnN/aaF1eD8bXOjY3gcqk7Xuo+rvCcC4kmxxHYbn96W31UaiysOy9WfqaKjeeF+hz9cdrBBQdmanLRwbQDkxXxYR/oJ2GE/gu7w1Ief7LcKwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 15 52 08" title="" data-src="/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-fee1c.png" data-srcset="/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-a67b7.png 200w,\n/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-0b187.png 400w,\n/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-fee1c.png 800w,\n/static/2021-10-25-15-52-08-c6fd3ec37ce2a00650ebb9e2625b5df2-7f6f5.png 908w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>StatelessWidget(无状态)：内部没有保存状态，UI 界面创建后不会发生改变。</li>\n<li>StatefulWidget(有状态)：内部有保存状态，当状态发生改变，调用 <code class="language-text">setState()</code> 方法会触发 UI 发生更新。</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15443973167417190"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.grey {\n   background: #e0e0e0;\n   width: 320px;\n   height: 240px;\n   font: 900 24px Roboto;\n   display: flex;\n   align-items: center;\n   justify-content: center;\n}`, `15443973167417190`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css{6-8}"\n              >\n                <span class="gatsby-code-button-language">css{6-8}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.grey</span> <span class="token punctuation">{</span>\n   <span class="token property">background</span><span class="token punctuation">:</span> #e0e0e0<span class="token punctuation">;</span>\n   <span class="token property">width</span><span class="token punctuation">:</span> 320px<span class="token punctuation">;</span>\n   <span class="token property">height</span><span class="token punctuation">:</span> 240px<span class="token punctuation">;</span>\n   <span class="token property">font</span><span class="token punctuation">:</span> 900 24px Roboto<span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">   <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">   <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71227734749266210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var container = Container(\n   child: Center(\n      child: Text(\n         &quot;Lorem ipsum&quot;,\n         style: bold24Roboto\n      ),\n   ),\n   width: 320,\n   height: 240,\n   color: Colors.grey[300]\n);`, `71227734749266210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js{2}"\n              >\n                <span class="gatsby-code-button-language">js{2}</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> container <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>\n<span class="gatsby-highlight-code-line">   child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span></span>      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>\n         <span class="token string">"Lorem ipsum"</span><span class="token punctuation">,</span>\n         style<span class="token punctuation">:</span> bold24Roboto\n      <span class="token punctuation">)</span><span class="token punctuation">,</span>\n   <span class="token punctuation">)</span><span class="token punctuation">,</span>\n   width<span class="token punctuation">:</span> <span class="token number">320</span><span class="token punctuation">,</span>\n   height<span class="token punctuation">:</span> <span class="token number">240</span><span class="token punctuation">,</span>\n   color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">]</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="trtc-简介"><a href="#trtc-%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TRTC 简介</h2>\n<p>腾讯实时音视频致力于帮助开发者快速搭建低成本、低延时、高品质的音视频互动解决方案：</p>\n<ul>\n<li>适用于视频会议、在线教育、互动直播等场景</li>\n<li>客户有腾讯会议、企业微信、陌陌、贝壳找房等</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-19de3.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 84.22198041349293%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACLElEQVQ4y1VTiZbcIAzL/39ld3a2k5uAMZc5Kkhnu/UjvASwJUtk2jl+kCwux1y8ZMm5vKO12vDUWn4EvtsIEZmUNvOyKHUF76XUgrNj10j71EErFULEJ2piTqWuPhtjvPc558lYPo7TWsZwITofkgiwjI87OTLaOQeQgdkkl916MuRxLKVJGZrnBR/GkEVqTLlHYXYxeMzsHHDKoISiIIjFlKQnc4jI0Npg+JR6x7nUd2M4d9Ouf3M7+ZgSW+ci92ScIHYGEEneye3lMrEnohjjd1oq7cViycbYsSeTMuVWasOm1C4MoEDyZeVQ5ro0tEAmqKP5mOsXxfNUo2eZdsO/fq+9XzQschuFpmM/jKVgmQGOikgAAayjXBoBte2+rlCLe38RNZA5eFa8pMH5jrfnVSThpft8XPrj8QmfiSxcAr1vtRDQGQjt/4CX4Nx9djFBUMw4FYB5CzsuF3QD7TwWfwbEwiKyp92lI1Wo1QUD1a50wyz3qH0rjXc0o6I8uJD0aj4BWcpz3q7L3H5CjP04y21OzjwCzKV0JTT7r0Mvx4lFXKcJDC6l+g3xAWJYa49ToSeOsjlZDK/kN04aLrXaK1EP+MDOTxHIz69t25k92Bzn+Xg+g/Onl9nG134ocsqn2Ql4veZl3VbqvjptaIo5kzb4LW6m31KjT52qSZVyvWJh6bJt+6HVBUdCCB3ZxqSJYFT/TYbF9yj1X6Bov/StLduOcShcPKMt/wFa490YfBAwSgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 01 10" title="" data-src="/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-fee1c.png" data-srcset="/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-a67b7.png 200w,\n/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-0b187.png 400w,\n/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-fee1c.png 800w,\n/static/2021-10-25-16-01-10-67079cbaa26914a3b23f85a9215f60cf-19de3.png 919w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="sdk-设计"><a href="#sdk-%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SDK 设计</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-8afa6.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 73.08120133481646%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADU0lEQVQozy1RWW8bVRQe3uAJwQuviEXiBSH1BQE/oA8IIbEVsVUCpUUsogW1D0AgtKLgQiChEZVAaRYldpS6bkMqN3EWO3a8e9zGju04tsdL7IzHnvGMZ71z584M12mvzj06+o6+7xydj/jOs9/mVVkF0f1uoSmIihYvscWWwEtaimLzB7wK9GyjlyizJbrf5GTcxbggayZCxPv/7tK8JijQ4aVukm1ehqMr1O17DCfpV/11D0kDw5yNtMZ8Vd9uN0EJv61QExs1WtBs2yY+mswe8lq9q0yFDu5kO0Vamgk3vTsdf4Gbj7amw817DTFY7GFwNtLMNkVPmpmLHioADshnXPuspJcZaTJYxwNzLfFaqLaUPlzJMLPhxj9btVilh4Vmtg8mgwd3a8L1JD0dbknaERl/vD0OXNiWaSLDfvCso8DJskwMmvf7toUGDMPAQYxufs5w9cXU2PDyCWd8FEGUqKwH95aKrfROfXsj746XV7HI6u7898snJsMj1U7h0p1P5uKXkaIR33herTPFK4Hzpxde+cv/NZZeybnc5NVULRDYvzUTddzOTOOZrtSfp1wv/+IbKtDkOc9rE4HzSB2Qj1fbe1f85065Xhr3n8U7+vLOG+m/U/UNsubHxVredZ885Hzx0urHBTp51n18bPPMYPIfW9+22MZ1cuIn74eL5LiBkC/nvpWeSlCbiYp/6e61jfwNvPZ6YXHEe3Iq5qhzZcfaF87UuKkCwuglezzL8wCoNtRtVbW7LOJ5g+vbojI4GT6aDi0IkKHKUGGh3IEyq8s9Q9cJFHwE9IuA8aPsm3rhU5h9B1EXdJlBufeM3bdBfghm30C5D5Blm9SwHXjIjD1jhR+zYk9ZeoeA2deB2FQYUtkbVkqXlb0f1dqMJvdAxaGVLmqV30Hpgl5xQNM2qj+j7ceN5Aso9qSRPGbpXQIBHUKEsJdHVppH5gLTgtYDowcgri3bUPtarwm4OuAaQGhjzwnRO6r1WdCpqrEFJf2fEl8AxRDk20pkTk26FfKmGp1Xc+v44JRzJPTuo7GvjkWGnk58+TwQOkR/+VcocoCnpcyaVAhJmXW1tqOLrJRZlXN+Kb8lZ3xyOYnJlfkfAm89HDn97PbJJ2KfPacLnf8BfMPfNgB0rAkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 09 19" title="" data-src="/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-fee1c.png" data-srcset="/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-a67b7.png 200w,\n/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-0b187.png 400w,\n/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-fee1c.png 800w,\n/static/2021-10-25-16-09-19-12ddbad841af22653bb223a4e90d35cb-8afa6.png 899w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>业务层：提供给开发者调用的 API，如进退房、推拉音视频流等近 100 个接口</li>\n<li>实现层：管理 API 的核心类，可扩展、易用、性能好</li>\n<li>通信层：通过 MethodChannel 消息通道连接 Flutter 和原生 sdk，数据通讯能力升级</li>\n<li>原生层：底层是 Android 和 iOS 原生 sdk</li>\n</ul>\n<h3 id="挑战点-1-如何实现复杂的类结构体传输？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-1-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E5%A4%8D%E6%9D%82%E7%9A%84%E7%B1%BB%E7%BB%93%E6%9E%84%E4%BD%93%E4%BC%A0%E8%BE%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 1-如何实现复杂的类结构体传输？</h3>\n<h4 id="背景"><a href="#%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<ul>\n<li>flutter 本质是 dart 调用 native 的接口，并异步返回 native 的数据</li>\n<li>原生 sdk 存在着大量类结构体的类型定义，原有消息通道不支持传递此类型</li>\n</ul>\n<h4 id="方案"><a href="#%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p>Flutter 类结构体 -> Flutter 类结构体转 Map 对象 -> Flutter JSON 序列化 -> 通信层 JSON 反序列化 -> Android 类结构体</p>\n<p>同时可以对参数进行约束，类型校验，提升易用性</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-c3000.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 775px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 18.322580645161292%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAwUlEQVQI1zWM7Y6DIBREfYzdkBotFFCBslfkXvlQ06bv/0pLNtnJyeRkfkzX9z1jTOsJMaVUQ4jbhgAhRkLcUypECbE5xYhtqfWo9bT2Oc+mG279jTGl9HVeR6k1l5xybVJqzoWQUsr7non2xrqG1u3dewBYuy8tv8UoJ+PwpaBoyGY7f/BYtsOGoj0ZB9Y8rfUN5/yyWCm11rNSUxffL3pf+fq49AGI24qjsoOYBu1GOY/KcKH4f+53Lv7CuXg85C+O5i1gCZ1L7gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 22 25" title="" data-src="/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-c3000.png" data-srcset="/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-84db6.png 200w,\n/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-07229.png 400w,\n/static/2021-10-25-16-22-25-9a5d88bb07ce0bfde0769c96c8288dcc-c3000.png 775w" data-sizes="(max-width: 775px) 100vw, 775px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="挑战点-2-图片怎么高效在-flutter-和原生-sdk-之间传输？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-2-%E5%9B%BE%E7%89%87%E6%80%8E%E4%B9%88%E9%AB%98%E6%95%88%E5%9C%A8-flutter-%E5%92%8C%E5%8E%9F%E7%94%9F-sdk-%E4%B9%8B%E9%97%B4%E4%BC%A0%E8%BE%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 2-图片怎么高效在 Flutter 和原生 sdk 之间传输？</h3>\n<h4 id="背景-1"><a href="#%E8%83%8C%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>直播过程中给视频设置水印等接口需要把 flutter 项目定义的图片资源传给原生 sdk，但是 flutter 没有 bitmap 这种数据类型，如何把 flutter 项目的图片资源转成原生 sdk 需要的 bitmap？</p>\n<h4 id="方案-1"><a href="#%E6%96%B9%E6%A1%88-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p>利用文档目录实现图片传输，通过文档目录（android 和 flutter 都可访问）传递文件路径的方式来实现共享</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-b043c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 539px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.05936920222635%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAIAAABPIytRAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADTUlEQVQ4y42S7VPbRhDG9T9n2o+dNG3aNP3StBiKU1IwHlw3ARtIMBDSlgIpL7YlbL1ZtmxZlixL1p3uTjaySWL1ZAcGHKbTnWdu9mae3+3e3jFbR+azV3oiF2lpK1qfvdTzgkWwBwCkIhie8Z2V18bvb4zUbiv12kjv0dzM/dNm0m/MWMaczRgza8Zc1lh41Y5vtg+5to8j0gWwR+DOW/OLBW02ayzvWIs566fV1sNEM76hM/SwH543Z1b1H1/oM2v6XKb15IV+wJo+8a7h3WPjwWKDGn5eb82vR/5HSW3hZZNRGjYnW2Wlw0oGJ7dLFYuTLN10kAcBjESTRsspim1Wap/x5mmpxcoWK1lircP4BAUXftD3aaleDw1ofuEjz4M3AiMY9Mlw0L/oYZ/AYdAbBNSPmLZlCYKoKFXu/FwUJZ4X6Eob9m4ErS/LFY47p85SqUwNdLVth7EsS5blWq3GU04QyuUyL/C203G69mSdSFEUjuMmnkqlIoqi4zgMPRhfBe0w2noEusgD2DJtx+oigKPtuJXoChiTcdAtQ/fgKmjqQcQZh4fNzbf61l9qdr++TpOD5kbV4umh1043MkPm5mDop8CQ7KgrCfnhujqf0xapsurckvhVXt/3UZ9SUXHvo+6Ad9VUUv42U5vdUOOb6tO1WmxZ+qYwgenDA1A3uqrhUt2CJ23X2kK5dULFNg7ZxlG5dUql23XkIerodl2u6uSrsFAFU3B0f+IHhukWi3Ty1XyBDlhBOPAQGX+ZKNyrmK4MIEIm72nHUDu2lX1b+Rs0TlDzBHbqMKoMxi/yUdOwC/0B/0t49nnIfR2Wvg9Lj0P2y/D0M6LuAnwBxwO7jjvgofA0PL0Xnj8K5fhIjIXF++HJPf//wABiUt0eiImhkg6k5EBOXVafD6Sk1yxA5EMA/gOOcA/5umlLSl2qqAWWz7NlUVYR8sFt8i44GggyO526polyRZBkSVFUTfPG7zQNg9tlXYTJUW64tfhu77cglxjsJN//kb7cXvL4M0g+aTv68hB61zD2g+3lcOnBKBMbbcyPNuOj1Scffr1P8n8Cvz89sLzumg7ouKDrRj+ki0l/L/0h9fgyM3uZnXtHtRZ7v/IdLh58Cv8LBY18GnwwtfoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 26 16" title="" data-src="/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-b043c.png" data-srcset="/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-e7723.png 200w,\n/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-61f03.png 400w,\n/static/2021-10-25-16-26-16-4fe8ab541c3bc494fe0c5301305f0c32-b043c.png 539w" data-sizes="(max-width: 539px) 100vw, 539px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>带来的问题：拷贝文件会导致比较高的耗时，如何解决？</p>\n<h4 id="优化"><a href="#%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<p>图片传输优化-平台共享 asset：Flutter 的 asset 资源被打包在原生资源包下面，通过 AssetManager 可直接访问，节省中间层拷贝耗时。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-6a7be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 524px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 112.97709923664124%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADVUlEQVQ4y4WUC1PTWBTH8513v4DKoo4PUMYVh10ELE5RsJTS1kVnLEvaLVKakBaSNEnTNu8muTePPpxBmj1JRwcUhzP/ydw79/+7955zkhDr/yjpj4k+xFor9khaD3zkurF8D0s9e3tf3d7Xtj6pm5/Ud6V4vHOg6aZNLLxTF7Pqk03lWUZdymlLOeN9RQ+8mHRcFAaY4c3bK/KjDWU5r68UjcWsdjfVvZfqdFWLeJjuAfl4o/d0U1nYUubeKLuk9v3kKXxntf0g3fszo77Y0cAzm+rcWwe4T1RorcroZUoBHTI6SamcZHkYuSiGYaDoTuXEqNAGSRulmkJSBkyrjGH1HWI8DMajIPQR6MsoHA/9wMfoUmCMhgP/yygA+dgBA/iHAw+WCFGSOp0uz7f4ltBuyyDHcdBVWlU1luMlUeLhKbUFUVI1HWNM0DTNcVy9Xj8+PqYoqlarmabpuq6ThG3HG8kdmSTJqYdhGPCIouh5HhEEge/7MHKTwMh3bQ/ZXt+wTc3CjudaGDlwDI5XMQ6SAH98bfdbQIEw8tomx6j/NfXPNXn/qF1q6ocNtSoYTbj9NInEOc0GE99Tg9YEOCx386+4P7aEp1lpcUd6sS0+T3GzH6Q07BtbkoBspvoRJru7K+ztjPCsKK8U5OWctLTGzexJrwEGA1TetGxatGkJga7AHvab2lGpnako+X87WVC5ly/JmXrvACfXBrhvO6zcZzsOiLjSFeT6Xogcv8mwPCs26LPTBg/TwBtcNsGbM9UPcJyRZRmi2Gq1OJZtCgJvmjo0Dl0Xl2FoRTgQC+f1uxfNhXNm/iszHw+o+wN2w71UsOtgaII3GAtb0effInomar2M+L+ik/vR0e/j079vgpOTR0JuUr81YR5eMHOTxlzUeAQbjdj1G+GknLaGNL6vcLbCKgKtSozebmCre2POydnBULXxCStQp3z5iAIdUg3bC/GNBUPYwx0hPKsNeBoxVcQcjoSTIUd5Eusi/EvYnRYsCEfl3cnana9v5y82n4DO385PXs2M9l67+Bc5Q7vh+8fx/y4cVwpRamaSfR4VX04Ky5PdpWh9dvQxfT3M6i5vuGe6Y/QdC/u4fjDOr6JCqp9bxfm1oJgaFFaD6l78Wv8U/wNv0rF+PKeJuAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 28 34" title="" data-src="/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-6a7be.png" data-srcset="/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-88dc0.png 200w,\n/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-98f22.png 400w,\n/static/2021-10-25-16-28-34-52ba8eebd218a85e7aa02bc185cb434c-6a7be.png 524w" data-sizes="(max-width: 524px) 100vw, 524px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="挑战点-3-视频在-flutter-里面如何渲染？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-3-%E8%A7%86%E9%A2%91%E5%9C%A8-flutter-%E9%87%8C%E9%9D%A2%E5%A6%82%E4%BD%95%E6%B8%B2%E6%9F%93%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 3-视频在 Flutter 里面如何渲染？</h3>\n<h4 id="背景-2"><a href="#%E8%83%8C%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>采集视频流 -> 云服务 -> Android 原生 -> Flutter</p>\n<p>将摄像头采集的每一帧数据通过 MethodChanne 传递到 Flutter 中，性能消耗大</p>\n<h4 id="方案-2"><a href="#%E6%96%B9%E6%A1%88-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<ul>\n<li>外接纹理：可以将原生端 opengl 图像数据共享给 Flutter 进行渲染。需要原生 sdk 提供视频帧图像数据回调接口，实现较为复杂。</li>\n<li>PlatformView：主要适用于 Flutter 中不太容易实现的组件，如 WebView、视频播放器、地图等。给 Flutter 提供了嵌入 Android 和 iOS 平台原生 view 的能力。</li>\n</ul>\n<p>最后采用 PlatformView 方案</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-c7bf1.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.51643192488264%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADVUlEQVQoz02Q+U8TaRjH56/ZHzVrNGuy6q7XqlFwN6DimdVVVuMBUQQWYSnHGlGjrusJitYgSlC5jLuIdKQt04PS1tJzSlvoDO3MtDOdztFjOtPuW7rZkHzy5pvv837f53le6B9P36D9Lkra4jzxzvFwxNm9kjHX0zHXE8Coq2eF3/Nu7oHGNwi9cfzVY2qeixooDu81t6ktf6zg6ivbzde2WwP2O/22G//7LyxXe82q4bluaNj5uM/a9SWiLxQKFB+NC2RcIACxEnwUZ7FFZh5PhEC1ZJYuMEIMGpp7pLZ0OiKIlMt4SQtK2fyUzUdZveQswE3MBONu8G5OlvyUw0NavKQVLV6YDcXd0Gv7rYeGBhAmOOyBob7b1Pxspv35TId6prPX3H4fqX/ruA/CQjYJpu02XgE+EI+MjYP2P6EQ7fJRFkYk05I4H7cHaEeQdqCUHZwhxgkcnPWDsKxIYdYTZBz+WJEA/WWR8UKZTCGdLuRyBUUpAF1CTBWSfD6WUEoizmYYLksxcpxVBLFYXU7loZNdpq218JAW82Pc3ib9vt+RZaYrW6YrWvRVKuRIh+Foh/FAq6Fi2QGl/a1I+W/6S/esUEUzsvrEp/6JMBrmttRod9bpd13+jx8uassap/e1IgdUhvLG6R2XdDvrdMDfXa/fXKM9c3MWAn3WnJx8/iEEFgsTwlJMxEkxFOVDEd4XTiwQQrAouMASh2IsMAELUQGnRIIWoSqV4dszmr6PCySTan3q7FS7r/d7rr103+j3dPV5VL2uu4NoTlbEtHx7wAeqwAe0PXM9HvFDh9qMG8/BAxrMGWRX/Tyxrnpy03n4u/Pw9xfgDWc1q49P7KrTCekczWW2X9SuPTW5uQbeVguvOj4BukKVLcjXJ0pj59HFZBDn5rGkdyGBhpMBnAtg3GKEl2UFNAdLBZeKKwCAwEgeOthmXH8aVhfDcoxJMWyRGCPSy4JOpBLJlCxJSj7PClmWl2guC6ZI8BLLZ6Dd9bqvDo+/+DvkCtBrqzUbzn3e06D7sUlX1gh+XruuWrO3CRGENMNl9jTov/lV89OVYnXNL5+OdZqgj+bom88YGJJmhKGp8IgOG13B0BQ2blrKZrJZSRk3E6N6/D0SAQzrcNhK/AsAutU/l93RMAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 37 14" title="" data-src="/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-fee1c.png" data-srcset="/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-a67b7.png 200w,\n/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-0b187.png 400w,\n/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-fee1c.png 800w,\n/static/2021-10-25-16-37-14-ecb6d7764254347320a2663a499688e8-c7bf1.png 852w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 748px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 13.903743315508022%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAiUlEQVQI112NXQ6CQAwGuYURoe1uf3QRdFcJEQm8cP87WROfTCbNfH2ZivpnXfKx5MNY0iMrcwsAoSVGJBfAAICAEb6fgBh/+KyoLN245Nd6n5Zt2/Z9n9/zMPWXUdNk/ZocyxKMZGBOkbuoV3bXG1fEHuOzqqmoqoiYmYvXSCgo+fV4c2r+qZsP0NIajIijYeQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 37 41" title="" data-src="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png" data-srcset="/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-24e67.png 200w,\n/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-f22f2.png 400w,\n/static/2021-10-25-16-37-41-2bae29e5748990b8c512d1db84b19dc3-a3e5c.png 748w" data-sizes="(max-width: 748px) 100vw, 748px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="优化-1"><a href="#%E4%BC%98%E5%8C%96-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<p>用 oppo 的一个低端机进行测试，房间有 6 个用户的时候，第二屏画面渲染异常，使用 PerfDog 性能狗，分析出 GPU 占用过高</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-e0b49.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 21.508588498879764%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAmElEQVQI122P2w6CMAyG90SyMjbaKQE5bGAB5dYbff+nsBkebky+NM33N22qDI3gZ+1Z/+rs6q0K94YfZ36a6pqJJ05pGjjOgCOUvbKejV8BA2BMjALWN2y2DOPBdlqkHNjTT6PpomlS9rQaWsC14PqdvByEzLayG8rh69+IdB34i6sWVXguiHMMOcZEMBTll2T+EvfG0PQCNms4TQPiK4EAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 39 51" title="" data-src="/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-fee1c.png" data-srcset="/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-a67b7.png 200w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-0b187.png 400w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-fee1c.png 800w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-b1a91.png 1200w,\n/static/2021-10-25-16-39-51-c55472e40a33fc6b36ab51e21e8d03bb-e0b49.png 1339w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h5 id="列表懒加载与回收"><a href="#%E5%88%97%E8%A1%A8%E6%87%92%E5%8A%A0%E8%BD%BD%E4%B8%8E%E5%9B%9E%E6%94%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表懒加载与回收</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-29486.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoElEQVQY0xWQXUvbUBzG82FkH0LwbrBbX+682mDgjbd6p4zhN9iFIiiKOhzD6qZYcJhCM6qNbanWujTvpzl5adJ4kiYnaRubs1P43fwfeHj+z8Ms/9Tn9qT5E2XhuzK7K30sAEII3Pktb+6rW0cU5ctB91uBTMhC7Wrm9uBDpTBb/vGOPXx/V2A2/sCVC32tCNaL4PM5+Mpa1Oyclbvbv4y9a2P/2ti9tE9ZkpP1F26xernaZD81bpb4q9WnEoPiUYDfEJ74UeYPxvTM8zwbJBMqhVPeUDwOcZ6TME3QEPtDjEZJQEkxA5xAUO2WAFToQxfrdpATElquJSiOpNmi6slgYLo02UTeC5A7hvYPqC2lo7k20+0F9SeR5fjKQ0vQHO81om+bklply42/d48VvsndOwBOh3jt8+3Hcu2eq1e5Oq97DtOPMt0K2iJ8Fg3dQjedsG5ibPeMtkjDe5IGBdks1RLJ7I9TxYFtXRagrvRML40YN0i9MPPjyZQoO254RSkgMe0c57Qzikk8RKVm+NDxx4mbDPwR7g9jN4lcHP4H6A9hYe8NPHsAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 42 26" title="" data-src="/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-fee1c.png" data-srcset="/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-a67b7.png 200w,\n/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-0b187.png 400w,\n/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-fee1c.png 800w,\n/static/2021-10-25-16-42-26-41f4469cea2caafd3407076b731cadb0-29486.png 1106w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>列表优化后 GPU 占用从 72% 下降到了 53%，视频画面正常渲染显示，优化完成后的性能检测如下</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-1ef31.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 36.72275054864668%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAzklEQVQY011QCW7DMAzz/785bMWWpmnWyIcuj7LTYhshGDIZmVTSuq6q6u79L3BvLK1WqGb2X/UOMqGDzMxoMtGyfNVSpuwBG71dl6U8+XF6ay2G8QaGRe3I9Xq7H1SYFVeOcvjXJrf7fuQi6qVyE6iBhDGfFmZ+RnIknSQYdGrTPxA72Pl92rbttbOIEGWcr91seEAkot/8xLlza7EzPfbLx1um7+Gj3cWNUd3k8/J+PPZhLz0qsqQZBq+a6fjHMzbcbBZ44BkbFxm5I/0POimc6lSDSiwAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 45 55" title="" data-src="/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-fee1c.png" data-srcset="/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-a67b7.png 200w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-0b187.png 400w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-fee1c.png 800w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-b1a91.png 1200w,\n/static/2021-10-25-16-45-55-bc8a329a24b061d594d45520411e77fb-1ef31.png 1367w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-ef045.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.60795454545454%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoklEQVQozz2Q307iQBjF52nMblsKrcCIVCnVdlqUP7aFMqYluopSvfDaR1yowJqs9UKNiQpqIYHwAs4UNPnl5OScL/mSA6IoensbWc7JllKVkU1RTaqaVVBNo+JV66eo4qKyu2M4Bc2StdWNgixwfx8+PD6pe5hJq8kNg4c6Dw0+tx+zl4AGl0VJqEOlIUpVnhxQSgmoC/l9MJ/PR6Mx+fOL3+JEmcAKMicUOLHIUmSWhtQwQoEluUBvGEFO5UpgNpuNx+/H7auDxomNz6xm22qeUnDbJsSemPrhGWntZYjbpvOHVGA6nU4mk8Hwttvr94JBTL/Xo6Yb9G8Gt8N//4P+8G/3ZlUFq6obDMBisSCb1epHAtyFkpHN65m8no1JbyJJqamlQ63SyhdrP3nmW0EYhnd3YdlssendVE4n2yQ3iCKqZJusxkOU2a6lpUocou9KT22WweTz4/XlFZXxWkJi1xVGLDLiUldw6wrJfwvysmJpS9hJZBB4jmajj+jy6ppMglu+4/lN7wJ7PqaGQn3rokFNp+l1TNe3XR+7Hcc9/wJJQNFIrRGrWwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 46 25" title="" data-src="/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-fee1c.png" data-srcset="/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-a67b7.png 200w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-0b187.png 400w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-fee1c.png 800w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-b1a91.png 1200w,\n/static/2021-10-25-16-46-25-d696727196691bedf519f9a90df0f110-ef045.png 1408w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>由上图可看出，cpu、内存跟 Android 原生的占用差不多，GPU 比 Android 原生性能还差约 15%</p>\n<h5 id="视频帧直出"><a href="#%E8%A7%86%E9%A2%91%E5%B8%A7%E7%9B%B4%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视频帧直出</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-0204f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 70.8478513356562%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADL0lEQVQoz21RWUwTURSdaDTGDxJj/DLRD+OXMYoa/RCXaNCgMYIhQqGKIpGgttqigksUUCOBUFoWFYwRMCoYo8ZEwc7Q6QJiqV0U2s50ujADbadobTt0w077nFHjly8nJ/edm3PvffdBolbjfqnmrW7G6g4drtUV3Rw7euPjb/CBoG5M2DBWUv9P5HVOzLuo7Rt0Q4L6T+tPwP0IZSFC2yqHd4s1u0RqjneK1Dln1fuqtYev6A5e1nLXHefUHO8Sa/Ze0Gwsh++/dkLCW/otFUjfoAeADE5FXF7GOcNgVMQ+FZ5wBR3TEdtU+KsrPOkOTbiDOBnBpsLEDENMR76FE7x50ynkKUz6v8dv99ianmGtA3hLv51jWT9+q8f2DCYBACQda3xil/VjsgFM/gKvf2xFjQHenF2ODKgoMx7MPjGYU6Xcdx7JPY/slyB7RcjGssHTjWMApA1WemvF0J5zcJ4UyZMOrxO+63iJQaUN+uxTw7382ADzsc4A6/Cz1pmfdl8K96cwb5IMprhUbD6D+1mc5lOcjtPp2XAKKrujzzmD9MK+DPUZby50KUrccoFLISBaiwhFqbOz3NFWNtEitLaUOmRFRGuxU17sbhMSjYcCql7evL0KfqKajZrffjgAoQULVfkLOEY5LlyiKV2mFmRphcs1xVlowSK0YDF6ZDFauFSZC+GPLv0d+/F7D8gko7Q/MUtziNPeGO3j4fOGKE/IM8mQ1jnKHqHszLQ97sXnSGt81ssvbHMF3DvkzTCTNrXIoZMQI9VOfR0+WoPpJDa0ivzSyb85lWFSIMaCWBokMoDldvgz9eerlH3KQNyrRNpXaLpWartXj/Rs0D1aq+1epepYZn6Tn86AH8zc93A0xMTCc7FINJ5IzKeSSej4nfGtlaqe926uFptOAJDkkGYZrtmfGIB58L/Dcp3zr46uKR7izAQVOnbbcLrZJFaYqzst0nbLGZm5pGFc/oIg6ejJu+Mn7xrEcqO0w1TZ/LmoTj8Au6Hm55hYYdGYA7gneLbFIG0z1t4zXe82X+8y1XSaqprGu145KB8jURglbaZrDyw3Hlqq282VTYbXqOcX4CtIago4HQQAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 47 42" title="" data-src="/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-fee1c.png" data-srcset="/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-a67b7.png 200w,\n/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-0b187.png 400w,\n/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-fee1c.png 800w,\n/static/2021-10-25-16-47-42-a61b0c7bbc51b6faa8a7381d9d502c7e-0204f.png 861w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>性能消耗点：视频 view 的每一个像素流经附加的中间图形缓冲区，显著浪费显存和绘图性能</p>\n<p>优化方案：将视频帧数据直接输出到 SurfaceTexture 上</p>\n<h5 id="图像纹理共享"><a href="#%E5%9B%BE%E5%83%8F%E7%BA%B9%E7%90%86%E5%85%B1%E4%BA%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图像纹理共享</h5>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-7e9bc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 74.94089834515367%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACt0lEQVQoz31S7UtTURi//0cQRP9BBEEUZvWpPiRhSPRChBUSakFaabpejGb5wcIyRIUgbepwvSi56abztc1YGTa1NbfrTffSnLt39+3cc849nbMRWVQPzz339zyc33OeN84XcTV7LnVM32qftnRO36b43bJT1sWnEzXtUxbqbx2/LqS/EkKMbEqd6VZm7Yq/T515ATNxzr3YV+U40ugsu+8qezB8scpRNLzQI6lpy+DJe87zVueF+oETi7E5SgaZuDT0UHS3ie5W0fkIpASOEJMqwjCjKAAaedMkJsYmRBBAaFJADdNkHyHYJIj+GDA5RHnQ1AFKiZqiIwRNhMzcNRYD5QCiZHoaGoyHQCykrYUoQLrCdbmi+yu9pxp8pVb/6Qbfwcvjba/DucCUTDPCEGFFBwATI72W7asVX94RXzVI9jqQiHDeD4n6js9NtqXGrmCTbdHSGXT5Y5QMEU0bA4gyspbcyKazGtRVXfgs81TnNSGINJnDGBNWIV6XVAMiliyzcmX9FFYt64OpE7KOmBq5vLjOwfCO0pGimsniuqmjtZM7z7lb+kPAgN0jfI9nxebmbSMrQlJmuWgyiAa0SEBdDlAAVYnzB1PN9lDH4HLbmzA9m+1ffAspISEXVowdqvIervYWlo/OzCcpWV9flXprxP6bTHtvsJp1AGXVyKpGWgKiYlBMnwUGEpJqNCZHYrKQUGXNoG3XNU2JR5V4RE9G9e88pN1+4ghtK3m7r2L0QKWnoNyz/fiQtWuB1fl72XkPbQ/ObwJhU+Q+hTeeu3jH+GrvmNDv/dY9zAeW0vlRYTaqXKd+RTA3KeHy+/CH5J10ThqA5N/CrXmezV7ZNWct/thYMmc99r56Nz/wmPExklSdDvl/5JWBlokzW/zVe/zXCvxX906d3RrquUvfhXRp/5bUZvkBmdwGtUM7JlcAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 49 34" title="" data-src="/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-fee1c.png" data-srcset="/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-a67b7.png 200w,\n/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-0b187.png 400w,\n/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-fee1c.png 800w,\n/static/2021-10-25-16-49-34-e5ed70809964fc1e062e943f83680a30-7e9bc.png 846w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Flutter 与 Android 原生共享图像纹理数据，优化后性能检测如下</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-35f69.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 736px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.82608695652174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByElEQVQoz12Q3U/aUBiHz5/hFgO1sFIYChX6pbanfmTeaCnsbhdiYDizRYpQCzUQpZ1EY8LNXLaLXWzXkyIBvV52tT9r7yl+ZEuevPm9z+8kJ3lRsVx12mdHrW5lv17aOyzv1YBSxdz/0Kzbbs06ffuuXib+CTDF0sFl/zOiWVnZKCyvG4k0ZhcUNqWyKcymcYLDyexGMrNOViIVNq0FGcfTGp1Y2q3UECe94rGRUXQB50QtL2JD1AqiZsAqqIAuQlgtCKuvQRJwTtKMrJo3Gx00E05F49JcTKBiPMUIFMM/8F9+WuHxbCSzUzbRz8H42p/AHAwnw9Hd8Aa49Ud3/s3EH04G/hgmkaPbxxbCtT/+9fsPqtsnXq/v9vqd0wu71bUdF4D7dbqXZxdXH88/Oe3eVBIfzOax17BPvn77gZ7PcTLeWlnLpfi10ItsmOGnUDGBjsvz/CZAs1KY+ad6RnFviu/RgrCZVfTFle2Msg2X49UcrxqPCMTogdTvWwwyv6jmq3CwEM0xyeVoQo7EJTog8gDk6MulqYTPpwSVHGLE3coh2jlom03PtN1Gy7UIXq3pmna3Gpgjx7PuvWs5xEBLptW5+vL9LwSfyvEc/AauAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 50 37" title="" data-src="/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-35f69.png" data-srcset="/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-0149d.png 200w,\n/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-cfc3c.png 400w,\n/static/2021-10-25-16-50-37-7b0241725cf80ad927bd8fdf27c28f68-35f69.png 736w" data-sizes="(max-width: 736px) 100vw, 736px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-0506a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 470px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 94.46808510638297%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADHElEQVQ4y42U20/TUBzH+1eZaAy3iFwU5WI0CiKJ8YEHwTc1XMQxLiPAYNwiPBnjCxhlAzUx0WgMAwYGMkbb08J6OT1tt65rtzIefPLXbSKJ8fLLL92ynu/5fs7v9zujBFGMRqOapukJ4yQTSSP1H0EVPgghjm0eZ9O5fGbtdMr8dxTFmqa+31RefsKLX/CLj/LanuZk0qaZ/ntQoiTFYjFZltpnuZIutqafPfuIGVk6PM4aWsJIGsX8PVxs2MDOZFSVPFjgL3pQgw+V9zITy8L3nGWlXf5CwnfgAJaTdJ2TyaQKQZTOBb7yKaofRmU9rvjYSfOycYjdPMBGwjAztuVkipm1LVcsyzLDMLIkdsxzBXFpDxsIxgVZvzXO3xzjW/x8k4/7uosx0eG5saeEo0pkX4GOUJZtHx0dQcE65/mfYmZmRZSIUetFNf3o8gAq62UjtPp2g1T0Mk0+dMmL2gIc0Q0KkAVBIAoG8YU+tm7QFU+HBFFJXhlEdQOofgjB71v7ZGVdKe9hGodRbT+6M8kpWpJSCOH5A4zl+8+4Gi/XFjgo62GnQoKAE+AJJrBFxRN2M6aEwri0m20YRtUedNvPYTVB2YCdy+ma2jHP13q5u9OH5b3s9IooqykQAzmYg3ib0VY3SEk3A2hVHrZ1glP1FIUxRggpv7DZ0m4XW1CSYHtjjG+ddLeL7BNwBnGz/6BugGvx57FhqiVJUrBcKFjDcPHMBeyrQ9y1ER6cI7GCmL03G2/08c3jebFlWY7juNX+2WdwnjmNPfhnbLgSNO32ufNUn6eC8bisny7Yxh4OrsnFgvXnC0YSFEwpkAM2jGeVBzXmx3Mmj33Sqso+OLOyEsZw+GKrJvLY7mzbtqaS9jnufBdT7WHPPKQng6KkpqB+MBWVfcy5x0yE1oJhAq9gAaBdH4UhSbnONE1Dn59/EEZfS1MhaWgp/m5dEmUy/kaYCIqBkOR7JcQ4vB7FQ4vC5DIsE+ZWBUXVwdkEPdzs4yM7ztPra5+xyOfgn8E0nUxqZ2f721bYNnW4CNmMlVDF6M4WE9t17BQg/wCMamBe8+qm8wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 50 56" title="" data-src="/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-0506a.png" data-srcset="/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-8fcc1.png 200w,\n/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-a271d.png 400w,\n/static/2021-10-25-16-50-56-95d4bb9ec5501b2d2130da1c4af0c355-0506a.png 470w" data-sizes="(max-width: 470px) 100vw, 470px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Flutter 优化后 GPU 性能提升了约 10%，基本能达到 Android 原生 sdk 的水平</p>\n<h3 id="挑战点-4-客户接入如何提效？"><a href="#%E6%8C%91%E6%88%98%E7%82%B9-4-%E5%AE%A2%E6%88%B7%E6%8E%A5%E5%85%A5%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挑战点 4-客户接入如何提效？</h3>\n<h4 id="背景-3"><a href="#%E8%83%8C%E6%99%AF-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p>面临的问题：原始 SDK API 繁多，客户接入耗时很久</p>\n<p>场景化方案的价值：客户可以寻找契合自己业务的场景方案，参考源码实现，提升接入效率</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.404341926729984%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACBklEQVQozz2QTWsTQRjH1w/gwc8hngKKpmlIUvMqFmkRseBFvFTxYIuIRenBIp7U2tJL1Z6sIGJbwYAaKfQlbdJtNm/dNGuSJu2S3SaTZJPNJrs7s+Nsqs5hGOZ5fvxfKIyxYRjkFkSB436zLLu3lynkcxVRwL0DAGDi8WQyGWfiMYbZ2AzT9O7WVjiRSFAnGwgax0K1VgfNdgN2atlCMcGVeCB3NQh1XdM0BCFRgAhhrLc6SqvdgRBS2FTF4mHtMCdIoMXS/Mpa8yfbZvhmQWgoqk5gsqDKSmV+7tOD6StT4Mtm1TBU8kkRzwhB8qry8tzDr09vvj/ty/YNhaT1VTMRQjokeij9aCJtOffGeY9y8acC/BLdg/9nXgq+nbz9YvLW8tmhnY991/dvDKty25xiXCchrXbO65z1j525tu/qX1h8/M6EQbNYrmcqUn4hPPJydeD5zPiHwF3W7Yxe9jaTyRO4EgpFrLaE3//LPRz0jWQcl/Kjd4gh6ljKSYqoaspi9P7MZ9v6qCft8dBub+zqYKdcNrvEWDk6or1+2jFA+JTfF7ZcyE3P/rNtdogLxY21QVfMYo/YHdvnL+ZfvdZVVWu1SNdkWl5e2fUFotb+iM3Ojo2rjcZfuGfNjC3tMNzUs+zEE/FbEKTTIJWSDg50hLS2LIOqXCqJ33+A7Yje7ZqOEPoDZ6mopRlcui0AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 53 24" title="" data-src="/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-160dc.png" data-srcset="/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-fc7b9.png 200w,\n/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-cea17.png 400w,\n/static/2021-10-25-16-53-24-735246cc3188798234c6493fd58a4991-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="方案-3"><a href="#%E6%96%B9%E6%A1%88-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-160dc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 737px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 79.78290366350068%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADNklEQVQozzWRbW/bVBiG/Rf4wA/hP/Ar+MaHwTYJoQ1p33jphBBCSGwg0U3T1nXZSui0pqtEtcI21hKapHmt391jnzhxnDi1k5xjO4l9fBxz3IqjW49uXc9zH1vP4RCen/WQYs603gwOkNZDqon0PjIszCDz0MKgzwbyFhxgzcyHWcR2MDfD0VoJXC9IN39Ti+Xh9YLy8SPx213jwdv+lcfi1SfSxjvryxfgk03xZlHdqTo3tpRrBembHb07CPLw7YvwF0X1eWX82dbZlU3lu73uxjv704J67an65Gi4VjKuFtRb22Cv7rIr2I1rJb1rs7AfidAXDCbMK1ZL7DUEkweuCNw6b+Zetfkzty70mmKPV/q8PhOgL0HftC++DPph117oPXxSq7Ua9ZNKWZAhLxmNk0qnWW80mrwMmT9tN2vVYw16XXupW3NzGHDIZ+FAt0LQ9zui3hFBW1Bl4Mhg1Ba0UxGcSvDSX7Q0rTs1Bmw46I0CjsQJiVISURLThKxoklGyInHKlJCMMEKzJMkSmqVpriRZXSomlFuE2J97Qa4JDr0JdmdB7hnxQ3cxR2E0C2NW0WyBpvNZEOEwxjlZIg7hMZxKcCKxqk+kliXxQ1H3BDgVu1PFwyPWMjy2Qb7VF1p9SXcFwxN0j7emOuf7k0P48gX/S0lcP9Ceyk51V1jfVx7v8L8Kw+MgnFXNg31l80/12d/guegc/6Fs7MsbL8X7gl3jgmD6Bmw/a/1Y7NzZkx7yw/LvzIgPiu2f2vZREE4P9dJ25+dd4f6e+LAzOCrx95jf7tztWGUOIa/rAuAoYCzBsWx5QB8JwBHAWOl5BsIe+z3jXIKubHqqjSD02GNphqcOkcWR5ZLGCxrNKSFs1QlJ84UnKYNJNE/iMFul2f9nxXwaZylhoiTikmiS+s00lOj5DoVr1PyBwtuJtZ4G/Cpor0KZjrao8VXS/Z4aX1P7URpIqd9O/RbxNS5djlfo32yhptrn9C+O/PNe8pajtQ+yoJPh42wup+JHKePl9+lrjrY+ZJMZrmR+NfFFLggnBEkEa9HkZOm8ipyDyHm1OD+MsUKwnHOvcsnz6pYZIRetCBv/ARl3L8TLq4FdAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 54 30" title="" data-src="/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-160dc.png" data-srcset="/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-fc7b9.png 200w,\n/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-cea17.png 400w,\n/static/2021-10-25-16-54-30-0494adb27a37a9a152941d441ca76175-160dc.png 737w" data-sizes="(max-width: 737px) 100vw, 737px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>核心目标：易接入，开箱即用，降低客户的接入门槛</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-787fb.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 720px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 100.55555555555556%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACOklEQVQ4y3WUC5OaQBCE+f+/LVdKkIC8QUEWUUDN+Tq4fLujVZeL6arDZZme6enZPet+v0/jNH6MHwbjqBfb7VYptd/vfxucTqfz+TxN0/gFEK1hGLq+u1wucO4GRK9WK9/30zTtDbpOB3z+DfjWRqM6Ho8XA4pQFtpsNo+iCNreQMjTF1DMWq/XQRDymTiKtG2LlrqukyQhK+I3VcUrSXe7Hc93A3IRbFHzcDi8PyHtlWXpOE6WZehPU52FsCgMncViuVySkQI8rbbdNo0izfV6vd1u8ImjlO97QRjmeV4UBXEYEYbh24+3OI5RSQzdWVVV8RnZ1GcL8fwqVcdxlCYJXaClHwaekO25HQQBMWKNRVbSU3kw4AOyyeg4CwwT5XTBvPDftu3ZbIYuhGgyP2cDcZsF4mmS3lCI7Tgn0b7n2fbcdRfQHpX5IKOSOUsidjQ5ios8HwZU9UQj2PmJZYs4Th5khGEMvck82cIzdKIQ2bVSMg6iebUNsjR7kCminhFAbGfT8zxNrmvGK+RfGi4dibWaDEva/tYz3iKqaZrhoI0khuPEKwshI9Pa1Jtm21CNq8FxlRRySGgH280B7V4fT8zECZTvdjTesqBnOEZ2XKwKErH5+mLQErM9PoFCZEOmYeaUm/ODEa/JDAIOBLmlLIiDjDmIqsyt+O+VTDN9DCgolaVIVZau6+IZllKZdl6TMVDVqn+CIvw7Kcs1hwE+ZxM+Ma/J/H3+A0ZFw4xKbhVPRvgtBrf/AB+fXD7+4uBqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 55 38" title="" data-src="/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-787fb.png" data-srcset="/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-4591d.png 200w,\n/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-bf018.png 400w,\n/static/2021-10-25-16-55-38-1c1cd6fa7d951cf64b719250e546b7b9-787fb.png 720w" data-sizes="(max-width: 720px) 100vw, 720px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>SDK：接口不超过 30 个，而且语义更加场景化</p>\n<h2 id="未来"><a href="#%E6%9C%AA%E6%9D%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未来</h2>\n<p>flutter 桌面端的支持不太好，未来需要支持全平台</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a166a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 30.82644628099174%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABeUlEQVQY0wFuAZH+AL/Rv9Dh0Y3IjWK1Y2m4aWu5a2e3Z2u5bW26aK/I0XGa3oCl3YWp3mmW2cHQ5sG+uqeoqbe3t62traioqADJ4crV6thmuGcdlx0pnSo4pDksni0mnCcwny/F2dDX4PXV4O7Y4vDQ3O/h5uzm5eTj5OTn5+fk5OTh4eEA0OjR1uvYc710MqAzP6U/TKxNQ6hEOKM5Q6dEzt3P5uHh4eDc6efk4uHd5+jo6urr6urq6urq5ubm7e3tAM7o0tXs2l+3ZReYHymfMCifLyqfMiCbJymgMMDTxM/Mz9XW1c7Oz87Oz+7r6dra2sHCwtHR0evr6+vr6wDR4Mrb5tKex450sl59tmeHvHOAuGt4tGSBuG3R2tDX1tjf39/e3t3o6uzT3eza29vb29vj4+Pk5OTl5eUA2c2r7uK9/9OH/8Ji/8Vp/8Rm/8Ro/8ds/cVs7ebY8fL17+/u9fTz7vH3pr/j8PHy/Pz8+/v7+/v7+Pj4q2oDoKJ/umkAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 57 59" title="" data-src="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-fee1c.png" data-srcset="/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a67b7.png 200w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-0b187.png 400w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-fee1c.png 800w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-b1a91.png 1200w,\n/static/2021-10-25-16-57-59-92e8a326cce31833d866d05c66069a74-a166a.png 1210w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-3be6a.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 726px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 80.57851239669421%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACyklEQVQoz22NzU8TQRjG9+zNm15MNPHgzYt/gImJ4aCRC8bExHgAL4R4NEZJAINCghqNMXgQ0aCCtBQp3y1Flm1LS+mHtN3tdmfbbbvs7uzuzHZp0WjU2RKNocz88s7zPs/7ZqiN4opPmFgBrgMERHcATDVwN6d+MLkuzlLe3MjrdPfbzIPRTN8/3mR637MD49zQeG5ojB0czfT+nzYGej5ln1GsnExUmGQl1EQwWgxGCkzqkCiUqATTcozSFKjKhwB3dEkiQKjof02NABvVYQdSQAQsx3I57gD5PC8I+bxAnrzjcCzLgyxfSGUFUrO8yPM5ynQOagYhs6IYskaUM6BDsyr4atkxnHbX2Ambm9Y1SGFkWk0Q08ZkWa+ojrCQQe737MjveM/Pr89/JQd+pJ6YOqQkFUkqLmu4pOKC4lSpAXEkBRcVRxAKFb2ooLKK2AKUdgxJQWIZUgnJ9oH6glDzgzpTqC+DOmlXRcehi/Vwqb4oODDA/iLuLYFvyw0C4l5UMKmYZJ/z4RPz6OwSerG9e8yLziyillXHuRCw7mxWT86j47N4cAsT88i0eWoBHZ1Bp+dQAphUvFS9HbE6wrhzA09ydnsYd0Ws+zHrVti6G7NeblfbQ/hmCL/bxvc2cesauhHEV2ncEcJxsqzrRtU0LMOp5FQNR++3qqKXZH3XbESqapl6DRm2aRDHNnRVVSmhaAgSFksOfBERgIQEB8yJZt5pMSAR0AWiS3gfMsADSKVy+jSjfQyoHwLqWtzwbeqedY0wtwEjGeQNQ6JdtMbEtaUIdNHqFK25ac0b1BJpzVnuHBZbB3KX+rkxv9I/Xrr8kGsb4juHgTcErzzirj/lW/pYV0DuegXOd2evPeYv9rJtg1wyA6mcCJejykxQnmLkaEajE6pnXf7MyMRMsORbeSYkTzPyVlrxR+TJ1ZKHrnjo8ixT5njlDy0TD5jQ0V1BAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 25 16 59 11" title="" data-src="/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-3be6a.png" data-srcset="/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-0aa07.png 200w,\n/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-92365.png 400w,\n/static/2021-10-25-16-59-11-7b6cd791a778c614e2229b5cdfc1667d-3be6a.png 726w" data-sizes="(max-width: 726px) 100vw, 726px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="腾讯文档渲染优化之路"><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96%E4%B9%8B%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>腾讯文档渲染优化之路</h1>\n<h2 id="dom"><a href="#dom" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM</h2>\n<h3 id="方案-4"><a href="#%E6%96%B9%E6%A1%88-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h3>\n<h4 id="sheet"><a href="#sheet" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sheet</h4>\n<p>使用 <a href="https://github.com/handsontable/handsontable" target="_blank" rel="nofollow noreferrer noopener">Handsontable</a> 的 dom 渲染，主要页面构成为：</p>\n<ul>\n<li>单元格：数量多、结构类似</li>\n<li>图表、选区：数量少，结构独立</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-6f1f8.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.457925636007836%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB/UlEQVQoz01QS2/TQBD2/+fCDS4ckNojl56oUCqBBKINLYU0MUkTx8+svd7H7MNerx9Z1nCA0ezoG42++b7ZoDNWS62EaqRulPJAcP+UkkqD7ITs5JwN45qwlgvNZQtSUd61JlCYaEwkZlDS8CEjWU3SGhDTdd0cj+fORFHBKLjzqJI0y9h6z55TcUipqGggq5ozgSpRnMQxph5UWKYpywpgu8g5922Trg+oG0YWo20Kq0Td7+DHXlDEAolrYFBjqErxtCr97vhI4yOhVDZxarsuy8vnQ0ZBKQ9SuAvZ92fY5Qown20DFScEeQ77fY1OgLEscqgqKaNE+8MZGK3GsRcZ2mfiKVGPB7GOBatmci24rGvpOeEG5xmPY5rEjFLlyYO14ziYxozT1JwqT16u6eOWbzOvDAGUmBNell6Zb8MSFcyfgBD4dfIQD30/TFN/9jHJHHnbT4VZFSZM5KzcUv7HtkAnsdmxOJdRRKOIoVKqY9qBpD9/VdcfeQVtmuGC7hcP8YfbPCGqIoEFqf0XI0wLEi3uYRWykpCk1FVtSQ39JG4+iRcvsR6NlNo59e6qefO2da43Jpims7W2a9rOuenyor+6ss7NrbHWdB73d8vh1Ws/tU3j2+H9dX9xaTywfeD+j9uv7svnf+35PNdw4xaLGUzTXDcbt1z+nf4G9V5dhLL1T5QAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 13 56 57" title="" data-src="/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-fee1c.png" data-srcset="/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-a67b7.png 200w,\n/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-0b187.png 400w,\n/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-fee1c.png 800w,\n/static/2021-10-26-13-56-57-8a73d0fe3a5f4913be2be678e3653e7f-6f1f8.png 1022w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="doc"><a href="#doc" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>doc</h4>\n<p>使用 React 作为 dom 渲染</p>\n<h3 id="优化-2"><a href="#%E4%BC%98%E5%8C%96-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h3>\n<h4 id="渲染管道"><a href="#%E6%B8%B2%E6%9F%93%E7%AE%A1%E9%81%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染管道</h4>\n<ul>\n<li>\n<p>layout 优化</p>\n<ul>\n<li>尽量避免改变元素的几何属性（例如宽度、高度、左侧或顶部位置等）</li>\n<li>修改 paint only 属性（例如背景颜色、文字颜色等）-> repaint</li>\n</ul>\n</li>\n<li>\n<p>Paint 优化</p>\n<ul>\n<li>使用 will-change 或 translateZ 等提升元素层级</li>\n<li>使用 transform 和 opacity 属性</li>\n</ul>\n</li>\n</ul>\n<h4 id="滚动复用"><a href="#%E6%BB%9A%E5%8A%A8%E5%A4%8D%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>滚动复用</h4>\n<p>类似于长列表的虚拟滚动：复用 DOM、离屏时销毁 DOM</p>\n<h3 id="缺点"><a href="#%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<p>随着页面复杂程度、页面滚动速度的增加，重排重绘开销随之线性增长</p>\n<h2 id="canvas"><a href="#canvas" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Canvas</h2>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-4e8bd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 788px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 56.34517766497462%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACBUlEQVQoz01SbW/SUBjtnzXxL/hF/aYmJkb5MuMSTRajg01gig4xUHkboRljDJCXIu0YIH0B2nt7b1so80Dj4kn6JDc553nOc54Kt/9hs9nW5XxdqZD6BT0rOd/TNPXZTqcJ55s7wh0EfOv12v0Hz/Mocajje96tqkx73aHcV3u935qmGYYxHo8JISHN933BcRxKafgAOOd4BsEaTcVsJvbxfeL48MPBu1Ih3263c7mcaZogW5aFLgIEjDEIFouFbdtsB3iBeDxbyqo+UPW+qmvGUpb73W630Wh0Oh3MAE0IlXA5mUxsy/JcDy1WqxXEL96KD55/efr6x/1HR7GUFD+ORiKRbDbbarWWO2CyxxgnhC2WxLKp43Dm+kEQQDy8Mdvyn56iN3vTyWyBtdXra8bdINg4DuPcFSjDsBV3fWU8n5nE9Xy+FW9j3Y9WMPbJXubxq9Nv4pVUPRPFn6lUqlgswvZ2Z89bUYdZNpkhT3OOlrCNICCu1JVUrnma/5XINDryZG7qM5A0DZlNp9OtmFJUgs1vRiPD0PkOoe03MenZfv7lQfnew8RXsXV1WWs2WwisWq0mk0lFUQQEGyaM60GGy6FXmLbcl2u1i3r98vy8NpDl0Wg0GAyGw2GYKMgCLgZBqERFF3je7H6lUqFwEv90Eo8fRQ8r5bIkSaIoYmHche4M/wWrDEzpnIIXxQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 13 53" title="" data-src="/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-4e8bd.png" data-srcset="/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-28bac.png 200w,\n/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-faee6.png 400w,\n/static/2021-10-26-14-13-53-8778a5d461ba4de809b4f9be1e1ebb90-4e8bd.png 788w" data-sizes="(max-width: 788px) 100vw, 788px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="极端场景的全表双边框"><a href="#%E6%9E%81%E7%AB%AF%E5%9C%BA%E6%99%AF%E7%9A%84%E5%85%A8%E8%A1%A8%E5%8F%8C%E8%BE%B9%E6%A1%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>极端场景的全表双边框</h3>\n<h4 id="背景-4"><a href="#%E8%83%8C%E6%99%AF-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-6cf69.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 50.21802325581396%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABY0lEQVQoz02Q2Y7lIAxE8/9/2X3DDiFgvBDmYUy6R5qodFSybJfDMZBwdKFG42ZsTF1JqH6bf/r1wjDgLld1PqoORJIRBcwEN8HOETa7mijdivpd95QMxZMvD+5Tzs9lPj2GQ5MFr906knJi2YRtBN4iJoFMMZD3nDN5xylwDFKvYwwUSNKddK/Usc2f5Ga1qMnSPDoz7EkpoDXoLTpLOR0wkMclEHTFDhyFRyHlfgU1lfFiqFgypsg5aTJFT8HzVY4OQ7vnHo6beHXhWx6Yzy2zqebT56NsSJTizgxuH1+yJg96z+b3bB65MVfZA1WmblE1eepcDZGvAP4sZqvpg0EfD9eFaVFelJbcY84+13iWzsNc8OsXiPzh2qt31jlrS85HaxCDM+eXNR9ljP5Cut87/0/WShkYvf3+/vr5rLVHvXtMyRjd5qyxKeebpD8LnvX+7ZupfFZFjjFqp/dem0spfwGVQzR3gQC0lgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 17 48" title="" data-src="/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-fee1c.png" data-srcset="/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-a67b7.png 200w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-0b187.png 400w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-fee1c.png 800w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-b1a91.png 1200w,\n/static/2021-10-26-14-17-48-9045afb8a670568bca5965da4e83920b-6cf69.png 1376w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>渲染时间：单边框 6.71ms -> 双边框 14.91 ms</p>\n<ul>\n<li>绘制量：对比单边框，直接翻倍</li>\n<li>对接逻辑：需要额外的对接逻辑</li>\n</ul>\n<h4 id="产生原因"><a href="#%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>产生原因</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-64bf4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 792px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 46.843434343434346%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABQUlEQVQoz01S0W7CMAzs///TJNjjmMSQUNvBwwYMkaaladMkrImb7pIMxKmynNRnn+1k3vvpjtl7Y0gI27a27yznv52wNR/rehTCGe3nJ4CYTRRo/ymC7+aZvHfew9I8TzjCaj1wXl0iGGPDMCA0I6L2em3qAFyRI2edtdY5p5TGjVJKSlnkxXK5/NhsyrIsigL8QEZQVVXHw+F8PnddhyPSQQj4fd9DHoLgg3+73WARg2MoQ5Sl6EHKcRyhHkWPpxPSb7fb9Xqd5/l+vwfNGANpFWOQDQd5Axlt6s/ysnhpXhfy59SIDqp2ux1+pzqA1kF/6hYyYYUQsedpMt9ffPXWvK8UY1KpmvO2bYOQCIhE22GaRI+9JL1hYA7TjmNNssG8YoRNGGKy0IwwG+EikpPdl0Thi7vydzyv9PEcHj7sH2ROAX94eqxsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 23 17" title="" data-src="/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-64bf4.png" data-srcset="/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-ea548.png 200w,\n/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-22e6d.png 400w,\n/static/2021-10-26-14-23-17-2b240fb665f4af16b65f3c4dca67fd51-64bf4.png 792w" data-sizes="(max-width: 792px) 100vw, 792px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>上下文设置 style</p>\n<p>通过 canvas 上下文设置的 <code class="language-text">fill_style</code>、<code class="language-text">stroke_style</code> 等状态, 实际上都是 CanvasStyle 这个类的实例</p>\n</li>\n<li>\n<p>GC 逻辑低效</p>\n<p>GarbageCollected 自己实现了一套 GC 逻辑，并不会走 V8 引擎的 GC，不如 C++ GC 高效</p>\n</li>\n<li>\n<p>性能开销</p>\n<p>Canvas API 调用设置状态操作，性能开销较大</p>\n</li>\n</ul>\n<p>Canvas 在渲染过程中针对单元格需要渲染背景色、边框线、富文本，而不同的颜色、文本等又需要不同的状态，所以需要频繁切换状态机</p>\n<ul>\n<li>渲染单元格：渲染背景色、渲染边框线、渲染富文本</li>\n<li>渲染⽂本：渲染 color（black 文字）、渲染 color（red 文字）、渲染 color（blue 文字）</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 713px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.95371669004208%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABk0lEQVQY012Q2ysEYRjG589zuNGKkCuKXDiUkES5kiIpx1VLIu2yDhcWOWSyVisjrTA7s7PWfHP4ZmbNYY2Zsbsz60M5PRfvqefX2/tipV/yPO8rokSlRU58/h4i2YVinCCNV/vbj5X+yHPdkiRxUnIpcT6dvp6Bqa1X6w3REFzytzMEPiXczUrgqvi5Bfu91jD03Iv1yCRArDESKI+FyjiiX81ZTrH0dLdGH1aG5yrIgwpArhdcRLg/sGVZCEaFBFNZoim+6XvYr+JvBhQgGlmHTYaEqA8PVvNRn0CH/8Ou62qqms97EmTARTOxW39/VJc87gL3ZMHMs9TmI15zsd2QOavNPITzxY8TsX8Ps0w7m1VVhdEhpTHXGsdAlocZoMiiCpOanNJl2sxpX3bMcRzTNG3bVnIK1ETJkDjIMhTJsylZkxVdRgMKkAn6lhbSGZEXdQUaUNA45MdwHA8FQ3EiPn000uNv7Qu0+Y/H/JHxvkALakc3elfPlsb2BgaXO0Z2uhdP5if3h4dW2oeDnQunE+9yTJhRSzHYywAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 29 28" title="" data-src="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png" data-srcset="/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-b9753.png 200w,\n/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-7c7b5.png 400w,\n/static/2021-10-26-14-29-28-bc989025b8b2a5dadf122c46531c77db-4d589.png 713w" data-sizes="(max-width: 713px) 100vw, 713px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="优化-3"><a href="#%E4%BC%98%E5%8C%96-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化</h4>\n<h5 id="切换状态机优化"><a href="#%E5%88%87%E6%8D%A2%E7%8A%B6%E6%80%81%E6%9C%BA%E4%BC%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>切换状态机优化</h5>\n<p>通过提前收集、统一整理，减少切换状态机</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 685px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.8978102189781%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqklEQVQY012Q3VPaUBDF8/8/tFqhVLTaTsf2RaoJEgJIExJCzNe9BZLwIRhHpdg6akFMcpN7k17aPnS6T2d3z29mzzKOP+Qtjje5liuCKRRgWbDLbU8xJyZvsVWb1Uaa6rVP9KOqzYEpaDkib67ncOIw9jko8hsF9kVJO1CG0n5za6+2depWzy6UD9KbA7koj5uiV3tXL+w3cvJALHU+UfNOdUMb6kwU4STOkiRDKI0igpPs5wKZZheAvtMf6zqkQlUNUWz7/izBaxs1UySMMJOm2X8VhmR+8+Pb9fxu/nA7u7u+nE3H/uXkKngO6Tb9B2D6vscZh5xeavbqxrnF6mvdGalfr6DQ5eq9E8s3jQud/oIHx+bEktwvZaNUAZ8BzWyNQbGyWTh+eah+lD1pm3+1XclxNtsaSW8b+b3TQsMReJt7zW3u1PLySCnDo10h917Ma0ODiWOS4iwlGaGxQ4IXEXl8Th5W6P4JPyW0TRYBDjBZRlTH98v4MSBhQnAWI8z8Pf93ktVyFdgm6iiRbURdiAYugnY8cMnsJu5BBK3Y0JB5Rr7f/kF+ATiLkYxePH1FAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 31 43" title="" data-src="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png" data-srcset="/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-18514.png 200w,\n/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-82fbc.png 400w,\n/static/2021-10-26-14-31-43-0d4765d93a66fd9fd47fa3047b1fbbf8-c84fc.png 685w" data-sizes="(max-width: 685px) 100vw, 685px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>遍历待绘制内容</p>\n<p>遍历待绘制的所有边框线、文字等</p>\n</li>\n<li>\n<p>相同状态内容整理</p>\n<p>相同状态的绘制内容，进行合并、排序等整理</p>\n</li>\n<li>\n<p>分类渲染</p>\n<p>整理之后的内容，根据状态机进行分类渲染</p>\n</li>\n</ul>\n<h5 id="渲染复用"><a href="#%E6%B8%B2%E6%9F%93%E5%A4%8D%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>渲染复用</h5>\n<ul>\n<li>\n<p>离屏 Canvas</p>\n<p>离屏 Canvas 缓存主 Canvas 绘制内容</p>\n</li>\n<li>\n<p>复用</p>\n<p>直接复用离屏 Canvas 缓存的内容</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-89964.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 754px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 72.41379310344827%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABx0lEQVQoz11Sy24bMQzc//+N9pL00rop2l9oiiK52Bf74ENQ1Eb2qQclUpQ7khZ2UmFXXsmcIWfI7lJXzmUfe/l09/rxw/nbw7D5Mjz+NL8e7dNv+3UzbD7393evP75P+XJb3ZvvQsGciXII6r2QF7MEa6Jz4n3CJbMS+RDCO7Cq5ppdkqTEqoInZ62MOeGYyk2M4Xg8nk6nBlnBnojrAmtlKURmnjgQlxqosWBHZuYoIgjucJU1IyJaE5Yl1bhCzDEYE72rYH+VllKKkQFeM6tINKaUywwwlIkxiXw9J8EfgVZLCxjhqD8W8DAMyIHyVnCgOA3uzwtbIyE0LaWcGzg1dZq0OxwO3lqo4iqDvctafVKFy7iMBexxJlFJ+QrGR/f0/BypWAIhqBc617apcgWTc2gXXHoZvQkoOXFkohCjdMZaUCEJEbl59stybbobJ7uYeV4mi6y3skukc5DdtbgsDBNh1W1g0CoPdo1JOWm7ae3VqqsOSXUCyvf7/d/TCXwtAvswjm0kSjPx6jozu91uu91679chGcex7/sFfRa5JgfRPM+o8P0I5/P5DMYyJJf/V7bWgqUJCyHCWGMMfpfFwNG3of8ATMgsDI+wSFUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 36 26" title="" data-src="/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-89964.png" data-srcset="/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-13e98.png 200w,\n/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-e13a3.png 400w,\n/static/2021-10-26-14-36-26-56a5ff710c45f1102b4fed78318d5d25-89964.png 754w" data-sizes="(max-width: 754px) 100vw, 754px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="针对业务逻辑减少-gc"><a href="#%E9%92%88%E5%AF%B9%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%87%8F%E5%B0%91-gc" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>针对业务逻辑减少 GC</h3>\n<p>浏览器垃圾收集器会定期（周期性）找出那些不在继续使用的变量，然后释放其内存</p>\n<ul>\n<li>\n<p>频繁 GC 导致帧率不稳定</p>\n<ul>\n<li>大量创建对象会导致更频繁的 GC</li>\n<li>频繁的 GC 会导致帧率不稳定，引起卡顿</li>\n</ul>\n</li>\n<li>\n<p>对象池优化</p>\n<ul>\n<li>建立对象池缓存，从对象池获取对象</li>\n<li>减少渲染主循环过程中新建对象操作，从而减少 GC</li>\n</ul>\n</li>\n</ul>\n<h2 id="alloy-精确统计-fps"><a href="#alloy-%E7%B2%BE%E7%A1%AE%E7%BB%9F%E8%AE%A1-fps" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Alloy 精确统计 FPS</h2>\n<p>如何精确、自动化统计 FPS？</p>\n<h3 id="背景-5"><a href="#%E8%83%8C%E6%99%AF-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h3>\n<p>现有 Web 前端 FPS 统计⽅式：</p>\n<ol>\n<li>\n<p>类似 Chrome devtools 的开发者⼯具</p>\n<ol>\n<li>需要人工实时监测、无法自动化</li>\n<li>更加适合开发阶段进行自测</li>\n</ol>\n</li>\n<li>\n<p>RequestAnimationFrame API</p>\n<ol>\n<li>统计的 FPS 结果不够准确，因为以两次主线程执行时间间隔作为一帧</li>\n<li>模拟交互不够真实，需要引入脚本且实现对应代码</li>\n</ol>\n</li>\n</ol>\n<p>同时由于主线程阻塞情况下浏览器的优化，即使嵌入死循环 js，滚动依然流畅，影响 FPS 的统计</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29631326681632043000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function block() {\n   while (true) {}\n}\nsetTimeout(block, 2000);`, `29631326681632043000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span>block<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<blockquote>\n<p>Chrome 浏览器在主线程阻塞情况下，会将页面滚动处理由主线程移交给合成线程</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-2cb88.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 15.783410138248849%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAk0lEQVQI1x2J2xaCIBAA/f//K4NEBV2EZY/LxYNmD2XNmaeZZs85WlvQJ7tsgdIMlWP6FSyB1gny4jLidQuG7D0NI89wlO19HE1GQqGCVL5T0+3upaRRO/Ek1a+DZjOhEChkAstaszY7857SZY2xqVyhB9ObgCiFFK1QXXdvHzDDVSxYIkLn0CMFcs55DK/z/Pz5Ap7Xo+Nvq/KyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 52 50" title="" data-src="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-fee1c.png" data-srcset="/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-a67b7.png 200w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-0b187.png 400w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-fee1c.png 800w,\n/static/2021-10-26-14-52-50-c264745e6021ebabdf7f2daf27ea2c2d-2cb88.png 868w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</blockquote>\n<p>此时需要我们理解 FPS 本质是：</p>\n<ul>\n<li>\n<p>帧率</p>\n<p>浏览器渲染动画或页面每一帧的速率</p>\n</li>\n<li>\n<p>渲染管道</p>\n<p>浏览器渲染每一帧经历的固定流程</p>\n</li>\n</ul>\n<p>同时主线程阻塞情况下，页面渲染可能在其之后的合成线程、GPU 线程进行处理</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-f1168.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 796px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 41.70854271356784%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRUlEQVQY052R60vCYBTG94f3oU9F+CEo0ZqElyzKW6IYXaAoCEkTUpJwzljT3PaKl/d9N93c9p42u0H2qYfDj8PhgYdzDgdLYsyn0DaLJZwvTC4uievCHzZgHKgKaAogjSGPioOGtjYANJhKKu6o5MWni5CtIDbQXM+macyyXC+CMc6sp2k7orf2qBi3OvxDs3LQmKdqpHD4Vkz08rFuavc1F5VLSfXkuM7fBPZL68nzQPg6kLmPcmY1SRqben2LPu1YzWC1dpuo0NQdyvFiJihkQ2J626NQjEjZeDl8thrNrMRO10JXG0flCAdjzCaEYR0wBawvmgmQr9IxUPxJAwNZ2BznY20O/it/Z+a6Pep08dy/8ncBI9N5S6H98Wxpbrc1Qx7N/GTvC9KjIAvyz5cWGhv2c1/vjcxfgXRmi8iQhlOvfwelX7MZ4+qcOwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 55 39" title="" data-src="/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-f1168.png" data-srcset="/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-ad772.png 200w,\n/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-4f4c3.png 400w,\n/static/2021-10-26-14-55-39-2444b4ccc0043400ecb2226c5734be21-f1168.png 796w" data-sizes="(max-width: 796px) 100vw, 796px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h3 id="方案-5"><a href="#%E6%96%B9%E6%A1%88-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案</h3>\n<ul>\n<li>Chrome devtools performance：普遍常用的 Chrome devtools performance 面板</li>\n<li>Tracing view：信息更加详细、全面的的 Tracing view 工具，使用 chrome://tracing 开启</li>\n</ul>\n<h4 id="tracing-view-介绍"><a href="#tracing-view-%E4%BB%8B%E7%BB%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tracing view 介绍</h4>\n<ul>\n<li>\n<p>进程、线程</p>\n<p>展示对应进程、线程信息</p>\n</li>\n<li>\n<p>Flow</p>\n<p>事件对应的流向</p>\n</li>\n<li>\n<p>TRACE_EVENT</p>\n<p>表示浏览器内核函数调用执行情况</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-ad164.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 53.2033426183844%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACKElEQVQozx1Q2W7aUBD1/z/0Lyr1JZVapVWTlChLS1JCAGOMjZfru/jutq83IMQY6nY0Gs2cozMzOlbf993x2B27/tSfz6dT3537Q53tFpNiMTHLqXn5nc0nxak7nLvDqXvvj8dBch7idLao62HXp54XzYOlLd0Zce58e7Ra3bmzm8XspxOPQfQYBler6FcI7IhAJKT643m3S8fKAWp3b+/t29Pz08X9eByZhzgbufTGRqMVuV6nH17GX1794IV5sUyoFDqTKrNjuoiopRKsTaVzI1ynxGBn8lbLXZH3h/2Q3X5b1FnTFIfDbr/fbpu2Lqpt27617ft+ZyVLVxVl02xlEA8780xrJXOtq7ouq6qqq7Zt66o2ZWXKchjL0vzDq6qsG2s9mVKh8tykQZDgBKUYpuh/xZAgSGBCIMBwoACKE5IgihOCBnBgrde7x+ncpoxzNxKBkCATkeKhFD7jG87Codci1iwUwSJGNsFOSlace1KEylr/mc6XjpJ6eFtgJpkUhCM/jJ+m4NUZLhEAWUJoghlMJeI0wqmP0ijlVFjB3N4AqDMDVy5NU6Ekl5ILyfOcYohGM/h1nEYbBhPv7nny6cfi8sq/vcb3z8nH75b2A0O5wYR5YZYZlTIOoACIL9Zs6RCP0UCVTV3td3DuX118/nY9WnqRIPLm8sHaNtt6MK5qBhdNWRR5Xuis0DqXUoFEx0BDqADQALAYxpsIOj7fhAoBEK//AnftR15ZJ7ZEAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 14 58 57" title="" data-src="/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-fee1c.png" data-srcset="/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-a67b7.png 200w,\n/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-0b187.png 400w,\n/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-fee1c.png 800w,\n/static/2021-10-26-14-58-57-31aa1d6fff81d48a1099f94700370c07-ad164.png 1077w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="分析主线程阻塞时滚动"><a href="#%E5%88%86%E6%9E%90%E4%B8%BB%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E%E6%97%B6%E6%BB%9A%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分析主线程阻塞时滚动</h4>\n<ul>\n<li>主线程 V8 执行 js 死循环</li>\n<li>合成线程处理滚动</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-316dd.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 81.88803512623491%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADIklEQVQoz12T6W/bRhDF+b8X/RoUjVsEdd0EyNEUVmOZlnXY1kFLokiJOqibog6ey+UuL5FcUmpsp0yd9kMffngYPAwwu8AM9eVfPT199Th+7HVJlydsOxqLCdsM2VZ0lfd/eWVr2vG/tmdRlmHYFjykh4QcSEhInO6DJHCJ7xDfJ16QekGC3X0QplF8iMkhTr5BSErNS5VZ7iKASFcNVdpsFuvtVjUNU9tqK0ni+AbH1RmmwrK18g3dYCocz3S4BtupD/sc5U5m0XAcHx+gBoEGDFk1J7ItyeZEkjpD5lMxo5kvl97n3p+cfjp7V//z+v6i2MhdC7f3FDYt3wv8IPIc7GHb1VV3NvVmU2cimkx7nStvcpX1eWWdq8w/XEl/XG++JWWlUKM0A0Dk+ME+3gck8OLQz/6eHI9xHJIkSmOSxkkSZ2VGnERfk+QfyD6glsuV6/r7MHY9DyOcuee5DsbYRm4m33WyJzkIWSayADB0GwIHw8x106Cms8VK3kDLRia2NNtULNvACDiZ2zpGpgt1pK8NsDHMta7LmrUDSLOhYqmyRvG9frcroDBCbmgBF2g2hi5CLlxs7c4AVO+tWsvi+oAb6HdNOJxDE0MDQj0b5lCKMFDGE9hkoSBowx5Qdg4AwDQUaW4Zql4pGVzLWIzXA27VbW0E1pyJUJqpo64yH1L7nXqAKFnKjig6Q8Gez7CiBADYiylernxO9Mdrb7RwpxMsDkC/A/sDNJAg37V6HcpOwl2AlHS/Jd5u72T1yjYlS9t5cOujLTS3lrGDxsZSkWt/SdPHJOP4RNKnz5+pBU+38y+4wkuu8GPmncLLwtvvL998x+R/4IsnXEbpJ778c5t+IY9un28g2+7nBad649VVlS8zQrHRKzP9q1vu7XnxzUc6X2qWmH6REUqMkOX0HTeab/5/GPOb7t2v+frry8ZvdPUsf3N6Tp98oE9+L776WD+7rJ5eVM8uaq/z1dP88n4YHh+jwwOOjjIiYfpA/TXVsCjLzSZbprW2oHQ4PN4FC6jxwqhWGdxWdHagc11P3JIloMeQU8KW7L3jge4f/gZkwjTtkQ9WmgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 01 18" title="" data-src="/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-fee1c.png" data-srcset="/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-a67b7.png 200w,\n/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-0b187.png 400w,\n/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-fee1c.png 800w,\n/static/2021-10-26-15-01-18-d1c4a60e8b8149436beec376555834eb-316dd.png 911w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="寻找关键-trace_event"><a href="#%E5%AF%BB%E6%89%BE%E5%85%B3%E9%94%AE-trace_event" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>寻找关键 TRACE_EVENT</h4>\n<ul>\n<li>\n<p>关键 TRACE_EVENT</p>\n<p>关键 TRACE_EVENT 出现次数 = 帧渲染次数</p>\n</li>\n<li>\n<p>排除主线程</p>\n<p>将寻找关键 TRACE_EVENT 的路径集中到主线程之后的流程</p>\n</li>\n</ul>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-8f73d.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 38.08532778355879%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTElEQVQY012QbUvDMBhF8/9/jKJMUGFTO/TL1I2hwtRVt7VpmzQvTdImTdJpujGYHi7hwn3Ol4CfI7bb/h1H1ekJOT+jFwM6GvLrKx7dVfvpH+Cv3J+Updts2hAILUI2Lyyl/ljeHgKstb7rhBRSSef90RToDqVXvLOmabRu2tZY23rvQed9x7lIoEwgy1BGVUYkYhKWMkE8lJyqnMiCyYzKFHPMFJEGVbo2FpQZzL82d7N48rZ+nS5unpbR7HOV0dHj+8PLOk7xcLKIpstvSKJZfPv8ESfo8n4+GM+XSQmsUhqTBNO85NlyDRHJEFV1k+Y4FKlqWqkcM0zCASNcNbqtlGaiIVIDJYTHWKWJhpCu0oJUBeEll2mOghyKqA2mFSwIZiJolTLKOKmt1A4wxuwe50J6vAvfQghljLc7dmO/GmPqukYYI4RaY34B62zAvGRtXBAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 03 54" title="" data-src="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-fee1c.png" data-srcset="/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-a67b7.png 200w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-0b187.png 400w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-fee1c.png 800w,\n/static/2021-10-26-15-03-54-a95f12f55dc5ca9a3a2ef78cabc5457e-8f73d.png 961w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h4 id="确定关键-trace_event"><a href="#%E7%A1%AE%E5%AE%9A%E5%85%B3%E9%94%AE-trace_event" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>确定关键 TRACE_EVENT</h4>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-079bc.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 54.750244857982366%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoUlEQVQoz42S22+bMBTG+f9f97LrQ7tJnZD6sqqTsiavyzRCaamSDtombMsFML5gwAaC7R1Ipe2hlfaT9fn48lnn2LbyPGeMEUKyLIOAEsKKAl1f8zAsVqsiiqjv482GcU4wRghRStlA13UWmGGWUApmOAIDjOH5nC+XRRgUDw8sCMCMKcUDhz2UUaWUZZ5EG6OMqfcGM7NX5hmsVRSFd/cIZZDYtkDbKk4alNQINN2TRKYpWqYwuc92dbopEwiSNoubJGuxFSdoF6csL7iQv9d3t2cT5+PIPb2Y2SPn5PPM/uLaF5fvTt3j8+kre/Li7deXJ+7Rp9mH8eJ8asm6FbIpKylkDZlUuQhH9/4b9+r11Le9xfvvP45n0bfop7fdzhHekbW3+uXv1gHP1sICW1kJUClrpfvyQNq8U9VQaqdN93zNWmulddfB5UGvD0Nteu1bf5RRjwyr/+jTtw3u/+HRLISABy/Kss++rpumhmcvh6EYqKrqEDCWN237N23obm788XiyuF14nudeuo7jBEEI+zjn+QB8qSHiSZwIKQ7mP3hPZjrbjzLpAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 05 04" title="" data-src="/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-fee1c.png" data-srcset="/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-a67b7.png 200w,\n/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-0b187.png 400w,\n/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-fee1c.png 800w,\n/static/2021-10-26-15-05-04-80c7d44d92c1e995ea30a13a983e97cd-079bc.png 1021w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>确定关键 <code class="language-text">TRACE_EVENT</code>，合成线程中 <code class="language-text">ProxyImpl::ScheduledActionDraw</code> 可以作为关键 <code class="language-text">TRACE_EVENT</code> 进行 FPS 统计</p>\n<h4 id="alloyperf-实现原理"><a href="#alloyperf-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AlloyPerf 实现原理</h4>\n<p>截止 <code class="language-text">2021-10-26 15:10:27</code>，AlloyPerf 未开源</p>\n<p>// TODO 查看 AlloyPref 源代码</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-04aed.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 40.3968253968254%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABD0lEQVQY03WQS0+FMBCF+f8/wrU7d27caXThQhMTvd6LCQgXxNvSQp/07RCMQYyzmPTMmS+nbbbb7xpUE95PWinBirJ4ujxXkg3DyDkXQjDGqqoihPToxMYB9z1MwEIIZflb/oHbQeJu4Hevbd13D89XwSjglFJSSuiw54x+qVCNRmcma53WmlKapZRihJYqos9u3+EQFr2qZXLx2N6XdL2QAepCUNZbH4gwJ2Z8DBvehxmoicTcgHThBwbhY0O1tgG8mwOJ8/YGjlTZfSePRCsbrF/B4C1J85J04G2SJxcKrI50KrE6fEqQq+QQsTC9sA2drnMCcgPHuRKM4vcXpF/JwnhpPJ88vDn9ufZ/9QWDjc4E1FrHKgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 06 48" title="" data-src="/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-fee1c.png" data-srcset="/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-a67b7.png 200w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-0b187.png 400w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-fee1c.png 800w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-b1a91.png 1200w,\n/static/2021-10-26-15-06-48-68674a769cf6f636a9765a864584fc4d-04aed.png 1260w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<ul>\n<li>\n<p>Docker 集成环境</p>\n<p>docker 集成 chrome、chrome driver 统一环境，支持跨平台</p>\n</li>\n<li>\n<p>自动化 CI</p>\n<p>支持自动化 CI，通过测试用例自动化测试统计对应、对应交互的页面 FPS</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-82dd7.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 675px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 88.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACTklEQVQ4y5WTS28TMRSF898BoYoVCx4iICEhsQkLRIsoEjQVIERXiA2iLaUI2sl4bM/4ef0YZ8JJUrqjLclNlBnfb871Oc7IlUBDpCF1yXArdbK49EN0OeQ4nBrGk4yL7OZBUCddZ3sfsDoPPqaRy+R6j1uMxG920jnlS8ClTRRCD7ghQSWq3pyqGg06Wl/IZudiHP3S1a2DR7e/P3n88/nG0cPrh/duHjwYH01ap2Pqh7yYzvau7d8dH0/Gx8/u/Hi6cTi+sX//1em7koYRs+Jltbs9e7/D9jar6Wa1s1XtTutPBgOVoeThi/g2Odl+U398PfuAtq1q+qJ6+1l8xdIohFRCcdLJmVjgNSxr3s9jSLkMELfBa2uM0B5voRf94BJpbCv1I+/Jh2Cda5X2FGJOKIqBKCQ8IubWd9j5jDPWchudT8SpFa6NS5jQRo5IGevIn8MhRIyNx7dezUxTN6yRPPQRGcigWqeWypacCB3WGOf9vKSSc+l9ChhnDXde14ZXrBatrOoZl7yLBpktYee9cUZbrYx25NZlvaW/MJRryxlvlNMmICHfEpRXMD4xZXwvf8R8XrAr9/O1MvctYO0M5kIjol7BZYSOfxX4lWEKcQKG5nrPjZdnhl0Ar5WXsOGN4EiKckBJauWlyucw3OZSICoP8RzWUV0FLsgZhlV1raxOfV7B3X8oY881Z51VIClh7O4sZ7hyQcGwzqvGyZox5IcEYp/W/80rGYaoKt0wyYVqcTZXhnVnh+RSZe0NN7LmDY6nj4SoxMptKP8BmHv57D/rTWIAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2021 10 26 15 08 35" title="" data-src="/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-82dd7.png" data-srcset="/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-b59b2.png 200w,\n/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-189f4.png 400w,\n/static/2021-10-26-15-08-35-d3e5cc6674baf5398e462295643f5079-82dd7.png 675w" data-sizes="(max-width: 675px) 100vw, 675px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n</li>\n</ul>\n<h1 id="远程办公下开发测试协同如何提效"><a href="#%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%AC%E4%B8%8B%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C%E5%A6%82%E4%BD%95%E6%8F%90%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>远程办公下开发测试协同如何提效</h1>\n<h2 id="异地开发测试协同"><a href="#%E5%BC%82%E5%9C%B0%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E5%8D%8F%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异地开发测试协同</h2>\n<h3 id="背景-6"><a href="#%E8%83%8C%E6%99%AF-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景</h3>\n<ul>\n<li>开发联调：截图、传递抓包文件、需要同步联调信息</li>\n<li>测试：测试测出问题反馈给开发，开发需要重现步骤，然后推到测试环境才能让测试测，问题定位步骤长很低效</li>\n<li>产品体验：如果异地的老板想看测试环境的效果，需要部署外网地址才能访问</li>\n</ul>\n<h3 id="业界方案"><a href="#%E4%B8%9A%E7%95%8C%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>业界方案</h3>\n<h4 id="vpn--修改-host"><a href="#vpn--%E4%BF%AE%E6%94%B9-host" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 修改 host</h4>\n<p>实现的途径：</p>\n<ol>\n<li>手动修改</li>\n<li>借助工具修改（比如 switchhosts）</li>\n</ol>\n<p>但暴露的问题有</p>\n<ol>\n<li>功能受限</li>\n<li>不支持移动端</li>\n<li>信息同步慢</li>\n</ol>\n<p>由此开发联调、测试、产品体验效率都很差</p>\n<h4 id="vpn--代理工具"><a href="#vpn--%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 代理工具</h4>\n<p>实现途径：</p>\n<ol>\n<li>whsitle</li>\n<li>fiddler</li>\n<li>charles</li>\n</ol>\n<p>对比以上的 <code class="language-text">vpn + 修改 host</code> 分别有以下优点</p>\n<ol>\n<li>支持各种复杂规则配置</li>\n<li>支持移动端</li>\n<li>分享抓包信息</li>\n</ol>\n<p>但是通常一个代理工具需要以下步骤才能使用</p>\n<ol>\n<li>启动代理工具</li>\n<li>配置系统代理或使用浏览器插件</li>\n<li>wifi 代理</li>\n<li>手机配置 https 证书</li>\n</ol>\n<p>由此导致的问题有：</p>\n<ol>\n<li>体验前置步骤多、成本大</li>\n<li>分享抓包路径长</li>\n<li>配置不共享</li>\n<li>本地需要启动代理服务</li>\n</ol>\n<p>测试、产品的体验效率很差</p>\n<h4 id="vpn--测试域名"><a href="#vpn--%E6%B5%8B%E8%AF%95%E5%9F%9F%E5%90%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vpn + 测试域名</h4>\n<p>优点：访问方便</p>\n<p>缺点：</p>\n<ol>\n<li>无抓包，定位问题复杂</li>\n<li>配置固定，修改配置麻烦</li>\n<li>切换环境不方便</li>\n<li>安全性如何保证</li>\n</ol>\n<p>测试、产品体验很方便，但联调、定位问题的效率差</p>\n<h3 id="痛点"><a href="#%E7%97%9B%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>痛点</h3>\n<ol>\n<li>访问不方便</li>\n<li>测试环境中业务信息保密性</li>\n<li>本地启动代理服务</li>\n<li>定位问题不方便（抓包、分享不方便）</li>\n<li>多人协作修改规则不方便（配置不共享）</li>\n</ol>\n<p>// TODO Tweb 学习笔记待完成</p>\n<h2 id="如何协作提效"><a href="#%E5%A6%82%E4%BD%95%E5%8D%8F%E4%BD%9C%E6%8F%90%E6%95%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何协作提效</h2>\n<h2 id="tde-的现状与未来规划"><a href="#tde-%E7%9A%84%E7%8E%B0%E7%8A%B6%E4%B8%8E%E6%9C%AA%E6%9D%A5%E8%A7%84%E5%88%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TDE 的现状与未来规划</h2>\n<h2 id="tde-的实现原理"><a href="#tde-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>TDE 的实现原理</h2>\n<h1 id="如何创造一门上万人使用的语言"><a href="#%E5%A6%82%E4%BD%95%E5%88%9B%E9%80%A0%E4%B8%80%E9%97%A8%E4%B8%8A%E4%B8%87%E4%BA%BA%E4%BD%BF%E7%94%A8%E7%9A%84%E8%AF%AD%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何创造一门上万人使用的语言</h1>\n<h1 id="kubernetes-应用的-bff-便捷开发"><a href="#kubernetes-%E5%BA%94%E7%94%A8%E7%9A%84-bff-%E4%BE%BF%E6%8D%B7%E5%BC%80%E5%8F%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kubernetes 应用的 BFF 便捷开发</h1>\n<h1 id="跨端开发，也可以这样玩"><a href="#%E8%B7%A8%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E7%8E%A9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨端开发，也可以这样玩</h1>\n<h1 id="基于-serverless-的低代码平台实践-tweb"><a href="#%E5%9F%BA%E4%BA%8E-serverless-%E7%9A%84%E4%BD%8E%E4%BB%A3%E7%A0%81%E5%B9%B3%E5%8F%B0%E5%AE%9E%E8%B7%B5-tweb" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基于 serverless 的低代码平台实践-TWEB</h1>\n<h1 id="稿定视频编辑器背后的故事"><a href="#%E7%A8%BF%E5%AE%9A%E8%A7%86%E9%A2%91%E7%BC%96%E8%BE%91%E5%99%A8%E8%83%8C%E5%90%8E%E7%9A%84%E6%95%85%E4%BA%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>稿定视频编辑器背后的故事</h1>\n<h1 id="在线文档冲突ot-算法"><a href="#%E5%9C%A8%E7%BA%BF%E6%96%87%E6%A1%A3%E5%86%B2%E7%AA%81ot-%E7%AE%97%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在线文档冲突——OT 算法</h1>\n<h1 id="从-0-开始，打造腾讯自研的跨端动态化框架"><a href="#%E4%BB%8E-0-%E5%BC%80%E5%A7%8B%EF%BC%8C%E6%89%93%E9%80%A0%E8%85%BE%E8%AE%AF%E8%87%AA%E7%A0%94%E7%9A%84%E8%B7%A8%E7%AB%AF%E5%8A%A8%E6%80%81%E5%8C%96%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从 0 开始，打造腾讯自研的跨端&#x26;动态化框架</h1>\n<h1 id="puerts-unityue-下的-typescript-框架"><a href="#puerts-unityue-%E4%B8%8B%E7%9A%84-typescript-%E6%A1%86%E6%9E%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Puerts-UnityUE 下的 Typescript 框架</h1>\n<h1 id="2021-tweb-云时代的前端开发-王伟嘉"><a href="#2021-tweb-%E4%BA%91%E6%97%B6%E4%BB%A3%E7%9A%84%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91-%E7%8E%8B%E4%BC%9F%E5%98%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2021 Tweb 云时代的前端开发 王伟嘉</h1>\n<h1 id="webassembly-在哔哩哔哩创作中心的实践"><a href="#webassembly-%E5%9C%A8%E5%93%94%E5%93%A9%E5%93%94%E5%93%A9%E5%88%9B%E4%BD%9C%E4%B8%AD%E5%BF%83%E7%9A%84%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WebAssembly 在哔哩哔哩创作中心的实践</h1>\n<h1 id="厘米秀-3d-形象-diy-渲染技术揭秘"><a href="#%E5%8E%98%E7%B1%B3%E7%A7%80-3d-%E5%BD%A2%E8%B1%A1-diy-%E6%B8%B2%E6%9F%93%E6%8A%80%E6%9C%AF%E6%8F%AD%E7%A7%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>厘米秀 3D 形象 DIY 渲染技术揭秘</h1>\n<h1 id="信息流运营场景中的低代码探索与实践"><a href="#%E4%BF%A1%E6%81%AF%E6%B5%81%E8%BF%90%E8%90%A5%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84%E4%BD%8E%E4%BB%A3%E7%A0%81%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>信息流运营场景中的低代码探索与实践</h1>\n<h1 id="低代码页面编辑器的设计和实现"><a href="#%E4%BD%8E%E4%BB%A3%E7%A0%81%E9%A1%B5%E9%9D%A2%E7%BC%96%E8%BE%91%E5%99%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%92%8C%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>低代码页面编辑器的设计和实现</h1>\n<h1 id="腾讯文档工程实践"><a href="#%E8%85%BE%E8%AE%AF%E6%96%87%E6%A1%A3%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>腾讯文档工程实践</h1>\n<h1 id="微信小程序真机调试"><a href="#%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微信小程序真机调试</h1>\n<h1 id="cdn-版本化解决方案"><a href="#cdn-%E7%89%88%E6%9C%AC%E5%8C%96%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CDN 版本化解决方案</h1>\n<h1 id="由兴趣驱动开源-cherry-markdown-成长之路"><a href="#%E7%94%B1%E5%85%B4%E8%B6%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E6%BA%90-cherry-markdown-%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>由兴趣驱动开源 Cherry Markdown 成长之路</h1>',
excerpt:"以下是本次参加 Tweb conf 2021 的学习笔记 目录 主会场 Flutter 音视频开发实践 腾讯文档渲染优化之路 远程办公下开发测试协同如何提效 如何创造一门上万人使用的语言 分会场（看过） Node.js & 大前端 Kubernetes 应用的 BFF…",frontmatter:{date:"2021-10-25 10:34:12",path:"/tweb-learn-note-2021/",tags:"前端, 前端大会, 前端分享",title:"2021TWeb学习笔记",draft:null}},prePost:{html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>由于 PMS 项目需要开发如下图所示的甘特图，需要选择合适的组件来实现此功能</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-9c1be.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 26.041666666666668%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAu0lEQVQY002Pa07DQAyEc/+LcQNQSwX8iBBKm0KJ7V2/cRJUdTS7Gln+1t5BRC/z/IudxSq3zu7pkaLKzKqad0UCYlNRs4iowuAeCwmQds3yQnj5Pt+WHxInyaUFcGC5O3Yjjiar99eGOsICgFYTM8+36/PbaZo/K/cO8/SqgmEt1sG1UZT3zn9Ytw1jUz6IJJ6O48v7gWFsHZCu5usv7m0rbGbF77BuWeuqqnuTJPYJ8jh+HT5O0OgR/gP6ZSPIPL6biwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="pms-example" title="" data-src="/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-fee1c.png" data-srcset="/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-a67b7.png 200w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-0b187.png 400w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-fee1c.png 800w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-b1a91.png 1200w,\n/static/2021-11-16-17-43-29-1bc03e8c80c01cec7d3dd8e1bc4a861d-9c1be.png 1440w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="技术选型"><a href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术选型</h1>\n<table>\n<thead>\n<tr>\n<th align="left">选型</th>\n<th align="left">优点</th>\n<th align="left">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="left"><a href="https://github.com/neuronetio/gantt-schedule-timeline-calendar" target="_blank" rel="nofollow noreferrer noopener">gantt-schedule-timeline-calendar</a></td>\n<td align="left">功能丰富</td>\n<td align="left">与 UI 相差较大，定制化代码较多</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/guiqui/react-timeline-gantt" target="_blank" rel="nofollow noreferrer noopener">react-timeline-gantt</a></td>\n<td align="left">功能丰富</td>\n<td align="left">与 UI 相差较大，定制化代码较多</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/frappe/gantt" target="_blank" rel="nofollow noreferrer noopener">gantt</a></td>\n<td align="left">与 UI 相差不大</td>\n<td align="left">在 react 使用需要封装；缺失左侧文字描述功能</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/hustcc/gantt-for-react" target="_blank" rel="nofollow noreferrer noopener">gantt-for-react</a></td>\n<td align="left">与 UI 相差不大，可直接在 react 中使用</td>\n<td align="left">缺失左侧文字描述功能</td>\n</tr>\n<tr>\n<td align="left"><a href="https://github.com/MaTeMaTuK/gantt-task-react" target="_blank" rel="nofollow noreferrer noopener">gantt-task-react</a></td>\n<td align="left">与 UI 最为接近</td>\n<td align="left">左侧文字展示功能较弱，只能展示固定的几个字段；关键样式没有暴露，不好做定制化</td>\n</tr>\n</tbody>\n</table>\n<h1 id="技术难点"><a href="#%E6%8A%80%E6%9C%AF%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术难点</h1>\n<p>需要针对 gantt-task-react 的源码做功能的增强：</p>\n<ol>\n<li>左侧文字展示功能增强</li>\n<li>样式属性暴露</li>\n</ol>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<p>所有代码在<a href="https://github.com/towavephone/gantt-task-react/commit/01ef13b7623e2f1bc2fe0b483093d4b84f5edb2f" target="_blank" rel="nofollow noreferrer noopener">这里</a>，这里只展示核心逻辑</p>\n<h2 id="左侧文字展示功能"><a href="#%E5%B7%A6%E4%BE%A7%E6%96%87%E5%AD%97%E5%B1%95%E7%A4%BA%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>左侧文字展示功能</h2>\n<p>左侧文字展示的功能和 antd 的列表渲染 API 一致</p>\n<h3 id="表头渲染"><a href="#%E8%A1%A8%E5%A4%B4%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>表头渲染</h3>\n<p>主要功能如下：</p>\n<ol>\n<li>表头的宽度</li>\n<li>标题渲染</li>\n</ol>\n<p>src/components/task-list/task-list-header.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31124831894145590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from &quot;react&quot;;\n+ import { ListColumn } from &quot;../../types/public-types&quot;;\nimport styles from &quot;./task-list-header.module.css&quot;;\n\nexport const TaskListHeaderDefault: React.FC<{\n  headerHeight: number;\n  rowWidth: string;\n  fontFamily: string;\n  fontSize: string;\n- }> = ({ headerHeight, fontFamily, fontSize, rowWidth }) => {\n+ listColumns: ListColumn[];\n+ }> = ({ headerHeight, fontFamily, fontSize, listColumns, rowWidth }) => {\n  return (\n    <div\n      className={styles.ganttTable}\n      style={{\n        fontFamily: fontFamily,\n        fontSize: fontSize,\n+       width: rowWidth,\n      }}\n    >\n      <div\n@@ -21,44 +24,17 @@ export const TaskListHeaderDefault: React.FC<{\n          height: headerHeight - 2,\n        }}\n      >\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;Name\n-       </div>\n-       <div\n-         className={styles.ganttTable_HeaderSeparator}\n-         style={{\n-           height: headerHeight * 0.5,\n-           marginTop: headerHeight * 0.2,\n-         }}\n-       />\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;From\n-       </div>\n-       <div\n-         className={styles.ganttTable_HeaderSeparator}\n-         style={{\n-           height: headerHeight * 0.5,\n-           marginTop: headerHeight * 0.25,\n-         }}\n-       />\n-       <div\n-         className={styles.ganttTable_HeaderItem}\n-         style={{\n-           minWidth: rowWidth,\n-         }}\n-       >\n-         &nbsp;To\n-       </div>\n+       {listColumns.map(item => (\n+         <div\n+           key={item.key || item.dataIndex}\n+           className={styles.ganttTable_HeaderItem}\n+           style={{\n+             width: item.width || &quot;auto&quot;,\n+           }}\n+         >\n+           {item.title}\n+         </div>\n+       ))}\n      </div>\n    </div>\n  );`, `31124831894145590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff">import React from "react";\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import { ListColumn } from "../../types/public-types";\n</span>import styles from "./task-list-header.module.css";\n\nexport const TaskListHeaderDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> headerHeight: number;\n<span class="token prefix unchanged"> </span> rowWidth: string;\n<span class="token prefix unchanged"> </span> fontFamily: string;\n<span class="token prefix unchanged"> </span> fontSize: string;\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> }> = ({ headerHeight, fontFamily, fontSize, rowWidth }) => {\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns: ListColumn[];\n<span class="token prefix inserted">+</span> }> = ({ headerHeight, fontFamily, fontSize, listColumns, rowWidth }) => {\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> return (\n<span class="token prefix unchanged"> </span>   &lt;div\n<span class="token prefix unchanged"> </span>     className={styles.ganttTable}\n<span class="token prefix unchanged"> </span>     style={{\n<span class="token prefix unchanged"> </span>       fontFamily: fontFamily,\n<span class="token prefix unchanged"> </span>       fontSize: fontSize,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       width: rowWidth,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     }}\n<span class="token prefix unchanged"> </span>   >\n<span class="token prefix unchanged"> </span>     &lt;div\n</span>@@ -21,44 +24,17 @@ export const TaskListHeaderDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span>         height: headerHeight - 2,\n<span class="token prefix unchanged"> </span>       }}\n<span class="token prefix unchanged"> </span>     >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;Name\n<span class="token prefix deleted">-</span>       &lt;/div>\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderSeparator}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           height: headerHeight * 0.5,\n<span class="token prefix deleted">-</span>           marginTop: headerHeight * 0.2,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       />\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;From\n<span class="token prefix deleted">-</span>       &lt;/div>\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderSeparator}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           height: headerHeight * 0.5,\n<span class="token prefix deleted">-</span>           marginTop: headerHeight * 0.25,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       />\n<span class="token prefix deleted">-</span>       &lt;div\n<span class="token prefix deleted">-</span>         className={styles.ganttTable_HeaderItem}\n<span class="token prefix deleted">-</span>         style={{\n<span class="token prefix deleted">-</span>           minWidth: rowWidth,\n<span class="token prefix deleted">-</span>         }}\n<span class="token prefix deleted">-</span>       >\n<span class="token prefix deleted">-</span>         &amp;nbsp;To\n<span class="token prefix deleted">-</span>       &lt;/div>\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       {listColumns.map(item => (\n<span class="token prefix inserted">+</span>         &lt;div\n<span class="token prefix inserted">+</span>           key={item.key || item.dataIndex}\n<span class="token prefix inserted">+</span>           className={styles.ganttTable_HeaderItem}\n<span class="token prefix inserted">+</span>           style={{\n<span class="token prefix inserted">+</span>             width: item.width || "auto",\n<span class="token prefix inserted">+</span>           }}\n<span class="token prefix inserted">+</span>         >\n<span class="token prefix inserted">+</span>           {item.title}\n<span class="token prefix inserted">+</span>         &lt;/div>\n<span class="token prefix inserted">+</span>       ))}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     &lt;/div>\n<span class="token prefix unchanged"> </span>   &lt;/div>\n<span class="token prefix unchanged"> </span> );</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="列表内容渲染"><a href="#%E5%88%97%E8%A1%A8%E5%86%85%E5%AE%B9%E6%B8%B2%E6%9F%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>列表内容渲染</h3>\n<p>主要功能如下：</p>\n<ol>\n<li>表格宽度</li>\n<li>列表内容渲染</li>\n<li>表格行、列单元格合并</li>\n<li>表格长标题过长时省略</li>\n</ol>\n<p>src/components/task-list/task-list-table.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54239180507085890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`- import React, { useMemo } from &quot;react&quot;;\n+ import React from &quot;react&quot;;\n+ import classnames from &quot;classnames&quot;;\n+\nimport styles from &quot;./task-list-table.module.css&quot;;\n- import { Task } from &quot;../../types/public-types&quot;;\n+ import { Task, ListColumn } from &quot;../../types/public-types&quot;;\n+ import { getPathValue } from &quot;../../helpers/other-helper&quot;;\n\n- const localeDateStringCache = {};\n- const toLocaleDateStringFactory = (locale: string) => (\n-   date: Date,\n-   dateTimeOptions: Intl.DateTimeFormatOptions\n- ) => {\n-   const key = date.toString();\n-   let lds = localeDateStringCache[key];\n-   if (!lds) {\n-     lds = date.toLocaleDateString(locale, dateTimeOptions);\n-     localeDateStringCache[key] = lds;\n-   }\n-   return lds;\n- };\n- const dateTimeOptions: Intl.DateTimeFormatOptions = {\n-   weekday: &quot;short&quot;,\n-   year: &quot;numeric&quot;,\n-   month: &quot;long&quot;,\n-   day: &quot;numeric&quot;,\n- };\n\n+ function isRenderCell(data: any) {\n+   return (\n+     data &&\n+     typeof data === &quot;object&quot; &&\n+     !Array.isArray(data) &&\n+     !React.isValidElement(data)\n+   );\n+ }\n\nexport const TaskListTableDefault: React.FC<{\n  rowHeight: number;\n@@ -32,84 +44,153 @@ export const TaskListTableDefault: React.FC<{\n  selectedTaskId: string;\n  setSelectedTask: (taskId: string) => void;\n  onExpanderClick: (task: Task) => void;\n+ listColumns: ListColumn[];\n}> = ({\n  rowHeight,\n  rowWidth,\n  tasks,\n  fontFamily,\n  fontSize,\n- locale,\n  onExpanderClick,\n+ listColumns,\n}) => {\n- const toLocaleDateString = useMemo(() => toLocaleDateStringFactory(locale), [\n-   locale,\n- ]);\n\n  return (\n-   <div\n+   <table\n      className={styles.taskListWrapper}\n      style={{\n        fontFamily: fontFamily,\n        fontSize: fontSize,\n+       width: rowWidth,\n      }}\n    >\n-     {tasks.map(t => {\n-       let expanderSymbol = &quot;&quot;;\n-       if (t.hideChildren === false) {\n-         expanderSymbol = &quot;▼&quot;;\n-       } else if (t.hideChildren === true) {\n-         expanderSymbol = &quot;▶&quot;;\n-       }\n+     <tbody>\n+       {tasks.map((t, index) => {\n+         let expanderSymbol = &quot;&quot;;\n+         if (t.hideChildren === false) {\n+           expanderSymbol = &quot;▼&quot;;\n+         } else if (t.hideChildren === true) {\n+           expanderSymbol = &quot;▶&quot;;\n+         }\n\n-       return (\n-         <div\n-           className={styles.taskListTableRow}\n-           style={{ height: rowHeight }}\n-           key={\\`\\${t.id}row\\`}\n-         >\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-             title={t.name}\n+         return (\n+           <tr\n+             className={styles.taskListTableRow}\n+             style={{ height: rowHeight }}\n+             key={\\`\\${t.id}row\\`}\n            >\n-             <div className={styles.taskListNameWrapper}>\n-               <div\n-                 className={\n-                   expanderSymbol\n-                     ? styles.taskListExpander\n-                     : styles.taskListEmptyExpander\n+             {listColumns.map(item => {\n+               let childNode: any;\n+               let cellProps;\n+               if (item.children) {\n+                 childNode = item.children;\n+               } else {\n+                 const value = getPathValue(t, item.dataIndex);\n+                 childNode = value;\n+                 if (item.render) {\n+                   const renderData = item.render(value, t, index);\n+                   if (isRenderCell(renderData)) {\n+                     childNode = renderData.children;\n+                     cellProps = renderData.props;\n+                   } else {\n+                     childNode = renderData;\n+                   }\n                  }\n-                 onClick={() => onExpanderClick(t)}\n-               >\n-                 {expanderSymbol}\n-               </div>\n-               <div>{t.name}</div>\n-             </div>\n-           </div>\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-           >\n-             &nbsp;{toLocaleDateString(t.start, dateTimeOptions)}\n-           </div>\n-           <div\n-             className={styles.taskListCell}\n-             style={{\n-               minWidth: rowWidth,\n-               maxWidth: rowWidth,\n-             }}\n-           >\n-             &nbsp;{toLocaleDateString(t.end, dateTimeOptions)}\n-           </div>\n-         </div>\n-       );\n-     })}\n-   </div>\n+               }\n+               if (\n+                 typeof childNode === &quot;object&quot; &&\n+                 !Array.isArray(childNode) &&\n+                 !React.isValidElement(childNode)\n+               ) {\n+                 childNode = null;\n+               }\n+               const { colSpan: cellColSpan, rowSpan: cellRowSpan } =\n+                 cellProps || {};\n+               const mergedColSpan =\n+                 cellColSpan !== undefined ? cellColSpan : item.colSpan;\n+               const mergedRowSpan =\n+                 cellRowSpan !== undefined ? cellRowSpan : item.rowSpan;\n+               if (mergedColSpan === 0 || mergedRowSpan === 0) {\n+                 return null;\n+               }\n+               let title;\n+               const ellipsisConfig =\n+                 item.ellipsis === true\n+                   ? {\n+                       showTitle: true,\n+                     }\n+                   : item.ellipsis;\n+               if (ellipsisConfig && ellipsisConfig.showTitle) {\n+                 if (\n+                   typeof childNode === &quot;string&quot; ||\n+                   typeof childNode === &quot;number&quot;\n+                 ) {\n+                   title = childNode.toString();\n+                 } else if (\n+                   React.isValidElement(childNode) &&\n+                   // @ts-ignore\n+                   typeof childNode.props.children === &quot;string&quot;\n+                 ) {\n+                   // @ts-ignore\n+                   title = childNode.props.children;\n+                 }\n+               }\n+               return (\n+                 <td\n+                   key={item.key || item.dataIndex}\n+                   className={classnames(\n+                     styles.taskListCell,\n+                     item.ellipsis ? styles.ellipsis : &quot;&quot;\n+                   )}\n+                   style={{\n+                     width: item.width || &quot;auto&quot;,\n+                   }}\n+                   colSpan={\n+                     mergedColSpan && mergedColSpan !== 1\n+                       ? mergedColSpan\n+                       : null\n+                   }\n+                   rowSpan={\n+                     mergedRowSpan && mergedRowSpan !== 1\n+                       ? mergedRowSpan\n+                       : null\n+                   }\n+                 >\n+                   <div className={styles.taskListNameWrapper}>\n+                     <div\n+                       className={\n+                         expanderSymbol\n+                           ? styles.taskListExpander\n+                           : styles.taskListEmptyExpander\n+                       }\n+                       onClick={() => onExpanderClick(t)}\n+                     >\n+                       {expanderSymbol}\n+                     </div>\n+                     <div title={title} className={styles.ellipsis}>\n+                       {childNode}\n+                     </div>\n+                   </div>\n+                 </td>\n+               );\n+             })}\n+           </tr>\n+         );\n+       })}\n+     </tbody>\n+   </table>\n  );\n};`, `54239180507085890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> import React, { useMemo } from "react";\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import React from "react";\n<span class="token prefix inserted">+</span> import classnames from "classnames";\n<span class="token prefix inserted">+</span>\n</span>import styles from "./task-list-table.module.css";\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> import { Task } from "../../types/public-types";\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> import { Task, ListColumn } from "../../types/public-types";\n<span class="token prefix inserted">+</span> import { getPathValue } from "../../helpers/other-helper";\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> const localeDateStringCache = {};\n<span class="token prefix deleted">-</span> const toLocaleDateStringFactory = (locale: string) => (\n<span class="token prefix deleted">-</span>   date: Date,\n<span class="token prefix deleted">-</span>   dateTimeOptions: Intl.DateTimeFormatOptions\n<span class="token prefix deleted">-</span> ) => {\n<span class="token prefix deleted">-</span>   const key = date.toString();\n<span class="token prefix deleted">-</span>   let lds = localeDateStringCache[key];\n<span class="token prefix deleted">-</span>   if (!lds) {\n<span class="token prefix deleted">-</span>     lds = date.toLocaleDateString(locale, dateTimeOptions);\n<span class="token prefix deleted">-</span>     localeDateStringCache[key] = lds;\n<span class="token prefix deleted">-</span>   }\n<span class="token prefix deleted">-</span>   return lds;\n<span class="token prefix deleted">-</span> };\n<span class="token prefix deleted">-</span> const dateTimeOptions: Intl.DateTimeFormatOptions = {\n<span class="token prefix deleted">-</span>   weekday: "short",\n<span class="token prefix deleted">-</span>   year: "numeric",\n<span class="token prefix deleted">-</span>   month: "long",\n<span class="token prefix deleted">-</span>   day: "numeric",\n<span class="token prefix deleted">-</span> };\n</span>\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> function isRenderCell(data: any) {\n<span class="token prefix inserted">+</span>   return (\n<span class="token prefix inserted">+</span>     data &amp;&amp;\n<span class="token prefix inserted">+</span>     typeof data === "object" &amp;&amp;\n<span class="token prefix inserted">+</span>     !Array.isArray(data) &amp;&amp;\n<span class="token prefix inserted">+</span>     !React.isValidElement(data)\n<span class="token prefix inserted">+</span>   );\n<span class="token prefix inserted">+</span> }\n</span>\nexport const TaskListTableDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> rowHeight: number;\n</span>@@ -32,84 +44,153 @@ export const TaskListTableDefault: React.FC&lt;{\n<span class="token unchanged"><span class="token prefix unchanged"> </span> selectedTaskId: string;\n<span class="token prefix unchanged"> </span> setSelectedTask: (taskId: string) => void;\n<span class="token prefix unchanged"> </span> onExpanderClick: (task: Task) => void;\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns: ListColumn[];\n</span>}> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> rowHeight,\n<span class="token prefix unchanged"> </span> rowWidth,\n<span class="token prefix unchanged"> </span> tasks,\n<span class="token prefix unchanged"> </span> fontFamily,\n<span class="token prefix unchanged"> </span> fontSize,\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> locale,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> onExpanderClick,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> listColumns,\n</span>}) => {\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> const toLocaleDateString = useMemo(() => toLocaleDateStringFactory(locale), [\n<span class="token prefix deleted">-</span>   locale,\n<span class="token prefix deleted">-</span> ]);\n</span>\n<span class="token unchanged"><span class="token prefix unchanged"> </span> return (\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   &lt;div\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   &lt;table\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     className={styles.taskListWrapper}\n<span class="token prefix unchanged"> </span>     style={{\n<span class="token prefix unchanged"> </span>       fontFamily: fontFamily,\n<span class="token prefix unchanged"> </span>       fontSize: fontSize,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>       width: rowWidth,\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>     }}\n<span class="token prefix unchanged"> </span>   >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>     {tasks.map(t => {\n<span class="token prefix deleted">-</span>       let expanderSymbol = "";\n<span class="token prefix deleted">-</span>       if (t.hideChildren === false) {\n<span class="token prefix deleted">-</span>         expanderSymbol = "▼";\n<span class="token prefix deleted">-</span>       } else if (t.hideChildren === true) {\n<span class="token prefix deleted">-</span>         expanderSymbol = "▶";\n<span class="token prefix deleted">-</span>       }\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>     &lt;tbody>\n<span class="token prefix inserted">+</span>       {tasks.map((t, index) => {\n<span class="token prefix inserted">+</span>         let expanderSymbol = "";\n<span class="token prefix inserted">+</span>         if (t.hideChildren === false) {\n<span class="token prefix inserted">+</span>           expanderSymbol = "▼";\n<span class="token prefix inserted">+</span>         } else if (t.hideChildren === true) {\n<span class="token prefix inserted">+</span>           expanderSymbol = "▶";\n<span class="token prefix inserted">+</span>         }\n</span>\n<span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>       return (\n<span class="token prefix deleted">-</span>         &lt;div\n<span class="token prefix deleted">-</span>           className={styles.taskListTableRow}\n<span class="token prefix deleted">-</span>           style={{ height: rowHeight }}\n<span class="token prefix deleted">-</span>           key={`${t.id}row`}\n<span class="token prefix deleted">-</span>         >\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>             title={t.name}\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>         return (\n<span class="token prefix inserted">+</span>           &lt;tr\n<span class="token prefix inserted">+</span>             className={styles.taskListTableRow}\n<span class="token prefix inserted">+</span>             style={{ height: rowHeight }}\n<span class="token prefix inserted">+</span>             key={`${t.id}row`}\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>           >\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>             &lt;div className={styles.taskListNameWrapper}>\n<span class="token prefix deleted">-</span>               &lt;div\n<span class="token prefix deleted">-</span>                 className={\n<span class="token prefix deleted">-</span>                   expanderSymbol\n<span class="token prefix deleted">-</span>                     ? styles.taskListExpander\n<span class="token prefix deleted">-</span>                     : styles.taskListEmptyExpander\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>             {listColumns.map(item => {\n<span class="token prefix inserted">+</span>               let childNode: any;\n<span class="token prefix inserted">+</span>               let cellProps;\n<span class="token prefix inserted">+</span>               if (item.children) {\n<span class="token prefix inserted">+</span>                 childNode = item.children;\n<span class="token prefix inserted">+</span>               } else {\n<span class="token prefix inserted">+</span>                 const value = getPathValue(t, item.dataIndex);\n<span class="token prefix inserted">+</span>                 childNode = value;\n<span class="token prefix inserted">+</span>                 if (item.render) {\n<span class="token prefix inserted">+</span>                   const renderData = item.render(value, t, index);\n<span class="token prefix inserted">+</span>                   if (isRenderCell(renderData)) {\n<span class="token prefix inserted">+</span>                     childNode = renderData.children;\n<span class="token prefix inserted">+</span>                     cellProps = renderData.props;\n<span class="token prefix inserted">+</span>                   } else {\n<span class="token prefix inserted">+</span>                     childNode = renderData;\n<span class="token prefix inserted">+</span>                   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>                 }\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>                 onClick={() => onExpanderClick(t)}\n<span class="token prefix deleted">-</span>               >\n<span class="token prefix deleted">-</span>                 {expanderSymbol}\n<span class="token prefix deleted">-</span>               &lt;/div>\n<span class="token prefix deleted">-</span>               &lt;div>{t.name}&lt;/div>\n<span class="token prefix deleted">-</span>             &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>           >\n<span class="token prefix deleted">-</span>             &amp;nbsp;{toLocaleDateString(t.start, dateTimeOptions)}\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>           &lt;div\n<span class="token prefix deleted">-</span>             className={styles.taskListCell}\n<span class="token prefix deleted">-</span>             style={{\n<span class="token prefix deleted">-</span>               minWidth: rowWidth,\n<span class="token prefix deleted">-</span>               maxWidth: rowWidth,\n<span class="token prefix deleted">-</span>             }}\n<span class="token prefix deleted">-</span>           >\n<span class="token prefix deleted">-</span>             &amp;nbsp;{toLocaleDateString(t.end, dateTimeOptions)}\n<span class="token prefix deleted">-</span>           &lt;/div>\n<span class="token prefix deleted">-</span>         &lt;/div>\n<span class="token prefix deleted">-</span>       );\n<span class="token prefix deleted">-</span>     })}\n<span class="token prefix deleted">-</span>   &lt;/div>\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               if (\n<span class="token prefix inserted">+</span>                 typeof childNode === "object" &amp;&amp;\n<span class="token prefix inserted">+</span>                 !Array.isArray(childNode) &amp;&amp;\n<span class="token prefix inserted">+</span>                 !React.isValidElement(childNode)\n<span class="token prefix inserted">+</span>               ) {\n<span class="token prefix inserted">+</span>                 childNode = null;\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               const { colSpan: cellColSpan, rowSpan: cellRowSpan } =\n<span class="token prefix inserted">+</span>                 cellProps || {};\n<span class="token prefix inserted">+</span>               const mergedColSpan =\n<span class="token prefix inserted">+</span>                 cellColSpan !== undefined ? cellColSpan : item.colSpan;\n<span class="token prefix inserted">+</span>               const mergedRowSpan =\n<span class="token prefix inserted">+</span>                 cellRowSpan !== undefined ? cellRowSpan : item.rowSpan;\n<span class="token prefix inserted">+</span>               if (mergedColSpan === 0 || mergedRowSpan === 0) {\n<span class="token prefix inserted">+</span>                 return null;\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               let title;\n<span class="token prefix inserted">+</span>               const ellipsisConfig =\n<span class="token prefix inserted">+</span>                 item.ellipsis === true\n<span class="token prefix inserted">+</span>                   ? {\n<span class="token prefix inserted">+</span>                       showTitle: true,\n<span class="token prefix inserted">+</span>                     }\n<span class="token prefix inserted">+</span>                   : item.ellipsis;\n<span class="token prefix inserted">+</span>               if (ellipsisConfig &amp;&amp; ellipsisConfig.showTitle) {\n<span class="token prefix inserted">+</span>                 if (\n<span class="token prefix inserted">+</span>                   typeof childNode === "string" ||\n<span class="token prefix inserted">+</span>                   typeof childNode === "number"\n<span class="token prefix inserted">+</span>                 ) {\n<span class="token prefix inserted">+</span>                   title = childNode.toString();\n<span class="token prefix inserted">+</span>                 } else if (\n<span class="token prefix inserted">+</span>                   React.isValidElement(childNode) &amp;&amp;\n<span class="token prefix inserted">+</span>                   // @ts-ignore\n<span class="token prefix inserted">+</span>                   typeof childNode.props.children === "string"\n<span class="token prefix inserted">+</span>                 ) {\n<span class="token prefix inserted">+</span>                   // @ts-ignore\n<span class="token prefix inserted">+</span>                   title = childNode.props.children;\n<span class="token prefix inserted">+</span>                 }\n<span class="token prefix inserted">+</span>               }\n<span class="token prefix inserted">+</span>               return (\n<span class="token prefix inserted">+</span>                 &lt;td\n<span class="token prefix inserted">+</span>                   key={item.key || item.dataIndex}\n<span class="token prefix inserted">+</span>                   className={classnames(\n<span class="token prefix inserted">+</span>                     styles.taskListCell,\n<span class="token prefix inserted">+</span>                     item.ellipsis ? styles.ellipsis : ""\n<span class="token prefix inserted">+</span>                   )}\n<span class="token prefix inserted">+</span>                   style={{\n<span class="token prefix inserted">+</span>                     width: item.width || "auto",\n<span class="token prefix inserted">+</span>                   }}\n<span class="token prefix inserted">+</span>                   colSpan={\n<span class="token prefix inserted">+</span>                     mergedColSpan &amp;&amp; mergedColSpan !== 1\n<span class="token prefix inserted">+</span>                       ? mergedColSpan\n<span class="token prefix inserted">+</span>                       : null\n<span class="token prefix inserted">+</span>                   }\n<span class="token prefix inserted">+</span>                   rowSpan={\n<span class="token prefix inserted">+</span>                     mergedRowSpan &amp;&amp; mergedRowSpan !== 1\n<span class="token prefix inserted">+</span>                       ? mergedRowSpan\n<span class="token prefix inserted">+</span>                       : null\n<span class="token prefix inserted">+</span>                   }\n<span class="token prefix inserted">+</span>                 >\n<span class="token prefix inserted">+</span>                   &lt;div className={styles.taskListNameWrapper}>\n<span class="token prefix inserted">+</span>                     &lt;div\n<span class="token prefix inserted">+</span>                       className={\n<span class="token prefix inserted">+</span>                         expanderSymbol\n<span class="token prefix inserted">+</span>                           ? styles.taskListExpander\n<span class="token prefix inserted">+</span>                           : styles.taskListEmptyExpander\n<span class="token prefix inserted">+</span>                       }\n<span class="token prefix inserted">+</span>                       onClick={() => onExpanderClick(t)}\n<span class="token prefix inserted">+</span>                     >\n<span class="token prefix inserted">+</span>                       {expanderSymbol}\n<span class="token prefix inserted">+</span>                     &lt;/div>\n<span class="token prefix inserted">+</span>                     &lt;div title={title} className={styles.ellipsis}>\n<span class="token prefix inserted">+</span>                       {childNode}\n<span class="token prefix inserted">+</span>                     &lt;/div>\n<span class="token prefix inserted">+</span>                   &lt;/div>\n<span class="token prefix inserted">+</span>                 &lt;/td>\n<span class="token prefix inserted">+</span>               );\n<span class="token prefix inserted">+</span>             })}\n<span class="token prefix inserted">+</span>           &lt;/tr>\n<span class="token prefix inserted">+</span>         );\n<span class="token prefix inserted">+</span>       })}\n<span class="token prefix inserted">+</span>     &lt;/tbody>\n<span class="token prefix inserted">+</span>   &lt;/table>\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span> );\n</span>};</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="样式属性暴露"><a href="#%E6%A0%B7%E5%BC%8F%E5%B1%9E%E6%80%A7%E6%9A%B4%E9%9C%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>样式属性暴露</h2>\n<p>主要功能如下：</p>\n<ol>\n<li>行级斑马线显示</li>\n<li>日期分隔线显示</li>\n<li>行级分隔线显示</li>\n</ol>\n<p>src/components/grid/grid-body.tsx</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68674334598012084000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  columnWidth: number;\n  todayColor: string;\n  rtl: boolean;\n+  hasCrosswalk: boolean;\n+  hasDateLine: boolean;\n+  renderRowLines: (index: number) => boolean;\n};\n+\nexport const GridBody: React.FC<GridBodyProps> = ({\n  tasks,\n  dates,\n@@ -20,6 +24,9 @@ export const GridBody: React.FC<GridBodyProps> = ({\n  columnWidth,\n  todayColor,\n  rtl,\n+ hasCrosswalk,\n+ hasDateLine,\n+ renderRowLines,\n}) => {\n  let y = 0;\n  const gridRows: ReactChild[] = [];\n@@ -33,27 +40,33 @@ export const GridBody: React.FC<GridBodyProps> = ({\n      className={styles.gridRowLine}\n    />,\n  ];\n- for (const task of tasks) {\n-   gridRows.push(\n-     <rect\n-       key={&quot;Row&quot; + task.id}\n-       x=&quot;0&quot;\n-       y={y}\n-       width={svgWidth}\n-       height={rowHeight}\n-       className={styles.gridRow}\n-     />\n-   );\n-   rowLines.push(\n-     <line\n-       key={&quot;RowLine&quot; + task.id}\n-       x=&quot;0&quot;\n-       y1={y + rowHeight}\n-       x2={svgWidth}\n-       y2={y + rowHeight}\n-       className={styles.gridRowLine}\n-     />\n-   );\n+ for (let i = 0; i < tasks.length; i++) {\n+   const task = tasks[i];\n+   if (hasCrosswalk) {\n+     gridRows.push(\n+       <rect\n+         key={&quot;Row&quot; + task.id}\n+         x=&quot;0&quot;\n+         y={y}\n+         width={svgWidth}\n+         height={rowHeight}\n+         className={styles.gridRow}\n+       />\n+     );\n+   }\n+   const isRenderRowLines = renderRowLines(i);\n+   if (isRenderRowLines) {\n+     rowLines.push(\n+       <line\n+         key={&quot;RowLine&quot; + task.id}\n+         x=&quot;0&quot;\n+         y1={y + rowHeight}\n+         x2={svgWidth}\n+         y2={y + rowHeight}\n+         className={styles.gridRowLine}\n+       />\n+     );\n+   }\n    y += rowHeight;\n  }\n\n@@ -63,16 +76,18 @@ export const GridBody: React.FC<GridBodyProps> = ({\n  let today: ReactChild = <rect />;\n  for (let i = 0; i < dates.length; i++) {\n    const date = dates[i];\n-   ticks.push(\n-     <line\n-       key={date.getTime()}\n-       x1={tickX}\n-       y1={0}\n-       x2={tickX}\n-       y2={y}\n-       className={styles.gridTick}\n-     />\n-   );\n+   if (hasDateLine) {\n+     ticks.push(\n+       <line\n+         key={date.getTime()}\n+         x1={tickX}\n+         y1={0}\n+         x2={tickX}\n+         y2={y}\n+         className={styles.gridTick}\n+       />\n+     );\n+   }\n    if (\n      (i + 1 !== dates.length &&\n        date.getTime() < now.getTime() &&`, `68674334598012084000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="diff"\n              >\n                <span class="gatsby-code-button-language">diff</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="diff"><pre style="counter-reset: linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span> columnWidth: number;\n<span class="token prefix unchanged"> </span> todayColor: string;\n<span class="token prefix unchanged"> </span> rtl: boolean;\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>  hasCrosswalk: boolean;\n<span class="token prefix inserted">+</span>  hasDateLine: boolean;\n<span class="token prefix inserted">+</span>  renderRowLines: (index: number) => boolean;\n</span>};\n<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>\n</span>export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> tasks,\n<span class="token prefix unchanged"> </span> dates,\n</span>@@ -20,6 +24,9 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> columnWidth,\n<span class="token prefix unchanged"> </span> todayColor,\n<span class="token prefix unchanged"> </span> rtl,\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> hasCrosswalk,\n<span class="token prefix inserted">+</span> hasDateLine,\n<span class="token prefix inserted">+</span> renderRowLines,\n</span>}) => {\n<span class="token unchanged"><span class="token prefix unchanged"> </span> let y = 0;\n<span class="token prefix unchanged"> </span> const gridRows: ReactChild[] = [];\n</span>@@ -33,27 +40,33 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span>     className={styles.gridRowLine}\n<span class="token prefix unchanged"> </span>   />,\n<span class="token prefix unchanged"> </span> ];\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span> for (const task of tasks) {\n<span class="token prefix deleted">-</span>   gridRows.push(\n<span class="token prefix deleted">-</span>     &lt;rect\n<span class="token prefix deleted">-</span>       key={"Row" + task.id}\n<span class="token prefix deleted">-</span>       x="0"\n<span class="token prefix deleted">-</span>       y={y}\n<span class="token prefix deleted">-</span>       width={svgWidth}\n<span class="token prefix deleted">-</span>       height={rowHeight}\n<span class="token prefix deleted">-</span>       className={styles.gridRow}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n<span class="token prefix deleted">-</span>   rowLines.push(\n<span class="token prefix deleted">-</span>     &lt;line\n<span class="token prefix deleted">-</span>       key={"RowLine" + task.id}\n<span class="token prefix deleted">-</span>       x="0"\n<span class="token prefix deleted">-</span>       y1={y + rowHeight}\n<span class="token prefix deleted">-</span>       x2={svgWidth}\n<span class="token prefix deleted">-</span>       y2={y + rowHeight}\n<span class="token prefix deleted">-</span>       className={styles.gridRowLine}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span> for (let i = 0; i &lt; tasks.length; i++) {\n<span class="token prefix inserted">+</span>   const task = tasks[i];\n<span class="token prefix inserted">+</span>   if (hasCrosswalk) {\n<span class="token prefix inserted">+</span>     gridRows.push(\n<span class="token prefix inserted">+</span>       &lt;rect\n<span class="token prefix inserted">+</span>         key={"Row" + task.id}\n<span class="token prefix inserted">+</span>         x="0"\n<span class="token prefix inserted">+</span>         y={y}\n<span class="token prefix inserted">+</span>         width={svgWidth}\n<span class="token prefix inserted">+</span>         height={rowHeight}\n<span class="token prefix inserted">+</span>         className={styles.gridRow}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n<span class="token prefix inserted">+</span>   const isRenderRowLines = renderRowLines(i);\n<span class="token prefix inserted">+</span>   if (isRenderRowLines) {\n<span class="token prefix inserted">+</span>     rowLines.push(\n<span class="token prefix inserted">+</span>       &lt;line\n<span class="token prefix inserted">+</span>         key={"RowLine" + task.id}\n<span class="token prefix inserted">+</span>         x="0"\n<span class="token prefix inserted">+</span>         y1={y + rowHeight}\n<span class="token prefix inserted">+</span>         x2={svgWidth}\n<span class="token prefix inserted">+</span>         y2={y + rowHeight}\n<span class="token prefix inserted">+</span>         className={styles.gridRowLine}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   y += rowHeight;\n<span class="token prefix unchanged"> </span> }\n</span>\n@@ -63,16 +76,18 @@ export const GridBody: React.FC&lt;GridBodyProps> = ({\n<span class="token unchanged"><span class="token prefix unchanged"> </span> let today: ReactChild = &lt;rect />;\n<span class="token prefix unchanged"> </span> for (let i = 0; i &lt; dates.length; i++) {\n<span class="token prefix unchanged"> </span>   const date = dates[i];\n</span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>   ticks.push(\n<span class="token prefix deleted">-</span>     &lt;line\n<span class="token prefix deleted">-</span>       key={date.getTime()}\n<span class="token prefix deleted">-</span>       x1={tickX}\n<span class="token prefix deleted">-</span>       y1={0}\n<span class="token prefix deleted">-</span>       x2={tickX}\n<span class="token prefix deleted">-</span>       y2={y}\n<span class="token prefix deleted">-</span>       className={styles.gridTick}\n<span class="token prefix deleted">-</span>     />\n<span class="token prefix deleted">-</span>   );\n</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>   if (hasDateLine) {\n<span class="token prefix inserted">+</span>     ticks.push(\n<span class="token prefix inserted">+</span>       &lt;line\n<span class="token prefix inserted">+</span>         key={date.getTime()}\n<span class="token prefix inserted">+</span>         x1={tickX}\n<span class="token prefix inserted">+</span>         y1={0}\n<span class="token prefix inserted">+</span>         x2={tickX}\n<span class="token prefix inserted">+</span>         y2={y}\n<span class="token prefix inserted">+</span>         className={styles.gridTick}\n<span class="token prefix inserted">+</span>       />\n<span class="token prefix inserted">+</span>     );\n<span class="token prefix inserted">+</span>   }\n</span><span class="token unchanged"><span class="token prefix unchanged"> </span>   if (\n<span class="token prefix unchanged"> </span>     (i + 1 !== dates.length &amp;&amp;\n<span class="token prefix unchanged"> </span>       date.getTime() &lt; now.getTime() &amp;&amp;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h1>\n<p><html><head></head><body><iframe data-src="https://codesandbox.io/embed/vtuj8t?codemirror=1&amp;hidenavigation=1&amp;theme=light&amp;view=split" class="embedded-codesandbox lazy" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin allow-downloads"></iframe></body></html></p>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<ol>\n<li>ts 写的不够熟练且精简，需要加强</li>\n<li>对于样式属性暴露应该用固定类名去控制，原作者包含很多的 className 属性，非常冗余</li>\n<li>本地源码优化很少涉及到 svg 的优化，需要加强 svg 的学习</li>\n</ol>',
excerpt:"需求背景 由于 PMS 项目需要开发如下图所示的甘特图，需要选择合适的组件来实现此功能 技术选型 选型 优点 缺点 gantt-schedule-timeline-calendar 功能丰富 与 UI 相差较大，定制化代码较多 react-timeline-gantt…",frontmatter:{date:"2021-11-15 11:48:33",path:"/gantt-component-optimization/",tags:"前端, 源码优化, 预研",title:"甘特图组件源码优化",draft:null}}},pathContext:{mainPostPath:"/code-generation-scaffolding/",nextPostPath:"/tweb-learn-note-2021/",prePostPath:"/gantt-component-optimization/"}}}});