webpackJsonp([0xbcfc9f79f41d],{1418:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"DOM 测试一 具体实现 我的解答 最佳解答 实现要点 获取所有 a 元素，两种方法：document.getElementsByTagName(‘a’) 所有浏览器都支持，还有 document.querySeletorAll(‘a’)，IE8+。 答案是：document.links 或者 document.querySelectorAll(‘:link’)都是可以的。链接元素和 元素的区别：首先没有 href 属性的 元素不是链接元素，其次链接元素还包括 元素（带 href…",html:'<h1 id="dom-测试一"><a href="#dom-%E6%B5%8B%E8%AF%95%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试一</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-07-22-16-30-47-8137d8f8092d06bf7562bd128d106051-c6c9e.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 606px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 128.54785478547853%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACPUlEQVQ4y61U2U4jMRDM/38GT0gIBIrISgjeWUgisU8oIWROe27P7Tk9W57JhiRkQbtQslqOx9Xtru7OqPsCRkKItm0PTuM4tizLMIzFYqHrGmOsbcUR8sFv+IIlpvn09Ov+/uePyWT6+LhcLvOcD1+LongjJ0kyn88Ravg2kA9QlmWapk3TVFWFV9Q9cHMURdFsOjMMPcvzouBZzrf8tsffPG5yLssiCBiCs5CxMMzgJs8R6iCXI2T4zrI0TpKBkGUZ5xyJ5Tz/XO0vlWp4VbsD8Qefk5u6Dllo2w5kdF2HUsvz/SRNgyB4X//jkTuxhw9E+tac/5+MnFkQ2LataRohxDANXdc9z3NdFyo4joP2qnoU5QZVJa0Y6gydQKCUej1Mk8AGvg9+FKJvGFo4ikLpLgg86NlDtifIvu9hgGzHgcIIhUt+z8S+9+biRbZl4yvOcBr3qJtmhMailKBCr68rTI+u6YqimIZJCLXAsCz5eNvBhIKGQ3jEHt5lznVdUZmqqSqKqmoWJev1GoS8B+IjoGx7xkBAEtijhaM4eqszBEA/S1U4xw6K1JXUhWOOd9YAzCPub0slvqHOeEBjGI2iNKom7Xq9sbbd6HpFSJVmu8FG25GV059l7c2NGI/F2Zm4vRUnJ3J/dycmk+78vHx4iCjd7dx9cpK002l3etpdX3ezWXdx0V1edmBeXXXjcfn8HJrmMfLwv8N5qCjs5YWpqrTbtVoxRfE1jYfhNtKR3m4/WO/m7B8HY5//Gz2B3cMmYbtrAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 07 22 16 30 47" title="" data-src="/static/2019-07-22-16-30-47-8137d8f8092d06bf7562bd128d106051-c6c9e.png" data-srcset="/static/2019-07-22-16-30-47-8137d8f8092d06bf7562bd128d106051-c7209.png 200w,\n/static/2019-07-22-16-30-47-8137d8f8092d06bf7562bd128d106051-2eadc.png 400w,\n/static/2019-07-22-16-30-47-8137d8f8092d06bf7562bd128d106051-c6c9e.png 606w" data-sizes="(max-width: 606px) 100vw, 606px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55159639666201100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\ndocument.getElementsByTagName(\'a\')\n// 第二题\ndocument.querySelectorAll(\'a[href]\')\n// 第三题\n// 1)\n[...document.querySelectorAll(\'a[href^=&quot;javascript:&quot;]\')].forEach((item) => {\n  item.setAttribute(\'role\', \'button\');\n})\n// 2)\n[...document.querySelectorAll(\'a[href]\')].forEach((item) => {\n    if(item.getAttribute(\'href\') !== location.host) {\n        item.setAttribute(\'target\', \'_blank\');\n        item.setAttribute(\'rel\', \'external nofollow noopener\');\n    }\n})\n// 3)\n[...document.querySelectorAll(\'a[href^=&quot;#&quot;]\')].forEach((item) => {\n    item.setAttribute(\'rel\', \'internal\');\n})`, `55159639666201100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\ndocument<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span>\n<span class="token comment">// 第二题</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'a[href]\'</span><span class="token punctuation">)</span>\n<span class="token comment">// 第三题</span>\n<span class="token comment">// 1)</span>\n<span class="token punctuation">[</span><span class="token operator">...</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'a[href^="javascript:"]\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'role\'</span><span class="token punctuation">,</span> <span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token comment">// 2)</span>\n<span class="token punctuation">[</span><span class="token operator">...</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'a[href]\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">\'href\'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> location<span class="token punctuation">.</span>host<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'target\'</span><span class="token punctuation">,</span> <span class="token string">\'_blank\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'rel\'</span><span class="token punctuation">,</span> <span class="token string">\'external nofollow noopener\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token comment">// 3)</span>\n<span class="token punctuation">[</span><span class="token operator">...</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'a[href^="#"]\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'rel\'</span><span class="token punctuation">,</span> <span class="token string">\'internal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23861729189147664000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\ndocument.getElementsByTagName(\'a\')\n// 第二题\n// 链接元素与 a 的区别\ndocument.querySelectorAll(\':link\')\n// 第三题\n// 1)\n[].slice.call(document.querySelectorAll(\':link\')).forEach((item) => {\n  if (item.href.startsWith(\'javascript:\')) {\n    item.setAttribute(\'role\', \'button\');\n  }\n  if (item.host === location.host) {\n    item.setAttribute(\'target\', \'_blank\');\n    // 包含，不是设置\n    item.relList.add(\'external\', \'nofollow\', \'noopener\');\n  }\n  // 这里不能用 item.href，会带有 http\n  if (item.getAttribute(\'href\').startsWith(\'#\')) {\n    item.setAttribute(\'rel\', \'internal\');\n  }\n})`, `23861729189147664000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\ndocument<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span>\n<span class="token comment">// 第二题</span>\n<span class="token comment">// 链接元素与 a 的区别</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\':link\'</span><span class="token punctuation">)</span>\n<span class="token comment">// 第三题</span>\n<span class="token comment">// 1)</span>\n<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\':link\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">\'javascript:\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'role\'</span><span class="token punctuation">,</span> <span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>host <span class="token operator">===</span> location<span class="token punctuation">.</span>host<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'target\'</span><span class="token punctuation">,</span> <span class="token string">\'_blank\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 包含，不是设置</span>\n    item<span class="token punctuation">.</span>relList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'external\'</span><span class="token punctuation">,</span> <span class="token string">\'nofollow\'</span><span class="token punctuation">,</span> <span class="token string">\'noopener\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 这里不能用 item.href，会带有 http</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">\'href\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">\'#\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    item<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'rel\'</span><span class="token punctuation">,</span> <span class="token string">\'internal\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>获取所有 a 元素，两种方法：document.getElementsByTagName(‘a’) 所有浏览器都支持，还有 document.querySeletorAll(‘a’)，IE8+。</li>\n<li>答案是：document.links 或者 document.querySelectorAll(‘:link’)都是可以的。链接元素和<code class="language-text">&lt;a&gt;</code>元素的区别：首先没有 href 属性的<code class="language-text">&lt;a&gt;</code>元素不是链接元素，其次链接元素还包括<code class="language-text">&lt;area&gt;</code>元素（带 href）。<code class="language-text">document.querySelectorAll(&#39;[href]&#39;)</code>的问题在于，普通元素设置 href 属性也能获取。</li>\n<li>NodeList 直接 forEach IE 浏览器不支持，Chrome、Firefox 也是最近几年才支持。需要转换成数组，使用[].slice.call(links)，IE9+支持的。ES6 <code class="language-text">[...aLink]</code>，Arrar.from((links)转数组（其实没必要，因为支持 ES6 也就支持 NodeList 直接 forEach）。如有要兼容 IE8，那就是 for 循环。</li>\n<li>startsWith 可以关注下，字符串前匹配。</li>\n<li>链接地址和当前地址栏地址 host 匹配，eleLink.host == location.host。链接元素天然自带：host（包括端口）, hostname, hash 等属性，和 location 对象一样。不要使用 hostname 有 bug，端口不一也会匹配，例如：<code class="language-text">&lt;a href=&quot;//www.xxxx.com:80&quot;&gt;</code>和 URL //www.xxxx.com:90 会认为是一个域下，实际上不是的。</li>\n<li>rel 属性值包含。就是不覆盖原来设置的 rel 属性值。需要用到 relList，需要注意的是多个 rel 属性值赋值需要使用 relList 的 add 方法，而不是直接等于。直接等于不是赋值多个，而是一个，例如：element.relList = [‘external’, ‘nofollow’, ‘noopener’]，最后结果是<code class="language-text">&lt;a href rel=&quot;external,nofollow,noopener&quot;&gt;</code>是不合法的，应该空格分隔。正确用法（出题本意）：link.relList.add(‘external’, ‘nofollow’, ‘noopener’)。relList 和 classList API 细节都是一样的，只不过一个针对 class 属性，一个是 rel 属性。</li>\n<li>link.href.indexOf(’#’) > -1 有 bug，例如 href=“//otherdomain.com#xxxx”，还有一种/^#/.test(link.href)也是有 bug 的，因为 href 属性通过 DOM 对象直接获取是带有域名的，需要匹配 getAttribute 获取的 href 属性值，也就是这里可以/^#/.test(link.getAttribute(‘href’))</li>\n</ol>\n<h1 id="dom-测试二"><a href="#dom-%E6%B5%8B%E8%AF%95%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试二</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-07-23-09-42-56-837f40b5c4f8611c8091401c7deb670a-54e16.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 599px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 135.39232053422373%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAAsSAAALEgHS3X78AAABw0lEQVQ4y82U21KrMBSGef+n6XXv9GJ7qQ9ASUILtKEcSoByKK1fqNXqRvd21Bl/ZkKyWIfk/7NwTlM4Ho/DMBwuYDnp5py+gOlgIbz7h4eb29vZbHZ390cpNQwTxR22dN7YNYwxaZpF0Xq1Wm23W611URjsfd9lWdr3PSE2OAzD+XxeVdX5qB9QcJ7bSqMFOCxMabZJklIrSymSJMlut8uzTOvYFMUuz5nHOuZrkuCYFBbGVq7KMgwDKYWQYqN1xE6iqGmafV2XZdm07X7PtOYgVY2vBRYcns58umzje9j+XPB79f9ePuPLlcnRti2U7HlGTpCtbRossMIcuqoR9UghzGFnRDyHlxgBzVDOlUAnYwpGPHNGY/IcvbJRvgxFScSIxujck6nrOjIxnj7D+T/O/JOE/X/ZN/WvdH61o+OrljhfgYvbS14aAyGUlEr5vq+ElAvguqsgYA3/QRgqqTZ647ouLjT2qIzneYIL7qAH3oRYgxT++DmKIn/pW4sQZFmv11i8xYLsdHgQ2tT0tFNVJerRaBRZLpdxbFufC3E4WOVQsW075ETInnXX82d7EvUbruckrlV9Q/KzED+m8y8OfgRULipOCqxeEwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 07 23 09 42 56" title="" data-src="/static/2019-07-23-09-42-56-837f40b5c4f8611c8091401c7deb670a-54e16.png" data-srcset="/static/2019-07-23-09-42-56-837f40b5c4f8611c8091401c7deb670a-e3250.png 200w,\n/static/2019-07-23-09-42-56-837f40b5c4f8611c8091401c7deb670a-a3cce.png 400w,\n/static/2019-07-23-09-42-56-837f40b5c4f8611c8091401c7deb670a-54e16.png 599w" data-sizes="(max-width: 599px) 100vw, 599px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现-1"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-1"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29335563016104714000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\nconst div = document.createElement(\'div\');\ndiv.style.width = \'300px\';\ndiv.style.height = \'150px\';\ndocument.body.appendChild(div);\n//第二题\ndiv.style.background = \'linear-gradient(to bottom right, red, blue);\';\n//第三题\nlet start = null;\nrequestAnimationFrame((timestamp) => {\n  if (!start) {\n    start = timestamp;\n  }\n  let progress = timestamp - start;\n  if (progress > 1000) {\n    return;\n  }\n  div.style.background = \'linear-gradient(to bottom right, red, blue);\';\n  div.style.background = \'linear-gradient(to bottom right, blue, red);\';\n});`, `29335563016104714000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\n<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">\'300px\'</span><span class="token punctuation">;</span>\ndiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">\'150px\'</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\ndiv<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">\'linear-gradient(to bottom right, red, blue);\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\n<span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">timestamp</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>start<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    start <span class="token operator">=</span> timestamp<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">let</span> progress <span class="token operator">=</span> timestamp <span class="token operator">-</span> start<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">\'linear-gradient(to bottom right, red, blue);\'</span><span class="token punctuation">;</span>\n  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">\'linear-gradient(to bottom right, blue, red);\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-1"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/dom-practice/2-1.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">.color</span> <span class="token punctuation">{</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> color 1s linear forwards<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token atrule"><span class="token rule">@keyframes</span> color</span><span class="token punctuation">{</span>\n      <span class="token selector">to</span> <span class="token punctuation">{</span>\n        <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>\n        <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> color <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'color\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">\'150px\'</span><span class="token punctuation">;</span>\n    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token string">\'300px\'</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">\'linear-gradient(to right bottom, red, blue)\'</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> animationState <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    color<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"animationstart"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n      animationState <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    color<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"animationend"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n      animationState <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">var</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>animationState<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> style <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">\'linear-gradient(to right bottom, \'</span><span class="token operator">+</span> style<span class="token punctuation">.</span>color <span class="token operator">+</span> <span class="token string">\', \'</span> <span class="token operator">+</span> style<span class="token punctuation">.</span>backgroundColor <span class="token operator">+</span> <span class="token string">\')\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>draw<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<h2 id="实现要点-1"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>通常我们使用 JS 给 DOM 元素设置 style 样式的时候，不通过改变 style 属性值，因为容器覆盖以前的样式，然后.style.xxx 这样的方式不会有性能问题，即使有很多行，因为浏览器它会自动合并成一次解析。</li>\n<li>to bottom right，这样无论宽高比例是多少都没有问题。没有 to 就是从右下方开始。</li>\n<li>CSS 渐变本质上是 backgroundImage，是无法 transition 或者 animation 的，但可以使用 JS。seasonley 的方法就是大多数人实现的合集，非常感谢。但是非常遗憾，虽然花了很多功夫，但是对于复杂色值，其颜色变化可能并不是最舒服的那种，可能就像早期的 Safari 色值变化，而且如果有 Alpha 透明度变化，就很困难了。</li>\n<li>XboxYan 的方法比较接近：我们可以借助 animation 或者 transition 本身的颜色变化来赋值，实现更简单，更准确，更接近原生的 backgroundImage 色值变化效果。我写的小 demo：<a href="https://output.jsbin.com/hojesabawe" target="_blank" rel="nofollow noreferrer noopener">https://output.jsbin.com/hojesabawe</a></li>\n<li>颜色转换的技巧。任意颜色转换为 RGB(A)色值，给 DOM 元素赋值，然后使用 getComputedStyle()获取。举个例子，请把色值 skyblue 转换成 RGB 色值，div.style.color = ‘skyblue’; getComputedStyle(div).color -> RGB 色值，所有浏览器都是这样的，包括 IE。</li>\n</ol>\n<h1 id="dom-测试三"><a href="#dom-%E6%B5%8B%E8%AF%95%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试三</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-07-24-16-50-00-a3943a980954f5d6fe9c86f8929aaf94-a15de.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 617px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 117.3419773095624%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB20lEQVQ4y7VUW27bMBDU/Q+THCD+TL7S3wBt7KRQDMoiKfMlsiKpRzqk5MQwbMRt0YFALUXua3ZXxfs5jBl933vvsU7TdPZacbKf7z3/+P74+G11d3d7c/Nwf08py0fz+aehIsZY1zXWE8/DMMDnkNG2BiHge9d1Wuv5Y1LWSq1WK0JIiKHFLaOlVEJIa521La5CQez3UimcMc6x/QgwhT1Oo9IwotoMCFDzIfjgnXMQfjkHneA9DCKc47BDVRFEDlcIvh/6GML7dShg8gXYbCpCttttVVVYy7IkpKKU1jSBcwZpt9stMmXeJwcFwpDIUinkwxmXQgqx5w0PIS7kZoxjevDOz8J5Ad6cs9CEBc4bxphWGgYAxhlIgmCtvVjn2fK4LAdHi/npw8/XTfJHOKeMIOsajfK1ch/jXjSJ2JqCR4GCr9duvcEGzGltxAFN06Ds6AdjjFI6KaMVaihClYI1BqpAG1JEFVLZDxiOkZv3n3OezuG4wpdOL3jGAYbsQnlOPI8YN/QJehtrF0IgxD89GSkxEjrDWacN3gZjg0uYvLZNbVP4rivfyteEn9u3EsxVL6/Re21btD2IhVKezSQsyumLXXIeMpkzo+nvk5n82ya5Itv/1J5X4zfZ2j0jahyiIwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 07 24 16 50 00" title="" data-src="/static/2019-07-24-16-50-00-a3943a980954f5d6fe9c86f8929aaf94-a15de.png" data-srcset="/static/2019-07-24-16-50-00-a3943a980954f5d6fe9c86f8929aaf94-70603.png 200w,\n/static/2019-07-24-16-50-00-a3943a980954f5d6fe9c86f8929aaf94-4a3ab.png 400w,\n/static/2019-07-24-16-50-00-a3943a980954f5d6fe9c86f8929aaf94-a15de.png 617w" data-sizes="(max-width: 617px) 100vw, 617px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现-2"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-2"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/dom-practice/3-1.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> gray<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box.active</span> <span class="token punctuation">{</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> skyblue<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">const</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      element<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">\'box\'</span><span class="token punctuation">;</span>\n      fragment<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'.box\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n      item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'mousedown\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'mouseup\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchstart\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchend\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">&amp;&amp;</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>className<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'.box\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          item<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<h3 id="最佳解答-2"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/dom-practice/3-2.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> gray<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box.active</span> <span class="token punctuation">{</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> skyblue<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">/* 按住时抖动身姿（仅PC） */</span>\n    <span class="token selector">.box:active</span> <span class="token punctuation">{</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> shake linear 1s infinite<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">/* 范围选框 */</span>\n    <span class="token selector">.range-frame</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>\n      <span class="token property">z-index</span><span class="token punctuation">:</span> 10<span class="token punctuation">;</span>\n      <span class="token property">border</span><span class="token punctuation">:</span> 1px dashed <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> .5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token atrule"><span class="token rule">@keyframes</span> shake</span> <span class="token punctuation">{</span>\n      <span class="token selector">0%, 100%</span> <span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>0deg<span class="token punctuation">)</span> <span class="token function">translateY</span><span class="token punctuation">(</span>0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>\n      <span class="token selector">15%, 35%, 55%, 75%, 95%</span> <span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-1px<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-1deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>\n      <span class="token selector">25%, 45%, 5%, 65%, 85%</span> <span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>1px<span class="token punctuation">)</span> <span class="token function">rotate</span><span class="token punctuation">(</span>1deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>\n      <span class="token selector">10%, 30%, 50%, 70%, 90%</span> <span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>1px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>\n      <span class="token selector">20%, 40%, 60%, 80%</span> <span class="token punctuation">{</span><span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>-1px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">class</span> <span class="token class-name">Box</span> <span class="token punctuation">{</span>\n      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">nums <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>nums <span class="token operator">=</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 数量</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>boxes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 当前实例的 .box 元素集合</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame <span class="token operator">=</span> <span class="token punctuation">{</span>  <span class="token comment">// 范围选框</span>\n          el<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n          x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n          y<span class="token punctuation">:</span> <span class="token number">0</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>nums <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// 在 body 元素里创建 .box 盒子</span>\n      <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 使用文档片段，减少性能损耗</span>\n        <span class="token keyword">let</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nums<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">let</span> box <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          box<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">\'box\'</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// 阻止移动端长按时弹出系统默认菜单</span>\n          box<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchstart\'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=></span> e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>box<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// 绑定操作事件</span>\n      <span class="token function">bindEvt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n        <span class="token keyword">let</span> isReady <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 按下时</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">startHandle</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">let</span> elm <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>\n\n          <span class="token comment">// “按压”对象为当前实例中创建的 .box 盒子之一</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">~</span><span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              <span class="token keyword">let</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>\n\n              <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>touches<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 移动端</span>\n                clientX <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>\n                clientY <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n\n              isReady <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n              elm<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildRangeFrame</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">350</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// 点击空白处</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">box</span> <span class="token operator">=></span> box<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 拖动中</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">moveHandle</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>isReady<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> <span class="token punctuation">{</span> clientX<span class="token punctuation">,</span> clientY <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>\n\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>touches<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 兼容移动端</span>\n              clientX <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientX<span class="token punctuation">;</span>\n              clientY <span class="token operator">=</span> e<span class="token punctuation">.</span>touches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n\n            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateRangeFrame</span><span class="token punctuation">(</span>clientX<span class="token punctuation">,</span> clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 松起时，清空定时器（中断高亮操作）</span>\n        <span class="token keyword">const</span> <span class="token function-variable function">endHandle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          isReady <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n          <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeRangeFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 按下</span>\n        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchstart\'</span><span class="token punctuation">,</span> startHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'mousedown\'</span><span class="token punctuation">,</span> startHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 拖动</span>\n        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> moveHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'mousemove\'</span><span class="token punctuation">,</span> moveHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 松起</span>\n        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchend\'</span><span class="token punctuation">,</span> endHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'mouseup\'</span><span class="token punctuation">,</span> endHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// 创建范围选框</span>\n      <span class="token function">buildRangeFrame</span><span class="token punctuation">(</span><span class="token parameter">posX<span class="token punctuation">,</span> posY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> elm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'i\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        elm<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">\'range-frame\'</span><span class="token punctuation">;</span>\n        elm<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>posX<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n        elm<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>posY<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame<span class="token punctuation">.</span>el <span class="token operator">=</span> elm<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame<span class="token punctuation">.</span>x <span class="token operator">=</span> posX<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame<span class="token punctuation">.</span>y <span class="token operator">=</span> posY<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// 更新范围选框</span>\n      <span class="token function">updateRangeFrame</span><span class="token punctuation">(</span><span class="token parameter">posX<span class="token punctuation">,</span> posY</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> <span class="token punctuation">{</span> el<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame<span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>posX <span class="token operator">&lt;</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 向左反方向</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">\'auto\'</span><span class="token punctuation">;</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">-</span> x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token string">\'auto\'</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>posY <span class="token operator">&lt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 向上反方向</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token string">\'auto\'</span><span class="token punctuation">;</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>window<span class="token punctuation">.</span>innerHeight <span class="token operator">-</span> y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n          el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>bottom <span class="token operator">=</span> <span class="token string">\'auto\'</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// 矩形选框尺寸</span>\n        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>posX <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n        el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>posY <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 获取矩形区域左上、右下坐标</span>\n        <span class="token comment">// this.computeContains({</span>\n        <span class="token comment">// \tx1: Math.min(posX, x), y1: Math.min(posY, y),</span>\n        <span class="token comment">// \tx2: Math.max(posX, x), y2: Math.max(posY, y)</span>\n        <span class="token comment">// });</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">computeContains</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// 移除范围选框</span>\n      <span class="token function">removeRangeFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>rangeFrame<span class="token punctuation">.</span>el <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token comment">// 计算 box 是否包含在选框区域</span>\n      <span class="token function">computeContains</span><span class="token punctuation">(</span><span class="token parameter">area</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">box</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">let</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> box<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token comment">// 矩形碰撞检测</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>\n            area<span class="token punctuation">.</span>left <span class="token operator">+</span> area<span class="token punctuation">.</span>width <span class="token operator">></span> left <span class="token operator">&amp;&amp;</span> left <span class="token operator">+</span> width <span class="token operator">></span> area<span class="token punctuation">.</span>left  <span class="token comment">// 横向</span>\n            <span class="token operator">&amp;&amp;</span>\n            area<span class="token punctuation">.</span>top <span class="token operator">+</span> area<span class="token punctuation">.</span>height <span class="token operator">></span> top <span class="token operator">&amp;&amp;</span> top <span class="token operator">+</span> height <span class="token operator">></span> area<span class="token punctuation">.</span>top  <span class="token comment">// 纵向</span>\n          <span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            box<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'active\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">let</span> boxNums <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>\n    <span class="token keyword">new</span> <span class="token class-name">Box</span><span class="token punctuation">(</span>boxNums<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<h2 id="实现要点-2"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>直接快速滑动是不应该选中的，在手机端，会和滚动交互冲突。</li>\n<li>移动端长按网页会弹出默认菜单，取消方法：<a href="https://codepen.io/wingmeng/pen/PvymKN" target="_blank" rel="nofollow noreferrer noopener">https://codepen.io/wingmeng/pen/PvymKN</a></li>\n<li>wingmeng 的碰撞检测没有问题。</li>\n<li>createDocumentFragment 片段创建提高性能，requestAnimationFrame 提高绘制性能，缓存 box 位置，resize 的时候无需重新获取，提高性能。Seasonley 是一个比较关注性能的伙伴。</li>\n<li>三人行，必有我师。longclick 的检测，我们以前全部都使用 setTimeout，XboxYan 使用了一个 transition 检测，配合 transitionend 回调。这种方法很巧妙，也有一个优点，我们无需 clearTimeout 这样的操作，浏览器帮我执行了取消检测。也不是完全完美，移动端还需要多多检测下。</li>\n<li>移动和 PC 可以统一使用方法，不同设备下 mousedown/touchstart, mousemove/touchmove, mouseup/touchend，通过判断处理。判断是否是移动设备直接：‘ontouchstart’ in document.body 。同时 document.addEventListener(‘mouseup’, handleup);document.addEventListener(‘touchend’, handleup);这样是有问题的，因为会重复触发 handleup。</li>\n<li>碰撞检测比较好理解的算法。A 盒子最左边比 B 最左边小，或 A 盒子最右边比 B 最右边大，或上小，下大，再整体取非。</li>\n</ol>\n<h1 id="dom-测试四"><a href="#dom-%E6%B5%8B%E8%AF%95%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试四</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-08-02-10-13-17-8927ebc0252c653fdd8f140de5397383-0a3ee.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 747px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 143.3734939759036%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAIAAAAl5NuSAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACZUlEQVQ4y62U6XbaMBCFef+H40Ca/mk5LLYxNtZi403gJf0kOSlN4ISmnQO2LGmkuXfuzOzlll0ulzAMN5vtYrFcLBZBENZ1/bY6jqMfzO45B0GwXq+fnr49P38Pw6iqqo/brDML1wdz9Md9bdsqpc/n8+l0klIyMMZY58VyOZ/P+e667jo2H55/DsPQ9z3H8slgcGadi6I4HA5RFEklfRStMU1dm9b4z6ZpuJl3VZZlVXGnj27CnOf5IY5ZE1LmRZ5lmRQiTVOttVIqy46ZyFzYF3eQgRRCmJzZxOVFnuPM7jRJlFRCCKVVvI8zIbTSuBlzruuqcUbs1hnsRA5moAAbSBw8uPHFmZsbbrPNJjh0BALWAI/xywNmnTmWm5sWjmr4gSSiGseJ8Fe74/xlm/m8ESoX5rlGAELYP7QprWGPGeIyjhfwv3eGG2Y9Ws9ka80/7Zulvu/cs/9/YV+L0YvuWpXMkSa/arPYdT6FaJWfDRuFCKen1WpFJW22W37Yzj12wY7yJJdWZ1kGNUjISUnZm62YWwvMAwa6k3AJQ0x7Ornw31LlUn/H+VUKHvYn5rZYzAQM7GOa7uP44KwsT8RMJXmoYAWhFBYoH2T+eEzBz80jkPDUSERrdg8T6YMr+t+lTzvwLcEN+6kZ/K390QBvq/5BbZN02gDpIdvAltIrWoEDYMzTnpIkQfKWmqNtL6Ry6iRwE8dxFO1RxM/VD5rZytlmbS1BPUmy30e0Ko7kOBiFmilsukDd1F4krhMY3/TQybsyuiGSwhkxkxVpMyKhFP+iOH1eGNdV8VYbfuahqvqa/QIWFZfPyMXA3AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 08 02 10 13 17" title="" data-src="/static/2019-08-02-10-13-17-8927ebc0252c653fdd8f140de5397383-0a3ee.png" data-srcset="/static/2019-08-02-10-13-17-8927ebc0252c653fdd8f140de5397383-14d81.png 200w,\n/static/2019-08-02-10-13-17-8927ebc0252c653fdd8f140de5397383-58aa6.png 400w,\n/static/2019-08-02-10-13-17-8927ebc0252c653fdd8f140de5397383-0a3ee.png 747w" data-sizes="(max-width: 747px) 100vw, 747px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现-3"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-3"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33275903921082750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\ndocument.querySelector(\'#loginForm\');\n//第二题\ne.preventDefault();\n//第三题\n[].slice.call(document.querySelectorAll(\'#loginForm input\')).map((item) => item.value)\n//第四题\n//通过登录按钮disabled实现\n//第五题\n[].slice.call(document.querySelectorAll(\'#loginForm input\')).concat(document.querySelector(\'input[name=from]\')).map((item) => item.value)`, `33275903921082750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#loginForm\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\ne<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\n<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'#loginForm input\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span>\n<span class="token comment">//第四题</span>\n<span class="token comment">//通过登录按钮disabled实现</span>\n<span class="token comment">//第五题</span>\n<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'#loginForm input\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'input[name=from]\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>value<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-3"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5762564757075950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\ndocument.getElementById(\'loginForm\'); // 方法1：经典的 id 选择器\ndocument.querySelector(\'#loginForm\'); // 方法2：万能的 querySelector\ndocument.forms.loginForm; // 方法3：表单原生方法，还可以写作：document.forms[\'loginForm\']\nloginForm; // 方法4：标签的 id 可以直接当变量来用\n//第二题\nloginForm.addEventListener(\'submit\', function(event) {\n  event.preventDefault();\n  // 其他操作...\n});\n//第三题\nnew FormData(loginForm) // IE10+\n//第四题\nsetAttribute(\'disabled\', \'\')或者loginForm.querySelector(\'[type=&quot;submit&quot;]\').disabled = true;\n//第五题\n<input name=&quot;from&quot; type=&quot;hidden&quot; form=&quot;loginForm&quot;> // IE10+`, `5762564757075950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\ndocument<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'loginForm\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 方法1：经典的 id 选择器</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#loginForm\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 方法2：万能的 querySelector</span>\ndocument<span class="token punctuation">.</span>forms<span class="token punctuation">.</span>loginForm<span class="token punctuation">;</span> <span class="token comment">// 方法3：表单原生方法，还可以写作：document.forms[\'loginForm\']</span>\nloginForm<span class="token punctuation">;</span> <span class="token comment">// 方法4：标签的 id 可以直接当变量来用</span>\n<span class="token comment">//第二题</span>\nloginForm<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 其他操作...</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\n<span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>loginForm<span class="token punctuation">)</span> <span class="token comment">// IE10+</span>\n<span class="token comment">//第四题</span>\n<span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span>或者loginForm<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'[type="submit"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n<span class="token comment">//第五题</span>\n<span class="token operator">&lt;</span>input name<span class="token operator">=</span><span class="token string">"from"</span> type<span class="token operator">=</span><span class="token string">"hidden"</span> form<span class="token operator">=</span><span class="token string">"loginForm"</span><span class="token operator">></span> <span class="token comment">// IE10+</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="dom-测试五"><a href="#dom-%E6%B5%8B%E8%AF%95%E4%BA%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试五</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-08-23-16-22-21-ec66e48159c20a5b2c725066ba94e16c-82fb5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 638px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 116.61442006269593%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAAsSAAALEgHS3X78AAAB60lEQVQ4y62U23KqQBBF8/9f5IMvyQ+ob4lHAgiIAopcZUAgi2mkUjlJlbnsqkx6ZtjT3bu7feg1uq7r32G73a5Wq/l8PpvNlstlFEX/fwMe+juglCqK4nq9lmUpRtu2I/np6XGxWLQaUyAT2DZNc7lcWKuqwqjrGv5IjqLQ931i41X5qL8PA7lWdZqmeQ6zzPlXFMRZK3UXGVdJkmRZXpQlnnMNnvhUpG8L9jW5G8Qk7QzXeZGckyxND4fDKY4J43w+Typ+7plr+FeNRkOpSiTFlsj12n1I5Jdh9z0e0jRDIcqIzzzLSYF+YMshBoespa4wiqpbIUYyaqMwFxDIma3UXGSnNQoNaPLoH4Utmok8rNKV7Q2yna5YCX7sbfbH4/HVMEzTsi3b9/fUyXVd27ZfXp53AzzTNNfrted5YRiSSBSGBD96JqXyQiaqqWuRZGg08tcKySRhSBV/22FTqccmkVlDzEqgDf4kEG2rqUJTl5BzT1TMYxAEJB9G4TGKHMexLMvz3NPphAacDwXXo/Ih7A6FLMsWAiu/QRvD+LfZIBt8lEMwzuM4RjAmHwnp/DFsjgzjlVO+QFzXceSJQfcgCINgh9DejiHZ7/fpMD8ZeYzkW6pKJEVlnWolW8rPtdSZ9f2Q/Ujtm/EGKSU6U+4ecroAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 08 23 16 22 21" title="" data-src="/static/2019-08-23-16-22-21-ec66e48159c20a5b2c725066ba94e16c-82fb5.png" data-srcset="/static/2019-08-23-16-22-21-ec66e48159c20a5b2c725066ba94e16c-38c7c.png 200w,\n/static/2019-08-23-16-22-21-ec66e48159c20a5b2c725066ba94e16c-c00bc.png 400w,\n/static/2019-08-23-16-22-21-ec66e48159c20a5b2c725066ba94e16c-82fb5.png 638w" data-sizes="(max-width: 638px) 100vw, 638px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现-4"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-4"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="96361791237322980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\nconst element = document.querySelector(\'textarea\');\n//第二题\nelement.rows = 5;\n//第三题\nelement.clientHeight;\n//第四题\n//第五题`, `96361791237322980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\n<span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'textarea\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\nelement<span class="token punctuation">.</span>rows <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\nelement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n<span class="token comment">//第四题</span>\n<span class="token comment">//第五题</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-3"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9879067035919475000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\nconst element = document.querySelector(\'textarea\');\n//第二题\nelement.rows = 5;\n//第三题\n// 用 clientHeight  获取会包含 padding，所以用下面方法获取计算样式来得到高度\nconst { height } = window.getComputedStyle(myTextarea);\nconsole.log(height); // Chrome: 75px, FF: 112px\n//第四题\n// textarea 默认的 lineHeight 值为 normal，此时是无法计算的，而且每个浏览器解析出的 normal 数值存在差异，另外它的值还和字体有关。详情\n// 所以想要实现题目中的要求的话，有个大前提就是必须通过 CSS Reset 的方式对 textarea 的行高进行预定义，我这里采用了 Normalize.css 中的相关样式：\n// textarea {line-height: 1.15;}\n// 然后就可以正常获取行高进行后续计算了：\nconst { lineHeight } = window.getComputedStyle(myTextarea);\nmyTextarea.style.height = parseFloat(lineHeight) * myTextarea.rows + \'px\';\n//第五题\ndocument.addEventListener(\'DOMNodeInserted\', function(event) {\n  var elm = event.target;\n  if (elm.nodeName.toLowerCase() === \'textarea\') {\n    var lineHt = window.getComputedStyle(elm).lineHeight;\n    elm.style.height = parseFloat(lineHt) * elm.rows + \'px\';\n  }\n});`, `9879067035919475000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\n<span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'textarea\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\nelement<span class="token punctuation">.</span>rows <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\n<span class="token comment">// 用 clientHeight  获取会包含 padding，所以用下面方法获取计算样式来得到高度</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>myTextarea<span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Chrome: 75px, FF: 112px</span>\n<span class="token comment">//第四题</span>\n<span class="token comment">// textarea 默认的 lineHeight 值为 normal，此时是无法计算的，而且每个浏览器解析出的 normal 数值存在差异，另外它的值还和字体有关。详情</span>\n<span class="token comment">// 所以想要实现题目中的要求的话，有个大前提就是必须通过 CSS Reset 的方式对 textarea 的行高进行预定义，我这里采用了 Normalize.css 中的相关样式：</span>\n<span class="token comment">// textarea {line-height: 1.15;}</span>\n<span class="token comment">// 然后就可以正常获取行高进行后续计算了：</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> lineHeight <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>myTextarea<span class="token punctuation">)</span><span class="token punctuation">;</span>\nmyTextarea<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>lineHeight<span class="token punctuation">)</span> <span class="token operator">*</span> myTextarea<span class="token punctuation">.</span>rows <span class="token operator">+</span> <span class="token string">\'px\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第五题</span>\ndocument<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMNodeInserted\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> elm <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>elm<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'textarea\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> lineHt <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>elm<span class="token punctuation">)</span><span class="token punctuation">.</span>lineHeight<span class="token punctuation">;</span>\n    elm<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>lineHt<span class="token punctuation">)</span> <span class="token operator">*</span> elm<span class="token punctuation">.</span>rows <span class="token operator">+</span> <span class="token string">\'px\'</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-4"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>\n<p>document.querySelector;</p>\n</li>\n<li>\n<p>myTextarea.rows = 5;</p>\n</li>\n<li>\n<p>window.getComputedStyle(myTextarea).height</p>\n</li>\n<li>\n<p>IE 下 textarea 的高度不是行高决定的，而是 font-size 和 font-family。</p>\n</li>\n<li>\n<p>DOMNodeInserted(DOM level 3, IE9+)以及 MutationObserver(DOM level 4 IE11+)。前者不是异步的，所以如果有大量的 DOM 变化和事件处理，性能影响会很明显，MutationObserver 则是异步的，先观察，然后一次性处理。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73890845508239840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\'DOMNodeInserted\', function(event) {\n if (event.target.nodeName.toLowerCase() === \'textarea\') {\n   //...\n }\n});`, `73890845508239840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMNodeInserted\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'textarea\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">//...</span>\n <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<h1 id="dom-测试六"><a href="#dom-%E6%B5%8B%E8%AF%95%E5%85%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试六</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-09-30-17-36-11-2495850ae5a93f34d47ed035ad82fa86-82fb5.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 638px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 134.1692789968652%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABxUlEQVQ4y62U23KCMBRF+f/fcfwCn/XdB6eO1lEQMAQICSB2JSnaWryN3TMwuZ3L3jk5wekGuq47PUJwx/h4PLZty/+Wo2AwyHw+n06n4/F4NBrNZrOyLAePDUcmYN2DyMYYBqxrrRl1DtaYc5PJZLVaMfEZsnIVBBuC46IAZcm0aRprjMFisdhut0kcyxzIKIrYPj0BmzZupJRVpUuliIB360NKpVSapuIg4jhJ0jRJk0pXmRCk9sMYhsa07g83fLVN63nWtWn4vseWf9PUZ1LB6Q1YY1yKTKiqIoDRmoThTOK5A8lXDjeNYYmBPwRn5Zg7aa22DuaFCruD/+NsjCbDSimSK8ricDiQL/pCwa4U3KDlwgTZUUEIcSmS3S6kMLjGMAz3+/1qvc6yjG3tTnsXyrlGHVTI88Jf9dtpvyTStWD+6Z43/NSDY+c3NBi5g5UTKYcPYsQ9EALOUma33klwjuYDdr9xvx8FT1Ht7a8cva02l0ZZU/65rXD7+nydI4HMMnexee0eJqXC/9JJsOR9bzafH8tltEejiBpQfVdASN8Y8MUixUMM9nxLC6CBG+8YUoyf6diP+/ZfwQcE65e6VwX7AvWKNLq7uvwKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 09 30 17 36 11" title="" data-src="/static/2019-09-30-17-36-11-2495850ae5a93f34d47ed035ad82fa86-82fb5.png" data-srcset="/static/2019-09-30-17-36-11-2495850ae5a93f34d47ed035ad82fa86-38c7c.png 200w,\n/static/2019-09-30-17-36-11-2495850ae5a93f34d47ed035ad82fa86-c00bc.png 400w,\n/static/2019-09-30-17-36-11-2495850ae5a93f34d47ed035ad82fa86-82fb5.png 638w" data-sizes="(max-width: 638px) 100vw, 638px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现-5"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-5"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33018272084297884000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nconst dialog = document.createElement(\'dialog\');\ndocument.body.appendChild(dialog);\n// 第二题\ndialog.open = \'fff\';\n// 第三题\nconst button = document.createElement(\'button\');\nbutton.onclick = function() {\n  dialog.close();\n};\ndialog.appendChild(button);\n// 第四题\n// 第五题`, `33018272084297884000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">const</span> dialog <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'dialog\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dialog<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\ndialog<span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token string">\'fff\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nbutton<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  dialog<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\ndialog<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第四题</span>\n<span class="token comment">// 第五题</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-4"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8625594887751475000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nconst dialog = document.createElement(\'dialog\');\ndocument.body.appendChild(dialog);\n// 第二题\n// 方法1：\ndialog.open = true; // 或其他为“真值”的基本类型，如 1，&quot;abc&quot; 等\n// 方法2：\ndialog.show();\n// 方法3：\ndialog.showModal();\n// 第三题\nconst btn = document.createElement(\'button\');\nbtn.innerText = \'close\';\nbtn.addEventListener(\'click\', () => {\n  // 方法1：\n  dialog.open = false; // 或其他“非真”的基本类型，如 0、null 等\n  // 方法2：\n  dialog.close();\n});\ndialog.appendChild(btn);\n// 第四题\n// 用 showModal 方法即可让打开的 dialog 自带遮罩，在 CSS 里可通过 ::backdrop 设置遮罩层样式\ndialog.showModal();\n// 第五题\n// 思路：如果是 showModal() 方法打开的 dialog，则其覆盖层级默认是置顶的；而通过 show() 方法或 open 属性打开的 dialog，其覆盖层级遵循“后来居上”原则，所以需要手动调整其 z-index 值来使其覆盖层级置顶。\n(function(dialogElm) {\n  if (!dialogElm) return;\n\n  const proto = dialogElm.prototype;\n  const oldShow = proto.show;\n  const dialogBaseLevel = 100; // 对话框弹层的基准层级（根据项目zIndex规范合理设置）\n  const getMaxZIndex = () => {\n    const dialogs = document.querySelectorAll(\'dialog[open]\');\n    const maxZIndex = Math.max.apply(\n      null,\n      [...dialogs].map((it) => it.style.zIndex || Number(window.getComputedStyle(it).zIndex) || dialogBaseLevel)\n    );\n\n    return maxZIndex;\n  };\n  const setMaxZIndex = (el) => (el.style.zIndex = getMaxZIndex() + 1);\n\n  // 重写 show 方法\n  proto.show = function() {\n    setMaxZIndex(this);\n    oldShow.call(this);\n  };\n\n  // &quot;劫持&quot; open 属性\n  Object.defineProperty(proto, \'open\', {\n    set: function(value) {\n      const isOpen = Boolean(isNaN(value) ? value : Number(value));\n      this[isOpen ? \'show\' : \'close\']();\n    }\n  });\n})(window.HTMLDialogElement);`, `8625594887751475000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">const</span> dialog <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'dialog\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dialog<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\n<span class="token comment">// 方法1：</span>\ndialog<span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 或其他为“真值”的基本类型，如 1，"abc" 等</span>\n<span class="token comment">// 方法2：</span>\ndialog<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 方法3：</span>\ndialog<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'button\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nbtn<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">\'close\'</span><span class="token punctuation">;</span>\nbtn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// 方法1：</span>\n  dialog<span class="token punctuation">.</span>open <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 或其他“非真”的基本类型，如 0、null 等</span>\n  <span class="token comment">// 方法2：</span>\n  dialog<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndialog<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>btn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第四题</span>\n<span class="token comment">// 用 showModal 方法即可让打开的 dialog 自带遮罩，在 CSS 里可通过 ::backdrop 设置遮罩层样式</span>\ndialog<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第五题</span>\n<span class="token comment">// 思路：如果是 showModal() 方法打开的 dialog，则其覆盖层级默认是置顶的；而通过 show() 方法或 open 属性打开的 dialog，其覆盖层级遵循“后来居上”原则，所以需要手动调整其 z-index 值来使其覆盖层级置顶。</span>\n<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dialogElm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dialogElm<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> proto <span class="token operator">=</span> dialogElm<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> oldShow <span class="token operator">=</span> proto<span class="token punctuation">.</span>show<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> dialogBaseLevel <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 对话框弹层的基准层级（根据项目zIndex规范合理设置）</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">getMaxZIndex</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> dialogs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'dialog[open]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> maxZIndex <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>\n      <span class="token keyword">null</span><span class="token punctuation">,</span>\n      <span class="token punctuation">[</span><span class="token operator">...</span>dialogs<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">it</span><span class="token punctuation">)</span> <span class="token operator">=></span> it<span class="token punctuation">.</span>style<span class="token punctuation">.</span>zIndex <span class="token operator">||</span> <span class="token function">Number</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">.</span>zIndex<span class="token punctuation">)</span> <span class="token operator">||</span> dialogBaseLevel<span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">return</span> maxZIndex<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">setMaxZIndex</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>zIndex <span class="token operator">=</span> <span class="token function">getMaxZIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 重写 show 方法</span>\n  proto<span class="token punctuation">.</span><span class="token function-variable function">show</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setMaxZIndex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">oldShow</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// "劫持" open 属性</span>\n  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>proto<span class="token punctuation">,</span> <span class="token string">\'open\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> isOpen <span class="token operator">=</span> <span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> value <span class="token punctuation">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">[</span>isOpen <span class="token operator">?</span> <span class="token string">\'show\'</span> <span class="token punctuation">:</span> <span class="token string">\'close\'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>HTMLDialogElement<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-5"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>createElement 的时候，里面的标签名称是不区分大小写的。appendChild 这里也可以使用 append 这个 API，新 API，IE 不支持，如果是 HTML 字符串，会自动转义为安全的纯本文。</li>\n<li>如果直接.open，则根据值是否 == true/false 判断是否弹框显示；如果是 setAttribute 方法，则任意字符串和值。</li>\n<li><code class="language-text">&lt;dialog&gt;</code>关闭使用.close()方法。</li>\n<li>dialog.showModal()自带本透明蒙层。如果我们想要修改透明度，可以使用::backdrop 伪元素进行设置。</li>\n<li>showModal 时后弹框层级就是最高，其他元素设置再高的 z-index 值都无效。但是 show()显示的就不一样了，我们需要动态计算处理，原理：遍历所有 dialog 再把最大的 zindex 加 1。</li>\n</ol>\n<h1 id="dom-测试七"><a href="#dom-%E6%B5%8B%E8%AF%95%E4%B8%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试七</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-11-26-19-54-57-bbd9e4cc648f5277381deed6102c8ca6-0bb1c.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 628px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 118.47133757961782%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsSAAALEgHS3X78AAABpElEQVQ4y+VUy5KCMBD0/3/IH9C7B6tW1+IhEIXwlBASnm6HUIpbuKXlceegE5Oe7ulkXFznou/7bhJYzh5bXD8IBZ7W1kkURdvtdrVaLZfL9XptmuYs+TyzECLLsjAMCSGU0qIo6rrWW0huhRTYtu3j8XijnbUAtcqyRNEkTYdEQq4CQ+Fms0nTJIojHHpmUj/ENFnoL4jJL3lVSc5LKSUvy7ZtXzIMMhhjUgiW5wXnz8TPg3UnMAaamxcIH8BQiIY9j2TZpa7q98CKOY6jOM7zvGnqqUOjPfgck/43GG6176h9ACdJ4vsBOAfbJPg554zlsKCuKtiJR4JbwBJbFa5EwlwBPnVVolQbpxNxXBfOXbKMD4GjOKUKFUyIEktU0UhUbLtuNAyvomkaJf7le7q/bY2HCl2iGQJe4Me/wABAQxD4NEBQ13UJ8RBYnM9nzEY9FEKr6kFLiY7VUlYjc0jpfr83LcswTYBPhBgGUmP3tTt8HzA2vu9jdhzHsS0LFTGwHiGd7rlgjIY0HXxKhgAhLh7ktznR+nVr98H49J/kv4F/AOUHfd8ndil2AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 11 26 19 54 57" title="" data-src="/static/2019-11-26-19-54-57-bbd9e4cc648f5277381deed6102c8ca6-0bb1c.png" data-srcset="/static/2019-11-26-19-54-57-bbd9e4cc648f5277381deed6102c8ca6-17261.png 200w,\n/static/2019-11-26-19-54-57-bbd9e4cc648f5277381deed6102c8ca6-44202.png 400w,\n/static/2019-11-26-19-54-57-bbd9e4cc648f5277381deed6102c8ca6-0bb1c.png 628w" data-sizes="(max-width: 628px) 100vw, 628px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现-6"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-6"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82569277924787880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\ndocument.querySelector(\'#list\').addEventListener(\'click\', function(e) {\n  if (e.target.tagName === \'LI\') {\n    [].slice.apply(document.querySelectorAll(\'#list li\')).forEach(function(item) {\n      item.classList.remove(\'selected\');\n    });\n    document.querySelector(\'#input\').value = e.target.innerText;\n    e.target.classList.add(\'selected\');\n  }\n});\n// 第二题\ndocument.addEventListener(\'keydown\', function(e) {\n  var li = [].slice.apply(document.querySelectorAll(\'#list li\'));\n  var selectedIndex = 0;\n  li.forEach(function(item, index) {\n    if ([].slice.apply(item.classList).indexOf(\'selected\') !== -1) {\n      item.classList.remove(\'selected\');\n      selectedIndex = index + 1;\n    }\n  });\n  if (e && e.keyCode === 38) {\n    const index = (selectedIndex - 1) % (li.length + 1);\n    let realIndex = index;\n    if (index === -1 || index === 0) {\n      realIndex = li.length;\n    }\n    document.querySelector(\'#list li:nth-child(\' + realIndex + \')\').click();\n  }\n  if (e && e.keyCode === 40) {\n    console.log(selectedIndex);\n    const index = (selectedIndex + 1) % (li.length + 1);\n    const realIndex = index === 0 ? 1 : index;\n    document.querySelector(\'#list li:nth-child(\' + realIndex + \')\').click();\n  }\n});`, `82569277924787880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#list\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">\'LI\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'#list li\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      item<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'selected\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span>\n    e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">\'selected\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\ndocument<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'keydown\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">\'#list li\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> selectedIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  li<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>classList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">\'selected\'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      item<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">\'selected\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      selectedIndex <span class="token operator">=</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">38</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token punctuation">(</span>selectedIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>li<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> realIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      realIndex <span class="token operator">=</span> li<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#list li:nth-child(\'</span> <span class="token operator">+</span> realIndex <span class="token operator">+</span> <span class="token string">\')\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>selectedIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token punctuation">(</span>selectedIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>li<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> realIndex <span class="token operator">=</span> index <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token punctuation">:</span> index<span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#list li:nth-child(\'</span> <span class="token operator">+</span> realIndex <span class="token operator">+</span> <span class="token string">\')\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-6"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>点击事件绑定在 #list 列表容器上是更合适的，两点原因：</li>\n<li>开销更小；</li>\n<li>更健壮，不要担心里面 li 列表的动态变化（包括刷新更新）。</li>\n<li>判断索引是否匹配再进行样式控制是符合人类逻辑的直觉认知的一种方式（因为现实世界重复做一件事情的成本是很高的），但是在程序代码里面并不是最好的实现。逻辑更清晰的实现：选中 .selected 元素并移除（不管是不是点击元素自身），点击元素添加.selected。牺牲不值一提的执行成本，降低逻辑复杂度。意义在于，执行成本是计算机的，逻辑复杂度是给人看的。最终目的都是人更轻松，计算机累一点。</li>\n<li>键盘事件在实际开发时候，由于这种列表，都是使用 keydown 事件，不是 keyup。</li>\n<li>事件建议绑定在 <code class="language-text">&lt;input&gt;</code> 元素上，全局上下键绑定是会有问题，会和浏览器上下键微调页面滚动高度冲突。</li>\n<li>input.setAttribute(‘autocomplete’, ‘off’); 然后设置 event.preventDefault();</li>\n<li>event.key 对比 event.keyCode，如果不考虑兼容 IE8 这样的老 IE 浏览器，推荐使用 event.key，键盘是千奇百怪的，操作系统也是多样的，event.keyCode 值会有较大出入（常规键都是一样的），使用 event.key 更保险一点（虽然也不是完全 100% 兼容），也更好记忆。</li>\n</ol>\n<h1 id="dom-测试八"><a href="#dom-%E6%B5%8B%E8%AF%95%E5%85%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 测试八</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-26-09-59-00-90ffad1515d4c7548473e0dace7dd99c-b1028.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 622px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 139.71061093247587%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACRklEQVQ4y62UW3PaMBCF+f//hh+QVx6bGR7SgZk0DASw8UW2ZUm+t5/WJFAuTZP2zCTIuzrS2bOSJj//iL7vh2G4l51czBgH+/1+Pp8/PDxMp9PZbLbZvI7JG+RrtG3rnDPWmrKsqqppmrqq2s6jqpz8dkfy4+O3xWLhJQzDuPNwJb4o8kqglBqXY6Yn/3h+fnr6ziZxFO2DgJwxJvPIxx0+qBmd1lpoqI1AHKdpSoQdzr04HxzJcRyHhwMmhSG/h1iwWq2CINjvA2vd+xI3dm7quqCmIgdFoduWQF2JDOLoII6622SmKpUy2ZvpvBnwYIpBrhTD75JvJv4GnpwplaQpfcK2uqpZq+8656xXXzejbdZ5MOA/JZEYyQNVLZfL9XpDn/BpvX7dbNYvLysahlsqVaY0WZ7jPyXk4ozW+kje7bYYi88cgCSJsRzbmUca/na7TZK01J5G8efd8rKts0yVs1jqQkPwpmuNNkSGQZgqxWchYAmmUeDds/0Jw7ABweyq/Z9OkiTL+ESBxIwhgqOF1HmjVfBbQYfhHvQcy1viNF8i9Sj1kkxUKjHjthRMewpdyN2gjyrLM6oldXEiPJm1kYiTNAa+3JDaCowA2xiT4tX4+DH4hGFD37N2JZfByMWsG//h3sC2/mEx5uI9O7lNh/Ms4ypTJzb7alMPSpWqSUXddc3/JHs8cV7S8Bskfspev8ETQqPsKDoEYRjHCW3b7Xa+Z3mOwyinFk4+suWdSfwgOrwZJugF5+N3nAVP2f9U89fwCx91YYqJwN6WAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 26 09 59 00" title="" data-src="/static/2019-12-26-09-59-00-90ffad1515d4c7548473e0dace7dd99c-b1028.png" data-srcset="/static/2019-12-26-09-59-00-90ffad1515d4c7548473e0dace7dd99c-2de4f.png 200w,\n/static/2019-12-26-09-59-00-90ffad1515d4c7548473e0dace7dd99c-73fe9.png 400w,\n/static/2019-12-26-09-59-00-90ffad1515d4c7548473e0dace7dd99c-b1028.png 622w" data-sizes="(max-width: 622px) 100vw, 622px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="具体实现-7"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-7"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22808355433686870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nfunction telTrim(strTel) {\n  return (strTel.match(/[0-9]/g).length === 11 && strTel.replace(/[-\\s]/g, \'\')) || strTel;\n}\ntelTrim(\'132-0803-3621\');\ntelTrim(\'132-0803-3621@qq.com\');\n// 第二题\ndocument.querySelector(\'#form\');\ndocument.querySelector(\'#input\');\n// 第三题\n// 第四题\n// 第五题\ndocument.querySelector(\'#form\').addEventListener(\'submit\', function(e) {\n  e && e.preventDefault();\n  var input = document.querySelector(\'#input\');\n  var value = input.value;\n  input.value = telTrim(value);\n});`, `22808355433686870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">function</span> <span class="token function">telTrim</span><span class="token punctuation">(</span><span class="token parameter">strTel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>strTel<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/[0-9]/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">11</span> <span class="token operator">&amp;&amp;</span> strTel<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[-\\s]/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> strTel<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">telTrim</span><span class="token punctuation">(</span><span class="token string">\'132-0803-3621\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">telTrim</span><span class="token punctuation">(</span><span class="token string">\'132-0803-3621@qq.com\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#form\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token comment">// 第四题</span>\n<span class="token comment">// 第五题</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#form\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  e <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> value <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n  input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">telTrim</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-5"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31308992630173237000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nfunction telTrim(strTel) {\n  return (strTel.match(/[0-9]/g).length === 11 && strTel.replace(/[-\\s]/g, \'\')) || strTel;\n}\ntelTrim(\'132-0803-3621\');\ntelTrim(\'132-0803-3621@qq.com\');\n// 第二题\ndocument.querySelector(\'#form\');\ndocument.querySelector(\'#input\');\n// 第三题\n// 方法一\ndocument.querySelector(\'#input\').addEventListener(\'input\', function(e) {\n  if (e.inputType === \'insertFromDrop\') {\n    e.target.value = telTrim(e.target.value);\n  }\n});\n// 方法二\ndocument.querySelector(\'#input\').addEventListener(\'drop\', function(e) {\n  if (e.target.value.length !== 0) {\n    return;\n  }\n  e.preventDefault();\n  var text = e.dataTransfer.getData(\'text\');\n  e.target.value = telTrim(text);\n});\n// 方法三\nvar dragText = \'\';\nwindow.addEventListener(\'dragstart\', function(event) {\n  //copy from https://www.zhangxinxu.com/study/201104/get-selection-text.html\n  var userSelection, text;\n  if (window.getSelection) {\n    //现代浏览器\n    userSelection = window.getSelection();\n  } else if (document.selection) {\n    //IE浏览器 考虑到Opera，应该放在后面\n    userSelection = document.selection.createRange();\n  }\n  if (!(text = userSelection.text)) {\n    text = userSelection;\n  }\n  dragText = text.toString();\n});\ninput.addEventListener(\'drop\', function(e) {\n  e.preventDefault();\n  this.value = telTrim(dragText);\n});\n// 第四题\n// 方法一\ndocument.querySelector(\'#input\').addEventListener(\'input\', function(e) {\n  if (e.inputType === \'insertFromPaste\') {\n    e.target.value = telTrim(e.target.value);\n  }\n});\n// 方法二\n// 获取剪贴板数据方法\nfunction getClipboardText(event) {\n  var clipboardData = event.clipboardData || window.clipboardData;\n  return clipboardData.getData(\'text\');\n}\ndocument.querySelector(\'#input\').addEventListener(\'paste\', function(e) {\n  e.preventDefault();\n  // 默认原始输入框为空\n  var txt = getClipboardText(e);\n  // console.log(txt);\n  var newTxt = telTrim(txt);\n  document.execCommand(\'insertText\', false, newTxt);\n});\n// 第五题\ndocument.querySelector(\'#form\').addEventListener(\'submit\', (e) => {\n  e && e.preventDefault();\n  var input = document.querySelector(\'#input\');\n  var value = input.value;\n  input.value = telTrim(value);\n});`, `31308992630173237000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">function</span> <span class="token function">telTrim</span><span class="token punctuation">(</span><span class="token parameter">strTel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>strTel<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/[0-9]/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">11</span> <span class="token operator">&amp;&amp;</span> strTel<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[-\\s]/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> strTel<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">telTrim</span><span class="token punctuation">(</span><span class="token string">\'132-0803-3621\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">telTrim</span><span class="token punctuation">(</span><span class="token string">\'132-0803-3621@qq.com\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#form\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token comment">// 方法一</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>inputType <span class="token operator">===</span> <span class="token string">\'insertFromDrop\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">telTrim</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 方法二</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'drop\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> text <span class="token operator">=</span> e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">\'text\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">telTrim</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 方法三</span>\n<span class="token keyword">var</span> dragText <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'dragstart\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">//copy from https://www.zhangxinxu.com/study/201104/get-selection-text.html</span>\n  <span class="token keyword">var</span> userSelection<span class="token punctuation">,</span> text<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>getSelection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">//现代浏览器</span>\n    userSelection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">//IE浏览器 考虑到Opera，应该放在后面</span>\n    userSelection <span class="token operator">=</span> document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>text <span class="token operator">=</span> userSelection<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    text <span class="token operator">=</span> userSelection<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  dragText <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ninput<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'drop\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">telTrim</span><span class="token punctuation">(</span>dragText<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第四题</span>\n<span class="token comment">// 方法一</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>inputType <span class="token operator">===</span> <span class="token string">\'insertFromPaste\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">telTrim</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 方法二</span>\n<span class="token comment">// 获取剪贴板数据方法</span>\n<span class="token keyword">function</span> <span class="token function">getClipboardText</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> clipboardData <span class="token operator">=</span> event<span class="token punctuation">.</span>clipboardData <span class="token operator">||</span> window<span class="token punctuation">.</span>clipboardData<span class="token punctuation">;</span>\n  <span class="token keyword">return</span> clipboardData<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">\'text\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'paste\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 默认原始输入框为空</span>\n  <span class="token keyword">var</span> txt <span class="token operator">=</span> <span class="token function">getClipboardText</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// console.log(txt);</span>\n  <span class="token keyword">var</span> newTxt <span class="token operator">=</span> <span class="token function">telTrim</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">\'insertText\'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> newTxt<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第五题</span>\ndocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#form\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  e <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> value <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n  input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">telTrim</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-7"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>dataTransfer.getData 替换是没问题的，但是需要判断，字符为空，有值的时候不应该直接替换（例如 livetune 的实现）。</li>\n<li>插值的处理，拖进来的东西，直接就是替换好的，同时又不会替换之前的值。1. 有人通过获取框选位置，进行替换拼接。2. 是使用 document.execCommand 插入（ylfeng250 粘贴那里）。3. 我认为比较好的实现，直接改变拖拽数据或者粘贴数据，在’dragstart’事件中（dataTransfer.setData 以及 clipboardData.setData）。</li>\n<li>有人使用了定时器，但是体验并不好，会闪一下。</li>\n<li>还有一种更容易理解的简单方法，也是看了大家的回答才知道一个新特性，InputEvent.inputType，值包括 insertText, deleteContentBackward, insertFromPaste, insertFromDrop 以及 formatBold。但是 IE 并不支持，慎用。可参考 ziven27 实现。</li>\n<li>最后一题，先 preventDefault，再过滤，再提交。在表单提交中，写在最后的 return true 是没有意义的。</li>\n<li>event.clipboardData || window.clipboardData 是比较好的书写，可以兼容 IE 浏览器。</li>\n</ol>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/DOM练手测试/index.md absPath of file >>> MarkdownRemark",timeToRead:18,frontmatter:{date:"2019-12-26 12:10:17",path:"/dom-practice-test/",tags:"前端, DOM, 练手测试",title:"DOM练手测试",draft:null}},{excerpt:"pointer-events:none 和覆盖层方法的问题 经常会遇到需求，需要禁用 div 中或者 form 元素中一堆表单控件元素，如 ， ， 元素。 很多人用的下面这两种方法实现： 设置 pointer-events:none，例如： 使用::before 伪元素创建一个浮层该在所有的表单元素上，例如： 以上两个方向虽然可以让点击无效，但是并没有阻止键盘访问，也就是 Tab 键索引，或者回车都能触发表单行为，使用 new FormData(form…",html:'<h1 id="pointer-eventsnone-和覆盖层方法的问题"><a href="#pointer-eventsnone-%E5%92%8C%E8%A6%86%E7%9B%96%E5%B1%82%E6%96%B9%E6%B3%95%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointer-events:none 和覆盖层方法的问题</h1>\n<p>经常会遇到需求，需要禁用 div 中或者 form 元素中一堆表单控件元素，如<code class="language-text">&lt;input&gt;</code>，<code class="language-text">&lt;select&gt;</code>，<code class="language-text">&lt;textarea&gt;</code>元素。</p>\n<p>很多人用的下面这两种方法实现：</p>\n<ol>\n<li>\n<p>设置 pointer-events:none，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="524477989018956600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`form {\n pointer-events: none;\n}`, `524477989018956600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>\n <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>使用::before 伪元素创建一个浮层该在所有的表单元素上，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64414262269741010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`form {\n position: relative;\n}\n\nform::before {\n content: \'\';\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n background-color: rgba(0, 0, 0, 0.001);\n}`, `64414262269741010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">form</span> <span class="token punctuation">{</span>\n <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">form::before</span> <span class="token punctuation">{</span>\n <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.001<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>以上两个方向虽然可以让点击无效，但是并没有阻止键盘访问，也就是 Tab 键索引，或者回车都能触发表单行为，使用 new FormData(form)也能获取表单控件值，并不是真正意义上禁用，问题很大。</p>\n<p>那有没有什么简单方法轻松禁用所有表单元素呢？难道真要遍历所有的控件元素再设置<code class="language-text">[disabled]</code>属性吗？</p>\n<h1 id="fieldset-元素轻松实现"><a href="#fieldset-%E5%85%83%E7%B4%A0%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>fieldset 元素轻松实现</h1>\n<p>其实，要真正意义上禁用所有的表单元素很简单，嵌套在<code class="language-text">&lt;fieldset&gt;</code>元素中，然后设置<code class="language-text">&lt;fieldset&gt;</code>元素 disabled 就可以了，代码示意如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81207526363929620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<form>\n  <fieldset disabled>\n    <legend>表单标题</legend>\n    <...>\n  </fieldset>\n</form>`, `81207526363929620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fieldset</span> <span class="token attr-name">disabled</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>legend</span><span class="token punctuation">></span></span>表单标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>legend</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>...</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fieldset</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>下图是 Chrome 浏览器下的效果：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-230f0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 408px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 129.9019607843137%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAIAAAA44esqAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACoElEQVQ4y41UiW6cMBDN/39SlSZSumqqqk3VzaEsSVkWWE5z2fjg7jPOuSFpRyNkzDzG8+aNj+qaXf2+XJ2uzs++fvl89uPbz+0fRynFORcfGgKOGGNt20ohlFSzNbBuyfoXNgyDBud5vtlsyjSdZmvbhpDwradpwHk9vTAppc7M50NMfY+tvu8oLd96VRVNow7BlFLf9/eeNyj9DRGEBEURZ1mERZaFeR7hmaY+52wpM+cVpUqIaRyHcVRKEkLqukZt4IAxijjUjDoXMnuet91uS0IAxu7QD7Zt53kxH6TBV8RgPc5fX4HLEmSlO9cNfR9bqlFZFtc16iyGoZ/eNw2uqgqEB0GQhKFhuyxS7MEPzrkMjsIIZyuTdBpG1BmGEf4lpdL9lxKMvAtGPeAMyfEyt6rP88y8omA5mxHGcmbHcW5vb6+vr/Gjrmtd13ace8u6se0NmgSFJImPzi2wjZYgg5HrOPcpinZR5MaxmyQe2ju7tww+KAngGabBehE/LpLg32CIgbFSCCZELWXNOYWwsFOW+UKfD8CIQBUJEgWB63ogDzjsLLP9thPAE5KGYYj+FXkG5cr3wCBMdT1XjWha2XZMyCgmeUkTkqVZkVeUlbSmrBJSti1ijCMSBB+hy1ktkoqllV54UXJyuvp+cfnp+PT4ZHX+89L+deVcrC0vzE0YreGEcfChM+th0POkD9wPmhbDzDiXMDw6Pj05gvWxi6K4u7vDGDnbrbvbQZIgfPoPe5hnJIe2cAysur6TUih9oWnH3QDHtIyzodVm8SxP3GHr9RrJIdKyLO7vb4w7jgV5QSGQFyagmA2yNzp/YFvX/PhLLOZZALnCpH3KbGLM8xX4yVCzZVn7/f7jYX4eSf7C8Ap5xHFs7rYPDAF/AXmB0349KztQAAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 21 05 19" title="" data-src="/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-230f0.png" data-srcset="/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-132f8.png 200w,\n/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-274bb.png 400w,\n/static/2019-12-15-21-05-19-7a43df4167c6dc38a7f94e89eb16ffa2-230f0.png 408w" data-sizes="(max-width: 408px) 100vw, 408px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Firefox 浏览器下：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-65498.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 409px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 133.74083129584352%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACm0lEQVQ4y41UXVfbMAzl//+dnQ14GIyHnT0NKKOUtSVl+f50GtuJEztNdx3TUErKdo/bo6qSJV3JOhFVNZ3ef724vMTn4tv19Y1lWW3b1nXdfAgYnOCjlJR13SrV7rA5gu0elFInZcknk0kWRC8qKckR5HmOewdnyDpyVZZVVXX9H1CVR6Btuu6NM1Su6zxbz21ZQSWlXK/XjDFKKYSiKAYZeB9Z4FbKWC3EttMAGUiSMW5ogycMIKPI/ZpN5HK1shbLReIH282m67XL5SIMNQuyaWzHzgiBvJ/zq3MYho7jBK6rrZVCqkKggxXnXJcqBMrN3+a85xwEtm17tjPUXPKSFq+AJknTkbQRIoljz/dolm37ZkZR6LougkOGBSjYjqF3FhXoiaIInEIF+zAMXM9D2ghlJqnnsRtxxpBY1mo+n89mj/m66LpNnq8JycIoiuOY7mCIeB9ZoJOYHpITzCdqzrIsTdMkTSCgWvxlvkHeofNBSYawfaoM4IxCDp1RkvlhqmrGZlvnRci/I0OF9g7vEYLpOcoewhx1RnyYBr63Wq3mi4Xv+yTLcN14q8ba2KVJArKNZ0EL0dRH+ownKVXZSH2kYpXwwwgeSUYSQmKS84KyghWVeDXrD9jRrSKsTCnHIbzy4vTz6dnV9x9fzs4/nZ6fXl4939wuft4++dGai7TgGS3NEXUDthuwvMFw9Kftd83+NOGh6YPRe3v0GuKM/X58BDfL5RNWn+j53f4HXias5BydYJwVlGILokFyB1xlXuLR2X6Y/rqb3CHyw2yG6cLr/2Pbjud5gX8/vcewYkowsHi53MxJf9GuVai2bc3d2CVS6ZjDDh5ijmySg7kBsJLwyOD/cc2asH7p61hqB70uGUNG6kPA4C9wjBOL0nL2kAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 21 05 37" title="" data-src="/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-65498.png" data-srcset="/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-67408.png 200w,\n/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-5cbc3.png 400w,\n/static/2019-12-15-21-05-37-62e08a3fb8753a1785cd81ec3b679ca3-65498.png 409w" data-sizes="(max-width: 409px) 100vw, 409px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>Edge 浏览器下：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-bb574.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 410px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 127.3170731707317%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACXklEQVQ4y42UWY+qQBSE/f//RuOTz9fk7tfMg6CggAou7C3IFuF+0DPGGXEyFULo011dhzqneyCEmEwm4/F4NBoNh8PpdHo8Hpumqeu6uUPdh0FVVb7vn04nv8P5fC6Kond18x4t2fN8dT6/FrkMJUlyeMB+v79cLj1kdMg8Z67bm+G5A7uc71CWZQ8ZprXZBIdDc70SYogUf4GalMUCx3H6ldlS6lRZRggLGIZhSAp5nqdpKmWv3dYfycwZhoF4JgSha10HQaDrOqvh8L3ZbJo+tGQ0SdK2beQIIRWGkejw6HAP2XVd07Ii1yVEIr6PXhBFUfMpXsnb7Za0kzAgFEaRqiiGabYb+D6GseApmR9DBE6Vt6WORWwahuPsow6u5/IjrMOCx54bxHGsKMpisVBVlUkRi/V6RSJEMNLzPBxBn1+Tu7wjUxtqyISsJEUyTROH5Xu329kdKPUHC1vybSw/SBXO9gHwybGffGt99BHHc3TkOxaCCJvSM0+VJaR/q9WKtJfLpee6eP7U7cdOwIXuVCRRGOZZlpVl3dT95KKqxCWXT5KX2/1RNy3sVjV9vdlathPbjk3l0uy2jCdO80tRDvKqCtOMuTC5iKxYGtbPP/9+z16+ff/x6+/sRVm46kJbrlyRsCB4e/xzmmRFWyp5gADfPel90p5cPZqmGcYa0Alyo+YLaMkshYPD7EJJGAYBhYmJYFv6BqpAXmUHebZfz/N8PqcwlmXRCRwHbUkihqbrGHW7w1gmux2NrLs2ekolb5LsC5m3ZHlcrh3aUxVFs9mM/uy9d+7vYD7+A/xZmnZbr4E6AAAAAElFTkSuQmCC\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 21 05 58" title="" data-src="/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-bb574.png" data-srcset="/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-0fa18.png 200w,\n/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-c3228.png 400w,\n/static/2019-12-15-21-05-58-fd5b4e8e54320db0e5c31cb751c69a95-bb574.png 410w" data-sizes="(max-width: 410px) 100vw, 410px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="ie-浏览器的瑕疵和解决"><a href="#ie-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E7%91%95%E7%96%B5%E5%92%8C%E8%A7%A3%E5%86%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE 浏览器的瑕疵和解决</h1>\n<p>然后，IE 浏览器（包括 Edge）下有个瑕疵，那就是 UI 样式上虽然禁用了，键盘也无法响应，但是，输入框内容居然可以输入，而且表单的提交行为居然也可以点击触发，有些不完美，怎么办呢？</p>\n<p>可以再辅助下面的 CSS：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57323546317056115000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`fieldset[disabled] {\n  -ms-pointer-events: none;\n  pointer-events: none;\n}`, `57323546317056115000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">fieldset[disabled]</span> <span class="token punctuation">{</span>\n  <span class="token property">-ms-pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n  <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>IE10+浏览器都可以完美禁用。</p>\n<p>如果兼容 IE8，IE9 浏览器的话，那使用伪元素创建一个浮层覆盖在所有表单元素上面，就是一开始提到的覆盖方法</p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/如何disabled禁用所有表单input输入框元素/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 21:00:30",path:"/disabled-all-form-elements/",tags:"前端, DOM, DOM知识点",title:"如何disabled禁用所有表单input输入框元素",draft:null}},{excerpt:"图片服务器需要配置 Access-Control-Allow-Origin 一般团队都会有一个专门域名放置静态资源，例如腾讯是 gtimg.com，百度是 bdimg.com；或者很多团队使用的是腾讯云或者阿里云的服务。 而主页面所在域名往往不一样，当需要需要对 canvas 图片进行 getImageData()或 toDataURL()操作的时候，跨域问题就出来了，而且跨域问题还不止一层。 首先，第一步，图片服务器需要配置 Access-Control-Allow-Origin…",html:'<h1 id="图片服务器需要配置-access-control-allow-origin"><a href="#%E5%9B%BE%E7%89%87%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE-access-control-allow-origin" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>图片服务器需要配置 Access-Control-Allow-Origin</h1>\n<p>一般团队都会有一个专门域名放置静态资源，例如腾讯是 gtimg.com，百度是 bdimg.com；或者很多团队使用的是腾讯云或者阿里云的服务。</p>\n<p>而主页面所在域名往往不一样，当需要需要对 canvas 图片进行 getImageData()或 toDataURL()操作的时候，跨域问题就出来了，而且跨域问题还不止一层。</p>\n<p>首先，第一步，图片服务器需要配置 Access-Control-Allow-Origin 信息，例如：</p>\n<p>如 PHP 添加响应头信息，*通配符表示允许任意域名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48578779908903000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(&quot;Access-Control-Allow-Origin: *&quot;);`, `48578779908903000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="php"\n              >\n                <span class="gatsby-code-button-language">php</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Access-Control-Allow-Origin: *"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或者指定域名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47409350674102970000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(&quot;Access-Control-Allow-Origin: 你的网站域名&quot;);`, `47409350674102970000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="php"\n              >\n                <span class="gatsby-code-button-language">php</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="php"><pre style="counter-reset: linenumber NaN" class="language-php line-numbers"><code class="language-php"><span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">"Access-Control-Allow-Origin: 你的网站域名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时，Chrome 浏览器就不会有 Access-Control-Allow-Origin 相关的错误信息了，但是，还会有其他的跨域错误信息。</p>\n<h1 id="canvas-图片-getimagedata-cross-origin-跨域问题"><a href="#canvas-%E5%9B%BE%E7%89%87-getimagedata-cross-origin-%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 图片 getImageData cross-origin 跨域问题</h1>\n<p>对于跨域的图片，只要能够在网页中正常显示出来，就可以使用 canvas 的 drawImage() API 绘制出来。但是如果你想更进一步，通过 getImageData()方法获取图片的完整的像素信息，则多半会出错。</p>\n<p>举例来说，使用下面代码获取 github 上的自己头像图片信息：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63233245952574020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.createElement(\'canvas\');\nvar context = canvas.getContext(\'2d\');\n\nvar img = new Image();\nimg.onload = function() {\n  context.drawImage(this, 0, 0);\n  context.getImageData(0, 0, this.width, this.height);\n};\nimg.src = \'https://avatars3.githubusercontent.com/u/496048?s=120&v=4\';`, `63233245952574020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'https://avatars3.githubusercontent.com/u/496048?s=120&amp;v=4\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果在 Chrome 浏览器下显示如下错误：</p>\n<blockquote>\n<p>Uncaught DOMException: Failed to execute ‘getImageData’ on ‘CanvasRenderingContext2D’: The canvas has been tainted by cross-origin data.</p>\n</blockquote>\n<p>Firefox 浏览器错误为：</p>\n<blockquote>\n<p>SecurityError: The operation is insecure.</p>\n</blockquote>\n<p>如果使用的是 canvas.toDataURL()方法，则会报：</p>\n<blockquote>\n<p>Failed to execute ‘toDataURL’ on 　’HTMLCanvasElement’: Tainted canvased may not be exported</p>\n</blockquote>\n<p>原因其实都是一样的，跨域导致。</p>\n<p>那有没有什么办法可以解决这个问题呢？</p>\n<p>可以试试 crossOrigin 属性。</p>\n<h1 id="html-crossorigin-属性解决资源跨域问题"><a href="#html-crossorigin-%E5%B1%9E%E6%80%A7%E8%A7%A3%E5%86%B3%E8%B5%84%E6%BA%90%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML crossOrigin 属性解决资源跨域问题</h1>\n<p>在 HTML5 中，有些元素提供了支持 CORS(Cross-Origin Resource Sharing)（跨域资源共享）的属性，这些元素包括<code class="language-text">&lt;img&gt;</code>，<code class="language-text">&lt;video&gt;</code>，<code class="language-text">&lt;script&gt;</code>等，而提供的属性名就是 crossOrigin 属性。</p>\n<p>因此，上面的跨域问题可以这么处理：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7106600357405890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var canvas = document.createElement(\'canvas\');\nvar context = canvas.getContext(\'2d\');\n\nvar img = new Image();\nimg.crossOrigin = \'\';\nimg.onload = function() {\n  context.drawImage(this, 0, 0);\n  context.getImageData(0, 0, this.width, this.height);\n};\nimg.src = \'https://avatars3.githubusercontent.com/u/496048?s=120&v=4\';`, `7106600357405890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'https://avatars3.githubusercontent.com/u/496048?s=120&amp;v=4\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>增加一个 img.crossOrigin = ”即可，虽然 JS 代码这里设置的是空字符串，实际上起作用的属性值是 anonymous。</p>\n<p>crossOrigin 可以有下面两个值：</p>\n<ul>\n<li>anonymous：元素的跨域资源请求不需要凭证标志设置。</li>\n<li>use-credentials：元素的跨域资源请求需要凭证标志设置，意味着该请求需要提供凭证。</li>\n</ul>\n<p>其中，只要 crossOrigin 的属性值不是 use-credentials，全部都会解析为 anonymous，包括空字符串，包括类似’abc’这样的字符。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38023602197162520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`img.crossOrigin = \'abc\';\nconsole.log(img.crossOrigin); // 结果是\'anonymous\'`, `38023602197162520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">\'abc\'</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>crossOrigin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结果是\'anonymous\'</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 269px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 43.12267657992565%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABRklEQVQoz4VS24rCMBTs//+OeEGhUPTNF8FtLUitG2ua9KLWNml6SbvTyrILi+wQwuQkc2Y4xMiy7PF4NE1TlmVVVc0ftG0rikIphVu8qesaFdRBjOOIvu8JIbfbDaTrun4ESKs1SJKmQog8z33fj+MYdXThnBtDB6VkUaAtdlWW8JFSCinrqmrHSBpuY4SXIQgeMMYMhMmV+vC88H4PksSjNIhj/3w+HA6yeOpaleQiCMmfTyj1GARACw5xD8Ptlq5Wl8XiMp9nm81pNiO+bztOEASMcUQ9fw7Y7/eUUphBjH0UH4+FZTHXTR0n3O1Sz6tMU1+vsEC8/hv6F37E3ekkJpNovY5MM1wuI8uqp9M+SV4T699giI2BlUIUhHDbZrYdu25k2xK2Wg/zeQPcYtosDA0ahlfGrpzTKMICGY7/AePAB/kCMM34H+DOrC8AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 20 51 41" title="" data-src="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png" data-srcset="/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-b37f7.png 200w,\n/static/2019-12-15-20-51-41-d548da4f0d4a32fc916642070baf402b-0bf37.png 269w" data-sizes="(max-width: 269px) 100vw, 269px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>另外还有一点需要注意，那就是虽然没有 crossOrigin 属性，和设置 crossOrigin=“use-credentials”在默认情况下都会报跨域出错，但是性质上却不一样，两者有较大区别。</p>\n<h2 id="crossorigin-兼容性"><a href="#crossorigin-%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>crossOrigin 兼容性</h2>\n<p>IE11+(IE Edge)，Safari，Chrome，Firefox 浏览器均支持，IE9 和 IE10 会报 SecurityError 安全错误，如下截图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 356px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 29.213483146067414%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABBElEQVQY02VN2WrDMBDM/39ZoXlIE9qASxxbkQ/JOlZaWVdst3LpQ6HDsMwMM+zhlTkNM53cY3ICJyJq7eS1e5+93dZ1W5dyn8vyl8u6ppxTSoc6bQ33ElOvY831uWM3gZ9SjJhM2riJyuWvfwghgIaDOZ7OzFcULgTqEQXhgjDbT6btYeBSWoUh5uxTCql8y6GI/FTG7mP6cjo+bEX1W6M+iGpvXXNtuhulFRnuD9IJKl0z2UFiy23NLBWo0I9C6TLW8dlMjoPv5NxyrJi7y9DbOJjIMJewV3OvvTB+UHOxTPs5ZgV2H4NSaMGAtgbQgNupsdgflqTkRfwWStNAgRDCe/8N9W9QOYlOEfoAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 20 52 38" title="" data-src="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png" data-srcset="/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-8eb8a.png 200w,\n/static/2019-12-15-20-52-38-b1755dd1728757d0a646e5fa90f62218-0ab45.png 356w" data-sizes="(max-width: 356px) 100vw, 356px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="crossorigin-属性为什么可以解决资源跨域问题？"><a href="#crossorigin-%E5%B1%9E%E6%80%A7%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E8%A7%A3%E5%86%B3%E8%B5%84%E6%BA%90%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>crossOrigin 属性为什么可以解决资源跨域问题？</h1>\n<p>crossOrigin=anonymous 相对于告诉对方服务器，你不需要带任何非匿名信息过来。例如 cookie，因此，当前浏览器肯定是安全的。</p>\n<p>就好比你要去别人家里拿一件衣服，crossOrigin=anonymous 相对于告诉对方，我只要衣服，其他都不要。如果不说，可能对方在衣服里放个窃听器什么的，就不安全了，浏览器就会阻止。</p>\n<h1 id="ie10-浏览器不支持-crossorigin-怎么办？"><a href="#ie10-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E6%94%AF%E6%8C%81-crossorigin-%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE10 浏览器不支持 crossOrigin 怎么办？</h1>\n<p>我们请求图片的时候，不是直接通过 new Image()，而是借助 ajax 和 URL.createObjectURL()方法曲线救国。</p>\n<p>代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45026655215376680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var xhr = new XMLHttpRequest();\nxhr.onload = function() {\n  var url = URL.createObjectURL(this.response);\n  var img = new Image();\n  img.onload = function() {\n    // 此时你就可以使用canvas对img为所欲为了\n    // ... code ...\n    // 图片用完后记得释放内存\n    URL.revokeObjectURL(url);\n  };\n  img.src = url;\n};\nxhr.open(\'GET\', url, true);\nxhr.responseType = \'blob\';\nxhr.send();`, `45026655215376680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 此时你就可以使用canvas对img为所欲为了</span>\n    <span class="token comment">// ... code ...</span>\n    <span class="token comment">// 图片用完后记得释放内存</span>\n    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  img<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">\'GET\'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">\'blob\'</span><span class="token punctuation">;</span>\nxhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此方法不仅 IE10 浏览器 OK，原本支持 crossOrigin 的诸位浏览器也是支持的。</p>\n<p>也就多走一个 ajax 请求，还可以！</p>\n<p>根据，根据实践发现，在 IE 浏览器下，如果请求的图片过大，几千像素那种，图片会加载失败，我猜是超过了 blob 尺寸限制。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/解决canvas图片getImageData,toDataURL跨域问题/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-12-15 20:32:54",path:"/crossorigin-canvas-getimagedata-cors/",tags:"前端, DOM, DOM知识点",title:"解决canvas图片getImageData,toDataURL跨域问题",draft:null}},{excerpt:"简介 首先看下面这种截图： 如果我们想实现点击上面的下载按钮下载一张图片，你会如何实现？ 我们可能会想到一个最简单的方法，就是直接按钮 a 标签链接一张图片，类似下面这样： 但是，想法虽好，实际效果却不是我们想要的，因为浏览器可以直接浏览图片，因此，我们点击下面的“下载”链接，并是不下载图片，而是在新窗口直接浏览图片。 于是，基本上，目前的实现都是放弃 HTML 策略，而是使用，例如 php 这样的后端语言，通过告知浏览器 header…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>首先看下面这种截图：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-84da0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 295px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.45762711864407%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABKElEQVQoz4VR2W7CMBDM//9WK/HWlwLhCIoKuYljk4DXx9p0HSPaqpW6mgfv7Mw6niTee/df+bm+M4iotU7i7P6zQk/k7KEjH9jH8UiGx+h+t9ZmWZYgOpwXPEH6uI8QGW0MgH62dFBab3e7RFkUYC8KI4TCQSIHy262v1kBgeTSnEfoRhk1o3b9BOvNNpgHQK7coNxofHZWmxYWObyd4L2UHJzQvmKXVZavDkcmg5KYblIrMmuLV4U37SKmcA8WXDdcsgkmZYmU1tNHE6JGGi+uKiVzeK9zMZ45IUd5KAX7/f71ZdE0bWhBDqzve/ZQUmDG7OjNf6ZtLRZls1ymXXeOu4TgXFz8l8AGM/2usiyLX1XXdds2dV2dTgUJqK2rKo6ozfM8TdefeUYECiqgkp4AAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 38 16" title="" data-src="/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-84da0.png" data-srcset="/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-38392.png 200w,\n/static/2019-12-15-19-38-16-6c0e89e29634e19a5b1beab36a10f310-84da0.png 295w" data-sizes="(max-width: 295px) 100vw, 295px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>如果我们想实现点击上面的下载按钮下载一张图片，你会如何实现？</p>\n<p>我们可能会想到一个最简单的方法，就是直接按钮 a 标签链接一张图片，类似下面这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17036424445990072000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot;>下载</a>`, `17036424445990072000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但是，想法虽好，实际效果却不是我们想要的，因为浏览器可以直接浏览图片，因此，我们点击下面的“下载”链接，并是不下载图片，而是在新窗口直接浏览图片。</p>\n<p>于是，基本上，目前的实现都是放弃 HTML 策略，而是使用，例如 php 这样的后端语言，通过告知浏览器 header 信息，来实现下载。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87979704247811280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(\'Content-type: image/jpeg\');\nheader(&quot;Content-Disposition: attachment; filename=\'download.jpg\'&quot;);`, `87979704247811280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">\'Content-type: image/jpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition: attachment; filename=\'download.jpg\'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然而，这种前后端都要操心的方式神烦，现在都流行前后端分离，还搅在一起太累了，感觉不会再爱了。</p>\n<p>那有没有什么只需要前端动动指头就能实现下载的方式呢？有，就是本文要介绍的 download 属性。</p>\n<p>例如，我们希望点击“下载”链接下载图片而不是浏览，直接增加一个 download 属性就可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1468729523166456600"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot; download>下载</a>`, `1468729523166456600`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>结果在 Chrome 浏览器下（FireFox 浏览器因为跨域限制无效）：</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-ab1e0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 530px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 32.264150943396224%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABLUlEQVQY01WP207CQBCG+/6PYOLxEo2EeIEJQgwixVIIUgklKi1tsd3udntiDy2060biBX++TDKTTGY+pSxLxigvWFHwjeMkOQ0hdBxnaa6yLE+ShFJaVdXhNHKS57nCOcdRBsMMY6LpCw/gEIZzwxiqowAAFEWM8bquq9MIISCECuPc91N7nUJIRtrK2oZB4I91vdt7dt1tmu3KvTxU/1Ed2cumFgghhRCCIJAPRhiq2vgHxpQQEASu6zFK2S6pDkyIUojDP9WxSjslTrOPz02+I3JnMjPWrl9wBhGyLcv2QGNeXuj8clKcq/H1ENyo6GoIz17C1gy7nqcQysIokebS62ttf2+2MY6m02m/PzAWq7vee3OwbGtWo6PfPr42n7T7jtrqvj10VdM0fwFK7kX1KHkfuAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 41 40" title="" data-src="/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-ab1e0.png" data-srcset="/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-8e92d.png 200w,\n/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-d963f.png 400w,\n/static/2019-12-15-19-41-40-ae1e5855dc9411bfcf74cfb98bceeec2-ab1e0.png 530w" data-sizes="(max-width: 530px) 100vw, 530px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>不仅如此，我们还可以指定下载图片的文件名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34986803379858043000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=\'index_logo.gif\' download=\'_5332_.gif\'>\n  下载\n</a>`, `34986803379858043000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">\'index_logo.gif\'</span> download<span class="token operator">=</span><span class="token string">\'_5332_.gif\'</span><span class="token operator">></span>\n  下载\n<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果后缀名一样，我们还可以缺省，直接文件名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41400527463512680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=\'index_logo.gif\' download=\'_5332_\'>\n  下载\n</a>`, `41400527463512680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">\'index_logo.gif\'</span> download<span class="token operator">=</span><span class="token string">\'_5332_\'</span><span class="token operator">></span>\n  下载\n<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-bc7e0.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 9.685641461342396%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAARElEQVQI12N4+/bt3du3Lt960L7r8frzrz5++vLu47f3nwijl+8+M7x48eLatWs3bt4+du7a6fNXbt2+9ez5c6LQs+cAwipsAX3IkRAAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 48 37" title="" data-src="/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-fee1c.png" data-srcset="/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-a67b7.png 200w,\n/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-0b187.png 400w,\n/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-fee1c.png 800w,\n/static/2019-12-15-19-48-37-2af1175fd54c0cee0edb9ab70b8a40db-bc7e0.png 1177w" data-sizes="(max-width: 800px) 100vw, 800px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h1 id="浏览器兼容性和跨域策略"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%E5%92%8C%E8%B7%A8%E5%9F%9F%E7%AD%96%E7%95%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浏览器兼容性和跨域策略</h1>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-a76b9.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 559px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 47.406082289803216%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB7klEQVQoz3WO22/ScBzF++f54MP0YWYPXjbDkkXDlmzCYItQVpGbUXcB4jKnm3POZMjLuKwhgVJ+0HtZR1tgSGdlbWFsgXUPvlkfND5o8nk43+R8zzmQyOS4cpYDaR6kuUpGIFAGpHiQEliUrB0Y37ihLv4PqK9Wta+Mhd5idEsojK4wWpvWFFo9Jfudo18+rfbv5ytDuu7KZle+Pq8Pz0RdpIwm02uyRp02ddk05IHl60lDQxz8FWFpC+j3cXzVqTVbhXjOt1eKvsbfxsD7rlod6LXOMZDxbF+pml3pzwSrzOzJVrNocaZwJIam2f3RvM0B3Pfzj23FGYE9FKncDogvpp1sPXOuWFmWWbr4LpzWCbVBQG2JaBDFPXLrLmqHccSOOXzAN1N0zmEuzm2XJu4hmflblakE2MD2d1pHhR+XJ1qLLB9sUugnSIgGyiM33310jlHT3pLHVVj0Y0sL2FMYh5PL08lnE6HswiTl+rI+X7kzIu9Ghxcnai2fDNhSa7NQYw0Rbt/Y3XY9xJ8EcCRIh2PscpAKRciwuwxPYrNB3O9hgodbsDg+1k5s8lSOrmam8DlvBYbEN0H6wWji85KHCcSIlyE2HOdXw3TkBR15VYkgOLJOr0TEVfQDwj0a51cQGnFhG34H8D4v+X8CMfqQsZZ4QGUAAAAASUVORK5CYII=\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 49 10" title="" data-src="/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-a76b9.png" data-srcset="/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-8c77e.png 200w,\n/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-f1700.png 400w,\n/static/2019-12-15-19-49-10-2e82c794e638fbc6b67f03dc1a782875-a76b9.png 559w" data-sizes="(max-width: 559px) 100vw, 559px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<p>然而，caniuse 展示的兼容性不是很准确，主要表现在跨域策略的处理上，由于我手上没有 IE13，所以，只能对比 Chrome 浏览器和 FireFox 浏览器：</p>\n<p>如果需要下载的资源是跨域的，包括跨子域，在 Chrome 浏览器下，使用 download 属性是可以下载的，但是，并不能重置下载的文件的命名；而 FireFox 浏览器下，则 download 属性是无效的，也就是 FireFox 浏览器无论如何都不支持跨域资源的 download 属性下载。</p>\n<p>而如果资源是同域名的，则两个浏览器都是畅通无阻的下载，不会出现下载变浏览的情况。</p>\n<p><html><head></head><body><a class="gatsby-resp-image-link" href="/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-6566f.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 462px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 77.92207792207792%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACg0lEQVQoz3VS23KbMBD1/39KZtq8us0ktd3G8QUbg7lK4iKwARmQECJ22mmaLk7cyUO6c9AwLGfP2V0N/ITFrNlVKq2PtHnB9R+3fIfDMwBVzyF/pvx3ql7StEzvvtD771mWD8ZrV/OThR1piC3pcULUGHejfwhP4+hpHJ6m8UlLT3r2S/ey1fBG+3Y/XywHrm2tV5rnujSmrRQNr2XDewg4hYpDif02JG0YdGGg4ki0rXr6mYtuqa0GdpwvbbyYP2RF0XWdUqqFtFJSyu7xyPXN10+f1uOxOZ2Gq9XR84DcNiJnVU/ODxWJ4ofpD3NrE0JM0wzDMIqiJEkwIYWPZBw3AEplFLVJIqCqbFhZa0B+7LqExrP5PCAEzLuOu7UswzQNw/A8rxSi6bpGKaHU6ymEaKXcs3oBZNCZz2aglaap7/tA0nUdIcwYk20LbTTvA2o1TdvKtKjny9UA7FmWhTH2fARSZ20XYVxAsIIdDpxzUOMXVHUNNd7I0EOaFb6PgiCY9RZifb0eDodXV1fX159vbu+MjRGQgGCYQACzcBwny/a7g+jJVc0ZK7bQpGliRBiLEEGGsa05r6q6qqpDH2WeF7ZlTSYTKFIeWMr4GxmSYRD4CPXlA4SjGBR2+91uvwfv4FNAr0JQShFClCaC8zfbkCuKHGNk9NqGttTAtu04cMK7bTvgFmj9dqWEOwADU61MLmQuz9G+xvmSyMsLPH0KZg7LPcf5x8u0YZay+Tjge8VFzKqNh8m+yMo6zzNorCwZzcrFaj0oy7rfBP8A0GlW8i2Jh7ejte37SQarHI3GGPmYZg/z5cBwsO0H1n8AqY1LDBzrbmB5BOCg0HKx4QZg4S/lLUz0/hhcVwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image lazy" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;" alt="2019 12 15 19 50 48" title="" data-src="/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-6566f.png" data-srcset="/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-c4b43.png 200w,\n/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-5dba5.png 400w,\n/static/2019-12-15-19-50-48-726e99ba28995f41961bf77069c29609-6566f.png 462w" data-sizes="(max-width: 462px) 100vw, 462px">\n    </span>\n  </span>\n  \n  </a>\n    </body></html></p>\n<h2 id="是否支持-download-属性的监测"><a href="#%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81-download-%E5%B1%9E%E6%80%A7%E7%9A%84%E7%9B%91%E6%B5%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>是否支持 download 属性的监测</h2>\n<p>要监测当前浏览器是否支持 download 属性，一行 JS 代码就可以了，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43073798932598325000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var isSupportDownload = \'download\' in document.createElement(\'a\');`, `43073798932598325000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> isSupportDownload <span class="token operator">=</span> <span class="token string">\'download\'</span> <span class="token keyword">in</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>除了图片资源，我们还可以是 PDF 资源，或者 txt 资源等等。尤其 Chrome 等浏览器可以直接打开 PDF 文件，使得此文件格式需要 download 处理的场景越来越普遍。</p>\n<p>此 HTML 属性虽然非常实用和方便，但是兼容性制约了我们的大规模应用。</p>\n<p>同时考虑到很多时候，需要进行一些下载的统计，纯前端的方式想要保存下载量数据，还是有些吃紧，需要跟开发的同学配合才行，还不如使用传统方法。</p>\n<p>所以，download 属性的未来前景在哪里？当下是否可以直接加入到实际项目？还需要我们一起好好想想。其实使用 JS 实现 download 属性的 polyfill 并不难，但是，考虑到为何不所有浏览器都使用 polyfill 的方法，又觉得为了技术而技术是不太妥当的。</p>\n<p>如果是需要用 JS 触发下载，见下一篇文章<a href="/js-text-string-download-as-html-json-file/">使用 JS 让文本字符串作为 html 或 JSON 文件下载</a></p>',id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/HTML5中的download属性/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 19:36:41",path:"/html-download-attribute/",tags:"前端, DOM, DOM知识点",title:"HTML5中的download属性",draft:null}},{excerpt:"HTMLUnknownElement 元素 在网页中，随便写一个标签，例如： 这个 就是一个 HTMLUnknownElement 元素。 在 HTML 规范中，HTMLUnknownElement 元素是一个被认可的合法的元素，CSS 可以无障碍使用，例如： 则实时效果如下（用户名大写）： ZHANGXINXU HTMLUnknownElement 继承 HTMLElement 中的方法，因此，基本上，常用的 HTML 方法都是可以畅快使用的，例如，文字变红色，可以直接： 不同点 在 HTML…",html:'<h1 id="htmlunknownelement-元素"><a href="#htmlunknownelement-%E5%85%83%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTMLUnknownElement 元素</h1>\n<p>在网页中，随便写一个标签，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75137490603960550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<username>zhangxinxu</username>`, `75137490603960550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>zhangxinxu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这个<code class="language-text">&lt;username&gt;</code>就是一个 HTMLUnknownElement 元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="89531495895861740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.querySelector(\'username\') instanceof HTMLUnknownElement; // 返回值是true`, `89531495895861740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">;</span> <span class="token comment">// 返回值是true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在 HTML 规范中，HTMLUnknownElement 元素是一个被认可的合法的元素，CSS 可以无障碍使用，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29733718474505966000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`username {\n  text-transform: uppercase;\n}`, `29733718474505966000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="css"\n              >\n                <span class="gatsby-code-button-language">css</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">username</span> <span class="token punctuation">{</span>\n  <span class="token property">text-transform</span><span class="token punctuation">:</span> uppercase<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>则实时效果如下（用户名大写）：</p>\n<p>ZHANGXINXU</p>\n<p>HTMLUnknownElement 继承 HTMLElement 中的方法，因此，基本上，常用的 HTML 方法都是可以畅快使用的，例如，文字变红色，可以直接：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85014230625796960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.querySelector(\'username\').style.color = \'red\';`, `85014230625796960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">\'red\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="不同点"><a href="#%E4%B8%8D%E5%90%8C%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不同点</h2>\n<p>在 HTML 世界中，HTMLUnknownElement 和 HTMLDivElement，HTMLSpanElement 等等都是平级的，平起平坐，都是 HTMLElement 的子集。那其中有没有什么不一样的地方呢？</p>\n<p>区别在于，规范中的一部分 HTML 元素自己带有一些特殊的属性或者方法，例如，表单元素 HTMLFormElement 元素有 reset()方法，novalidate 属性。然而，HTMLUnknownElement 自己是没有携带任何属性和方法。</p>\n<p>这使其是一件好事，我们就可以为 HTMLUnknownElement 扩展非常私有的方法，而不用担心会影响其他元素。例如来说，默认所有 HTMLUnknownElement 元素的 display 计算值都是 inline，我们可以扩展了 block()方法使其块状化。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56775986923658306000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`HTMLUnknownElement.prototype.block = function() {\n  this.style.display = \'block\';\n};`, `56775986923658306000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">block</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'block\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>此时执行 document.querySelector(‘username’).block()就可以让<code class="language-text">&lt;username&gt;</code>元素块状化了。</p>\n<p>基于原型扩展的方法，还不算太智能，要是可以针对不同标签类型进行扩展就更好了，以下方法就可以做到</p>\n<h1 id="htmlunknownelement-与自定义元素（custom-elements）"><a href="#htmlunknownelement-%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%EF%BC%88custom-elements%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTMLUnknownElement 与自定义元素（Custom Elements）</h1>\n<p>W3 规范中，对自定义元素的定义是中间必须要有短横线（就是键盘上的减号）连接，并且浏览器也是这么认为的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12530345746744121000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.createElement(\'username\') instanceof HTMLUnknownElement; // 返回值是true\ndocument.createElement(\'user-name\') instanceof HTMLUnknownElement; // 返回值是false`, `12530345746744121000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">;</span> <span class="token comment">// 返回值是true</span>\ndocument<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'user-name\'</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">;</span> <span class="token comment">// 返回值是false</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>从这一点看，HTMLUnknownElement 一定不是自定义元素，换句通俗的话解释就是“自定义元素不等于随便定义元素”。</p>\n<h1 id="自定义元素（custom-elements）"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%EF%BC%88custom-elements%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义元素（Custom Elements）</h1>\n<h2 id="es6-下的继承与自定义-html-元素类型"><a href="#es6-%E4%B8%8B%E7%9A%84%E7%BB%A7%E6%89%BF%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89-html-%E5%85%83%E7%B4%A0%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES6 下的继承与自定义 HTML 元素类型</h2>\n<p>对于自定义元素，规范提供了一套各种 HTML 特性可继承可扩展的机制，通常使用套路如下：</p>\n<ol>\n<li>ES6 class 继承；</li>\n<li>customElements 定义元素；</li>\n</ol>\n<p>先说说目前支持相对较好的匿名自定义元素（Autonomous custom elements），也就是继承自 HTMElement 的用法。</p>\n<p>例如，我们实现一个基于 rows 属性多行打点效果的小组件。</p>\n<p>注意，下面的演示代码基本上可以作为各类自定义元素（甚至 Web Components）使用的模板，很有用，例如，对于学习类似 Vue 的实时刷新很有帮助，对于学习 Shadow DOM 和 Web Components 也是非常好的案例。以后要实现类似功能，代码拷贝过去，修改修改即可！</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5346196917424151000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class HTMLEllElement extends HTMLElement {\n  // 指定观察的属性，这样attributeChangedCallback才会起作用\n  static get observedAttributes() {\n    return [\'rows\'];\n  }\n\n  constructor() {\n    // constructor中首先第一件事情就是调用 super\n    // super指代了整个prototype或者__proto__指向的对象\n    // 这一步免不了的\n    super();\n    // 创建shadow元素，实际上，从本例要实现的效果讲，\n    // 直接元素上设置也可以，就是HTML丑了点，CSS要放在外部\n    // 且目前火狐并不支持shadow dom可以不用，\n    // 但一切为了学习，还是展现下现代web组件的实现方式\n    var shadow = this.attachShadow({\n      // open外部可访问（通过element.shadowRoot），closed则不能\n      mode: \'open\'\n    });\n    // 文本内容移动到shadow dom元素中\n    var div = document.createElement(\'div\');\n    div.innerHTML = this.innerHTML;\n    this.innerHTML = \'\';\n    var style = document.createElement(\'style\');\n    shadow.appendChild(style);\n    shadow.appendChild(div);\n  }\n\n  // 下面4个方法为常用生命周期\n  connectedCallback() {\n    console.log(\'自定义元素加入页面\');\n    // 执行渲染更新\n    this._updateRendering();\n  }\n\n  disconnectedCallback() {\n    // 本例子该生命周期未使用，占位示意\n    console.log(\'自定义元素从页面移除\');\n  }\n\n  adoptedCallback() {\n    // 本例子该生命周期未使用，占位示意\n    console.log(\'自定义元素转移到新页面\');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log(\'自定义元素属性发生变化\');\n    this._rows = newValue;\n    // 执行渲染更新\n    this._updateRendering();\n  }\n\n  // 设置直接get/set rows属性的方法\n  get rows() {\n    return this._rows;\n  }\n\n  set rows(v) {\n    this.setAttribute(\'rows\', v);\n  }\n\n  _updateRendering() {\n    // 根据变化的属性，改变组件的UI\n    var shadow = this.shadowRoot;\n    var childNodes = shadow.childNodes;\n    var rows = this._rows;\n    for (var i = 0; i < childNodes.length; i++) {\n      if (childNodes[i].nodeName === \'STYLE\') {\n        childNodes[i].textContent = \\`div {\n          display: -webkit-box;\n          -webkit-line-clamp: \\${rows};\n          -webkit-box-orient: vertical;\n          overflow: hidden;\n        }\\`;\n      }\n    }\n  }\n}\n// 定义x-ell标签元素为多行打点元素\ncustomElements.define(\'x-ell\', HTMLEllElement);`, `5346196917424151000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">HTMLEllElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 指定观察的属性，这样attributeChangedCallback才会起作用</span>\n  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">observedAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">\'rows\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// constructor中首先第一件事情就是调用 super</span>\n    <span class="token comment">// super指代了整个prototype或者__proto__指向的对象</span>\n    <span class="token comment">// 这一步免不了的</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 创建shadow元素，实际上，从本例要实现的效果讲，</span>\n    <span class="token comment">// 直接元素上设置也可以，就是HTML丑了点，CSS要放在外部</span>\n    <span class="token comment">// 且目前火狐并不支持shadow dom可以不用，</span>\n    <span class="token comment">// 但一切为了学习，还是展现下现代web组件的实现方式</span>\n    <span class="token keyword">var</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// open外部可访问（通过element.shadowRoot），closed则不能</span>\n      mode<span class="token punctuation">:</span> <span class="token string">\'open\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 文本内容移动到shadow dom元素中</span>\n    <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'style\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 下面4个方法为常用生命周期</span>\n  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素加入页面\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 执行渲染更新</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 本例子该生命周期未使用，占位示意</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素从页面移除\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">adoptedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 本例子该生命周期未使用，占位示意</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素转移到新页面\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素属性发生变化\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>_rows <span class="token operator">=</span> newValue<span class="token punctuation">;</span>\n    <span class="token comment">// 执行渲染更新</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 设置直接get/set rows属性的方法</span>\n  <span class="token keyword">get</span> <span class="token function">rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_rows<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">set</span> <span class="token function">rows</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'rows\'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">_updateRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 根据变化的属性，改变组件的UI</span>\n    <span class="token keyword">var</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">;</span>\n    <span class="token keyword">var</span> childNodes <span class="token operator">=</span> shadow<span class="token punctuation">.</span>childNodes<span class="token punctuation">;</span>\n    <span class="token keyword">var</span> rows <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_rows<span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">\'STYLE\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">div {\n          display: -webkit-box;\n          -webkit-line-clamp: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rows<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\n          -webkit-box-orient: vertical;\n          overflow: hidden;\n        }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 定义x-ell标签元素为多行打点元素</span>\ncustomElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'x-ell\'</span><span class="token punctuation">,</span> HTMLEllElement<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段文字如果超过 2 行，就会自动在末尾打点</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87654023495492260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n  x-ell {\n    display: block;\n  }\n</style>\n<x-ell rows=&quot;2&quot;>对于现代浏览器，例如webkit内核的浏...组合如下。</x-ell>`, `87654023495492260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n  <span class="token selector">x-ell</span> <span class="token punctuation">{</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-ell</span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>对于现代浏览器，例如webkit内核的浏...组合如下。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-ell</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果想要 3 行打点，也非常简单，直接设置 rows 为 3 即可。我们可以直接手动修改：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27291697685116457000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<x-ell rows=&quot;3&quot;></x-ell>`, `27291697685116457000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-ell</span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-ell</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也可以直接一行 JS 直接修改属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37437867785144860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.querySelector(\'x-ell\').rows = \'3\';`, `37437867785144860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'x-ell\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rows <span class="token operator">=</span> <span class="token string">\'3\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>rows 属性的表现就好像<code class="language-text">&lt;textarea&gt;</code>元素的 rows 属性一样，修改后直接触发了元素本身 UI 的变化，而且是实时的。这就是自定义元素，自己定义一个元素，可以和原生元素一样的行为和特性。</p>\n<p>然而兼容性问题不容忽视，如果只考虑 ES6 继承特性，Firefox，Safari 等浏览器也是可以用的，也就是移动端冒进下也是可以使用的。但是自定义元素注册，以及 Shadow DOM 等特性目前就 Chrome，Android 以及 UC 等浏览器支持，因此，只能用在一些内部产品（如中后台管理系统、内部工具）上。Firefox 目前想要支持可以开启实验功能，about:config，然后设置 dom.webcomponents.customelements.enabled 为 true，以及 dom.webcomponents.shadowdom.enabled 为 true。</p>\n<h1 id="自定义元素与-html-import-引入"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%E4%B8%8E-html-import-%E5%BC%95%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义元素与 HTML import 引入</h1>\n<p>自定义元素还可以在 HTML 模块中使用，目前仅 Chrome 支持。</p>\n<p>大致套路这样的：</p>\n<ol>\n<li>HTML 模块注册与构建自定义元素；</li>\n<li>母页面引入模块；</li>\n<li>母页面自定义标签自动组件呈现；</li>\n</ol>\n<p>例如下面 HTML：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72234947955701360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<link rel=&quot;import&quot; href=&quot;module.html&quot; /> <zxx-info />`, `72234947955701360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="html"\n              >\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>import<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module.html<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zxx-info</span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时<code class="language-text">&lt;zxx-info&gt;</code>这个元素在页面上呈现出来的效果就是自定义元素</p>\n<p>那这个 module.html 究竟做了什么事情呢？就是自定义<code class="language-text">&lt;zxx-info&gt;</code>这个元素。</p>\n<html><head></head><body><div class="gatsby-code-button-container" data-toaster-id="63604947374413820000" data-toaster-class="gatsby-code-button-toaster" data-toaster-text-class="gatsby-code-button-toaster-text" data-toaster-text="复制成功" data-toaster-duration="3500" onclick="copyToClipboard(`<template id=&quot;tpl&quot;>\n  <style>\n    .scope {\n      contain: content;\n    }\n\n    .scope > img {\n      float: left;\n      margin-right: 10px;\n    }\n\n    .scope > p {\n      margin: 0;\n      overflow: hidden;\n    }\n  </style>\n  <div class=&quot;scope&quot;>\n    <img data-src=&quot;zxx.jpg&quot; />\n    <p>帅哥一枚！</p>\n  </div>\n</template>\n<script>\n  // 定义<zxx-info>\n  class HTMLZxxInfoElement extends HTMLElement {\n    constructor() {\n      super();\n      // 内部显示信息\n      this.innerHTML = document.currentScript.ownerDocument.querySelector(\'#tpl\').innerHTML;\n    }\n  }\n  // 注册\n  customElements.define(\'zxx-info\', HTMLZxxInfoElement);\n</script>`, `63604947374413820000`)">\n              <div class="gatsby-code-button" title="html">\n                <span class="gatsby-code-button-language">html</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div></body></html>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">.scope</span> <span class="token punctuation">{</span>\n      <span class="token property">contain</span><span class="token punctuation">:</span> content<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.scope > img</span> <span class="token punctuation">{</span>\n      <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.scope > p</span> <span class="token punctuation">{</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zxx.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>帅哥一枚！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  <span class="token comment">// 定义&lt;zxx-info></span>\n  <span class="token keyword">class</span> <span class="token class-name">HTMLZxxInfoElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>\n    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 内部显示信息</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> document<span class="token punctuation">.</span>currentScript<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#tpl\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 注册</span>\n  customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'zxx-info\'</span><span class="token punctuation">,</span> HTMLZxxInfoElement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>两部分，一部分模板，一部分自定义元素定义和注册。都是 Web Components 中的概念。</p>\n<h1 id="即将支持的定制内置元素（customized-built-in-elements）"><a href="#%E5%8D%B3%E5%B0%86%E6%94%AF%E6%8C%81%E7%9A%84%E5%AE%9A%E5%88%B6%E5%86%85%E7%BD%AE%E5%85%83%E7%B4%A0%EF%BC%88customized-built-in-elements%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>即将支持的定制内置元素（Customized built-in elements）</h1>\n<p>上面自定义元素我们都是继承于 HTMLElement，实际上，HTMLElement 还有非常非常多的内置子集元素，例如上面提到的 HTMLDivElement，HTMLSpanElement，HTMLFormElement 元素等，每一种类型标签几乎都对应一种内置元素。</p>\n<p>所谓“定制内置元素”，指的就是我们的自定义元素继承自这些内置元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16140905133090255000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class HTMLCustomFormElement extends HTMLFormElement {\n  /* 略 */\n}\ncustomElements.define(\'custom-form\', HTMLCustomFormElement);`, `16140905133090255000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                title="js"\n              >\n                <span class="gatsby-code-button-language">js</span>\n                <span class="gatsby-code-button-text-icon">复制代码</span>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">HTMLCustomFormElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLFormElement</span> <span class="token punctuation">{</span>\n  <span class="token comment">/* 略 */</span>\n<span class="token punctuation">}</span>\ncustomElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'custom-form\'</span><span class="token punctuation">,</span> HTMLCustomFormElement<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，元素<code class="language-text">&lt;custom-form&gt;</code>就有了原生<code class="language-text">&lt;form&gt;</code>的各种属性和方法，例如直接可以使用 reset()方法重置内部表单元素的值。</p>\n<h2 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h2>\n<p>在 HTML 标准中，<code class="language-text">&lt;form&gt;</code>元素是不能相互嵌套的，这就导致一个问题，当我们需要局部重置表单内的某些属性值的时候，就不能使用 reset()方法，因为会误伤其他可能已经输入的值。</p>\n<p>例如表单中有很多输入信息，外加一个图片上传。需求是图片选择即上传完毕，此时需要在图片 Ajax 上传完毕后重置 file 类型 input 的值，IE 下值重置不像 Chrome，可以直接设置 value 为空，最佳做法直接<code class="language-text">&lt;form&gt;</code>元素的 reset()方法，此时，我们就可以在 file 类型 input 外面包一层<code class="language-text">&lt;custom-form&gt;</code>标签，这样，HTML 解析时候既没有嵌套问题，又可以使用 reset()方法对表单元素进行重置。</p>',
id:"/home/runner/work/GatsbyBlog/GatsbyBlog/blog/HTMLUnknownElement与HTML5自定义元素/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2019-12-12 19:33:01",path:"/htmlunknownelement-html5-custom-elements/",tags:"前端, DOM, DOM知识点",title:"HTMLUnknownElement与HTML5自定义元素",draft:null}}],length:5,tag:"DOM",pagesSum:1,page:1}}}});